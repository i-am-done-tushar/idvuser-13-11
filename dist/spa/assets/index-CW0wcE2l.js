var ij=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var K8e=ij((a7e,hB)=>{function P9(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in n)){const s=Object.getOwnPropertyDescriptor(r,o);s&&Object.defineProperty(n,o,s.get?s:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();function gv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function aj(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}),t}var qb={exports:{}},Sp={},Kb={exports:{}},on={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hS;function lj(){if(hS)return on;hS=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),i=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;function h(B){return B===null||typeof B!="object"?null:(B=d&&B[d]||B["@@iterator"],typeof B=="function"?B:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,x={};function y(B,q,Q){this.props=B,this.context=q,this.refs=x,this.updater=Q||p}y.prototype.isReactComponent={},y.prototype.setState=function(B,q){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,q,"setState")},y.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function b(){}b.prototype=y.prototype;function C(B,q,Q){this.props=B,this.context=q,this.refs=x,this.updater=Q||p}var S=C.prototype=new b;S.constructor=C,g(S,y.prototype),S.isPureReactComponent=!0;var k=Array.isArray,N=Object.prototype.hasOwnProperty,E={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function $(B,q,Q){var Z,ne={},ge=null,he=null;if(q!=null)for(Z in q.ref!==void 0&&(he=q.ref),q.key!==void 0&&(ge=""+q.key),q)N.call(q,Z)&&!_.hasOwnProperty(Z)&&(ne[Z]=q[Z]);var Se=arguments.length-2;if(Se===1)ne.children=Q;else if(1<Se){for(var Re=Array(Se),We=0;We<Se;We++)Re[We]=arguments[We+2];ne.children=Re}if(B&&B.defaultProps)for(Z in Se=B.defaultProps,Se)ne[Z]===void 0&&(ne[Z]=Se[Z]);return{$$typeof:n,type:B,key:ge,ref:he,props:ne,_owner:E.current}}function T(B,q){return{$$typeof:n,type:B.type,key:q,ref:B.ref,props:B.props,_owner:B._owner}}function D(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function A(B){var q={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(Q){return q[Q]})}var M=/\/+/g;function j(B,q){return typeof B=="object"&&B!==null&&B.key!=null?A(""+B.key):q.toString(36)}function L(B,q,Q,Z,ne){var ge=typeof B;(ge==="undefined"||ge==="boolean")&&(B=null);var he=!1;if(B===null)he=!0;else switch(ge){case"string":case"number":he=!0;break;case"object":switch(B.$$typeof){case n:case e:he=!0}}if(he)return he=B,ne=ne(he),B=Z===""?"."+j(he,0):Z,k(ne)?(Q="",B!=null&&(Q=B.replace(M,"$&/")+"/"),L(ne,q,Q,"",function(We){return We})):ne!=null&&(D(ne)&&(ne=T(ne,Q+(!ne.key||he&&he.key===ne.key?"":(""+ne.key).replace(M,"$&/")+"/")+B)),q.push(ne)),1;if(he=0,Z=Z===""?".":Z+":",k(B))for(var Se=0;Se<B.length;Se++){ge=B[Se];var Re=Z+j(ge,Se);he+=L(ge,q,Q,Re,ne)}else if(Re=h(B),typeof Re=="function")for(B=Re.call(B),Se=0;!(ge=B.next()).done;)ge=ge.value,Re=Z+j(ge,Se++),he+=L(ge,q,Q,Re,ne);else if(ge==="object")throw q=String(B),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.");return he}function U(B,q,Q){if(B==null)return B;var Z=[],ne=0;return L(B,Z,"","",function(ge){return q.call(Q,ge,ne++)}),Z}function G(B){if(B._status===-1){var q=B._result;q=q(),q.then(function(Q){(B._status===0||B._status===-1)&&(B._status=1,B._result=Q)},function(Q){(B._status===0||B._status===-1)&&(B._status=2,B._result=Q)}),B._status===-1&&(B._status=0,B._result=q)}if(B._status===1)return B._result.default;throw B._result}var H={current:null},O={transition:null},V={ReactCurrentDispatcher:H,ReactCurrentBatchConfig:O,ReactCurrentOwner:E};function W(){throw Error("act(...) is not supported in production builds of React.")}return on.Children={map:U,forEach:function(B,q,Q){U(B,function(){q.apply(this,arguments)},Q)},count:function(B){var q=0;return U(B,function(){q++}),q},toArray:function(B){return U(B,function(q){return q})||[]},only:function(B){if(!D(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},on.Component=y,on.Fragment=t,on.Profiler=o,on.PureComponent=C,on.StrictMode=r,on.Suspense=l,on.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,on.act=W,on.cloneElement=function(B,q,Q){if(B==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+B+".");var Z=g({},B.props),ne=B.key,ge=B.ref,he=B._owner;if(q!=null){if(q.ref!==void 0&&(ge=q.ref,he=E.current),q.key!==void 0&&(ne=""+q.key),B.type&&B.type.defaultProps)var Se=B.type.defaultProps;for(Re in q)N.call(q,Re)&&!_.hasOwnProperty(Re)&&(Z[Re]=q[Re]===void 0&&Se!==void 0?Se[Re]:q[Re])}var Re=arguments.length-2;if(Re===1)Z.children=Q;else if(1<Re){Se=Array(Re);for(var We=0;We<Re;We++)Se[We]=arguments[We+2];Z.children=Se}return{$$typeof:n,type:B.type,key:ne,ref:ge,props:Z,_owner:he}},on.createContext=function(B){return B={$$typeof:i,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},B.Provider={$$typeof:s,_context:B},B.Consumer=B},on.createElement=$,on.createFactory=function(B){var q=$.bind(null,B);return q.type=B,q},on.createRef=function(){return{current:null}},on.forwardRef=function(B){return{$$typeof:a,render:B}},on.isValidElement=D,on.lazy=function(B){return{$$typeof:u,_payload:{_status:-1,_result:B},_init:G}},on.memo=function(B,q){return{$$typeof:c,type:B,compare:q===void 0?null:q}},on.startTransition=function(B){var q=O.transition;O.transition={};try{B()}finally{O.transition=q}},on.unstable_act=W,on.useCallback=function(B,q){return H.current.useCallback(B,q)},on.useContext=function(B){return H.current.useContext(B)},on.useDebugValue=function(){},on.useDeferredValue=function(B){return H.current.useDeferredValue(B)},on.useEffect=function(B,q){return H.current.useEffect(B,q)},on.useId=function(){return H.current.useId()},on.useImperativeHandle=function(B,q,Q){return H.current.useImperativeHandle(B,q,Q)},on.useInsertionEffect=function(B,q){return H.current.useInsertionEffect(B,q)},on.useLayoutEffect=function(B,q){return H.current.useLayoutEffect(B,q)},on.useMemo=function(B,q){return H.current.useMemo(B,q)},on.useReducer=function(B,q,Q){return H.current.useReducer(B,q,Q)},on.useRef=function(B){return H.current.useRef(B)},on.useState=function(B){return H.current.useState(B)},on.useSyncExternalStore=function(B,q,Q){return H.current.useSyncExternalStore(B,q,Q)},on.useTransition=function(){return H.current.useTransition()},on.version="18.3.1",on}var fS;function i4(){return fS||(fS=1,Kb.exports=lj()),Kb.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pS;function cj(){if(pS)return Sp;pS=1;var n=i4(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function i(a,l,c){var u,d={},h=null,p=null;c!==void 0&&(h=""+c),l.key!==void 0&&(h=""+l.key),l.ref!==void 0&&(p=l.ref);for(u in l)r.call(l,u)&&!s.hasOwnProperty(u)&&(d[u]=l[u]);if(a&&a.defaultProps)for(u in l=a.defaultProps,l)d[u]===void 0&&(d[u]=l[u]);return{$$typeof:e,type:a,key:h,ref:p,props:d,_owner:o.current}}return Sp.Fragment=t,Sp.jsx=i,Sp.jsxs=i,Sp}var mS;function uj(){return mS||(mS=1,qb.exports=cj()),qb.exports}var v=uj(),F=i4();const Ke=gv(F),a4=P9({__proto__:null,default:Ke},[F]),dj=1,hj=1e6;let Xb=0;function fj(){return Xb=(Xb+1)%Number.MAX_SAFE_INTEGER,Xb.toString()}const Yb=new Map,gS=n=>{if(Yb.has(n))return;const e=setTimeout(()=>{Yb.delete(n),Gp({type:"REMOVE_TOAST",toastId:n})},hj);Yb.set(n,e)},pj=(n,e)=>{switch(e.type){case"ADD_TOAST":return{...n,toasts:[e.toast,...n.toasts].slice(0,dj)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?gS(t):n.toasts.forEach(r=>{gS(r.id)}),{...n,toasts:n.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(t=>t.id!==e.toastId)}}},Z0=[];let Q0={toasts:[]};function Gp(n){Q0=pj(Q0,n),Z0.forEach(e=>{e(Q0)})}function mj({...n}){const e=fj(),t=o=>Gp({type:"UPDATE_TOAST",toast:{...o,id:e}}),r=()=>Gp({type:"DISMISS_TOAST",toastId:e});return Gp({type:"ADD_TOAST",toast:{...n,id:e,open:!0,onOpenChange:o=>{o||r()}}}),{id:e,dismiss:r,update:t}}function Nm(){const[n,e]=F.useState(Q0);return F.useEffect(()=>(Z0.push(e),()=>{const t=Z0.indexOf(e);t>-1&&Z0.splice(t,1)}),[n]),{...n,toast:mj,dismiss:t=>Gp({type:"DISMISS_TOAST",toastId:t})}}var Zb={exports:{}},Ts={},Qb={exports:{}},Jb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xS;function gj(){return xS||(xS=1,(function(n){function e(O,V){var W=O.length;O.push(V);e:for(;0<W;){var B=W-1>>>1,q=O[B];if(0<o(q,V))O[B]=V,O[W]=q,W=B;else break e}}function t(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var V=O[0],W=O.pop();if(W!==V){O[0]=W;e:for(var B=0,q=O.length,Q=q>>>1;B<Q;){var Z=2*(B+1)-1,ne=O[Z],ge=Z+1,he=O[ge];if(0>o(ne,W))ge<q&&0>o(he,ne)?(O[B]=he,O[ge]=W,B=ge):(O[B]=ne,O[Z]=W,B=Z);else if(ge<q&&0>o(he,W))O[B]=he,O[ge]=W,B=ge;else break e}}return V}function o(O,V){var W=O.sortIndex-V.sortIndex;return W!==0?W:O.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var i=Date,a=i.now();n.unstable_now=function(){return i.now()-a}}var l=[],c=[],u=1,d=null,h=3,p=!1,g=!1,x=!1,y=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(O){for(var V=t(c);V!==null;){if(V.callback===null)r(c);else if(V.startTime<=O)r(c),V.sortIndex=V.expirationTime,e(l,V);else break;V=t(c)}}function k(O){if(x=!1,S(O),!g)if(t(l)!==null)g=!0,G(N);else{var V=t(c);V!==null&&H(k,V.startTime-O)}}function N(O,V){g=!1,x&&(x=!1,b($),$=-1),p=!0;var W=h;try{for(S(V),d=t(l);d!==null&&(!(d.expirationTime>V)||O&&!A());){var B=d.callback;if(typeof B=="function"){d.callback=null,h=d.priorityLevel;var q=B(d.expirationTime<=V);V=n.unstable_now(),typeof q=="function"?d.callback=q:d===t(l)&&r(l),S(V)}else r(l);d=t(l)}if(d!==null)var Q=!0;else{var Z=t(c);Z!==null&&H(k,Z.startTime-V),Q=!1}return Q}finally{d=null,h=W,p=!1}}var E=!1,_=null,$=-1,T=5,D=-1;function A(){return!(n.unstable_now()-D<T)}function M(){if(_!==null){var O=n.unstable_now();D=O;var V=!0;try{V=_(!0,O)}finally{V?j():(E=!1,_=null)}}else E=!1}var j;if(typeof C=="function")j=function(){C(M)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,U=L.port2;L.port1.onmessage=M,j=function(){U.postMessage(null)}}else j=function(){y(M,0)};function G(O){_=O,E||(E=!0,j())}function H(O,V){$=y(function(){O(n.unstable_now())},V)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(O){O.callback=null},n.unstable_continueExecution=function(){g||p||(g=!0,G(N))},n.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<O?Math.floor(1e3/O):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(O){switch(h){case 1:case 2:case 3:var V=3;break;default:V=h}var W=h;h=V;try{return O()}finally{h=W}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(O,V){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var W=h;h=O;try{return V()}finally{h=W}},n.unstable_scheduleCallback=function(O,V,W){var B=n.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?B+W:B):W=B,O){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=W+q,O={id:u++,callback:V,priorityLevel:O,startTime:W,expirationTime:q,sortIndex:-1},W>B?(O.sortIndex=W,e(c,O),t(l)===null&&O===t(c)&&(x?(b($),$=-1):x=!0,H(k,W-B))):(O.sortIndex=q,e(l,O),g||p||(g=!0,G(N))),O},n.unstable_shouldYield=A,n.unstable_wrapCallback=function(O){var V=h;return function(){var W=h;h=V;try{return O.apply(this,arguments)}finally{h=W}}}})(Jb)),Jb}var vS;function xj(){return vS||(vS=1,Qb.exports=gj()),Qb.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yS;function vj(){if(yS)return Ts;yS=1;var n=i4(),e=xj();function t(f){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+f,w=1;w<arguments.length;w++)m+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,o={};function s(f,m){i(f,m),i(f+"Capture",m)}function i(f,m){for(o[f]=m,f=0;f<m.length;f++)r.add(m[f])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},d={};function h(f){return l.call(d,f)?!0:l.call(u,f)?!1:c.test(f)?d[f]=!0:(u[f]=!0,!1)}function p(f,m,w,I){if(w!==null&&w.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return I?!1:w!==null?!w.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function g(f,m,w,I){if(m===null||typeof m>"u"||p(f,m,w,I))return!0;if(I)return!1;if(w!==null)switch(w.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function x(f,m,w,I,R,P,z){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=I,this.attributeNamespace=R,this.mustUseProperty=w,this.propertyName=f,this.type=m,this.sanitizeURL=P,this.removeEmptyString=z}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){y[f]=new x(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var m=f[0];y[m]=new x(m,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){y[f]=new x(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){y[f]=new x(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){y[f]=new x(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){y[f]=new x(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){y[f]=new x(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){y[f]=new x(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){y[f]=new x(f,5,!1,f.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function C(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var m=f.replace(b,C);y[m]=new x(m,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var m=f.replace(b,C);y[m]=new x(m,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var m=f.replace(b,C);y[m]=new x(m,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){y[f]=new x(f,1,!1,f.toLowerCase(),null,!1,!1)}),y.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){y[f]=new x(f,1,!1,f.toLowerCase(),null,!0,!0)});function S(f,m,w,I){var R=y.hasOwnProperty(m)?y[m]:null;(R!==null?R.type!==0:I||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(g(m,w,R,I)&&(w=null),I||R===null?h(m)&&(w===null?f.removeAttribute(m):f.setAttribute(m,""+w)):R.mustUseProperty?f[R.propertyName]=w===null?R.type===3?!1:"":w:(m=R.attributeName,I=R.attributeNamespace,w===null?f.removeAttribute(m):(R=R.type,w=R===3||R===4&&w===!0?"":""+w,I?f.setAttributeNS(I,m,w):f.setAttribute(m,w))))}var k=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,N=Symbol.for("react.element"),E=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),$=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),A=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),j=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),H=Symbol.for("react.offscreen"),O=Symbol.iterator;function V(f){return f===null||typeof f!="object"?null:(f=O&&f[O]||f["@@iterator"],typeof f=="function"?f:null)}var W=Object.assign,B;function q(f){if(B===void 0)try{throw Error()}catch(w){var m=w.stack.trim().match(/\n( *(at )?)/);B=m&&m[1]||""}return`
`+B+f}var Q=!1;function Z(f,m){if(!f||Q)return"";Q=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(Ie){var I=Ie}Reflect.construct(f,[],m)}else{try{m.call()}catch(Ie){I=Ie}f.call(m.prototype)}else{try{throw Error()}catch(Ie){I=Ie}f()}}catch(Ie){if(Ie&&I&&typeof Ie.stack=="string"){for(var R=Ie.stack.split(`
`),P=I.stack.split(`
`),z=R.length-1,J=P.length-1;1<=z&&0<=J&&R[z]!==P[J];)J--;for(;1<=z&&0<=J;z--,J--)if(R[z]!==P[J]){if(z!==1||J!==1)do if(z--,J--,0>J||R[z]!==P[J]){var oe=`
`+R[z].replace(" at new "," at ");return f.displayName&&oe.includes("<anonymous>")&&(oe=oe.replace("<anonymous>",f.displayName)),oe}while(1<=z&&0<=J);break}}}finally{Q=!1,Error.prepareStackTrace=w}return(f=f?f.displayName||f.name:"")?q(f):""}function ne(f){switch(f.tag){case 5:return q(f.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return f=Z(f.type,!1),f;case 11:return f=Z(f.type.render,!1),f;case 1:return f=Z(f.type,!0),f;default:return""}}function ge(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case _:return"Fragment";case E:return"Portal";case T:return"Profiler";case $:return"StrictMode";case j:return"Suspense";case L:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case A:return(f.displayName||"Context")+".Consumer";case D:return(f._context.displayName||"Context")+".Provider";case M:var m=f.render;return f=f.displayName,f||(f=m.displayName||m.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case U:return m=f.displayName||null,m!==null?m:ge(f.type)||"Memo";case G:m=f._payload,f=f._init;try{return ge(f(m))}catch{}}return null}function he(f){var m=f.type;switch(f.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=m.render,f=f.displayName||f.name||"",m.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ge(m);case 8:return m===$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function Se(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Re(f){var m=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function We(f){var m=Re(f)?"checked":"value",w=Object.getOwnPropertyDescriptor(f.constructor.prototype,m),I=""+f[m];if(!f.hasOwnProperty(m)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var R=w.get,P=w.set;return Object.defineProperty(f,m,{configurable:!0,get:function(){return R.call(this)},set:function(z){I=""+z,P.call(this,z)}}),Object.defineProperty(f,m,{enumerable:w.enumerable}),{getValue:function(){return I},setValue:function(z){I=""+z},stopTracking:function(){f._valueTracker=null,delete f[m]}}}}function Be(f){f._valueTracker||(f._valueTracker=We(f))}function Xe(f){if(!f)return!1;var m=f._valueTracker;if(!m)return!0;var w=m.getValue(),I="";return f&&(I=Re(f)?f.checked?"true":"false":f.value),f=I,f!==w?(m.setValue(f),!0):!1}function Ye(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function ot(f,m){var w=m.checked;return W({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??f._wrapperState.initialChecked})}function Qe(f,m){var w=m.defaultValue==null?"":m.defaultValue,I=m.checked!=null?m.checked:m.defaultChecked;w=Se(m.value!=null?m.value:w),f._wrapperState={initialChecked:I,initialValue:w,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function ct(f,m){m=m.checked,m!=null&&S(f,"checked",m,!1)}function ie(f,m){ct(f,m);var w=Se(m.value),I=m.type;if(w!=null)I==="number"?(w===0&&f.value===""||f.value!=w)&&(f.value=""+w):f.value!==""+w&&(f.value=""+w);else if(I==="submit"||I==="reset"){f.removeAttribute("value");return}m.hasOwnProperty("value")?Ot(f,m.type,w):m.hasOwnProperty("defaultValue")&&Ot(f,m.type,Se(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(f.defaultChecked=!!m.defaultChecked)}function $t(f,m,w){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var I=m.type;if(!(I!=="submit"&&I!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+f._wrapperState.initialValue,w||m===f.value||(f.value=m),f.defaultValue=m}w=f.name,w!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,w!==""&&(f.name=w)}function Ot(f,m,w){(m!=="number"||Ye(f.ownerDocument)!==f)&&(w==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+w&&(f.defaultValue=""+w))}var qt=Array.isArray;function en(f,m,w,I){if(f=f.options,m){m={};for(var R=0;R<w.length;R++)m["$"+w[R]]=!0;for(w=0;w<f.length;w++)R=m.hasOwnProperty("$"+f[w].value),f[w].selected!==R&&(f[w].selected=R),R&&I&&(f[w].defaultSelected=!0)}else{for(w=""+Se(w),m=null,R=0;R<f.length;R++){if(f[R].value===w){f[R].selected=!0,I&&(f[R].defaultSelected=!0);return}m!==null||f[R].disabled||(m=f[R])}m!==null&&(m.selected=!0)}}function hn(f,m){if(m.dangerouslySetInnerHTML!=null)throw Error(t(91));return W({},m,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function cn(f,m){var w=m.value;if(w==null){if(w=m.children,m=m.defaultValue,w!=null){if(m!=null)throw Error(t(92));if(qt(w)){if(1<w.length)throw Error(t(93));w=w[0]}m=w}m==null&&(m=""),w=m}f._wrapperState={initialValue:Se(w)}}function tn(f,m){var w=Se(m.value),I=Se(m.defaultValue);w!=null&&(w=""+w,w!==f.value&&(f.value=w),m.defaultValue==null&&f.defaultValue!==w&&(f.defaultValue=w)),I!=null&&(f.defaultValue=""+I)}function Ht(f){var m=f.textContent;m===f._wrapperState.initialValue&&m!==""&&m!==null&&(f.value=m)}function Yt(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ye(f,m){return f==null||f==="http://www.w3.org/1999/xhtml"?Yt(m):f==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var Fe,Oe=(function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,w,I,R){MSApp.execUnsafeLocalFunction(function(){return f(m,w,I,R)})}:f})(function(f,m){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=m;else{for(Fe=Fe||document.createElement("div"),Fe.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=Fe.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;m.firstChild;)f.appendChild(m.firstChild)}});function xt(f,m){if(m){var w=f.firstChild;if(w&&w===f.lastChild&&w.nodeType===3){w.nodeValue=m;return}}f.textContent=m}var at={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lt=["Webkit","ms","Moz","O"];Object.keys(at).forEach(function(f){Lt.forEach(function(m){m=m+f.charAt(0).toUpperCase()+f.substring(1),at[m]=at[f]})});function St(f,m,w){return m==null||typeof m=="boolean"||m===""?"":w||typeof m!="number"||m===0||at.hasOwnProperty(f)&&at[f]?(""+m).trim():m+"px"}function Rt(f,m){f=f.style;for(var w in m)if(m.hasOwnProperty(w)){var I=w.indexOf("--")===0,R=St(w,m[w],I);w==="float"&&(w="cssFloat"),I?f.setProperty(w,R):f[w]=R}}var On=W({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ir(f,m){if(m){if(On[f]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(t(137,f));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(t(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(t(61))}if(m.style!=null&&typeof m.style!="object")throw Error(t(62))}}function En(f,m){if(f.indexOf("-")===-1)return typeof m.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xo=null;function Er(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var gs=null,zn=null,er=null;function ar(f){if(f=cp(f)){if(typeof gs!="function")throw Error(t(280));var m=f.stateNode;m&&(m=Ng(m),gs(f.stateNode,f.type,m))}}function Vs(f){zn?er?er.push(f):er=[f]:zn=f}function Ft(){if(zn){var f=zn,m=er;if(er=zn=null,ar(f),m)for(f=0;f<m.length;f++)ar(m[f])}}function un(f,m){return f(m)}function Pt(){}var Tr=!1;function vo(f,m,w){if(Tr)return f(m,w);Tr=!0;try{return un(f,m,w)}finally{Tr=!1,(zn!==null||er!==null)&&(Pt(),Ft())}}function we(f,m){var w=f.stateNode;if(w===null)return null;var I=Ng(w);if(I===null)return null;w=I[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(f=f.type,I=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!I;break e;default:f=!1}if(f)return null;if(w&&typeof w!="function")throw Error(t(231,m,typeof w));return w}var Ne=!1;if(a)try{var fe={};Object.defineProperty(fe,"passive",{get:function(){Ne=!0}}),window.addEventListener("test",fe,fe),window.removeEventListener("test",fe,fe)}catch{Ne=!1}function $e(f,m,w,I,R,P,z,J,oe){var Ie=Array.prototype.slice.call(arguments,3);try{m.apply(w,Ie)}catch(ze){this.onError(ze)}}var st=!1,dt=null,qn=!1,vn=null,Vr={onError:function(f){st=!0,dt=f}};function nn(f,m,w,I,R,P,z,J,oe){st=!1,dt=null,$e.apply(Vr,arguments)}function Pn(f,m,w,I,R,P,z,J,oe){if(nn.apply(this,arguments),st){if(st){var Ie=dt;st=!1,dt=null}else throw Error(t(198));qn||(qn=!0,vn=Ie)}}function zs(f){var m=f,w=f;if(f.alternate)for(;m.return;)m=m.return;else{f=m;do m=f,(m.flags&4098)!==0&&(w=m.return),f=m.return;while(f)}return m.tag===3?w:null}function ku(f){if(f.tag===13){var m=f.memoizedState;if(m===null&&(f=f.alternate,f!==null&&(m=f.memoizedState)),m!==null)return m.dehydrated}return null}function Ws(f){if(zs(f)!==f)throw Error(t(188))}function Ln(f){var m=f.alternate;if(!m){if(m=zs(f),m===null)throw Error(t(188));return m!==f?null:f}for(var w=f,I=m;;){var R=w.return;if(R===null)break;var P=R.alternate;if(P===null){if(I=R.return,I!==null){w=I;continue}break}if(R.child===P.child){for(P=R.child;P;){if(P===w)return Ws(R),f;if(P===I)return Ws(R),m;P=P.sibling}throw Error(t(188))}if(w.return!==I.return)w=R,I=P;else{for(var z=!1,J=R.child;J;){if(J===w){z=!0,w=R,I=P;break}if(J===I){z=!0,I=R,w=P;break}J=J.sibling}if(!z){for(J=P.child;J;){if(J===w){z=!0,w=P,I=R;break}if(J===I){z=!0,I=P,w=R;break}J=J.sibling}if(!z)throw Error(t(189))}}if(w.alternate!==I)throw Error(t(190))}if(w.tag!==3)throw Error(t(188));return w.stateNode.current===w?f:m}function hi(f){return f=Ln(f),f!==null?no(f):null}function no(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var m=no(f);if(m!==null)return m;f=f.sibling}return null}var Rr=e.unstable_scheduleCallback,tr=e.unstable_cancelCallback,Ny=e.unstable_shouldYield,qd=e.unstable_requestPaint,yn=e.unstable_now,uc=e.unstable_getCurrentPriorityLevel,wl=e.unstable_ImmediatePriority,yo=e.unstable_UserBlockingPriority,Kd=e.unstable_NormalPriority,fi=e.unstable_LowPriority,Xf=e.unstable_IdlePriority,Li=null,ts=null;function Iy(f){if(ts&&typeof ts.onCommitFiberRoot=="function")try{ts.onCommitFiberRoot(Li,f,void 0,(f.current.flags&128)===128)}catch{}}var ns=Math.clz32?Math.clz32:xs,Yf=Math.log,Su=Math.LN2;function xs(f){return f>>>=0,f===0?32:31-(Yf(f)/Su|0)|0}var vs=64,Bi=4194304;function ba(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function ys(f,m){var w=f.pendingLanes;if(w===0)return 0;var I=0,R=f.suspendedLanes,P=f.pingedLanes,z=w&268435455;if(z!==0){var J=z&~R;J!==0?I=ba(J):(P&=z,P!==0&&(I=ba(P)))}else z=w&~R,z!==0?I=ba(z):P!==0&&(I=ba(P));if(I===0)return 0;if(m!==0&&m!==I&&(m&R)===0&&(R=I&-I,P=m&-m,R>=P||R===16&&(P&4194240)!==0))return m;if((I&4)!==0&&(I|=w&16),m=f.entangledLanes,m!==0)for(f=f.entanglements,m&=I;0<m;)w=31-ns(m),R=1<<w,I|=f[w],m&=~R;return I}function Zf(f,m){switch(f){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dc(f,m){for(var w=f.suspendedLanes,I=f.pingedLanes,R=f.expirationTimes,P=f.pendingLanes;0<P;){var z=31-ns(P),J=1<<z,oe=R[z];oe===-1?((J&w)===0||(J&I)!==0)&&(R[z]=Zf(J,m)):oe<=m&&(f.expiredLanes|=J),P&=~J}}function Qf(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function ro(){var f=vs;return vs<<=1,(vs&4194240)===0&&(vs=64),f}function Nu(f){for(var m=[],w=0;31>w;w++)m.push(f);return m}function Cl(f,m,w){f.pendingLanes|=m,m!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,m=31-ns(m),f[m]=w}function ji(f,m){var w=f.pendingLanes&~m;f.pendingLanes=m,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=m,f.mutableReadLanes&=m,f.entangledLanes&=m,m=f.entanglements;var I=f.eventTimes;for(f=f.expirationTimes;0<w;){var R=31-ns(w),P=1<<R;m[R]=0,I[R]=-1,f[R]=-1,w&=~P}}function Xd(f,m){var w=f.entangledLanes|=m;for(f=f.entanglements;w;){var I=31-ns(w),R=1<<I;R&m|f[I]&m&&(f[I]|=m),w&=~R}}var bn=0;function Vi(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var Jf,Yd,Iu,hc,Dr,fc=!1,pc=[],oo=null,$o=null,zr=null,wa=new Map,bo=new Map,Us=[],sg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pi(f,m){switch(f){case"focusin":case"focusout":oo=null;break;case"dragenter":case"dragleave":$o=null;break;case"mouseover":case"mouseout":zr=null;break;case"pointerover":case"pointerout":wa.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":bo.delete(m.pointerId)}}function Hs(f,m,w,I,R,P){return f===null||f.nativeEvent!==P?(f={blockedOn:m,domEventName:w,eventSystemFlags:I,nativeEvent:P,targetContainers:[R]},m!==null&&(m=cp(m),m!==null&&Yd(m)),f):(f.eventSystemFlags|=I,m=f.targetContainers,R!==null&&m.indexOf(R)===-1&&m.push(R),f)}function kl(f,m,w,I,R){switch(m){case"focusin":return oo=Hs(oo,f,m,w,I,R),!0;case"dragenter":return $o=Hs($o,f,m,w,I,R),!0;case"mouseover":return zr=Hs(zr,f,m,w,I,R),!0;case"pointerover":var P=R.pointerId;return wa.set(P,Hs(wa.get(P)||null,f,m,w,I,R)),!0;case"gotpointercapture":return P=R.pointerId,bo.set(P,Hs(bo.get(P)||null,f,m,w,I,R)),!0}return!1}function Zd(f){var m=Fu(f.target);if(m!==null){var w=zs(m);if(w!==null){if(m=w.tag,m===13){if(m=ku(w),m!==null){f.blockedOn=m,Dr(f.priority,function(){Iu(w)});return}}else if(m===3&&w.stateNode.current.memoizedState.isDehydrated){f.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}f.blockedOn=null}function Eu(f){if(f.blockedOn!==null)return!1;for(var m=f.targetContainers;0<m.length;){var w=th(f.domEventName,f.eventSystemFlags,m[0],f.nativeEvent);if(w===null){w=f.nativeEvent;var I=new w.constructor(w.type,w);xo=I,w.target.dispatchEvent(I),xo=null}else return m=cp(w),m!==null&&Yd(m),f.blockedOn=w,!1;m.shift()}return!0}function Sl(f,m,w){Eu(f)&&w.delete(m)}function Tu(){fc=!1,oo!==null&&Eu(oo)&&(oo=null),$o!==null&&Eu($o)&&($o=null),zr!==null&&Eu(zr)&&(zr=null),wa.forEach(Sl),bo.forEach(Sl)}function Ca(f,m){f.blockedOn===m&&(f.blockedOn=null,fc||(fc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Tu)))}function Rn(f){function m(R){return Ca(R,f)}if(0<pc.length){Ca(pc[0],f);for(var w=1;w<pc.length;w++){var I=pc[w];I.blockedOn===f&&(I.blockedOn=null)}}for(oo!==null&&Ca(oo,f),$o!==null&&Ca($o,f),zr!==null&&Ca(zr,f),wa.forEach(m),bo.forEach(m),w=0;w<Us.length;w++)I=Us[w],I.blockedOn===f&&(I.blockedOn=null);for(;0<Us.length&&(w=Us[0],w.blockedOn===null);)Zd(w),w.blockedOn===null&&Us.shift()}var Nl=k.ReactCurrentBatchConfig,Ru=!0;function Gs(f,m,w,I){var R=bn,P=Nl.transition;Nl.transition=null;try{bn=1,Jd(f,m,w,I)}finally{bn=R,Nl.transition=P}}function Qd(f,m,w,I){var R=bn,P=Nl.transition;Nl.transition=null;try{bn=4,Jd(f,m,w,I)}finally{bn=R,Nl.transition=P}}function Jd(f,m,w,I){if(Ru){var R=th(f,m,w,I);if(R===null)Oy(f,m,I,eh,w),pi(f,I);else if(kl(R,f,m,w,I))I.stopPropagation();else if(pi(f,I),m&4&&-1<sg.indexOf(f)){for(;R!==null;){var P=cp(R);if(P!==null&&Jf(P),P=th(f,m,w,I),P===null&&Oy(f,m,I,eh,w),P===R)break;R=P}R!==null&&I.stopPropagation()}else Oy(f,m,I,null,w)}}var eh=null;function th(f,m,w,I){if(eh=null,f=Er(I),f=Fu(f),f!==null)if(m=zs(f),m===null)f=null;else if(w=m.tag,w===13){if(f=ku(m),f!==null)return f;f=null}else if(w===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;f=null}else m!==f&&(f=null);return eh=f,null}function ig(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uc()){case wl:return 1;case yo:return 4;case Kd:case fi:return 16;case Xf:return 536870912;default:return 16}default:return 16}}var ka=null,nh=null,Tt=null;function ag(){if(Tt)return Tt;var f,m=nh,w=m.length,I,R="value"in ka?ka.value:ka.textContent,P=R.length;for(f=0;f<w&&m[f]===R[f];f++);var z=w-f;for(I=1;I<=z&&m[w-I]===R[P-I];I++);return Tt=R.slice(f,1<I?1-I:void 0)}function Du(f){var m=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&m===13&&(f=13)):f=m,f===10&&(f=13),32<=f||f===13?f:0}function Au(){return!0}function Sa(){return!1}function Fo(f){function m(w,I,R,P,z){this._reactName=w,this._targetInst=R,this.type=I,this.nativeEvent=P,this.target=z,this.currentTarget=null;for(var J in f)f.hasOwnProperty(J)&&(w=f[J],this[J]=w?w(P):P[J]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?Au:Sa,this.isPropagationStopped=Sa,this}return W(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Au)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Au)},persist:function(){},isPersistent:Au}),m}var Il={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Na=Fo(Il),mc=W({},Il,{view:0,detail:0}),rh=Fo(mc),Ia,_u,Ea,$u=W({},mc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sh,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Ea&&(Ea&&f.type==="mousemove"?(Ia=f.screenX-Ea.screenX,_u=f.screenY-Ea.screenY):_u=Ia=0,Ea=f),Ia)},movementY:function(f){return"movementY"in f?f.movementY:_u}}),ep=Fo($u),gc=W({},$u,{dataTransfer:0}),xc=Fo(gc),lg=W({},mc,{relatedTarget:0}),oh=Fo(lg),cg=W({},Il,{animationName:0,elapsedTime:0,pseudoElement:0}),zi=Fo(cg),Po=W({},Il,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Ta=Fo(Po),ug=W({},Il,{data:0}),tp=Fo(ug),dg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pg(f){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(f):(f=fg[f])?!!m[f]:!1}function sh(){return pg}var mg=W({},mc,{key:function(f){if(f.key){var m=dg[f.key]||f.key;if(m!=="Unidentified")return m}return f.type==="keypress"?(f=Du(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?hg[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sh,charCode:function(f){return f.type==="keypress"?Du(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Du(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),gg=Fo(mg),xg=W({},$u,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),np=Fo(xg),Ey=W({},mc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sh}),Ty=Fo(Ey),Ry=W({},Il,{propertyName:0,elapsedTime:0,pseudoElement:0}),de=Fo(Ry),te=W({},$u,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),je=Fo(te),Pe=[9,13,27,32],Je=a&&"CompositionEvent"in window,Ge=null;a&&"documentMode"in document&&(Ge=document.documentMode);var _e=a&&"TextEvent"in window&&!Ge,rt=a&&(!Je||Ge&&8<Ge&&11>=Ge),Bt=" ",an=!1;function dn(f,m){switch(f){case"keyup":return Pe.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wn(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var $n=!1;function rs(f,m){switch(f){case"compositionend":return Wn(m);case"keypress":return m.which!==32?null:(an=!0,Bt);case"textInput":return f=m.data,f===Bt&&an?null:f;default:return null}}function El(f,m){if($n)return f==="compositionend"||!Je&&dn(f,m)?(f=ag(),Tt=nh=ka=null,$n=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return rt&&m.locale!=="ko"?null:m.data;default:return null}}var Ra={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wi(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m==="input"?!!Ra[f.type]:m==="textarea"}function Da(f,m,w,I){Vs(I),m=Cg(m,"onChange"),0<m.length&&(w=new Na("onChange","change",null,w,I),f.push({event:w,listeners:m}))}var bs=null,Ui=null;function wn(f){T8(f,0)}function wr(f){var m=dh(f);if(Xe(m))return f}function wo(f,m){if(f==="change")return m}var Mo=!1;if(a){var ws;if(a){var Cs="oninput"in document;if(!Cs){var Hi=document.createElement("div");Hi.setAttribute("oninput","return;"),Cs=typeof Hi.oninput=="function"}ws=Cs}else ws=!1;Mo=ws&&(!document.documentMode||9<document.documentMode)}function mi(){bs&&(bs.detachEvent("onpropertychange",ih),Ui=bs=null)}function ih(f){if(f.propertyName==="value"&&wr(Ui)){var m=[];Da(m,Ui,f,Er(f)),vo(wn,m)}}function gi(f,m,w){f==="focusin"?(mi(),bs=m,Ui=w,bs.attachEvent("onpropertychange",ih)):f==="focusout"&&mi()}function Tl(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return wr(Ui)}function vg(f,m){if(f==="click")return wr(m)}function vc(f,m){if(f==="input"||f==="change")return wr(m)}function Aa(f,m){return f===m&&(f!==0||1/f===1/m)||f!==f&&m!==m}var Cr=typeof Object.is=="function"?Object.is:Aa;function rp(f,m){if(Cr(f,m))return!0;if(typeof f!="object"||f===null||typeof m!="object"||m===null)return!1;var w=Object.keys(f),I=Object.keys(m);if(w.length!==I.length)return!1;for(I=0;I<w.length;I++){var R=w[I];if(!l.call(m,R)||!Cr(f[R],m[R]))return!1}return!0}function m8(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function g8(f,m){var w=m8(f);f=0;for(var I;w;){if(w.nodeType===3){if(I=f+w.textContent.length,f<=m&&I>=m)return{node:w,offset:m-f};f=I}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=m8(w)}}function x8(f,m){return f&&m?f===m?!0:f&&f.nodeType===3?!1:m&&m.nodeType===3?x8(f,m.parentNode):"contains"in f?f.contains(m):f.compareDocumentPosition?!!(f.compareDocumentPosition(m)&16):!1:!1}function v8(){for(var f=window,m=Ye();m instanceof f.HTMLIFrameElement;){try{var w=typeof m.contentWindow.location.href=="string"}catch{w=!1}if(w)f=m.contentWindow;else break;m=Ye(f.document)}return m}function Dy(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m&&(m==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||m==="textarea"||f.contentEditable==="true")}function fB(f){var m=v8(),w=f.focusedElem,I=f.selectionRange;if(m!==w&&w&&w.ownerDocument&&x8(w.ownerDocument.documentElement,w)){if(I!==null&&Dy(w)){if(m=I.start,f=I.end,f===void 0&&(f=m),"selectionStart"in w)w.selectionStart=m,w.selectionEnd=Math.min(f,w.value.length);else if(f=(m=w.ownerDocument||document)&&m.defaultView||window,f.getSelection){f=f.getSelection();var R=w.textContent.length,P=Math.min(I.start,R);I=I.end===void 0?P:Math.min(I.end,R),!f.extend&&P>I&&(R=I,I=P,P=R),R=g8(w,P);var z=g8(w,I);R&&z&&(f.rangeCount!==1||f.anchorNode!==R.node||f.anchorOffset!==R.offset||f.focusNode!==z.node||f.focusOffset!==z.offset)&&(m=m.createRange(),m.setStart(R.node,R.offset),f.removeAllRanges(),P>I?(f.addRange(m),f.extend(z.node,z.offset)):(m.setEnd(z.node,z.offset),f.addRange(m)))}}for(m=[],f=w;f=f.parentNode;)f.nodeType===1&&m.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<m.length;w++)f=m[w],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var pB=a&&"documentMode"in document&&11>=document.documentMode,ah=null,Ay=null,op=null,_y=!1;function y8(f,m,w){var I=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;_y||ah==null||ah!==Ye(I)||(I=ah,"selectionStart"in I&&Dy(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),op&&rp(op,I)||(op=I,I=Cg(Ay,"onSelect"),0<I.length&&(m=new Na("onSelect","select",null,m,w),f.push({event:m,listeners:I}),m.target=ah)))}function yg(f,m){var w={};return w[f.toLowerCase()]=m.toLowerCase(),w["Webkit"+f]="webkit"+m,w["Moz"+f]="moz"+m,w}var lh={animationend:yg("Animation","AnimationEnd"),animationiteration:yg("Animation","AnimationIteration"),animationstart:yg("Animation","AnimationStart"),transitionend:yg("Transition","TransitionEnd")},$y={},b8={};a&&(b8=document.createElement("div").style,"AnimationEvent"in window||(delete lh.animationend.animation,delete lh.animationiteration.animation,delete lh.animationstart.animation),"TransitionEvent"in window||delete lh.transitionend.transition);function bg(f){if($y[f])return $y[f];if(!lh[f])return f;var m=lh[f],w;for(w in m)if(m.hasOwnProperty(w)&&w in b8)return $y[f]=m[w];return f}var w8=bg("animationend"),C8=bg("animationiteration"),k8=bg("animationstart"),S8=bg("transitionend"),N8=new Map,I8="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yc(f,m){N8.set(f,m),s(m,[f])}for(var Fy=0;Fy<I8.length;Fy++){var Py=I8[Fy],mB=Py.toLowerCase(),gB=Py[0].toUpperCase()+Py.slice(1);yc(mB,"on"+gB)}yc(w8,"onAnimationEnd"),yc(C8,"onAnimationIteration"),yc(k8,"onAnimationStart"),yc("dblclick","onDoubleClick"),yc("focusin","onFocus"),yc("focusout","onBlur"),yc(S8,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xB=new Set("cancel close invalid load scroll toggle".split(" ").concat(sp));function E8(f,m,w){var I=f.type||"unknown-event";f.currentTarget=w,Pn(I,m,void 0,f),f.currentTarget=null}function T8(f,m){m=(m&4)!==0;for(var w=0;w<f.length;w++){var I=f[w],R=I.event;I=I.listeners;e:{var P=void 0;if(m)for(var z=I.length-1;0<=z;z--){var J=I[z],oe=J.instance,Ie=J.currentTarget;if(J=J.listener,oe!==P&&R.isPropagationStopped())break e;E8(R,J,Ie),P=oe}else for(z=0;z<I.length;z++){if(J=I[z],oe=J.instance,Ie=J.currentTarget,J=J.listener,oe!==P&&R.isPropagationStopped())break e;E8(R,J,Ie),P=oe}}}if(qn)throw f=vn,qn=!1,vn=null,f}function Kn(f,m){var w=m[Wy];w===void 0&&(w=m[Wy]=new Set);var I=f+"__bubble";w.has(I)||(R8(m,f,2,!1),w.add(I))}function My(f,m,w){var I=0;m&&(I|=4),R8(w,f,I,m)}var wg="_reactListening"+Math.random().toString(36).slice(2);function ip(f){if(!f[wg]){f[wg]=!0,r.forEach(function(w){w!=="selectionchange"&&(xB.has(w)||My(w,!1,f),My(w,!0,f))});var m=f.nodeType===9?f:f.ownerDocument;m===null||m[wg]||(m[wg]=!0,My("selectionchange",!1,m))}}function R8(f,m,w,I){switch(ig(m)){case 1:var R=Gs;break;case 4:R=Qd;break;default:R=Jd}w=R.bind(null,m,w,f),R=void 0,!Ne||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(R=!0),I?R!==void 0?f.addEventListener(m,w,{capture:!0,passive:R}):f.addEventListener(m,w,!0):R!==void 0?f.addEventListener(m,w,{passive:R}):f.addEventListener(m,w,!1)}function Oy(f,m,w,I,R){var P=I;if((m&1)===0&&(m&2)===0&&I!==null)e:for(;;){if(I===null)return;var z=I.tag;if(z===3||z===4){var J=I.stateNode.containerInfo;if(J===R||J.nodeType===8&&J.parentNode===R)break;if(z===4)for(z=I.return;z!==null;){var oe=z.tag;if((oe===3||oe===4)&&(oe=z.stateNode.containerInfo,oe===R||oe.nodeType===8&&oe.parentNode===R))return;z=z.return}for(;J!==null;){if(z=Fu(J),z===null)return;if(oe=z.tag,oe===5||oe===6){I=P=z;continue e}J=J.parentNode}}I=I.return}vo(function(){var Ie=P,ze=Er(w),He=[];e:{var Ve=N8.get(f);if(Ve!==void 0){var it=Na,ft=f;switch(f){case"keypress":if(Du(w)===0)break e;case"keydown":case"keyup":it=gg;break;case"focusin":ft="focus",it=oh;break;case"focusout":ft="blur",it=oh;break;case"beforeblur":case"afterblur":it=oh;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":it=ep;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":it=xc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":it=Ty;break;case w8:case C8:case k8:it=zi;break;case S8:it=de;break;case"scroll":it=rh;break;case"wheel":it=je;break;case"copy":case"cut":case"paste":it=Ta;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":it=np}var vt=(m&4)!==0,kr=!vt&&f==="scroll",xe=vt?Ve!==null?Ve+"Capture":null:Ve;vt=[];for(var ue=Ie,be;ue!==null;){be=ue;var qe=be.stateNode;if(be.tag===5&&qe!==null&&(be=qe,xe!==null&&(qe=we(ue,xe),qe!=null&&vt.push(ap(ue,qe,be)))),kr)break;ue=ue.return}0<vt.length&&(Ve=new it(Ve,ft,null,w,ze),He.push({event:Ve,listeners:vt}))}}if((m&7)===0){e:{if(Ve=f==="mouseover"||f==="pointerover",it=f==="mouseout"||f==="pointerout",Ve&&w!==xo&&(ft=w.relatedTarget||w.fromElement)&&(Fu(ft)||ft[Rl]))break e;if((it||Ve)&&(Ve=ze.window===ze?ze:(Ve=ze.ownerDocument)?Ve.defaultView||Ve.parentWindow:window,it?(ft=w.relatedTarget||w.toElement,it=Ie,ft=ft?Fu(ft):null,ft!==null&&(kr=zs(ft),ft!==kr||ft.tag!==5&&ft.tag!==6)&&(ft=null)):(it=null,ft=Ie),it!==ft)){if(vt=ep,qe="onMouseLeave",xe="onMouseEnter",ue="mouse",(f==="pointerout"||f==="pointerover")&&(vt=np,qe="onPointerLeave",xe="onPointerEnter",ue="pointer"),kr=it==null?Ve:dh(it),be=ft==null?Ve:dh(ft),Ve=new vt(qe,ue+"leave",it,w,ze),Ve.target=kr,Ve.relatedTarget=be,qe=null,Fu(ze)===Ie&&(vt=new vt(xe,ue+"enter",ft,w,ze),vt.target=be,vt.relatedTarget=kr,qe=vt),kr=qe,it&&ft)t:{for(vt=it,xe=ft,ue=0,be=vt;be;be=ch(be))ue++;for(be=0,qe=xe;qe;qe=ch(qe))be++;for(;0<ue-be;)vt=ch(vt),ue--;for(;0<be-ue;)xe=ch(xe),be--;for(;ue--;){if(vt===xe||xe!==null&&vt===xe.alternate)break t;vt=ch(vt),xe=ch(xe)}vt=null}else vt=null;it!==null&&D8(He,Ve,it,vt,!1),ft!==null&&kr!==null&&D8(He,kr,ft,vt,!0)}}e:{if(Ve=Ie?dh(Ie):window,it=Ve.nodeName&&Ve.nodeName.toLowerCase(),it==="select"||it==="input"&&Ve.type==="file")var bt=wo;else if(Wi(Ve))if(Mo)bt=vc;else{bt=Tl;var Dt=gi}else(it=Ve.nodeName)&&it.toLowerCase()==="input"&&(Ve.type==="checkbox"||Ve.type==="radio")&&(bt=vg);if(bt&&(bt=bt(f,Ie))){Da(He,bt,w,ze);break e}Dt&&Dt(f,Ve,Ie),f==="focusout"&&(Dt=Ve._wrapperState)&&Dt.controlled&&Ve.type==="number"&&Ot(Ve,"number",Ve.value)}switch(Dt=Ie?dh(Ie):window,f){case"focusin":(Wi(Dt)||Dt.contentEditable==="true")&&(ah=Dt,Ay=Ie,op=null);break;case"focusout":op=Ay=ah=null;break;case"mousedown":_y=!0;break;case"contextmenu":case"mouseup":case"dragend":_y=!1,y8(He,w,ze);break;case"selectionchange":if(pB)break;case"keydown":case"keyup":y8(He,w,ze)}var At;if(Je)e:{switch(f){case"compositionstart":var jt="onCompositionStart";break e;case"compositionend":jt="onCompositionEnd";break e;case"compositionupdate":jt="onCompositionUpdate";break e}jt=void 0}else $n?dn(f,w)&&(jt="onCompositionEnd"):f==="keydown"&&w.keyCode===229&&(jt="onCompositionStart");jt&&(rt&&w.locale!=="ko"&&($n||jt!=="onCompositionStart"?jt==="onCompositionEnd"&&$n&&(At=ag()):(ka=ze,nh="value"in ka?ka.value:ka.textContent,$n=!0)),Dt=Cg(Ie,jt),0<Dt.length&&(jt=new tp(jt,f,null,w,ze),He.push({event:jt,listeners:Dt}),At?jt.data=At:(At=Wn(w),At!==null&&(jt.data=At)))),(At=_e?rs(f,w):El(f,w))&&(Ie=Cg(Ie,"onBeforeInput"),0<Ie.length&&(ze=new tp("onBeforeInput","beforeinput",null,w,ze),He.push({event:ze,listeners:Ie}),ze.data=At))}T8(He,m)})}function ap(f,m,w){return{instance:f,listener:m,currentTarget:w}}function Cg(f,m){for(var w=m+"Capture",I=[];f!==null;){var R=f,P=R.stateNode;R.tag===5&&P!==null&&(R=P,P=we(f,w),P!=null&&I.unshift(ap(f,P,R)),P=we(f,m),P!=null&&I.push(ap(f,P,R))),f=f.return}return I}function ch(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function D8(f,m,w,I,R){for(var P=m._reactName,z=[];w!==null&&w!==I;){var J=w,oe=J.alternate,Ie=J.stateNode;if(oe!==null&&oe===I)break;J.tag===5&&Ie!==null&&(J=Ie,R?(oe=we(w,P),oe!=null&&z.unshift(ap(w,oe,J))):R||(oe=we(w,P),oe!=null&&z.push(ap(w,oe,J)))),w=w.return}z.length!==0&&f.push({event:m,listeners:z})}var vB=/\r\n?/g,yB=/\u0000|\uFFFD/g;function A8(f){return(typeof f=="string"?f:""+f).replace(vB,`
`).replace(yB,"")}function kg(f,m,w){if(m=A8(m),A8(f)!==m&&w)throw Error(t(425))}function Sg(){}var Ly=null,By=null;function jy(f,m){return f==="textarea"||f==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var Vy=typeof setTimeout=="function"?setTimeout:void 0,bB=typeof clearTimeout=="function"?clearTimeout:void 0,_8=typeof Promise=="function"?Promise:void 0,wB=typeof queueMicrotask=="function"?queueMicrotask:typeof _8<"u"?function(f){return _8.resolve(null).then(f).catch(CB)}:Vy;function CB(f){setTimeout(function(){throw f})}function zy(f,m){var w=m,I=0;do{var R=w.nextSibling;if(f.removeChild(w),R&&R.nodeType===8)if(w=R.data,w==="/$"){if(I===0){f.removeChild(R),Rn(m);return}I--}else w!=="$"&&w!=="$?"&&w!=="$!"||I++;w=R}while(w);Rn(m)}function bc(f){for(;f!=null;f=f.nextSibling){var m=f.nodeType;if(m===1||m===3)break;if(m===8){if(m=f.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return f}function $8(f){f=f.previousSibling;for(var m=0;f;){if(f.nodeType===8){var w=f.data;if(w==="$"||w==="$!"||w==="$?"){if(m===0)return f;m--}else w==="/$"&&m++}f=f.previousSibling}return null}var uh=Math.random().toString(36).slice(2),_a="__reactFiber$"+uh,lp="__reactProps$"+uh,Rl="__reactContainer$"+uh,Wy="__reactEvents$"+uh,kB="__reactListeners$"+uh,SB="__reactHandles$"+uh;function Fu(f){var m=f[_a];if(m)return m;for(var w=f.parentNode;w;){if(m=w[Rl]||w[_a]){if(w=m.alternate,m.child!==null||w!==null&&w.child!==null)for(f=$8(f);f!==null;){if(w=f[_a])return w;f=$8(f)}return m}f=w,w=f.parentNode}return null}function cp(f){return f=f[_a]||f[Rl],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function dh(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(t(33))}function Ng(f){return f[lp]||null}var Uy=[],hh=-1;function wc(f){return{current:f}}function Xn(f){0>hh||(f.current=Uy[hh],Uy[hh]=null,hh--)}function Un(f,m){hh++,Uy[hh]=f.current,f.current=m}var Cc={},Oo=wc(Cc),ks=wc(!1),Pu=Cc;function fh(f,m){var w=f.type.contextTypes;if(!w)return Cc;var I=f.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===m)return I.__reactInternalMemoizedMaskedChildContext;var R={},P;for(P in w)R[P]=m[P];return I&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=m,f.__reactInternalMemoizedMaskedChildContext=R),R}function Ss(f){return f=f.childContextTypes,f!=null}function Ig(){Xn(ks),Xn(Oo)}function F8(f,m,w){if(Oo.current!==Cc)throw Error(t(168));Un(Oo,m),Un(ks,w)}function P8(f,m,w){var I=f.stateNode;if(m=m.childContextTypes,typeof I.getChildContext!="function")return w;I=I.getChildContext();for(var R in I)if(!(R in m))throw Error(t(108,he(f)||"Unknown",R));return W({},w,I)}function Eg(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Cc,Pu=Oo.current,Un(Oo,f),Un(ks,ks.current),!0}function M8(f,m,w){var I=f.stateNode;if(!I)throw Error(t(169));w?(f=P8(f,m,Pu),I.__reactInternalMemoizedMergedChildContext=f,Xn(ks),Xn(Oo),Un(Oo,f)):Xn(ks),Un(ks,w)}var Dl=null,Tg=!1,Hy=!1;function O8(f){Dl===null?Dl=[f]:Dl.push(f)}function NB(f){Tg=!0,O8(f)}function kc(){if(!Hy&&Dl!==null){Hy=!0;var f=0,m=bn;try{var w=Dl;for(bn=1;f<w.length;f++){var I=w[f];do I=I(!0);while(I!==null)}Dl=null,Tg=!1}catch(R){throw Dl!==null&&(Dl=Dl.slice(f+1)),Rr(wl,kc),R}finally{bn=m,Hy=!1}}return null}var ph=[],mh=0,Rg=null,Dg=0,xi=[],vi=0,Mu=null,Al=1,_l="";function Ou(f,m){ph[mh++]=Dg,ph[mh++]=Rg,Rg=f,Dg=m}function L8(f,m,w){xi[vi++]=Al,xi[vi++]=_l,xi[vi++]=Mu,Mu=f;var I=Al;f=_l;var R=32-ns(I)-1;I&=~(1<<R),w+=1;var P=32-ns(m)+R;if(30<P){var z=R-R%5;P=(I&(1<<z)-1).toString(32),I>>=z,R-=z,Al=1<<32-ns(m)+R|w<<R|I,_l=P+f}else Al=1<<P|w<<R|I,_l=f}function Gy(f){f.return!==null&&(Ou(f,1),L8(f,1,0))}function qy(f){for(;f===Rg;)Rg=ph[--mh],ph[mh]=null,Dg=ph[--mh],ph[mh]=null;for(;f===Mu;)Mu=xi[--vi],xi[vi]=null,_l=xi[--vi],xi[vi]=null,Al=xi[--vi],xi[vi]=null}var qs=null,Ks=null,nr=!1,Gi=null;function B8(f,m){var w=Ci(5,null,null,0);w.elementType="DELETED",w.stateNode=m,w.return=f,m=f.deletions,m===null?(f.deletions=[w],f.flags|=16):m.push(w)}function j8(f,m){switch(f.tag){case 5:var w=f.type;return m=m.nodeType!==1||w.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(f.stateNode=m,qs=f,Ks=bc(m.firstChild),!0):!1;case 6:return m=f.pendingProps===""||m.nodeType!==3?null:m,m!==null?(f.stateNode=m,qs=f,Ks=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(w=Mu!==null?{id:Al,overflow:_l}:null,f.memoizedState={dehydrated:m,treeContext:w,retryLane:1073741824},w=Ci(18,null,null,0),w.stateNode=m,w.return=f,f.child=w,qs=f,Ks=null,!0):!1;default:return!1}}function Ky(f){return(f.mode&1)!==0&&(f.flags&128)===0}function Xy(f){if(nr){var m=Ks;if(m){var w=m;if(!j8(f,m)){if(Ky(f))throw Error(t(418));m=bc(w.nextSibling);var I=qs;m&&j8(f,m)?B8(I,w):(f.flags=f.flags&-4097|2,nr=!1,qs=f)}}else{if(Ky(f))throw Error(t(418));f.flags=f.flags&-4097|2,nr=!1,qs=f}}}function V8(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;qs=f}function Ag(f){if(f!==qs)return!1;if(!nr)return V8(f),nr=!0,!1;var m;if((m=f.tag!==3)&&!(m=f.tag!==5)&&(m=f.type,m=m!=="head"&&m!=="body"&&!jy(f.type,f.memoizedProps)),m&&(m=Ks)){if(Ky(f))throw z8(),Error(t(418));for(;m;)B8(f,m),m=bc(m.nextSibling)}if(V8(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(t(317));e:{for(f=f.nextSibling,m=0;f;){if(f.nodeType===8){var w=f.data;if(w==="/$"){if(m===0){Ks=bc(f.nextSibling);break e}m--}else w!=="$"&&w!=="$!"&&w!=="$?"||m++}f=f.nextSibling}Ks=null}}else Ks=qs?bc(f.stateNode.nextSibling):null;return!0}function z8(){for(var f=Ks;f;)f=bc(f.nextSibling)}function gh(){Ks=qs=null,nr=!1}function Yy(f){Gi===null?Gi=[f]:Gi.push(f)}var IB=k.ReactCurrentBatchConfig;function up(f,m,w){if(f=w.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(t(309));var I=w.stateNode}if(!I)throw Error(t(147,f));var R=I,P=""+f;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===P?m.ref:(m=function(z){var J=R.refs;z===null?delete J[P]:J[P]=z},m._stringRef=P,m)}if(typeof f!="string")throw Error(t(284));if(!w._owner)throw Error(t(290,f))}return f}function _g(f,m){throw f=Object.prototype.toString.call(m),Error(t(31,f==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":f))}function W8(f){var m=f._init;return m(f._payload)}function U8(f){function m(xe,ue){if(f){var be=xe.deletions;be===null?(xe.deletions=[ue],xe.flags|=16):be.push(ue)}}function w(xe,ue){if(!f)return null;for(;ue!==null;)m(xe,ue),ue=ue.sibling;return null}function I(xe,ue){for(xe=new Map;ue!==null;)ue.key!==null?xe.set(ue.key,ue):xe.set(ue.index,ue),ue=ue.sibling;return xe}function R(xe,ue){return xe=Ac(xe,ue),xe.index=0,xe.sibling=null,xe}function P(xe,ue,be){return xe.index=be,f?(be=xe.alternate,be!==null?(be=be.index,be<ue?(xe.flags|=2,ue):be):(xe.flags|=2,ue)):(xe.flags|=1048576,ue)}function z(xe){return f&&xe.alternate===null&&(xe.flags|=2),xe}function J(xe,ue,be,qe){return ue===null||ue.tag!==6?(ue=Vb(be,xe.mode,qe),ue.return=xe,ue):(ue=R(ue,be),ue.return=xe,ue)}function oe(xe,ue,be,qe){var bt=be.type;return bt===_?ze(xe,ue,be.props.children,qe,be.key):ue!==null&&(ue.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===G&&W8(bt)===ue.type)?(qe=R(ue,be.props),qe.ref=up(xe,ue,be),qe.return=xe,qe):(qe=n0(be.type,be.key,be.props,null,xe.mode,qe),qe.ref=up(xe,ue,be),qe.return=xe,qe)}function Ie(xe,ue,be,qe){return ue===null||ue.tag!==4||ue.stateNode.containerInfo!==be.containerInfo||ue.stateNode.implementation!==be.implementation?(ue=zb(be,xe.mode,qe),ue.return=xe,ue):(ue=R(ue,be.children||[]),ue.return=xe,ue)}function ze(xe,ue,be,qe,bt){return ue===null||ue.tag!==7?(ue=Hu(be,xe.mode,qe,bt),ue.return=xe,ue):(ue=R(ue,be),ue.return=xe,ue)}function He(xe,ue,be){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return ue=Vb(""+ue,xe.mode,be),ue.return=xe,ue;if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case N:return be=n0(ue.type,ue.key,ue.props,null,xe.mode,be),be.ref=up(xe,null,ue),be.return=xe,be;case E:return ue=zb(ue,xe.mode,be),ue.return=xe,ue;case G:var qe=ue._init;return He(xe,qe(ue._payload),be)}if(qt(ue)||V(ue))return ue=Hu(ue,xe.mode,be,null),ue.return=xe,ue;_g(xe,ue)}return null}function Ve(xe,ue,be,qe){var bt=ue!==null?ue.key:null;if(typeof be=="string"&&be!==""||typeof be=="number")return bt!==null?null:J(xe,ue,""+be,qe);if(typeof be=="object"&&be!==null){switch(be.$$typeof){case N:return be.key===bt?oe(xe,ue,be,qe):null;case E:return be.key===bt?Ie(xe,ue,be,qe):null;case G:return bt=be._init,Ve(xe,ue,bt(be._payload),qe)}if(qt(be)||V(be))return bt!==null?null:ze(xe,ue,be,qe,null);_g(xe,be)}return null}function it(xe,ue,be,qe,bt){if(typeof qe=="string"&&qe!==""||typeof qe=="number")return xe=xe.get(be)||null,J(ue,xe,""+qe,bt);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case N:return xe=xe.get(qe.key===null?be:qe.key)||null,oe(ue,xe,qe,bt);case E:return xe=xe.get(qe.key===null?be:qe.key)||null,Ie(ue,xe,qe,bt);case G:var Dt=qe._init;return it(xe,ue,be,Dt(qe._payload),bt)}if(qt(qe)||V(qe))return xe=xe.get(be)||null,ze(ue,xe,qe,bt,null);_g(ue,qe)}return null}function ft(xe,ue,be,qe){for(var bt=null,Dt=null,At=ue,jt=ue=0,ao=null;At!==null&&jt<be.length;jt++){At.index>jt?(ao=At,At=null):ao=At.sibling;var kn=Ve(xe,At,be[jt],qe);if(kn===null){At===null&&(At=ao);break}f&&At&&kn.alternate===null&&m(xe,At),ue=P(kn,ue,jt),Dt===null?bt=kn:Dt.sibling=kn,Dt=kn,At=ao}if(jt===be.length)return w(xe,At),nr&&Ou(xe,jt),bt;if(At===null){for(;jt<be.length;jt++)At=He(xe,be[jt],qe),At!==null&&(ue=P(At,ue,jt),Dt===null?bt=At:Dt.sibling=At,Dt=At);return nr&&Ou(xe,jt),bt}for(At=I(xe,At);jt<be.length;jt++)ao=it(At,xe,jt,be[jt],qe),ao!==null&&(f&&ao.alternate!==null&&At.delete(ao.key===null?jt:ao.key),ue=P(ao,ue,jt),Dt===null?bt=ao:Dt.sibling=ao,Dt=ao);return f&&At.forEach(function(_c){return m(xe,_c)}),nr&&Ou(xe,jt),bt}function vt(xe,ue,be,qe){var bt=V(be);if(typeof bt!="function")throw Error(t(150));if(be=bt.call(be),be==null)throw Error(t(151));for(var Dt=bt=null,At=ue,jt=ue=0,ao=null,kn=be.next();At!==null&&!kn.done;jt++,kn=be.next()){At.index>jt?(ao=At,At=null):ao=At.sibling;var _c=Ve(xe,At,kn.value,qe);if(_c===null){At===null&&(At=ao);break}f&&At&&_c.alternate===null&&m(xe,At),ue=P(_c,ue,jt),Dt===null?bt=_c:Dt.sibling=_c,Dt=_c,At=ao}if(kn.done)return w(xe,At),nr&&Ou(xe,jt),bt;if(At===null){for(;!kn.done;jt++,kn=be.next())kn=He(xe,kn.value,qe),kn!==null&&(ue=P(kn,ue,jt),Dt===null?bt=kn:Dt.sibling=kn,Dt=kn);return nr&&Ou(xe,jt),bt}for(At=I(xe,At);!kn.done;jt++,kn=be.next())kn=it(At,xe,jt,kn.value,qe),kn!==null&&(f&&kn.alternate!==null&&At.delete(kn.key===null?jt:kn.key),ue=P(kn,ue,jt),Dt===null?bt=kn:Dt.sibling=kn,Dt=kn);return f&&At.forEach(function(sj){return m(xe,sj)}),nr&&Ou(xe,jt),bt}function kr(xe,ue,be,qe){if(typeof be=="object"&&be!==null&&be.type===_&&be.key===null&&(be=be.props.children),typeof be=="object"&&be!==null){switch(be.$$typeof){case N:e:{for(var bt=be.key,Dt=ue;Dt!==null;){if(Dt.key===bt){if(bt=be.type,bt===_){if(Dt.tag===7){w(xe,Dt.sibling),ue=R(Dt,be.props.children),ue.return=xe,xe=ue;break e}}else if(Dt.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===G&&W8(bt)===Dt.type){w(xe,Dt.sibling),ue=R(Dt,be.props),ue.ref=up(xe,Dt,be),ue.return=xe,xe=ue;break e}w(xe,Dt);break}else m(xe,Dt);Dt=Dt.sibling}be.type===_?(ue=Hu(be.props.children,xe.mode,qe,be.key),ue.return=xe,xe=ue):(qe=n0(be.type,be.key,be.props,null,xe.mode,qe),qe.ref=up(xe,ue,be),qe.return=xe,xe=qe)}return z(xe);case E:e:{for(Dt=be.key;ue!==null;){if(ue.key===Dt)if(ue.tag===4&&ue.stateNode.containerInfo===be.containerInfo&&ue.stateNode.implementation===be.implementation){w(xe,ue.sibling),ue=R(ue,be.children||[]),ue.return=xe,xe=ue;break e}else{w(xe,ue);break}else m(xe,ue);ue=ue.sibling}ue=zb(be,xe.mode,qe),ue.return=xe,xe=ue}return z(xe);case G:return Dt=be._init,kr(xe,ue,Dt(be._payload),qe)}if(qt(be))return ft(xe,ue,be,qe);if(V(be))return vt(xe,ue,be,qe);_g(xe,be)}return typeof be=="string"&&be!==""||typeof be=="number"?(be=""+be,ue!==null&&ue.tag===6?(w(xe,ue.sibling),ue=R(ue,be),ue.return=xe,xe=ue):(w(xe,ue),ue=Vb(be,xe.mode,qe),ue.return=xe,xe=ue),z(xe)):w(xe,ue)}return kr}var xh=U8(!0),H8=U8(!1),$g=wc(null),Fg=null,vh=null,Zy=null;function Qy(){Zy=vh=Fg=null}function Jy(f){var m=$g.current;Xn($g),f._currentValue=m}function eb(f,m,w){for(;f!==null;){var I=f.alternate;if((f.childLanes&m)!==m?(f.childLanes|=m,I!==null&&(I.childLanes|=m)):I!==null&&(I.childLanes&m)!==m&&(I.childLanes|=m),f===w)break;f=f.return}}function yh(f,m){Fg=f,Zy=vh=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&m)!==0&&(Ns=!0),f.firstContext=null)}function yi(f){var m=f._currentValue;if(Zy!==f)if(f={context:f,memoizedValue:m,next:null},vh===null){if(Fg===null)throw Error(t(308));vh=f,Fg.dependencies={lanes:0,firstContext:f}}else vh=vh.next=f;return m}var Lu=null;function tb(f){Lu===null?Lu=[f]:Lu.push(f)}function G8(f,m,w,I){var R=m.interleaved;return R===null?(w.next=w,tb(m)):(w.next=R.next,R.next=w),m.interleaved=w,$l(f,I)}function $l(f,m){f.lanes|=m;var w=f.alternate;for(w!==null&&(w.lanes|=m),w=f,f=f.return;f!==null;)f.childLanes|=m,w=f.alternate,w!==null&&(w.childLanes|=m),w=f,f=f.return;return w.tag===3?w.stateNode:null}var Sc=!1;function nb(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function q8(f,m){f=f.updateQueue,m.updateQueue===f&&(m.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Fl(f,m){return{eventTime:f,lane:m,tag:0,payload:null,callback:null,next:null}}function Nc(f,m,w){var I=f.updateQueue;if(I===null)return null;if(I=I.shared,(Cn&2)!==0){var R=I.pending;return R===null?m.next=m:(m.next=R.next,R.next=m),I.pending=m,$l(f,w)}return R=I.interleaved,R===null?(m.next=m,tb(I)):(m.next=R.next,R.next=m),I.interleaved=m,$l(f,w)}function Pg(f,m,w){if(m=m.updateQueue,m!==null&&(m=m.shared,(w&4194240)!==0)){var I=m.lanes;I&=f.pendingLanes,w|=I,m.lanes=w,Xd(f,w)}}function K8(f,m){var w=f.updateQueue,I=f.alternate;if(I!==null&&(I=I.updateQueue,w===I)){var R=null,P=null;if(w=w.firstBaseUpdate,w!==null){do{var z={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};P===null?R=P=z:P=P.next=z,w=w.next}while(w!==null);P===null?R=P=m:P=P.next=m}else R=P=m;w={baseState:I.baseState,firstBaseUpdate:R,lastBaseUpdate:P,shared:I.shared,effects:I.effects},f.updateQueue=w;return}f=w.lastBaseUpdate,f===null?w.firstBaseUpdate=m:f.next=m,w.lastBaseUpdate=m}function Mg(f,m,w,I){var R=f.updateQueue;Sc=!1;var P=R.firstBaseUpdate,z=R.lastBaseUpdate,J=R.shared.pending;if(J!==null){R.shared.pending=null;var oe=J,Ie=oe.next;oe.next=null,z===null?P=Ie:z.next=Ie,z=oe;var ze=f.alternate;ze!==null&&(ze=ze.updateQueue,J=ze.lastBaseUpdate,J!==z&&(J===null?ze.firstBaseUpdate=Ie:J.next=Ie,ze.lastBaseUpdate=oe))}if(P!==null){var He=R.baseState;z=0,ze=Ie=oe=null,J=P;do{var Ve=J.lane,it=J.eventTime;if((I&Ve)===Ve){ze!==null&&(ze=ze.next={eventTime:it,lane:0,tag:J.tag,payload:J.payload,callback:J.callback,next:null});e:{var ft=f,vt=J;switch(Ve=m,it=w,vt.tag){case 1:if(ft=vt.payload,typeof ft=="function"){He=ft.call(it,He,Ve);break e}He=ft;break e;case 3:ft.flags=ft.flags&-65537|128;case 0:if(ft=vt.payload,Ve=typeof ft=="function"?ft.call(it,He,Ve):ft,Ve==null)break e;He=W({},He,Ve);break e;case 2:Sc=!0}}J.callback!==null&&J.lane!==0&&(f.flags|=64,Ve=R.effects,Ve===null?R.effects=[J]:Ve.push(J))}else it={eventTime:it,lane:Ve,tag:J.tag,payload:J.payload,callback:J.callback,next:null},ze===null?(Ie=ze=it,oe=He):ze=ze.next=it,z|=Ve;if(J=J.next,J===null){if(J=R.shared.pending,J===null)break;Ve=J,J=Ve.next,Ve.next=null,R.lastBaseUpdate=Ve,R.shared.pending=null}}while(!0);if(ze===null&&(oe=He),R.baseState=oe,R.firstBaseUpdate=Ie,R.lastBaseUpdate=ze,m=R.shared.interleaved,m!==null){R=m;do z|=R.lane,R=R.next;while(R!==m)}else P===null&&(R.shared.lanes=0);Vu|=z,f.lanes=z,f.memoizedState=He}}function X8(f,m,w){if(f=m.effects,m.effects=null,f!==null)for(m=0;m<f.length;m++){var I=f[m],R=I.callback;if(R!==null){if(I.callback=null,I=w,typeof R!="function")throw Error(t(191,R));R.call(I)}}}var dp={},$a=wc(dp),hp=wc(dp),fp=wc(dp);function Bu(f){if(f===dp)throw Error(t(174));return f}function rb(f,m){switch(Un(fp,m),Un(hp,f),Un($a,dp),f=m.nodeType,f){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:ye(null,"");break;default:f=f===8?m.parentNode:m,m=f.namespaceURI||null,f=f.tagName,m=ye(m,f)}Xn($a),Un($a,m)}function bh(){Xn($a),Xn(hp),Xn(fp)}function Y8(f){Bu(fp.current);var m=Bu($a.current),w=ye(m,f.type);m!==w&&(Un(hp,f),Un($a,w))}function ob(f){hp.current===f&&(Xn($a),Xn(hp))}var lr=wc(0);function Og(f){for(var m=f;m!==null;){if(m.tag===13){var w=m.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var sb=[];function ib(){for(var f=0;f<sb.length;f++)sb[f]._workInProgressVersionPrimary=null;sb.length=0}var Lg=k.ReactCurrentDispatcher,ab=k.ReactCurrentBatchConfig,ju=0,cr=null,Wr=null,so=null,Bg=!1,pp=!1,mp=0,EB=0;function Lo(){throw Error(t(321))}function lb(f,m){if(m===null)return!1;for(var w=0;w<m.length&&w<f.length;w++)if(!Cr(f[w],m[w]))return!1;return!0}function cb(f,m,w,I,R,P){if(ju=P,cr=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Lg.current=f===null||f.memoizedState===null?AB:_B,f=w(I,R),pp){P=0;do{if(pp=!1,mp=0,25<=P)throw Error(t(301));P+=1,so=Wr=null,m.updateQueue=null,Lg.current=$B,f=w(I,R)}while(pp)}if(Lg.current=zg,m=Wr!==null&&Wr.next!==null,ju=0,so=Wr=cr=null,Bg=!1,m)throw Error(t(300));return f}function ub(){var f=mp!==0;return mp=0,f}function Fa(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return so===null?cr.memoizedState=so=f:so=so.next=f,so}function bi(){if(Wr===null){var f=cr.alternate;f=f!==null?f.memoizedState:null}else f=Wr.next;var m=so===null?cr.memoizedState:so.next;if(m!==null)so=m,Wr=f;else{if(f===null)throw Error(t(310));Wr=f,f={memoizedState:Wr.memoizedState,baseState:Wr.baseState,baseQueue:Wr.baseQueue,queue:Wr.queue,next:null},so===null?cr.memoizedState=so=f:so=so.next=f}return so}function gp(f,m){return typeof m=="function"?m(f):m}function db(f){var m=bi(),w=m.queue;if(w===null)throw Error(t(311));w.lastRenderedReducer=f;var I=Wr,R=I.baseQueue,P=w.pending;if(P!==null){if(R!==null){var z=R.next;R.next=P.next,P.next=z}I.baseQueue=R=P,w.pending=null}if(R!==null){P=R.next,I=I.baseState;var J=z=null,oe=null,Ie=P;do{var ze=Ie.lane;if((ju&ze)===ze)oe!==null&&(oe=oe.next={lane:0,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null}),I=Ie.hasEagerState?Ie.eagerState:f(I,Ie.action);else{var He={lane:ze,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null};oe===null?(J=oe=He,z=I):oe=oe.next=He,cr.lanes|=ze,Vu|=ze}Ie=Ie.next}while(Ie!==null&&Ie!==P);oe===null?z=I:oe.next=J,Cr(I,m.memoizedState)||(Ns=!0),m.memoizedState=I,m.baseState=z,m.baseQueue=oe,w.lastRenderedState=I}if(f=w.interleaved,f!==null){R=f;do P=R.lane,cr.lanes|=P,Vu|=P,R=R.next;while(R!==f)}else R===null&&(w.lanes=0);return[m.memoizedState,w.dispatch]}function hb(f){var m=bi(),w=m.queue;if(w===null)throw Error(t(311));w.lastRenderedReducer=f;var I=w.dispatch,R=w.pending,P=m.memoizedState;if(R!==null){w.pending=null;var z=R=R.next;do P=f(P,z.action),z=z.next;while(z!==R);Cr(P,m.memoizedState)||(Ns=!0),m.memoizedState=P,m.baseQueue===null&&(m.baseState=P),w.lastRenderedState=P}return[P,I]}function Z8(){}function Q8(f,m){var w=cr,I=bi(),R=m(),P=!Cr(I.memoizedState,R);if(P&&(I.memoizedState=R,Ns=!0),I=I.queue,fb(t7.bind(null,w,I,f),[f]),I.getSnapshot!==m||P||so!==null&&so.memoizedState.tag&1){if(w.flags|=2048,xp(9,e7.bind(null,w,I,R,m),void 0,null),io===null)throw Error(t(349));(ju&30)!==0||J8(w,m,R)}return R}function J8(f,m,w){f.flags|=16384,f={getSnapshot:m,value:w},m=cr.updateQueue,m===null?(m={lastEffect:null,stores:null},cr.updateQueue=m,m.stores=[f]):(w=m.stores,w===null?m.stores=[f]:w.push(f))}function e7(f,m,w,I){m.value=w,m.getSnapshot=I,n7(m)&&r7(f)}function t7(f,m,w){return w(function(){n7(m)&&r7(f)})}function n7(f){var m=f.getSnapshot;f=f.value;try{var w=m();return!Cr(f,w)}catch{return!0}}function r7(f){var m=$l(f,1);m!==null&&Yi(m,f,1,-1)}function o7(f){var m=Fa();return typeof f=="function"&&(f=f()),m.memoizedState=m.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gp,lastRenderedState:f},m.queue=f,f=f.dispatch=DB.bind(null,cr,f),[m.memoizedState,f]}function xp(f,m,w,I){return f={tag:f,create:m,destroy:w,deps:I,next:null},m=cr.updateQueue,m===null?(m={lastEffect:null,stores:null},cr.updateQueue=m,m.lastEffect=f.next=f):(w=m.lastEffect,w===null?m.lastEffect=f.next=f:(I=w.next,w.next=f,f.next=I,m.lastEffect=f)),f}function s7(){return bi().memoizedState}function jg(f,m,w,I){var R=Fa();cr.flags|=f,R.memoizedState=xp(1|m,w,void 0,I===void 0?null:I)}function Vg(f,m,w,I){var R=bi();I=I===void 0?null:I;var P=void 0;if(Wr!==null){var z=Wr.memoizedState;if(P=z.destroy,I!==null&&lb(I,z.deps)){R.memoizedState=xp(m,w,P,I);return}}cr.flags|=f,R.memoizedState=xp(1|m,w,P,I)}function i7(f,m){return jg(8390656,8,f,m)}function fb(f,m){return Vg(2048,8,f,m)}function a7(f,m){return Vg(4,2,f,m)}function l7(f,m){return Vg(4,4,f,m)}function c7(f,m){if(typeof m=="function")return f=f(),m(f),function(){m(null)};if(m!=null)return f=f(),m.current=f,function(){m.current=null}}function u7(f,m,w){return w=w!=null?w.concat([f]):null,Vg(4,4,c7.bind(null,m,f),w)}function pb(){}function d7(f,m){var w=bi();m=m===void 0?null:m;var I=w.memoizedState;return I!==null&&m!==null&&lb(m,I[1])?I[0]:(w.memoizedState=[f,m],f)}function h7(f,m){var w=bi();m=m===void 0?null:m;var I=w.memoizedState;return I!==null&&m!==null&&lb(m,I[1])?I[0]:(f=f(),w.memoizedState=[f,m],f)}function f7(f,m,w){return(ju&21)===0?(f.baseState&&(f.baseState=!1,Ns=!0),f.memoizedState=w):(Cr(w,m)||(w=ro(),cr.lanes|=w,Vu|=w,f.baseState=!0),m)}function TB(f,m){var w=bn;bn=w!==0&&4>w?w:4,f(!0);var I=ab.transition;ab.transition={};try{f(!1),m()}finally{bn=w,ab.transition=I}}function p7(){return bi().memoizedState}function RB(f,m,w){var I=Rc(f);if(w={lane:I,action:w,hasEagerState:!1,eagerState:null,next:null},m7(f))g7(m,w);else if(w=G8(f,m,w,I),w!==null){var R=ss();Yi(w,f,I,R),x7(w,m,I)}}function DB(f,m,w){var I=Rc(f),R={lane:I,action:w,hasEagerState:!1,eagerState:null,next:null};if(m7(f))g7(m,R);else{var P=f.alternate;if(f.lanes===0&&(P===null||P.lanes===0)&&(P=m.lastRenderedReducer,P!==null))try{var z=m.lastRenderedState,J=P(z,w);if(R.hasEagerState=!0,R.eagerState=J,Cr(J,z)){var oe=m.interleaved;oe===null?(R.next=R,tb(m)):(R.next=oe.next,oe.next=R),m.interleaved=R;return}}catch{}finally{}w=G8(f,m,R,I),w!==null&&(R=ss(),Yi(w,f,I,R),x7(w,m,I))}}function m7(f){var m=f.alternate;return f===cr||m!==null&&m===cr}function g7(f,m){pp=Bg=!0;var w=f.pending;w===null?m.next=m:(m.next=w.next,w.next=m),f.pending=m}function x7(f,m,w){if((w&4194240)!==0){var I=m.lanes;I&=f.pendingLanes,w|=I,m.lanes=w,Xd(f,w)}}var zg={readContext:yi,useCallback:Lo,useContext:Lo,useEffect:Lo,useImperativeHandle:Lo,useInsertionEffect:Lo,useLayoutEffect:Lo,useMemo:Lo,useReducer:Lo,useRef:Lo,useState:Lo,useDebugValue:Lo,useDeferredValue:Lo,useTransition:Lo,useMutableSource:Lo,useSyncExternalStore:Lo,useId:Lo,unstable_isNewReconciler:!1},AB={readContext:yi,useCallback:function(f,m){return Fa().memoizedState=[f,m===void 0?null:m],f},useContext:yi,useEffect:i7,useImperativeHandle:function(f,m,w){return w=w!=null?w.concat([f]):null,jg(4194308,4,c7.bind(null,m,f),w)},useLayoutEffect:function(f,m){return jg(4194308,4,f,m)},useInsertionEffect:function(f,m){return jg(4,2,f,m)},useMemo:function(f,m){var w=Fa();return m=m===void 0?null:m,f=f(),w.memoizedState=[f,m],f},useReducer:function(f,m,w){var I=Fa();return m=w!==void 0?w(m):m,I.memoizedState=I.baseState=m,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:m},I.queue=f,f=f.dispatch=RB.bind(null,cr,f),[I.memoizedState,f]},useRef:function(f){var m=Fa();return f={current:f},m.memoizedState=f},useState:o7,useDebugValue:pb,useDeferredValue:function(f){return Fa().memoizedState=f},useTransition:function(){var f=o7(!1),m=f[0];return f=TB.bind(null,f[1]),Fa().memoizedState=f,[m,f]},useMutableSource:function(){},useSyncExternalStore:function(f,m,w){var I=cr,R=Fa();if(nr){if(w===void 0)throw Error(t(407));w=w()}else{if(w=m(),io===null)throw Error(t(349));(ju&30)!==0||J8(I,m,w)}R.memoizedState=w;var P={value:w,getSnapshot:m};return R.queue=P,i7(t7.bind(null,I,P,f),[f]),I.flags|=2048,xp(9,e7.bind(null,I,P,w,m),void 0,null),w},useId:function(){var f=Fa(),m=io.identifierPrefix;if(nr){var w=_l,I=Al;w=(I&~(1<<32-ns(I)-1)).toString(32)+w,m=":"+m+"R"+w,w=mp++,0<w&&(m+="H"+w.toString(32)),m+=":"}else w=EB++,m=":"+m+"r"+w.toString(32)+":";return f.memoizedState=m},unstable_isNewReconciler:!1},_B={readContext:yi,useCallback:d7,useContext:yi,useEffect:fb,useImperativeHandle:u7,useInsertionEffect:a7,useLayoutEffect:l7,useMemo:h7,useReducer:db,useRef:s7,useState:function(){return db(gp)},useDebugValue:pb,useDeferredValue:function(f){var m=bi();return f7(m,Wr.memoizedState,f)},useTransition:function(){var f=db(gp)[0],m=bi().memoizedState;return[f,m]},useMutableSource:Z8,useSyncExternalStore:Q8,useId:p7,unstable_isNewReconciler:!1},$B={readContext:yi,useCallback:d7,useContext:yi,useEffect:fb,useImperativeHandle:u7,useInsertionEffect:a7,useLayoutEffect:l7,useMemo:h7,useReducer:hb,useRef:s7,useState:function(){return hb(gp)},useDebugValue:pb,useDeferredValue:function(f){var m=bi();return Wr===null?m.memoizedState=f:f7(m,Wr.memoizedState,f)},useTransition:function(){var f=hb(gp)[0],m=bi().memoizedState;return[f,m]},useMutableSource:Z8,useSyncExternalStore:Q8,useId:p7,unstable_isNewReconciler:!1};function qi(f,m){if(f&&f.defaultProps){m=W({},m),f=f.defaultProps;for(var w in f)m[w]===void 0&&(m[w]=f[w]);return m}return m}function mb(f,m,w,I){m=f.memoizedState,w=w(I,m),w=w==null?m:W({},m,w),f.memoizedState=w,f.lanes===0&&(f.updateQueue.baseState=w)}var Wg={isMounted:function(f){return(f=f._reactInternals)?zs(f)===f:!1},enqueueSetState:function(f,m,w){f=f._reactInternals;var I=ss(),R=Rc(f),P=Fl(I,R);P.payload=m,w!=null&&(P.callback=w),m=Nc(f,P,R),m!==null&&(Yi(m,f,R,I),Pg(m,f,R))},enqueueReplaceState:function(f,m,w){f=f._reactInternals;var I=ss(),R=Rc(f),P=Fl(I,R);P.tag=1,P.payload=m,w!=null&&(P.callback=w),m=Nc(f,P,R),m!==null&&(Yi(m,f,R,I),Pg(m,f,R))},enqueueForceUpdate:function(f,m){f=f._reactInternals;var w=ss(),I=Rc(f),R=Fl(w,I);R.tag=2,m!=null&&(R.callback=m),m=Nc(f,R,I),m!==null&&(Yi(m,f,I,w),Pg(m,f,I))}};function v7(f,m,w,I,R,P,z){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(I,P,z):m.prototype&&m.prototype.isPureReactComponent?!rp(w,I)||!rp(R,P):!0}function y7(f,m,w){var I=!1,R=Cc,P=m.contextType;return typeof P=="object"&&P!==null?P=yi(P):(R=Ss(m)?Pu:Oo.current,I=m.contextTypes,P=(I=I!=null)?fh(f,R):Cc),m=new m(w,P),f.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Wg,f.stateNode=m,m._reactInternals=f,I&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=R,f.__reactInternalMemoizedMaskedChildContext=P),m}function b7(f,m,w,I){f=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(w,I),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(w,I),m.state!==f&&Wg.enqueueReplaceState(m,m.state,null)}function gb(f,m,w,I){var R=f.stateNode;R.props=w,R.state=f.memoizedState,R.refs={},nb(f);var P=m.contextType;typeof P=="object"&&P!==null?R.context=yi(P):(P=Ss(m)?Pu:Oo.current,R.context=fh(f,P)),R.state=f.memoizedState,P=m.getDerivedStateFromProps,typeof P=="function"&&(mb(f,m,P,w),R.state=f.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(m=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),m!==R.state&&Wg.enqueueReplaceState(R,R.state,null),Mg(f,w,R,I),R.state=f.memoizedState),typeof R.componentDidMount=="function"&&(f.flags|=4194308)}function wh(f,m){try{var w="",I=m;do w+=ne(I),I=I.return;while(I);var R=w}catch(P){R=`
Error generating stack: `+P.message+`
`+P.stack}return{value:f,source:m,stack:R,digest:null}}function xb(f,m,w){return{value:f,source:null,stack:w??null,digest:m??null}}function vb(f,m){try{console.error(m.value)}catch(w){setTimeout(function(){throw w})}}var FB=typeof WeakMap=="function"?WeakMap:Map;function w7(f,m,w){w=Fl(-1,w),w.tag=3,w.payload={element:null};var I=m.value;return w.callback=function(){Yg||(Yg=!0,$b=I),vb(f,m)},w}function C7(f,m,w){w=Fl(-1,w),w.tag=3;var I=f.type.getDerivedStateFromError;if(typeof I=="function"){var R=m.value;w.payload=function(){return I(R)},w.callback=function(){vb(f,m)}}var P=f.stateNode;return P!==null&&typeof P.componentDidCatch=="function"&&(w.callback=function(){vb(f,m),typeof I!="function"&&(Ec===null?Ec=new Set([this]):Ec.add(this));var z=m.stack;this.componentDidCatch(m.value,{componentStack:z!==null?z:""})}),w}function k7(f,m,w){var I=f.pingCache;if(I===null){I=f.pingCache=new FB;var R=new Set;I.set(m,R)}else R=I.get(m),R===void 0&&(R=new Set,I.set(m,R));R.has(w)||(R.add(w),f=KB.bind(null,f,m,w),m.then(f,f))}function S7(f){do{var m;if((m=f.tag===13)&&(m=f.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return f;f=f.return}while(f!==null);return null}function N7(f,m,w,I,R){return(f.mode&1)===0?(f===m?f.flags|=65536:(f.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(m=Fl(-1,1),m.tag=2,Nc(w,m,1))),w.lanes|=1),f):(f.flags|=65536,f.lanes=R,f)}var PB=k.ReactCurrentOwner,Ns=!1;function os(f,m,w,I){m.child=f===null?H8(m,null,w,I):xh(m,f.child,w,I)}function I7(f,m,w,I,R){w=w.render;var P=m.ref;return yh(m,R),I=cb(f,m,w,I,P,R),w=ub(),f!==null&&!Ns?(m.updateQueue=f.updateQueue,m.flags&=-2053,f.lanes&=~R,Pl(f,m,R)):(nr&&w&&Gy(m),m.flags|=1,os(f,m,I,R),m.child)}function E7(f,m,w,I,R){if(f===null){var P=w.type;return typeof P=="function"&&!jb(P)&&P.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(m.tag=15,m.type=P,T7(f,m,P,I,R)):(f=n0(w.type,null,I,m,m.mode,R),f.ref=m.ref,f.return=m,m.child=f)}if(P=f.child,(f.lanes&R)===0){var z=P.memoizedProps;if(w=w.compare,w=w!==null?w:rp,w(z,I)&&f.ref===m.ref)return Pl(f,m,R)}return m.flags|=1,f=Ac(P,I),f.ref=m.ref,f.return=m,m.child=f}function T7(f,m,w,I,R){if(f!==null){var P=f.memoizedProps;if(rp(P,I)&&f.ref===m.ref)if(Ns=!1,m.pendingProps=I=P,(f.lanes&R)!==0)(f.flags&131072)!==0&&(Ns=!0);else return m.lanes=f.lanes,Pl(f,m,R)}return yb(f,m,w,I,R)}function R7(f,m,w){var I=m.pendingProps,R=I.children,P=f!==null?f.memoizedState:null;if(I.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},Un(kh,Xs),Xs|=w;else{if((w&1073741824)===0)return f=P!==null?P.baseLanes|w:w,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:f,cachePool:null,transitions:null},m.updateQueue=null,Un(kh,Xs),Xs|=f,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=P!==null?P.baseLanes:w,Un(kh,Xs),Xs|=I}else P!==null?(I=P.baseLanes|w,m.memoizedState=null):I=w,Un(kh,Xs),Xs|=I;return os(f,m,R,w),m.child}function D7(f,m){var w=m.ref;(f===null&&w!==null||f!==null&&f.ref!==w)&&(m.flags|=512,m.flags|=2097152)}function yb(f,m,w,I,R){var P=Ss(w)?Pu:Oo.current;return P=fh(m,P),yh(m,R),w=cb(f,m,w,I,P,R),I=ub(),f!==null&&!Ns?(m.updateQueue=f.updateQueue,m.flags&=-2053,f.lanes&=~R,Pl(f,m,R)):(nr&&I&&Gy(m),m.flags|=1,os(f,m,w,R),m.child)}function A7(f,m,w,I,R){if(Ss(w)){var P=!0;Eg(m)}else P=!1;if(yh(m,R),m.stateNode===null)Hg(f,m),y7(m,w,I),gb(m,w,I,R),I=!0;else if(f===null){var z=m.stateNode,J=m.memoizedProps;z.props=J;var oe=z.context,Ie=w.contextType;typeof Ie=="object"&&Ie!==null?Ie=yi(Ie):(Ie=Ss(w)?Pu:Oo.current,Ie=fh(m,Ie));var ze=w.getDerivedStateFromProps,He=typeof ze=="function"||typeof z.getSnapshotBeforeUpdate=="function";He||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(J!==I||oe!==Ie)&&b7(m,z,I,Ie),Sc=!1;var Ve=m.memoizedState;z.state=Ve,Mg(m,I,z,R),oe=m.memoizedState,J!==I||Ve!==oe||ks.current||Sc?(typeof ze=="function"&&(mb(m,w,ze,I),oe=m.memoizedState),(J=Sc||v7(m,w,J,I,Ve,oe,Ie))?(He||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(m.flags|=4194308)):(typeof z.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=I,m.memoizedState=oe),z.props=I,z.state=oe,z.context=Ie,I=J):(typeof z.componentDidMount=="function"&&(m.flags|=4194308),I=!1)}else{z=m.stateNode,q8(f,m),J=m.memoizedProps,Ie=m.type===m.elementType?J:qi(m.type,J),z.props=Ie,He=m.pendingProps,Ve=z.context,oe=w.contextType,typeof oe=="object"&&oe!==null?oe=yi(oe):(oe=Ss(w)?Pu:Oo.current,oe=fh(m,oe));var it=w.getDerivedStateFromProps;(ze=typeof it=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(J!==He||Ve!==oe)&&b7(m,z,I,oe),Sc=!1,Ve=m.memoizedState,z.state=Ve,Mg(m,I,z,R);var ft=m.memoizedState;J!==He||Ve!==ft||ks.current||Sc?(typeof it=="function"&&(mb(m,w,it,I),ft=m.memoizedState),(Ie=Sc||v7(m,w,Ie,I,Ve,ft,oe)||!1)?(ze||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(I,ft,oe),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(I,ft,oe)),typeof z.componentDidUpdate=="function"&&(m.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof z.componentDidUpdate!="function"||J===f.memoizedProps&&Ve===f.memoizedState||(m.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||J===f.memoizedProps&&Ve===f.memoizedState||(m.flags|=1024),m.memoizedProps=I,m.memoizedState=ft),z.props=I,z.state=ft,z.context=oe,I=Ie):(typeof z.componentDidUpdate!="function"||J===f.memoizedProps&&Ve===f.memoizedState||(m.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||J===f.memoizedProps&&Ve===f.memoizedState||(m.flags|=1024),I=!1)}return bb(f,m,w,I,P,R)}function bb(f,m,w,I,R,P){D7(f,m);var z=(m.flags&128)!==0;if(!I&&!z)return R&&M8(m,w,!1),Pl(f,m,P);I=m.stateNode,PB.current=m;var J=z&&typeof w.getDerivedStateFromError!="function"?null:I.render();return m.flags|=1,f!==null&&z?(m.child=xh(m,f.child,null,P),m.child=xh(m,null,J,P)):os(f,m,J,P),m.memoizedState=I.state,R&&M8(m,w,!0),m.child}function _7(f){var m=f.stateNode;m.pendingContext?F8(f,m.pendingContext,m.pendingContext!==m.context):m.context&&F8(f,m.context,!1),rb(f,m.containerInfo)}function $7(f,m,w,I,R){return gh(),Yy(R),m.flags|=256,os(f,m,w,I),m.child}var wb={dehydrated:null,treeContext:null,retryLane:0};function Cb(f){return{baseLanes:f,cachePool:null,transitions:null}}function F7(f,m,w){var I=m.pendingProps,R=lr.current,P=!1,z=(m.flags&128)!==0,J;if((J=z)||(J=f!==null&&f.memoizedState===null?!1:(R&2)!==0),J?(P=!0,m.flags&=-129):(f===null||f.memoizedState!==null)&&(R|=1),Un(lr,R&1),f===null)return Xy(m),f=m.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((m.mode&1)===0?m.lanes=1:f.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(z=I.children,f=I.fallback,P?(I=m.mode,P=m.child,z={mode:"hidden",children:z},(I&1)===0&&P!==null?(P.childLanes=0,P.pendingProps=z):P=r0(z,I,0,null),f=Hu(f,I,w,null),P.return=m,f.return=m,P.sibling=f,m.child=P,m.child.memoizedState=Cb(w),m.memoizedState=wb,f):kb(m,z));if(R=f.memoizedState,R!==null&&(J=R.dehydrated,J!==null))return MB(f,m,z,I,J,R,w);if(P){P=I.fallback,z=m.mode,R=f.child,J=R.sibling;var oe={mode:"hidden",children:I.children};return(z&1)===0&&m.child!==R?(I=m.child,I.childLanes=0,I.pendingProps=oe,m.deletions=null):(I=Ac(R,oe),I.subtreeFlags=R.subtreeFlags&14680064),J!==null?P=Ac(J,P):(P=Hu(P,z,w,null),P.flags|=2),P.return=m,I.return=m,I.sibling=P,m.child=I,I=P,P=m.child,z=f.child.memoizedState,z=z===null?Cb(w):{baseLanes:z.baseLanes|w,cachePool:null,transitions:z.transitions},P.memoizedState=z,P.childLanes=f.childLanes&~w,m.memoizedState=wb,I}return P=f.child,f=P.sibling,I=Ac(P,{mode:"visible",children:I.children}),(m.mode&1)===0&&(I.lanes=w),I.return=m,I.sibling=null,f!==null&&(w=m.deletions,w===null?(m.deletions=[f],m.flags|=16):w.push(f)),m.child=I,m.memoizedState=null,I}function kb(f,m){return m=r0({mode:"visible",children:m},f.mode,0,null),m.return=f,f.child=m}function Ug(f,m,w,I){return I!==null&&Yy(I),xh(m,f.child,null,w),f=kb(m,m.pendingProps.children),f.flags|=2,m.memoizedState=null,f}function MB(f,m,w,I,R,P,z){if(w)return m.flags&256?(m.flags&=-257,I=xb(Error(t(422))),Ug(f,m,z,I)):m.memoizedState!==null?(m.child=f.child,m.flags|=128,null):(P=I.fallback,R=m.mode,I=r0({mode:"visible",children:I.children},R,0,null),P=Hu(P,R,z,null),P.flags|=2,I.return=m,P.return=m,I.sibling=P,m.child=I,(m.mode&1)!==0&&xh(m,f.child,null,z),m.child.memoizedState=Cb(z),m.memoizedState=wb,P);if((m.mode&1)===0)return Ug(f,m,z,null);if(R.data==="$!"){if(I=R.nextSibling&&R.nextSibling.dataset,I)var J=I.dgst;return I=J,P=Error(t(419)),I=xb(P,I,void 0),Ug(f,m,z,I)}if(J=(z&f.childLanes)!==0,Ns||J){if(I=io,I!==null){switch(z&-z){case 4:R=2;break;case 16:R=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:R=32;break;case 536870912:R=268435456;break;default:R=0}R=(R&(I.suspendedLanes|z))!==0?0:R,R!==0&&R!==P.retryLane&&(P.retryLane=R,$l(f,R),Yi(I,f,R,-1))}return Bb(),I=xb(Error(t(421))),Ug(f,m,z,I)}return R.data==="$?"?(m.flags|=128,m.child=f.child,m=XB.bind(null,f),R._reactRetry=m,null):(f=P.treeContext,Ks=bc(R.nextSibling),qs=m,nr=!0,Gi=null,f!==null&&(xi[vi++]=Al,xi[vi++]=_l,xi[vi++]=Mu,Al=f.id,_l=f.overflow,Mu=m),m=kb(m,I.children),m.flags|=4096,m)}function P7(f,m,w){f.lanes|=m;var I=f.alternate;I!==null&&(I.lanes|=m),eb(f.return,m,w)}function Sb(f,m,w,I,R){var P=f.memoizedState;P===null?f.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:I,tail:w,tailMode:R}:(P.isBackwards=m,P.rendering=null,P.renderingStartTime=0,P.last=I,P.tail=w,P.tailMode=R)}function M7(f,m,w){var I=m.pendingProps,R=I.revealOrder,P=I.tail;if(os(f,m,I.children,w),I=lr.current,(I&2)!==0)I=I&1|2,m.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=m.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&P7(f,w,m);else if(f.tag===19)P7(f,w,m);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===m)break e;for(;f.sibling===null;){if(f.return===null||f.return===m)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}I&=1}if(Un(lr,I),(m.mode&1)===0)m.memoizedState=null;else switch(R){case"forwards":for(w=m.child,R=null;w!==null;)f=w.alternate,f!==null&&Og(f)===null&&(R=w),w=w.sibling;w=R,w===null?(R=m.child,m.child=null):(R=w.sibling,w.sibling=null),Sb(m,!1,R,w,P);break;case"backwards":for(w=null,R=m.child,m.child=null;R!==null;){if(f=R.alternate,f!==null&&Og(f)===null){m.child=R;break}f=R.sibling,R.sibling=w,w=R,R=f}Sb(m,!0,w,null,P);break;case"together":Sb(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Hg(f,m){(m.mode&1)===0&&f!==null&&(f.alternate=null,m.alternate=null,m.flags|=2)}function Pl(f,m,w){if(f!==null&&(m.dependencies=f.dependencies),Vu|=m.lanes,(w&m.childLanes)===0)return null;if(f!==null&&m.child!==f.child)throw Error(t(153));if(m.child!==null){for(f=m.child,w=Ac(f,f.pendingProps),m.child=w,w.return=m;f.sibling!==null;)f=f.sibling,w=w.sibling=Ac(f,f.pendingProps),w.return=m;w.sibling=null}return m.child}function OB(f,m,w){switch(m.tag){case 3:_7(m),gh();break;case 5:Y8(m);break;case 1:Ss(m.type)&&Eg(m);break;case 4:rb(m,m.stateNode.containerInfo);break;case 10:var I=m.type._context,R=m.memoizedProps.value;Un($g,I._currentValue),I._currentValue=R;break;case 13:if(I=m.memoizedState,I!==null)return I.dehydrated!==null?(Un(lr,lr.current&1),m.flags|=128,null):(w&m.child.childLanes)!==0?F7(f,m,w):(Un(lr,lr.current&1),f=Pl(f,m,w),f!==null?f.sibling:null);Un(lr,lr.current&1);break;case 19:if(I=(w&m.childLanes)!==0,(f.flags&128)!==0){if(I)return M7(f,m,w);m.flags|=128}if(R=m.memoizedState,R!==null&&(R.rendering=null,R.tail=null,R.lastEffect=null),Un(lr,lr.current),I)break;return null;case 22:case 23:return m.lanes=0,R7(f,m,w)}return Pl(f,m,w)}var O7,Nb,L7,B7;O7=function(f,m){for(var w=m.child;w!==null;){if(w.tag===5||w.tag===6)f.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===m)break;for(;w.sibling===null;){if(w.return===null||w.return===m)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},Nb=function(){},L7=function(f,m,w,I){var R=f.memoizedProps;if(R!==I){f=m.stateNode,Bu($a.current);var P=null;switch(w){case"input":R=ot(f,R),I=ot(f,I),P=[];break;case"select":R=W({},R,{value:void 0}),I=W({},I,{value:void 0}),P=[];break;case"textarea":R=hn(f,R),I=hn(f,I),P=[];break;default:typeof R.onClick!="function"&&typeof I.onClick=="function"&&(f.onclick=Sg)}ir(w,I);var z;w=null;for(Ie in R)if(!I.hasOwnProperty(Ie)&&R.hasOwnProperty(Ie)&&R[Ie]!=null)if(Ie==="style"){var J=R[Ie];for(z in J)J.hasOwnProperty(z)&&(w||(w={}),w[z]="")}else Ie!=="dangerouslySetInnerHTML"&&Ie!=="children"&&Ie!=="suppressContentEditableWarning"&&Ie!=="suppressHydrationWarning"&&Ie!=="autoFocus"&&(o.hasOwnProperty(Ie)?P||(P=[]):(P=P||[]).push(Ie,null));for(Ie in I){var oe=I[Ie];if(J=R?.[Ie],I.hasOwnProperty(Ie)&&oe!==J&&(oe!=null||J!=null))if(Ie==="style")if(J){for(z in J)!J.hasOwnProperty(z)||oe&&oe.hasOwnProperty(z)||(w||(w={}),w[z]="");for(z in oe)oe.hasOwnProperty(z)&&J[z]!==oe[z]&&(w||(w={}),w[z]=oe[z])}else w||(P||(P=[]),P.push(Ie,w)),w=oe;else Ie==="dangerouslySetInnerHTML"?(oe=oe?oe.__html:void 0,J=J?J.__html:void 0,oe!=null&&J!==oe&&(P=P||[]).push(Ie,oe)):Ie==="children"?typeof oe!="string"&&typeof oe!="number"||(P=P||[]).push(Ie,""+oe):Ie!=="suppressContentEditableWarning"&&Ie!=="suppressHydrationWarning"&&(o.hasOwnProperty(Ie)?(oe!=null&&Ie==="onScroll"&&Kn("scroll",f),P||J===oe||(P=[])):(P=P||[]).push(Ie,oe))}w&&(P=P||[]).push("style",w);var Ie=P;(m.updateQueue=Ie)&&(m.flags|=4)}},B7=function(f,m,w,I){w!==I&&(m.flags|=4)};function vp(f,m){if(!nr)switch(f.tailMode){case"hidden":m=f.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?f.tail=null:w.sibling=null;break;case"collapsed":w=f.tail;for(var I=null;w!==null;)w.alternate!==null&&(I=w),w=w.sibling;I===null?m||f.tail===null?f.tail=null:f.tail.sibling=null:I.sibling=null}}function Bo(f){var m=f.alternate!==null&&f.alternate.child===f.child,w=0,I=0;if(m)for(var R=f.child;R!==null;)w|=R.lanes|R.childLanes,I|=R.subtreeFlags&14680064,I|=R.flags&14680064,R.return=f,R=R.sibling;else for(R=f.child;R!==null;)w|=R.lanes|R.childLanes,I|=R.subtreeFlags,I|=R.flags,R.return=f,R=R.sibling;return f.subtreeFlags|=I,f.childLanes=w,m}function LB(f,m,w){var I=m.pendingProps;switch(qy(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bo(m),null;case 1:return Ss(m.type)&&Ig(),Bo(m),null;case 3:return I=m.stateNode,bh(),Xn(ks),Xn(Oo),ib(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(f===null||f.child===null)&&(Ag(m)?m.flags|=4:f===null||f.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Gi!==null&&(Mb(Gi),Gi=null))),Nb(f,m),Bo(m),null;case 5:ob(m);var R=Bu(fp.current);if(w=m.type,f!==null&&m.stateNode!=null)L7(f,m,w,I,R),f.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!I){if(m.stateNode===null)throw Error(t(166));return Bo(m),null}if(f=Bu($a.current),Ag(m)){I=m.stateNode,w=m.type;var P=m.memoizedProps;switch(I[_a]=m,I[lp]=P,f=(m.mode&1)!==0,w){case"dialog":Kn("cancel",I),Kn("close",I);break;case"iframe":case"object":case"embed":Kn("load",I);break;case"video":case"audio":for(R=0;R<sp.length;R++)Kn(sp[R],I);break;case"source":Kn("error",I);break;case"img":case"image":case"link":Kn("error",I),Kn("load",I);break;case"details":Kn("toggle",I);break;case"input":Qe(I,P),Kn("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!P.multiple},Kn("invalid",I);break;case"textarea":cn(I,P),Kn("invalid",I)}ir(w,P),R=null;for(var z in P)if(P.hasOwnProperty(z)){var J=P[z];z==="children"?typeof J=="string"?I.textContent!==J&&(P.suppressHydrationWarning!==!0&&kg(I.textContent,J,f),R=["children",J]):typeof J=="number"&&I.textContent!==""+J&&(P.suppressHydrationWarning!==!0&&kg(I.textContent,J,f),R=["children",""+J]):o.hasOwnProperty(z)&&J!=null&&z==="onScroll"&&Kn("scroll",I)}switch(w){case"input":Be(I),$t(I,P,!0);break;case"textarea":Be(I),Ht(I);break;case"select":case"option":break;default:typeof P.onClick=="function"&&(I.onclick=Sg)}I=R,m.updateQueue=I,I!==null&&(m.flags|=4)}else{z=R.nodeType===9?R:R.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Yt(w)),f==="http://www.w3.org/1999/xhtml"?w==="script"?(f=z.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof I.is=="string"?f=z.createElement(w,{is:I.is}):(f=z.createElement(w),w==="select"&&(z=f,I.multiple?z.multiple=!0:I.size&&(z.size=I.size))):f=z.createElementNS(f,w),f[_a]=m,f[lp]=I,O7(f,m,!1,!1),m.stateNode=f;e:{switch(z=En(w,I),w){case"dialog":Kn("cancel",f),Kn("close",f),R=I;break;case"iframe":case"object":case"embed":Kn("load",f),R=I;break;case"video":case"audio":for(R=0;R<sp.length;R++)Kn(sp[R],f);R=I;break;case"source":Kn("error",f),R=I;break;case"img":case"image":case"link":Kn("error",f),Kn("load",f),R=I;break;case"details":Kn("toggle",f),R=I;break;case"input":Qe(f,I),R=ot(f,I),Kn("invalid",f);break;case"option":R=I;break;case"select":f._wrapperState={wasMultiple:!!I.multiple},R=W({},I,{value:void 0}),Kn("invalid",f);break;case"textarea":cn(f,I),R=hn(f,I),Kn("invalid",f);break;default:R=I}ir(w,R),J=R;for(P in J)if(J.hasOwnProperty(P)){var oe=J[P];P==="style"?Rt(f,oe):P==="dangerouslySetInnerHTML"?(oe=oe?oe.__html:void 0,oe!=null&&Oe(f,oe)):P==="children"?typeof oe=="string"?(w!=="textarea"||oe!=="")&&xt(f,oe):typeof oe=="number"&&xt(f,""+oe):P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&P!=="autoFocus"&&(o.hasOwnProperty(P)?oe!=null&&P==="onScroll"&&Kn("scroll",f):oe!=null&&S(f,P,oe,z))}switch(w){case"input":Be(f),$t(f,I,!1);break;case"textarea":Be(f),Ht(f);break;case"option":I.value!=null&&f.setAttribute("value",""+Se(I.value));break;case"select":f.multiple=!!I.multiple,P=I.value,P!=null?en(f,!!I.multiple,P,!1):I.defaultValue!=null&&en(f,!!I.multiple,I.defaultValue,!0);break;default:typeof R.onClick=="function"&&(f.onclick=Sg)}switch(w){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return Bo(m),null;case 6:if(f&&m.stateNode!=null)B7(f,m,f.memoizedProps,I);else{if(typeof I!="string"&&m.stateNode===null)throw Error(t(166));if(w=Bu(fp.current),Bu($a.current),Ag(m)){if(I=m.stateNode,w=m.memoizedProps,I[_a]=m,(P=I.nodeValue!==w)&&(f=qs,f!==null))switch(f.tag){case 3:kg(I.nodeValue,w,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&kg(I.nodeValue,w,(f.mode&1)!==0)}P&&(m.flags|=4)}else I=(w.nodeType===9?w:w.ownerDocument).createTextNode(I),I[_a]=m,m.stateNode=I}return Bo(m),null;case 13:if(Xn(lr),I=m.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(nr&&Ks!==null&&(m.mode&1)!==0&&(m.flags&128)===0)z8(),gh(),m.flags|=98560,P=!1;else if(P=Ag(m),I!==null&&I.dehydrated!==null){if(f===null){if(!P)throw Error(t(318));if(P=m.memoizedState,P=P!==null?P.dehydrated:null,!P)throw Error(t(317));P[_a]=m}else gh(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Bo(m),P=!1}else Gi!==null&&(Mb(Gi),Gi=null),P=!0;if(!P)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=w,m):(I=I!==null,I!==(f!==null&&f.memoizedState!==null)&&I&&(m.child.flags|=8192,(m.mode&1)!==0&&(f===null||(lr.current&1)!==0?Ur===0&&(Ur=3):Bb())),m.updateQueue!==null&&(m.flags|=4),Bo(m),null);case 4:return bh(),Nb(f,m),f===null&&ip(m.stateNode.containerInfo),Bo(m),null;case 10:return Jy(m.type._context),Bo(m),null;case 17:return Ss(m.type)&&Ig(),Bo(m),null;case 19:if(Xn(lr),P=m.memoizedState,P===null)return Bo(m),null;if(I=(m.flags&128)!==0,z=P.rendering,z===null)if(I)vp(P,!1);else{if(Ur!==0||f!==null&&(f.flags&128)!==0)for(f=m.child;f!==null;){if(z=Og(f),z!==null){for(m.flags|=128,vp(P,!1),I=z.updateQueue,I!==null&&(m.updateQueue=I,m.flags|=4),m.subtreeFlags=0,I=w,w=m.child;w!==null;)P=w,f=I,P.flags&=14680066,z=P.alternate,z===null?(P.childLanes=0,P.lanes=f,P.child=null,P.subtreeFlags=0,P.memoizedProps=null,P.memoizedState=null,P.updateQueue=null,P.dependencies=null,P.stateNode=null):(P.childLanes=z.childLanes,P.lanes=z.lanes,P.child=z.child,P.subtreeFlags=0,P.deletions=null,P.memoizedProps=z.memoizedProps,P.memoizedState=z.memoizedState,P.updateQueue=z.updateQueue,P.type=z.type,f=z.dependencies,P.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),w=w.sibling;return Un(lr,lr.current&1|2),m.child}f=f.sibling}P.tail!==null&&yn()>Sh&&(m.flags|=128,I=!0,vp(P,!1),m.lanes=4194304)}else{if(!I)if(f=Og(z),f!==null){if(m.flags|=128,I=!0,w=f.updateQueue,w!==null&&(m.updateQueue=w,m.flags|=4),vp(P,!0),P.tail===null&&P.tailMode==="hidden"&&!z.alternate&&!nr)return Bo(m),null}else 2*yn()-P.renderingStartTime>Sh&&w!==1073741824&&(m.flags|=128,I=!0,vp(P,!1),m.lanes=4194304);P.isBackwards?(z.sibling=m.child,m.child=z):(w=P.last,w!==null?w.sibling=z:m.child=z,P.last=z)}return P.tail!==null?(m=P.tail,P.rendering=m,P.tail=m.sibling,P.renderingStartTime=yn(),m.sibling=null,w=lr.current,Un(lr,I?w&1|2:w&1),m):(Bo(m),null);case 22:case 23:return Lb(),I=m.memoizedState!==null,f!==null&&f.memoizedState!==null!==I&&(m.flags|=8192),I&&(m.mode&1)!==0?(Xs&1073741824)!==0&&(Bo(m),m.subtreeFlags&6&&(m.flags|=8192)):Bo(m),null;case 24:return null;case 25:return null}throw Error(t(156,m.tag))}function BB(f,m){switch(qy(m),m.tag){case 1:return Ss(m.type)&&Ig(),f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 3:return bh(),Xn(ks),Xn(Oo),ib(),f=m.flags,(f&65536)!==0&&(f&128)===0?(m.flags=f&-65537|128,m):null;case 5:return ob(m),null;case 13:if(Xn(lr),f=m.memoizedState,f!==null&&f.dehydrated!==null){if(m.alternate===null)throw Error(t(340));gh()}return f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 19:return Xn(lr),null;case 4:return bh(),null;case 10:return Jy(m.type._context),null;case 22:case 23:return Lb(),null;case 24:return null;default:return null}}var Gg=!1,jo=!1,jB=typeof WeakSet=="function"?WeakSet:Set,ut=null;function Ch(f,m){var w=f.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(I){fr(f,m,I)}else w.current=null}function Ib(f,m,w){try{w()}catch(I){fr(f,m,I)}}var j7=!1;function VB(f,m){if(Ly=Ru,f=v8(),Dy(f)){if("selectionStart"in f)var w={start:f.selectionStart,end:f.selectionEnd};else e:{w=(w=f.ownerDocument)&&w.defaultView||window;var I=w.getSelection&&w.getSelection();if(I&&I.rangeCount!==0){w=I.anchorNode;var R=I.anchorOffset,P=I.focusNode;I=I.focusOffset;try{w.nodeType,P.nodeType}catch{w=null;break e}var z=0,J=-1,oe=-1,Ie=0,ze=0,He=f,Ve=null;t:for(;;){for(var it;He!==w||R!==0&&He.nodeType!==3||(J=z+R),He!==P||I!==0&&He.nodeType!==3||(oe=z+I),He.nodeType===3&&(z+=He.nodeValue.length),(it=He.firstChild)!==null;)Ve=He,He=it;for(;;){if(He===f)break t;if(Ve===w&&++Ie===R&&(J=z),Ve===P&&++ze===I&&(oe=z),(it=He.nextSibling)!==null)break;He=Ve,Ve=He.parentNode}He=it}w=J===-1||oe===-1?null:{start:J,end:oe}}else w=null}w=w||{start:0,end:0}}else w=null;for(By={focusedElem:f,selectionRange:w},Ru=!1,ut=m;ut!==null;)if(m=ut,f=m.child,(m.subtreeFlags&1028)!==0&&f!==null)f.return=m,ut=f;else for(;ut!==null;){m=ut;try{var ft=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(ft!==null){var vt=ft.memoizedProps,kr=ft.memoizedState,xe=m.stateNode,ue=xe.getSnapshotBeforeUpdate(m.elementType===m.type?vt:qi(m.type,vt),kr);xe.__reactInternalSnapshotBeforeUpdate=ue}break;case 3:var be=m.stateNode.containerInfo;be.nodeType===1?be.textContent="":be.nodeType===9&&be.documentElement&&be.removeChild(be.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(qe){fr(m,m.return,qe)}if(f=m.sibling,f!==null){f.return=m.return,ut=f;break}ut=m.return}return ft=j7,j7=!1,ft}function yp(f,m,w){var I=m.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var R=I=I.next;do{if((R.tag&f)===f){var P=R.destroy;R.destroy=void 0,P!==void 0&&Ib(m,w,P)}R=R.next}while(R!==I)}}function qg(f,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var w=m=m.next;do{if((w.tag&f)===f){var I=w.create;w.destroy=I()}w=w.next}while(w!==m)}}function Eb(f){var m=f.ref;if(m!==null){var w=f.stateNode;switch(f.tag){case 5:f=w;break;default:f=w}typeof m=="function"?m(f):m.current=f}}function V7(f){var m=f.alternate;m!==null&&(f.alternate=null,V7(m)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(m=f.stateNode,m!==null&&(delete m[_a],delete m[lp],delete m[Wy],delete m[kB],delete m[SB])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function z7(f){return f.tag===5||f.tag===3||f.tag===4}function W7(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||z7(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Tb(f,m,w){var I=f.tag;if(I===5||I===6)f=f.stateNode,m?w.nodeType===8?w.parentNode.insertBefore(f,m):w.insertBefore(f,m):(w.nodeType===8?(m=w.parentNode,m.insertBefore(f,w)):(m=w,m.appendChild(f)),w=w._reactRootContainer,w!=null||m.onclick!==null||(m.onclick=Sg));else if(I!==4&&(f=f.child,f!==null))for(Tb(f,m,w),f=f.sibling;f!==null;)Tb(f,m,w),f=f.sibling}function Rb(f,m,w){var I=f.tag;if(I===5||I===6)f=f.stateNode,m?w.insertBefore(f,m):w.appendChild(f);else if(I!==4&&(f=f.child,f!==null))for(Rb(f,m,w),f=f.sibling;f!==null;)Rb(f,m,w),f=f.sibling}var Co=null,Ki=!1;function Ic(f,m,w){for(w=w.child;w!==null;)U7(f,m,w),w=w.sibling}function U7(f,m,w){if(ts&&typeof ts.onCommitFiberUnmount=="function")try{ts.onCommitFiberUnmount(Li,w)}catch{}switch(w.tag){case 5:jo||Ch(w,m);case 6:var I=Co,R=Ki;Co=null,Ic(f,m,w),Co=I,Ki=R,Co!==null&&(Ki?(f=Co,w=w.stateNode,f.nodeType===8?f.parentNode.removeChild(w):f.removeChild(w)):Co.removeChild(w.stateNode));break;case 18:Co!==null&&(Ki?(f=Co,w=w.stateNode,f.nodeType===8?zy(f.parentNode,w):f.nodeType===1&&zy(f,w),Rn(f)):zy(Co,w.stateNode));break;case 4:I=Co,R=Ki,Co=w.stateNode.containerInfo,Ki=!0,Ic(f,m,w),Co=I,Ki=R;break;case 0:case 11:case 14:case 15:if(!jo&&(I=w.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){R=I=I.next;do{var P=R,z=P.destroy;P=P.tag,z!==void 0&&((P&2)!==0||(P&4)!==0)&&Ib(w,m,z),R=R.next}while(R!==I)}Ic(f,m,w);break;case 1:if(!jo&&(Ch(w,m),I=w.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=w.memoizedProps,I.state=w.memoizedState,I.componentWillUnmount()}catch(J){fr(w,m,J)}Ic(f,m,w);break;case 21:Ic(f,m,w);break;case 22:w.mode&1?(jo=(I=jo)||w.memoizedState!==null,Ic(f,m,w),jo=I):Ic(f,m,w);break;default:Ic(f,m,w)}}function H7(f){var m=f.updateQueue;if(m!==null){f.updateQueue=null;var w=f.stateNode;w===null&&(w=f.stateNode=new jB),m.forEach(function(I){var R=YB.bind(null,f,I);w.has(I)||(w.add(I),I.then(R,R))})}}function Xi(f,m){var w=m.deletions;if(w!==null)for(var I=0;I<w.length;I++){var R=w[I];try{var P=f,z=m,J=z;e:for(;J!==null;){switch(J.tag){case 5:Co=J.stateNode,Ki=!1;break e;case 3:Co=J.stateNode.containerInfo,Ki=!0;break e;case 4:Co=J.stateNode.containerInfo,Ki=!0;break e}J=J.return}if(Co===null)throw Error(t(160));U7(P,z,R),Co=null,Ki=!1;var oe=R.alternate;oe!==null&&(oe.return=null),R.return=null}catch(Ie){fr(R,m,Ie)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)G7(m,f),m=m.sibling}function G7(f,m){var w=f.alternate,I=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(Xi(m,f),Pa(f),I&4){try{yp(3,f,f.return),qg(3,f)}catch(vt){fr(f,f.return,vt)}try{yp(5,f,f.return)}catch(vt){fr(f,f.return,vt)}}break;case 1:Xi(m,f),Pa(f),I&512&&w!==null&&Ch(w,w.return);break;case 5:if(Xi(m,f),Pa(f),I&512&&w!==null&&Ch(w,w.return),f.flags&32){var R=f.stateNode;try{xt(R,"")}catch(vt){fr(f,f.return,vt)}}if(I&4&&(R=f.stateNode,R!=null)){var P=f.memoizedProps,z=w!==null?w.memoizedProps:P,J=f.type,oe=f.updateQueue;if(f.updateQueue=null,oe!==null)try{J==="input"&&P.type==="radio"&&P.name!=null&&ct(R,P),En(J,z);var Ie=En(J,P);for(z=0;z<oe.length;z+=2){var ze=oe[z],He=oe[z+1];ze==="style"?Rt(R,He):ze==="dangerouslySetInnerHTML"?Oe(R,He):ze==="children"?xt(R,He):S(R,ze,He,Ie)}switch(J){case"input":ie(R,P);break;case"textarea":tn(R,P);break;case"select":var Ve=R._wrapperState.wasMultiple;R._wrapperState.wasMultiple=!!P.multiple;var it=P.value;it!=null?en(R,!!P.multiple,it,!1):Ve!==!!P.multiple&&(P.defaultValue!=null?en(R,!!P.multiple,P.defaultValue,!0):en(R,!!P.multiple,P.multiple?[]:"",!1))}R[lp]=P}catch(vt){fr(f,f.return,vt)}}break;case 6:if(Xi(m,f),Pa(f),I&4){if(f.stateNode===null)throw Error(t(162));R=f.stateNode,P=f.memoizedProps;try{R.nodeValue=P}catch(vt){fr(f,f.return,vt)}}break;case 3:if(Xi(m,f),Pa(f),I&4&&w!==null&&w.memoizedState.isDehydrated)try{Rn(m.containerInfo)}catch(vt){fr(f,f.return,vt)}break;case 4:Xi(m,f),Pa(f);break;case 13:Xi(m,f),Pa(f),R=f.child,R.flags&8192&&(P=R.memoizedState!==null,R.stateNode.isHidden=P,!P||R.alternate!==null&&R.alternate.memoizedState!==null||(_b=yn())),I&4&&H7(f);break;case 22:if(ze=w!==null&&w.memoizedState!==null,f.mode&1?(jo=(Ie=jo)||ze,Xi(m,f),jo=Ie):Xi(m,f),Pa(f),I&8192){if(Ie=f.memoizedState!==null,(f.stateNode.isHidden=Ie)&&!ze&&(f.mode&1)!==0)for(ut=f,ze=f.child;ze!==null;){for(He=ut=ze;ut!==null;){switch(Ve=ut,it=Ve.child,Ve.tag){case 0:case 11:case 14:case 15:yp(4,Ve,Ve.return);break;case 1:Ch(Ve,Ve.return);var ft=Ve.stateNode;if(typeof ft.componentWillUnmount=="function"){I=Ve,w=Ve.return;try{m=I,ft.props=m.memoizedProps,ft.state=m.memoizedState,ft.componentWillUnmount()}catch(vt){fr(I,w,vt)}}break;case 5:Ch(Ve,Ve.return);break;case 22:if(Ve.memoizedState!==null){X7(He);continue}}it!==null?(it.return=Ve,ut=it):X7(He)}ze=ze.sibling}e:for(ze=null,He=f;;){if(He.tag===5){if(ze===null){ze=He;try{R=He.stateNode,Ie?(P=R.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none"):(J=He.stateNode,oe=He.memoizedProps.style,z=oe!=null&&oe.hasOwnProperty("display")?oe.display:null,J.style.display=St("display",z))}catch(vt){fr(f,f.return,vt)}}}else if(He.tag===6){if(ze===null)try{He.stateNode.nodeValue=Ie?"":He.memoizedProps}catch(vt){fr(f,f.return,vt)}}else if((He.tag!==22&&He.tag!==23||He.memoizedState===null||He===f)&&He.child!==null){He.child.return=He,He=He.child;continue}if(He===f)break e;for(;He.sibling===null;){if(He.return===null||He.return===f)break e;ze===He&&(ze=null),He=He.return}ze===He&&(ze=null),He.sibling.return=He.return,He=He.sibling}}break;case 19:Xi(m,f),Pa(f),I&4&&H7(f);break;case 21:break;default:Xi(m,f),Pa(f)}}function Pa(f){var m=f.flags;if(m&2){try{e:{for(var w=f.return;w!==null;){if(z7(w)){var I=w;break e}w=w.return}throw Error(t(160))}switch(I.tag){case 5:var R=I.stateNode;I.flags&32&&(xt(R,""),I.flags&=-33);var P=W7(f);Rb(f,P,R);break;case 3:case 4:var z=I.stateNode.containerInfo,J=W7(f);Tb(f,J,z);break;default:throw Error(t(161))}}catch(oe){fr(f,f.return,oe)}f.flags&=-3}m&4096&&(f.flags&=-4097)}function zB(f,m,w){ut=f,q7(f)}function q7(f,m,w){for(var I=(f.mode&1)!==0;ut!==null;){var R=ut,P=R.child;if(R.tag===22&&I){var z=R.memoizedState!==null||Gg;if(!z){var J=R.alternate,oe=J!==null&&J.memoizedState!==null||jo;J=Gg;var Ie=jo;if(Gg=z,(jo=oe)&&!Ie)for(ut=R;ut!==null;)z=ut,oe=z.child,z.tag===22&&z.memoizedState!==null?Y7(R):oe!==null?(oe.return=z,ut=oe):Y7(R);for(;P!==null;)ut=P,q7(P),P=P.sibling;ut=R,Gg=J,jo=Ie}K7(f)}else(R.subtreeFlags&8772)!==0&&P!==null?(P.return=R,ut=P):K7(f)}}function K7(f){for(;ut!==null;){var m=ut;if((m.flags&8772)!==0){var w=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:jo||qg(5,m);break;case 1:var I=m.stateNode;if(m.flags&4&&!jo)if(w===null)I.componentDidMount();else{var R=m.elementType===m.type?w.memoizedProps:qi(m.type,w.memoizedProps);I.componentDidUpdate(R,w.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var P=m.updateQueue;P!==null&&X8(m,P,I);break;case 3:var z=m.updateQueue;if(z!==null){if(w=null,m.child!==null)switch(m.child.tag){case 5:w=m.child.stateNode;break;case 1:w=m.child.stateNode}X8(m,z,w)}break;case 5:var J=m.stateNode;if(w===null&&m.flags&4){w=J;var oe=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":oe.autoFocus&&w.focus();break;case"img":oe.src&&(w.src=oe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var Ie=m.alternate;if(Ie!==null){var ze=Ie.memoizedState;if(ze!==null){var He=ze.dehydrated;He!==null&&Rn(He)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}jo||m.flags&512&&Eb(m)}catch(Ve){fr(m,m.return,Ve)}}if(m===f){ut=null;break}if(w=m.sibling,w!==null){w.return=m.return,ut=w;break}ut=m.return}}function X7(f){for(;ut!==null;){var m=ut;if(m===f){ut=null;break}var w=m.sibling;if(w!==null){w.return=m.return,ut=w;break}ut=m.return}}function Y7(f){for(;ut!==null;){var m=ut;try{switch(m.tag){case 0:case 11:case 15:var w=m.return;try{qg(4,m)}catch(oe){fr(m,w,oe)}break;case 1:var I=m.stateNode;if(typeof I.componentDidMount=="function"){var R=m.return;try{I.componentDidMount()}catch(oe){fr(m,R,oe)}}var P=m.return;try{Eb(m)}catch(oe){fr(m,P,oe)}break;case 5:var z=m.return;try{Eb(m)}catch(oe){fr(m,z,oe)}}}catch(oe){fr(m,m.return,oe)}if(m===f){ut=null;break}var J=m.sibling;if(J!==null){J.return=m.return,ut=J;break}ut=m.return}}var WB=Math.ceil,Kg=k.ReactCurrentDispatcher,Db=k.ReactCurrentOwner,wi=k.ReactCurrentBatchConfig,Cn=0,io=null,Ar=null,ko=0,Xs=0,kh=wc(0),Ur=0,bp=null,Vu=0,Xg=0,Ab=0,wp=null,Is=null,_b=0,Sh=1/0,Ml=null,Yg=!1,$b=null,Ec=null,Zg=!1,Tc=null,Qg=0,Cp=0,Fb=null,Jg=-1,e0=0;function ss(){return(Cn&6)!==0?yn():Jg!==-1?Jg:Jg=yn()}function Rc(f){return(f.mode&1)===0?1:(Cn&2)!==0&&ko!==0?ko&-ko:IB.transition!==null?(e0===0&&(e0=ro()),e0):(f=bn,f!==0||(f=window.event,f=f===void 0?16:ig(f.type)),f)}function Yi(f,m,w,I){if(50<Cp)throw Cp=0,Fb=null,Error(t(185));Cl(f,w,I),((Cn&2)===0||f!==io)&&(f===io&&((Cn&2)===0&&(Xg|=w),Ur===4&&Dc(f,ko)),Es(f,I),w===1&&Cn===0&&(m.mode&1)===0&&(Sh=yn()+500,Tg&&kc()))}function Es(f,m){var w=f.callbackNode;dc(f,m);var I=ys(f,f===io?ko:0);if(I===0)w!==null&&tr(w),f.callbackNode=null,f.callbackPriority=0;else if(m=I&-I,f.callbackPriority!==m){if(w!=null&&tr(w),m===1)f.tag===0?NB(Q7.bind(null,f)):O8(Q7.bind(null,f)),wB(function(){(Cn&6)===0&&kc()}),w=null;else{switch(Vi(I)){case 1:w=wl;break;case 4:w=yo;break;case 16:w=Kd;break;case 536870912:w=Xf;break;default:w=Kd}w=iS(w,Z7.bind(null,f))}f.callbackPriority=m,f.callbackNode=w}}function Z7(f,m){if(Jg=-1,e0=0,(Cn&6)!==0)throw Error(t(327));var w=f.callbackNode;if(Nh()&&f.callbackNode!==w)return null;var I=ys(f,f===io?ko:0);if(I===0)return null;if((I&30)!==0||(I&f.expiredLanes)!==0||m)m=t0(f,I);else{m=I;var R=Cn;Cn|=2;var P=eS();(io!==f||ko!==m)&&(Ml=null,Sh=yn()+500,Wu(f,m));do try{GB();break}catch(J){J7(f,J)}while(!0);Qy(),Kg.current=P,Cn=R,Ar!==null?m=0:(io=null,ko=0,m=Ur)}if(m!==0){if(m===2&&(R=Qf(f),R!==0&&(I=R,m=Pb(f,R))),m===1)throw w=bp,Wu(f,0),Dc(f,I),Es(f,yn()),w;if(m===6)Dc(f,I);else{if(R=f.current.alternate,(I&30)===0&&!UB(R)&&(m=t0(f,I),m===2&&(P=Qf(f),P!==0&&(I=P,m=Pb(f,P))),m===1))throw w=bp,Wu(f,0),Dc(f,I),Es(f,yn()),w;switch(f.finishedWork=R,f.finishedLanes=I,m){case 0:case 1:throw Error(t(345));case 2:Uu(f,Is,Ml);break;case 3:if(Dc(f,I),(I&130023424)===I&&(m=_b+500-yn(),10<m)){if(ys(f,0)!==0)break;if(R=f.suspendedLanes,(R&I)!==I){ss(),f.pingedLanes|=f.suspendedLanes&R;break}f.timeoutHandle=Vy(Uu.bind(null,f,Is,Ml),m);break}Uu(f,Is,Ml);break;case 4:if(Dc(f,I),(I&4194240)===I)break;for(m=f.eventTimes,R=-1;0<I;){var z=31-ns(I);P=1<<z,z=m[z],z>R&&(R=z),I&=~P}if(I=R,I=yn()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*WB(I/1960))-I,10<I){f.timeoutHandle=Vy(Uu.bind(null,f,Is,Ml),I);break}Uu(f,Is,Ml);break;case 5:Uu(f,Is,Ml);break;default:throw Error(t(329))}}}return Es(f,yn()),f.callbackNode===w?Z7.bind(null,f):null}function Pb(f,m){var w=wp;return f.current.memoizedState.isDehydrated&&(Wu(f,m).flags|=256),f=t0(f,m),f!==2&&(m=Is,Is=w,m!==null&&Mb(m)),f}function Mb(f){Is===null?Is=f:Is.push.apply(Is,f)}function UB(f){for(var m=f;;){if(m.flags&16384){var w=m.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var I=0;I<w.length;I++){var R=w[I],P=R.getSnapshot;R=R.value;try{if(!Cr(P(),R))return!1}catch{return!1}}}if(w=m.child,m.subtreeFlags&16384&&w!==null)w.return=m,m=w;else{if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Dc(f,m){for(m&=~Ab,m&=~Xg,f.suspendedLanes|=m,f.pingedLanes&=~m,f=f.expirationTimes;0<m;){var w=31-ns(m),I=1<<w;f[w]=-1,m&=~I}}function Q7(f){if((Cn&6)!==0)throw Error(t(327));Nh();var m=ys(f,0);if((m&1)===0)return Es(f,yn()),null;var w=t0(f,m);if(f.tag!==0&&w===2){var I=Qf(f);I!==0&&(m=I,w=Pb(f,I))}if(w===1)throw w=bp,Wu(f,0),Dc(f,m),Es(f,yn()),w;if(w===6)throw Error(t(345));return f.finishedWork=f.current.alternate,f.finishedLanes=m,Uu(f,Is,Ml),Es(f,yn()),null}function Ob(f,m){var w=Cn;Cn|=1;try{return f(m)}finally{Cn=w,Cn===0&&(Sh=yn()+500,Tg&&kc())}}function zu(f){Tc!==null&&Tc.tag===0&&(Cn&6)===0&&Nh();var m=Cn;Cn|=1;var w=wi.transition,I=bn;try{if(wi.transition=null,bn=1,f)return f()}finally{bn=I,wi.transition=w,Cn=m,(Cn&6)===0&&kc()}}function Lb(){Xs=kh.current,Xn(kh)}function Wu(f,m){f.finishedWork=null,f.finishedLanes=0;var w=f.timeoutHandle;if(w!==-1&&(f.timeoutHandle=-1,bB(w)),Ar!==null)for(w=Ar.return;w!==null;){var I=w;switch(qy(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&Ig();break;case 3:bh(),Xn(ks),Xn(Oo),ib();break;case 5:ob(I);break;case 4:bh();break;case 13:Xn(lr);break;case 19:Xn(lr);break;case 10:Jy(I.type._context);break;case 22:case 23:Lb()}w=w.return}if(io=f,Ar=f=Ac(f.current,null),ko=Xs=m,Ur=0,bp=null,Ab=Xg=Vu=0,Is=wp=null,Lu!==null){for(m=0;m<Lu.length;m++)if(w=Lu[m],I=w.interleaved,I!==null){w.interleaved=null;var R=I.next,P=w.pending;if(P!==null){var z=P.next;P.next=R,I.next=z}w.pending=I}Lu=null}return f}function J7(f,m){do{var w=Ar;try{if(Qy(),Lg.current=zg,Bg){for(var I=cr.memoizedState;I!==null;){var R=I.queue;R!==null&&(R.pending=null),I=I.next}Bg=!1}if(ju=0,so=Wr=cr=null,pp=!1,mp=0,Db.current=null,w===null||w.return===null){Ur=1,bp=m,Ar=null;break}e:{var P=f,z=w.return,J=w,oe=m;if(m=ko,J.flags|=32768,oe!==null&&typeof oe=="object"&&typeof oe.then=="function"){var Ie=oe,ze=J,He=ze.tag;if((ze.mode&1)===0&&(He===0||He===11||He===15)){var Ve=ze.alternate;Ve?(ze.updateQueue=Ve.updateQueue,ze.memoizedState=Ve.memoizedState,ze.lanes=Ve.lanes):(ze.updateQueue=null,ze.memoizedState=null)}var it=S7(z);if(it!==null){it.flags&=-257,N7(it,z,J,P,m),it.mode&1&&k7(P,Ie,m),m=it,oe=Ie;var ft=m.updateQueue;if(ft===null){var vt=new Set;vt.add(oe),m.updateQueue=vt}else ft.add(oe);break e}else{if((m&1)===0){k7(P,Ie,m),Bb();break e}oe=Error(t(426))}}else if(nr&&J.mode&1){var kr=S7(z);if(kr!==null){(kr.flags&65536)===0&&(kr.flags|=256),N7(kr,z,J,P,m),Yy(wh(oe,J));break e}}P=oe=wh(oe,J),Ur!==4&&(Ur=2),wp===null?wp=[P]:wp.push(P),P=z;do{switch(P.tag){case 3:P.flags|=65536,m&=-m,P.lanes|=m;var xe=w7(P,oe,m);K8(P,xe);break e;case 1:J=oe;var ue=P.type,be=P.stateNode;if((P.flags&128)===0&&(typeof ue.getDerivedStateFromError=="function"||be!==null&&typeof be.componentDidCatch=="function"&&(Ec===null||!Ec.has(be)))){P.flags|=65536,m&=-m,P.lanes|=m;var qe=C7(P,J,m);K8(P,qe);break e}}P=P.return}while(P!==null)}nS(w)}catch(bt){m=bt,Ar===w&&w!==null&&(Ar=w=w.return);continue}break}while(!0)}function eS(){var f=Kg.current;return Kg.current=zg,f===null?zg:f}function Bb(){(Ur===0||Ur===3||Ur===2)&&(Ur=4),io===null||(Vu&268435455)===0&&(Xg&268435455)===0||Dc(io,ko)}function t0(f,m){var w=Cn;Cn|=2;var I=eS();(io!==f||ko!==m)&&(Ml=null,Wu(f,m));do try{HB();break}catch(R){J7(f,R)}while(!0);if(Qy(),Cn=w,Kg.current=I,Ar!==null)throw Error(t(261));return io=null,ko=0,Ur}function HB(){for(;Ar!==null;)tS(Ar)}function GB(){for(;Ar!==null&&!Ny();)tS(Ar)}function tS(f){var m=sS(f.alternate,f,Xs);f.memoizedProps=f.pendingProps,m===null?nS(f):Ar=m,Db.current=null}function nS(f){var m=f;do{var w=m.alternate;if(f=m.return,(m.flags&32768)===0){if(w=LB(w,m,Xs),w!==null){Ar=w;return}}else{if(w=BB(w,m),w!==null){w.flags&=32767,Ar=w;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Ur=6,Ar=null;return}}if(m=m.sibling,m!==null){Ar=m;return}Ar=m=f}while(m!==null);Ur===0&&(Ur=5)}function Uu(f,m,w){var I=bn,R=wi.transition;try{wi.transition=null,bn=1,qB(f,m,w,I)}finally{wi.transition=R,bn=I}return null}function qB(f,m,w,I){do Nh();while(Tc!==null);if((Cn&6)!==0)throw Error(t(327));w=f.finishedWork;var R=f.finishedLanes;if(w===null)return null;if(f.finishedWork=null,f.finishedLanes=0,w===f.current)throw Error(t(177));f.callbackNode=null,f.callbackPriority=0;var P=w.lanes|w.childLanes;if(ji(f,P),f===io&&(Ar=io=null,ko=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||Zg||(Zg=!0,iS(Kd,function(){return Nh(),null})),P=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||P){P=wi.transition,wi.transition=null;var z=bn;bn=1;var J=Cn;Cn|=4,Db.current=null,VB(f,w),G7(w,f),fB(By),Ru=!!Ly,By=Ly=null,f.current=w,zB(w),qd(),Cn=J,bn=z,wi.transition=P}else f.current=w;if(Zg&&(Zg=!1,Tc=f,Qg=R),P=f.pendingLanes,P===0&&(Ec=null),Iy(w.stateNode),Es(f,yn()),m!==null)for(I=f.onRecoverableError,w=0;w<m.length;w++)R=m[w],I(R.value,{componentStack:R.stack,digest:R.digest});if(Yg)throw Yg=!1,f=$b,$b=null,f;return(Qg&1)!==0&&f.tag!==0&&Nh(),P=f.pendingLanes,(P&1)!==0?f===Fb?Cp++:(Cp=0,Fb=f):Cp=0,kc(),null}function Nh(){if(Tc!==null){var f=Vi(Qg),m=wi.transition,w=bn;try{if(wi.transition=null,bn=16>f?16:f,Tc===null)var I=!1;else{if(f=Tc,Tc=null,Qg=0,(Cn&6)!==0)throw Error(t(331));var R=Cn;for(Cn|=4,ut=f.current;ut!==null;){var P=ut,z=P.child;if((ut.flags&16)!==0){var J=P.deletions;if(J!==null){for(var oe=0;oe<J.length;oe++){var Ie=J[oe];for(ut=Ie;ut!==null;){var ze=ut;switch(ze.tag){case 0:case 11:case 15:yp(8,ze,P)}var He=ze.child;if(He!==null)He.return=ze,ut=He;else for(;ut!==null;){ze=ut;var Ve=ze.sibling,it=ze.return;if(V7(ze),ze===Ie){ut=null;break}if(Ve!==null){Ve.return=it,ut=Ve;break}ut=it}}}var ft=P.alternate;if(ft!==null){var vt=ft.child;if(vt!==null){ft.child=null;do{var kr=vt.sibling;vt.sibling=null,vt=kr}while(vt!==null)}}ut=P}}if((P.subtreeFlags&2064)!==0&&z!==null)z.return=P,ut=z;else e:for(;ut!==null;){if(P=ut,(P.flags&2048)!==0)switch(P.tag){case 0:case 11:case 15:yp(9,P,P.return)}var xe=P.sibling;if(xe!==null){xe.return=P.return,ut=xe;break e}ut=P.return}}var ue=f.current;for(ut=ue;ut!==null;){z=ut;var be=z.child;if((z.subtreeFlags&2064)!==0&&be!==null)be.return=z,ut=be;else e:for(z=ue;ut!==null;){if(J=ut,(J.flags&2048)!==0)try{switch(J.tag){case 0:case 11:case 15:qg(9,J)}}catch(bt){fr(J,J.return,bt)}if(J===z){ut=null;break e}var qe=J.sibling;if(qe!==null){qe.return=J.return,ut=qe;break e}ut=J.return}}if(Cn=R,kc(),ts&&typeof ts.onPostCommitFiberRoot=="function")try{ts.onPostCommitFiberRoot(Li,f)}catch{}I=!0}return I}finally{bn=w,wi.transition=m}}return!1}function rS(f,m,w){m=wh(w,m),m=w7(f,m,1),f=Nc(f,m,1),m=ss(),f!==null&&(Cl(f,1,m),Es(f,m))}function fr(f,m,w){if(f.tag===3)rS(f,f,w);else for(;m!==null;){if(m.tag===3){rS(m,f,w);break}else if(m.tag===1){var I=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Ec===null||!Ec.has(I))){f=wh(w,f),f=C7(m,f,1),m=Nc(m,f,1),f=ss(),m!==null&&(Cl(m,1,f),Es(m,f));break}}m=m.return}}function KB(f,m,w){var I=f.pingCache;I!==null&&I.delete(m),m=ss(),f.pingedLanes|=f.suspendedLanes&w,io===f&&(ko&w)===w&&(Ur===4||Ur===3&&(ko&130023424)===ko&&500>yn()-_b?Wu(f,0):Ab|=w),Es(f,m)}function oS(f,m){m===0&&((f.mode&1)===0?m=1:(m=Bi,Bi<<=1,(Bi&130023424)===0&&(Bi=4194304)));var w=ss();f=$l(f,m),f!==null&&(Cl(f,m,w),Es(f,w))}function XB(f){var m=f.memoizedState,w=0;m!==null&&(w=m.retryLane),oS(f,w)}function YB(f,m){var w=0;switch(f.tag){case 13:var I=f.stateNode,R=f.memoizedState;R!==null&&(w=R.retryLane);break;case 19:I=f.stateNode;break;default:throw Error(t(314))}I!==null&&I.delete(m),oS(f,w)}var sS;sS=function(f,m,w){if(f!==null)if(f.memoizedProps!==m.pendingProps||ks.current)Ns=!0;else{if((f.lanes&w)===0&&(m.flags&128)===0)return Ns=!1,OB(f,m,w);Ns=(f.flags&131072)!==0}else Ns=!1,nr&&(m.flags&1048576)!==0&&L8(m,Dg,m.index);switch(m.lanes=0,m.tag){case 2:var I=m.type;Hg(f,m),f=m.pendingProps;var R=fh(m,Oo.current);yh(m,w),R=cb(null,m,I,f,R,w);var P=ub();return m.flags|=1,typeof R=="object"&&R!==null&&typeof R.render=="function"&&R.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,Ss(I)?(P=!0,Eg(m)):P=!1,m.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,nb(m),R.updater=Wg,m.stateNode=R,R._reactInternals=m,gb(m,I,f,w),m=bb(null,m,I,!0,P,w)):(m.tag=0,nr&&P&&Gy(m),os(null,m,R,w),m=m.child),m;case 16:I=m.elementType;e:{switch(Hg(f,m),f=m.pendingProps,R=I._init,I=R(I._payload),m.type=I,R=m.tag=QB(I),f=qi(I,f),R){case 0:m=yb(null,m,I,f,w);break e;case 1:m=A7(null,m,I,f,w);break e;case 11:m=I7(null,m,I,f,w);break e;case 14:m=E7(null,m,I,qi(I.type,f),w);break e}throw Error(t(306,I,""))}return m;case 0:return I=m.type,R=m.pendingProps,R=m.elementType===I?R:qi(I,R),yb(f,m,I,R,w);case 1:return I=m.type,R=m.pendingProps,R=m.elementType===I?R:qi(I,R),A7(f,m,I,R,w);case 3:e:{if(_7(m),f===null)throw Error(t(387));I=m.pendingProps,P=m.memoizedState,R=P.element,q8(f,m),Mg(m,I,null,w);var z=m.memoizedState;if(I=z.element,P.isDehydrated)if(P={element:I,isDehydrated:!1,cache:z.cache,pendingSuspenseBoundaries:z.pendingSuspenseBoundaries,transitions:z.transitions},m.updateQueue.baseState=P,m.memoizedState=P,m.flags&256){R=wh(Error(t(423)),m),m=$7(f,m,I,w,R);break e}else if(I!==R){R=wh(Error(t(424)),m),m=$7(f,m,I,w,R);break e}else for(Ks=bc(m.stateNode.containerInfo.firstChild),qs=m,nr=!0,Gi=null,w=H8(m,null,I,w),m.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(gh(),I===R){m=Pl(f,m,w);break e}os(f,m,I,w)}m=m.child}return m;case 5:return Y8(m),f===null&&Xy(m),I=m.type,R=m.pendingProps,P=f!==null?f.memoizedProps:null,z=R.children,jy(I,R)?z=null:P!==null&&jy(I,P)&&(m.flags|=32),D7(f,m),os(f,m,z,w),m.child;case 6:return f===null&&Xy(m),null;case 13:return F7(f,m,w);case 4:return rb(m,m.stateNode.containerInfo),I=m.pendingProps,f===null?m.child=xh(m,null,I,w):os(f,m,I,w),m.child;case 11:return I=m.type,R=m.pendingProps,R=m.elementType===I?R:qi(I,R),I7(f,m,I,R,w);case 7:return os(f,m,m.pendingProps,w),m.child;case 8:return os(f,m,m.pendingProps.children,w),m.child;case 12:return os(f,m,m.pendingProps.children,w),m.child;case 10:e:{if(I=m.type._context,R=m.pendingProps,P=m.memoizedProps,z=R.value,Un($g,I._currentValue),I._currentValue=z,P!==null)if(Cr(P.value,z)){if(P.children===R.children&&!ks.current){m=Pl(f,m,w);break e}}else for(P=m.child,P!==null&&(P.return=m);P!==null;){var J=P.dependencies;if(J!==null){z=P.child;for(var oe=J.firstContext;oe!==null;){if(oe.context===I){if(P.tag===1){oe=Fl(-1,w&-w),oe.tag=2;var Ie=P.updateQueue;if(Ie!==null){Ie=Ie.shared;var ze=Ie.pending;ze===null?oe.next=oe:(oe.next=ze.next,ze.next=oe),Ie.pending=oe}}P.lanes|=w,oe=P.alternate,oe!==null&&(oe.lanes|=w),eb(P.return,w,m),J.lanes|=w;break}oe=oe.next}}else if(P.tag===10)z=P.type===m.type?null:P.child;else if(P.tag===18){if(z=P.return,z===null)throw Error(t(341));z.lanes|=w,J=z.alternate,J!==null&&(J.lanes|=w),eb(z,w,m),z=P.sibling}else z=P.child;if(z!==null)z.return=P;else for(z=P;z!==null;){if(z===m){z=null;break}if(P=z.sibling,P!==null){P.return=z.return,z=P;break}z=z.return}P=z}os(f,m,R.children,w),m=m.child}return m;case 9:return R=m.type,I=m.pendingProps.children,yh(m,w),R=yi(R),I=I(R),m.flags|=1,os(f,m,I,w),m.child;case 14:return I=m.type,R=qi(I,m.pendingProps),R=qi(I.type,R),E7(f,m,I,R,w);case 15:return T7(f,m,m.type,m.pendingProps,w);case 17:return I=m.type,R=m.pendingProps,R=m.elementType===I?R:qi(I,R),Hg(f,m),m.tag=1,Ss(I)?(f=!0,Eg(m)):f=!1,yh(m,w),y7(m,I,R),gb(m,I,R,w),bb(null,m,I,!0,f,w);case 19:return M7(f,m,w);case 22:return R7(f,m,w)}throw Error(t(156,m.tag))};function iS(f,m){return Rr(f,m)}function ZB(f,m,w,I){this.tag=f,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ci(f,m,w,I){return new ZB(f,m,w,I)}function jb(f){return f=f.prototype,!(!f||!f.isReactComponent)}function QB(f){if(typeof f=="function")return jb(f)?1:0;if(f!=null){if(f=f.$$typeof,f===M)return 11;if(f===U)return 14}return 2}function Ac(f,m){var w=f.alternate;return w===null?(w=Ci(f.tag,m,f.key,f.mode),w.elementType=f.elementType,w.type=f.type,w.stateNode=f.stateNode,w.alternate=f,f.alternate=w):(w.pendingProps=m,w.type=f.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=f.flags&14680064,w.childLanes=f.childLanes,w.lanes=f.lanes,w.child=f.child,w.memoizedProps=f.memoizedProps,w.memoizedState=f.memoizedState,w.updateQueue=f.updateQueue,m=f.dependencies,w.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},w.sibling=f.sibling,w.index=f.index,w.ref=f.ref,w}function n0(f,m,w,I,R,P){var z=2;if(I=f,typeof f=="function")jb(f)&&(z=1);else if(typeof f=="string")z=5;else e:switch(f){case _:return Hu(w.children,R,P,m);case $:z=8,R|=8;break;case T:return f=Ci(12,w,m,R|2),f.elementType=T,f.lanes=P,f;case j:return f=Ci(13,w,m,R),f.elementType=j,f.lanes=P,f;case L:return f=Ci(19,w,m,R),f.elementType=L,f.lanes=P,f;case H:return r0(w,R,P,m);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case D:z=10;break e;case A:z=9;break e;case M:z=11;break e;case U:z=14;break e;case G:z=16,I=null;break e}throw Error(t(130,f==null?f:typeof f,""))}return m=Ci(z,w,m,R),m.elementType=f,m.type=I,m.lanes=P,m}function Hu(f,m,w,I){return f=Ci(7,f,I,m),f.lanes=w,f}function r0(f,m,w,I){return f=Ci(22,f,I,m),f.elementType=H,f.lanes=w,f.stateNode={isHidden:!1},f}function Vb(f,m,w){return f=Ci(6,f,null,m),f.lanes=w,f}function zb(f,m,w){return m=Ci(4,f.children!==null?f.children:[],f.key,m),m.lanes=w,m.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},m}function JB(f,m,w,I,R){this.tag=m,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Nu(0),this.expirationTimes=Nu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nu(0),this.identifierPrefix=I,this.onRecoverableError=R,this.mutableSourceEagerHydrationData=null}function Wb(f,m,w,I,R,P,z,J,oe){return f=new JB(f,m,w,J,oe),m===1?(m=1,P===!0&&(m|=8)):m=0,P=Ci(3,null,null,m),f.current=P,P.stateNode=f,P.memoizedState={element:I,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},nb(P),f}function ej(f,m,w){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:E,key:I==null?null:""+I,children:f,containerInfo:m,implementation:w}}function aS(f){if(!f)return Cc;f=f._reactInternals;e:{if(zs(f)!==f||f.tag!==1)throw Error(t(170));var m=f;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(Ss(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(t(171))}if(f.tag===1){var w=f.type;if(Ss(w))return P8(f,w,m)}return m}function lS(f,m,w,I,R,P,z,J,oe){return f=Wb(w,I,!0,f,R,P,z,J,oe),f.context=aS(null),w=f.current,I=ss(),R=Rc(w),P=Fl(I,R),P.callback=m??null,Nc(w,P,R),f.current.lanes=R,Cl(f,R,I),Es(f,I),f}function o0(f,m,w,I){var R=m.current,P=ss(),z=Rc(R);return w=aS(w),m.context===null?m.context=w:m.pendingContext=w,m=Fl(P,z),m.payload={element:f},I=I===void 0?null:I,I!==null&&(m.callback=I),f=Nc(R,m,z),f!==null&&(Yi(f,R,z,P),Pg(f,R,z)),z}function s0(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function cS(f,m){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var w=f.retryLane;f.retryLane=w!==0&&w<m?w:m}}function Ub(f,m){cS(f,m),(f=f.alternate)&&cS(f,m)}function tj(){return null}var uS=typeof reportError=="function"?reportError:function(f){console.error(f)};function Hb(f){this._internalRoot=f}i0.prototype.render=Hb.prototype.render=function(f){var m=this._internalRoot;if(m===null)throw Error(t(409));o0(f,m,null,null)},i0.prototype.unmount=Hb.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var m=f.containerInfo;zu(function(){o0(null,f,null,null)}),m[Rl]=null}};function i0(f){this._internalRoot=f}i0.prototype.unstable_scheduleHydration=function(f){if(f){var m=hc();f={blockedOn:null,target:f,priority:m};for(var w=0;w<Us.length&&m!==0&&m<Us[w].priority;w++);Us.splice(w,0,f),w===0&&Zd(f)}};function Gb(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function a0(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function dS(){}function nj(f,m,w,I,R){if(R){if(typeof I=="function"){var P=I;I=function(){var Ie=s0(z);P.call(Ie)}}var z=lS(m,I,f,0,null,!1,!1,"",dS);return f._reactRootContainer=z,f[Rl]=z.current,ip(f.nodeType===8?f.parentNode:f),zu(),z}for(;R=f.lastChild;)f.removeChild(R);if(typeof I=="function"){var J=I;I=function(){var Ie=s0(oe);J.call(Ie)}}var oe=Wb(f,0,!1,null,null,!1,!1,"",dS);return f._reactRootContainer=oe,f[Rl]=oe.current,ip(f.nodeType===8?f.parentNode:f),zu(function(){o0(m,oe,w,I)}),oe}function l0(f,m,w,I,R){var P=w._reactRootContainer;if(P){var z=P;if(typeof R=="function"){var J=R;R=function(){var oe=s0(z);J.call(oe)}}o0(m,z,f,R)}else z=nj(w,m,f,R,I);return s0(z)}Jf=function(f){switch(f.tag){case 3:var m=f.stateNode;if(m.current.memoizedState.isDehydrated){var w=ba(m.pendingLanes);w!==0&&(Xd(m,w|1),Es(m,yn()),(Cn&6)===0&&(Sh=yn()+500,kc()))}break;case 13:zu(function(){var I=$l(f,1);if(I!==null){var R=ss();Yi(I,f,1,R)}}),Ub(f,1)}},Yd=function(f){if(f.tag===13){var m=$l(f,134217728);if(m!==null){var w=ss();Yi(m,f,134217728,w)}Ub(f,134217728)}},Iu=function(f){if(f.tag===13){var m=Rc(f),w=$l(f,m);if(w!==null){var I=ss();Yi(w,f,m,I)}Ub(f,m)}},hc=function(){return bn},Dr=function(f,m){var w=bn;try{return bn=f,m()}finally{bn=w}},gs=function(f,m,w){switch(m){case"input":if(ie(f,w),m=w.name,w.type==="radio"&&m!=null){for(w=f;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<w.length;m++){var I=w[m];if(I!==f&&I.form===f.form){var R=Ng(I);if(!R)throw Error(t(90));Xe(I),ie(I,R)}}}break;case"textarea":tn(f,w);break;case"select":m=w.value,m!=null&&en(f,!!w.multiple,m,!1)}},un=Ob,Pt=zu;var rj={usingClientEntryPoint:!1,Events:[cp,dh,Ng,Vs,Ft,Ob]},kp={findFiberByHostInstance:Fu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},oj={bundleType:kp.bundleType,version:kp.version,rendererPackageName:kp.rendererPackageName,rendererConfig:kp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=hi(f),f===null?null:f.stateNode},findFiberByHostInstance:kp.findFiberByHostInstance||tj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var c0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!c0.isDisabled&&c0.supportsFiber)try{Li=c0.inject(oj),ts=c0}catch{}}return Ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rj,Ts.createPortal=function(f,m){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gb(m))throw Error(t(200));return ej(f,m,null,w)},Ts.createRoot=function(f,m){if(!Gb(f))throw Error(t(299));var w=!1,I="",R=uS;return m!=null&&(m.unstable_strictMode===!0&&(w=!0),m.identifierPrefix!==void 0&&(I=m.identifierPrefix),m.onRecoverableError!==void 0&&(R=m.onRecoverableError)),m=Wb(f,1,!1,null,null,w,!1,I,R),f[Rl]=m.current,ip(f.nodeType===8?f.parentNode:f),new Hb(m)},Ts.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var m=f._reactInternals;if(m===void 0)throw typeof f.render=="function"?Error(t(188)):(f=Object.keys(f).join(","),Error(t(268,f)));return f=hi(m),f=f===null?null:f.stateNode,f},Ts.flushSync=function(f){return zu(f)},Ts.hydrate=function(f,m,w){if(!a0(m))throw Error(t(200));return l0(null,f,m,!0,w)},Ts.hydrateRoot=function(f,m,w){if(!Gb(f))throw Error(t(405));var I=w!=null&&w.hydratedSources||null,R=!1,P="",z=uS;if(w!=null&&(w.unstable_strictMode===!0&&(R=!0),w.identifierPrefix!==void 0&&(P=w.identifierPrefix),w.onRecoverableError!==void 0&&(z=w.onRecoverableError)),m=lS(m,null,f,1,w??null,R,!1,P,z),f[Rl]=m.current,ip(f),I)for(f=0;f<I.length;f++)w=I[f],R=w._getVersion,R=R(w._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[w,R]:m.mutableSourceEagerHydrationData.push(w,R);return new i0(m)},Ts.render=function(f,m,w){if(!a0(m))throw Error(t(200));return l0(null,f,m,!1,w)},Ts.unmountComponentAtNode=function(f){if(!a0(f))throw Error(t(40));return f._reactRootContainer?(zu(function(){l0(null,null,f,!1,function(){f._reactRootContainer=null,f[Rl]=null})}),!0):!1},Ts.unstable_batchedUpdates=Ob,Ts.unstable_renderSubtreeIntoContainer=function(f,m,w,I){if(!a0(w))throw Error(t(200));if(f==null||f._reactInternals===void 0)throw Error(t(38));return l0(f,m,w,!1,I)},Ts.version="18.3.1-next-f1338f8080-20240426",Ts}var bS;function M9(){if(bS)return Zb.exports;bS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Zb.exports=vj(),Zb.exports}var xv=M9();const O9=gv(xv);function rr(n,e,{checkForDefaultPrevented:t=!0}={}){return function(o){if(n?.(o),t===!1||!o.defaultPrevented)return e?.(o)}}function wS(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function L9(...n){return e=>{let t=!1;const r=n.map(o=>{const s=wS(o,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():wS(n[o],null)}}}}function hs(...n){return F.useCallback(L9(...n),n)}function yj(n,e){const t=F.createContext(e),r=s=>{const{children:i,...a}=s,l=F.useMemo(()=>a,Object.values(a));return v.jsx(t.Provider,{value:l,children:i})};r.displayName=n+"Provider";function o(s){const i=F.useContext(t);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${n}\``)}return[r,o]}function Im(n,e=[]){let t=[];function r(s,i){const a=F.createContext(i),l=t.length;t=[...t,i];const c=d=>{const{scope:h,children:p,...g}=d,x=h?.[n]?.[l]||a,y=F.useMemo(()=>g,Object.values(g));return v.jsx(x.Provider,{value:y,children:p})};c.displayName=s+"Provider";function u(d,h){const p=h?.[n]?.[l]||a,g=F.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=t.map(i=>F.createContext(i));return function(a){const l=a?.[n]||s;return F.useMemo(()=>({[`__scope${n}`]:{...a,[n]:l}}),[a,l])}};return o.scopeName=n,[r,bj(o,...e)]}function bj(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return F.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function Qp(n){const e=Cj(n),t=F.forwardRef((r,o)=>{const{children:s,...i}=r,a=F.Children.toArray(s),l=a.find(Sj);if(l){const c=l.props.children,u=a.map(d=>d===l?F.Children.count(c)>1?F.Children.only(null):F.isValidElement(c)?c.props.children:null:d);return v.jsx(e,{...i,ref:o,children:F.isValidElement(c)?F.cloneElement(c,void 0,u):null})}return v.jsx(e,{...i,ref:o,children:s})});return t.displayName=`${n}.Slot`,t}var wj=Qp("Slot");function Cj(n){const e=F.forwardRef((t,r)=>{const{children:o,...s}=t;if(F.isValidElement(o)){const i=Ij(o),a=Nj(s,o.props);return o.type!==F.Fragment&&(a.ref=r?L9(r,i):i),F.cloneElement(o,a)}return F.Children.count(o)>1?F.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var B9=Symbol("radix.slottable");function kj(n){const e=({children:t})=>v.jsx(v.Fragment,{children:t});return e.displayName=`${n}.Slottable`,e.__radixId=B9,e}function Sj(n){return F.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===B9}function Nj(n,e){const t={...e};for(const r in e){const o=n[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?t[r]=(...a)=>{const l=s(...a);return o(...a),l}:o&&(t[r]=o):r==="style"?t[r]={...o,...s}:r==="className"&&(t[r]=[o,s].filter(Boolean).join(" "))}return{...n,...t}}function Ij(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function Ej(n){const e=n+"CollectionProvider",[t,r]=Im(e),[o,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),i=x=>{const{scope:y,children:b}=x,C=Ke.useRef(null),S=Ke.useRef(new Map).current;return v.jsx(o,{scope:y,itemMap:S,collectionRef:C,children:b})};i.displayName=e;const a=n+"CollectionSlot",l=Qp(a),c=Ke.forwardRef((x,y)=>{const{scope:b,children:C}=x,S=s(a,b),k=hs(y,S.collectionRef);return v.jsx(l,{ref:k,children:C})});c.displayName=a;const u=n+"CollectionItemSlot",d="data-radix-collection-item",h=Qp(u),p=Ke.forwardRef((x,y)=>{const{scope:b,children:C,...S}=x,k=Ke.useRef(null),N=hs(y,k),E=s(u,b);return Ke.useEffect(()=>(E.itemMap.set(k,{ref:k,...S}),()=>void E.itemMap.delete(k))),v.jsx(h,{[d]:"",ref:N,children:C})});p.displayName=u;function g(x){const y=s(n+"CollectionConsumer",x);return Ke.useCallback(()=>{const C=y.collectionRef.current;if(!C)return[];const S=Array.from(C.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((E,_)=>S.indexOf(E.ref.current)-S.indexOf(_.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:i,Slot:c,ItemSlot:p},g,r]}var Tj=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Br=Tj.reduce((n,e)=>{const t=Qp(`Primitive.${e}`),r=F.forwardRef((o,s)=>{const{asChild:i,...a}=o,l=i?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),v.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...n,[e]:r}},{});function j9(n,e){n&&xv.flushSync(()=>n.dispatchEvent(e))}function al(n){const e=F.useRef(n);return F.useEffect(()=>{e.current=n}),F.useMemo(()=>(...t)=>e.current?.(...t),[])}function Rj(n,e=globalThis?.document){const t=al(n);F.useEffect(()=>{const r=o=>{o.key==="Escape"&&t(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var Dj="DismissableLayer",F3="dismissableLayer.update",Aj="dismissableLayer.pointerDownOutside",_j="dismissableLayer.focusOutside",CS,V9=F.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),vv=F.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=n,c=F.useContext(V9),[u,d]=F.useState(null),h=u?.ownerDocument??globalThis?.document,[,p]=F.useState({}),g=hs(e,_=>d(_)),x=Array.from(c.layers),[y]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),b=x.indexOf(y),C=u?x.indexOf(u):-1,S=c.layersWithOutsidePointerEventsDisabled.size>0,k=C>=b,N=Fj(_=>{const $=_.target,T=[...c.branches].some(D=>D.contains($));!k||T||(o?.(_),i?.(_),_.defaultPrevented||a?.())},h),E=Pj(_=>{const $=_.target;[...c.branches].some(D=>D.contains($))||(s?.(_),i?.(_),_.defaultPrevented||a?.())},h);return Rj(_=>{C===c.layers.size-1&&(r?.(_),!_.defaultPrevented&&a&&(_.preventDefault(),a()))},h),F.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(CS=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),kS(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=CS)}},[u,h,t,c]),F.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),kS())},[u,c]),F.useEffect(()=>{const _=()=>p({});return document.addEventListener(F3,_),()=>document.removeEventListener(F3,_)},[]),v.jsx(Br.div,{...l,ref:g,style:{pointerEvents:S?k?"auto":"none":void 0,...n.style},onFocusCapture:rr(n.onFocusCapture,E.onFocusCapture),onBlurCapture:rr(n.onBlurCapture,E.onBlurCapture),onPointerDownCapture:rr(n.onPointerDownCapture,N.onPointerDownCapture)})});vv.displayName=Dj;var $j="DismissableLayerBranch",z9=F.forwardRef((n,e)=>{const t=F.useContext(V9),r=F.useRef(null),o=hs(e,r);return F.useEffect(()=>{const s=r.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),v.jsx(Br.div,{...n,ref:o})});z9.displayName=$j;function Fj(n,e=globalThis?.document){const t=al(n),r=F.useRef(!1),o=F.useRef(()=>{});return F.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){W9(Aj,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function Pj(n,e=globalThis?.document){const t=al(n),r=F.useRef(!1);return F.useEffect(()=>{const o=s=>{s.target&&!r.current&&W9(_j,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function kS(){const n=new CustomEvent(F3);document.dispatchEvent(n)}function W9(n,e,t,{discrete:r}){const o=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&o.addEventListener(n,e,{once:!0}),r?j9(o,s):o.dispatchEvent(s)}var Mj=vv,Oj=z9,ql=globalThis?.document?F.useLayoutEffect:()=>{},Lj="Portal",l4=F.forwardRef((n,e)=>{const{container:t,...r}=n,[o,s]=F.useState(!1);ql(()=>s(!0),[]);const i=t||o&&globalThis?.document?.body;return i?O9.createPortal(v.jsx(Br.div,{...r,ref:e}),i):null});l4.displayName=Lj;function Bj(n,e){return F.useReducer((t,r)=>e[t][r]??t,n)}var Sf=n=>{const{present:e,children:t}=n,r=jj(e),o=typeof t=="function"?t({present:r.isPresent}):F.Children.only(t),s=hs(r.ref,Vj(o));return typeof t=="function"||r.isPresent?F.cloneElement(o,{ref:s}):null};Sf.displayName="Presence";function jj(n){const[e,t]=F.useState(),r=F.useRef(null),o=F.useRef(n),s=F.useRef("none"),i=n?"mounted":"unmounted",[a,l]=Bj(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return F.useEffect(()=>{const c=u0(r.current);s.current=a==="mounted"?c:"none"},[a]),ql(()=>{const c=r.current,u=o.current;if(u!==n){const h=s.current,p=u0(c);n?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=n}},[n,l]),ql(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const x=u0(r.current).includes(CSS.escape(p.animationName));if(p.target===e&&x&&(l("ANIMATION_END"),!o.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},h=p=>{p.target===e&&(s.current=u0(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:F.useCallback(c=>{r.current=c?getComputedStyle(c):null,t(c)},[])}}function u0(n){return n?.animationName||"none"}function Vj(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var zj=a4[" useInsertionEffect ".trim().toString()]||ql;function U9({prop:n,defaultProp:e,onChange:t=()=>{},caller:r}){const[o,s,i]=Wj({defaultProp:e,onChange:t}),a=n!==void 0,l=a?n:o;{const u=F.useRef(n!==void 0);F.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=F.useCallback(u=>{if(a){const d=Uj(u)?u(n):u;d!==n&&i.current?.(d)}else s(u)},[a,n,s,i]);return[l,c]}function Wj({defaultProp:n,onChange:e}){const[t,r]=F.useState(n),o=F.useRef(t),s=F.useRef(e);return zj(()=>{s.current=e},[e]),F.useEffect(()=>{o.current!==t&&(s.current?.(t),o.current=t)},[t,o]),[t,r,s]}function Uj(n){return typeof n=="function"}var Hj=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Gj="VisuallyHidden",yv=F.forwardRef((n,e)=>v.jsx(Br.span,{...n,ref:e,style:{...Hj,...n.style}}));yv.displayName=Gj;var qj=yv,c4="ToastProvider",[u4,Kj,Xj]=Ej("Toast"),[H9]=Im("Toast",[Xj]),[Yj,bv]=H9(c4),G9=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:o="right",swipeThreshold:s=50,children:i}=n,[a,l]=F.useState(null),[c,u]=F.useState(0),d=F.useRef(!1),h=F.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${c4}\`. Expected non-empty \`string\`.`),v.jsx(u4.Provider,{scope:e,children:v.jsx(Yj,{scope:e,label:t,duration:r,swipeDirection:o,swipeThreshold:s,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:F.useCallback(()=>u(p=>p+1),[]),onToastRemove:F.useCallback(()=>u(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h,children:i})})};G9.displayName=c4;var q9="ToastViewport",Zj=["F8"],P3="toast.viewportPause",M3="toast.viewportResume",K9=F.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=Zj,label:o="Notifications ({hotkey})",...s}=n,i=bv(q9,t),a=Kj(t),l=F.useRef(null),c=F.useRef(null),u=F.useRef(null),d=F.useRef(null),h=hs(e,d,i.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=i.toastCount>0;F.useEffect(()=>{const y=b=>{r.length!==0&&r.every(S=>b[S]||b.code===S)&&d.current?.focus()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[r]),F.useEffect(()=>{const y=l.current,b=d.current;if(g&&y&&b){const C=()=>{if(!i.isClosePausedRef.current){const E=new CustomEvent(P3);b.dispatchEvent(E),i.isClosePausedRef.current=!0}},S=()=>{if(i.isClosePausedRef.current){const E=new CustomEvent(M3);b.dispatchEvent(E),i.isClosePausedRef.current=!1}},k=E=>{!y.contains(E.relatedTarget)&&S()},N=()=>{y.contains(document.activeElement)||S()};return y.addEventListener("focusin",C),y.addEventListener("focusout",k),y.addEventListener("pointermove",C),y.addEventListener("pointerleave",N),window.addEventListener("blur",C),window.addEventListener("focus",S),()=>{y.removeEventListener("focusin",C),y.removeEventListener("focusout",k),y.removeEventListener("pointermove",C),y.removeEventListener("pointerleave",N),window.removeEventListener("blur",C),window.removeEventListener("focus",S)}}},[g,i.isClosePausedRef]);const x=F.useCallback(({tabbingDirection:y})=>{const C=a().map(S=>{const k=S.ref.current,N=[k,...uV(k)];return y==="forwards"?N:N.reverse()});return(y==="forwards"?C.reverse():C).flat()},[a]);return F.useEffect(()=>{const y=d.current;if(y){const b=C=>{const S=C.altKey||C.ctrlKey||C.metaKey;if(C.key==="Tab"&&!S){const N=document.activeElement,E=C.shiftKey;if(C.target===y&&E){c.current?.focus();return}const T=x({tabbingDirection:E?"backwards":"forwards"}),D=T.findIndex(A=>A===N);ew(T.slice(D+1))?C.preventDefault():E?c.current?.focus():u.current?.focus()}};return y.addEventListener("keydown",b),()=>y.removeEventListener("keydown",b)}},[a,x]),v.jsxs(Oj,{ref:l,role:"region","aria-label":o.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:g?void 0:"none"},children:[g&&v.jsx(O3,{ref:c,onFocusFromOutsideViewport:()=>{const y=x({tabbingDirection:"forwards"});ew(y)}}),v.jsx(u4.Slot,{scope:t,children:v.jsx(Br.ol,{tabIndex:-1,...s,ref:h})}),g&&v.jsx(O3,{ref:u,onFocusFromOutsideViewport:()=>{const y=x({tabbingDirection:"backwards"});ew(y)}})]})});K9.displayName=q9;var X9="ToastFocusProxy",O3=F.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...o}=n,s=bv(X9,t);return v.jsx(yv,{tabIndex:0,...o,ref:e,style:{position:"fixed"},onFocus:i=>{const a=i.relatedTarget;!s.viewport?.contains(a)&&r()}})});O3.displayName=X9;var Em="Toast",Qj="toast.swipeStart",Jj="toast.swipeMove",eV="toast.swipeCancel",tV="toast.swipeEnd",Y9=F.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:o,onOpenChange:s,...i}=n,[a,l]=U9({prop:r,defaultProp:o??!0,onChange:s,caller:Em});return v.jsx(Sf,{present:t||a,children:v.jsx(oV,{open:a,...i,ref:e,onClose:()=>l(!1),onPause:al(n.onPause),onResume:al(n.onResume),onSwipeStart:rr(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:rr(n.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:rr(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:rr(n.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});Y9.displayName=Em;var[nV,rV]=H9(Em,{onClose(){}}),oV=F.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:o,open:s,onClose:i,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:p,...g}=n,x=bv(Em,t),[y,b]=F.useState(null),C=hs(e,L=>b(L)),S=F.useRef(null),k=F.useRef(null),N=o||x.duration,E=F.useRef(0),_=F.useRef(N),$=F.useRef(0),{onToastAdd:T,onToastRemove:D}=x,A=al(()=>{y?.contains(document.activeElement)&&x.viewport?.focus(),i()}),M=F.useCallback(L=>{!L||L===1/0||(window.clearTimeout($.current),E.current=new Date().getTime(),$.current=window.setTimeout(A,L))},[A]);F.useEffect(()=>{const L=x.viewport;if(L){const U=()=>{M(_.current),c?.()},G=()=>{const H=new Date().getTime()-E.current;_.current=_.current-H,window.clearTimeout($.current),l?.()};return L.addEventListener(P3,G),L.addEventListener(M3,U),()=>{L.removeEventListener(P3,G),L.removeEventListener(M3,U)}}},[x.viewport,N,l,c,M]),F.useEffect(()=>{s&&!x.isClosePausedRef.current&&M(N)},[s,N,x.isClosePausedRef,M]),F.useEffect(()=>(T(),()=>D()),[T,D]);const j=F.useMemo(()=>y?rT(y):null,[y]);return x.viewport?v.jsxs(v.Fragment,{children:[j&&v.jsx(sV,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite",children:j}),v.jsx(nV,{scope:t,onClose:A,children:xv.createPortal(v.jsx(u4.ItemSlot,{scope:t,children:v.jsx(Mj,{asChild:!0,onEscapeKeyDown:rr(a,()=>{x.isFocusedToastEscapeKeyDownRef.current||A(),x.isFocusedToastEscapeKeyDownRef.current=!1}),children:v.jsx(Br.li,{tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":x.swipeDirection,...g,ref:C,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:rr(n.onKeyDown,L=>{L.key==="Escape"&&(a?.(L.nativeEvent),L.nativeEvent.defaultPrevented||(x.isFocusedToastEscapeKeyDownRef.current=!0,A()))}),onPointerDown:rr(n.onPointerDown,L=>{L.button===0&&(S.current={x:L.clientX,y:L.clientY})}),onPointerMove:rr(n.onPointerMove,L=>{if(!S.current)return;const U=L.clientX-S.current.x,G=L.clientY-S.current.y,H=!!k.current,O=["left","right"].includes(x.swipeDirection),V=["left","up"].includes(x.swipeDirection)?Math.min:Math.max,W=O?V(0,U):0,B=O?0:V(0,G),q=L.pointerType==="touch"?10:2,Q={x:W,y:B},Z={originalEvent:L,delta:Q};H?(k.current=Q,d0(Jj,d,Z,{discrete:!1})):SS(Q,x.swipeDirection,q)?(k.current=Q,d0(Qj,u,Z,{discrete:!1}),L.target.setPointerCapture(L.pointerId)):(Math.abs(U)>q||Math.abs(G)>q)&&(S.current=null)}),onPointerUp:rr(n.onPointerUp,L=>{const U=k.current,G=L.target;if(G.hasPointerCapture(L.pointerId)&&G.releasePointerCapture(L.pointerId),k.current=null,S.current=null,U){const H=L.currentTarget,O={originalEvent:L,delta:U};SS(U,x.swipeDirection,x.swipeThreshold)?d0(tV,p,O,{discrete:!0}):d0(eV,h,O,{discrete:!0}),H.addEventListener("click",V=>V.preventDefault(),{once:!0})}})})})}),x.viewport)})]}):null}),sV=n=>{const{__scopeToast:e,children:t,...r}=n,o=bv(Em,e),[s,i]=F.useState(!1),[a,l]=F.useState(!1);return lV(()=>i(!0)),F.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:v.jsx(l4,{asChild:!0,children:v.jsx(yv,{...r,children:s&&v.jsxs(v.Fragment,{children:[o.label," ",t]})})})},iV="ToastTitle",Z9=F.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return v.jsx(Br.div,{...r,ref:e})});Z9.displayName=iV;var aV="ToastDescription",Q9=F.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return v.jsx(Br.div,{...r,ref:e})});Q9.displayName=aV;var J9="ToastAction",eT=F.forwardRef((n,e)=>{const{altText:t,...r}=n;return t.trim()?v.jsx(nT,{altText:t,asChild:!0,children:v.jsx(d4,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${J9}\`. Expected non-empty \`string\`.`),null)});eT.displayName=J9;var tT="ToastClose",d4=F.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,o=rV(tT,t);return v.jsx(nT,{asChild:!0,children:v.jsx(Br.button,{type:"button",...r,ref:e,onClick:rr(n.onClick,o.onClose)})})});d4.displayName=tT;var nT=F.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...o}=n;return v.jsx(Br.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...o,ref:e})});function rT(n){const e=[];return Array.from(n.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),cV(r)){const o=r.ariaHidden||r.hidden||r.style.display==="none",s=r.dataset.radixToastAnnounceExclude==="";if(!o)if(s){const i=r.dataset.radixToastAnnounceAlt;i&&e.push(i)}else e.push(...rT(r))}}),e}function d0(n,e,t,{discrete:r}){const o=t.originalEvent.currentTarget,s=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&o.addEventListener(n,e,{once:!0}),r?j9(o,s):o.dispatchEvent(s)}var SS=(n,e,t=0)=>{const r=Math.abs(n.x),o=Math.abs(n.y),s=r>o;return e==="left"||e==="right"?s&&r>t:!s&&o>t};function lV(n=()=>{}){const e=al(n);ql(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function cV(n){return n.nodeType===n.ELEMENT_NODE}function uV(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function ew(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var dV=G9,oT=K9,sT=Y9,iT=Z9,aT=Q9,lT=eT,cT=d4;function uT(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var o=n.length;for(e=0;e<o;e++)n[e]&&(t=uT(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function dT(){for(var n,e,t=0,r="",o=arguments.length;t<o;t++)(n=arguments[t])&&(e=uT(n))&&(r&&(r+=" "),r+=e);return r}const NS=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,IS=dT,hT=(n,e)=>t=>{var r;if(e?.variants==null)return IS(n,t?.class,t?.className);const{variants:o,defaultVariants:s}=e,i=Object.keys(o).map(c=>{const u=t?.[c],d=s?.[c];if(u===null)return null;const h=NS(u)||NS(d);return o[c][h]}),a=t&&Object.entries(t).reduce((c,u)=>{let[d,h]=u;return h===void 0||(c[d]=h),c},{}),l=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,u)=>{let{class:d,className:h,...p}=u;return Object.entries(p).every(g=>{let[x,y]=g;return Array.isArray(y)?y.includes({...s,...a}[x]):{...s,...a}[x]===y})?[...c,d,h]:c},[]);return IS(n,i,l,t?.class,t?.className)};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hV=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),fV=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),ES=n=>{const e=fV(n);return e.charAt(0).toUpperCase()+e.slice(1)},fT=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),pV=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var mV={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gV=F.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:o="",children:s,iconNode:i,...a},l)=>F.createElement("svg",{ref:l,...mV,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:fT("lucide",o),...!s&&!pV(a)&&{"aria-hidden":"true"},...a},[...i.map(([c,u])=>F.createElement(c,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xV=(n,e)=>{const t=F.forwardRef(({className:r,...o},s)=>F.createElement(gV,{ref:s,iconNode:e,className:fT(`lucide-${hV(ES(n))}`,`lucide-${n}`,r),...o}));return t.displayName=ES(n),t};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vV=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],pT=xV("x",vV),h4="-",yV=n=>{const e=wV(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:i=>{const a=i.split(h4);return a[0]===""&&a.length!==1&&a.shift(),mT(a,e)||bV(i)},getConflictingClassGroupIds:(i,a)=>{const l=t[i]||[];return a&&r[i]?[...l,...r[i]]:l}}},mT=(n,e)=>{if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),o=r?mT(n.slice(1),r):void 0;if(o)return o;if(e.validators.length===0)return;const s=n.join(h4);return e.validators.find(({validator:i})=>i(s))?.classGroupId},TS=/^\[(.+)\]$/,bV=n=>{if(TS.test(n)){const e=TS.exec(n)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},wV=n=>{const{theme:e,prefix:t}=n,r={nextPart:new Map,validators:[]};return kV(Object.entries(n.classGroups),t).forEach(([s,i])=>{L3(i,r,s,e)}),r},L3=(n,e,t,r)=>{n.forEach(o=>{if(typeof o=="string"){const s=o===""?e:RS(e,o);s.classGroupId=t;return}if(typeof o=="function"){if(CV(o)){L3(o(r),e,t,r);return}e.validators.push({validator:o,classGroupId:t});return}Object.entries(o).forEach(([s,i])=>{L3(i,RS(e,s),t,r)})})},RS=(n,e)=>{let t=n;return e.split(h4).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},CV=n=>n.isThemeGetter,kV=(n,e)=>e?n.map(([t,r])=>{const o=r.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[t,o]}):n,SV=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const o=(s,i)=>{t.set(s,i),e++,e>n&&(e=0,r=t,t=new Map)};return{get(s){let i=t.get(s);if(i!==void 0)return i;if((i=r.get(s))!==void 0)return o(s,i),i},set(s,i){t.has(s)?t.set(s,i):o(s,i)}}},gT="!",NV=n=>{const{separator:e,experimentalParseClassName:t}=n,r=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let y=0;y<a.length;y++){let b=a[y];if(c===0){if(b===o&&(r||a.slice(y,y+s)===e)){l.push(a.slice(u,y)),u=y+s;continue}if(b==="/"){d=y;continue}}b==="["?c++:b==="]"&&c--}const h=l.length===0?a:a.substring(u),p=h.startsWith(gT),g=p?h.substring(1):h,x=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:x}};return t?a=>t({className:a,parseClassName:i}):i},IV=n=>{if(n.length<=1)return n;const e=[];let t=[];return n.forEach(r=>{r[0]==="["?(e.push(...t.sort(),r),t=[]):t.push(r)}),e.push(...t.sort()),e},EV=n=>({cache:SV(n.cacheSize),parseClassName:NV(n),...yV(n)}),TV=/\s+/,RV=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:o}=e,s=[],i=n.trim().split(TV);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:p}=t(c);let g=!!p,x=r(g?h.substring(0,p):h);if(!x){if(!g){a=c+(a.length>0?" "+a:a);continue}if(x=r(h),!x){a=c+(a.length>0?" "+a:a);continue}g=!1}const y=IV(u).join(":"),b=d?y+gT:y,C=b+x;if(s.includes(C))continue;s.push(C);const S=o(x,g);for(let k=0;k<S.length;++k){const N=S[k];s.push(b+N)}a=c+(a.length>0?" "+a:a)}return a};function DV(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=xT(e))&&(r&&(r+=" "),r+=t);return r}const xT=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=xT(n[r]))&&(t&&(t+=" "),t+=e);return t};function AV(n,...e){let t,r,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),n());return t=EV(c),r=t.cache.get,o=t.cache.set,s=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=RV(l,t);return o(l,u),u}return function(){return s(DV.apply(null,arguments))}}const Yn=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},vT=/^\[(?:([a-z-]+):)?(.+)\]$/i,_V=/^\d+\/\d+$/,$V=new Set(["px","full","screen"]),FV=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,PV=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,MV=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,OV=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,LV=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ol=n=>Uh(n)||$V.has(n)||_V.test(n),$c=n=>Nf(n,"length",GV),Uh=n=>!!n&&!Number.isNaN(Number(n)),tw=n=>Nf(n,"number",Uh),Np=n=>!!n&&Number.isInteger(Number(n)),BV=n=>n.endsWith("%")&&Uh(n.slice(0,-1)),Kt=n=>vT.test(n),Fc=n=>FV.test(n),jV=new Set(["length","size","percentage"]),VV=n=>Nf(n,jV,yT),zV=n=>Nf(n,"position",yT),WV=new Set(["image","url"]),UV=n=>Nf(n,WV,KV),HV=n=>Nf(n,"",qV),Ip=()=>!0,Nf=(n,e,t)=>{const r=vT.exec(n);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):t(r[2]):!1},GV=n=>PV.test(n)&&!MV.test(n),yT=()=>!1,qV=n=>OV.test(n),KV=n=>LV.test(n),XV=()=>{const n=Yn("colors"),e=Yn("spacing"),t=Yn("blur"),r=Yn("brightness"),o=Yn("borderColor"),s=Yn("borderRadius"),i=Yn("borderSpacing"),a=Yn("borderWidth"),l=Yn("contrast"),c=Yn("grayscale"),u=Yn("hueRotate"),d=Yn("invert"),h=Yn("gap"),p=Yn("gradientColorStops"),g=Yn("gradientColorStopPositions"),x=Yn("inset"),y=Yn("margin"),b=Yn("opacity"),C=Yn("padding"),S=Yn("saturate"),k=Yn("scale"),N=Yn("sepia"),E=Yn("skew"),_=Yn("space"),$=Yn("translate"),T=()=>["auto","contain","none"],D=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto",Kt,e],M=()=>[Kt,e],j=()=>["",Ol,$c],L=()=>["auto",Uh,Kt],U=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],G=()=>["solid","dashed","dotted","double","none"],H=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],O=()=>["start","end","center","between","around","evenly","stretch"],V=()=>["","0",Kt],W=()=>["auto","avoid","all","avoid-page","page","left","right","column"],B=()=>[Uh,Kt];return{cacheSize:500,separator:":",theme:{colors:[Ip],spacing:[Ol,$c],blur:["none","",Fc,Kt],brightness:B(),borderColor:[n],borderRadius:["none","","full",Fc,Kt],borderSpacing:M(),borderWidth:j(),contrast:B(),grayscale:V(),hueRotate:B(),invert:V(),gap:M(),gradientColorStops:[n],gradientColorStopPositions:[BV,$c],inset:A(),margin:A(),opacity:B(),padding:M(),saturate:B(),scale:B(),sepia:V(),skew:B(),space:M(),translate:M()},classGroups:{aspect:[{aspect:["auto","square","video",Kt]}],container:["container"],columns:[{columns:[Fc]}],"break-after":[{"break-after":W()}],"break-before":[{"break-before":W()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...U(),Kt]}],overflow:[{overflow:D()}],"overflow-x":[{"overflow-x":D()}],"overflow-y":[{"overflow-y":D()}],overscroll:[{overscroll:T()}],"overscroll-x":[{"overscroll-x":T()}],"overscroll-y":[{"overscroll-y":T()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[x]}],"inset-x":[{"inset-x":[x]}],"inset-y":[{"inset-y":[x]}],start:[{start:[x]}],end:[{end:[x]}],top:[{top:[x]}],right:[{right:[x]}],bottom:[{bottom:[x]}],left:[{left:[x]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Np,Kt]}],basis:[{basis:A()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Kt]}],grow:[{grow:V()}],shrink:[{shrink:V()}],order:[{order:["first","last","none",Np,Kt]}],"grid-cols":[{"grid-cols":[Ip]}],"col-start-end":[{col:["auto",{span:["full",Np,Kt]},Kt]}],"col-start":[{"col-start":L()}],"col-end":[{"col-end":L()}],"grid-rows":[{"grid-rows":[Ip]}],"row-start-end":[{row:["auto",{span:[Np,Kt]},Kt]}],"row-start":[{"row-start":L()}],"row-end":[{"row-end":L()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Kt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Kt]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...O()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...O(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...O(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[C]}],px:[{px:[C]}],py:[{py:[C]}],ps:[{ps:[C]}],pe:[{pe:[C]}],pt:[{pt:[C]}],pr:[{pr:[C]}],pb:[{pb:[C]}],pl:[{pl:[C]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[_]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[_]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Kt,e]}],"min-w":[{"min-w":[Kt,e,"min","max","fit"]}],"max-w":[{"max-w":[Kt,e,"none","full","min","max","fit","prose",{screen:[Fc]},Fc]}],h:[{h:[Kt,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Kt,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Kt,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Kt,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Fc,$c]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",tw]}],"font-family":[{font:[Ip]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Kt]}],"line-clamp":[{"line-clamp":["none",Uh,tw]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ol,Kt]}],"list-image":[{"list-image":["none",Kt]}],"list-style-type":[{list:["none","disc","decimal",Kt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[b]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[b]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...G(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ol,$c]}],"underline-offset":[{"underline-offset":["auto",Ol,Kt]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:M()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Kt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Kt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[b]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...U(),zV]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",VV]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},UV]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[b]}],"border-style":[{border:[...G(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[b]}],"divide-style":[{divide:G()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...G()]}],"outline-offset":[{"outline-offset":[Ol,Kt]}],"outline-w":[{outline:[Ol,$c]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:j()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[b]}],"ring-offset-w":[{"ring-offset":[Ol,$c]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",Fc,HV]}],"shadow-color":[{shadow:[Ip]}],opacity:[{opacity:[b]}],"mix-blend":[{"mix-blend":[...H(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":H()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Fc,Kt]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[S]}],sepia:[{sepia:[N]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[b]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[N]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Kt]}],duration:[{duration:B()}],ease:[{ease:["linear","in","out","in-out",Kt]}],delay:[{delay:B()}],animate:[{animate:["none","spin","ping","pulse","bounce",Kt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[k]}],"scale-x":[{"scale-x":[k]}],"scale-y":[{"scale-y":[k]}],rotate:[{rotate:[Np,Kt]}],"translate-x":[{"translate-x":[$]}],"translate-y":[{"translate-y":[$]}],"skew-x":[{"skew-x":[E]}],"skew-y":[{"skew-y":[E]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Kt]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Kt]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":M()}],"scroll-mx":[{"scroll-mx":M()}],"scroll-my":[{"scroll-my":M()}],"scroll-ms":[{"scroll-ms":M()}],"scroll-me":[{"scroll-me":M()}],"scroll-mt":[{"scroll-mt":M()}],"scroll-mr":[{"scroll-mr":M()}],"scroll-mb":[{"scroll-mb":M()}],"scroll-ml":[{"scroll-ml":M()}],"scroll-p":[{"scroll-p":M()}],"scroll-px":[{"scroll-px":M()}],"scroll-py":[{"scroll-py":M()}],"scroll-ps":[{"scroll-ps":M()}],"scroll-pe":[{"scroll-pe":M()}],"scroll-pt":[{"scroll-pt":M()}],"scroll-pr":[{"scroll-pr":M()}],"scroll-pb":[{"scroll-pb":M()}],"scroll-pl":[{"scroll-pl":M()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Kt]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[Ol,$c,tw]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},YV=AV(XV);function li(...n){return YV(dT(n))}const ZV=dV,bT=F.forwardRef(({className:n,...e},t)=>v.jsx(oT,{ref:t,className:li("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...e}));bT.displayName=oT.displayName;const QV=hT("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),wT=F.forwardRef(({className:n,variant:e,...t},r)=>v.jsx(sT,{ref:r,className:li(QV({variant:e}),n),...t}));wT.displayName=sT.displayName;const JV=F.forwardRef(({className:n,...e},t)=>v.jsx(lT,{ref:t,className:li("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...e}));JV.displayName=lT.displayName;const CT=F.forwardRef(({className:n,...e},t)=>v.jsx(cT,{ref:t,className:li("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...e,children:v.jsx(pT,{className:"h-4 w-4"})}));CT.displayName=cT.displayName;const kT=F.forwardRef(({className:n,...e},t)=>v.jsx(iT,{ref:t,className:li("text-sm font-semibold",n),...e}));kT.displayName=iT.displayName;const ST=F.forwardRef(({className:n,...e},t)=>v.jsx(aT,{ref:t,className:li("text-sm opacity-90",n),...e}));ST.displayName=aT.displayName;function ez(){const{toasts:n}=Nm();return v.jsxs(ZV,{children:[n.map(function({id:e,title:t,description:r,action:o,...s}){return v.jsxs(wT,{...s,children:[v.jsxs("div",{className:"grid gap-1",children:[t&&v.jsx(kT,{children:t}),r&&v.jsx(ST,{children:r})]}),o,v.jsx(CT,{})]},e)}),v.jsx(bT,{})]})}var h0={},DS;function tz(){if(DS)return h0;DS=1;var n=M9();return h0.createRoot=n.createRoot,h0.hydrateRoot=n.hydrateRoot,h0}var nz=tz(),rz=(n,e,t,r,o,s,i,a)=>{let l=document.documentElement,c=["light","dark"];function u(p){(Array.isArray(n)?n:[n]).forEach(g=>{let x=g==="class",y=x&&s?o.map(b=>s[b]||b):o;x?(l.classList.remove(...y),l.classList.add(s&&s[p]?s[p]:p)):l.setAttribute(g,p)}),d(p)}function d(p){a&&c.includes(p)&&(l.style.colorScheme=p)}function h(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(r)u(r);else try{let p=localStorage.getItem(e)||t,g=i&&p==="system"?h():p;u(g)}catch{}},oz=F.createContext(void 0),sz={setTheme:n=>{},themes:[]},iz=()=>{var n;return(n=F.useContext(oz))!=null?n:sz};F.memo(({forcedTheme:n,storageKey:e,attribute:t,enableSystem:r,enableColorScheme:o,defaultTheme:s,value:i,themes:a,nonce:l,scriptProps:c})=>{let u=JSON.stringify([t,e,s,n,a,i,r,o]).slice(1,-1);return F.createElement("script",{...c,suppressHydrationWarning:!0,nonce:typeof window>"u"?l:"",dangerouslySetInnerHTML:{__html:`(${rz.toString()})(${u})`}})});var az=n=>{switch(n){case"success":return uz;case"info":return hz;case"warning":return dz;case"error":return fz;default:return null}},lz=Array(12).fill(0),cz=({visible:n,className:e})=>Ke.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":n},Ke.createElement("div",{className:"sonner-spinner"},lz.map((t,r)=>Ke.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),uz=Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ke.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),dz=Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ke.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),hz=Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ke.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),fz=Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ke.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),pz=Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ke.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ke.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),mz=()=>{let[n,e]=Ke.useState(document.hidden);return Ke.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),n},B3=1,gz=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...o}=e,s=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:B3++,i=this.toasts.find(l=>l.id===s),a=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),i?this.toasts=this.toasts.map(l=>l.id===s?(this.publish({...l,...e,id:s,title:r}),{...l,...e,id:s,dismissible:a,title:r}):l):this.addToast({title:r,...o,dismissible:a,id:s}),s},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let o=e instanceof Promise?e:e(),s=r!==void 0,i,a=o.then(async c=>{if(i=["resolve",c],Ke.isValidElement(c))s=!1,this.create({id:r,type:"default",message:c});else if(vz(c)&&!c.ok){s=!1;let u=typeof t.error=="function"?await t.error(`HTTP error! status: ${c.status}`):t.error,d=typeof t.description=="function"?await t.description(`HTTP error! status: ${c.status}`):t.description;this.create({id:r,type:"error",message:u,description:d})}else if(t.success!==void 0){s=!1;let u=typeof t.success=="function"?await t.success(c):t.success,d=typeof t.description=="function"?await t.description(c):t.description;this.create({id:r,type:"success",message:u,description:d})}}).catch(async c=>{if(i=["reject",c],t.error!==void 0){s=!1;let u=typeof t.error=="function"?await t.error(c):t.error,d=typeof t.description=="function"?await t.description(c):t.description;this.create({id:r,type:"error",message:u,description:d})}}).finally(()=>{var c;s&&(this.dismiss(r),r=void 0),(c=t.finally)==null||c.call(t)}),l=()=>new Promise((c,u)=>a.then(()=>i[0]==="reject"?u(i[1]):c(i[1])).catch(u));return typeof r!="string"&&typeof r!="number"?{unwrap:l}:Object.assign(r,{unwrap:l})},this.custom=(e,t)=>{let r=t?.id||B3++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Ds=new gz,xz=(n,e)=>{let t=e?.id||B3++;return Ds.addToast({title:n,...e,id:t}),t},vz=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",yz=xz,bz=()=>Ds.toasts,wz=()=>Ds.getActiveToasts();Object.assign(yz,{success:Ds.success,info:Ds.info,warning:Ds.warning,error:Ds.error,custom:Ds.custom,message:Ds.message,promise:Ds.promise,dismiss:Ds.dismiss,loading:Ds.loading},{getHistory:bz,getToasts:wz});function Cz(n,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",e==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}Cz(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function f0(n){return n.label!==void 0}var kz=3,Sz="32px",Nz="16px",AS=4e3,Iz=356,Ez=14,Tz=20,Rz=200;function Zi(...n){return n.filter(Boolean).join(" ")}function Dz(n){let[e,t]=n.split("-"),r=[];return e&&r.push(e),t&&r.push(t),r}var Az=n=>{var e,t,r,o,s,i,a,l,c,u,d;let{invert:h,toast:p,unstyled:g,interacting:x,setHeights:y,visibleToasts:b,heights:C,index:S,toasts:k,expanded:N,removeToast:E,defaultRichColors:_,closeButton:$,style:T,cancelButtonStyle:D,actionButtonStyle:A,className:M="",descriptionClassName:j="",duration:L,position:U,gap:G,loadingIcon:H,expandByDefault:O,classNames:V,icons:W,closeButtonAriaLabel:B="Close toast",pauseWhenPageIsHidden:q}=n,[Q,Z]=Ke.useState(null),[ne,ge]=Ke.useState(null),[he,Se]=Ke.useState(!1),[Re,We]=Ke.useState(!1),[Be,Xe]=Ke.useState(!1),[Ye,ot]=Ke.useState(!1),[Qe,ct]=Ke.useState(!1),[ie,$t]=Ke.useState(0),[Ot,qt]=Ke.useState(0),en=Ke.useRef(p.duration||L||AS),hn=Ke.useRef(null),cn=Ke.useRef(null),tn=S===0,Ht=S+1<=b,Yt=p.type,ye=p.dismissible!==!1,Fe=p.className||"",Oe=p.descriptionClassName||"",xt=Ke.useMemo(()=>C.findIndex(Ft=>Ft.toastId===p.id)||0,[C,p.id]),at=Ke.useMemo(()=>{var Ft;return(Ft=p.closeButton)!=null?Ft:$},[p.closeButton,$]),Lt=Ke.useMemo(()=>p.duration||L||AS,[p.duration,L]),St=Ke.useRef(0),Rt=Ke.useRef(0),On=Ke.useRef(0),ir=Ke.useRef(null),[En,xo]=U.split("-"),Er=Ke.useMemo(()=>C.reduce((Ft,un,Pt)=>Pt>=xt?Ft:Ft+un.height,0),[C,xt]),gs=mz(),zn=p.invert||h,er=Yt==="loading";Rt.current=Ke.useMemo(()=>xt*G+Er,[xt,Er]),Ke.useEffect(()=>{en.current=Lt},[Lt]),Ke.useEffect(()=>{Se(!0)},[]),Ke.useEffect(()=>{let Ft=cn.current;if(Ft){let un=Ft.getBoundingClientRect().height;return qt(un),y(Pt=>[{toastId:p.id,height:un,position:p.position},...Pt]),()=>y(Pt=>Pt.filter(Tr=>Tr.toastId!==p.id))}},[y,p.id]),Ke.useLayoutEffect(()=>{if(!he)return;let Ft=cn.current,un=Ft.style.height;Ft.style.height="auto";let Pt=Ft.getBoundingClientRect().height;Ft.style.height=un,qt(Pt),y(Tr=>Tr.find(vo=>vo.toastId===p.id)?Tr.map(vo=>vo.toastId===p.id?{...vo,height:Pt}:vo):[{toastId:p.id,height:Pt,position:p.position},...Tr])},[he,p.title,p.description,y,p.id]);let ar=Ke.useCallback(()=>{We(!0),$t(Rt.current),y(Ft=>Ft.filter(un=>un.toastId!==p.id)),setTimeout(()=>{E(p)},Rz)},[p,E,y,Rt]);Ke.useEffect(()=>{if(p.promise&&Yt==="loading"||p.duration===1/0||p.type==="loading")return;let Ft;return N||x||q&&gs?(()=>{if(On.current<St.current){let un=new Date().getTime()-St.current;en.current=en.current-un}On.current=new Date().getTime()})():en.current!==1/0&&(St.current=new Date().getTime(),Ft=setTimeout(()=>{var un;(un=p.onAutoClose)==null||un.call(p,p),ar()},en.current)),()=>clearTimeout(Ft)},[N,x,p,Yt,q,gs,ar]),Ke.useEffect(()=>{p.delete&&ar()},[ar,p.delete]);function Vs(){var Ft,un,Pt;return W!=null&&W.loading?Ke.createElement("div",{className:Zi(V?.loader,(Ft=p?.classNames)==null?void 0:Ft.loader,"sonner-loader"),"data-visible":Yt==="loading"},W.loading):H?Ke.createElement("div",{className:Zi(V?.loader,(un=p?.classNames)==null?void 0:un.loader,"sonner-loader"),"data-visible":Yt==="loading"},H):Ke.createElement(cz,{className:Zi(V?.loader,(Pt=p?.classNames)==null?void 0:Pt.loader),visible:Yt==="loading"})}return Ke.createElement("li",{tabIndex:0,ref:cn,className:Zi(M,Fe,V?.toast,(e=p?.classNames)==null?void 0:e.toast,V?.default,V?.[Yt],(t=p?.classNames)==null?void 0:t[Yt]),"data-sonner-toast":"","data-rich-colors":(r=p.richColors)!=null?r:_,"data-styled":!(p.jsx||p.unstyled||g),"data-mounted":he,"data-promise":!!p.promise,"data-swiped":Qe,"data-removed":Re,"data-visible":Ht,"data-y-position":En,"data-x-position":xo,"data-index":S,"data-front":tn,"data-swiping":Be,"data-dismissible":ye,"data-type":Yt,"data-invert":zn,"data-swipe-out":Ye,"data-swipe-direction":ne,"data-expanded":!!(N||O&&he),style:{"--index":S,"--toasts-before":S,"--z-index":k.length-S,"--offset":`${Re?ie:Rt.current}px`,"--initial-height":O?"auto":`${Ot}px`,...T,...p.style},onDragEnd:()=>{Xe(!1),Z(null),ir.current=null},onPointerDown:Ft=>{er||!ye||(hn.current=new Date,$t(Rt.current),Ft.target.setPointerCapture(Ft.pointerId),Ft.target.tagName!=="BUTTON"&&(Xe(!0),ir.current={x:Ft.clientX,y:Ft.clientY}))},onPointerUp:()=>{var Ft,un,Pt,Tr;if(Ye||!ye)return;ir.current=null;let vo=Number(((Ft=cn.current)==null?void 0:Ft.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),we=Number(((un=cn.current)==null?void 0:un.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ne=new Date().getTime()-((Pt=hn.current)==null?void 0:Pt.getTime()),fe=Q==="x"?vo:we,$e=Math.abs(fe)/Ne;if(Math.abs(fe)>=Tz||$e>.11){$t(Rt.current),(Tr=p.onDismiss)==null||Tr.call(p,p),ge(Q==="x"?vo>0?"right":"left":we>0?"down":"up"),ar(),ot(!0),ct(!1);return}Xe(!1),Z(null)},onPointerMove:Ft=>{var un,Pt,Tr,vo;if(!ir.current||!ye||((un=window.getSelection())==null?void 0:un.toString().length)>0)return;let we=Ft.clientY-ir.current.y,Ne=Ft.clientX-ir.current.x,fe=(Pt=n.swipeDirections)!=null?Pt:Dz(U);!Q&&(Math.abs(Ne)>1||Math.abs(we)>1)&&Z(Math.abs(Ne)>Math.abs(we)?"x":"y");let $e={x:0,y:0};Q==="y"?(fe.includes("top")||fe.includes("bottom"))&&(fe.includes("top")&&we<0||fe.includes("bottom")&&we>0)&&($e.y=we):Q==="x"&&(fe.includes("left")||fe.includes("right"))&&(fe.includes("left")&&Ne<0||fe.includes("right")&&Ne>0)&&($e.x=Ne),(Math.abs($e.x)>0||Math.abs($e.y)>0)&&ct(!0),(Tr=cn.current)==null||Tr.style.setProperty("--swipe-amount-x",`${$e.x}px`),(vo=cn.current)==null||vo.style.setProperty("--swipe-amount-y",`${$e.y}px`)}},at&&!p.jsx?Ke.createElement("button",{"aria-label":B,"data-disabled":er,"data-close-button":!0,onClick:er||!ye?()=>{}:()=>{var Ft;ar(),(Ft=p.onDismiss)==null||Ft.call(p,p)},className:Zi(V?.closeButton,(o=p?.classNames)==null?void 0:o.closeButton)},(s=W?.close)!=null?s:pz):null,p.jsx||F.isValidElement(p.title)?p.jsx?p.jsx:typeof p.title=="function"?p.title():p.title:Ke.createElement(Ke.Fragment,null,Yt||p.icon||p.promise?Ke.createElement("div",{"data-icon":"",className:Zi(V?.icon,(i=p?.classNames)==null?void 0:i.icon)},p.promise||p.type==="loading"&&!p.icon?p.icon||Vs():null,p.type!=="loading"?p.icon||W?.[Yt]||az(Yt):null):null,Ke.createElement("div",{"data-content":"",className:Zi(V?.content,(a=p?.classNames)==null?void 0:a.content)},Ke.createElement("div",{"data-title":"",className:Zi(V?.title,(l=p?.classNames)==null?void 0:l.title)},typeof p.title=="function"?p.title():p.title),p.description?Ke.createElement("div",{"data-description":"",className:Zi(j,Oe,V?.description,(c=p?.classNames)==null?void 0:c.description)},typeof p.description=="function"?p.description():p.description):null),F.isValidElement(p.cancel)?p.cancel:p.cancel&&f0(p.cancel)?Ke.createElement("button",{"data-button":!0,"data-cancel":!0,style:p.cancelButtonStyle||D,onClick:Ft=>{var un,Pt;f0(p.cancel)&&ye&&((Pt=(un=p.cancel).onClick)==null||Pt.call(un,Ft),ar())},className:Zi(V?.cancelButton,(u=p?.classNames)==null?void 0:u.cancelButton)},p.cancel.label):null,F.isValidElement(p.action)?p.action:p.action&&f0(p.action)?Ke.createElement("button",{"data-button":!0,"data-action":!0,style:p.actionButtonStyle||A,onClick:Ft=>{var un,Pt;f0(p.action)&&((Pt=(un=p.action).onClick)==null||Pt.call(un,Ft),!Ft.defaultPrevented&&ar())},className:Zi(V?.actionButton,(d=p?.classNames)==null?void 0:d.actionButton)},p.action.label):null))};function _S(){if(typeof window>"u"||typeof document>"u")return"ltr";let n=document.documentElement.getAttribute("dir");return n==="auto"||!n?window.getComputedStyle(document.documentElement).direction:n}function _z(n,e){let t={};return[n,e].forEach((r,o)=>{let s=o===1,i=s?"--mobile-offset":"--offset",a=s?Nz:Sz;function l(c){["top","right","bottom","left"].forEach(u=>{t[`${i}-${u}`]=typeof c=="number"?`${c}px`:c})}typeof r=="number"||typeof r=="string"?l(r):typeof r=="object"?["top","right","bottom","left"].forEach(c=>{r[c]===void 0?t[`${i}-${c}`]=a:t[`${i}-${c}`]=typeof r[c]=="number"?`${r[c]}px`:r[c]}):l(a)}),t}var $z=F.forwardRef(function(n,e){let{invert:t,position:r="bottom-right",hotkey:o=["altKey","KeyT"],expand:s,closeButton:i,className:a,offset:l,mobileOffset:c,theme:u="light",richColors:d,duration:h,style:p,visibleToasts:g=kz,toastOptions:x,dir:y=_S(),gap:b=Ez,loadingIcon:C,icons:S,containerAriaLabel:k="Notifications",pauseWhenPageIsHidden:N}=n,[E,_]=Ke.useState([]),$=Ke.useMemo(()=>Array.from(new Set([r].concat(E.filter(q=>q.position).map(q=>q.position)))),[E,r]),[T,D]=Ke.useState([]),[A,M]=Ke.useState(!1),[j,L]=Ke.useState(!1),[U,G]=Ke.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),H=Ke.useRef(null),O=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),V=Ke.useRef(null),W=Ke.useRef(!1),B=Ke.useCallback(q=>{_(Q=>{var Z;return(Z=Q.find(ne=>ne.id===q.id))!=null&&Z.delete||Ds.dismiss(q.id),Q.filter(({id:ne})=>ne!==q.id)})},[]);return Ke.useEffect(()=>Ds.subscribe(q=>{if(q.dismiss){_(Q=>Q.map(Z=>Z.id===q.id?{...Z,delete:!0}:Z));return}setTimeout(()=>{O9.flushSync(()=>{_(Q=>{let Z=Q.findIndex(ne=>ne.id===q.id);return Z!==-1?[...Q.slice(0,Z),{...Q[Z],...q},...Q.slice(Z+1)]:[q,...Q]})})})}),[]),Ke.useEffect(()=>{if(u!=="system"){G(u);return}if(u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?G("dark"):G("light")),typeof window>"u")return;let q=window.matchMedia("(prefers-color-scheme: dark)");try{q.addEventListener("change",({matches:Q})=>{G(Q?"dark":"light")})}catch{q.addListener(({matches:Z})=>{try{G(Z?"dark":"light")}catch(ne){console.error(ne)}})}},[u]),Ke.useEffect(()=>{E.length<=1&&M(!1)},[E]),Ke.useEffect(()=>{let q=Q=>{var Z,ne;o.every(ge=>Q[ge]||Q.code===ge)&&(M(!0),(Z=H.current)==null||Z.focus()),Q.code==="Escape"&&(document.activeElement===H.current||(ne=H.current)!=null&&ne.contains(document.activeElement))&&M(!1)};return document.addEventListener("keydown",q),()=>document.removeEventListener("keydown",q)},[o]),Ke.useEffect(()=>{if(H.current)return()=>{V.current&&(V.current.focus({preventScroll:!0}),V.current=null,W.current=!1)}},[H.current]),Ke.createElement("section",{ref:e,"aria-label":`${k} ${O}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},$.map((q,Q)=>{var Z;let[ne,ge]=q.split("-");return E.length?Ke.createElement("ol",{key:q,dir:y==="auto"?_S():y,tabIndex:-1,ref:H,className:a,"data-sonner-toaster":!0,"data-theme":U,"data-y-position":ne,"data-lifted":A&&E.length>1&&!s,"data-x-position":ge,style:{"--front-toast-height":`${((Z=T[0])==null?void 0:Z.height)||0}px`,"--width":`${Iz}px`,"--gap":`${b}px`,...p,..._z(l,c)},onBlur:he=>{W.current&&!he.currentTarget.contains(he.relatedTarget)&&(W.current=!1,V.current&&(V.current.focus({preventScroll:!0}),V.current=null))},onFocus:he=>{he.target instanceof HTMLElement&&he.target.dataset.dismissible==="false"||W.current||(W.current=!0,V.current=he.relatedTarget)},onMouseEnter:()=>M(!0),onMouseMove:()=>M(!0),onMouseLeave:()=>{j||M(!1)},onDragEnd:()=>M(!1),onPointerDown:he=>{he.target instanceof HTMLElement&&he.target.dataset.dismissible==="false"||L(!0)},onPointerUp:()=>L(!1)},E.filter(he=>!he.position&&Q===0||he.position===q).map((he,Se)=>{var Re,We;return Ke.createElement(Az,{key:he.id,icons:S,index:Se,toast:he,defaultRichColors:d,duration:(Re=x?.duration)!=null?Re:h,className:x?.className,descriptionClassName:x?.descriptionClassName,invert:t,visibleToasts:g,closeButton:(We=x?.closeButton)!=null?We:i,interacting:j,position:q,style:x?.style,unstyled:x?.unstyled,classNames:x?.classNames,cancelButtonStyle:x?.cancelButtonStyle,actionButtonStyle:x?.actionButtonStyle,removeToast:B,toasts:E.filter(Be=>Be.position==he.position),heights:T.filter(Be=>Be.position==he.position),setHeights:D,expandByDefault:s,gap:b,loadingIcon:C,expanded:A,pauseWhenPageIsHidden:N,swipeDirections:n.swipeDirections})})):null}))});const Fz=({...n})=>{const{theme:e="system"}=iz();return v.jsx($z,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...n})};var Pz=a4[" useId ".trim().toString()]||(()=>{}),Mz=0;function nw(n){const[e,t]=F.useState(Pz());return ql(()=>{t(r=>r??String(Mz++))},[n]),n||(e?`radix-${e}`:"")}const Oz=["top","right","bottom","left"],eu=Math.min,Zs=Math.max,hx=Math.round,p0=Math.floor,Qa=n=>({x:n,y:n}),Lz={left:"right",right:"left",bottom:"top",top:"bottom"},Bz={start:"end",end:"start"};function j3(n,e,t){return Zs(n,eu(e,t))}function Kl(n,e){return typeof n=="function"?n(e):n}function Xl(n){return n.split("-")[0]}function If(n){return n.split("-")[1]}function f4(n){return n==="x"?"y":"x"}function p4(n){return n==="y"?"height":"width"}const jz=new Set(["top","bottom"]);function Xa(n){return jz.has(Xl(n))?"y":"x"}function m4(n){return f4(Xa(n))}function Vz(n,e,t){t===void 0&&(t=!1);const r=If(n),o=m4(n),s=p4(o);let i=o==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=fx(i)),[i,fx(i)]}function zz(n){const e=fx(n);return[V3(n),e,V3(e)]}function V3(n){return n.replace(/start|end/g,e=>Bz[e])}const $S=["left","right"],FS=["right","left"],Wz=["top","bottom"],Uz=["bottom","top"];function Hz(n,e,t){switch(n){case"top":case"bottom":return t?e?FS:$S:e?$S:FS;case"left":case"right":return e?Wz:Uz;default:return[]}}function Gz(n,e,t,r){const o=If(n);let s=Hz(Xl(n),t==="start",r);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(V3)))),s}function fx(n){return n.replace(/left|right|bottom|top/g,e=>Lz[e])}function qz(n){return{top:0,right:0,bottom:0,left:0,...n}}function NT(n){return typeof n!="number"?qz(n):{top:n,right:n,bottom:n,left:n}}function px(n){const{x:e,y:t,width:r,height:o}=n;return{width:r,height:o,top:t,left:e,right:e+r,bottom:t+o,x:e,y:t}}function PS(n,e,t){let{reference:r,floating:o}=n;const s=Xa(e),i=m4(e),a=p4(i),l=Xl(e),c=s==="y",u=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,h=r[a]/2-o[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-o.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-o.width,y:d};break;default:p={x:r.x,y:r.y}}switch(If(e)){case"start":p[i]-=h*(t&&c?-1:1);break;case"end":p[i]+=h*(t&&c?-1:1);break}return p}const Kz=async(n,e,t)=>{const{placement:r="bottom",strategy:o="absolute",middleware:s=[],platform:i}=t,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:n,floating:e,strategy:o}),{x:u,y:d}=PS(c,r,l),h=r,p={},g=0;for(let x=0;x<a.length;x++){const{name:y,fn:b}=a[x],{x:C,y:S,data:k,reset:N}=await b({x:u,y:d,initialPlacement:r,placement:h,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:n,floating:e}});u=C??u,d=S??d,p={...p,[y]:{...p[y],...k}},N&&g<=50&&(g++,typeof N=="object"&&(N.placement&&(h=N.placement),N.rects&&(c=N.rects===!0?await i.getElementRects({reference:n,floating:e,strategy:o}):N.rects),{x:u,y:d}=PS(c,h,l)),x=-1)}return{x:u,y:d,placement:h,strategy:o,middlewareData:p}};async function Jp(n,e){var t;e===void 0&&(e={});const{x:r,y:o,platform:s,rects:i,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=Kl(e,n),g=NT(p),y=a[h?d==="floating"?"reference":"floating":d],b=px(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(y)))==null||t?y:y.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),C=d==="floating"?{x:r,y:o,width:i.floating.width,height:i.floating.height}:i.reference,S=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),k=await(s.isElement==null?void 0:s.isElement(S))?await(s.getScale==null?void 0:s.getScale(S))||{x:1,y:1}:{x:1,y:1},N=px(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:C,offsetParent:S,strategy:l}):C);return{top:(b.top-N.top+g.top)/k.y,bottom:(N.bottom-b.bottom+g.bottom)/k.y,left:(b.left-N.left+g.left)/k.x,right:(N.right-b.right+g.right)/k.x}}const Xz=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Kl(n,e)||{};if(c==null)return{};const d=NT(u),h={x:t,y:r},p=m4(o),g=p4(p),x=await i.getDimensions(c),y=p==="y",b=y?"top":"left",C=y?"bottom":"right",S=y?"clientHeight":"clientWidth",k=s.reference[g]+s.reference[p]-h[p]-s.floating[g],N=h[p]-s.reference[p],E=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let _=E?E[S]:0;(!_||!await(i.isElement==null?void 0:i.isElement(E)))&&(_=a.floating[S]||s.floating[g]);const $=k/2-N/2,T=_/2-x[g]/2-1,D=eu(d[b],T),A=eu(d[C],T),M=D,j=_-x[g]-A,L=_/2-x[g]/2+$,U=j3(M,L,j),G=!l.arrow&&If(o)!=null&&L!==U&&s.reference[g]/2-(L<M?D:A)-x[g]/2<0,H=G?L<M?L-M:L-j:0;return{[p]:h[p]+H,data:{[p]:U,centerOffset:L-U-H,...G&&{alignmentOffset:H}},reset:G}}}),Yz=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:x=!0,...y}=Kl(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const b=Xl(o),C=Xa(a),S=Xl(a)===a,k=await(l.isRTL==null?void 0:l.isRTL(c.floating)),N=h||(S||!x?[fx(a)]:zz(a)),E=g!=="none";!h&&E&&N.push(...Gz(a,x,g,k));const _=[a,...N],$=await Jp(e,y),T=[];let D=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&T.push($[b]),d){const L=Vz(o,i,k);T.push($[L[0]],$[L[1]])}if(D=[...D,{placement:o,overflows:T}],!T.every(L=>L<=0)){var A,M;const L=(((A=s.flip)==null?void 0:A.index)||0)+1,U=_[L];if(U&&(!(d==="alignment"?C!==Xa(U):!1)||D.every(O=>Xa(O.placement)===C?O.overflows[0]>0:!0)))return{data:{index:L,overflows:D},reset:{placement:U}};let G=(M=D.filter(H=>H.overflows[0]<=0).sort((H,O)=>H.overflows[1]-O.overflows[1])[0])==null?void 0:M.placement;if(!G)switch(p){case"bestFit":{var j;const H=(j=D.filter(O=>{if(E){const V=Xa(O.placement);return V===C||V==="y"}return!0}).map(O=>[O.placement,O.overflows.filter(V=>V>0).reduce((V,W)=>V+W,0)]).sort((O,V)=>O[1]-V[1])[0])==null?void 0:j[0];H&&(G=H);break}case"initialPlacement":G=a;break}if(o!==G)return{reset:{placement:G}}}return{}}}};function MS(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function OS(n){return Oz.some(e=>n[e]>=0)}const Zz=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...o}=Kl(n,e);switch(r){case"referenceHidden":{const s=await Jp(e,{...o,elementContext:"reference"}),i=MS(s,t.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:OS(i)}}}case"escaped":{const s=await Jp(e,{...o,altBoundary:!0}),i=MS(s,t.floating);return{data:{escapedOffsets:i,escaped:OS(i)}}}default:return{}}}}},IT=new Set(["left","top"]);async function Qz(n,e){const{placement:t,platform:r,elements:o}=n,s=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=Xl(t),a=If(t),l=Xa(t)==="y",c=IT.has(i)?-1:1,u=s&&l?-1:1,d=Kl(e,n);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const Jz=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await Qz(e,n);return i===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},eW=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:y=>{let{x:b,y:C}=y;return{x:b,y:C}}},...l}=Kl(n,e),c={x:t,y:r},u=await Jp(e,l),d=Xa(Xl(o)),h=f4(d);let p=c[h],g=c[d];if(s){const y=h==="y"?"top":"left",b=h==="y"?"bottom":"right",C=p+u[y],S=p-u[b];p=j3(C,p,S)}if(i){const y=d==="y"?"top":"left",b=d==="y"?"bottom":"right",C=g+u[y],S=g-u[b];g=j3(C,g,S)}const x=a.fn({...e,[h]:p,[d]:g});return{...x,data:{x:x.x-t,y:x.y-r,enabled:{[h]:s,[d]:i}}}}}},tW=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Kl(n,e),u={x:t,y:r},d=Xa(o),h=f4(d);let p=u[h],g=u[d];const x=Kl(a,e),y=typeof x=="number"?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(l){const S=h==="y"?"height":"width",k=s.reference[h]-s.floating[S]+y.mainAxis,N=s.reference[h]+s.reference[S]-y.mainAxis;p<k?p=k:p>N&&(p=N)}if(c){var b,C;const S=h==="y"?"width":"height",k=IT.has(Xl(o)),N=s.reference[d]-s.floating[S]+(k&&((b=i.offset)==null?void 0:b[d])||0)+(k?0:y.crossAxis),E=s.reference[d]+s.reference[S]+(k?0:((C=i.offset)==null?void 0:C[d])||0)-(k?y.crossAxis:0);g<N?g=N:g>E&&(g=E)}return{[h]:p,[d]:g}}}},nW=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=Kl(n,e),u=await Jp(e,c),d=Xl(o),h=If(o),p=Xa(o)==="y",{width:g,height:x}=s.floating;let y,b;d==="top"||d==="bottom"?(y=d,b=h===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(b=d,y=h==="end"?"top":"bottom");const C=x-u.top-u.bottom,S=g-u.left-u.right,k=eu(x-u[y],C),N=eu(g-u[b],S),E=!e.middlewareData.shift;let _=k,$=N;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&($=S),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(_=C),E&&!h){const D=Zs(u.left,0),A=Zs(u.right,0),M=Zs(u.top,0),j=Zs(u.bottom,0);p?$=g-2*(D!==0||A!==0?D+A:Zs(u.left,u.right)):_=x-2*(M!==0||j!==0?M+j:Zs(u.top,u.bottom))}await l({...e,availableWidth:$,availableHeight:_});const T=await i.getDimensions(a.floating);return g!==T.width||x!==T.height?{reset:{rects:!0}}:{}}}};function wv(){return typeof window<"u"}function Ef(n){return ET(n)?(n.nodeName||"").toLowerCase():"#document"}function oi(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function ml(n){var e;return(e=(ET(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function ET(n){return wv()?n instanceof Node||n instanceof oi(n).Node:!1}function da(n){return wv()?n instanceof Element||n instanceof oi(n).Element:!1}function ll(n){return wv()?n instanceof HTMLElement||n instanceof oi(n).HTMLElement:!1}function LS(n){return!wv()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof oi(n).ShadowRoot}const rW=new Set(["inline","contents"]);function Tm(n){const{overflow:e,overflowX:t,overflowY:r,display:o}=ha(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!rW.has(o)}const oW=new Set(["table","td","th"]);function sW(n){return oW.has(Ef(n))}const iW=[":popover-open",":modal"];function Cv(n){return iW.some(e=>{try{return n.matches(e)}catch{return!1}})}const aW=["transform","translate","scale","rotate","perspective"],lW=["transform","translate","scale","rotate","perspective","filter"],cW=["paint","layout","strict","content"];function g4(n){const e=x4(),t=da(n)?ha(n):n;return aW.some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||lW.some(r=>(t.willChange||"").includes(r))||cW.some(r=>(t.contain||"").includes(r))}function uW(n){let e=tu(n);for(;ll(e)&&!af(e);){if(g4(e))return e;if(Cv(e))return null;e=tu(e)}return null}function x4(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const dW=new Set(["html","body","#document"]);function af(n){return dW.has(Ef(n))}function ha(n){return oi(n).getComputedStyle(n)}function kv(n){return da(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function tu(n){if(Ef(n)==="html")return n;const e=n.assignedSlot||n.parentNode||LS(n)&&n.host||ml(n);return LS(e)?e.host:e}function TT(n){const e=tu(n);return af(e)?n.ownerDocument?n.ownerDocument.body:n.body:ll(e)&&Tm(e)?e:TT(e)}function em(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const o=TT(n),s=o===((r=n.ownerDocument)==null?void 0:r.body),i=oi(o);if(s){const a=z3(i);return e.concat(i,i.visualViewport||[],Tm(o)?o:[],a&&t?em(a):[])}return e.concat(o,em(o,[],t))}function z3(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function RT(n){const e=ha(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=ll(n),s=o?n.offsetWidth:t,i=o?n.offsetHeight:r,a=hx(t)!==s||hx(r)!==i;return a&&(t=s,r=i),{width:t,height:r,$:a}}function v4(n){return da(n)?n:n.contextElement}function Hh(n){const e=v4(n);if(!ll(e))return Qa(1);const t=e.getBoundingClientRect(),{width:r,height:o,$:s}=RT(e);let i=(s?hx(t.width):t.width)/r,a=(s?hx(t.height):t.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const hW=Qa(0);function DT(n){const e=oi(n);return!x4()||!e.visualViewport?hW:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function fW(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==oi(n)?!1:e}function hd(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const o=n.getBoundingClientRect(),s=v4(n);let i=Qa(1);e&&(r?da(r)&&(i=Hh(r)):i=Hh(n));const a=fW(s,t,r)?DT(s):Qa(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const h=oi(s),p=r&&da(r)?oi(r):r;let g=h,x=z3(g);for(;x&&r&&p!==g;){const y=Hh(x),b=x.getBoundingClientRect(),C=ha(x),S=b.left+(x.clientLeft+parseFloat(C.paddingLeft))*y.x,k=b.top+(x.clientTop+parseFloat(C.paddingTop))*y.y;l*=y.x,c*=y.y,u*=y.x,d*=y.y,l+=S,c+=k,g=oi(x),x=z3(g)}}return px({width:u,height:d,x:l,y:c})}function Sv(n,e){const t=kv(n).scrollLeft;return e?e.left+t:hd(ml(n)).left+t}function AT(n,e){const t=n.getBoundingClientRect(),r=t.left+e.scrollLeft-Sv(n,t),o=t.top+e.scrollTop;return{x:r,y:o}}function pW(n){let{elements:e,rect:t,offsetParent:r,strategy:o}=n;const s=o==="fixed",i=ml(r),a=e?Cv(e.floating):!1;if(r===i||a&&s)return t;let l={scrollLeft:0,scrollTop:0},c=Qa(1);const u=Qa(0),d=ll(r);if((d||!d&&!s)&&((Ef(r)!=="body"||Tm(i))&&(l=kv(r)),ll(r))){const p=hd(r);c=Hh(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}const h=i&&!d&&!s?AT(i,l):Qa(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:t.y*c.y-l.scrollTop*c.y+u.y+h.y}}function mW(n){return Array.from(n.getClientRects())}function gW(n){const e=ml(n),t=kv(n),r=n.ownerDocument.body,o=Zs(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Zs(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-t.scrollLeft+Sv(n);const a=-t.scrollTop;return ha(r).direction==="rtl"&&(i+=Zs(e.clientWidth,r.clientWidth)-o),{width:o,height:s,x:i,y:a}}const BS=25;function xW(n,e){const t=oi(n),r=ml(n),o=t.visualViewport;let s=r.clientWidth,i=r.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const u=x4();(!u||u&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}const c=Sv(r);if(c<=0){const u=r.ownerDocument,d=u.body,h=getComputedStyle(d),p=u.compatMode==="CSS1Compat"&&parseFloat(h.marginLeft)+parseFloat(h.marginRight)||0,g=Math.abs(r.clientWidth-d.clientWidth-p);g<=BS&&(s-=g)}else c<=BS&&(s+=c);return{width:s,height:i,x:a,y:l}}const vW=new Set(["absolute","fixed"]);function yW(n,e){const t=hd(n,!0,e==="fixed"),r=t.top+n.clientTop,o=t.left+n.clientLeft,s=ll(n)?Hh(n):Qa(1),i=n.clientWidth*s.x,a=n.clientHeight*s.y,l=o*s.x,c=r*s.y;return{width:i,height:a,x:l,y:c}}function jS(n,e,t){let r;if(e==="viewport")r=xW(n,t);else if(e==="document")r=gW(ml(n));else if(da(e))r=yW(e,t);else{const o=DT(n);r={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return px(r)}function _T(n,e){const t=tu(n);return t===e||!da(t)||af(t)?!1:ha(t).position==="fixed"||_T(t,e)}function bW(n,e){const t=e.get(n);if(t)return t;let r=em(n,[],!1).filter(a=>da(a)&&Ef(a)!=="body"),o=null;const s=ha(n).position==="fixed";let i=s?tu(n):n;for(;da(i)&&!af(i);){const a=ha(i),l=g4(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&vW.has(o.position)||Tm(i)&&!l&&_T(n,i))?r=r.filter(u=>u!==i):o=a,i=tu(i)}return e.set(n,r),r}function wW(n){let{element:e,boundary:t,rootBoundary:r,strategy:o}=n;const i=[...t==="clippingAncestors"?Cv(e)?[]:bW(e,this._c):[].concat(t),r],a=i[0],l=i.reduce((c,u)=>{const d=jS(e,u,o);return c.top=Zs(d.top,c.top),c.right=eu(d.right,c.right),c.bottom=eu(d.bottom,c.bottom),c.left=Zs(d.left,c.left),c},jS(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function CW(n){const{width:e,height:t}=RT(n);return{width:e,height:t}}function kW(n,e,t){const r=ll(e),o=ml(e),s=t==="fixed",i=hd(n,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Qa(0);function c(){l.x=Sv(o)}if(r||!r&&!s)if((Ef(e)!=="body"||Tm(o))&&(a=kv(e)),r){const p=hd(e,!0,s,e);l.x=p.x+e.clientLeft,l.y=p.y+e.clientTop}else o&&c();s&&!r&&o&&c();const u=o&&!r&&!s?AT(o,a):Qa(0),d=i.left+a.scrollLeft-l.x-u.x,h=i.top+a.scrollTop-l.y-u.y;return{x:d,y:h,width:i.width,height:i.height}}function rw(n){return ha(n).position==="static"}function VS(n,e){if(!ll(n)||ha(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return ml(n)===t&&(t=t.ownerDocument.body),t}function $T(n,e){const t=oi(n);if(Cv(n))return t;if(!ll(n)){let o=tu(n);for(;o&&!af(o);){if(da(o)&&!rw(o))return o;o=tu(o)}return t}let r=VS(n,e);for(;r&&sW(r)&&rw(r);)r=VS(r,e);return r&&af(r)&&rw(r)&&!g4(r)?t:r||uW(n)||t}const SW=async function(n){const e=this.getOffsetParent||$T,t=this.getDimensions,r=await t(n.floating);return{reference:kW(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function NW(n){return ha(n).direction==="rtl"}const IW={convertOffsetParentRelativeRectToViewportRelativeRect:pW,getDocumentElement:ml,getClippingRect:wW,getOffsetParent:$T,getElementRects:SW,getClientRects:mW,getDimensions:CW,getScale:Hh,isElement:da,isRTL:NW};function FT(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function EW(n,e){let t=null,r;const o=ml(n);function s(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=n.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=c;if(a||e(),!h||!p)return;const g=p0(d),x=p0(o.clientWidth-(u+h)),y=p0(o.clientHeight-(d+p)),b=p0(u),S={rootMargin:-g+"px "+-x+"px "+-y+"px "+-b+"px",threshold:Zs(0,eu(1,l))||1};let k=!0;function N(E){const _=E[0].intersectionRatio;if(_!==l){if(!k)return i();_?i(!1,_):r=setTimeout(()=>{i(!1,1e-7)},1e3)}_===1&&!FT(c,n.getBoundingClientRect())&&i(),k=!1}try{t=new IntersectionObserver(N,{...S,root:o.ownerDocument})}catch{t=new IntersectionObserver(N,S)}t.observe(n)}return i(!0),s}function TW(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=v4(n),u=o||s?[...c?em(c):[],...em(e)]:[];u.forEach(b=>{o&&b.addEventListener("scroll",t,{passive:!0}),s&&b.addEventListener("resize",t)});const d=c&&a?EW(c,t):null;let h=-1,p=null;i&&(p=new ResizeObserver(b=>{let[C]=b;C&&C.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var S;(S=p)==null||S.observe(e)})),t()}),c&&!l&&p.observe(c),p.observe(e));let g,x=l?hd(n):null;l&&y();function y(){const b=hd(n);x&&!FT(x,b)&&t(),x=b,g=requestAnimationFrame(y)}return t(),()=>{var b;u.forEach(C=>{o&&C.removeEventListener("scroll",t),s&&C.removeEventListener("resize",t)}),d?.(),(b=p)==null||b.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const RW=Jz,DW=eW,AW=Yz,_W=nW,$W=Zz,zS=Xz,FW=tW,PW=(n,e,t)=>{const r=new Map,o={platform:IW,...t},s={...o.platform,_c:r};return Kz(n,e,{...o,platform:s})};var MW=typeof document<"u",OW=function(){},J0=MW?F.useLayoutEffect:OW;function mx(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,o;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!mx(n[r],e[r]))return!1;return!0}if(o=Object.keys(n),t=o.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=t;r--!==0;){const s=o[r];if(!(s==="_owner"&&n.$$typeof)&&!mx(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function PT(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function WS(n,e){const t=PT(n);return Math.round(e*t)/t}function ow(n){const e=F.useRef(n);return J0(()=>{e.current=n}),e}function LW(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[u,d]=F.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=F.useState(r);mx(h,r)||p(r);const[g,x]=F.useState(null),[y,b]=F.useState(null),C=F.useCallback(O=>{O!==E.current&&(E.current=O,x(O))},[]),S=F.useCallback(O=>{O!==_.current&&(_.current=O,b(O))},[]),k=s||g,N=i||y,E=F.useRef(null),_=F.useRef(null),$=F.useRef(u),T=l!=null,D=ow(l),A=ow(o),M=ow(c),j=F.useCallback(()=>{if(!E.current||!_.current)return;const O={placement:e,strategy:t,middleware:h};A.current&&(O.platform=A.current),PW(E.current,_.current,O).then(V=>{const W={...V,isPositioned:M.current!==!1};L.current&&!mx($.current,W)&&($.current=W,xv.flushSync(()=>{d(W)}))})},[h,e,t,A,M]);J0(()=>{c===!1&&$.current.isPositioned&&($.current.isPositioned=!1,d(O=>({...O,isPositioned:!1})))},[c]);const L=F.useRef(!1);J0(()=>(L.current=!0,()=>{L.current=!1}),[]),J0(()=>{if(k&&(E.current=k),N&&(_.current=N),k&&N){if(D.current)return D.current(k,N,j);j()}},[k,N,j,D,T]);const U=F.useMemo(()=>({reference:E,floating:_,setReference:C,setFloating:S}),[C,S]),G=F.useMemo(()=>({reference:k,floating:N}),[k,N]),H=F.useMemo(()=>{const O={position:t,left:0,top:0};if(!G.floating)return O;const V=WS(G.floating,u.x),W=WS(G.floating,u.y);return a?{...O,transform:"translate("+V+"px, "+W+"px)",...PT(G.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:V,top:W}},[t,a,G.floating,u.x,u.y]);return F.useMemo(()=>({...u,update:j,refs:U,elements:G,floatingStyles:H}),[u,j,U,G,H])}const BW=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:o}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?zS({element:r.current,padding:o}).fn(t):{}:r?zS({element:r,padding:o}).fn(t):{}}}},jW=(n,e)=>({...RW(n),options:[n,e]}),VW=(n,e)=>({...DW(n),options:[n,e]}),zW=(n,e)=>({...FW(n),options:[n,e]}),WW=(n,e)=>({...AW(n),options:[n,e]}),UW=(n,e)=>({..._W(n),options:[n,e]}),HW=(n,e)=>({...$W(n),options:[n,e]}),GW=(n,e)=>({...BW(n),options:[n,e]});var qW="Arrow",MT=F.forwardRef((n,e)=>{const{children:t,width:r=10,height:o=5,...s}=n;return v.jsx(Br.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:v.jsx("polygon",{points:"0,0 30,0 15,10"})})});MT.displayName=qW;var KW=MT;function XW(n){const[e,t]=F.useState(void 0);return ql(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=n.offsetWidth,a=n.offsetHeight;t({width:i,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var OT="Popper",[LT,BT]=Im(OT),[Z8e,jT]=LT(OT),VT="PopperAnchor",zT=F.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...o}=n,s=jT(VT,t),i=F.useRef(null),a=hs(e,i),l=F.useRef(null);return F.useEffect(()=>{const c=l.current;l.current=r?.current||i.current,c!==l.current&&s.onAnchorChange(l.current)}),r?null:v.jsx(Br.div,{...o,ref:a})});zT.displayName=VT;var y4="PopperContent",[YW,ZW]=LT(y4),WT=F.forwardRef((n,e)=>{const{__scopePopper:t,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:g,...x}=n,y=jT(y4,t),[b,C]=F.useState(null),S=hs(e,he=>C(he)),[k,N]=F.useState(null),E=XW(k),_=E?.width??0,$=E?.height??0,T=r+(s!=="center"?"-"+s:""),D=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},A=Array.isArray(c)?c:[c],M=A.length>0,j={padding:D,boundary:A.filter(JW),altBoundary:M},{refs:L,floatingStyles:U,placement:G,isPositioned:H,middlewareData:O}=LW({strategy:"fixed",placement:T,whileElementsMounted:(...he)=>TW(...he,{animationFrame:p==="always"}),elements:{reference:y.anchor},middleware:[jW({mainAxis:o+$,alignmentAxis:i}),l&&VW({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?zW():void 0,...j}),l&&WW({...j}),UW({...j,apply:({elements:he,rects:Se,availableWidth:Re,availableHeight:We})=>{const{width:Be,height:Xe}=Se.reference,Ye=he.floating.style;Ye.setProperty("--radix-popper-available-width",`${Re}px`),Ye.setProperty("--radix-popper-available-height",`${We}px`),Ye.setProperty("--radix-popper-anchor-width",`${Be}px`),Ye.setProperty("--radix-popper-anchor-height",`${Xe}px`)}}),k&&GW({element:k,padding:a}),eU({arrowWidth:_,arrowHeight:$}),h&&HW({strategy:"referenceHidden",...j})]}),[V,W]=GT(G),B=al(g);ql(()=>{H&&B?.()},[H,B]);const q=O.arrow?.x,Q=O.arrow?.y,Z=O.arrow?.centerOffset!==0,[ne,ge]=F.useState();return ql(()=>{b&&ge(window.getComputedStyle(b).zIndex)},[b]),v.jsx("div",{ref:L.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:H?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ne,"--radix-popper-transform-origin":[O.transformOrigin?.x,O.transformOrigin?.y].join(" "),...O.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:v.jsx(YW,{scope:t,placedSide:V,onArrowChange:N,arrowX:q,arrowY:Q,shouldHideArrow:Z,children:v.jsx(Br.div,{"data-side":V,"data-align":W,...x,ref:S,style:{...x.style,animation:H?void 0:"none"}})})})});WT.displayName=y4;var UT="PopperArrow",QW={top:"bottom",right:"left",bottom:"top",left:"right"},HT=F.forwardRef(function(e,t){const{__scopePopper:r,...o}=e,s=ZW(UT,r),i=QW[s.placedSide];return v.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:v.jsx(KW,{...o,ref:t,style:{...o.style,display:"block"}})})});HT.displayName=UT;function JW(n){return n!==null}var eU=n=>({name:"transformOrigin",options:n,fn(e){const{placement:t,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:n.arrowWidth,l=i?0:n.arrowHeight,[c,u]=GT(t),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",x="";return c==="bottom"?(g=i?d:`${h}px`,x=`${-l}px`):c==="top"?(g=i?d:`${h}px`,x=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,x=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,x=i?d:`${p}px`),{data:{x:g,y:x}}}});function GT(n){const[e,t="center"]=n.split("-");return[e,t]}var tU=zT,nU=WT,rU=HT,[Nv]=Im("Tooltip",[BT]),b4=BT(),qT="TooltipProvider",oU=700,US="tooltip.open",[sU,KT]=Nv(qT),XT=n=>{const{__scopeTooltip:e,delayDuration:t=oU,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:s}=n,i=F.useRef(!0),a=F.useRef(!1),l=F.useRef(0);return F.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),v.jsx(sU,{scope:e,isOpenDelayedRef:i,delayDuration:t,onOpen:F.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:F.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:F.useCallback(c=>{a.current=c},[]),disableHoverableContent:o,children:s})};XT.displayName=qT;var YT="Tooltip",[Q8e,Iv]=Nv(YT),W3="TooltipTrigger",iU=F.forwardRef((n,e)=>{const{__scopeTooltip:t,...r}=n,o=Iv(W3,t),s=KT(W3,t),i=b4(t),a=F.useRef(null),l=hs(e,a,o.onTriggerChange),c=F.useRef(!1),u=F.useRef(!1),d=F.useCallback(()=>c.current=!1,[]);return F.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),v.jsx(tU,{asChild:!0,...i,children:v.jsx(Br.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:l,onPointerMove:rr(n.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!s.isPointerInTransitRef.current&&(o.onTriggerEnter(),u.current=!0)}),onPointerLeave:rr(n.onPointerLeave,()=>{o.onTriggerLeave(),u.current=!1}),onPointerDown:rr(n.onPointerDown,()=>{o.open&&o.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:rr(n.onFocus,()=>{c.current||o.onOpen()}),onBlur:rr(n.onBlur,o.onClose),onClick:rr(n.onClick,o.onClose)})})});iU.displayName=W3;var aU="TooltipPortal",[J8e,lU]=Nv(aU,{forceMount:void 0}),lf="TooltipContent",ZT=F.forwardRef((n,e)=>{const t=lU(lf,n.__scopeTooltip),{forceMount:r=t.forceMount,side:o="top",...s}=n,i=Iv(lf,n.__scopeTooltip);return v.jsx(Sf,{present:r||i.open,children:i.disableHoverableContent?v.jsx(QT,{side:o,...s,ref:e}):v.jsx(cU,{side:o,...s,ref:e})})}),cU=F.forwardRef((n,e)=>{const t=Iv(lf,n.__scopeTooltip),r=KT(lf,n.__scopeTooltip),o=F.useRef(null),s=hs(e,o),[i,a]=F.useState(null),{trigger:l,onClose:c}=t,u=o.current,{onPointerInTransitChange:d}=r,h=F.useCallback(()=>{a(null),d(!1)},[d]),p=F.useCallback((g,x)=>{const y=g.currentTarget,b={x:g.clientX,y:g.clientY},C=pU(b,y.getBoundingClientRect()),S=mU(b,C),k=gU(x.getBoundingClientRect()),N=vU([...S,...k]);a(N),d(!0)},[d]);return F.useEffect(()=>()=>h(),[h]),F.useEffect(()=>{if(l&&u){const g=y=>p(y,u),x=y=>p(y,l);return l.addEventListener("pointerleave",g),u.addEventListener("pointerleave",x),()=>{l.removeEventListener("pointerleave",g),u.removeEventListener("pointerleave",x)}}},[l,u,p,h]),F.useEffect(()=>{if(i){const g=x=>{const y=x.target,b={x:x.clientX,y:x.clientY},C=l?.contains(y)||u?.contains(y),S=!xU(b,i);C?h():S&&(h(),c())};return document.addEventListener("pointermove",g),()=>document.removeEventListener("pointermove",g)}},[l,u,i,c,h]),v.jsx(QT,{...n,ref:s})}),[uU,dU]=Nv(YT,{isInside:!1}),hU=kj("TooltipContent"),QT=F.forwardRef((n,e)=>{const{__scopeTooltip:t,children:r,"aria-label":o,onEscapeKeyDown:s,onPointerDownOutside:i,...a}=n,l=Iv(lf,t),c=b4(t),{onClose:u}=l;return F.useEffect(()=>(document.addEventListener(US,u),()=>document.removeEventListener(US,u)),[u]),F.useEffect(()=>{if(l.trigger){const d=h=>{h.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),v.jsx(vv,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:v.jsxs(nU,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[v.jsx(hU,{children:r}),v.jsx(uU,{scope:t,isInside:!0,children:v.jsx(qj,{id:l.contentId,role:"tooltip",children:o||r})})]})})});ZT.displayName=lf;var JT="TooltipArrow",fU=F.forwardRef((n,e)=>{const{__scopeTooltip:t,...r}=n,o=b4(t);return dU(JT,t).isInside?null:v.jsx(rU,{...o,...r,ref:e})});fU.displayName=JT;function pU(n,e){const t=Math.abs(e.top-n.y),r=Math.abs(e.bottom-n.y),o=Math.abs(e.right-n.x),s=Math.abs(e.left-n.x);switch(Math.min(t,r,o,s)){case s:return"left";case o:return"right";case t:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function mU(n,e,t=5){const r=[];switch(e){case"top":r.push({x:n.x-t,y:n.y+t},{x:n.x+t,y:n.y+t});break;case"bottom":r.push({x:n.x-t,y:n.y-t},{x:n.x+t,y:n.y-t});break;case"left":r.push({x:n.x+t,y:n.y-t},{x:n.x+t,y:n.y+t});break;case"right":r.push({x:n.x-t,y:n.y-t},{x:n.x-t,y:n.y+t});break}return r}function gU(n){const{top:e,right:t,bottom:r,left:o}=n;return[{x:o,y:e},{x:t,y:e},{x:t,y:r},{x:o,y:r}]}function xU(n,e){const{x:t,y:r}=n;let o=!1;for(let s=0,i=e.length-1;s<e.length;i=s++){const a=e[s],l=e[i],c=a.x,u=a.y,d=l.x,h=l.y;u>r!=h>r&&t<(d-c)*(r-u)/(h-u)+c&&(o=!o)}return o}function vU(n){const e=n.slice();return e.sort((t,r)=>t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0),yU(e)}function yU(n){if(n.length<=1)return n.slice();const e=[];for(let r=0;r<n.length;r++){const o=n[r];for(;e.length>=2;){const s=e[e.length-1],i=e[e.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))e.pop();else break}e.push(o)}e.pop();const t=[];for(let r=n.length-1;r>=0;r--){const o=n[r];for(;t.length>=2;){const s=t[t.length-1],i=t[t.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))t.pop();else break}t.push(o)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var bU=XT,eR=ZT;const wU=bU,CU=F.forwardRef(({className:n,sideOffset:e=4,...t},r)=>v.jsx(eR,{ref:r,sideOffset:e,className:li("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...t}));CU.displayName=eR.displayName;var Ev=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},kU={setTimeout:(n,e)=>setTimeout(n,e),clearTimeout:n=>clearTimeout(n),setInterval:(n,e)=>setInterval(n,e),clearInterval:n=>clearInterval(n)},SU=class{#e=kU;#t=!1;setTimeoutProvider(n){this.#e=n}setTimeout(n,e){return this.#e.setTimeout(n,e)}clearTimeout(n){this.#e.clearTimeout(n)}setInterval(n,e){return this.#e.setInterval(n,e)}clearInterval(n){this.#e.clearInterval(n)}},U3=new SU;function NU(n){setTimeout(n,0)}var Tv=typeof window>"u"||"Deno"in globalThis;function ta(){}function IU(n,e){return typeof n=="function"?n(e):n}function EU(n){return typeof n=="number"&&n>=0&&n!==1/0}function TU(n,e){return Math.max(n+(e||0)-Date.now(),0)}function H3(n,e){return typeof n=="function"?n(e):n}function RU(n,e){return typeof n=="function"?n(e):n}function HS(n,e){const{type:t="all",exact:r,fetchStatus:o,predicate:s,queryKey:i,stale:a}=n;if(i){if(r){if(e.queryHash!==w4(i,e.options))return!1}else if(!nm(e.queryKey,i))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||o&&o!==e.state.fetchStatus||s&&!s(e))}function GS(n,e){const{exact:t,status:r,predicate:o,mutationKey:s}=n;if(s){if(!e.options.mutationKey)return!1;if(t){if(tm(e.options.mutationKey)!==tm(s))return!1}else if(!nm(e.options.mutationKey,s))return!1}return!(r&&e.state.status!==r||o&&!o(e))}function w4(n,e){return(e?.queryKeyHashFn||tm)(n)}function tm(n){return JSON.stringify(n,(e,t)=>G3(t)?Object.keys(t).sort().reduce((r,o)=>(r[o]=t[o],r),{}):t)}function nm(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?Object.keys(e).every(t=>nm(n[t],e[t])):!1}var DU=Object.prototype.hasOwnProperty;function tR(n,e){if(n===e)return n;const t=qS(n)&&qS(e);if(!t&&!(G3(n)&&G3(e)))return e;const o=(t?n:Object.keys(n)).length,s=t?e:Object.keys(e),i=s.length,a=t?new Array(i):{};let l=0;for(let c=0;c<i;c++){const u=t?c:s[c],d=n[u],h=e[u];if(d===h){a[u]=d,(t?c<o:DU.call(n,u))&&l++;continue}if(d===null||h===null||typeof d!="object"||typeof h!="object"){a[u]=h;continue}const p=tR(d,h);a[u]=p,p===d&&l++}return o===i&&l===o?n:a}function qS(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function G3(n){if(!KS(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!KS(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function KS(n){return Object.prototype.toString.call(n)==="[object Object]"}function AU(n){return new Promise(e=>{U3.setTimeout(e,n)})}function _U(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?tR(n,e):e}function $U(n,e,t=0){const r=[...n,e];return t&&r.length>t?r.slice(1):r}function FU(n,e,t=0){const r=[e,...n];return t&&r.length>t?r.slice(0,-1):r}var C4=Symbol();function nR(n,e){return!n.queryFn&&e?.initialPromise?()=>e.initialPromise:!n.queryFn||n.queryFn===C4?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var PU=class extends Ev{#e;#t;#n;constructor(){super(),this.#n=n=>{if(!Tv&&window.addEventListener){const e=()=>n();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#n=n,this.#t?.(),this.#t=n(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(n){this.#e!==n&&(this.#e=n,this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(e=>{e(n)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},rR=new PU;function MU(){let n,e;const t=new Promise((o,s)=>{n=o,e=s});t.status="pending",t.catch(()=>{});function r(o){Object.assign(t,o),delete t.resolve,delete t.reject}return t.resolve=o=>{r({status:"fulfilled",value:o}),n(o)},t.reject=o=>{r({status:"rejected",reason:o}),e(o)},t}var OU=NU;function LU(){let n=[],e=0,t=a=>{a()},r=a=>{a()},o=OU;const s=a=>{e?n.push(a):o(()=>{t(a)})},i=()=>{const a=n;n=[],a.length&&o(()=>{r(()=>{a.forEach(l=>{t(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||i()}return l},batchCalls:a=>(...l)=>{s(()=>{a(...l)})},schedule:s,setNotifyFunction:a=>{t=a},setBatchNotifyFunction:a=>{r=a},setScheduler:a=>{o=a}}}var ls=LU(),BU=class extends Ev{#e=!0;#t;#n;constructor(){super(),this.#n=n=>{if(!Tv&&window.addEventListener){const e=()=>n(!0),t=()=>n(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#n=n,this.#t?.(),this.#t=n(this.setOnline.bind(this))}setOnline(n){this.#e!==n&&(this.#e=n,this.listeners.forEach(t=>{t(n)}))}isOnline(){return this.#e}},gx=new BU;function jU(n){return Math.min(1e3*2**n,3e4)}function oR(n){return(n??"online")==="online"?gx.isOnline():!0}var q3=class extends Error{constructor(n){super("CancelledError"),this.revert=n?.revert,this.silent=n?.silent}};function sR(n){let e=!1,t=0,r;const o=MU(),s=()=>o.status!=="pending",i=x=>{if(!s()){const y=new q3(x);h(y),n.onCancel?.(y)}},a=()=>{e=!0},l=()=>{e=!1},c=()=>rR.isFocused()&&(n.networkMode==="always"||gx.isOnline())&&n.canRun(),u=()=>oR(n.networkMode)&&n.canRun(),d=x=>{s()||(r?.(),o.resolve(x))},h=x=>{s()||(r?.(),o.reject(x))},p=()=>new Promise(x=>{r=y=>{(s()||c())&&x(y)},n.onPause?.()}).then(()=>{r=void 0,s()||n.onContinue?.()}),g=()=>{if(s())return;let x;const y=t===0?n.initialPromise:void 0;try{x=y??n.fn()}catch(b){x=Promise.reject(b)}Promise.resolve(x).then(d).catch(b=>{if(s())return;const C=n.retry??(Tv?0:3),S=n.retryDelay??jU,k=typeof S=="function"?S(t,b):S,N=C===!0||typeof C=="number"&&t<C||typeof C=="function"&&C(t,b);if(e||!N){h(b);return}t++,n.onFail?.(t,b),AU(k).then(()=>c()?void 0:p()).then(()=>{e?h(b):g()})})};return{promise:o,status:()=>o.status,cancel:i,continue:()=>(r?.(),o),cancelRetry:a,continueRetry:l,canStart:u,start:()=>(u()?g():p().then(g),o)}}var iR=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),EU(this.gcTime)&&(this.#e=U3.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(Tv?1/0:300*1e3))}clearGcTimeout(){this.#e&&(U3.clearTimeout(this.#e),this.#e=void 0)}},VU=class extends iR{#e;#t;#n;#o;#r;#i;#a;constructor(n){super(),this.#a=!1,this.#i=n.defaultOptions,this.setOptions(n.options),this.observers=[],this.#o=n.client,this.#n=this.#o.getQueryCache(),this.queryKey=n.queryKey,this.queryHash=n.queryHash,this.#e=XS(this.options),this.state=n.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(n){if(this.options={...this.#i,...n},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=XS(this.options);e.data!==void 0&&(this.setData(e.data,{updatedAt:e.dataUpdatedAt,manual:!0}),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(n,e){const t=_U(this.state.data,n,this.options);return this.#s({data:t,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),t}setState(n,e){this.#s({type:"setState",state:n,setStateOptions:e})}cancel(n){const e=this.#r?.promise;return this.#r?.cancel(n),e?e.then(ta).catch(ta):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(n=>RU(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===C4||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(n=>H3(n.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(n=0){return this.state.data===void 0?!0:n==="static"?!1:this.state.isInvalidated?!0:!TU(this.state.dataUpdatedAt,n)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(e=>e!==n),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(n,e){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(n&&this.setOptions(n),!this.options.queryFn){const a=this.observers.find(l=>l.options.queryFn);a&&this.setOptions(a.options)}const t=new AbortController,r=a=>{Object.defineProperty(a,"signal",{enumerable:!0,get:()=>(this.#a=!0,t.signal)})},o=()=>{const a=nR(this.options,e),c=(()=>{const u={client:this.#o,queryKey:this.queryKey,meta:this.meta};return r(u),u})();return this.#a=!1,this.options.persister?this.options.persister(a,c,this):a(c)},i=(()=>{const a={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#o,state:this.state,fetchFn:o};return r(a),a})();this.options.behavior?.onFetch(i,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==i.fetchOptions?.meta)&&this.#s({type:"fetch",meta:i.fetchOptions?.meta}),this.#r=sR({initialPromise:e?.initialPromise,fn:i.fetchFn,onCancel:a=>{a instanceof q3&&a.revert&&this.setState({...this.#t,fetchStatus:"idle"}),t.abort()},onFail:(a,l)=>{this.#s({type:"failed",failureCount:a,error:l})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0});try{const a=await this.#r.start();if(a===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(a),this.#n.config.onSuccess?.(a,this),this.#n.config.onSettled?.(a,this.state.error,this),a}catch(a){if(a instanceof q3){if(a.silent)return this.#r.promise;if(a.revert){if(this.state.data===void 0)throw a;return this.state.data}}throw this.#s({type:"error",error:a}),this.#n.config.onError?.(a,this),this.#n.config.onSettled?.(this.state.data,a,this),a}finally{this.scheduleGc()}}#s(n){const e=t=>{switch(n.type){case"failed":return{...t,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...zU(t.data,this.options),fetchMeta:n.meta??null};case"success":const r={...t,data:n.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:n.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=n.manual?r:void 0,r;case"error":const o=n.error;return{...t,error:o,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...n.state}}};this.state=e(this.state),ls.batch(()=>{this.observers.forEach(t=>{t.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:n})})}};function zU(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:oR(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function XS(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,r=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}function YS(n){return{onFetch:(e,t)=>{const r=e.options,o=e.fetchOptions?.meta?.fetchMore?.direction,s=e.state.data?.pages||[],i=e.state.data?.pageParams||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let u=!1;const d=g=>{Object.defineProperty(g,"signal",{enumerable:!0,get:()=>(e.signal.aborted?u=!0:e.signal.addEventListener("abort",()=>{u=!0}),e.signal)})},h=nR(e.options,e.fetchOptions),p=async(g,x,y)=>{if(u)return Promise.reject();if(x==null&&g.pages.length)return Promise.resolve(g);const C=(()=>{const E={client:e.client,queryKey:e.queryKey,pageParam:x,direction:y?"backward":"forward",meta:e.options.meta};return d(E),E})(),S=await h(C),{maxPages:k}=e.options,N=y?FU:$U;return{pages:N(g.pages,S,k),pageParams:N(g.pageParams,x,k)}};if(o&&s.length){const g=o==="backward",x=g?WU:ZS,y={pages:s,pageParams:i},b=x(r,y);a=await p(y,b,g)}else{const g=n??s.length;do{const x=l===0?i[0]??r.initialPageParam:ZS(r,a);if(l>0&&x==null)break;a=await p(a,x),l++}while(l<g)}return a};e.options.persister?e.fetchFn=()=>e.options.persister?.(c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t):e.fetchFn=c}}}function ZS(n,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?n.getNextPageParam(e[r],e,t[r],t):void 0}function WU(n,{pages:e,pageParams:t}){return e.length>0?n.getPreviousPageParam?.(e[0],e,t[0],t):void 0}var UU=class extends iR{#e;#t;#n;#o;constructor(n){super(),this.#e=n.client,this.mutationId=n.mutationId,this.#n=n.mutationCache,this.#t=[],this.state=n.state||HU(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){this.#t.includes(n)||(this.#t.push(n),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){this.#t=this.#t.filter(e=>e!==n),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#o?.continue()??this.execute(this.state.variables)}async execute(n){const e=()=>{this.#r({type:"continue"})},t={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#o=sR({fn:()=>this.options.mutationFn?this.options.mutationFn(n,t):Promise.reject(new Error("No mutationFn found")),onFail:(s,i)=>{this.#r({type:"failed",failureCount:s,error:i})},onPause:()=>{this.#r({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const r=this.state.status==="pending",o=!this.#o.canStart();try{if(r)e();else{this.#r({type:"pending",variables:n,isPaused:o}),await this.#n.config.onMutate?.(n,this,t);const i=await this.options.onMutate?.(n,t);i!==this.state.context&&this.#r({type:"pending",context:i,variables:n,isPaused:o})}const s=await this.#o.start();return await this.#n.config.onSuccess?.(s,n,this.state.context,this,t),await this.options.onSuccess?.(s,n,this.state.context,t),await this.#n.config.onSettled?.(s,null,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(s,null,n,this.state.context,t),this.#r({type:"success",data:s}),s}catch(s){try{throw await this.#n.config.onError?.(s,n,this.state.context,this,t),await this.options.onError?.(s,n,this.state.context,t),await this.#n.config.onSettled?.(void 0,s,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(void 0,s,n,this.state.context,t),s}finally{this.#r({type:"error",error:s})}}finally{this.#n.runNext(this)}}#r(n){const e=t=>{switch(n.type){case"failed":return{...t,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...t,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:n.error,failureCount:t.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=e(this.state),ls.batch(()=>{this.#t.forEach(t=>{t.onMutationUpdate(n)}),this.#n.notify({mutation:this,type:"updated",action:n})})}};function HU(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var GU=class extends Ev{constructor(n={}){super(),this.config=n,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(n,e,t){const r=new UU({client:n,mutationCache:this,mutationId:++this.#n,options:n.defaultMutationOptions(e),state:t});return this.add(r),r}add(n){this.#e.add(n);const e=m0(n);if(typeof e=="string"){const t=this.#t.get(e);t?t.push(n):this.#t.set(e,[n])}this.notify({type:"added",mutation:n})}remove(n){if(this.#e.delete(n)){const e=m0(n);if(typeof e=="string"){const t=this.#t.get(e);if(t)if(t.length>1){const r=t.indexOf(n);r!==-1&&t.splice(r,1)}else t[0]===n&&this.#t.delete(e)}}this.notify({type:"removed",mutation:n})}canRun(n){const e=m0(n);if(typeof e=="string"){const r=this.#t.get(e)?.find(o=>o.state.status==="pending");return!r||r===n}else return!0}runNext(n){const e=m0(n);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==n&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ls.batch(()=>{this.#e.forEach(n=>{this.notify({type:"removed",mutation:n})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(n){const e={exact:!0,...n};return this.getAll().find(t=>GS(e,t))}findAll(n={}){return this.getAll().filter(e=>GS(n,e))}notify(n){ls.batch(()=>{this.listeners.forEach(e=>{e(n)})})}resumePausedMutations(){const n=this.getAll().filter(e=>e.state.isPaused);return ls.batch(()=>Promise.all(n.map(e=>e.continue().catch(ta))))}};function m0(n){return n.options.scope?.id}var qU=class extends Ev{constructor(n={}){super(),this.config=n,this.#e=new Map}#e;build(n,e,t){const r=e.queryKey,o=e.queryHash??w4(r,e);let s=this.get(o);return s||(s=new VU({client:n,queryKey:r,queryHash:o,options:n.defaultQueryOptions(e),state:t,defaultOptions:n.getQueryDefaults(r)}),this.add(s)),s}add(n){this.#e.has(n.queryHash)||(this.#e.set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const e=this.#e.get(n.queryHash);e&&(n.destroy(),e===n&&this.#e.delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){ls.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return this.#e.get(n)}getAll(){return[...this.#e.values()]}find(n){const e={exact:!0,...n};return this.getAll().find(t=>HS(e,t))}findAll(n={}){const e=this.getAll();return Object.keys(n).length>0?e.filter(t=>HS(n,t)):e}notify(n){ls.batch(()=>{this.listeners.forEach(e=>{e(n)})})}onFocus(){ls.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){ls.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},KU=class{#e;#t;#n;#o;#r;#i;#a;#s;constructor(n={}){this.#e=n.queryCache||new qU,this.#t=n.mutationCache||new GU,this.#n=n.defaultOptions||{},this.#o=new Map,this.#r=new Map,this.#i=0}mount(){this.#i++,this.#i===1&&(this.#a=rR.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=gx.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#i--,this.#i===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(n){return this.#e.findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return this.#t.findAll({...n,status:"pending"}).length}getQueryData(n){const e=this.defaultQueryOptions({queryKey:n});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=this.#e.build(this,e),r=t.state.data;return r===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(H3(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(n){return this.#e.findAll(n).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(n,e,t){const r=this.defaultQueryOptions({queryKey:n}),s=this.#e.get(r.queryHash)?.state.data,i=IU(e,s);if(i!==void 0)return this.#e.build(this,r).setData(i,{...t,manual:!0})}setQueriesData(n,e,t){return ls.batch(()=>this.#e.findAll(n).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(n){const e=this.defaultQueryOptions({queryKey:n});return this.#e.get(e.queryHash)?.state}removeQueries(n){const e=this.#e;ls.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=this.#e;return ls.batch(()=>(t.findAll(n).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...n},e)))}cancelQueries(n,e={}){const t={revert:!0,...e},r=ls.batch(()=>this.#e.findAll(n).map(o=>o.cancel(t)));return Promise.all(r).then(ta).catch(ta)}invalidateQueries(n,e={}){return ls.batch(()=>(this.#e.findAll(n).forEach(t=>{t.invalidate()}),n?.refetchType==="none"?Promise.resolve():this.refetchQueries({...n,type:n?.refetchType??n?.type??"active"},e)))}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},r=ls.batch(()=>this.#e.findAll(n).filter(o=>!o.isDisabled()&&!o.isStatic()).map(o=>{let s=o.fetch(void 0,t);return t.throwOnError||(s=s.catch(ta)),o.state.fetchStatus==="paused"?Promise.resolve():s}));return Promise.all(r).then(ta)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=this.#e.build(this,e);return t.isStaleByTime(H3(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(ta).catch(ta)}fetchInfiniteQuery(n){return n.behavior=YS(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(ta).catch(ta)}ensureInfiniteQueryData(n){return n.behavior=YS(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return gx.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(n){this.#n=n}setQueryDefaults(n,e){this.#o.set(tm(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...this.#o.values()],t={};return e.forEach(r=>{nm(n,r.queryKey)&&Object.assign(t,r.defaultOptions)}),t}setMutationDefaults(n,e){this.#r.set(tm(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...this.#r.values()],t={};return e.forEach(r=>{nm(n,r.mutationKey)&&Object.assign(t,r.defaultOptions)}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...this.#n.queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=w4(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===C4&&(e.enabled=!1),e}defaultMutationOptions(n){return n?._defaulted?n:{...this.#n.mutations,...n?.mutationKey&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},XU=F.createContext(void 0),YU=({client:n,children:e})=>(F.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),v.jsx(XU.Provider,{value:n,children:e}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rm(){return rm=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},rm.apply(this,arguments)}var jc;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(jc||(jc={}));const QS="popstate";function ZU(n){n===void 0&&(n={});function e(r,o){let{pathname:s,search:i,hash:a}=r.location;return K3("",{pathname:s,search:i,hash:a},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function t(r,o){return typeof o=="string"?o:lR(o)}return JU(e,t,null,n)}function Xr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function aR(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function QU(){return Math.random().toString(36).substr(2,8)}function JS(n,e){return{usr:n.state,key:n.key,idx:e}}function K3(n,e,t,r){return t===void 0&&(t=null),rm({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Tf(e):e,{state:t,key:e&&e.key||r||QU()})}function lR(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Tf(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function JU(n,e,t,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:s=!1}=r,i=o.history,a=jc.Pop,l=null,c=u();c==null&&(c=0,i.replaceState(rm({},i.state,{idx:c}),""));function u(){return(i.state||{idx:null}).idx}function d(){a=jc.Pop;let y=u(),b=y==null?null:y-c;c=y,l&&l({action:a,location:x.location,delta:b})}function h(y,b){a=jc.Push;let C=K3(x.location,y,b);c=u()+1;let S=JS(C,c),k=x.createHref(C);try{i.pushState(S,"",k)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;o.location.assign(k)}s&&l&&l({action:a,location:x.location,delta:1})}function p(y,b){a=jc.Replace;let C=K3(x.location,y,b);c=u();let S=JS(C,c),k=x.createHref(C);i.replaceState(S,"",k),s&&l&&l({action:a,location:x.location,delta:0})}function g(y){let b=o.location.origin!=="null"?o.location.origin:o.location.href,C=typeof y=="string"?y:lR(y);return C=C.replace(/ $/,"%20"),Xr(b,"No window.location.(origin|href) available to create URL for href: "+C),new URL(C,b)}let x={get action(){return a},get location(){return n(o,i)},listen(y){if(l)throw new Error("A history only accepts one active listener");return o.addEventListener(QS,d),l=y,()=>{o.removeEventListener(QS,d),l=null}},createHref(y){return e(o,y)},createURL:g,encodeLocation(y){let b=g(y);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:h,replace:p,go(y){return i.go(y)}};return x}var eN;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(eN||(eN={}));function eH(n,e,t){return t===void 0&&(t="/"),tH(n,e,t)}function tH(n,e,t,r){let o=typeof e=="string"?Tf(e):e,s=dR(o.pathname||"/",t);if(s==null)return null;let i=cR(n);nH(i);let a=null;for(let l=0;a==null&&l<i.length;++l){let c=pH(s);a=dH(i[l],c)}return a}function cR(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let o=(s,i,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:i,route:s};l.relativePath.startsWith("/")&&(Xr(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=ad([r,l.relativePath]),u=t.concat(l);s.children&&s.children.length>0&&(Xr(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),cR(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:cH(c,s.index),routesMeta:u})};return n.forEach((s,i)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))o(s,i);else for(let l of uR(s.path))o(s,i,l)}),e}function uR(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,o=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return o?[s,""]:[s];let i=uR(r.join("/")),a=[];return a.push(...i.map(l=>l===""?s:[s,l].join("/"))),o&&a.push(...i),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function nH(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:uH(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const rH=/^:[\w-]+$/,oH=3,sH=2,iH=1,aH=10,lH=-2,tN=n=>n==="*";function cH(n,e){let t=n.split("/"),r=t.length;return t.some(tN)&&(r+=lH),e&&(r+=sH),t.filter(o=>!tN(o)).reduce((o,s)=>o+(rH.test(s)?oH:s===""?iH:aH),r)}function uH(n,e){return n.length===e.length&&n.slice(0,-1).every((r,o)=>r===e[o])?n[n.length-1]-e[e.length-1]:0}function dH(n,e,t){let{routesMeta:r}=n,o={},s="/",i=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=hH({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d)return null;Object.assign(o,d.params),i.push({params:o,pathname:ad([s,d.pathname]),pathnameBase:bH(ad([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=ad([s,d.pathnameBase]))}return i}function hH(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=fH(n.path,n.caseSensitive,n.end),o=e.match(t);if(!o)return null;let s=o[0],i=s.replace(/(.)\/+$/,"$1"),a=o.slice(1);return{params:r.reduce((c,u,d)=>{let{paramName:h,isOptional:p}=u;if(h==="*"){let x=a[d]||"";i=s.slice(0,s.length-x.length).replace(/(.)\/+$/,"$1")}const g=a[d];return p&&!g?c[h]=void 0:c[h]=(g||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:i,pattern:n}}function fH(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),aR(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,e?void 0:"i"),r]}function pH(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return aR(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function dR(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function mH(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:o=""}=typeof n=="string"?Tf(n):n;return{pathname:t?t.startsWith("/")?t:gH(t,e):e,search:wH(r),hash:CH(o)}}function gH(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?t.length>1&&t.pop():o!=="."&&t.push(o)}),t.length>1?t.join("/"):"/"}function sw(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function xH(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function vH(n,e){let t=xH(n);return e?t.map((r,o)=>o===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function yH(n,e,t,r){r===void 0&&(r=!1);let o;typeof n=="string"?o=Tf(n):(o=rm({},n),Xr(!o.pathname||!o.pathname.includes("?"),sw("?","pathname","search",o)),Xr(!o.pathname||!o.pathname.includes("#"),sw("#","pathname","hash",o)),Xr(!o.search||!o.search.includes("#"),sw("#","search","hash",o)));let s=n===""||o.pathname==="",i=s?"/":o.pathname,a;if(i==null)a=t;else{let d=e.length-1;if(!r&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),d-=1;o.pathname=h.join("/")}a=d>=0?e[d]:"/"}let l=mH(o,a),c=i&&i!=="/"&&i.endsWith("/"),u=(s||i===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const ad=n=>n.join("/").replace(/\/\/+/g,"/"),bH=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),wH=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,CH=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function kH(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const hR=["post","put","patch","delete"];new Set(hR);const SH=["get",...hR];new Set(SH);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function om(){return om=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},om.apply(this,arguments)}const k4=F.createContext(null),NH=F.createContext(null),Rv=F.createContext(null),Dv=F.createContext(null),Rf=F.createContext({outlet:null,matches:[],isDataRoute:!1}),fR=F.createContext(null);function Av(){return F.useContext(Dv)!=null}function Rm(){return Av()||Xr(!1),F.useContext(Dv).location}function pR(n){F.useContext(Rv).static||F.useLayoutEffect(n)}function ci(){let{isDataRoute:n}=F.useContext(Rf);return n?LH():IH()}function IH(){Av()||Xr(!1);let n=F.useContext(k4),{basename:e,future:t,navigator:r}=F.useContext(Rv),{matches:o}=F.useContext(Rf),{pathname:s}=Rm(),i=JSON.stringify(vH(o,t.v7_relativeSplatPath)),a=F.useRef(!1);return pR(()=>{a.current=!0}),F.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){r.go(c);return}let d=yH(c,JSON.parse(i),s,u.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:ad([e,d.pathname])),(u.replace?r.replace:r.push)(d,u.state,u)},[e,r,i,s,n])}function EH(n,e){return TH(n,e)}function TH(n,e,t,r){Av()||Xr(!1);let{navigator:o}=F.useContext(Rv),{matches:s}=F.useContext(Rf),i=s[s.length-1],a=i?i.params:{};i&&i.pathname;let l=i?i.pathnameBase:"/";i&&i.route;let c=Rm(),u;if(e){var d;let y=typeof e=="string"?Tf(e):e;l==="/"||(d=y.pathname)!=null&&d.startsWith(l)||Xr(!1),u=y}else u=c;let h=u.pathname||"/",p=h;if(l!=="/"){let y=l.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let g=eH(n,{pathname:p}),x=$H(g&&g.map(y=>Object.assign({},y,{params:Object.assign({},a,y.params),pathname:ad([l,o.encodeLocation?o.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?l:ad([l,o.encodeLocation?o.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),s,t,r);return e&&x?F.createElement(Dv.Provider,{value:{location:om({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:jc.Pop}},x):x}function RH(){let n=OH(),e=kH(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return F.createElement(F.Fragment,null,F.createElement("h2",null,"Unexpected Application Error!"),F.createElement("h3",{style:{fontStyle:"italic"}},e),t?F.createElement("pre",{style:o},t):null,null)}const DH=F.createElement(RH,null);class AH extends F.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?F.createElement(Rf.Provider,{value:this.props.routeContext},F.createElement(fR.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function _H(n){let{routeContext:e,match:t,children:r}=n,o=F.useContext(k4);return o&&o.static&&o.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=t.route.id),F.createElement(Rf.Provider,{value:e},r)}function $H(n,e,t,r){var o;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var s;if(!t)return null;if(t.errors)n=t.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,a=(o=t)==null?void 0:o.errors;if(a!=null){let u=i.findIndex(d=>d.route.id&&a?.[d.route.id]!==void 0);u>=0||Xr(!1),i=i.slice(0,Math.min(i.length,u+1))}let l=!1,c=-1;if(t&&r&&r.v7_partialHydration)for(let u=0;u<i.length;u++){let d=i[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:h,errors:p}=t,g=d.route.loader&&h[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||g){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}return i.reduceRight((u,d,h)=>{let p,g=!1,x=null,y=null;t&&(p=a&&d.route.id?a[d.route.id]:void 0,x=d.route.errorElement||DH,l&&(c<0&&h===0?(BH("route-fallback"),g=!0,y=null):c===h&&(g=!0,y=d.route.hydrateFallbackElement||null)));let b=e.concat(i.slice(0,h+1)),C=()=>{let S;return p?S=x:g?S=y:d.route.Component?S=F.createElement(d.route.Component,null):d.route.element?S=d.route.element:S=u,F.createElement(_H,{match:d,routeContext:{outlet:u,matches:b,isDataRoute:t!=null},children:S})};return t&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?F.createElement(AH,{location:t.location,revalidation:t.revalidation,component:x,error:p,children:C(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):C()},null)}var mR=(function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n})(mR||{}),gR=(function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n})(gR||{});function FH(n){let e=F.useContext(k4);return e||Xr(!1),e}function PH(n){let e=F.useContext(NH);return e||Xr(!1),e}function MH(n){let e=F.useContext(Rf);return e||Xr(!1),e}function xR(n){let e=MH(),t=e.matches[e.matches.length-1];return t.route.id||Xr(!1),t.route.id}function OH(){var n;let e=F.useContext(fR),t=PH(),r=xR();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function LH(){let{router:n}=FH(mR.UseNavigateStable),e=xR(gR.UseNavigateStable),t=F.useRef(!1);return pR(()=>{t.current=!0}),F.useCallback(function(o,s){s===void 0&&(s={}),t.current&&(typeof o=="number"?n.navigate(o):n.navigate(o,om({fromRouteId:e},s)))},[n,e])}const nN={};function BH(n,e,t){nN[n]||(nN[n]=!0)}function jH(n,e){n?.v7_startTransition,n?.v7_relativeSplatPath}function is(n){Xr(!1)}function VH(n){let{basename:e="/",children:t=null,location:r,navigationType:o=jc.Pop,navigator:s,static:i=!1,future:a}=n;Av()&&Xr(!1);let l=e.replace(/^\/*/,"/"),c=F.useMemo(()=>({basename:l,navigator:s,static:i,future:om({v7_relativeSplatPath:!1},a)}),[l,a,s,i]);typeof r=="string"&&(r=Tf(r));let{pathname:u="/",search:d="",hash:h="",state:p=null,key:g="default"}=r,x=F.useMemo(()=>{let y=dR(u,l);return y==null?null:{location:{pathname:y,search:d,hash:h,state:p,key:g},navigationType:o}},[l,u,d,h,p,g,o]);return x==null?null:F.createElement(Rv.Provider,{value:c},F.createElement(Dv.Provider,{children:t,value:x}))}function zH(n){let{children:e,location:t}=n;return EH(X3(e),t)}new Promise(()=>{});function X3(n,e){e===void 0&&(e=[]);let t=[];return F.Children.forEach(n,(r,o)=>{if(!F.isValidElement(r))return;let s=[...e,o];if(r.type===F.Fragment){t.push.apply(t,X3(r.props.children,s));return}r.type!==is&&Xr(!1),!r.props.index||!r.props.children||Xr(!1);let i={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=X3(r.props.children,s)),t.push(i)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Y3(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let r=n[t];return e.concat(Array.isArray(r)?r.map(o=>[t,o]):[[t,r]])},[]))}function WH(n,e){let t=Y3(n);return e&&e.forEach((r,o)=>{t.has(o)||e.getAll(o).forEach(s=>{t.append(o,s)})}),t}const UH="6";try{window.__reactRouterVersion=UH}catch{}const HH="startTransition",rN=a4[HH];function GH(n){let{basename:e,children:t,future:r,window:o}=n,s=F.useRef();s.current==null&&(s.current=ZU({window:o,v5Compat:!0}));let i=s.current,[a,l]=F.useState({action:i.action,location:i.location}),{v7_startTransition:c}=r||{},u=F.useCallback(d=>{c&&rN?rN(()=>l(d)):l(d)},[l,c]);return F.useLayoutEffect(()=>i.listen(u),[i,u]),F.useEffect(()=>jH(r),[r]),F.createElement(VH,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:i,future:r})}var oN;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(oN||(oN={}));var sN;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(sN||(sN={}));function qH(n){let e=F.useRef(Y3(n)),t=F.useRef(!1),r=Rm(),o=F.useMemo(()=>WH(r.search,t.current?null:e.current),[r.search]),s=ci(),i=F.useCallback((a,l)=>{const c=Y3(typeof a=="function"?a(o):a);t.current=!0,s("?"+c,l)},[s,o]);return[o,i]}function KH({onMobileMenuToggle:n,isMobileMenuOpen:e}){return v.jsxs("header",{className:"flex w-full h-10 sm:h-11 px-3 sm:px-4 items-center justify-between flex-shrink-0 border-b border-border bg-background",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("div",{className:"w-[68px] h-[35px] flex-shrink-0 relative",children:v.jsxs("svg",{className:"w-[62px] h-[14px] flex-shrink-0 absolute left-[1px] top-[10.5px]",width:"64",height:"15",viewBox:"0 0 64 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M19.6451 5.60708C20.4605 4.62689 21.4477 4.13672 22.6065 4.13672C23.2074 4.13672 23.76 4.30211 24.2643 4.63275C24.7686 4.96347 25.1548 5.38861 25.4231 5.90825L25.5679 4.29617H27.6281V14.0394H25.5679L25.4231 12.4096C25.1548 12.9293 24.7686 13.3544 24.2643 13.6851C23.76 14.0158 23.2074 14.1811 22.6065 14.1811C21.4477 14.1811 20.4605 13.691 19.6451 12.7107C18.8296 11.7187 18.4219 10.5318 18.4219 9.15007C18.4219 7.76827 18.8296 6.58727 19.6451 5.60708ZM21.3833 10.957C21.8339 11.4648 22.3812 11.7187 23.025 11.7187C23.6795 11.7187 24.2321 11.4707 24.6827 10.9747C25.1334 10.4668 25.3587 9.85864 25.3587 9.15007C25.3587 8.4415 25.1334 7.83916 24.6827 7.34313C24.2321 6.83529 23.6795 6.58141 23.025 6.58141C22.3812 6.58141 21.8339 6.83529 21.3833 7.34313C20.9327 7.83916 20.7073 8.4415 20.7073 9.15007C20.7073 9.85864 20.9327 10.461 21.3833 10.957ZM29.5129 4.29617H31.573L31.734 5.69564C32.2598 4.71545 33.1343 4.22535 34.3575 4.22535C34.6686 4.22535 34.9369 4.24896 35.1622 4.29617L34.6954 6.68771C34.5667 6.6641 34.4755 6.65223 34.4219 6.65223C33.6707 6.65223 33.0431 6.90618 32.5387 7.41402C32.0344 7.90998 31.7823 8.7544 31.7823 9.9472V14.0394H29.5129V4.29617ZM37.3457 5.62482C38.2255 4.64456 39.2932 4.15446 40.5485 4.15446C41.2996 4.15446 42.0025 4.34932 42.657 4.73906C43.3115 5.11698 43.8534 5.63069 44.2825 6.28024L42.4156 7.6443C41.9542 7.00655 41.3319 6.68771 40.5485 6.68771C39.9262 6.68771 39.3951 6.92979 38.9551 7.41402C38.5153 7.89818 38.2953 8.48277 38.2953 9.16781C38.2953 9.86457 38.5153 10.455 38.9551 10.9393C39.3951 11.4235 39.9262 11.6656 40.5485 11.6656C41.3748 11.6656 42.0078 11.3113 42.4477 10.6027L44.3308 11.9844C43.9124 12.6576 43.3705 13.195 42.7052 13.5965C42.04 13.998 41.3211 14.1988 40.5485 14.1988C39.2932 14.1988 38.2202 13.7087 37.3296 12.7285C36.4498 11.7365 36.0098 10.5495 36.0098 9.16781C36.0098 7.78601 36.4551 6.60501 37.3457 5.62482ZM46.619 5.62482C47.4989 4.64456 48.5665 4.15446 49.8219 4.15446C51.0773 4.15446 52.1503 4.65049 53.0409 5.64249C53.9422 6.62275 54.3929 7.79781 54.3929 9.16781C54.3929 10.5495 53.9476 11.7305 53.057 12.7107C52.1557 13.7028 51.0773 14.1988 49.8219 14.1988C48.5665 14.1988 47.4935 13.7087 46.603 12.7285C45.7231 11.7365 45.2832 10.5495 45.2832 9.16781C45.2832 7.78601 45.7285 6.60501 46.619 5.62482ZM47.5687 9.16781C47.5687 9.86457 47.7886 10.455 48.2285 10.9393C48.6685 11.4235 49.1996 11.6656 49.8219 11.6656C50.455 11.6656 50.9915 11.4235 51.4314 10.9393C51.8713 10.455 52.0913 9.86457 52.0913 9.16781C52.0913 8.48277 51.8713 7.89818 51.4314 7.41402C50.9915 6.92979 50.455 6.68771 49.8219 6.68771C49.1996 6.68771 48.6685 6.92979 48.2285 7.41402C47.7886 7.89818 47.5687 8.48277 47.5687 9.16781ZM55.8398 14.0394V4.29617H57.9L58.0448 5.71338C58.3024 5.24096 58.6404 4.86303 59.0588 4.5796C59.488 4.28437 59.9709 4.13672 60.5073 4.13672C61.5803 4.13672 62.428 4.54419 63.0504 5.35906C63.6834 6.17393 63.9999 7.40808 63.9999 9.0615V14.0394H61.7466V9.0615C61.7466 8.24663 61.5696 7.63249 61.2155 7.21915C60.8722 6.79401 60.443 6.58141 59.928 6.58141C59.4022 6.58141 58.9676 6.79401 58.6243 7.21915C58.2809 7.63249 58.1092 8.24663 58.1092 9.0615V14.0394H55.8398Z",fill:"#323238"}),v.jsx("path",{d:"M14.3486 12.068C14.6548 12.6673 14.2196 13.3786 13.5466 13.3786H3.02185C2.3453 13.3786 1.91028 12.6605 2.22355 12.0608L7.54372 1.87698C7.8823 1.22887 8.81128 1.23303 9.14404 1.88415L14.3486 12.068Z",stroke:"#D83A52",strokeWidth:"2.42826"})]})}),v.jsx("svg",{className:"w-0 h-5 flex-shrink-0 stroke-1 stroke-border",width:"2",height:"21",viewBox:"0 0 2 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M1 0.332031V20.332",stroke:"#D0D4E4"})}),v.jsx("div",{className:"flex w-[86px] h-[35px] p-[5.5px_3.313px_7px_3px] justify-center items-center flex-shrink-0",children:v.jsxs("svg",{className:"w-20 h-[23px] flex-shrink-0",width:"80",height:"23",viewBox:"0 0 80 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_2641_20372)",children:v.jsx("path",{d:"M1.79875 10.5468C1.79875 9.30919 1.17188 8.28658 0 7.42773H2.72375C3.2039 7.79347 3.59293 8.26535 3.86041 8.80645C4.1279 9.34755 4.26659 9.94321 4.26563 10.5468C4.26659 11.1504 4.1279 11.7461 3.86041 12.2872C3.59293 12.8283 3.2039 13.3002 2.72375 13.6659C3.60813 14.0347 4.11125 14.9348 4.11125 16.2231V18.6777H1.645V16.2231C1.645 14.9961 1.05938 14.1372 0.000625 13.6666C1.1725 12.8071 1.79875 11.7845 1.79875 10.5468ZM7.14375 10.5468C7.14375 9.30919 6.51688 8.28658 5.345 7.42773H8.06938C8.54941 7.79354 8.93832 8.26544 9.20569 8.80654C9.47307 9.34764 9.61166 9.94326 9.61063 10.5468C9.61166 11.1504 9.47307 11.746 9.20569 12.2871C8.93832 12.8282 8.54941 13.3001 8.06938 13.6659C8.95313 14.0347 9.45688 14.9348 9.45688 16.2231V18.6777H6.99V16.2231C6.99 14.9961 6.40375 14.1372 5.345 13.6666C6.51688 12.8071 7.14375 11.4524 7.14375 10.5468ZM12.49 10.5468C12.49 9.30919 11.8631 8.28658 10.6913 7.42773H13.415C13.8951 7.79347 14.2842 8.26535 14.5517 8.80645C14.8191 9.34755 14.9578 9.94321 14.9569 10.5468C14.9578 11.1504 14.8191 11.7461 14.5517 12.2872C14.2842 12.8283 13.8951 13.3002 13.415 13.6659C14.2994 14.0347 14.8025 14.9348 14.8025 16.2231V18.6777H12.3356V16.2231C12.3356 14.9961 11.75 14.1372 10.6913 13.6666C11.8631 12.8071 12.49 11.7845 12.49 10.5468ZM22.47 16.6338H20.6V9.47296H25.195C27.405 9.47296 28.4944 10.2918 28.4944 11.6313C28.4944 12.5414 27.96 13.2265 26.9631 13.5747C27.9906 13.7278 28.4531 14.2697 28.4531 15.2417V16.6325H26.5619V15.3236C26.5619 14.5048 26.1506 14.1779 25.0713 14.1779H22.4713V16.6338H22.47ZM25.0913 10.5162H22.47V13.1352H25.0706C26.0163 13.1352 26.6019 12.6133 26.6019 11.7951C26.6019 10.9869 26.0581 10.5162 25.0913 10.5162ZM31.7419 9.47296H29.8713V16.6338H31.7419V9.47296ZM37.4775 14.3004H35.1956V16.6325H33.3244V9.47296H37.5181C39.7281 9.47296 40.89 10.3937 40.89 11.867C40.89 13.3903 39.7081 14.3004 37.4775 14.3004ZM37.4363 10.5162H35.1956V13.2571H37.4156C38.3819 13.2571 38.9781 12.7665 38.9781 11.877C38.9781 11.0075 38.3819 10.5162 37.4363 10.5162ZM46.1531 14.3004H43.8713V16.6325H42V9.47296H46.1938C48.4038 9.47296 49.5656 10.3937 49.5656 11.867C49.5656 13.3903 48.3831 14.3004 46.1531 14.3004ZM46.1119 10.5162H43.8713V13.2571H46.0913C47.0575 13.2571 47.6538 12.7665 47.6538 11.877C47.6538 11.0075 47.0575 10.5162 46.1119 10.5162ZM52.5463 9.47296V15.5686H57.2131V16.6338H50.6756V9.47296H52.5463ZM60.2544 9.47296H58.3838V16.6338H60.2544V9.47296ZM63.0713 11.8664V16.6338H61.8375V9.47296H63.2369L68.335 14.2391V9.47296H69.5688V16.6338H68.1706L63.0713 11.8664ZM75.675 10.3118C73.8963 10.3118 72.735 11.4369 72.735 13.114C72.735 14.7704 73.845 15.7937 75.5719 15.7937H75.695C76.2813 15.7937 76.9388 15.6705 77.5456 15.4768V13.5434H74.5238V12.5208H79.375V15.8855C78.3681 16.4075 76.8463 16.8169 75.6131 16.8169H75.4488C72.6113 16.8169 70.7819 15.323 70.7819 13.1546C70.7819 11.0069 72.6631 9.28919 75.5513 9.28919H75.7156C76.9188 9.28919 78.2956 9.66736 79.3138 10.2605L78.7788 11.1294C77.8644 10.6287 76.7744 10.3118 75.7981 10.3118H75.675Z",fill:"black"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_2641_20372",children:v.jsx("rect",{width:"79.6875",height:"22.5",fill:"white",transform:"translate(0 0.332031)"})})})]})})]}),v.jsx("div",{className:"sm:hidden",children:v.jsx("button",{onClick:()=>n&&n(),"aria-controls":"mobile-step-sidebar","aria-expanded":!!e,className:"flex items-center justify-center w-6 h-6",children:v.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M3 12.332H21M3 6.33203H21M3 18.332H21",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})})]})}function iN({sections:n,currentStep:e}){const t=n.map((r,o)=>({number:o+1,title:r.name,description:r.sectionType==="personalInformation"?"Please provide your basic personal information to begin the identity verification process.":r.sectionType==="documents"?"Choose a valid government-issued ID (like a passport, driver's license, or national ID) and upload a clear photo of it.":"Take a live selfie to confirm you are the person in the ID document.",isActive:o+1===e,isCompleted:o+1<e}));return v.jsx("aside",{className:"w-80 bg-white h-full",children:v.jsx("div",{className:"flex flex-col gap-1 p-2",children:t.map((r,o)=>v.jsx("div",{className:"relative",children:v.jsxs("div",{className:"flex items-start gap-3",children:[v.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[v.jsxs("div",{className:"relative",children:[v.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"flex-shrink-0",children:v.jsx("circle",{cx:"14",cy:"14",r:"13.25",fill:r.isActive||r.isCompleted?"#0073EA":"white",stroke:r.isActive||r.isCompleted?"#0073EA":"#D0D4E4",strokeWidth:"1.5"})}),v.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:v.jsx("span",{className:`font-roboto text-[13px] font-normal leading-none ${r.isActive||r.isCompleted?"text-white":"text-[#42526E]"}`,children:r.number})})]}),o<t.length-1&&v.jsx("div",{className:"mt-2 mb-2",children:v.jsx("div",{className:`w-0 h-16 sm:h-20 md:h-24 lg:h-28 xl:h-32 border-l-2 ${r.isCompleted?"border-[#0073EA]":"border-[#D0D4E4]"}`})})]}),v.jsx("div",{className:`flex-1 rounded-lg p-3 ${r.isActive?"bg-[#E6F1FD]":"bg-white"} ${o<t.length-1?"mb-1":""}`,children:v.jsxs("div",{className:"flex flex-col gap-1",children:[v.jsx("h3",{className:`font-roboto text-[15px] font-bold leading-6 ${r.isActive,"text-[#323238]"}`,children:r.title}),v.jsxs("div",{className:"font-roboto text-[13px] font-medium text-[#323238] leading-normal",children:["Step ",r.number]}),v.jsx("p",{className:`font-figtree text-[13px] font-normal leading-5 mt-1 ${r.isActive?"text-[#172B4D]":"text-[#42526E]"}`,children:r.description})]})})]})},r.number))})})}function XH({isOpen:n,onClose:e,onAgree:t}){const[r,o]=F.useState({shareDetails:!1,allowVerification:!1,dataStorage:!1,privacyPolicy:!1}),[s,i]=F.useState(!1),a=(d,h)=>{const p={...r,[d]:h};o(p);const g=Object.values(p).every(Boolean);i(g)},l=d=>{i(d),o({shareDetails:d,allowVerification:d,dataStorage:d,privacyPolicy:d})},c=Object.values(r).every(Boolean),u=()=>{c&&t()};return n?v.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:v.jsxs("div",{className:"flex w-full max-w-[800px] mx-4 flex-col items-center gap-6 rounded-lg bg-background shadow-lg max-h-[90vh] overflow-hidden",children:[v.jsx("div",{className:"flex h-[52px] py-2.5 px-5 justify-center items-center self-stretch rounded-t border-b border-border bg-background",children:v.jsx("div",{className:"text-text-primary font-figtree text-lg font-bold leading-[26px]",children:"Identity Verification Consent"})}),v.jsxs("div",{className:"flex py-3 px-5 flex-col items-start gap-4 self-stretch overflow-y-auto",children:[v.jsxs("div",{className:"flex flex-col items-start gap-4",children:[v.jsx("div",{className:"text-text-primary font-roboto text-base font-bold",children:"To verify your identity securely and meet legal requirements, we need your consent to:"}),v.jsx("div",{className:"flex flex-col items-start gap-2",children:["1. Use your personal details (name, email, phone, address, ID)","2. Scan your ID document (Aadhaar, PAN, or Passport)","3. Capture your selfie or video to confirm it's really you","4. Verify your ID with official sources (like DigiLocker or UIDAI)","5. Store your data for XX days for audit and compliance"].map((d,h)=>v.jsx("div",{className:"text-text-secondary font-roboto text-sm",children:d},h))})]}),v.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch",children:[v.jsx("div",{className:"text-text-primary font-roboto text-base font-bold",children:"Please Confirm"}),v.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch",children:[v.jsxs("div",{className:"flex items-center gap-2 self-stretch",children:[v.jsx("input",{type:"checkbox",id:"shareDetails",checked:r.shareDetails,onChange:d=>a("shareDetails",d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),v.jsx("label",{htmlFor:"shareDetails",className:"text-text-secondary font-roboto text-sm",children:"I agree to share my details, documents, and selfie/video for identity verification"})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("input",{type:"checkbox",id:"allowVerification",checked:r.allowVerification,onChange:d=>a("allowVerification",d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),v.jsx("label",{htmlFor:"allowVerification",className:"text-text-secondary font-roboto text-sm",children:"I allow my data to be verified with official authorities"})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("input",{type:"checkbox",id:"dataStorage",checked:r.dataStorage,onChange:d=>a("dataStorage",d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),v.jsx("label",{htmlFor:"dataStorage",className:"text-text-secondary font-roboto text-sm",children:"I understand my data will be stored for XX days after verification"})]})]})]}),v.jsx("div",{className:"flex items-start gap-2 self-stretch",children:v.jsxs("div",{className:"text-text-secondary font-roboto text-sm leading-normal",children:["By continuing, you agree to our terms and privacy policy. You can"," ",v.jsx("span",{className:"text-primary cursor-pointer hover:underline",children:"update your consent preferences or revoke consent here"}),". For more details, read our"," ",v.jsx("span",{className:"text-primary cursor-pointer hover:underline",children:"Privacy Policy"}),". If you have any questions or need help, feel free to reach out to us at amritemail.com."]})}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("input",{type:"checkbox",id:"privacyPolicy",checked:r.privacyPolicy,onChange:d=>a("privacyPolicy",d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),v.jsx("label",{htmlFor:"privacyPolicy",className:"text-text-secondary font-roboto text-sm",children:"I have read and agree to the Privacy Policy."})]})]}),v.jsxs("div",{className:"flex w-full h-[70px] py-5 px-5 justify-between items-center rounded-b border-t border-border bg-background shadow-sm",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("input",{type:"checkbox",id:"agreeToAll",checked:s,onChange:d=>l(d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),v.jsx("label",{htmlFor:"agreeToAll",className:"text-text-secondary font-roboto text-sm",children:"Agree to all"})]}),v.jsx("div",{className:"flex justify-end items-start",children:v.jsx("button",{onClick:u,disabled:!c,className:`flex h-8 py-2 px-4 justify-center items-center gap-2 rounded ${c?"bg-primary hover:bg-primary/90":"bg-primary/50 cursor-not-allowed"}`,children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"I Agree"})})})]})]})}):null}var iw="focusScope.autoFocusOnMount",aw="focusScope.autoFocusOnUnmount",aN={bubbles:!1,cancelable:!0},YH="FocusScope",vR=F.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=n,[a,l]=F.useState(null),c=al(o),u=al(s),d=F.useRef(null),h=hs(e,x=>l(x)),p=F.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;F.useEffect(()=>{if(r){let x=function(S){if(p.paused||!a)return;const k=S.target;a.contains(k)?d.current=k:Lc(d.current,{select:!0})},y=function(S){if(p.paused||!a)return;const k=S.relatedTarget;k!==null&&(a.contains(k)||Lc(d.current,{select:!0}))},b=function(S){if(document.activeElement===document.body)for(const N of S)N.removedNodes.length>0&&Lc(a)};document.addEventListener("focusin",x),document.addEventListener("focusout",y);const C=new MutationObserver(b);return a&&C.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",y),C.disconnect()}}},[r,a,p.paused]),F.useEffect(()=>{if(a){cN.add(p);const x=document.activeElement;if(!a.contains(x)){const b=new CustomEvent(iw,aN);a.addEventListener(iw,c),a.dispatchEvent(b),b.defaultPrevented||(ZH(nG(yR(a)),{select:!0}),document.activeElement===x&&Lc(a))}return()=>{a.removeEventListener(iw,c),setTimeout(()=>{const b=new CustomEvent(aw,aN);a.addEventListener(aw,u),a.dispatchEvent(b),b.defaultPrevented||Lc(x??document.body,{select:!0}),a.removeEventListener(aw,u),cN.remove(p)},0)}}},[a,c,u,p]);const g=F.useCallback(x=>{if(!t&&!r||p.paused)return;const y=x.key==="Tab"&&!x.altKey&&!x.ctrlKey&&!x.metaKey,b=document.activeElement;if(y&&b){const C=x.currentTarget,[S,k]=QH(C);S&&k?!x.shiftKey&&b===k?(x.preventDefault(),t&&Lc(S,{select:!0})):x.shiftKey&&b===S&&(x.preventDefault(),t&&Lc(k,{select:!0})):b===C&&x.preventDefault()}},[t,r,p.paused]);return v.jsx(Br.div,{tabIndex:-1,...i,ref:h,onKeyDown:g})});vR.displayName=YH;function ZH(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(Lc(r,{select:e}),document.activeElement!==t)return}function QH(n){const e=yR(n),t=lN(e,n),r=lN(e.reverse(),n);return[t,r]}function yR(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function lN(n,e){for(const t of n)if(!JH(t,{upTo:e}))return t}function JH(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function eG(n){return n instanceof HTMLInputElement&&"select"in n}function Lc(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&eG(n)&&e&&n.select()}}var cN=tG();function tG(){let n=[];return{add(e){const t=n[0];e!==t&&t?.pause(),n=uN(n,e),n.unshift(e)},remove(e){n=uN(n,e),n[0]?.resume()}}}function uN(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function nG(n){return n.filter(e=>e.tagName!=="A")}var lw=0;function rG(){F.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??dN()),document.body.insertAdjacentElement("beforeend",n[1]??dN()),lw++,()=>{lw===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),lw--}},[])}function dN(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var Ga=function(){return Ga=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ga.apply(this,arguments)};function bR(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t}function oG(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,s;r<o;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var ex="right-scroll-bar-position",tx="width-before-scroll-bar",sG="with-scroll-bars-hidden",iG="--removed-body-scroll-bar-size";function cw(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function aG(n,e){var t=F.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var o=t.value;o!==r&&(t.value=r,t.callback(r,o))}}}})[0];return t.callback=e,t.facade}var lG=typeof window<"u"?F.useLayoutEffect:F.useEffect,hN=new WeakMap;function cG(n,e){var t=aG(null,function(r){return n.forEach(function(o){return cw(o,r)})});return lG(function(){var r=hN.get(t);if(r){var o=new Set(r),s=new Set(n),i=t.current;o.forEach(function(a){s.has(a)||cw(a,null)}),s.forEach(function(a){o.has(a)||cw(a,i)})}hN.set(t,n)},[n]),t}function uG(n){return n}function dG(n,e){e===void 0&&(e=uG);var t=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var i=e(s,r);return t.push(i),function(){t=t.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(r=!0;t.length;){var i=t;t=[],i.forEach(s)}t={push:function(a){return s(a)},filter:function(){return t}}},assignMedium:function(s){r=!0;var i=[];if(t.length){var a=t;t=[],a.forEach(s),i=t}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),t}}}};return o}function hG(n){n===void 0&&(n={});var e=dG(null);return e.options=Ga({async:!0,ssr:!1},n),e}var wR=function(n){var e=n.sideCar,t=bR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return F.createElement(r,Ga({},t))};wR.isSideCarExport=!0;function fG(n,e){return n.useMedium(e),wR}var CR=hG(),uw=function(){},_v=F.forwardRef(function(n,e){var t=F.useRef(null),r=F.useState({onScrollCapture:uw,onWheelCapture:uw,onTouchMoveCapture:uw}),o=r[0],s=r[1],i=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,u=n.enabled,d=n.shards,h=n.sideCar,p=n.noRelative,g=n.noIsolation,x=n.inert,y=n.allowPinchZoom,b=n.as,C=b===void 0?"div":b,S=n.gapMode,k=bR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),N=h,E=cG([t,e]),_=Ga(Ga({},k),o);return F.createElement(F.Fragment,null,u&&F.createElement(N,{sideCar:CR,removeScrollBar:c,shards:d,noRelative:p,noIsolation:g,inert:x,setCallbacks:s,allowPinchZoom:!!y,lockRef:t,gapMode:S}),i?F.cloneElement(F.Children.only(a),Ga(Ga({},_),{ref:E})):F.createElement(C,Ga({},_,{className:l,ref:E}),a))});_v.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};_v.classNames={fullWidth:tx,zeroRight:ex};var pG=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function mG(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=pG();return e&&n.setAttribute("nonce",e),n}function gG(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function xG(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var vG=function(){var n=0,e=null;return{add:function(t){n==0&&(e=mG())&&(gG(e,t),xG(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},yG=function(){var n=vG();return function(e,t){F.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},kR=function(){var n=yG(),e=function(t){var r=t.styles,o=t.dynamic;return n(r,o),null};return e},bG={left:0,top:0,right:0,gap:0},dw=function(n){return parseInt(n||"",10)||0},wG=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],o=e[n==="padding"?"paddingRight":"marginRight"];return[dw(t),dw(r),dw(o)]},CG=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return bG;var e=wG(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},kG=kR(),Gh="data-scroll-locked",SG=function(n,e,t,r){var o=n.left,s=n.top,i=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(sG,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Gh,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(ex,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(tx,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(ex," .").concat(ex,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(tx," .").concat(tx,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Gh,`] {
    `).concat(iG,": ").concat(a,`px;
  }
`)},fN=function(){var n=parseInt(document.body.getAttribute(Gh)||"0",10);return isFinite(n)?n:0},NG=function(){F.useEffect(function(){return document.body.setAttribute(Gh,(fN()+1).toString()),function(){var n=fN()-1;n<=0?document.body.removeAttribute(Gh):document.body.setAttribute(Gh,n.toString())}},[])},IG=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,o=r===void 0?"margin":r;NG();var s=F.useMemo(function(){return CG(o)},[o]);return F.createElement(kG,{styles:SG(s,!e,o,t?"":"!important")})},Z3=!1;if(typeof window<"u")try{var g0=Object.defineProperty({},"passive",{get:function(){return Z3=!0,!0}});window.addEventListener("test",g0,g0),window.removeEventListener("test",g0,g0)}catch{Z3=!1}var Ih=Z3?{passive:!1}:!1,EG=function(n){return n.tagName==="TEXTAREA"},SR=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!EG(n)&&t[e]==="visible")},TG=function(n){return SR(n,"overflowY")},RG=function(n){return SR(n,"overflowX")},pN=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=NR(n,r);if(o){var s=IR(n,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},DG=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},AG=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},NR=function(n,e){return n==="v"?TG(e):RG(e)},IR=function(n,e){return n==="v"?DG(e):AG(e)},_G=function(n,e){return n==="h"&&e==="rtl"?-1:1},$G=function(n,e,t,r,o){var s=_G(n,window.getComputedStyle(e).direction),i=s*r,a=t.target,l=e.contains(a),c=!1,u=i>0,d=0,h=0;do{if(!a)break;var p=IR(n,a),g=p[0],x=p[1],y=p[2],b=x-y-s*g;(g||b)&&NR(n,a)&&(d+=b,h+=g);var C=a.parentNode;a=C&&C.nodeType===Node.DOCUMENT_FRAGMENT_NODE?C.host:C}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},x0=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},mN=function(n){return[n.deltaX,n.deltaY]},gN=function(n){return n&&"current"in n?n.current:n},FG=function(n,e){return n[0]===e[0]&&n[1]===e[1]},PG=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},MG=0,Eh=[];function OG(n){var e=F.useRef([]),t=F.useRef([0,0]),r=F.useRef(),o=F.useState(MG++)[0],s=F.useState(kR)[0],i=F.useRef(n);F.useEffect(function(){i.current=n},[n]),F.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(o));var x=oG([n.lockRef.current],(n.shards||[]).map(gN),!0).filter(Boolean);return x.forEach(function(y){return y.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),x.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(o))})}}},[n.inert,n.lockRef.current,n.shards]);var a=F.useCallback(function(x,y){if("touches"in x&&x.touches.length===2||x.type==="wheel"&&x.ctrlKey)return!i.current.allowPinchZoom;var b=x0(x),C=t.current,S="deltaX"in x?x.deltaX:C[0]-b[0],k="deltaY"in x?x.deltaY:C[1]-b[1],N,E=x.target,_=Math.abs(S)>Math.abs(k)?"h":"v";if("touches"in x&&_==="h"&&E.type==="range")return!1;var $=pN(_,E);if(!$)return!0;if($?N=_:(N=_==="v"?"h":"v",$=pN(_,E)),!$)return!1;if(!r.current&&"changedTouches"in x&&(S||k)&&(r.current=N),!N)return!0;var T=r.current||N;return $G(T,y,x,T==="h"?S:k)},[]),l=F.useCallback(function(x){var y=x;if(!(!Eh.length||Eh[Eh.length-1]!==s)){var b="deltaY"in y?mN(y):x0(y),C=e.current.filter(function(N){return N.name===y.type&&(N.target===y.target||y.target===N.shadowParent)&&FG(N.delta,b)})[0];if(C&&C.should){y.cancelable&&y.preventDefault();return}if(!C){var S=(i.current.shards||[]).map(gN).filter(Boolean).filter(function(N){return N.contains(y.target)}),k=S.length>0?a(y,S[0]):!i.current.noIsolation;k&&y.cancelable&&y.preventDefault()}}},[]),c=F.useCallback(function(x,y,b,C){var S={name:x,delta:y,target:b,should:C,shadowParent:LG(b)};e.current.push(S),setTimeout(function(){e.current=e.current.filter(function(k){return k!==S})},1)},[]),u=F.useCallback(function(x){t.current=x0(x),r.current=void 0},[]),d=F.useCallback(function(x){c(x.type,mN(x),x.target,a(x,n.lockRef.current))},[]),h=F.useCallback(function(x){c(x.type,x0(x),x.target,a(x,n.lockRef.current))},[]);F.useEffect(function(){return Eh.push(s),n.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Ih),document.addEventListener("touchmove",l,Ih),document.addEventListener("touchstart",u,Ih),function(){Eh=Eh.filter(function(x){return x!==s}),document.removeEventListener("wheel",l,Ih),document.removeEventListener("touchmove",l,Ih),document.removeEventListener("touchstart",u,Ih)}},[]);var p=n.removeScrollBar,g=n.inert;return F.createElement(F.Fragment,null,g?F.createElement(s,{styles:PG(o)}):null,p?F.createElement(IG,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function LG(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const BG=fG(CR,OG);var ER=F.forwardRef(function(n,e){return F.createElement(_v,Ga({},n,{ref:e,sideCar:BG}))});ER.classNames=_v.classNames;var jG=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Th=new WeakMap,v0=new WeakMap,y0={},hw=0,TR=function(n){return n&&(n.host||TR(n.parentNode))},VG=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=TR(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},zG=function(n,e,t,r){var o=VG(e,Array.isArray(n)?n:[n]);y0[t]||(y0[t]=new WeakMap);var s=y0[t],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var p=h.getAttribute(r),g=p!==null&&p!=="false",x=(Th.get(h)||0)+1,y=(s.get(h)||0)+1;Th.set(h,x),s.set(h,y),i.push(h),x===1&&g&&v0.set(h,!0),y===1&&h.setAttribute(t,"true"),g||h.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",h,b)}})};return u(e),a.clear(),hw++,function(){i.forEach(function(d){var h=Th.get(d)-1,p=s.get(d)-1;Th.set(d,h),s.set(d,p),h||(v0.has(d)||d.removeAttribute(r),v0.delete(d)),p||d.removeAttribute(t)}),hw--,hw||(Th=new WeakMap,Th=new WeakMap,v0=new WeakMap,y0={})}},WG=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),o=jG(n);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live], script"))),zG(r,o,t,"aria-hidden")):function(){return null}},$v="Dialog",[RR]=Im($v),[UG,ga]=RR($v),DR=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:o,onOpenChange:s,modal:i=!0}=n,a=F.useRef(null),l=F.useRef(null),[c,u]=U9({prop:r,defaultProp:o??!1,onChange:s,caller:$v});return v.jsx(UG,{scope:e,triggerRef:a,contentRef:l,contentId:nw(),titleId:nw(),descriptionId:nw(),open:c,onOpenChange:u,onOpenToggle:F.useCallback(()=>u(d=>!d),[u]),modal:i,children:t})};DR.displayName=$v;var AR="DialogTrigger",HG=F.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=ga(AR,t),s=hs(e,o.triggerRef);return v.jsx(Br.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":I4(o.open),...r,ref:s,onClick:rr(n.onClick,o.onOpenToggle)})});HG.displayName=AR;var S4="DialogPortal",[GG,_R]=RR(S4,{forceMount:void 0}),$R=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:o}=n,s=ga(S4,e);return v.jsx(GG,{scope:e,forceMount:t,children:F.Children.map(r,i=>v.jsx(Sf,{present:t||s.open,children:v.jsx(l4,{asChild:!0,container:o,children:i})}))})};$R.displayName=S4;var xx="DialogOverlay",FR=F.forwardRef((n,e)=>{const t=_R(xx,n.__scopeDialog),{forceMount:r=t.forceMount,...o}=n,s=ga(xx,n.__scopeDialog);return s.modal?v.jsx(Sf,{present:r||s.open,children:v.jsx(KG,{...o,ref:e})}):null});FR.displayName=xx;var qG=Qp("DialogOverlay.RemoveScroll"),KG=F.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=ga(xx,t);return v.jsx(ER,{as:qG,allowPinchZoom:!0,shards:[o.contentRef],children:v.jsx(Br.div,{"data-state":I4(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),fd="DialogContent",PR=F.forwardRef((n,e)=>{const t=_R(fd,n.__scopeDialog),{forceMount:r=t.forceMount,...o}=n,s=ga(fd,n.__scopeDialog);return v.jsx(Sf,{present:r||s.open,children:s.modal?v.jsx(XG,{...o,ref:e}):v.jsx(YG,{...o,ref:e})})});PR.displayName=fd;var XG=F.forwardRef((n,e)=>{const t=ga(fd,n.__scopeDialog),r=F.useRef(null),o=hs(e,t.contentRef,r);return F.useEffect(()=>{const s=r.current;if(s)return WG(s)},[]),v.jsx(MR,{...n,ref:o,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:rr(n.onCloseAutoFocus,s=>{s.preventDefault(),t.triggerRef.current?.focus()}),onPointerDownOutside:rr(n.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:rr(n.onFocusOutside,s=>s.preventDefault())})}),YG=F.forwardRef((n,e)=>{const t=ga(fd,n.__scopeDialog),r=F.useRef(!1),o=F.useRef(!1);return v.jsx(MR,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{n.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||t.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{n.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;t.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),MR=F.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=n,a=ga(fd,t),l=F.useRef(null),c=hs(e,l);return rG(),v.jsxs(v.Fragment,{children:[v.jsx(vR,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:v.jsx(vv,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":I4(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),v.jsxs(v.Fragment,{children:[v.jsx(ZG,{titleId:a.titleId}),v.jsx(JG,{contentRef:l,descriptionId:a.descriptionId})]})]})}),N4="DialogTitle",OR=F.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=ga(N4,t);return v.jsx(Br.h2,{id:o.titleId,...r,ref:e})});OR.displayName=N4;var LR="DialogDescription",BR=F.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=ga(LR,t);return v.jsx(Br.p,{id:o.descriptionId,...r,ref:e})});BR.displayName=LR;var jR="DialogClose",VR=F.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=ga(jR,t);return v.jsx(Br.button,{type:"button",...r,ref:e,onClick:rr(n.onClick,()=>o.onOpenChange(!1))})});VR.displayName=jR;function I4(n){return n?"open":"closed"}var zR="DialogTitleWarning",[e7e,WR]=yj(zR,{contentName:fd,titleName:N4,docsSlug:"dialog"}),ZG=({titleId:n})=>{const e=WR(zR),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return F.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},QG="DialogDescriptionWarning",JG=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${WR(QG).contentName}}.`;return F.useEffect(()=>{const o=n.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},eq=DR,tq=$R,UR=FR,HR=PR,GR=OR,qR=BR,KR=VR;const XR=eq,nq=tq,rq=KR,YR=F.forwardRef(({className:n,...e},t)=>v.jsx(UR,{ref:t,className:li("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e}));YR.displayName=UR.displayName;const E4=F.forwardRef(({className:n,children:e,...t},r)=>v.jsxs(nq,{children:[v.jsx(YR,{}),v.jsxs(HR,{ref:r,className:li("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...t,children:[e,v.jsxs(KR,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[v.jsx(pT,{className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));E4.displayName=HR.displayName;const ZR=({className:n,...e})=>v.jsx("div",{className:li("flex flex-col space-y-1.5 text-center sm:text-left",n),...e});ZR.displayName="DialogHeader";const T4=F.forwardRef(({className:n,...e},t)=>v.jsx(GR,{ref:t,className:li("text-lg font-semibold leading-none tracking-tight",n),...e}));T4.displayName=GR.displayName;const oq=F.forwardRef(({className:n,...e},t)=>v.jsx(qR,{ref:t,className:li("text-sm text-muted-foreground",n),...e}));oq.displayName=qR.displayName;const sq=hT("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),QR=F.forwardRef(({className:n,variant:e,size:t,asChild:r=!1,...o},s)=>{const i=r?wj:"button";return v.jsx(i,{className:li(sq({variant:e,size:t,className:n})),ref:s,...o})});QR.displayName="Button";function iq({isOpen:n,onClose:e}){return v.jsx(XR,{open:n,onOpenChange:t=>{t||e()},children:v.jsxs(E4,{className:"max-w-[320px] sm:max-w-[400px] lg:max-w-[800px] p-0 gap-0 bg-white border border-border rounded-lg",children:[v.jsxs(ZR,{className:"flex flex-row justify-between items-center p-4 sm:p-6 border-b border-border",children:[v.jsx(T4,{className:"text-[#172B4D] font-figtree text-lg sm:text-xl font-bold leading-[30px]",children:"How does this work?"}),v.jsx("button",{onClick:e,className:"flex items-center justify-center w-6 h-6",children:v.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M18 6.33203L6 18.332M6 6.33203L18 18.332",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),v.jsxs("div",{className:"lg:hidden flex flex-col p-4 gap-4 bg-white",children:[v.jsx("div",{className:"text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Continue Securely On Another Device"}),v.jsxs("div",{className:"flex flex-col items-start gap-4 p-4 bg-[#E6F1FD] rounded",children:[v.jsxs("div",{className:"flex items-center gap-3 self-stretch",children:[v.jsx("div",{className:"flex w-6 h-6 justify-center items-center rounded-full bg-[#0073EA]",children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"1"})}),v.jsxs("div",{className:"flex flex-col flex-1",children:[v.jsx("div",{className:"text-[#323238] font-roboto text-[15px] font-bold",children:"Personal Information"}),v.jsx("div",{className:"text-[#323238] font-roboto text-[13px] font-normal",children:"Step 1"})]})]}),v.jsx("div",{className:"text-[#172B4D] font-figtree text-[13px] font-normal leading-5",children:"Please provide your basic personal information to begin the identity verification process."})]}),v.jsxs("div",{className:"flex flex-col items-start gap-4 p-4 bg-white rounded border border-border",children:[v.jsxs("div",{className:"flex items-center gap-3 self-stretch",children:[v.jsx("div",{className:"flex w-6 h-6 justify-center items-center rounded-full border border-border bg-white",children:v.jsx("span",{className:"text-[#42526E] font-roboto text-[13px] font-medium",children:"2"})}),v.jsxs("div",{className:"flex flex-col flex-1",children:[v.jsx("div",{className:"text-[#323238] font-roboto text-[15px] font-bold",children:"Identity Document"}),v.jsx("div",{className:"text-[#323238] font-roboto text-[13px] font-normal",children:"Step 2"})]})]}),v.jsx("div",{className:"text-[#42526E] font-figtree text-[13px] font-normal leading-5",children:"Choose a valid government-issued ID (like a passport, driver's license, or national ID) and upload a clear photo of it."})]}),v.jsxs("div",{className:"flex flex-col items-start gap-4 p-4 bg-white rounded border border-border",children:[v.jsxs("div",{className:"flex items-center gap-3 self-stretch",children:[v.jsx("div",{className:"flex w-6 h-6 justify-center items-center rounded-full border border-border bg-white",children:v.jsx("span",{className:"text-[#42526E] font-roboto text-[13px] font-medium",children:"3"})}),v.jsxs("div",{className:"flex flex-col flex-1",children:[v.jsx("div",{className:"text-[#323238] font-roboto text-[15px] font-bold",children:"Capture Selfie"}),v.jsx("div",{className:"text-[#323238] font-roboto text-[13px] font-normal",children:"Step 3"})]})]}),v.jsx("div",{className:"text-[#42526E] font-figtree text-[13px] font-normal leading-5",children:"Take a live selfie to confirm you are the person in the ID document. Make sure you're in a well-lit area and your face is clearly visible."})]}),v.jsxs("div",{className:"flex items-center justify-center p-4 bg-[#BBDBC9] rounded gap-2",children:[v.jsx("svg",{className:"w-[18px] h-[18px]",viewBox:"0 0 18 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.52363 9.33203C1.5234 9.23168 1.50369 9.13141 1.46449 9.03691L0.923408 7.72684C0.809093 7.45094 0.750045 7.15477 0.75 6.85612C0.749952 6.55732 0.808785 6.26142 0.92313 5.98535C1.03747 5.70928 1.2051 5.45845 1.41642 5.24719C1.62769 5.03599 1.87849 4.86847 2.1545 4.7542L3.46245 4.21241C3.65187 4.13409 3.80295 3.98368 3.88181 3.79447L4.42373 2.48614C4.65456 1.92882 5.09734 1.48603 5.65465 1.25517C6.21196 1.02432 6.83815 1.02432 7.39546 1.25517L8.70278 1.79671C8.89252 1.87503 9.10575 1.87493 9.29535 1.79626L9.29685 1.79565L10.6053 1.25597C11.1624 1.02543 11.7887 1.02535 12.3458 1.2561C12.903 1.48691 13.3457 1.92958 13.5766 2.48674L14.1055 3.76367C14.1102 3.77375 14.1147 3.78397 14.119 3.79434C14.1974 3.98396 14.3478 4.13471 14.5372 4.21351L15.8459 4.75561C16.4032 4.98646 16.8461 5.42926 17.0769 5.98657C17.3077 6.54388 17.3077 7.17007 17.0769 7.72739L16.5351 9.03541C16.4957 9.13036 16.4761 9.23161 16.4761 9.33226C16.4761 9.43291 16.4957 9.53371 16.5351 9.62866L17.0769 10.9367C17.3077 11.494 17.3077 12.1202 17.0769 12.6775C16.8461 13.2348 16.4032 13.6776 15.8459 13.9085L14.5372 14.4506C14.3478 14.5294 14.1974 14.6801 14.119 14.8697C14.1147 14.8801 14.1102 14.8903 14.1055 14.9004L13.5766 16.1773C13.3457 16.7345 12.903 17.1772 12.3458 17.408C11.7887 17.6387 11.1624 17.6387 10.6053 17.4081L9.29685 16.8684L9.29535 16.8678C9.10575 16.7891 8.89252 16.7891 8.70278 16.8674L7.39546 17.4089C6.83815 17.6398 6.21196 17.6398 5.65465 17.4089C5.09734 17.178 4.65456 16.7352 4.42373 16.178L3.88181 14.8696C3.80295 14.6804 3.65187 14.53 3.46245 14.4517L2.1545 13.9099C1.87849 13.7956 1.62769 13.6281 1.41642 13.4169C1.2051 13.2056 1.03747 12.9548 0.92313 12.6787C0.808785 12.4026 0.749952 12.1067 0.75 11.8079C0.750045 11.5093 0.809093 11.2131 0.923408 10.9372L1.46449 9.62716C1.50369 9.53266 1.5234 9.43238 1.52363 9.33203ZM12.1553 7.98736C12.4482 7.69447 12.4482 7.2196 12.1553 6.9267C11.8624 6.63381 11.3876 6.63381 11.0947 6.9267L8.25 9.77138L7.28033 8.80171C6.98744 8.50883 6.51256 8.50883 6.21967 8.80171C5.92678 9.09458 5.92678 9.56948 6.21967 9.86236L7.71968 11.3624C8.01255 11.6552 8.48745 11.6552 8.78032 11.3624L12.1553 7.98736Z",fill:"#258750"})}),v.jsx("div",{className:"text-[#172B4D] font-roboto text-[12px] font-normal leading-[22px]",children:"Complete the previous steps to enable selfie capture."})]})]}),v.jsxs("div",{className:"hidden lg:flex flex-col items-center gap-6 p-6 bg-white",children:[v.jsx("div",{className:"text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Continue Securely On Another Device"}),v.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-8 w-full max-w-[705px]",children:[v.jsxs("div",{className:"flex flex-col items-center gap-4 min-w-[194px]",children:[v.jsxs("div",{className:"relative w-[183px] h-[183px]",children:[v.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-[#C3C6D4] bg-white"}),v.jsx("div",{className:"absolute inset-[7px] rounded-full bg-gradient-to-br from-[rgba(0,115,234,0.1)] to-[rgba(255,255,255,0.1)]"}),v.jsxs("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[85px] h-[124px]",viewBox:"0 0 85 125",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M34.5 11H23.5V23",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round"}),v.jsx("path",{d:"M46.5 69L57.5 69L57.5 58",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round"}),v.jsx("path",{d:"M46.5 11H57.5V23",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round"}),v.jsx("path",{d:"M34.5 69L23.5 69L23.5 58",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round"}),v.jsx("rect",{x:"16.5",y:"1.5",width:"46",height:"68",stroke:"#0073EA",strokeWidth:"2",rx:"2",fill:"none"})]})]}),v.jsxs("div",{className:"flex flex-col items-center gap-1",children:[v.jsx("div",{className:"text-[#0073EA] font-roboto text-[15px] font-bold",children:"Step 1"}),v.jsx("div",{className:"w-[194px] text-[#676879] text-center font-roboto text-[13px] font-normal leading-5",children:"Scan this QR code with your device's camera. (mobile or tablet for example)"})]})]}),v.jsx("div",{className:"hidden lg:block",children:v.jsxs("svg",{className:"w-9 h-9 text-[#323238]",viewBox:"0 0 37 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M20 26.25L27.5 18.75L20 11.25M9.5 26.25L17 18.75L9.5 11.25",stroke:"url(#paint0_linear_arrow1)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("defs",{children:v.jsxs("linearGradient",{id:"paint0_linear_arrow1",x1:"26",y1:"10.5",x2:"5",y2:"11",gradientUnits:"userSpaceOnUse",children:[v.jsx("stop",{offset:"0.246914",stopColor:"#323238"}),v.jsx("stop",{offset:"1",stopColor:"white",stopOpacity:"0"})]})})]})}),v.jsxs("div",{className:"flex flex-col items-center gap-4 min-w-[187px]",children:[v.jsxs("div",{className:"relative w-[183px] h-[183px]",children:[v.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-[#C3C6D4] bg-white"}),v.jsx("div",{className:"absolute inset-[7px] rounded-full bg-gradient-to-br from-[rgba(0,115,234,0.1)] to-[rgba(255,255,255,0.1)]"}),v.jsxs("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[100px] h-[122px]",viewBox:"0 0 101 122",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M42.5 68.4115V5.83815C42.5 3.19916 44.8845 1 47.865 1H90.135C93.0614 1 95.5 3.15029 95.5 5.83815V89.1618C95.5 91.8008 93.1155 94 90.135 94H68",stroke:"#0073EA",strokeWidth:"1.95513",strokeLinecap:"round"}),v.jsx("rect",{x:"54.5",y:"26.5",width:"29",height:"15",stroke:"#323238",strokeWidth:"2",rx:"1",fill:"none"}),v.jsx("rect",{x:"54.5",y:"11.5",width:"29",height:"8",stroke:"#323238",strokeWidth:"2",rx:"1",fill:"none"}),v.jsx("g",{filter:"url(#filter0_d_phone)",children:v.jsx("rect",{x:"54.5",y:"49",width:"31",height:"10",stroke:"#0073EA",strokeWidth:"2",rx:"1",fill:"none"})}),v.jsx("defs",{children:v.jsxs("filter",{id:"filter0_d_phone",x:"50.1927",y:"48",width:"39.6146",height:"18.6146",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[v.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),v.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),v.jsx("feOffset",{dy:"3.30729"}),v.jsx("feGaussianBlur",{stdDeviation:"1.65365"}),v.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),v.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),v.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_phone"}),v.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_phone",result:"shape"})]})})]})]}),v.jsxs("div",{className:"flex flex-col items-center gap-1",children:[v.jsx("div",{className:"text-[#0073EA] font-roboto text-[15px] font-bold",children:"Step 2"}),v.jsx("div",{className:"text-[#676879] text-center font-roboto text-[13px] font-normal leading-5",children:"Tap the link that appears to open your verification session."})]})]}),v.jsx("div",{className:"hidden lg:block",children:v.jsxs("svg",{className:"w-5 h-[18px] text-[#323238]",viewBox:"0 0 21 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M12 16.25L19.5 8.75L12 1.25M1.5 16.25L9 8.75L1.5 1.25",stroke:"url(#paint0_linear_arrow2)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("defs",{children:v.jsxs("linearGradient",{id:"paint0_linear_arrow2",x1:"18",y1:"0.500001",x2:"-3",y2:"1",gradientUnits:"userSpaceOnUse",children:[v.jsx("stop",{offset:"0.246914",stopColor:"#323238"}),v.jsx("stop",{offset:"1",stopColor:"white",stopOpacity:"0"})]})})]})}),v.jsxs("div",{className:"flex flex-col items-center gap-4 min-w-[183px]",children:[v.jsxs("div",{className:"relative w-[183px] h-[183px]",children:[v.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-[#C3C6D4] bg-white"}),v.jsx("div",{className:"absolute inset-[7px] rounded-full bg-gradient-to-br from-[rgba(0,115,234,0.1)] to-[rgba(255,255,255,0.1)]"}),v.jsxs("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[85px] h-[124px]",viewBox:"0 0 85 125",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M16.7891 61.7373V4.62095C16.7891 3.02189 18.0883 1.72266 19.6874 1.72266H62.9119C64.511 1.72266 65.8102 3.02189 65.8102 4.62095V40.0501",stroke:"#0073EA",strokeWidth:"1.99882",strokeLinecap:"round"}),v.jsx("path",{d:"M26.575 22.5L28.525 24.45L32.425 20.55M36 22.5C36 26.0898 33.0898 29 29.5 29C25.9101 29 23 26.0898 23 22.5C23 18.9101 25.9101 16 29.5 16C33.0898 16 36 18.9101 36 22.5Z",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("g",{filter:"url(#filter0_d_check)",children:v.jsx("rect",{x:"26.5",y:"67",width:"28",height:"8",stroke:"#0073EA",strokeWidth:"2",rx:"1",fill:"none"})}),v.jsx("defs",{children:v.jsxs("filter",{id:"filter0_d_check",x:"22.1927",y:"66",width:"37.6146",height:"16.6146",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[v.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),v.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),v.jsx("feOffset",{dy:"3.30729"}),v.jsx("feGaussianBlur",{stdDeviation:"1.65365"}),v.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),v.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),v.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_check"}),v.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_check",result:"shape"})]})})]})]}),v.jsxs("div",{className:"flex flex-col items-center gap-1",children:[v.jsx("div",{className:"text-[#0073EA] font-roboto text-[15px] font-bold",children:"Step 3"}),v.jsx("div",{className:"w-[180px] text-[#676879] text-center font-roboto text-[13px] font-normal leading-5",children:"Pick up where you left off - your progress is saved!"})]})]})]}),v.jsxs("div",{className:"text-[#172B4D] text-center font-roboto text-sm",children:["The link expires in ",v.jsx("span",{className:"font-bold",children:"10 minutes"})," ","for security."]})]}),v.jsx("div",{className:"flex justify-end items-center p-4 sm:p-6 border-t border-border bg-white",children:v.jsx(QR,{onClick:e,className:"h-[38px] px-4 bg-[#0073EA] text-white font-roboto text-[13px] font-medium rounded hover:bg-[#0073EA]/90 transition-colors",children:"Got it"})})]})})}function Ji(n){if(!n)return!1;const e=n.trim();return new RegExp("^\\p{L}{2,}$","u").test(e)}function nd(n){const e=(n??"").trim();return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e):!1}const JR=[{dial:"+91",name:"India",min:10,max:10},{dial:"+1",name:"United States",min:10,max:10},{dial:"+44",name:"United Kingdom",min:10,max:10},{dial:"+61",name:"Australia",min:9,max:9},{dial:"+49",name:"Germany",min:10,max:11},{dial:"+33",name:"France",min:9,max:9},{dial:"+65",name:"Singapore",min:8,max:8},{dial:"+971",name:"United Arab Emirates",min:9,max:9},{dial:"+55",name:"Brazil",min:10,max:11},{dial:"+81",name:"Japan",min:9,max:10}];function eD(n){return(n??"").replace(/\D/g,"")}function Vc(n,e){const t=eD(e),r=JR.find(o=>o.dial===n);return r?t.length>=r.min&&t.length<=r.max:t.length>=6&&t.length<=14}function aq(n){const e=n.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(!e)return null;const t=parseInt(e[1],10),r=parseInt(e[2],10)-1,o=parseInt(e[3],10),s=new Date(o,r,t);return s.getFullYear()!==o||s.getMonth()!==r||s.getDate()!==t?null:s}function Lp(n,e=18){const t=aq(n);if(!t)return!1;const r=new Date;return t>r?!1:lq(t,r)>=e}function lq(n,e=new Date){let t=e.getFullYear()-n.getFullYear();const r=e.getMonth()-n.getMonth();return(r<0||r===0&&e.getDate()<n.getDate())&&t--,t}function Bl(n){if(!n)return!1;const e=n.replace(/\s+/g,"");return/^\d{5,6}$/.test(e)}function jl(n){return n?n.trim().length>=5:!1}function tD({formData:n,setFormData:e,isEmailVerified:t,isPhoneVerified:r,onSendEmailOTP:o,onSendPhoneOTP:s,fieldConfig:i={}}){const[a,l]=F.useState({}),c=i?.requiredToggles??{},u=b=>!!{dateOfBirth:!!c.dob,middleName:!!c.middleName,gender:!!c.gender,phoneNumber:!!c.phoneNumber,address:!!c.currentAddress,city:!!c.currentCity,postalCode:!!c.currentPostal,permanentAddress:!!c.permanentAddress,permanentCity:!!c.permanentCity,permanentPostalCode:!!c.permanentPostal}[b],d=({show:b})=>b?v.jsx("span",{className:"text-destructive",children:"*"}):null,h=b=>{if((b==="currentAddress"||b==="permanentAddress")&&console.log(` shouldShowField called with: ${b}`),!i||Object.keys(i).length===0)return["firstName","lastName","email"].includes(b);if(b==="currentAddress"){const N=i.currentAddress===!0;return console.log(`Field ${b}: ${N} (config value: ${i.currentAddress})`),console.log("Full config:",i),N}if(b==="permanentAddress"){const N=i.permanentAddress===!0;return console.log(`Field ${b}: ${N} (config value: ${i.permanentAddress})`),console.log("Full config:",i),N}const S={firstName:"firstName",lastName:"lastName",email:"email",gender:"gender",dateOfBirth:"dateOfBirth",address:"currentAddress",city:"currentAddress",postalCode:"currentAddress",permanentCity:"permanentAddress",permanentPostalCode:"permanentAddress",phoneNumber:"phoneNumber",countryCode:"phoneNumber",middleName:"middleName"}[b];if(!S)return!1;const k=i[S]===!0;return(b.includes("Address")||b==="address"||b==="city"||b==="postalCode"||S==="currentAddress"||S==="permanentAddress")&&console.log(`Field ${b} (${S}): ${k} (config value: ${i[S]})`),k},p=(b,C)=>{l(S=>({...S,[b]:void 0})),e({...n,[b]:C})},g=b=>{const C=(n[b]||"").toString();let S;switch(b){case"firstName":case"lastName":Ji(C)||(S="Enter at least 2 valid letters.");break;case"dateOfBirth":Lp(C)||(S="Enter a valid DOB (DD/MM/YYYY). You must be at least 18.");break;case"email":nd(C)||(S="Please enter a valid email address.");break;case"countryCode":n.countryCode||(S="Please select a country code.");break;case"phoneNumber":Vc(n.countryCode,C)||(S="Please enter a valid phone number.");break;case"address":case"permanentAddress":jl(C)||(S="Enter your address (at least 5 characters).");break;case"city":case"permanentCity":(!C||C.trim().length<2)&&(S="Enter your city.");break;case"postalCode":case"permanentPostalCode":Bl(C)||(S="Enter a valid postal code.");break}return l(k=>({...k,[b]:S})),!S},x=b=>{if(!b)return"";const C=b.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(!C)return"";const[S,k,N,E]=C;return`${E}-${N}-${k}`},y=b=>{if(!b)return"";const C=b.split("-");if(C.length!==3)return"";const[S,k,N]=C;return`${N.padStart(2,"0")}/${k.padStart(2,"0")}/${S}`};return v.jsx("div",{className:"flex flex-col items-start self-stretch",children:v.jsx("div",{className:"flex flex-col items-start gap-6 self-stretch",children:v.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[v.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-4 sm:gap-6 self-stretch",children:[h("firstName")&&v.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["First Name",v.jsx("span",{className:"text-destructive",children:" *"})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.firstName?"border-destructive":"border-input-border"} bg-background`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"Enter Name",value:n.firstName,onChange:b=>p("firstName",b.target.value.replace(/[^\p{L}]/gu,"")),onBlur:()=>g("firstName"),"aria-invalid":!!a.firstName,"aria-describedby":a.firstName?"err-firstName":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.firstName&&v.jsx("div",{id:"err-firstName",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.firstName})]}),h("lastName")&&v.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Last Name",v.jsx("span",{className:"text-destructive",children:" *"})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.lastName?"border-destructive":"border-input-border"} bg-background`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"Enter Your Full Name",value:n.lastName,onChange:b=>p("lastName",b.target.value.replace(/[^\p{L}]/gu,"")),onBlur:()=>g("lastName"),"aria-invalid":!!a.lastName,"aria-describedby":a.lastName?"err-lastName":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.lastName&&v.jsx("div",{id:"err-lastName",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.lastName})]})]}),v.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-4 sm:gap-6 self-stretch mt-6",children:[h("middleName")&&v.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Middle Name ",v.jsx(d,{show:u("middleName")})]})})}),v.jsx("div",{className:"flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border border-input-border bg-background",children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"Enter Name",value:n.middleName,onChange:b=>p("middleName",b.target.value),className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})})]}),h("dateOfBirth")&&v.jsxs("div",{className:"flex w-full sm:flex-1 flex-col items-start",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Date Of Birth ",v.jsx(d,{show:u("dateOfBirth")})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.dateOfBirth?"border-destructive":"border-input-border"} bg-background`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"date",placeholder:"DD/MM/YYYY",value:x(n.dateOfBirth),onChange:b=>p("dateOfBirth",y(b.target.value)),onBlur:()=>g("dateOfBirth"),"aria-invalid":!!a.dateOfBirth,"aria-describedby":a.dateOfBirth?"err-dateOfBirth":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.dateOfBirth&&v.jsx("div",{id:"err-dateOfBirth",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.dateOfBirth})]})]}),v.jsx("div",{className:"flex flex-col items-start gap-6 self-stretch mt-6",children:v.jsxs("div",{className:"flex flex-col lg:flex-row items-start gap-4 lg:gap-6 self-stretch",children:[h("email")&&v.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Email",v.jsx("span",{className:"text-destructive",children:" *"})]})})}),v.jsxs("div",{className:`flex flex-col items-start gap-1 self-stretch ${a.email,""}`,children:[v.jsxs("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.email?"border-destructive":"border-input-border"} bg-background`,children:[v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"email",placeholder:"Enter Your Email Address",value:n.email,onChange:b=>p("email",b.target.value.trim()),onBlur:()=>g("email"),"aria-invalid":!!a.email,"aria-describedby":a.email?"err-email":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})}),v.jsx("button",{onClick:o,disabled:!nd(n.email)||t,"aria-disabled":!nd(n.email)||t,className:`flex h-7 py-[9px] px-3 justify-center items-center gap-2 rounded bg-background ${!nd(n.email)||t?"opacity-50 cursor-not-allowed":""}`,children:v.jsx("span",{className:"text-primary font-figtree text-[12px] font-normal",children:t?"Verified":"Send OTP"})})]}),a.email?v.jsx("div",{id:"err-email",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.email}):!t&&v.jsx("div",{className:"text-text-muted text-[12px] mt-1",children:"Email verification is required to continue."})]})]}),h("phoneNumber")&&v.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Phone Number ",v.jsx(d,{show:u("phoneNumber")})]})})}),v.jsxs("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[v.jsxs("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.phoneNumber||a.countryCode?"border-destructive":"border-input-border"} bg-background`,children:[v.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[v.jsxs("select",{value:n.countryCode,onChange:b=>p("countryCode",b.target.value),onBlur:()=>g("countryCode"),"aria-invalid":!!a.countryCode,"aria-describedby":a.countryCode?"err-countryCode":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 bg-transparent outline-none border-r border-input-border pr-2 mr-2 min-w-[70px] max-w-[100px] flex-shrink-0",children:[v.jsx("option",{value:"",children:"Select"}),JR.map(b=>v.jsx("option",{value:b.dial,children:`${b.dial} ${b.name}`},b.dial))]}),v.jsx("input",{type:"tel",placeholder:"Enter Your Mobile Number",value:n.phoneNumber,onChange:b=>p("phoneNumber",eD(b.target.value)),onBlur:()=>g("phoneNumber"),"aria-invalid":!!a.phoneNumber,"aria-describedby":a.phoneNumber?"err-phoneNumber":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})]}),v.jsx("button",{onClick:s,disabled:!Vc(n.countryCode,n.phoneNumber)||r,"aria-disabled":!Vc(n.countryCode,n.phoneNumber)||r,className:`flex h-7 py-[9px] px-3 justify-center items-center gap-2 rounded bg-background ${!Vc(n.countryCode,n.phoneNumber)||r?"opacity-50 cursor-not-allowed":""}`,children:v.jsx("span",{className:"text-primary font-figtree text-[12px] font-normal",children:r?"Verified":"Send OTP"})})]}),a.countryCode?v.jsx("div",{id:"err-countryCode",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.countryCode}):a.phoneNumber?v.jsx("div",{id:"err-phoneNumber",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.phoneNumber}):r?null:v.jsx("div",{className:"text-text-muted text-[12px] mt-1",children:"Phone number verification is required to continue."})]})]})]})}),h("gender")&&v.jsx("div",{className:"flex w-full items-start gap-4 lg:gap-6 mt-6",children:v.jsx("div",{className:"flex w-full lg:w-[458px] h-auto lg:h-14 items-start gap-4 lg:gap-6 flex-shrink-0",children:v.jsxs("div",{className:"flex w-full h-auto lg:h-14 flex-col items-start flex-1",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsxs("span",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:["Gender ",v.jsx(d,{show:u("gender")})]})}),v.jsx("div",{className:"flex flex-wrap items-start gap-2 sm:gap-3",children:["Male","Female","Non-Binary","Prefer Not To Say"].map(b=>v.jsxs("div",{className:"flex h-[38px] py-2 pr-2 items-center gap-2 rounded-full",children:[v.jsxs("div",{className:"w-4 h-4 rounded-full border-[0.667px] border-step-inactive-border bg-background relative",children:[v.jsx("input",{type:"radio",name:"gender",value:b,checked:n.gender===b,onChange:C=>p("gender",C.target.value),className:"absolute inset-0 opacity-0 cursor-pointer"}),n.gender===b&&v.jsx("div",{className:"absolute inset-1 rounded-full bg-primary"})]}),v.jsx("label",{className:"text-text-muted font-roboto text-[13px] font-normal leading-[22px] cursor-pointer",children:b})]},b))})]})})}),h("currentAddress")&&v.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch w-full mt-6",children:[v.jsxs("div",{className:"flex pb-1 flex-col items-start gap-1 self-stretch",children:[v.jsxs("div",{className:"text-text-primary font-roboto text-[16px] font-bold leading-[26px]",children:["Current Address"," ",v.jsx("span",{className:"font-normal text-[13px] text-text-muted",children:"(as per ID)"})]}),v.jsx("div",{className:"self-stretch text-text-muted font-roboto text-[13px] font-normal leading-5",children:"Enter your current residential address exactly as shown on your government-issued ID."})]}),v.jsxs("div",{className:"flex flex-col items-start self-stretch w-full",children:[v.jsx("div",{className:"flex h-auto items-start gap-4 self-stretch w-full",children:v.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Current Address ",v.jsx(d,{show:u("address")})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.address?"border-destructive":"border-input-border"} bg-background w-full`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"e.g 123 MG Road, Shastri Nagar, Near City Park",value:n.address,onChange:b=>p("address",b.target.value),onBlur:()=>g("address"),"aria-invalid":!!a.address,"aria-describedby":a.address?"err-address":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.address&&v.jsx("div",{id:"err-address",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.address})]})}),v.jsxs("div",{className:"inline-flex flex-col sm:flex-row items-start gap-4 sm:gap-6 w-full mt-6",children:[v.jsxs("div",{className:"flex flex-col items-start w-full sm:flex-1",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["City ",v.jsx(d,{show:u("city")})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.city?"border-destructive":"border-input-border"} bg-background w-full`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"e.g Mumbai",value:n.city,onChange:b=>p("city",b.target.value),onBlur:()=>g("city"),"aria-invalid":!!a.city,"aria-describedby":a.city?"err-city":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.city&&v.jsx("div",{id:"err-city",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.city})]}),v.jsxs("div",{className:"flex flex-col items-start w-full sm:flex-1",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Postal Code ",v.jsx(d,{show:u("postalCode")})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.postalCode?"border-destructive":"border-input-border"} bg-background w-full`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"e.g 432001",value:n.postalCode,onChange:b=>p("postalCode",b.target.value),onBlur:()=>g("postalCode"),"aria-invalid":!!a.postalCode,"aria-describedby":a.postalCode?"err-postalCode":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.postalCode&&v.jsx("div",{id:"err-postalCode",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.postalCode})]})]})]})]}),h("permanentAddress")&&v.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch w-full mt-6",children:[v.jsxs("div",{className:"flex pb-1 flex-col items-start gap-1 self-stretch",children:[v.jsxs("div",{className:"text-text-primary font-roboto text-[16px] font-bold leading-[26px]",children:["Permanent Address"," ",v.jsx("span",{className:"font-normal text-[13px] text-text-muted",children:"(as per ID)"})]}),v.jsx("div",{className:"self-stretch text-text-muted font-roboto text-[13px] font-normal leading-5",children:"Enter your permanent address exactly as shown on your government-issued ID."})]}),v.jsxs("div",{className:"flex flex-col items-start self-stretch w-full",children:[v.jsx("div",{className:"flex h-auto items-start gap-4 self-stretch w-full",children:v.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Permanent Address ",v.jsx(d,{show:u("permanentAddress")})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.permanentAddress?"border-destructive":"border-input-border"} bg-background w-full`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"e.g 456 Park Street, Gandhi Nagar, Near Mall",value:n.permanentAddress,onChange:b=>p("permanentAddress",b.target.value),onBlur:()=>g("permanentAddress"),"aria-invalid":!!a.permanentAddress,"aria-describedby":a.permanentAddress?"err-permanentAddress":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.permanentAddress&&v.jsx("div",{id:"err-permanentAddress",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.permanentAddress})]})}),v.jsxs("div",{className:"inline-flex flex-col sm:flex-row items-start gap-4 sm:gap-6 w-full mt-6",children:[v.jsxs("div",{className:"flex flex-col items-start w-full sm:flex-1",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Permanent City ",v.jsx(d,{show:u("permanentCity")})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.permanentCity?"border-destructive":"border-input-border"} bg-background w-full`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"e.g Delhi",value:n.permanentCity,onChange:b=>p("permanentCity",b.target.value),onBlur:()=>g("permanentCity"),"aria-invalid":!!a.permanentCity,"aria-describedby":a.permanentCity?"err-permanentCity":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.permanentCity&&v.jsx("div",{id:"err-permanentCity",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.permanentCity})]}),v.jsxs("div",{className:"flex flex-col items-start w-full sm:flex-1",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:v.jsxs("span",{className:"text-text-primary",children:["Permanent Postal Code ",v.jsx(d,{show:u("permanentPostalCode")})]})})}),v.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${a.permanentPostalCode?"border-destructive":"border-input-border"} bg-background w-full`,children:v.jsx("div",{className:"flex items-center gap-2 flex-1",children:v.jsx("input",{type:"text",placeholder:"e.g 110001",value:n.permanentPostalCode,onChange:b=>p("permanentPostalCode",b.target.value),onBlur:()=>g("permanentPostalCode"),"aria-invalid":!!a.permanentPostalCode,"aria-describedby":a.permanentPostalCode?"err-permanentPostalCode":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),a.permanentPostalCode&&v.jsx("div",{id:"err-permanentPostalCode",role:"alert",className:"text-destructive text-[12px] mt-1",children:a.permanentPostalCode})]})]})]})]})]})})})}const Q3=(n,e)=>{const t=e.toLowerCase().replace(/\s+/g,"_"),o={India:"IN","United States":"US","United Kingdom":"GB"}[n];if(!o)return console.warn(`Country "${n}" not found in mapping, using fallback ID`),"7579ebab-673f-401e-9395-075e9addf4a7";if(o==="IN"){const i={aadhaar_card:"7579ebab-673f-401e-9395-075e9addf4a7",voter_id:"7579ebab-673f-401e-9395-075e9addf4a7",passport:"7579ebab-673f-401e-9395-075e9addf4a7",indian_passport:"7579ebab-673f-401e-9395-075e9addf4a7",pan_card:"7579ebab-673f-401e-9395-075e9addf4a7",driving_license:"ffb98e04-4477-418b-b17e-e4e718d7f694",driver_license:"ffb98e04-4477-418b-b17e-e4e718d7f694"}[t];if(i)return console.log(`Selected document: ${e} (${t}) -> ID: ${i}`),i}return console.warn(`Document "${e}" not found for country "${n}", using fallback ID`),"7579ebab-673f-401e-9395-075e9addf4a7"},cq="https://idvapi-test.arconnet.com:1019";function uq({isOpen:n,onClose:e,onSubmit:t,previousFileIds:r,onUploaded:o,submissionId:s,country:i="",selectedDocumentName:a="",documentConfig:l}){const{toast:c}=Nm(),[u,d]=F.useState(null),[h,p]=F.useState(null),[g,x]=F.useState(null),[y,b]=F.useState(!1),[C,S]=F.useState(!1),[k,N]=F.useState({front:!1,back:!1}),[E,_]=F.useState(r||{}),$=F.useRef(null),T=F.useRef(null),D=(H,O)=>{if(!l||!l.supportedCountries)return null;const V=l.supportedCountries.find(B=>B.countryName===H);if(!V)return null;const W=V.documents.find(B=>typeof B=="string"?B===O:B.title===O);return W&&typeof W!="string"&&W.documentDefinitionId?W.documentDefinitionId:null};F.useEffect(()=>(g&&n?A():M(),()=>{M()}),[g,n]),F.useEffect(()=>{n||(M(),x(null),d(null),p(null),N({front:!1,back:!1}),b(!1))},[n]);const A=async()=>{try{const H=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});$.current&&($.current.srcObject=H,T.current=H),b(!1)}catch(H){console.error("Error accessing camera:",H),b(!0);let O="Unable to access camera. ",V="Camera Error";H.name==="NotAllowedError"?O+="Please allow camera permissions and try again.":H.name==="NotSecureError"||window.location.protocol!=="https:"?(V="HTTPS Required",O="Camera access requires HTTPS. Please use a secure connection or try file upload instead."):H.name==="NotFoundError"?O+="No camera device found.":H.name==="NotReadableError"?O+="Camera is being used by another application.":O+="Please try file upload instead.",c({title:V,description:O,variant:"destructive"})}},M=()=>{T.current&&(T.current.getTracks().forEach(H=>H.stop()),T.current=null),$.current&&($.current.srcObject=null)},j=async H=>{if(!$.current)return;const O=document.createElement("canvas");O.width=$.current.videoWidth,O.height=$.current.videoHeight;const V=O.getContext("2d");V&&(V.drawImage($.current,0,0,O.width,O.height),O.toBlob(W=>{if(W){const B=O.toDataURL("image/jpeg",.8),q={blob:W,dataUrl:B};H==="front"?d(q):p(q),x(null),M(),c({title:"Image Captured",description:`${H==="front"?"Front":"Back"} side captured successfully.`})}},"image/jpeg",.8))},L=async(H,O)=>{try{S(!0);const V=new FormData;V.append("File",H.blob,`${O}-document.jpg`);let W=D(i,a);W||(console.warn(`CameraDialog: Document definition ID not found in config for ${a}, using fallback mapping`),W=Q3(i,a)),V.append("DocumentDefinitionId",W),V.append("Bucket","string");const B=s?.toString()||"1";console.log("CameraDialog: Using UserTemplateSubmissionId:",B),console.log("CameraDialog: Using DocumentDefinitionId:",W,"for document:",a,"(country:",i,")"),V.append("UserTemplateSubmissionId",B);const q=`${cq}/api/Files/upload`,Q=await fetch(q,{method:"POST",body:V});if(Q.ok){const Z=await Q.json().catch(()=>({})),ne=Z&&Z.file&&typeof Z.file.id=="number"&&Z.file.id||typeof Z.id=="number"&&Z.id||Z&&Z.mapping&&typeof Z.mapping.fileId=="number"&&Z.mapping.fileId||null;ne&&(_(ge=>({...ge,[O]:ne})),o?.(O,ne)),N(ge=>({...ge,[O]:!0})),c({title:"Upload Successful",description:`${O==="front"?"Front":"Back"} side uploaded successfully.`})}else throw new Error(`POST failed: ${Q.statusText}`)}catch(V){console.error(`Error uploading ${O} image:`,V),c({title:"Upload Failed",description:`Failed to upload ${O} side. Please try again.`,variant:"destructive"})}finally{S(!1)}},U=H=>{H==="front"?(d(null),N(O=>({...O,front:!1}))):(p(null),N(O=>({...O,back:!1})))},G=()=>{if(k.front||k.back){const H=(k.front?1:0)+(k.back?1:0);c({title:"Done",description:`Document${H>1?"s":""} uploaded successfully.`});const O=u?.dataUrl||h?.dataUrl;t(O,E)}};return n?g?v.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black",children:v.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[v.jsxs("div",{className:"flex h-16 justify-between items-center px-6 bg-black/50 text-white",children:[v.jsxs("div",{className:"text-xl font-bold",children:["Capture ",g==="front"?"Front":"Back"," Side"]}),v.jsx("button",{onClick:()=>{x(null),M()},className:"flex w-8 h-8 justify-center items-center rounded-full bg-white/20 hover:bg-white/30",children:v.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),v.jsx("div",{className:"flex-1 flex items-center justify-center",children:y?v.jsxs("div",{className:"text-white text-center max-w-sm",children:[v.jsx("div",{className:"text-xl mb-4",children:" Camera Unavailable"}),v.jsx("div",{className:"text-sm opacity-90 mb-4",children:window.location.protocol!=="https:"?"Camera access requires HTTPS. Please use a secure connection or try uploading a file instead.":"Unable to access camera. Please check permissions or try uploading a file instead."})]}):v.jsxs("div",{className:"relative",children:[v.jsx("video",{ref:$,autoPlay:!0,playsInline:!0,className:"max-w-full max-h-full rounded-lg"}),v.jsx("div",{className:"absolute inset-0 border-2 border-white/50 rounded-lg pointer-events-none"})]})}),v.jsx("div",{className:"flex justify-center pb-8",children:v.jsx("button",{onClick:()=>j(g),disabled:y,className:"flex w-16 h-16 justify-center items-center rounded-full bg-white hover:bg-gray-100 disabled:bg-gray-400 disabled:cursor-not-allowed",children:v.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z",fill:"black"})})})})]})}):v.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:v.jsxs("div",{className:"flex w-[800px] max-w-[90vw] max-h-[90vh] flex-col items-start rounded-lg bg-white overflow-auto",children:[v.jsxs("div",{className:"flex h-[58px] justify-between items-center self-stretch border-b border-[#D0D4E4] px-6",children:[v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("div",{className:"text-[#172B4D] font-figtree text-xl font-bold leading-[30px]",children:"Capture Documents"})}),v.jsx("button",{onClick:e,className:"flex w-8 h-8 justify-center items-center gap-2.5 rounded-full bg-white hover:bg-gray-50",children:v.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),v.jsxs("div",{className:"flex p-6 flex-col items-center gap-6 self-stretch bg-white",children:[v.jsx("div",{className:"text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Capture clear images of both front and back sides."}),v.jsxs("div",{className:"flex flex-col sm:flex-row h-auto sm:h-[320px] items-center gap-6 px-4 sm:px-0",children:[v.jsxs("div",{className:"flex flex-1 min-w-0 h-auto sm:h-[320px] flex-col items-start",children:[v.jsx("div",{className:"flex w-full h-auto sm:h-[272px] flex-col items-center gap-7 flex-shrink-0",children:v.jsx("div",{className:"flex h-[272px] flex-col items-start flex-shrink-0 self-stretch",children:v.jsx("div",{className:"flex justify-center items-center gap-2 flex-1 self-stretch",children:v.jsx("div",{className:`flex flex-col justify-center items-center gap-2 flex-1 self-stretch rounded-t-lg border-2 ${u?"border-green-500 bg-green-50":"border-dashed border-[#C3C6D4] bg-white"}`,children:v.jsx("div",{className:"flex w-full max-w-[326px] h-auto sm:h-[262px] flex-col justify-center items-center gap-2 p-4",children:u?v.jsxs("div",{className:"flex flex-col items-center gap-2",children:[v.jsx("img",{src:u.dataUrl,alt:"Front side captured",className:"max-w-full max-h-32 rounded"}),v.jsx("div",{className:"text-green-600 font-medium text-sm",children:" Front side captured"}),v.jsx("button",{onClick:()=>U("front"),className:"text-blue-600 text-xs hover:underline",children:"Retake"})]}):v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"flex w-[52px] h-[52px] p-2 justify-center items-center flex-shrink-0 rounded-full bg-[#F6F7FB]",children:v.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M1.99805 8.87722C1.99805 8.5269 1.99805 8.35174 2.01267 8.20421C2.15365 6.78127 3.27932 5.6556 4.70226 5.51462C4.84979 5.5 5.03441 5.5 5.40363 5.5C5.5459 5.5 5.61704 5.5 5.67744 5.49634C6.44866 5.44963 7.124 4.96288 7.41219 4.246C7.43476 4.18986 7.45586 4.12657 7.49805 4C7.54024 3.87343 7.56134 3.81014 7.58391 3.754C7.8721 3.03712 8.54744 2.55037 9.31866 2.50366C9.37906 2.5 9.44577 2.5 9.57919 2.5H14.4169C14.5503 2.5 14.617 2.5 14.6774 2.50366C15.4486 2.55037 16.124 3.03712 16.4121 3.754C16.4347 3.81014 16.4558 3.87343 16.498 4C16.5402 4.12657 16.5613 4.18986 16.5839 4.246C16.872 4.96288 17.5474 5.44963 18.3186 5.49634C18.379 5.5 18.4501 5.5 18.5924 5.5C18.9616 5.5 19.1463 5.5 19.2938 5.51462C20.7167 5.6556 21.8424 6.78127 21.9834 8.20421C21.998 8.35174 21.998 8.5269 21.998 8.87722V16.7C21.998 18.3802 21.998 19.2202 21.671 19.862C21.3834 20.4265 20.9245 20.8854 20.36 21.173C19.7182 21.5 18.8782 21.5 17.198 21.5H6.79805C5.11789 21.5 4.27781 21.5 3.63608 21.173C3.07159 20.8854 2.61265 20.4265 2.32503 19.862C1.99805 19.2202 1.99805 18.3802 1.99805 16.7V8.87722Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M11.998 17C14.2071 17 15.998 15.2091 15.998 13C15.998 10.7909 14.2071 9 11.998 9C9.78891 9 7.99805 10.7909 7.99805 13C7.99805 15.2091 9.78891 17 11.998 17Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"})]})}),v.jsx("div",{className:"self-stretch text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Front side of your document"}),v.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Ensure the front side is in frame and well-lit."})]})})})})})}),v.jsx("div",{className:"flex w-full sm:w-[364px] h-12 p-2 flex-col items-end gap-2 flex-shrink-0 rounded-b border-t-0 bg-[#F6F7FB]",children:u?k.front?v.jsxs("button",{disabled:!0,className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-green-600",children:[v.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M6 9L8 11L12 7",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Uploaded"})]}):v.jsx("button",{onClick:()=>L(u,"front"),disabled:C,className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400",children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:C?"Uploading...":"Upload"})}):v.jsxs("button",{onClick:()=>x("front"),className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-[#0073EA] hover:bg-[#0073EA]/90",children:[v.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M1.5 6.28292C1.5 6.02018 1.5 5.8888 1.51097 5.77816C1.6167 4.71095 2.46095 3.8667 3.52816 3.76096C3.6388 3.75 3.77727 3.75 4.05419 3.75C4.16089 3.75 4.21424 3.75 4.25954 3.74725C4.83796 3.71222 5.34446 3.34716 5.56061 2.8095C5.57753 2.7674 5.59336 2.71993 5.625 2.625C5.65664 2.53007 5.67247 2.4826 5.68939 2.4405C5.90554 1.90284 6.41204 1.53778 6.99046 1.50274C7.03576 1.5 7.08579 1.5 7.18585 1.5H10.8142C10.9142 1.5 10.9643 1.5 11.0096 1.50274C11.588 1.53778 12.0945 1.90284 12.3106 2.4405C12.3275 2.4826 12.3434 2.53007 12.375 2.625C12.4066 2.71993 12.4225 2.7674 12.4394 2.8095C12.6555 3.34716 13.1621 3.71222 13.7405 3.74725C13.7858 3.75 13.8391 3.75 13.9458 3.75C14.2227 3.75 14.3612 3.75 14.4718 3.76096C15.539 3.8667 16.3833 4.71095 16.489 5.77816C16.5 5.8888 16.5 6.02018 16.5 6.28292V12.15C16.5 13.4102 16.5 14.0401 16.2548 14.5215C16.0391 14.9449 15.6949 15.2891 15.2715 15.5048C14.7901 15.75 14.1602 15.75 12.9 15.75H5.1C3.83988 15.75 3.20982 15.75 2.72852 15.5048C2.30516 15.2891 1.96095 14.9449 1.74524 14.5215C1.5 14.0401 1.5 13.4102 1.5 12.15V6.28292Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M9 12.375C10.6568 12.375 12 11.0318 12 9.375C12 7.71817 10.6568 6.375 9 6.375C7.34314 6.375 6 7.71817 6 9.375C6 11.0318 7.34314 12.375 9 12.375Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Capture"})]})})]}),v.jsxs("div",{className:"flex flex-1 min-w-0 h-auto sm:h-[320px] flex-col items-start",children:[v.jsx("div",{className:"flex w-full h-auto sm:h-[272px] flex-col items-center gap-7 flex-shrink-0",children:v.jsx("div",{className:"flex h-[272px] flex-col items-start flex-shrink-0 self-stretch",children:v.jsx("div",{className:"flex justify-center items-center gap-2 flex-1 self-stretch",children:v.jsx("div",{className:`flex flex-col justify-center items-center gap-2 flex-1 self-stretch rounded-t-lg border-2 ${h?"border-green-500 bg-green-50":"border-dashed border-[#C3C6D4] bg-white"}`,children:v.jsx("div",{className:"flex w-full max-w-[326px] h-auto sm:h-[262px] flex-col justify-center items-center gap-2 p-4",children:h?v.jsxs("div",{className:"flex flex-col items-center gap-2",children:[v.jsx("img",{src:h.dataUrl,alt:"Back side captured",className:"max-w-full max-h-32 rounded"}),v.jsx("div",{className:"text-green-600 font-medium text-sm",children:" Back side captured"}),v.jsx("button",{onClick:()=>U("back"),className:"text-blue-600 text-xs hover:underline",children:"Retake"})]}):v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"flex w-[52px] h-[52px] p-2 justify-center items-center flex-shrink-0 rounded-full bg-[#F6F7FB]",children:v.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M1.99805 8.87722C1.99805 8.5269 1.99805 8.35174 2.01267 8.20421C2.15365 6.78127 3.27932 5.6556 4.70226 5.51462C4.84979 5.5 5.03441 5.5 5.40363 5.5C5.5459 5.5 5.61704 5.5 5.67744 5.49634C6.44866 5.44963 7.124 4.96288 7.41219 4.246C7.43476 4.18986 7.45586 4.12657 7.49805 4C7.54024 3.87343 7.56134 3.81014 7.58391 3.754C7.8721 3.03712 8.54744 2.55037 9.31866 2.50366C9.37906 2.5 9.44577 2.5 9.57919 2.5H14.4169C14.5503 2.5 14.617 2.5 14.6774 2.50366C15.4486 2.55037 16.124 3.03712 16.4121 3.754C16.4347 3.81014 16.4558 3.87343 16.498 4C16.5402 4.12657 16.5613 4.18986 16.5839 4.246C16.872 4.96288 17.5474 5.44963 18.3186 5.49634C18.379 5.5 18.4501 5.5 18.5924 5.5C18.9616 5.5 19.1463 5.5 19.2938 5.51462C20.7167 5.6556 21.8424 6.78127 21.9834 8.20421C21.998 8.35174 21.998 8.5269 21.998 8.87722V16.7C21.998 18.3802 21.998 19.2202 21.671 19.862C21.3834 20.4265 20.9245 20.8854 20.36 21.173C19.7182 21.5 18.8782 21.5 17.198 21.5H6.79805C5.11789 21.5 4.27781 21.5 3.63608 21.173C3.07159 20.8854 2.61265 20.4265 2.32503 19.862C1.99805 19.2202 1.99805 18.3802 1.99805 16.7V8.87722Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M11.998 17C14.2071 17 15.998 15.2091 15.998 13C15.998 10.7909 14.2071 9 11.998 9C9.78891 9 7.99805 10.7909 7.99805 13C7.99805 15.2091 9.78891 17 11.998 17Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"})]})}),v.jsx("div",{className:"self-stretch text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Back side of your document"}),v.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Ensure the back side is in frame and clearly visible."})]})})})})})}),v.jsx("div",{className:"flex w-full sm:w-[364px] h-12 p-2 flex-col items-end gap-2 flex-shrink-0 rounded-b border-t-0 bg-[#F6F7FB]",children:h?k.back?v.jsxs("button",{disabled:!0,className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-green-600",children:[v.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M6 9L8 11L12 7",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Uploaded"})]}):v.jsx("button",{onClick:()=>L(h,"back"),disabled:C,className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400",children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:C?"Uploading...":"Upload"})}):v.jsxs("button",{onClick:()=>x("back"),className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-[#0073EA] hover:bg-[#0073EA]/90",children:[v.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M1.5 6.28292C1.5 6.02018 1.5 5.8888 1.51097 5.77816C1.6167 4.71095 2.46095 3.8667 3.52816 3.76096C3.6388 3.75 3.77727 3.75 4.05419 3.75C4.16089 3.75 4.21424 3.75 4.25954 3.74725C4.83796 3.71222 5.34446 3.34716 5.56061 2.8095C5.57753 2.7674 5.59336 2.71993 5.625 2.625C5.65664 2.53007 5.67247 2.4826 5.68939 2.4405C5.90554 1.90284 6.41204 1.53778 6.99046 1.50274C7.03576 1.5 7.08579 1.5 7.18585 1.5H10.8142C10.9142 1.5 10.9643 1.5 11.0096 1.50274C11.588 1.53778 12.0945 1.90284 12.3106 2.4405C12.3275 2.4826 12.3434 2.53007 12.375 2.625C12.4066 2.71993 12.4225 2.7674 12.4394 2.8095C12.6555 3.34716 13.1621 3.71222 13.7405 3.74725C13.7858 3.75 13.8391 3.75 13.9458 3.75C14.2227 3.75 14.3612 3.75 14.4718 3.76096C15.539 3.8667 16.3833 4.71095 16.489 5.77816C16.5 5.8888 16.5 6.02018 16.5 6.28292V12.15C16.5 13.4102 16.5 14.0401 16.2548 14.5215C16.0391 14.9449 15.6949 15.2891 15.2715 15.5048C14.7901 15.75 14.1602 15.75 12.9 15.75H5.1C3.83988 15.75 3.20982 15.75 2.72852 15.5048C2.30516 15.2891 1.96095 14.9449 1.74524 14.5215C1.5 14.0401 1.5 13.4102 1.5 12.15V6.28292Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M9 12.375C10.6568 12.375 12 11.0318 12 9.375C12 7.71817 10.6568 6.375 9 6.375C7.34314 6.375 6 7.71817 6 9.375C6 11.0318 7.34314 12.375 9 12.375Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Capture"})]})})]})]})]}),v.jsx("div",{className:"flex h-[68px] justify-end items-center gap-2 self-stretch border-t border-[#D0D4E4] bg-white px-6",children:v.jsx("button",{onClick:G,disabled:!k.front&&!k.back,className:`flex h-[38px] px-4 py-[11px] justify-center items-center gap-2 rounded ${k.front||k.back?"bg-green-600 hover:bg-green-700":"bg-gray-400 cursor-not-allowed"}`,children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Submit"})})})]})}):null}function dq({isOpen:n,onClose:e,onSubmit:t}){const[r,o]=F.useState(null),[s,i]=F.useState(null),a=F.useRef(null),l=F.useRef(null),[c,u]=F.useState(""),[d,h]=F.useState(""),p=5*1024*1024,g=["image/jpeg","image/png","application/pdf"],x=[".jpg",".jpeg",".png",".pdf"];if(!n)return null;const y=k=>{const N=g.includes(k.type)||x.some(_=>k.name.toLowerCase().endsWith(_)),E=k.size<=p;return{typeOk:N,sizeOk:E}},b=k=>{const N=k.target.files?.[0]||null;if(!N){o(null),u("");return}const{typeOk:E,sizeOk:_}=y(N);if(!E||!_){o(null),u("Invalid file. Allowed: JPG, JPEG, PNG, PDF. Max 5MB.");return}u(""),o(N)},C=k=>{const N=k.target.files?.[0]||null;if(!N){i(null),h("");return}const{typeOk:E,sizeOk:_}=y(N);if(!E||!_){i(null),h("Invalid file. Allowed: JPG, JPEG, PNG, PDF. Max 5MB.");return}h(""),i(N)},S=()=>{r&&s&&!c&&!d&&t(r,s)};return v.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:v.jsxs("div",{className:"flex w-[800px] max-w-[90vw] max-h-[90vh] flex-col items-start rounded-lg bg-white overflow-auto",children:[v.jsxs("div",{className:"flex h-[58px] justify-between items-center self-stretch border-b border-[#D0D4E4] px-6",children:[v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("div",{className:"text-[#172B4D] font-figtree text-xl font-bold leading-[30px]",children:"Upload Documents"})}),v.jsx("button",{onClick:e,className:"flex w-8 h-8 justify-center items-center gap-2.5 rounded-full bg-white hover:bg-gray-50",children:v.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),v.jsxs("div",{className:"flex p-6 flex-col items-center gap-6 self-stretch bg-white",children:[v.jsx("div",{className:"text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Upload clear images of both front and back sides."}),v.jsxs("div",{className:"flex flex-col sm:flex-row h-auto sm:h-[320px] items-center gap-6 px-4 sm:px-0",children:[v.jsxs("div",{className:"flex flex-1 min-w-0 h-auto sm:h-[320px] flex-col items-start",children:[v.jsx("div",{className:"flex w-full h-auto sm:h-[272px] flex-col items-center gap-7 flex-shrink-0",children:v.jsx("div",{className:"flex h-auto sm:h-[272px] flex-col items-start flex-shrink-0 self-stretch",children:v.jsx("div",{className:"flex justify-center items-center gap-2 flex-1 self-stretch",children:v.jsxs("div",{className:"flex flex-col justify-end items-center gap-2 flex-1 self-stretch rounded-t-lg border-2 border-dashed border-[#C3C6D4] bg-white cursor-pointer hover:bg-gray-50",onClick:()=>a.current?.click(),children:[v.jsxs("div",{className:"flex w-full max-w-[326px] h-auto sm:h-[262px] flex-col justify-center items-center gap-2",children:[v.jsx("div",{className:"flex w-12 h-12 p-2 justify-center items-center flex-shrink-0 rounded-full bg-[#F6F7FB]",children:v.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.76471 11.5294C6.88944 11.5294 6.4518 11.5294 6.09274 11.6256C5.11837 11.8867 4.35729 12.6478 4.09621 13.6221C4 13.9812 4 14.4188 4 15.2941V16.4235C4 18.0049 4 18.7955 4.30775 19.3995C4.57845 19.9308 5.01039 20.3627 5.54168 20.6334C6.14566 20.9412 6.93632 20.9412 8.51765 20.9412H16.4235C18.0049 20.9412 18.7955 20.9412 19.3995 20.6334C19.9308 20.3627 20.3627 19.9308 20.6334 19.3995C20.9412 18.7955 20.9412 18.0049 20.9412 16.4235V15.2941C20.9412 14.4188 20.9412 13.9812 20.845 13.6221C20.5839 12.6478 19.8228 11.8867 18.8485 11.6256C18.4894 11.5294 18.0518 11.5294 17.1765 11.5294M16.2353 7.76471L12.4706 4M12.4706 4L8.70588 7.76471M12.4706 4V15.2941",stroke:"#676879",strokeWidth:"1.41176",strokeLinecap:"round",strokeLinejoin:"round"})})}),v.jsx("div",{className:"self-stretch text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Front side of your document"}),v.jsxs("div",{className:"text-center font-roboto text-[13px] font-medium",children:[v.jsxs("span",{className:"text-[#172B4D]",children:["Drag & Drop File Here or"," "]}),v.jsx("span",{className:"text-[#0073EA]",children:"Choose File"})]})]}),v.jsx("input",{ref:a,type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:b,className:"hidden"})]})})})}),v.jsx("div",{className:"flex h-12 px-4 justify-center items-end gap-2 flex-shrink-0 self-stretch rounded-b bg-[#F6F7FB]",children:v.jsxs("div",{className:"flex justify-between items-center flex-1 self-stretch",children:[v.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Supported Formats: JPG, JPEG, PNG, PDF"}),v.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Maximum Size: 5MB"})]})})]}),v.jsxs("div",{className:"flex flex-1 min-w-0 h-auto sm:h-[320px] flex-col items-start",children:[v.jsx("div",{className:"flex w-full h-auto sm:h-[272px] flex-col items-center gap-7 flex-shrink-0",children:v.jsx("div",{className:"flex h-auto sm:h-[272px] flex-col items-start flex-shrink-0 self-stretch",children:v.jsx("div",{className:"flex justify-center items-center gap-2 flex-1 self-stretch",children:v.jsxs("div",{className:"flex flex-col justify-end items-center gap-2 flex-1 self-stretch rounded-t-lg border-2 border-dashed border-[#C3C6D4] bg-white cursor-pointer hover:bg-gray-50",onClick:()=>l.current?.click(),children:[v.jsxs("div",{className:"flex w-full max-w-[326px] h-auto sm:h-[262px] flex-col justify-center items-center gap-2",children:[v.jsx("div",{className:"flex w-12 h-12 p-2 justify-center items-center flex-shrink-0 rounded-full bg-[#F6F7FB]",children:v.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.76471 11.5294C6.88944 11.5294 6.4518 11.5294 6.09274 11.6256C5.11837 11.8867 4.35729 12.6478 4.09621 13.6221C4 13.9812 4 14.4188 4 15.2941V16.4235C4 18.0049 4 18.7955 4.30775 19.3995C4.57845 19.9308 5.01039 20.3627 5.54168 20.6334C6.14566 20.9412 6.93632 20.9412 8.51765 20.9412H16.4235C18.0049 20.9412 18.7955 20.9412 19.3995 20.6334C19.9308 20.3627 20.3627 19.9308 20.6334 19.3995C20.9412 18.7955 20.9412 18.0049 20.9412 16.4235V15.2941C20.9412 14.4188 20.9412 13.9812 20.845 13.6221C20.5839 12.6478 19.8228 11.8867 18.8485 11.6256C18.4894 11.5294 18.0518 11.5294 17.1765 11.5294M16.2353 7.76471L12.4706 4M12.4706 4L8.70588 7.76471M12.4706 4V15.2941",stroke:"#676879",strokeWidth:"1.41176",strokeLinecap:"round",strokeLinejoin:"round"})})}),v.jsx("div",{className:"self-stretch text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Back side of your document"}),v.jsxs("div",{className:"text-center font-roboto text-[13px] font-medium",children:[v.jsxs("span",{className:"text-[#172B4D]",children:["Drag & Drop File Here or"," "]}),v.jsx("span",{className:"text-[#0073EA]",children:"Choose File"})]})]}),v.jsx("input",{ref:l,type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:C,className:"hidden"})]})})})}),v.jsx("div",{className:"flex h-12 px-4 justify-center items-end gap-2 flex-shrink-0 self-stretch rounded-b bg-[#F6F7FB]",children:v.jsxs("div",{className:"flex justify-between items-center flex-1 self-stretch",children:[v.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Supported Formats: JPG, JPEG, PNG, PDF"}),v.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Maximum Size: 5MB"})]})})]})]})]}),v.jsxs("div",{className:"flex h-[68px] justify-between items-center gap-2 self-stretch border-t border-[#D0D4E4] bg-white px-6",children:[(c||d)&&v.jsx("div",{className:"text-destructive text-xs",children:c||d}),v.jsx("button",{onClick:S,disabled:!r||!s||!!c||!!d,className:`flex h-[38px] px-4 py-[11px] justify-center items-center gap-2 rounded ${r&&s&&!c&&!d?"bg-[#0073EA] hover:bg-[#0073EA]/90":"bg-[#0073EA]/50 cursor-not-allowed"}`,children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Submit"})})]})]})})}var Rh={},fw,xN;function hq(){return xN||(xN=1,fw=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),fw}var pw={},Pc={},vN;function Dd(){if(vN)return Pc;vN=1;let n;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Pc.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},Pc.getSymbolTotalCodewords=function(r){return e[r]},Pc.getBCHDigit=function(t){let r=0;for(;t!==0;)r++,t>>>=1;return r},Pc.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');n=r},Pc.isKanjiModeEnabled=function(){return typeof n<"u"},Pc.toSJIS=function(r){return n(r)},Pc}var mw={},yN;function R4(){return yN||(yN=1,(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+t)}}n.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},n.from=function(r,o){if(n.isValid(r))return r;try{return e(r)}catch{return o}}})(mw)),mw}var gw,bN;function fq(){if(bN)return gw;bN=1;function n(){this.buffer=[],this.length=0}return n.prototype={get:function(e){const t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)===1},put:function(e,t){for(let r=0;r<t;r++)this.putBit((e>>>t-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},gw=n,gw}var xw,wN;function pq(){if(wN)return xw;wN=1;function n(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return n.prototype.set=function(e,t,r,o){const s=e*this.size+t;this.data[s]=r,o&&(this.reservedBit[s]=!0)},n.prototype.get=function(e,t){return this.data[e*this.size+t]},n.prototype.xor=function(e,t,r){this.data[e*this.size+t]^=r},n.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},xw=n,xw}var vw={},CN;function mq(){return CN||(CN=1,(function(n){const e=Dd().getSymbolSize;n.getRowColCoords=function(r){if(r===1)return[];const o=Math.floor(r/7)+2,s=e(r),i=s===145?26:Math.ceil((s-13)/(2*o-2))*2,a=[s-7];for(let l=1;l<o-1;l++)a[l]=a[l-1]-i;return a.push(6),a.reverse()},n.getPositions=function(r){const o=[],s=n.getRowColCoords(r),i=s.length;for(let a=0;a<i;a++)for(let l=0;l<i;l++)a===0&&l===0||a===0&&l===i-1||a===i-1&&l===0||o.push([s[a],s[l]]);return o}})(vw)),vw}var yw={},kN;function gq(){if(kN)return yw;kN=1;const n=Dd().getSymbolSize,e=7;return yw.getPositions=function(r){const o=n(r);return[[0,0],[o-e,0],[0,o-e]]},yw}var bw={},SN;function xq(){return SN||(SN=1,(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};n.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},n.from=function(o){return n.isValid(o)?parseInt(o,10):void 0},n.getPenaltyN1=function(o){const s=o.size;let i=0,a=0,l=0,c=null,u=null;for(let d=0;d<s;d++){a=l=0,c=u=null;for(let h=0;h<s;h++){let p=o.get(d,h);p===c?a++:(a>=5&&(i+=e.N1+(a-5)),c=p,a=1),p=o.get(h,d),p===u?l++:(l>=5&&(i+=e.N1+(l-5)),u=p,l=1)}a>=5&&(i+=e.N1+(a-5)),l>=5&&(i+=e.N1+(l-5))}return i},n.getPenaltyN2=function(o){const s=o.size;let i=0;for(let a=0;a<s-1;a++)for(let l=0;l<s-1;l++){const c=o.get(a,l)+o.get(a,l+1)+o.get(a+1,l)+o.get(a+1,l+1);(c===4||c===0)&&i++}return i*e.N2},n.getPenaltyN3=function(o){const s=o.size;let i=0,a=0,l=0;for(let c=0;c<s;c++){a=l=0;for(let u=0;u<s;u++)a=a<<1&2047|o.get(c,u),u>=10&&(a===1488||a===93)&&i++,l=l<<1&2047|o.get(u,c),u>=10&&(l===1488||l===93)&&i++}return i*e.N3},n.getPenaltyN4=function(o){let s=0;const i=o.data.length;for(let l=0;l<i;l++)s+=o.data[l];return Math.abs(Math.ceil(s*100/i/5)-10)*e.N4};function t(r,o,s){switch(r){case n.Patterns.PATTERN000:return(o+s)%2===0;case n.Patterns.PATTERN001:return o%2===0;case n.Patterns.PATTERN010:return s%3===0;case n.Patterns.PATTERN011:return(o+s)%3===0;case n.Patterns.PATTERN100:return(Math.floor(o/2)+Math.floor(s/3))%2===0;case n.Patterns.PATTERN101:return o*s%2+o*s%3===0;case n.Patterns.PATTERN110:return(o*s%2+o*s%3)%2===0;case n.Patterns.PATTERN111:return(o*s%3+(o+s)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}n.applyMask=function(o,s){const i=s.size;for(let a=0;a<i;a++)for(let l=0;l<i;l++)s.isReserved(l,a)||s.xor(l,a,t(o,l,a))},n.getBestMask=function(o,s){const i=Object.keys(n.Patterns).length;let a=0,l=1/0;for(let c=0;c<i;c++){s(c),n.applyMask(c,o);const u=n.getPenaltyN1(o)+n.getPenaltyN2(o)+n.getPenaltyN3(o)+n.getPenaltyN4(o);n.applyMask(c,o),u<l&&(l=u,a=c)}return a}})(bw)),bw}var b0={},NN;function nD(){if(NN)return b0;NN=1;const n=R4(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],t=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return b0.getBlocksCount=function(o,s){switch(s){case n.L:return e[(o-1)*4+0];case n.M:return e[(o-1)*4+1];case n.Q:return e[(o-1)*4+2];case n.H:return e[(o-1)*4+3];default:return}},b0.getTotalCodewordsCount=function(o,s){switch(s){case n.L:return t[(o-1)*4+0];case n.M:return t[(o-1)*4+1];case n.Q:return t[(o-1)*4+2];case n.H:return t[(o-1)*4+3];default:return}},b0}var ww={},Ep={},IN;function vq(){if(IN)return Ep;IN=1;const n=new Uint8Array(512),e=new Uint8Array(256);return(function(){let r=1;for(let o=0;o<255;o++)n[o]=r,e[r]=o,r<<=1,r&256&&(r^=285);for(let o=255;o<512;o++)n[o]=n[o-255]})(),Ep.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},Ep.exp=function(r){return n[r]},Ep.mul=function(r,o){return r===0||o===0?0:n[e[r]+e[o]]},Ep}var EN;function yq(){return EN||(EN=1,(function(n){const e=vq();n.mul=function(r,o){const s=new Uint8Array(r.length+o.length-1);for(let i=0;i<r.length;i++)for(let a=0;a<o.length;a++)s[i+a]^=e.mul(r[i],o[a]);return s},n.mod=function(r,o){let s=new Uint8Array(r);for(;s.length-o.length>=0;){const i=s[0];for(let l=0;l<o.length;l++)s[l]^=e.mul(o[l],i);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},n.generateECPolynomial=function(r){let o=new Uint8Array([1]);for(let s=0;s<r;s++)o=n.mul(o,new Uint8Array([1,e.exp(s)]));return o}})(ww)),ww}var Cw,TN;function bq(){if(TN)return Cw;TN=1;const n=yq();function e(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=n.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const o=new Uint8Array(r.length+this.degree);o.set(r);const s=n.mod(o,this.genPoly),i=this.degree-s.length;if(i>0){const a=new Uint8Array(this.degree);return a.set(s,i),a}return s},Cw=e,Cw}var kw={},Sw={},Nw={},RN;function rD(){return RN||(RN=1,Nw.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),Nw}var Ma={},DN;function oD(){if(DN)return Ma;DN=1;const n="[0-9]+",e="[A-Z $%*+\\-./:]+";let t="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";t=t.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+t+`)(?:.|[\r
]))+`;Ma.KANJI=new RegExp(t,"g"),Ma.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Ma.BYTE=new RegExp(r,"g"),Ma.NUMERIC=new RegExp(n,"g"),Ma.ALPHANUMERIC=new RegExp(e,"g");const o=new RegExp("^"+t+"$"),s=new RegExp("^"+n+"$"),i=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Ma.testKanji=function(l){return o.test(l)},Ma.testNumeric=function(l){return s.test(l)},Ma.testAlphanumeric=function(l){return i.test(l)},Ma}var AN;function Ad(){return AN||(AN=1,(function(n){const e=rD(),t=oD();n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(s,i){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(i))throw new Error("Invalid version: "+i);return i>=1&&i<10?s.ccBits[0]:i<27?s.ccBits[1]:s.ccBits[2]},n.getBestModeForData=function(s){return t.testNumeric(s)?n.NUMERIC:t.testAlphanumeric(s)?n.ALPHANUMERIC:t.testKanji(s)?n.KANJI:n.BYTE},n.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},n.isValid=function(s){return s&&s.bit&&s.ccBits};function r(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+o)}}n.from=function(s,i){if(n.isValid(s))return s;try{return r(s)}catch{return i}}})(Sw)),Sw}var _N;function wq(){return _N||(_N=1,(function(n){const e=Dd(),t=nD(),r=R4(),o=Ad(),s=rD(),i=7973,a=e.getBCHDigit(i);function l(h,p,g){for(let x=1;x<=40;x++)if(p<=n.getCapacity(x,g,h))return x}function c(h,p){return o.getCharCountIndicator(h,p)+4}function u(h,p){let g=0;return h.forEach(function(x){const y=c(x.mode,p);g+=y+x.getBitsLength()}),g}function d(h,p){for(let g=1;g<=40;g++)if(u(h,g)<=n.getCapacity(g,p,o.MIXED))return g}n.from=function(p,g){return s.isValid(p)?parseInt(p,10):g},n.getCapacity=function(p,g,x){if(!s.isValid(p))throw new Error("Invalid QR Code version");typeof x>"u"&&(x=o.BYTE);const y=e.getSymbolTotalCodewords(p),b=t.getTotalCodewordsCount(p,g),C=(y-b)*8;if(x===o.MIXED)return C;const S=C-c(x,p);switch(x){case o.NUMERIC:return Math.floor(S/10*3);case o.ALPHANUMERIC:return Math.floor(S/11*2);case o.KANJI:return Math.floor(S/13);case o.BYTE:default:return Math.floor(S/8)}},n.getBestVersionForData=function(p,g){let x;const y=r.from(g,r.M);if(Array.isArray(p)){if(p.length>1)return d(p,y);if(p.length===0)return 1;x=p[0]}else x=p;return l(x.mode,x.getLength(),y)},n.getEncodedBits=function(p){if(!s.isValid(p)||p<7)throw new Error("Invalid QR Code version");let g=p<<12;for(;e.getBCHDigit(g)-a>=0;)g^=i<<e.getBCHDigit(g)-a;return p<<12|g}})(kw)),kw}var Iw={},$N;function Cq(){if($N)return Iw;$N=1;const n=Dd(),e=1335,t=21522,r=n.getBCHDigit(e);return Iw.getEncodedBits=function(s,i){const a=s.bit<<3|i;let l=a<<10;for(;n.getBCHDigit(l)-r>=0;)l^=e<<n.getBCHDigit(l)-r;return(a<<10|l)^t},Iw}var Ew={},Tw,FN;function kq(){if(FN)return Tw;FN=1;const n=Ad();function e(t){this.mode=n.NUMERIC,this.data=t.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let o,s,i;for(o=0;o+3<=this.data.length;o+=3)s=this.data.substr(o,3),i=parseInt(s,10),r.put(i,10);const a=this.data.length-o;a>0&&(s=this.data.substr(o),i=parseInt(s,10),r.put(i,a*3+1))},Tw=e,Tw}var Rw,PN;function Sq(){if(PN)return Rw;PN=1;const n=Ad(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function t(r){this.mode=n.ALPHANUMERIC,this.data=r}return t.getBitsLength=function(o){return 11*Math.floor(o/2)+6*(o%2)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(o){let s;for(s=0;s+2<=this.data.length;s+=2){let i=e.indexOf(this.data[s])*45;i+=e.indexOf(this.data[s+1]),o.put(i,11)}this.data.length%2&&o.put(e.indexOf(this.data[s]),6)},Rw=t,Rw}var Dw,MN;function Nq(){if(MN)return Dw;MN=1;const n=Ad();function e(t){this.mode=n.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(t){for(let r=0,o=this.data.length;r<o;r++)t.put(this.data[r],8)},Dw=e,Dw}var Aw,ON;function Iq(){if(ON)return Aw;ON=1;const n=Ad(),e=Dd();function t(r){this.mode=n.KANJI,this.data=r}return t.getBitsLength=function(o){return o*13},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(r){let o;for(o=0;o<this.data.length;o++){let s=e.toSJIS(this.data[o]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[o]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),r.put(s,13)}},Aw=t,Aw}var _w={exports:{}},LN;function Eq(){return LN||(LN=1,(function(n){var e={single_source_shortest_paths:function(t,r,o){var s={},i={};i[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var l,c,u,d,h,p,g,x,y;!a.empty();){l=a.pop(),c=l.value,d=l.cost,h=t[c]||{};for(u in h)h.hasOwnProperty(u)&&(p=h[u],g=d+p,x=i[u],y=typeof i[u]>"u",(y||x>g)&&(i[u]=g,a.push(u,g),s[u]=c))}if(typeof o<"u"&&typeof i[o]>"u"){var b=["Could not find a path from ",r," to ",o,"."].join("");throw new Error(b)}return s},extract_shortest_path_from_predecessor_list:function(t,r){for(var o=[],s=r;s;)o.push(s),t[s],s=t[s];return o.reverse(),o},find_path:function(t,r,o){var s=e.single_source_shortest_paths(t,r,o);return e.extract_shortest_path_from_predecessor_list(s,o)},PriorityQueue:{make:function(t){var r=e.PriorityQueue,o={},s;t=t||{};for(s in r)r.hasOwnProperty(s)&&(o[s]=r[s]);return o.queue=[],o.sorter=t.sorter||r.default_sorter,o},default_sorter:function(t,r){return t.cost-r.cost},push:function(t,r){var o={value:t,cost:r};this.queue.push(o),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=e})(_w)),_w.exports}var BN;function Tq(){return BN||(BN=1,(function(n){const e=Ad(),t=kq(),r=Sq(),o=Nq(),s=Iq(),i=oD(),a=Dd(),l=Eq();function c(b){return unescape(encodeURIComponent(b)).length}function u(b,C,S){const k=[];let N;for(;(N=b.exec(S))!==null;)k.push({data:N[0],index:N.index,mode:C,length:N[0].length});return k}function d(b){const C=u(i.NUMERIC,e.NUMERIC,b),S=u(i.ALPHANUMERIC,e.ALPHANUMERIC,b);let k,N;return a.isKanjiModeEnabled()?(k=u(i.BYTE,e.BYTE,b),N=u(i.KANJI,e.KANJI,b)):(k=u(i.BYTE_KANJI,e.BYTE,b),N=[]),C.concat(S,k,N).sort(function(_,$){return _.index-$.index}).map(function(_){return{data:_.data,mode:_.mode,length:_.length}})}function h(b,C){switch(C){case e.NUMERIC:return t.getBitsLength(b);case e.ALPHANUMERIC:return r.getBitsLength(b);case e.KANJI:return s.getBitsLength(b);case e.BYTE:return o.getBitsLength(b)}}function p(b){return b.reduce(function(C,S){const k=C.length-1>=0?C[C.length-1]:null;return k&&k.mode===S.mode?(C[C.length-1].data+=S.data,C):(C.push(S),C)},[])}function g(b){const C=[];for(let S=0;S<b.length;S++){const k=b[S];switch(k.mode){case e.NUMERIC:C.push([k,{data:k.data,mode:e.ALPHANUMERIC,length:k.length},{data:k.data,mode:e.BYTE,length:k.length}]);break;case e.ALPHANUMERIC:C.push([k,{data:k.data,mode:e.BYTE,length:k.length}]);break;case e.KANJI:C.push([k,{data:k.data,mode:e.BYTE,length:c(k.data)}]);break;case e.BYTE:C.push([{data:k.data,mode:e.BYTE,length:c(k.data)}])}}return C}function x(b,C){const S={},k={start:{}};let N=["start"];for(let E=0;E<b.length;E++){const _=b[E],$=[];for(let T=0;T<_.length;T++){const D=_[T],A=""+E+T;$.push(A),S[A]={node:D,lastCount:0},k[A]={};for(let M=0;M<N.length;M++){const j=N[M];S[j]&&S[j].node.mode===D.mode?(k[j][A]=h(S[j].lastCount+D.length,D.mode)-h(S[j].lastCount,D.mode),S[j].lastCount+=D.length):(S[j]&&(S[j].lastCount=D.length),k[j][A]=h(D.length,D.mode)+4+e.getCharCountIndicator(D.mode,C))}}N=$}for(let E=0;E<N.length;E++)k[N[E]].end=0;return{map:k,table:S}}function y(b,C){let S;const k=e.getBestModeForData(b);if(S=e.from(C,k),S!==e.BYTE&&S.bit<k.bit)throw new Error('"'+b+'" cannot be encoded with mode '+e.toString(S)+`.
 Suggested mode is: `+e.toString(k));switch(S===e.KANJI&&!a.isKanjiModeEnabled()&&(S=e.BYTE),S){case e.NUMERIC:return new t(b);case e.ALPHANUMERIC:return new r(b);case e.KANJI:return new s(b);case e.BYTE:return new o(b)}}n.fromArray=function(C){return C.reduce(function(S,k){return typeof k=="string"?S.push(y(k,null)):k.data&&S.push(y(k.data,k.mode)),S},[])},n.fromString=function(C,S){const k=d(C,a.isKanjiModeEnabled()),N=g(k),E=x(N,S),_=l.find_path(E.map,"start","end"),$=[];for(let T=1;T<_.length-1;T++)$.push(E.table[_[T]].node);return n.fromArray(p($))},n.rawSplit=function(C){return n.fromArray(d(C,a.isKanjiModeEnabled()))}})(Ew)),Ew}var jN;function Rq(){if(jN)return pw;jN=1;const n=Dd(),e=R4(),t=fq(),r=pq(),o=mq(),s=gq(),i=xq(),a=nD(),l=bq(),c=wq(),u=Cq(),d=Ad(),h=Tq();function p(E,_){const $=E.size,T=s.getPositions(_);for(let D=0;D<T.length;D++){const A=T[D][0],M=T[D][1];for(let j=-1;j<=7;j++)if(!(A+j<=-1||$<=A+j))for(let L=-1;L<=7;L++)M+L<=-1||$<=M+L||(j>=0&&j<=6&&(L===0||L===6)||L>=0&&L<=6&&(j===0||j===6)||j>=2&&j<=4&&L>=2&&L<=4?E.set(A+j,M+L,!0,!0):E.set(A+j,M+L,!1,!0))}}function g(E){const _=E.size;for(let $=8;$<_-8;$++){const T=$%2===0;E.set($,6,T,!0),E.set(6,$,T,!0)}}function x(E,_){const $=o.getPositions(_);for(let T=0;T<$.length;T++){const D=$[T][0],A=$[T][1];for(let M=-2;M<=2;M++)for(let j=-2;j<=2;j++)M===-2||M===2||j===-2||j===2||M===0&&j===0?E.set(D+M,A+j,!0,!0):E.set(D+M,A+j,!1,!0)}}function y(E,_){const $=E.size,T=c.getEncodedBits(_);let D,A,M;for(let j=0;j<18;j++)D=Math.floor(j/3),A=j%3+$-8-3,M=(T>>j&1)===1,E.set(D,A,M,!0),E.set(A,D,M,!0)}function b(E,_,$){const T=E.size,D=u.getEncodedBits(_,$);let A,M;for(A=0;A<15;A++)M=(D>>A&1)===1,A<6?E.set(A,8,M,!0):A<8?E.set(A+1,8,M,!0):E.set(T-15+A,8,M,!0),A<8?E.set(8,T-A-1,M,!0):A<9?E.set(8,15-A-1+1,M,!0):E.set(8,15-A-1,M,!0);E.set(T-8,8,1,!0)}function C(E,_){const $=E.size;let T=-1,D=$-1,A=7,M=0;for(let j=$-1;j>0;j-=2)for(j===6&&j--;;){for(let L=0;L<2;L++)if(!E.isReserved(D,j-L)){let U=!1;M<_.length&&(U=(_[M]>>>A&1)===1),E.set(D,j-L,U),A--,A===-1&&(M++,A=7)}if(D+=T,D<0||$<=D){D-=T,T=-T;break}}}function S(E,_,$){const T=new t;$.forEach(function(L){T.put(L.mode.bit,4),T.put(L.getLength(),d.getCharCountIndicator(L.mode,E)),L.write(T)});const D=n.getSymbolTotalCodewords(E),A=a.getTotalCodewordsCount(E,_),M=(D-A)*8;for(T.getLengthInBits()+4<=M&&T.put(0,4);T.getLengthInBits()%8!==0;)T.putBit(0);const j=(M-T.getLengthInBits())/8;for(let L=0;L<j;L++)T.put(L%2?17:236,8);return k(T,E,_)}function k(E,_,$){const T=n.getSymbolTotalCodewords(_),D=a.getTotalCodewordsCount(_,$),A=T-D,M=a.getBlocksCount(_,$),j=T%M,L=M-j,U=Math.floor(T/M),G=Math.floor(A/M),H=G+1,O=U-G,V=new l(O);let W=0;const B=new Array(M),q=new Array(M);let Q=0;const Z=new Uint8Array(E.buffer);for(let Re=0;Re<M;Re++){const We=Re<L?G:H;B[Re]=Z.slice(W,W+We),q[Re]=V.encode(B[Re]),W+=We,Q=Math.max(Q,We)}const ne=new Uint8Array(T);let ge=0,he,Se;for(he=0;he<Q;he++)for(Se=0;Se<M;Se++)he<B[Se].length&&(ne[ge++]=B[Se][he]);for(he=0;he<O;he++)for(Se=0;Se<M;Se++)ne[ge++]=q[Se][he];return ne}function N(E,_,$,T){let D;if(Array.isArray(E))D=h.fromArray(E);else if(typeof E=="string"){let U=_;if(!U){const G=h.rawSplit(E);U=c.getBestVersionForData(G,$)}D=h.fromString(E,U||40)}else throw new Error("Invalid data");const A=c.getBestVersionForData(D,$);if(!A)throw new Error("The amount of data is too big to be stored in a QR Code");if(!_)_=A;else if(_<A)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+A+`.
`);const M=S(_,$,D),j=n.getSymbolSize(_),L=new r(j);return p(L,_),g(L),x(L,_),b(L,$,0),_>=7&&y(L,_),C(L,M),isNaN(T)&&(T=i.getBestMask(L,b.bind(null,L,$))),i.applyMask(T,L),b(L,$,T),{modules:L,version:_,errorCorrectionLevel:$,maskPattern:T,segments:D}}return pw.create=function(_,$){if(typeof _>"u"||_==="")throw new Error("No input text");let T=e.M,D,A;return typeof $<"u"&&(T=e.from($.errorCorrectionLevel,e.M),D=c.from($.version),A=i.from($.maskPattern),$.toSJISFunc&&n.setToSJISFunction($.toSJISFunc)),N(_,D,T,A)},pw}var $w={},Fw={},VN;function sD(){return VN||(VN=1,(function(n){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let r=t.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+t);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(s){return[s,s]}))),r.length===6&&r.push("F","F");const o=parseInt(r.join(""),16);return{r:o>>24&255,g:o>>16&255,b:o>>8&255,a:o&255,hex:"#"+r.slice(0,6).join("")}}n.getOptions=function(r){r||(r={}),r.color||(r.color={});const o=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,s=r.width&&r.width>=21?r.width:void 0,i=r.scale||4;return{width:s,scale:s?4:i,margin:o,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},n.getScale=function(r,o){return o.width&&o.width>=r+o.margin*2?o.width/(r+o.margin*2):o.scale},n.getImageWidth=function(r,o){const s=n.getScale(r,o);return Math.floor((r+o.margin*2)*s)},n.qrToImageData=function(r,o,s){const i=o.modules.size,a=o.modules.data,l=n.getScale(i,s),c=Math.floor((i+s.margin*2)*l),u=s.margin*l,d=[s.color.light,s.color.dark];for(let h=0;h<c;h++)for(let p=0;p<c;p++){let g=(h*c+p)*4,x=s.color.light;if(h>=u&&p>=u&&h<c-u&&p<c-u){const y=Math.floor((h-u)/l),b=Math.floor((p-u)/l);x=d[a[y*i+b]?1:0]}r[g++]=x.r,r[g++]=x.g,r[g++]=x.b,r[g]=x.a}}})(Fw)),Fw}var zN;function Dq(){return zN||(zN=1,(function(n){const e=sD();function t(o,s,i){o.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=i,s.width=i,s.style.height=i+"px",s.style.width=i+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(s,i,a){let l=a,c=i;typeof l>"u"&&(!i||!i.getContext)&&(l=i,i=void 0),i||(c=r()),l=e.getOptions(l);const u=e.getImageWidth(s.modules.size,l),d=c.getContext("2d"),h=d.createImageData(u,u);return e.qrToImageData(h.data,s,l),t(d,c,u),d.putImageData(h,0,0),c},n.renderToDataURL=function(s,i,a){let l=a;typeof l>"u"&&(!i||!i.getContext)&&(l=i,i=void 0),l||(l={});const c=n.render(s,i,l),u=l.type||"image/png",d=l.rendererOpts||{};return c.toDataURL(u,d.quality)}})($w)),$w}var Pw={},WN;function Aq(){if(WN)return Pw;WN=1;const n=sD();function e(o,s){const i=o.a/255,a=s+'="'+o.hex+'"';return i<1?a+" "+s+'-opacity="'+i.toFixed(2).slice(1)+'"':a}function t(o,s,i){let a=o+s;return typeof i<"u"&&(a+=" "+i),a}function r(o,s,i){let a="",l=0,c=!1,u=0;for(let d=0;d<o.length;d++){const h=Math.floor(d%s),p=Math.floor(d/s);!h&&!c&&(c=!0),o[d]?(u++,d>0&&h>0&&o[d-1]||(a+=c?t("M",h+i,.5+p+i):t("m",l,0),l=0,c=!1),h+1<s&&o[d+1]||(a+=t("h",u),u=0)):l++}return a}return Pw.render=function(s,i,a){const l=n.getOptions(i),c=s.modules.size,u=s.modules.data,d=c+l.margin*2,h=l.color.light.a?"<path "+e(l.color.light,"fill")+' d="M0 0h'+d+"v"+d+'H0z"/>':"",p="<path "+e(l.color.dark,"stroke")+' d="'+r(u,c,l.margin)+'"/>',g='viewBox="0 0 '+d+" "+d+'"',y='<svg xmlns="http://www.w3.org/2000/svg" '+(l.width?'width="'+l.width+'" height="'+l.width+'" ':"")+g+' shape-rendering="crispEdges">'+h+p+`</svg>
`;return typeof a=="function"&&a(null,y),y},Pw}var UN;function _q(){if(UN)return Rh;UN=1;const n=hq(),e=Rq(),t=Dq(),r=Aq();function o(s,i,a,l,c){const u=[].slice.call(arguments,1),d=u.length,h=typeof u[d-1]=="function";if(!h&&!n())throw new Error("Callback required as last argument");if(h){if(d<2)throw new Error("Too few arguments provided");d===2?(c=a,a=i,i=l=void 0):d===3&&(i.getContext&&typeof c>"u"?(c=l,l=void 0):(c=l,l=a,a=i,i=void 0))}else{if(d<1)throw new Error("Too few arguments provided");return d===1?(a=i,i=l=void 0):d===2&&!i.getContext&&(l=a,a=i,i=void 0),new Promise(function(p,g){try{const x=e.create(a,l);p(s(x,i,l))}catch(x){g(x)}})}try{const p=e.create(a,l);c(null,s(p,i,l))}catch(p){c(p)}}return Rh.create=e.create,Rh.toCanvas=o.bind(null,t.render),Rh.toDataURL=o.bind(null,t.renderToDataURL),Rh.toString=o.bind(null,function(s,i,a){return r.render(s,a)}),Rh}var $q=_q();const Fq=gv($q);async function Pq(n){try{const r=`${"https://idvapi-test.arconnet.com:1019"||window.location.origin}/form`,o=new URLSearchParams;o.set("code",n.shortCode),n.templateVersionId&&o.set("templateVersionId",n.templateVersionId.toString()),n.userId&&o.set("userId",n.userId.toString()),n.sessionId&&o.set("sessionId",n.sessionId),n.currentStep&&o.set("step",n.currentStep);const s=`${r}?${o.toString()}`;return await Fq.toDataURL(s,{errorCorrectionLevel:"M",type:"image/png",margin:1,color:{dark:"#000000",light:"#FFFFFF"},width:256})}catch(e){throw console.error("Error generating QR code:",e),new Error("Failed to generate QR code")}}function Mq(){const n=new URLSearchParams(window.location.search);return{templateVersionId:n.get("templateVersionId")?parseInt(n.get("templateVersionId")):void 0,userId:n.get("userId")?parseInt(n.get("userId")):void 0,sessionId:n.get("sessionId")||void 0,currentStep:n.get("step")||void 0}}function HN({shortCode:n,templateVersionId:e,userId:t,sessionId:r,currentStep:o="document-upload",size:s="medium",showUrl:i=!0,className:a=""}){const[l,c]=F.useState(""),[u,d]=F.useState(""),[h,p]=F.useState(!0),[g,x]=F.useState(""),y={small:"w-16 h-16 sm:w-20 sm:h-20",medium:"w-20 h-20 sm:w-24 sm:h-24",large:"w-24 h-24 sm:w-32 sm:h-32"};return F.useEffect(()=>{(async()=>{if(!n){x("No shortcode provided"),p(!1);return}try{p(!0),x("");const S=await Pq({shortCode:n,templateVersionId:e,userId:t,sessionId:r,currentStep:o});c(S);const E=`${"https://idvapi-test.arconnet.com:1019"||window.location.origin}/form?code=${encodeURIComponent(n)}`;d(E)}catch(C){console.error("Failed to generate QR code:",C),x("Failed to generate QR code")}finally{p(!1)}})()},[n,e,t,r,o]),h?v.jsx("div",{className:`flex justify-center items-center ${y[s]} ${a}`,children:v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0073EA]"})}):g?v.jsxs("div",{className:`flex flex-col justify-center items-center ${y[s]} ${a} bg-gray-100 rounded-lg`,children:[v.jsx("svg",{className:"w-6 h-6 text-gray-400 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),v.jsx("span",{className:"text-xs text-gray-500 text-center",children:"QR Error"})]}):v.jsxs("div",{className:`flex flex-col items-center gap-2 ${a}`,children:[l?v.jsx("img",{src:l,alt:"QR Code for verification",className:`${y[s]} object-contain rounded-lg border-2 border-white shadow-lg bg-white p-2`,onError:b=>{console.error("QR Code image failed to load:",b),x("Failed to display QR code")}}):v.jsx("div",{className:`${y[s]} bg-gray-100 rounded-lg flex items-center justify-center`,children:v.jsx("span",{className:"text-gray-500 text-xs",children:"No QR Code"})}),i&&u&&v.jsx("div",{className:"text-xs text-[#0073EA] text-center break-all max-w-[200px]",children:u.length>40?`${u.substring(0,40)}...`:u})]})}const Mw="idv_session_state",Oq=5e3;function Lq(n){const[e,t]=F.useState(()=>{const s=localStorage.getItem(Mw);if(s)try{const i=JSON.parse(s);return{sessionId:Ow(),currentStep:"document-upload",uploadedDocuments:[],formData:{},lastUpdated:Date.now(),...i,...n}}catch(i){console.error("Failed to parse saved session:",i)}return{sessionId:Ow(),currentStep:"document-upload",uploadedDocuments:[],formData:{},lastUpdated:Date.now(),...n}});F.useEffect(()=>{localStorage.setItem(Mw,JSON.stringify(e))},[e]);const r=F.useCallback(s=>{t(i=>({...i,...s,lastUpdated:Date.now()}))},[]),o=F.useCallback(()=>{localStorage.removeItem(Mw),t({sessionId:Ow(),currentStep:"document-upload",uploadedDocuments:[],formData:{},lastUpdated:Date.now(),...n})},[n]);return F.useEffect(()=>{const s=setInterval(()=>{console.log("Session sync check:",e.sessionId)},Oq);return()=>clearInterval(s)},[e.sessionId]),{sessionState:e,updateSession:r,clearSession:o}}function Ow(){return`session_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}const Lw="https://idvapi-test.arconnet.com:1019";function iD({onComplete:n,documentConfig:e={},submissionId:t,shortCode:r="",templateVersionId:o,userId:s,documentFormState:i,setDocumentFormState:a,onDocumentUploaded:l}){const[c,u]=F.useState(""),[d,h]=F.useState(""),[p,g]=F.useState(!1),[x,y]=F.useState(!1),[b,C]=F.useState(!1),[S,k]=F.useState([]),[N,E]=F.useState([]),[_,$]=F.useState({}),[T,D]=F.useState(!1),[A,M]=F.useState(!1),[j,L]=F.useState(null),[U,G]=F.useState(!1),H=`${r||"unknown"}:${t||0}`,O=async()=>{try{D(!0);const ye=await fetch(`http://10.10.2.133:8086/api/IdentityVerification/generate-auth-url?getBackString=${encodeURIComponent(H)}`,{method:"GET",headers:{accept:"*/*"}});if(!ye.ok){const xt=await ye.text().catch(()=>"");throw new Error(`Failed to generate auth URL: ${ye.status} ${xt}`)}const{url:Fe,codeVerifier:Oe}=await ye.json();sessionStorage.setItem("digilocker_code_verifier",Oe||""),sessionStorage.setItem("digilocker_state",H),window.location.href=Fe}catch(ye){console.error(ye),alert("Could not start DigiLocker flow. Please try again.")}finally{D(!1)}},V=!!(i&&a);console.log(" IdentityDocumentForm render:",{isUsingLiftedState:V,hasDocumentFormState:!!i,hasSetDocumentFormState:!!a,currentUploadedDocuments:V?i?.uploadedDocuments:S,currentUploadedFiles:V?i?.uploadedFiles:N});const W=V?i.country:c,B=V?i.selectedDocument:d,q=V?i.uploadedDocuments:S,Q=V?i.uploadedFiles:N,Z=V?i.documentUploadIds:_,ne=ye=>{V?a(Fe=>({...Fe,country:ye})):u(ye)},ge=ye=>{V?a(Fe=>({...Fe,selectedDocument:ye})):h(ye)},he=ye=>{if(console.log(" setUploadedDocuments called, isUsingLiftedState:",V),V){const Fe=typeof ye=="function"?ye(i.uploadedDocuments):ye;console.log(" Setting lifted uploadedDocuments:",Fe),a(Oe=>({...Oe,uploadedDocuments:Fe}))}else k(ye),console.log(" Setting local uploadedDocuments")},Se=ye=>{if(console.log(" setUploadedFiles called, isUsingLiftedState:",V),V){const Fe=typeof ye=="function"?ye(i.uploadedFiles):ye;console.log(" Setting lifted uploadedFiles:",Fe),a(Oe=>({...Oe,uploadedFiles:Fe}))}else E(ye),console.log(" Setting local uploadedFiles")},Re=ye=>{if(V){const Fe=typeof ye=="function"?ye(i.documentUploadIds):ye;a(Oe=>({...Oe,documentUploadIds:Fe}))}else $(ye)},We=(ye,Fe,Oe,xt)=>{V&&a(at=>{const Lt=at.documentsDetails.findIndex(On=>On.documentName===ye),St={documentName:ye,documentDefinitionId:Fe,frontFileId:Oe,backFileId:xt,status:"uploaded",uploadedAt:new Date().toISOString()};let Rt;return Lt>=0?(Rt=[...at.documentsDetails],Rt[Lt]=St):Rt=[...at.documentsDetails,St],console.log(" Updated documentsDetails:",Rt),{...at,documentsDetails:Rt}})},[Be,Xe]=F.useState(0);F.useEffect(()=>{if(!V||!i)return;const ye=i.documentsDetails.length;ye>Be&&ye>0&&(console.log(" documentsDetails changed! Length:",ye),console.log(" Current documentsDetails:",i.documentsDetails),setTimeout(()=>{console.log(" Triggering auto-save after document upload..."),console.log(" Documents to be sent:",i.documentsDetails.map(Fe=>Fe.documentName)),l?.()},200)),Xe(ye)},[i?.documentsDetails,V,l,Be]);const{sessionState:Ye,updateSession:ot}=Lq({shortCode:r,templateVersionId:o,userId:s,currentStep:"document-upload",uploadedDocuments:q,formData:{country:W,selectedDocument:B}});F.useEffect(()=>{ot({uploadedDocuments:q,formData:{country:W,selectedDocument:B},currentStep:"document-upload"})},[q,W,B]),F.useEffect(()=>{const ye=sessionStorage.getItem("digilocker_auth_code"),Fe=sessionStorage.getItem("digilocker_callback_state"),Oe=sessionStorage.getItem("digilocker_callback_timestamp"),xt=Oe&&Date.now()-parseInt(Oe)<300*1e3;if(!ye||!Fe||!xt)return;console.log(" Processing DigiLocker callback data"),(async()=>{const Lt=sessionStorage.getItem("digilocker_code_verifier")||"",St=sessionStorage.getItem("digilocker_state")||"";if(St&&Fe!==St){console.warn(" DigiLocker state mismatch");return}const[Rt,On]=Fe.split(":");console.log(" DigiLocker callback context:",{shortCode:Rt,submissionId:On});const En=(er=>({aadhaar_card:"Aadhar card",passport:"Passport",pan_card:"Pan card",driving_license:"Driving License",voter_id:"Voter ID"})[er]??er.replace(/_/g," "))("PAN Verification Record"),xo="pranathi.narsupalli@arconnet.com",Er=3,gs="template p",zn=new URL("http://10.10.2.133:8086/api/IdentityVerification/fetch-document");zn.searchParams.set("AuthCode",ye),zn.searchParams.set("CodeVerifier",Lt),zn.searchParams.set("RequestedDocType",En),zn.searchParams.set("EmailID",xo),zn.searchParams.set("DocumentID",String(Er)),zn.searchParams.set("TemplateName",gs);try{const er=await fetch(zn.toString(),{method:"POST",headers:{accept:"*/*"},body:""});if(!er.ok){const Vs=await er.text().catch(()=>"");throw new Error(`fetch-document failed: ${er.status} ${Vs}`)}const ar=await er.json().catch(()=>({}));console.log(" DigiLocker document fetched successfully:",ar)}catch(er){console.error(" Error fetching DigiLocker document:",er),alert("Could not fetch DigiLocker document. Please try again.")}finally{sessionStorage.removeItem("digilocker_auth_code"),sessionStorage.removeItem("digilocker_callback_state"),sessionStorage.removeItem("digilocker_callback_timestamp"),sessionStorage.removeItem("digilocker_code_verifier"),sessionStorage.removeItem("digilocker_state"),console.log(" DigiLocker session data cleaned up")}})()},[B]),F.useEffect(()=>{const ye=Mq();ye.sessionId&&console.log("Loading session from QR scan:",ye)},[]);const Qe=(ye,Fe)=>{const Oe=new FormData;Oe.append("File",ye,Fe);const xt=Ht.find(St=>St.toLowerCase().replace(/\s+/g,"_")===B)||"";let at=cn(W,xt);at||(console.warn(`Document definition ID not found in config for ${xt}, using fallback mapping`),at=Q3(W,xt)),Oe.append("DocumentDefinitionId",at),Oe.append("Bucket","string");const Lt=t?.toString()||"1";return console.log("IdentityDocumentForm: Using UserTemplateSubmissionId:",Lt),console.log("IdentityDocumentForm: Using DocumentDefinitionId:",at,"for document:",xt),Oe.append("UserTemplateSubmissionId",Lt),Oe},ct=async(ye,Fe,Oe)=>{const xt=`${Lw}/api/Files/upload`,at=Qe(ye,Fe),Lt=await fetch(xt,{method:"POST",body:at});if(!Lt.ok&&Lt.status!==201)throw new Error(`POST failed: ${Lt.statusText}`);const St=await Lt.json().catch(()=>({})),Rt=St&&St.file&&typeof St.file.id=="number"&&St.file.id||typeof St.id=="number"&&St.id||St&&St.mapping&&typeof St.mapping.fileId=="number"&&St.mapping.fileId||null;if(!Rt)throw new Error("Upload did not return an id");return Rt},ie=async(ye,Fe)=>{try{console.log(" Starting download for fileId:",ye,"fileName:",Fe);const Oe=`${Lw}/api/Files/${ye}/content?inline=false`;console.log(" Download URL:",Oe);const xt=await fetch(Oe,{method:"GET",headers:{Accept:"*/*"}});if(console.log(" Download response status:",xt.status),!xt.ok)throw new Error(`Failed to download file: ${xt.statusText}`);const at=await xt.blob();console.log(" Downloaded blob size:",at.size,"bytes");const Lt=window.URL.createObjectURL(at),St=document.createElement("a");St.href=Lt,St.download=Fe||`document-${ye}`,document.body.appendChild(St),St.click(),console.log(" Download triggered for:",Fe),window.URL.revokeObjectURL(Lt),document.body.removeChild(St)}catch(Oe){console.error(" Error downloading file:",Oe),alert(`Failed to download file: ${Oe instanceof Error?Oe.message:"Unknown error"}`)}},$t=async ye=>{console.log(" downloadDocumentFiles called for docId:",ye),console.log(" Available documentUploadIds:",Z);const Fe=Z[ye];if(!Fe){console.error(" No fileIds found for docId:",ye),alert("No files found for this document");return}console.log(" Found fileIds:",Fe);const Oe=Ht.find(xt=>xt.toLowerCase().replace(/\s+/g,"_")===ye)||ye.replace(/_/g," ");console.log(" Document name:",Oe),Fe.front&&(console.log(" Downloading front file, ID:",Fe.front),await ie(Fe.front,`${Oe} - Front.jpg`)),Fe.back&&(console.log(" Downloading back file (after 500ms delay), ID:",Fe.back),setTimeout(()=>{ie(Fe.back,`${Oe} - Back.jpg`)},500))},Ot=async ye=>{try{console.log(" Deleting file ID:",ye);const Fe=`${Lw}/api/Files/${ye}`;console.log(" Delete URL:",Fe);const Oe=await fetch(Fe,{method:"DELETE",headers:{Accept:"*/*"}});if(console.log(" Delete response status:",Oe.status),!Oe.ok)throw new Error(`Failed to delete file: ${Oe.statusText}`);return console.log(" File deleted successfully:",ye),!0}catch(Fe){throw console.error(" Error deleting file:",Fe),Fe}},qt=async ye=>{const Fe=Z[ye];if(!Fe){console.error(" No fileIds found for docId:",ye),alert("No files found for this document");return}const Oe=Ht.find(xt=>xt.toLowerCase().replace(/\s+/g,"_")===ye)||ye.replace(/_/g," ");try{G(!0);const xt=[];Fe.front&&(console.log(" Deleting front file, ID:",Fe.front),xt.push(Ot(Fe.front))),Fe.back&&(console.log(" Deleting back file, ID:",Fe.back),xt.push(Ot(Fe.back))),await Promise.all(xt),he(at=>at.filter(Lt=>Lt!==ye)),Se(at=>at.filter(Lt=>Lt.id.replace(/-\d+$/,"")!==ye)),Re(at=>{const Lt={...at};return delete Lt[ye],Lt}),V&&a(at=>{const Lt=at.documentsDetails.filter(St=>St.documentName!==Oe);return console.log(" Removed from documentsDetails:",Oe),console.log(" Updated documentsDetails after deletion:",Lt),console.log(" Remaining documents count:",Lt.length),queueMicrotask(()=>{setTimeout(()=>{l&&(console.log(" POST request triggered after deleting:",Oe),console.log(" Remaining documents to be sent:",Lt.map(St=>St.documentName)),l())},150)}),{...at,documentsDetails:Lt}}),localStorage.removeItem(`document_${ye}_image`),console.log(" Document deleted successfully:",Oe),console.log(` ${Oe} deleted and backend will be updated with remaining documents`)}catch(xt){console.error(" Error deleting document:",xt),alert(`Failed to delete ${Oe}. Please try again.`)}finally{G(!1),M(!1),L(null)}},en=e.supportedCountries||[],hn=ye=>en.find(Oe=>Oe.countryName===ye)?.documents||[],cn=(ye,Fe)=>{const Oe=en.find(at=>at.countryName===ye);if(!Oe)return null;const xt=Oe.documents.find(at=>typeof at=="string"?at===Fe:at.title===Fe);return xt&&typeof xt!="string"&&xt.documentDefinitionId?xt.documentDefinitionId:null},tn=()=>{if(!W||!B)return null;const ye=Ht.find(Oe=>Oe.toLowerCase().replace(/\s+/g,"_")===B);if(!ye)return null;let Fe=cn(W,ye);return Fe||(Fe=Q3(W,ye)),Fe?parseInt(Fe,10):null},Ht=W?hn(W).map(ye=>typeof ye=="string"?ye:ye.title):[],Yt=ye=>({Passport:{color:"#5A43D6",icon:v.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M12 21.5C10.6975 21.5 9.46833 21.2503 8.3125 20.751C7.15667 20.2517 6.14867 19.5718 5.2885 18.7115C4.42817 17.8513 3.74833 16.8433 3.249 15.6875C2.74967 14.5317 2.5 13.3025 2.5 12C2.5 10.6872 2.74967 9.45542 3.249 8.30475C3.74833 7.15408 4.42817 6.14867 5.2885 5.2885C6.14867 4.42817 7.15667 3.74833 8.3125 3.249C9.46833 2.74967 10.6975 2.5 12 2.5C13.3128 2.5 14.5446 2.74967 15.6953 3.249C16.8459 3.74833 17.8513 4.42817 18.7115 5.2885C19.5718 6.14867 20.2517 7.15408 20.751 8.30475C21.2503 9.45542 21.5 10.6872 21.5 12C21.5 13.3025 21.2503 14.5317 20.751 15.6875C20.2517 16.8433 19.5718 17.8513 18.7115 18.7115C17.8513 19.5718 16.8459 20.2517 15.6953 20.751C14.5446 21.2503 13.3128 21.5 12 21.5ZM12 19.9788C12.5103 19.3019 12.9398 18.6192 13.2885 17.9307C13.6372 17.2422 13.9212 16.4897 14.1405 15.673H9.8595C10.0917 16.5153 10.3789 17.2808 10.7213 17.9693C11.0634 18.6578 11.4897 19.3276 12 19.9788ZM10.0635 19.7038C9.68017 19.1538 9.33592 18.5285 9.03075 17.828C8.72558 17.1273 8.48842 16.409 8.31925 15.673H4.927C5.45517 16.7115 6.1635 17.584 7.052 18.2905C7.9405 18.9968 8.94433 19.4679 10.0635 19.7038ZM13.9365 19.7038C15.0557 19.4679 16.0595 18.9968 16.948 18.2905C17.8365 17.584 18.5448 16.7115 19.073 15.673H15.6807C15.4794 16.4153 15.2262 17.1368 14.921 17.8375C14.616 18.5382 14.2878 19.1603 13.9365 19.7038ZM4.298 14.173H8.0155C7.95267 13.8013 7.90708 13.4369 7.87875 13.0798C7.85058 12.7228 7.8365 12.3628 7.8365 12C7.8365 11.6372 7.85058 11.2773 7.87875 10.9202C7.90708 10.5631 7.95267 10.1987 8.0155 9.827H4.298C4.20183 10.1667 4.12817 10.5198 4.077 10.8865C4.02567 11.2532 4 11.6243 4 12C4 12.3757 4.02567 12.7468 4.077 13.1135C4.12817 13.4802 4.20183 13.8333 4.298 14.173ZM9.51525 14.173H14.4848C14.5474 13.8013 14.5929 13.4402 14.6212 13.0895C14.6494 12.7388 14.6635 12.3757 14.6635 12C14.6635 11.6243 14.6494 11.2612 14.6212 10.9105C14.5929 10.5598 14.5474 10.1987 14.4848 9.827H9.51525C9.45258 10.1987 9.40708 10.5598 9.37875 10.9105C9.35058 11.2612 9.3365 11.6243 9.3365 12C9.3365 12.3757 9.35058 12.7388 9.37875 13.0895C9.40708 13.4402 9.45258 13.8013 9.51525 14.173ZM15.9845 14.173H19.702C19.7982 13.8333 19.8718 13.4802 19.923 13.1135C19.9743 12.7468 20 12.3757 20 12C20 11.6243 19.9743 11.2532 19.923 10.8865C19.8718 10.5198 19.7982 10.1667 19.702 9.827H15.9845C16.0473 10.1987 16.0929 10.5631 16.1212 10.9202C16.1494 11.2773 16.1635 11.6372 16.1635 12C16.1635 12.3628 16.1494 12.7228 16.1212 13.0798C16.0929 13.4369 16.0473 13.8013 15.9845 14.173ZM15.6807 8.327H19.073C18.5385 7.27567 17.835 6.40317 16.9625 5.7095C16.09 5.016 15.0813 4.54167 13.9365 4.2865C14.3198 4.8685 14.6608 5.50508 14.9595 6.19625C15.2583 6.88725 15.4987 7.5975 15.6807 8.327ZM9.8595 8.327H14.1405C13.9083 7.491 13.6163 6.72075 13.2645 6.01625C12.9125 5.31175 12.491 4.64675 12 4.02125C11.509 4.64675 11.0875 5.31175 10.7355 6.01625C10.3837 6.72075 10.0917 7.491 9.8595 8.327ZM4.927 8.327H8.31925C8.50125 7.5975 8.74167 6.88725 9.0405 6.19625C9.33917 5.50508 9.68017 4.8685 10.0635 4.2865C8.91217 4.54167 7.90192 5.01767 7.03275 5.7145C6.16342 6.41117 5.4615 7.282 4.927 8.327Z",fill:"white"})})},"Driver License":{color:"#ED5F00",icon:v.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M4.30775 20.5C3.80258 20.5 3.375 20.325 3.025 19.975C2.675 19.625 2.5 19.1974 2.5 18.6923V5.30775C2.5 4.80258 2.675 4.375 3.025 4.025C3.375 3.675 3.80258 3.5 4.30775 3.5H19.6923C20.1974 3.5 20.625 3.675 20.975 4.025C21.325 4.375 21.5 4.80258 21.5 5.30775V18.6923C21.5 19.1974 21.325 19.625 20.975 19.975C20.625 20.325 20.1974 20.5 19.6923 20.5H4.30775ZM4.30775 19H19.6923C19.7693 19 19.8398 18.9679 19.9038 18.9038C19.9679 18.8398 20 18.7692 20 18.6923V5.30775C20 5.23075 19.9679 5.16025 19.9038 5.09625C19.8398 5.03208 19.7693 5 19.6923 5H4.30775C4.23075 5 4.16025 5.03208 4.09625 5.09625C4.03208 5.16025 4 5.23075 4 5.30775V18.6923C4 18.7692 4.03208 18.8398 4.09625 18.9038C4.16025 18.9679 4.23075 19 4.30775 19ZM5.25 16.75H9.75V15.25H5.25V16.75ZM14.55 14.6442L19.1443 10.05L18.075 8.98075L14.55 12.5308L13.125 11.1057L12.0808 12.175L14.55 14.6442ZM5.25 12.75H9.75V11.25H5.25V12.75ZM5.25 8.75H9.75V7.25H5.25V8.75Z",fill:"white"})})},"State ID":{color:"#00B499",icon:v.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M12 17.6923C11.0153 17.6923 10.066 17.8509 9.152 18.1683C8.23783 18.4856 7.39225 18.9679 6.61525 19.6152C6.62808 19.7064 6.66342 19.7882 6.72125 19.8605C6.77892 19.933 6.843 19.9795 6.9135 20H17.077C17.1475 19.9795 17.2116 19.933 17.2693 19.8605C17.3269 19.7882 17.3622 19.7064 17.375 19.6152C16.6108 18.9679 15.7718 18.4856 14.8577 18.1683C13.9436 17.8509 12.991 17.6923 12 17.6923ZM12 16.1923C13.15 16.1923 14.225 16.3673 15.225 16.7172C16.225 17.0673 17.15 17.5589 18 18.1923V4.30775C18 4.23075 17.9679 4.16025 17.9038 4.09625C17.8398 4.03208 17.7692 4 17.6923 4H6.30775C6.23075 4 6.16025 4.03208 6.09625 4.09625C6.03208 4.16025 6 4.23075 6 4.30775V18.1923C6.85 17.5589 7.775 17.0673 8.775 16.7172C9.775 16.3673 10.85 16.1923 12 16.1923ZM12 12.5385C11.5192 12.5385 11.1073 12.367 10.7645 12.024C10.4215 11.6812 10.25 11.2693 10.25 10.7885C10.25 10.3077 10.4215 9.89583 10.7645 9.553C11.1073 9.21 11.5192 9.0385 12 9.0385C12.4808 9.0385 12.8927 9.21 13.2355 9.553C13.5785 9.89583 13.75 10.3077 13.75 10.7885C13.75 11.2693 13.5785 11.6812 13.2355 12.024C12.8927 12.367 12.4808 12.5385 12 12.5385ZM6.30775 21.5C5.80258 21.5 5.375 21.325 5.025 20.975C4.675 20.625 4.5 20.1974 4.5 19.6923V4.30775C4.5 3.80258 4.675 3.375 5.025 3.025C5.375 2.675 5.80258 2.5 6.30775 2.5H17.6923C18.1974 2.5 18.625 2.675 18.975 3.025C19.325 3.375 19.5 3.80258 19.5 4.30775V19.6923C19.5 20.1974 19.325 20.625 18.975 20.975C18.625 21.325 18.1974 21.5 17.6923 21.5H6.30775ZM12 14.0385C12.9025 14.0385 13.6698 13.7225 14.302 13.0905C14.934 12.4583 15.25 11.691 15.25 10.7885C15.25 9.886 14.934 9.11867 14.302 8.4865C13.6698 7.8545 12.9025 7.5385 12 7.5385C11.0975 7.5385 10.3302 7.8545 9.698 8.4865C9.066 9.11867 8.75 9.886 8.75 10.7885C8.75 11.691 9.066 12.4583 9.698 13.0905C10.3302 13.7225 11.0975 14.0385 12 14.0385Z",fill:"white"})})},"Social Security Card":{color:"#9C2BAD",icon:v.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M14.077 12.7308H18.6152V11.2308H14.077V12.7308ZM14.077 9.84625H18.6152V8.34625H14.077V9.84625ZM5.38475 15.6538H12.6923V15.2963C12.6923 14.6296 12.3624 14.1058 11.7028 13.725C11.0433 13.3442 10.1552 13.1538 9.0385 13.1538C7.92183 13.1538 7.03367 13.3442 6.374 13.725C5.7145 14.1058 5.38475 14.6296 5.38475 15.2963V15.6538ZM9.0385 11.8463C9.52433 11.8463 9.93742 11.676 10.2777 11.3355C10.6182 10.9952 10.7885 10.5821 10.7885 10.0962C10.7885 9.61025 10.6182 9.19708 10.2777 8.85675C9.93742 8.51642 9.52433 8.34625 9.0385 8.34625C8.55267 8.34625 8.1395 8.51642 7.799 8.85675C7.45867 9.19708 7.2885 9.61025 7.2885 10.0962C7.2885 10.5821 7.45867 10.9952 7.799 11.3355C8.1395 11.676 8.55267 11.8463 9.0385 11.8463ZM4.30775 19.5C3.80258 19.5 3.375 19.325 3.025 18.975C2.675 18.625 2.5 18.1974 2.5 17.6923V6.30775C2.5 5.80258 2.675 5.375 3.025 5.025C3.375 4.675 3.80258 4.5 4.30775 4.5H19.6923C20.1974 4.5 20.625 4.675 20.975 5.025C21.325 5.375 21.5 5.80258 21.5 6.30775V17.6923C21.5 18.1974 21.325 18.625 20.975 18.975C20.625 19.325 20.1974 19.5 19.6923 19.5H4.30775ZM4.30775 18H19.6923C19.7693 18 19.8398 17.9679 19.9038 17.9038C19.9679 17.8398 20 17.7692 20 17.6923V6.30775C20 6.23075 19.9679 6.16025 19.9038 6.09625C19.8398 6.03208 19.7693 6 19.6923 6H4.30775C4.23075 6 4.16025 6.03208 4.09625 6.09625C4.03208 6.16025 4 6.23075 4 6.30775V17.6923C4 17.7692 4.03208 17.8398 4.09625 17.9038C4.16025 17.9679 4.23075 18 4.30775 18Z",fill:"white"})})}})[ye]||{color:"#5A43D6",icon:v.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M14.077 12.7308H18.6152V11.2308H14.077V12.7308ZM14.077 9.84625H18.6152V8.34625H14.077V9.84625ZM5.38475 15.6538H12.6923V15.2963C12.6923 14.6296 12.3624 14.1058 11.7028 13.725C11.0433 13.3442 10.1552 13.1538 9.0385 13.1538C7.92183 13.1538 7.03367 13.3442 6.374 13.725C5.7145 14.1058 5.38475 14.6296 5.38475 15.2963V15.6538ZM9.0385 11.8463C9.52433 11.8463 9.93742 11.676 10.2777 11.3355C10.6182 10.9952 10.7885 10.5821 10.7885 10.0962C10.7885 9.61025 10.6182 9.19708 10.2777 8.85675C9.93742 8.51642 9.52433 8.34625 9.0385 8.34625C8.55267 8.34625 8.1395 8.51642 7.799 8.85675C7.45867 9.19708 7.2885 9.61025 7.2885 10.0962C7.2885 10.5821 7.45867 10.9952 7.799 11.3355C8.1395 11.676 8.55267 11.8463 9.0385 11.8463ZM4.30775 19.5C3.80258 19.5 3.375 19.325 3.025 18.975C2.675 18.625 2.5 18.1974 2.5 17.6923V6.30775C2.5 5.80258 2.675 5.375 3.025 5.025C3.375 4.675 3.80258 4.5 4.30775 4.5H19.6923C20.1974 4.5 20.625 4.675 20.975 5.025C21.325 5.375 21.5 5.80258 21.5 6.30775V17.6923C21.5 18.1974 21.325 18.625 20.975 18.975C20.625 19.325 20.1974 19.5 19.6923 19.5H4.30775ZM4.30775 18H19.6923C19.7693 18 19.8398 17.9679 19.9038 17.9038C19.9679 17.8398 20 17.7692 20 17.6923V6.30775C20 6.23075 19.9679 6.16025 19.9038 6.09625C19.8398 6.03208 19.7693 6 19.6923 6H4.30775C4.23075 6 4.16025 6.03208 4.09625 6.09625C4.03208 6.16025 4 6.23075 4 6.30775V17.6923C4 17.7692 4.03208 17.8398 4.09625 17.9038C4.16025 17.9679 4.23075 18 4.30775 18Z",fill:"white"})})};return v.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch w-full",children:[v.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[v.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Country"})}),v.jsx("div",{className:"flex w-full items-start gap-6",children:v.jsx("div",{className:"flex-1",children:v.jsxs("select",{value:W,onChange:ye=>ne(ye.target.value),className:"w-full h-[38px] px-3 py-[8px] rounded border border-[#C3C6D4] bg-white text-[#172B4D] font-roboto text-[13px]",children:[v.jsx("option",{value:"",children:"Select"}),en.map(ye=>v.jsx("option",{value:ye.countryName,children:ye.countryName},ye.countryName))]})})})]}),W&&Ht.length>0&&v.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch",children:[v.jsxs("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[v.jsx("div",{className:"flex items-center gap-2 self-stretch",children:v.jsx("div",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Select the ID Type"})}),v.jsx("div",{className:"self-stretch text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Select the ID you'd like to use for verification."})]}),v.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch",children:[v.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 w-full",children:Ht.map((ye,Fe)=>{const Oe=ye.toLowerCase().replace(/\s+/g,"_"),xt=B===Oe,at=q.includes(Oe),Lt=Yt(ye);return v.jsx("div",{className:"flex flex-col",children:v.jsxs("button",{onClick:()=>{B===Oe?(ge(""),g(!1),y(!1)):ge(Oe)},className:`relative flex p-3 flex-col items-start gap-2 rounded border transition-all w-full ${at?"border-[#00B499] bg-[#EBFFF5]":xt?"border-[#0073EA] bg-[#F0F8FF]":"border-[#C3C6D4] bg-white hover:border-[#0073EA]/50"}`,children:[v.jsx("div",{className:"flex w-6 h-6 p-1 justify-center items-center gap-1 aspect-square rounded",style:{backgroundColor:Lt.color},children:v.jsx("div",{className:"scale-75",children:Lt.icon})}),v.jsx("div",{className:"text-[#172B4D] font-roboto text-[12px] font-medium leading-[16px] text-left",children:ye}),at&&v.jsx("div",{className:"absolute top-1 right-1 flex items-center gap-1 bg-white rounded-full p-0.5 border border-[#E6F1FD]",children:v.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M6.21967 9.86236L7.71968 11.3624C8.01255 11.6552 8.48745 11.6552 8.78032 11.3624L12.1553 7.98736C12.4482 7.69447 12.4482 7.2196 12.1553 6.9267C11.8624 6.63381 11.3876 6.63381 11.0947 6.9267L8.25 9.77138L7.28033 8.80171C6.98744 8.50883 6.51256 8.50883 6.21967 8.80171C5.92678 9.09458 5.92678 9.56948 6.21967 9.86236Z",fill:"#039855"})})})]})},Oe)})}),B&&v.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch mt-2 pl-4 border-l-2 border-[#0073EA]/20",children:[v.jsx("div",{className:"flex flex-col items-start gap-1 self-stretch",children:v.jsx("div",{className:"flex items-center gap-2 self-stretch",children:v.jsx("div",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Choose a method to upload your document"})})}),v.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 w-full",children:[v.jsx("div",{className:"flex flex-col gap-4",children:e.allowCaptureWebcam||e.allowUploadFromDevice?v.jsxs("div",{className:`grid gap-4 w-full ${e.allowCaptureWebcam&&e.allowUploadFromDevice?"grid-cols-1 sm:grid-cols-2":"grid-cols-1"}`,children:[e.allowCaptureWebcam&&v.jsx("button",{onClick:()=>g(!0),className:"flex flex-col justify-center items-center border-2 border-dashed border-[#C3C6D4] rounded-lg h-[120px] bg-white hover:bg-gray-50 transition-colors",children:v.jsxs("div",{className:"flex flex-col justify-center items-center gap-2",children:[v.jsx("div",{className:"flex w-[40px] h-[40px] p-2 justify-center items-center rounded-full bg-[#F6F7FB]",children:v.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M1.99805 8.87722C1.99805 8.5269 1.99805 8.35174 2.01267 8.20421C2.15365 6.78127 3.27932 5.6556 4.70226 5.51462C4.84979 5.5 5.03441 5.5 5.40363 5.5C5.5459 5.5 5.61704 5.5 5.67744 5.49634C6.44866 5.44963 7.124 4.96288 7.41219 4.246C7.43476 4.18986 7.45586 4.12657 7.49805 4C7.54024 3.87343 7.56134 3.81014 7.58391 3.754C7.8721 3.03712 8.54744 2.55037 9.31866 2.50366C9.37906 2.5 9.44577 2.5 9.57919 2.5H14.4169C14.5503 2.5 14.617 2.5 14.6774 2.50366C15.4486 2.55037 16.124 3.03712 16.4121 3.754C16.4347 3.81014 16.4558 3.87343 16.498 4C16.5402 4.12657 16.5613 4.18986 16.5839 4.246C16.872 4.96288 17.5474 5.44963 18.3186 5.49634C18.379 5.5 18.4501 5.5 18.5924 5.5C18.9616 5.5 19.1463 5.5 19.2938 5.51462C20.7167 5.6556 21.8424 6.78127 21.9834 8.20421C21.998 8.35174 21.998 8.5269 21.998 8.87722V16.7C21.998 18.3802 21.998 19.2202 21.671 19.862C21.3834 20.4265 20.9245 20.8854 20.36 21.173C19.7182 21.5 18.8782 21.5 17.198 21.5H6.79805C5.11789 21.5 4.27781 21.5 3.63608 21.173C3.07159 20.8854 2.61265 20.4265 2.32503 19.862C1.99805 19.2202 1.99805 18.3802 1.99805 16.7V8.87722Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M11.998 17C14.2071 17 15.998 15.2091 15.998 13C15.998 10.7909 14.2071 9 11.998 9C9.78891 9 7.99805 10.7909 7.99805 13C7.99805 15.2091 9.78891 17 11.998 17Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"})]})}),v.jsx("div",{className:"text-[#323238] text-center font-figtree text-[12px] font-medium",children:"Camera"}),v.jsx("div",{className:"text-[#676879] text-center font-roboto text-[11px] font-normal leading-4",children:"Take a photo using camera"})]})}),e.allowUploadFromDevice&&v.jsx("button",{onClick:()=>y(!0),className:"flex flex-col justify-center items-center border-2 border-dashed border-[#C3C6D4] rounded-lg h-[120px] bg-white hover:bg-gray-50 transition-colors",children:v.jsxs("div",{className:"flex flex-col justify-center items-center gap-2",children:[v.jsx("div",{className:"flex w-[40px] h-[40px] p-2 justify-center items-center rounded-full bg-[#F6F7FB]",children:v.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.76471 12.0294C6.88944 12.0294 6.4518 12.0294 6.09274 12.1256C5.11837 12.3867 4.35729 13.1478 4.09621 14.1221C4 14.4812 4 14.9188 4 15.7941V16.9235C4 18.5049 4 19.2955 4.30775 19.8995C4.57845 20.4308 5.01039 20.8627 5.54168 21.1334C6.14566 21.4412 6.93632 21.4412 8.51765 21.4412H16.4235C18.0049 21.4412 18.7955 21.4412 19.3995 21.1334C19.9308 20.8627 20.3627 20.4308 20.6334 19.8995C20.9412 19.2955 20.9412 18.5049 20.9412 16.9235V15.7941C20.9412 14.9188 20.9412 14.4812 20.845 14.1221C20.5839 13.1478 19.8228 12.3867 18.8485 12.1256C18.4894 12.0294 18.0518 12.0294 17.1765 12.0294M16.2353 8.26471L12.4706 4.5M12.4706 4.5L8.70588 8.26471M12.4706 4.5V15.7941",stroke:"#676879",strokeWidth:"1.41176",strokeLinecap:"round",strokeLinejoin:"round"})})}),v.jsx("div",{className:"text-[#323238] text-center font-figtree text-[12px] font-medium",children:"Upload Files"}),v.jsx("div",{className:"text-[#676879] text-center font-roboto text-[11px] font-normal leading-4",children:"Upload from device"})]})})]}):v.jsx("div",{className:"flex flex-col items-center justify-center h-[120px] border-2 border-dashed border-[#C3C6D4] rounded-lg bg-gray-50",children:v.jsxs("div",{className:"text-[#676879] font-roboto text-[12px] font-normal text-center",children:["No upload methods available.",v.jsx("br",{}),"Please contact support."]})})}),v.jsx("div",{className:"flex flex-col gap-4",children:v.jsx("button",{onClick:O,disabled:T,className:"flex flex-col justify-center items-center border-2 border-dashed border-[#6366F1] rounded-lg h-[120px] bg-gradient-to-br from-[#6366F1]/5 to-[#8B5CF6]/5 hover:from-[#6366F1]/10 hover:to-[#8B5CF6]/10 transition-all cursor-pointer disabled:opacity-60",children:v.jsxs("div",{className:"flex flex-col justify-center items-center gap-3",children:[v.jsx("div",{className:"flex w-[48px] h-[48px] p-2 justify-center items-center rounded-xl bg-gradient-to-br from-[#6366F1] to-[#8B5CF6]",children:v.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M6 10V8C6 6.93913 6.42143 5.92172 7.17157 5.17157C7.92172 4.42143 8.93913 4 10 4H14C15.0609 4 16.0783 4.42143 16.8284 5.17157C17.5786 5.92172 18 6.93913 18 8V10M5 10H19C19.5523 10 20 10.4477 20 11V19C20 19.5523 19.5523 20 19 20H5C4.44772 20 4 19.5523 4 19V11C4 10.4477 4.44772 10 5 10Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("circle",{cx:"12",cy:"15",r:"1.5",fill:"white"})]})}),v.jsxs("div",{className:"flex flex-col items-center gap-1",children:[v.jsx("div",{className:"text-[#6366F1] text-center font-figtree text-[14px] font-semibold",children:T?"Opening DigiLocker":"DigiLocker"}),v.jsx("div",{className:"text-[#676879] text-center font-roboto text-[11px] font-normal leading-4",children:"Your documents anytime, anywhere"})]})]})})})]}),v.jsxs("div",{className:"flex flex-col items-center gap-4 self-stretch border-2 border-dashed border-[#C3C6D4] rounded-lg bg-white p-6",children:[v.jsx("div",{className:"flex flex-col items-center gap-3",children:v.jsxs("div",{className:"flex flex-col items-center gap-2",children:[v.jsx("div",{className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>C(!0),title:"Click to view larger QR code",children:v.jsx(HN,{shortCode:r,templateVersionId:o,userId:s,sessionId:Ye?.sessionId||"default-session",currentStep:"document-upload",size:"large",showUrl:!1})}),v.jsx("div",{className:"text-[#676879] text-center font-roboto text-[12px] font-normal leading-4 max-w-[200px]",children:"Scan this QR code with your other device to continue verification."})]})}),v.jsx("div",{className:"w-full flex justify-end items-center",children:v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx("svg",{width:"16",height:"16",viewBox:"0 0 20 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M10.0003 13.8332V10.4998M10.0003 7.1665H10.0087M18.3337 10.4998C18.3337 15.1022 14.6027 18.8332 10.0003 18.8332C5.39795 18.8332 1.66699 15.1022 1.66699 10.4998C1.66699 5.89746 5.39795 2.1665 10.0003 2.1665C14.6027 2.1665 18.3337 5.89746 18.3337 10.4998Z",stroke:"#0073EA",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("div",{className:"text-[#0073EA] font-roboto text-[10px] font-normal",children:"How does this work?"})]})})]})]})]})]}),(console.log(" Checking Documents Uploaded section visibility:",{uploadedFilesLength:Q.length,uploadedDocumentsLength:q.length,uploadedFiles:Q,uploadedDocuments:q}),Q.length>0||q.length>0)&&v.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch",children:[v.jsxs("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[v.jsx("div",{className:"flex items-center gap-2 self-stretch",children:v.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-[26px]",children:"Documents Uploaded"})}),v.jsx("div",{className:"self-stretch text-text-secondary font-roboto text-[13px] font-normal leading-5",children:"Click on any document to download it."})]}),v.jsx("div",{className:"flex flex-wrap items-start gap-4 self-stretch",children:q.map(ye=>{const Fe=Ht.find(at=>at.toLowerCase().replace(/\s+/g,"_")===ye)||ye.replace(/_/g," "),Oe=Z[ye],xt=Oe&&(Oe.front||Oe.back);return v.jsxs("div",{className:"relative flex w-[180px] h-[180px] p-4 flex-col justify-between items-center gap-3 rounded-lg border-2 border-green-300 bg-green-50 cursor-pointer transition-all duration-200 hover:bg-green-100 hover:border-green-400 hover:shadow-md",onClick:()=>{console.log(" Download clicked for document:",ye,"File IDs:",Oe),xt?$t(ye):alert(`No files available for ${Fe}`)},children:[v.jsx("button",{onClick:at=>{at.stopPropagation(),L(ye),M(!0)},className:"absolute top-2 right-2 flex w-7 h-7 justify-center items-center rounded-full bg-red-500 hover:bg-red-600 transition-colors shadow-md z-10","aria-label":"Delete document",children:v.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M10.5 3.5L3.5 10.5M3.5 3.5L10.5 10.5",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),v.jsx("div",{className:"flex w-16 h-16 justify-center items-center rounded-full bg-green-500",children:v.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M14 2V8H20",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M12 18V12",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M9 15L12 12L15 15",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),v.jsxs("div",{className:"flex flex-col items-center gap-1 self-stretch",children:[v.jsx("div",{className:"text-center font-figtree text-sm font-semibold leading-tight text-green-800 line-clamp-2",children:Fe}),v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx("svg",{width:"12",height:"12",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M13.5 4.5L6 12L2.5 8.5",stroke:"#22c55e",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-xs font-medium text-green-600",children:"Uploaded"})]})]})]},ye)})})]}),v.jsx(uq,{isOpen:p,onClose:()=>g(!1),previousFileIds:B?Z[B]:void 0,onUploaded:(ye,Fe)=>{B&&Re(Oe=>({...Oe,[B]:{...Oe[B]||{},[ye]:Fe}}))},submissionId:t,country:W,selectedDocumentName:Ht.find(ye=>ye.toLowerCase().replace(/\s+/g,"_")===B)||"",documentConfig:e,onSubmit:(ye,Fe)=>{if(g(!1),B){const Oe=B;ye&&localStorage.setItem(`document_${Oe}_image`,ye),he(Rt=>{const On=Rt.includes(Oe)?Rt:[...Rt,Oe];return console.log(" Updated uploadedDocuments (Camera):",On),On});const xt={id:`${Oe}-${Date.now()}`,name:`${Oe.replace(/_/g," ")}.jpg`,size:"2.5MB",type:"image"};Se(Rt=>{const ir=[...Rt.filter(En=>En.id.replace(/-\d+$/,"")!==Oe),xt];return console.log(" Updated uploadedFiles (Camera):",ir),ir});const at=tn();if(at&&Fe?.front){const Rt=Ht.find(On=>On.toLowerCase().replace(/\s+/g,"_")===Oe)||Oe.replace(/_/g," ");We(Rt,at,Fe.front,Fe.back),console.log(" Added document detail (Camera):",{documentName:Rt,documentDefinitionId:at,frontFileId:Fe.front,backFileId:Fe.back})}ge(""),Ht.map(Rt=>Rt.toLowerCase().replace(/\s+/g,"_")).every(Rt=>Rt===Oe||q.includes(Rt))&&n?.()}}}),v.jsx(dq,{isOpen:x,onClose:()=>y(!1),onSubmit:async(ye,Fe)=>{if(!B)return;const Oe=B;try{const xt=Z[Oe],[at,Lt]=await Promise.all([ct(ye,`${Oe}-front.${ye.type.includes("pdf")?"pdf":"jpg"}`,xt?.front),ct(Fe,`${Oe}-back.${Fe.type.includes("pdf")?"pdf":"jpg"}`,xt?.back)]);Re(En=>({...En,[Oe]:{front:at,back:Lt}})),he(En=>{const xo=En.includes(Oe)?En:[...En,Oe];return console.log(" Updated uploadedDocuments:",xo),xo});const St={id:`${Oe}-${Date.now()}`,name:`${Oe.replace(/_/g," ")}.pdf`,size:"3MB",type:"document"};Se(En=>{const Er=[...En.filter(gs=>gs.id.replace(/-\d+$/,"")!==Oe),St];return console.log(" Updated uploadedFiles:",Er),Er});const Rt=tn();if(Rt&&at){const En=Ht.find(xo=>xo.toLowerCase().replace(/\s+/g,"_")===Oe)||Oe.replace(/_/g," ");We(En,Rt,at,Lt),console.log(" Added document detail (Upload Dialog):",{documentName:En,documentDefinitionId:Rt,frontFileId:at,backFileId:Lt})}ge(""),Ht.map(En=>En.toLowerCase().replace(/\s+/g,"_")).every(En=>En===Oe||q.includes(En))&&n?.()}finally{y(!1)}}}),b&&v.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onClick:ye=>{ye.target===ye.currentTarget&&C(!1)},children:v.jsxs("div",{className:"flex flex-col items-center gap-6 p-10 rounded-xl bg-black/40 backdrop-blur-sm",children:[v.jsx("div",{className:"scale-[2.5] transform p-4 bg-white rounded-lg shadow-2xl",children:v.jsx(HN,{shortCode:r,templateVersionId:o,userId:s,sessionId:Ye?.sessionId||"default-session",currentStep:"document-upload",size:"large",showUrl:!1})}),v.jsx("p",{className:"text-center text-base font-medium text-white/90 mt-4",children:"Scan this QR code with your mobile device"})]})}),A&&j&&v.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:v.jsxs("div",{className:"flex w-[440px] max-w-[90vw] flex-col items-start rounded-lg bg-white shadow-xl",children:[v.jsxs("div",{className:"flex h-[58px] justify-between items-center self-stretch border-b border-[#D0D4E4] px-6",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsx("div",{className:"flex w-10 h-10 justify-center items-center rounded-full bg-red-100",children:v.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M8.33333 5V4.33333C8.33333 3.39991 8.33333 2.9332 8.51499 2.57668C8.67384 2.26308 8.92977 2.00715 9.24337 1.8483C9.59989 1.66663 10.0666 1.66663 11 1.66663H12.3333C13.2668 1.66663 13.7335 1.66663 14.09 1.8483C14.4036 2.00715 14.6595 2.26308 14.8184 2.57668C15 2.9332 15 3.39991 15 4.33333V5M16.6667 5L16.1991 13.0654C16.1296 14.3267 16.0949 14.9574 15.8203 15.4369C15.5802 15.8566 15.2188 16.1935 14.7822 16.4008C14.2875 16.6333 13.6561 16.6333 12.3933 16.6333H10.9401C9.67725 16.6333 9.04583 16.6333 8.55111 16.4008C8.11457 16.1935 7.75315 15.8566 7.51301 15.4369C7.23842 14.9574 7.20375 14.3267 7.13441 13.0654L6.66667 5M2.5 5H17.5M10.8333 9.16663V12.5M12.5 9.16663V12.5",stroke:"#DC2626",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),v.jsx("div",{className:"text-[#172B4D] font-figtree text-xl font-bold leading-[30px]",children:"Delete Document"})]}),v.jsx("button",{onClick:()=>{M(!1),L(null)},disabled:U,className:"flex w-8 h-8 justify-center items-center gap-2.5 rounded-full bg-white hover:bg-gray-50 disabled:opacity-50",children:v.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),v.jsxs("div",{className:"flex p-6 flex-col items-start gap-4 self-stretch",children:[v.jsxs("div",{className:"text-[#172B4D] font-roboto text-base leading-6",children:["Are you sure you want to delete"," ",v.jsx("span",{className:"font-semibold",children:Ht.find(ye=>ye.toLowerCase().replace(/\s+/g,"_")===j)||j.replace(/_/g," ")}),"?"]}),v.jsx("div",{className:"text-[#676879] font-roboto text-sm leading-5",children:"This will permanently delete both the front and back images of this document from the server. This action cannot be undone."})]}),v.jsxs("div",{className:"flex h-[68px] justify-end items-center gap-3 self-stretch border-t border-[#D0D4E4] bg-white px-6",children:[v.jsx("button",{onClick:()=>{M(!1),L(null)},disabled:U,className:"flex h-[38px] px-4 py-[11px] justify-center items-center gap-2 rounded border border-[#C3C6D4] bg-white hover:bg-gray-50 disabled:opacity-50",children:v.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium",children:"Cancel"})}),v.jsx("button",{onClick:()=>qt(j),disabled:U,className:"flex h-[38px] px-4 py-[11px] justify-center items-center gap-2 rounded bg-red-600 hover:bg-red-700 disabled:bg-red-400",children:U?v.jsxs(v.Fragment,{children:[v.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[v.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),v.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Deleting..."})]}):v.jsxs(v.Fragment,{children:[v.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 4.5V3.9C7.5 3.05992 7.5 2.63988 7.66349 2.31901C7.80615 2.03677 8.03677 1.80615 8.31901 1.66349C8.63988 1.5 9.05992 1.5 9.9 1.5H11.1C11.9401 1.5 12.3601 1.5 12.681 1.66349C12.9632 1.80615 13.1938 2.03677 13.3365 2.31901C13.5 2.63988 13.5 3.05992 13.5 3.9V4.5M15 4.5L14.5792 11.7588C14.5189 12.8803 14.4887 13.441 14.2382 13.8732C14.0172 14.2509 13.6869 14.5542 13.2903 14.7407C12.8387 15 12.2772 15 11.1543 15H9.84573C8.72282 15 8.16136 15 7.70971 14.7407C7.31312 14.5542 6.98282 14.2509 6.76181 13.8732C6.51134 13.441 6.48113 12.8803 6.42071 11.7588L6 4.5M2.25 4.5H15.75M9.75 8.25V11.25M11.25 8.25V11.25",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Delete Document"})]})})]})]})})]})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var aD=function(n,e){return(aD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(n,e)};function xa(n,e){function t(){this.constructor=n}aD(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function pt(n,e,t,r){return new(t||(t=Promise))((function(o,s){function i(c){try{l(r.next(c))}catch(u){s(u)}}function a(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){c.done?o(c.value):new t((function(u){u(c.value)})).then(i,a)}l((r=r.apply(n,[])).next())}))}function mt(n,e){var t,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(c){return(function(u){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){i=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(u[0]===6&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(n,i)}catch(d){u=[6,d],r=0}finally{t=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}})([l,c])}}}var Bq=(function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var o=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+o+"."),this.set(e,o)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,o=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(s){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];return jq(r,i[0],i[1]),i.join("=")})),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach((function(s){var i=s.split(":"),a=i[0],l=i[1];e.urlFlags[a]=(function(c,u){if((u=u.toLowerCase())==="true"||u==="false")return u==="true";if(""+ +u===u)return+u;throw new Error("Could not parse value flag value "+u+" for flag "+c+".")})(a,l)}))}},n})();function jq(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Ae(){return lD}var lD=null,vx=new Map,J3=new Map;function cD(n,e){var t=dD(n,e);return vx.get(t)}function Vq(n){return J3.get(n)}function GN(n){for(var e=vx.entries(),t=[];;){var r=e.next(),o=r.done,s=r.value;if(o)break;var i=s[0],a=s[1];i.split("_")[0]===n&&t.push(a)}return t}function uD(n){var e=n.kernelName,t=n.backendName,r=dD(e,t);if(vx.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");vx.set(r,n)}function zq(n){var e=n.kernelName;J3.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),J3.set(e,n)}function dD(n,e){return e+"_"+n}function eC(n,e,t){return Math.max(n,Math.min(e,t))}function hD(n){return n%2==0?n:n+1}function Wq(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function Y(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function An(n,e,t){t===void 0&&(t=""),Y(uo(n,e),(function(){return t+" Shapes "+n+" and "+e+" must match"}))}function Df(n){Y(n!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function cf(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||Ja(n)&&!t)for(var r=0;r<n.length;++r)cf(n[r],e,t);else e.push(n);return e}function yt(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function uo(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Nr(n){return n%1==0}function Uq(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function tC(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function qh(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function qN(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise((function(r,o){var s=0,i=function(){if(n())r();else{s++;var a=e(s);t!=null&&s>=t?o():setTimeout(i,a)}};i()}))}function Hq(n,e){for(var t=1,r=-1,o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(n[o]<0)throw Error("Shapes can not be < 0. Found "+n[o]+" at dim "+o);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var s=n.slice();return s[r]=e/t,s}function eo(n,e){var t=e.length;return Y((n=n==null?e.map((function(r,o){return o})):[].concat(n)).every((function(r){return r>=-t&&r<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n})),Y(n.every((function(r){return Nr(r)})),(function(){return"All values in axis param must be integers but got axis "+n})),n.map((function(r){return r<0?t+r:r}))}function Qu(n,e){for(var t=[],r=[],o=e!=null&&Array.isArray(e)&&e.length===0,s=e==null||o?null:eo(e,n).sort(),i=0,a=0;a<n.length;++a){if(s!=null){if(s[i]===a&&n[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(s[i]==null||s[i]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),s[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function sm(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function yx(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function Gq(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function qq(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Kq(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function Ja(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function fD(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function Xq(n){if(n==null)return 0;var e=0;return n.forEach((function(t){return e+=t.length})),e}function D4(n){return typeof n=="string"||n instanceof String}function Yq(n){return typeof n=="boolean"}function Zq(n){return typeof n=="number"}function Dm(n){return Array.isArray(n)?Dm(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":Zq(n)?"float32":D4(n)?"string":Yq(n)?"bool":"float32"}function nC(n){return!!(n&&n.constructor&&n.call&&n.apply)}function rC(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function el(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function pD(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=cf(n)),t&&Gq(n,e),(function(s,i){return s instanceof Float32Array&&i==="float32"||s instanceof Int32Array&&i==="int32"||s instanceof Uint8Array&&i==="bool"})(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),o=0;o<r.length;++o)Math.round(n[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function KN(n,e){if(n.length===0)return e[0];var t=n.reduce((function(r,o){return r*o}));if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return(function r(o,s,i){var a=new Array;if(s.length===1)for(var l=s[0],c=0;c<l;c++)a[c]=i[o+c];else{l=s[0];var u=s.slice(1),d=u.reduce((function(h,p){return h*p}));for(c=0;c<l;c++)a[c]=r(o+c*d,u,i)}return a})(0,n,e)}function mD(n,e){for(var t=Am(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Am(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function za(){return Ae().platform.now()}function gD(n){n.forEach((function(e){Y(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."}))}))}function Qq(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Ae().platform.encode(n,e)}function bx(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Ae().platform.decode(n,e)}function XN(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],o=0;o<n.length-1;++o)r+=t[o]*n[o];return r}function Jq(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),o=0;o<r.length-1;++o)r[o]=Math.floor(n/t[o]),n-=r[o]*t[o];return r[r.length-1]=n,r}var eK=(function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new tK)}return n.prototype.profileKernel=function(e,t,r){var o,s=this,i=this.backendTimer.time((function(){o=r()}));return o.forEach((function(a){a.data().then((function(l){(function(c,u,d){if(u!=="float32")return!1;for(var h=0;h<c.length;h++){var p=c[h];if(isNaN(p)||!isFinite(p))return console.warn("Found "+p+" in the result of '"+d+"'"),!0}})(l,a.dtype,e),i.then((function(c){var u="";c.getExtraProfileInfo!=null&&(u=c.getExtraProfileInfo()),s.logger.logKernelProfile(e,a,l,c.kernelMs,t,u)}))}))})),o},n})(),tK=(function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,o,s,i){var a=typeof o=="number"?qh(o+"ms",9):o.error,l=qh(e,25),c=t.rank,u=t.size,d=qh(t.shape.toString(),14),h="";for(var p in s){var g=s[p].shape||t.shape,x=g.length;h+=p+": "+x+"D "+(x>0?g:"")+" "}console.log("%c"+l+"	%c"+a+"	%c"+c+"D "+d+"	%c"+u+"	%c"+h+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n})(),YN=20,Tp=3,Bw=7;function nK(n,e,t,r){var o=el(e),s=(function(c,u,d,h){var p=yt(u),g=h[h.length-1],x=new Array(g).fill(0),y=u.length,b=d==="complex64"?Dp(c):c;if(y>1)for(var C=0;C<p/g;C++)for(var S=C*g,k=0;k<g;k++)x[k]=Math.max(x[k],Rp(b[S+k],0,d).length);return x})(n,e,t,o),i=e.length,a=(function c(u,d,h,p,g,x){x===void 0&&(x=!0);var y=h==="complex64"?2:1,b=d[0],C=d.length;if(C===0)return h==="complex64"?[Rp(Dp(u)[0],0,h)]:h==="bool"?[xD(u[0])]:[u[0].toString()];if(C===1){if(b>YN){var S=Tp*y,k=Array.from(u.slice(0,S)),N=Array.from(u.slice((b-Tp)*y,b*y));return h==="complex64"&&(k=Dp(k),N=Dp(N)),["["+k.map((function(U,G){return Rp(U,g[G],h)})).join(", ")+", ..., "+N.map((function(U,G){return Rp(U,g[b-Tp+G],h)})).join(", ")+"]"]}return["["+(h==="complex64"?Dp(u):Array.from(u)).map((function(U,G){return Rp(U,g[G],h)})).join(", ")+"]"]}var E=d.slice(1),_=p.slice(1),$=p[0]*y,T=[];if(b>YN){for(var D=0;D<Tp;D++){var A=(M=D*$)+$;T.push.apply(T,c(u.slice(M,A),E,h,_,g,!1))}for(T.push("..."),D=b-Tp;D<b;D++)A=(M=D*$)+$,T.push.apply(T,c(u.slice(M,A),E,h,_,g,D===b-1))}else for(D=0;D<b;D++){var M;A=(M=D*$)+$,T.push.apply(T,c(u.slice(M,A),E,h,_,g,D===b-1))}var j=C===2?",":"";for(T[0]="["+T[0]+j,D=1;D<T.length-1;D++)T[D]=" "+T[D]+j;var L=`,
`;for(D=2;D<C;D++)L+=`
`;return T[T.length-1]=" "+T[T.length-1]+"]"+(x?"":L),T})(n,e,t,o,s),l=["Tensor"];return r&&(l.push("  dtype: "+t),l.push("  rank: "+i),l.push("  shape: ["+e+"]"),l.push("  values:")),l.push(a.map((function(c){return"    "+c})).join(`
`)),l.join(`
`)}function Rp(n,e,t){return qh(Array.isArray(n)?parseFloat(n[0].toFixed(Bw))+" + "+parseFloat(n[1].toFixed(Bw))+"j":D4(n)?"'"+n+"'":t==="bool"?xD(n):parseFloat(n.toFixed(Bw)).toString(),e)}function xD(n){return n===0?"false":"true"}function Dp(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var im=(function(){function n(e,t,r){var o=this;if(this.dtype=t,this.shape=e.slice(),this.size=yt(e),r!=null){var s=r.length;Y(s===this.size,(function(){return"Length of values '"+s+"' does not match the size inferred by the shape '"+o.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||yx(t,this.size),this.strides=el(e)}return n.prototype.set=function(e){for(var t=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),Y(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var s=this.locToIndex(r);this.values[s]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,o=0,s=e;o<s.length;o++){var i=s[o];if(i<0||i>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var l=e[e.length-1],c=0;c<e.length-1;++c)l+=this.strides[c]*e[c];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return qa().makeTensor(this.values,this.shape,this.dtype)},n})(),qa=null,Ee=null,vD=null,ur=(function(){function n(e,t,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=yt(e),this.strides=el(e),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),Y(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,o){return this.throwIfDisposed(),this.reshape([e,t,r,o])},n.prototype.as5D=function(e,t,r,o,s){return this.throwIfDisposed(),this.reshape([e,t,r,o,s])},n.prototype.asType=function(e){return this.throwIfDisposed(),Ee.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return pt(this,void 0,void 0,(function(){var e;return mt(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Ee.buffer(this.shape,this.dtype,e)]}}))}))},n.prototype.bufferSync=function(){return Ee.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return pt(this,void 0,void 0,(function(){var e;return mt(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,KN(this.shape,e)]}}))}))},n.prototype.arraySync=function(){return KN(this.shape,this.dataSync())},n.prototype.data=function(){return pt(this,void 0,void 0,(function(){var e,t;return mt(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=qa().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map((function(o){return bx(o)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}}))}))},n.prototype.dataSync=function(){this.throwIfDisposed();var e=qa().readSync(this.dataId);if(this.dtype==="string")try{return e.map((function(t){return bx(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return pt(this,void 0,void 0,(function(){var e;return mt(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,qa().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},n.prototype.dispose=function(){this.isDisposed||(qa().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),Ee.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),Ee.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),Ee.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),Ee.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),Ee.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Ee.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),Ee.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),nK(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),Ee.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Ee.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Ee.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),Ee.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),Ee.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),Ee.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),Ee.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),Ee.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Ee.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),Ee.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),Ee.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),Ee.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,o,s){return r===void 0&&(r=.001),vD("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,s,o,r)},n.prototype.batchNorm=function(e,t,r,o,s){return s===void 0&&(s=.001),this.throwIfDisposed(),Ee.batchNorm(this,e,t,r,o,s)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ee.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ee.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ee.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ee.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ee.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ee.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ee.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ee.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Ee.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Ee.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Ee.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),Ee.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),Ee.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),Ee.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),Ee.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),Ee.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),Ee.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),Ee.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),Ee.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),Ee.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),Ee.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),Ee.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),Ee.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),Ee.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),Ee.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Ee.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),Ee.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Ee.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),Ee.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),Ee.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Ee.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),Ee.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),Ee.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Ee.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),Ee.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),Ee.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),Ee.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),Ee.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),Ee.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Ee.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),Ee.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Ee.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Ee.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Ee.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Ee.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),Ee.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Ee.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),Ee.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),Ee.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),Ee.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Ee.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Ee.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Ee.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Ee.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Ee.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Ee.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Ee.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Ee.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Ee.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Ee.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Ee.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Ee.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Ee.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Ee.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Ee.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ee.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),Ee.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),Ee.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Ee.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Ee.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),Ee.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),Ee.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Ee.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ee.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Ee.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Ee.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Ee.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Ee.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Ee.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Ee.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Ee.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Ee.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Ee.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Ee.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Ee.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Ee.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Ee.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Ee.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Ee.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Ee.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Ee.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),Ee.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Ee.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Ee.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Ee.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Ee.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,o,s,i){return o===void 0&&(o="NWC"),s===void 0&&(s=1),this.throwIfDisposed(),Ee.conv1d(this,e,t,r,o,s,i)},n.prototype.conv2d=function(e,t,r,o,s,i){return o===void 0&&(o="NHWC"),s===void 0&&(s=[1,1]),this.throwIfDisposed(),Ee.conv2d(this,e,t,r,o,s,i)},n.prototype.conv2dTranspose=function(e,t,r,o,s){return this.throwIfDisposed(),Ee.conv2dTranspose(this,e,t,r,o,s)},n.prototype.depthwiseConv2D=function(e,t,r,o,s,i){return o===void 0&&(o="NHWC"),s===void 0&&(s=[1,1]),this.throwIfDisposed(),Ee.depthwiseConv2d(this,e,t,r,o,s,i)},n.prototype.separableConv2d=function(e,t,r,o,s,i){return s===void 0&&(s=[1,1]),i===void 0&&(i="NHWC"),this.throwIfDisposed(),Ee.separableConv2d(this,e,t,r,o,s,i)},n.prototype.avgPool=function(e,t,r,o){return this.throwIfDisposed(),Ee.avgPool(this,e,t,r,o)},n.prototype.maxPool=function(e,t,r,o){return this.throwIfDisposed(),Ee.maxPool(this,e,t,r,o)},n.prototype.localResponseNormalization=function(e,t,r,o){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),o===void 0&&(o=.5),Ee.localResponseNormalization(this,e,t,r,o)},n.prototype.pool=function(e,t,r,o,s){return this.throwIfDisposed(),Ee.pool(this,e,t,r,o,s)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),qa().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Ee.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Ee.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Ee.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),Ee.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,o,s,i,a,l){return o===void 0&&(o=0),s===void 0&&(s=0),i===void 0&&(i=0),a===void 0&&(a=0),l===void 0&&(l=0),this.throwIfDisposed(),Ee.stridedSlice(this,e,t,r,o,s,i,a,l)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Ee.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),Ee.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Ee.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Ee.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Ee.spectral.irfft(this)},n})();Object.defineProperty(ur,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var ZN,oC,sC,iC,aC,uf=(function(n){function e(t,r,o,s){var i=n.call(this,t.shape,t.dtype,t.dataId,s)||this;return i.trainable=r,i.name=o,i}return xa(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!uo(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");qa().disposeTensor(this),this.dataId=t.dataId,qa().incRef(this,null)},e.prototype.dispose=function(){qa().disposeVariable(this),this.isDisposedInternal=!0},e})(ur);Object.defineProperty(uf,Symbol.hasInstance,{value:function(n){return n instanceof ur&&n.assign!=null&&n.assign instanceof Function}}),(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(ZN||(ZN={})),(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(oC||(oC={})),(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(sC||(sC={})),(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(iC||(iC={})),(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(aC||(aC={}));var rK={float32:iC,int32:oC,bool:sC,complex64:aC};function No(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return rK[n][e]}function jw(n){return No(n,"int32")}function hr(n,e){if(n.dtype===e.dtype)return[n,e];var t=No(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function oK(n,e){Y(n.dtype===e.dtype,(function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"}))}function yD(n){var e=[];return(function t(r,o,s){if(r!=null){if(r instanceof ur)return void o.push(r);if(i=r,!(!Array.isArray(i)&&typeof i!="object")){var i,a=r;for(var l in a){var c=a[l];s.has(c)||(s.add(c),t(c,o,s))}}}})(n,e,new Set),e}var Vw,QN=(function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n})(),sK=(function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new QN}return n.prototype.ready=function(){return pt(this,void 0,void 0,(function(){var e,t,r;return mt(this,(function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,o.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return pt(this,void 0,void 0,(function(){var t,r,o;return mt(this,(function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(!o)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new eK(this.backendInstance),[2,!0]}}))}))},n.prototype.setupRegisteredKernels=function(){var e=this;GN(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)}))},n.prototype.disposeRegisteredKernels=function(e){var t=this;GN(e).forEach((function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])}))},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var s=++this.pendingBackendInitId,i=o.then((function(a){return!(s<t.pendingBackendInitId)&&(t.registry[e]=a,t.pendingBackendInit=null,!0)})).catch((function(a){return!(s<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority}))},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],o=this.initializeBackend(r),s=o.success,i=o.asyncInit;if(i||s)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),o=r.backend,s=this.readSync(t);o.disposeData(t),r.backend=e,e.move(t,s,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,o=this,s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}return this.scopedRun((function(){return o.startScope(s)}),(function(){return o.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},n.prototype.scopedRun=function(e,t,r){e();try{var o=r();return t(),o}catch(s){throw t(),s}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],(function(o){return{x:function(){return o.toFloat()}}}),[]),t},n.prototype.runKernel=function(e,t,r,o,s){return this.runKernelFunc(null,t,null,e,r,o,s)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var o=this.backend.numDataIds(),s=0;r.forEach((function(l){s+=l.dtype==="complex64"?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=o-t-s-i;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,o,s,i,a){var l,c=this;i===void 0&&(i=[]),a===void 0&&(a=[]);var u=[],d=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var h,p=function(C){d&&(u=C.map((function(S){return c.keep(c.clone(S))})))},g=this.state.numBytes,x=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var y,b=cD(o,this.backendName);return h=b!=null?function(){var C=c.backend.numDataIds();y=b.kernelFunc({inputs:t,attrs:s,backend:c.backend});var S=Array.isArray(y)?y:[y];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,C,S);var k=S.map((function(E){var _=E.dataId,$=E.shape,T=E.dtype;return c.makeTensorFromDataId(_,$,T)})),N=k.filter((function(E,_){return a[_]}));return p((i||[]).slice().concat(N)),k}:function(){var C=c.backend.numDataIds();y=c.tidy((function(){return e(c.backend,p)}));var S=Array.isArray(y)?y:[y];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,C,S),S},this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){l=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,t,(function(){return h()})):h()})),d&&this.addTapeNode(o,t,l,r,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-g,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-x,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(C){return t[C].shape})),outputShapes:l.map((function(C){return C.shape}))}),Array.isArray(y)?l:l[0]},n.prototype.makeTensor=function(e,t,r,o){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var s=e;r==="string"&&D4(e[0])&&(s=e.map((function(u){return Qq(u)})));var i=o.write(s,t,r),a=new ur(t,r,i,this.nextTensorId());if(this.incRef(a,o),r==="string"){var l=this.state.tensorInfo.get(i),c=Xq(s);this.state.numBytes+=c-l.bytes,l.bytes=c}return a},n.prototype.makeTensorFromDataId=function(e,t,r,o){var s=new ur(t,r=r||"float32",e,this.nextTensorId());return this.incRef(s,o),s},n.prototype.makeVariable=function(e,t,r,o){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==e.dtype&&(e=e.asType(o));var s=new uf(e,t,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error("Variable with name "+s.name+" was already registered");return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*fD(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof uf||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return pt(this,void 0,void 0,(function(){var t,r;return mt(this,(function(o){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(s){return s.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,o,s){var i=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:s},l=Vq(e);l!=null&&(o=l.gradFunc),o!=null&&(a.gradient=function(c){return c=c.map((function(u,d){if(u==null){var h=r[d],p=Am(h.size,h.dtype);return i.makeTensor(p,h.shape,h.dtype)}return u})),o(c.length>1?c:c[0],s)}),this.state.activeTape.push(a)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=yD(e),o=new Set(r.map((function(l){return l.id}))),s=0;s<this.state.activeScope.track.length;s++){var i=this.state.activeScope.track[s];i.kept||o.has(i.id)||i.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(l){l.kept||l.scopeId!==a.id||t.track(l)}))},n.prototype.gradients=function(e,t,r,o){var s=this;if(o===void 0&&(o=!1),Y(t.length>0,(function(){return"gradients() received an empty list of xs."})),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var i=this.scopedRun((function(){return s.startTape()}),(function(){return s.endTape()}),(function(){return s.tidy("forward",e)}));Y(i instanceof ur,(function(){return"The result y returned by f() must be a tensor."}));var a=(function(l,c,u){for(var d={},h={},p=0;p<c.length;p++)d[c[p].id]=!0;for(p=0;p<l.length;p++){var g=(E=l[p]).inputs;for(var x in g){for(var y=g[x],b=!1,C=0;C<c.length;C++)if(d[y.id]){E.outputs.forEach((function(D){return d[D.id]=!0})),b=!0,h[E.id]=!0;break}if(b)break}}var S={};S[u.id]=!0;var k={};for(p=l.length-1;p>=0;p--)for(g=(E=l[p]).inputs,C=0;C<E.outputs.length;C++)if(S[E.outputs[C].id]){for(var x in g)S[g[x].id]=!0,k[E.id]=!0;break}var N=[];for(p=0;p<l.length;p++){var E;if(h[(E=l[p]).id]&&k[E.id]){var _={};for(var x in E.inputs){var $=E.inputs[x];d[$.id]&&(_[x]=$)}var T=Object.assign({},E);T.inputs=_,T.outputs=E.outputs,N.push(T)}}return N})(this.state.activeTape,t,i);if(!o&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var l,c,u={};u[i.id]=r??(l=i.shape,c=mD(yt(l),"float32"),ce.makeTensor(c,l,"float32")),(function(h,p,g){for(var x=function(b){var C=p[b],S=[];if(C.outputs.forEach((function(_){var $=h[_.id];$!=null?S.push($):S.push(null)})),C.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+C.kernelName+".");var k=C.gradient(S),N=function(_){if(!(_ in k))throw new Error("Cannot backprop through input "+_+". Available gradients found: "+Object.keys(k)+".");var $=g((function(){return k[_]()}));if($.dtype!=="float32")throw new Error("Error in gradient for op "+C.kernelName+". The gradient of input "+_+" must have 'float32' dtype, but has '"+$.dtype+"'");var T=C.inputs[_];if(!uo($.shape,T.shape))throw new Error("Error in gradient for op "+C.kernelName+". The gradient of input '"+_+"' has shape '"+$.shape+"', which does not match the shape of the input '"+T.shape+"'");if(h[T.id]==null)h[T.id]=$;else{var D=h[T.id];h[T.id]=D.add($),D.dispose()}};for(var E in C.inputs)N(E)},y=p.length-1;y>=0;y--)x(y)})(u,a,(function(h){return s.tidy(h)}));var d=t.map((function(h){return u[h.id]}));return s.state.gradientDepth===0&&(s.state.activeTape.forEach((function(h){for(var p=0,g=h.saved;p<g.length;p++)g[p].dispose()})),s.state.activeTape=null),{value:i,grads:d}}))},n.prototype.customGrad=function(e){var t=this;return Y(nC(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];Y(o.every((function(a){return a instanceof ur})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i={};return o.forEach((function(a,l){i[l]=a})),t.runKernelFunc((function(a,l){return Y((r=e.apply(void 0,o.concat([l]))).value instanceof ur,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),Y(nC(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),i,(function(a,l){var c=r.gradFunc(a,l),u=Array.isArray(c)?c:[c];Y(u.length===o.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),Y(u.every((function(h){return h instanceof ur})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var d={};return u.forEach((function(h,p){d[p]=function(){return h}})),d}))}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return pt(this,void 0,void 0,(function(){var t,r;return mt(this,(function(o){switch(o.label){case 0:return t=za(),[4,this.backend.time(e)];case 1:return(r=o.sent()).wallMs=za()-t,[2,r]}}))}))},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new QN,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n})(),ce=(function(){var n=(function(){if(Vw==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Vw=t}return Vw})();if(n._tfengine==null){var e=new Bq(n);n._tfengine=new sK(e)}return(function(t){lD=t})(n._tfengine.ENV),qa=function(){return n._tfengine},n._tfengine})();function bD(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ll=Ae();Ll.registerFlag("DEBUG",(function(){return!1}),(function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ll.registerFlag("IS_BROWSER",(function(){return bD()})),Ll.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),Ll.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ll.registerFlag("PROD",(function(){return!1})),Ll.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ll.getBool("DEBUG")})),Ll.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ll.registerFlag("IS_TEST",(function(){return!1}));var am,ei,Qs,Xu={},zw={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function iK(n,e){Xu[n]=e}function gl(n){n in Xu||(Xu[n]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",(function(o){o.preventDefault(),delete Xu[t]}),!1),t===1?r.getContext("webgl",zw)||r.getContext("experimental-webgl",zw):r.getContext("webgl2",zw)})(n));var e=Xu[n];return e.isContextLost()?(delete Xu[n],gl(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Xu[n])}function Fv(n,e){return[e,n]}function qp(n){var e=yt(n);return tC(Math.ceil(e/4))}function _m(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function A4(n,e){var t,r,o,s,i,a,l,c,u,d=n;return Ae().getNumber("WEBGL_VERSION")===2?(t=d.R32F,r=d.R16F,o=d.RGBA16F,s=d.RGBA32F,i=d.RED,a=4,l=1,c=d.HALF_FLOAT,u=d.FLOAT):(t=n.RGBA,r=n.RGBA,o=n.RGBA,s=d.RGBA,i=n.RGBA,a=4,l=4,c=e!=null?e.HALF_FLOAT_OES:null,u=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:s,textureFormatFloat:i,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:l,textureTypeHalfFloat:c,textureTypeFloat:u}}function wt(n,e,t){var r=t();return e&&(function(o){var s=o.getError();if(s!==o.NO_ERROR)throw new Error("WebGL Error: "+uK(o,s))})(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(am||(am={})),(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ei||(ei={})),(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Qs||(Qs={}));var aK=596e-10,lK=65504;function cK(n){return!!(Ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||aK<Math.abs(n)&&Math.abs(n)<lK)}function uK(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function w0(n,e,t){return ec(n,e,(function(){return n.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function dK(n,e,t){var r=ec(n,e,(function(){return n.createShader(n.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(wt(n,e,(function(){return n.shaderSource(r,t)})),wt(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function hK(n,e,t){var r=ec(n,e,(function(){return n.createShader(n.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(wt(n,e,(function(){return n.shaderSource(r,t)})),wt(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw(function(o,s){var i=fK.exec(s);if(i==null)return console.log("Couldn't parse line number in error: "+s),void console.log(o);for(var a=+i[1],l=o.split(`
`),c=l.length.toString().length+2,u=l.map((function(y,b){return qh((b+1).toString(),c)+y})),d=0,h=0;h<u.length;h++)d=Math.max(u[h].length,d);var p=u.slice(0,a-1),g=u.slice(a-1,a),x=u.slice(a);console.log(p.join(`
`)),console.log(s.split(`
`)[0]),console.log("%c "+qh(g[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(x.join(`
`))})(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Ww,Uw,fK=/ERROR: [0-9]+:([0-9]+):/g;function pK(n,e){return ec(n,e,(function(){return n.createProgram()}),"Unable to create WebGLProgram.")}function mK(n,e,t){if(wt(n,e,(function(){return n.linkProgram(t)})),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Hw(n,e,t){if(wt(n,e,(function(){return n.validateProgram(t)})),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function gK(n,e,t){var r=ec(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return wt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),wt(n,e,(function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function xK(n,e,t){var r=ec(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return wt(n,e,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)})),wt(n,e,(function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function vK(n,e){return ec(n,e,(function(){return n.createTexture()}),"Unable to create WebGLTexture.")}function yK(n,e){var t=Ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function bK(n,e){return ec(n,e,(function(){return n.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function JN(n,e,t,r,o,s,i,a){var l=n.getAttribLocation(t,r);return l!==-1&&(wt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,o)})),wt(n,e,(function(){return n.vertexAttribPointer(l,s,n.FLOAT,!1,i,a)})),wt(n,e,(function(){return n.enableVertexAttribArray(l)})),!0)}function wK(n,e,t,r){IK(n,r),wt(n,e,(function(){return n.activeTexture(n.TEXTURE0+r)})),wt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)}))}function CK(n,e,t,r){return ec(n,e,(function(){return n.getUniformLocation(t,r)}),'uniform "'+r+'" not present in program.')}function kK(n,e,t){return n.getUniformLocation(e,t)}function SK(n,e,t,r,o,s){wt(n,e,(function(){return wK(n,e,r,s)})),wt(n,e,(function(){return n.uniform1i(o,s)}))}function Gw(n,e,t,r){wt(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)})),wt(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}))}function eI(n,e,t){wt(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)})),wt(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)}))}function C0(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+NK(n,e))}function NK(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function ec(n,e,t,r){var o=wt(n,e,(function(){return t()}));if(o==null)throw new Error(r);return o}function IK(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function wx(n,e){return e===void 0&&(e=2),yt(n.slice(0,n.length-e))}function Cx(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function qw(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[wx(n)].concat(Cx(n))),e}function EK(n,e){var t;e===void 0&&(e=!1);var r=Ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map((function(c,u){return u>=n.length-2?hD(n[u]):n[u]}))).length===1&&(n=[2,n[0]])),n.length!==2){var o=Qu(n);n=o.newShape}var s=yt(n);if(n.length<=1&&s<=r)return[1,s];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var i=wx(n),a=2,l=2;return n.length&&(a=(t=Cx(n))[0],l=t[1]),tC(s=i*(a/2)*(l/2)).map((function(c){return 2*c}))}return tC(s)}function k0(n){return n%2==0}function S0(n,e){if(uo(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||k0(t)&&k0(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&k0(n[0])&&k0(e[0])}function TK(n){if(Ww==null){var e=gl(n);Ww=e.getParameter(e.MAX_TEXTURE_SIZE)}return Ww}function RK(n){if(Uw==null){var e=gl(n);Uw=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Uw)}function DK(n){if(n===0)return 0;var e=gl(n);return Ri(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Ri(e,"EXT_disjoint_timer_query")?1:0}function Ri(n,e){return n.getExtension(e)!=null}function tI(n){try{if(gl(n)!=null)return!0}catch{return!1}return!1}function AK(n){if(n===0)return!1;var e=gl(n);if(n===1){if(!Ri(e,"OES_texture_float"))return!1}else if(!Ri(e,"EXT_color_buffer_float"))return!1;return lC(e)}function _K(n){if(n===0)return!1;var e=gl(n);if(n!==1){if(Ri(e,"EXT_color_buffer_float"))return lC(e);if(Ri(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return(function(r,o){var s=A4(r,o),i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,s.internalFormatHalfFloat,1,1,0,s.textureFormatFloat,s.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0);var l=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(i),r.deleteFramebuffer(a),l})(e,t)}return!1}return!!Ri(e,"OES_texture_float")&&!!Ri(e,"WEBGL_color_buffer_float")&&lC(e)}function lC(n){var e=A4(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),o}function $K(n){return n===2&&gl(n).fenceSync!=null}var Vt=Ae();function wD(n){Ae().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function lt(n,e){return ce.tidy(n,e)}function Ps(n){yD(n).forEach((function(e){return e.dispose()}))}function FK(n){return ce.keep(n)}function kx(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Ae().getBool("IS_TEST")||console.warn.apply(console,n)}function uu(n,e){var t=n;if(Ja(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||Ja(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&Ae().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function o(s,i,a){if(a=a||[],!Array.isArray(s)&&!Ja(s))return void Y(i.length===0,(function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+i[0]+" elements"}));Y(i.length>0,(function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+s.length+" elements"})),Y(s.length===i[0],(function(){return"Element arr["+a.join("][")+"] should have "+i[0]+" elements, but has "+s.length+" elements"}));for(var l=i.slice(1),c=0;c<s.length;++c)o(s[c],l,a.concat(c))})(n,r,[]),r}function nI(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function X(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof ur)return nI(r,n.dtype,e,t),n;var o=Dm(n);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),nI(r,o,e,t),n==null||!Ja(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var s=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+s+"'")}var i=uu(n,o);Ja(n)||Array.isArray(n)||(n=[n]);var a=o!=="string"?pD(n,o,Ae().getBool("DEBUG")):cf(n,[],!0);return ce.makeTensor(a,i,o)}function Sx(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map((function(o,s){return X(o,e+"["+s+"]",t)}),r)}function CD(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function PK(n,e,t){for(var r=n.length+e.length,o=[],s=0,i=0,a=0;a<r;a++)t.indexOf(a)===-1?o.push(n[s++]):o.push(e[i++]);return o}function zo(n,e){for(var t=[],r=n.length,o=0;o<r;o++)e.indexOf(o)===-1&&t.push(n[o]);return[t,e.map((function(s){return n[s]}))]}function Ms(n,e){return PK(n,e.map((function(t){return 1})),e)}function Ys(n,e,t){Y(CD(e,t),(function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."}))}function xl(n,e){if(CD(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach((function(o){return t.push(o)})),t}function _4(n){return n.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function vl(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function MK(n,e){var t=n[0].length;n.forEach((function(o,s){Y(o.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+s+"] must be the same as the rank of the rest ("+t+")"}))})),Y(e>=0&&e<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var r=n[0];n.forEach((function(o,s){for(var i=0;i<t;i++)Y(i===e||o[i]===r[i],(function(){return"Error in concat"+t+"D: Shape of tensors["+s+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+s+"."}))}))}function df(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function re(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var o=function(){for(var s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];ce.startScope(t);try{var a=r.apply(void 0,s);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ce.endScope(a),a}catch(l){throw ce.endScope(null),l}};return Object.defineProperty(o,"name",{value:t,configurable:!0}),o}Vt.registerFlag("HAS_WEBGL",(function(){return Vt.getNumber("WEBGL_VERSION")>0})),Vt.registerFlag("WEBGL_VERSION",(function(){return tI(2)?2:tI(1)?1:0})),Vt.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return Vt.get("WEBGL_VERSION")===2})),Vt.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Vt.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Vt.registerFlag("WEBGL_PACK",(function(){return Vt.getBool("HAS_WEBGL")})),Vt.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_PACK_CLIP",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Vt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_PACK_REDUCE",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_CONV_IM2COL",(function(){return Vt.getBool("WEBGL_PACK")})),Vt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return TK(Vt.getNumber("WEBGL_VERSION"))})),Vt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return RK(Vt.getNumber("WEBGL_VERSION"))})),Vt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var n=Vt.getNumber("WEBGL_VERSION");return n===0?0:DK(n)})),Vt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Vt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n})),Vt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return AK(Vt.getNumber("WEBGL_VERSION"))})),Vt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Vt.getBool("WEBGL_FORCE_F16_TEXTURES")&&Vt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Vt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return _K(Vt.getNumber("WEBGL_VERSION"))})),Vt.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return $K(Vt.getNumber("WEBGL_VERSION"))})),Vt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Vt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),vD=wD;var So=re({complex_:function(n,e){var t=X(n,"real","complex"),r=X(e,"imag","complex");return An(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),ce.runKernelFunc((function(o){return o.complex(t,r)}),{$real:t,$imag:r})}}),Ei=re({real_:function(n){var e=X(n,"input","real");return ce.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),Ka=re({imag_:function(n){var e=X(n,"input","imag");return ce.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function Io(n,e,t){return du(n,e,uu(n,t),t)}function du(n,e,t,r){if(r==null&&(r=Dm(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ja(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){gD(e);var o=yt(e),s=yt(t);Y(o===s,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+s}));for(var i=0;i<t.length;++i){var a=t[i],l=i!==t.length-1||a!==yt(e.slice(i));Y(t[i]===e[i]||!l,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "}))}}return Ja(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?pD(n,r,Ae().getBool("DEBUG")):cf(n,[],!0),ce.makeTensor(n,e,r)}function et(n,e){if((Ja(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ja(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return du(n,[],[],e)}function $r(n,e){Df(n);var t=uu(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return du(n,null,t,e)}function qc(n,e,t){if(Df(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=uu(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return du(n,e,r,t)}function $4(n,e,t){if(Df(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=uu(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return du(n,e,r,t)}function As(n,e,t){if(Df(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=uu(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return du(n,e,r,t)}function OK(n,e,t){if(Df(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=uu(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return du(n,e,r,t)}function LK(n,e,t){if(Df(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=uu(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return du(n,e=e||r,r,t)}function BK(n,e,t,r){return e===void 0&&(e=!0),ce.makeVariable(n,e,t,r)}function Af(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Af(n,"float32"),r=Zn(n,"float32");return So(t,r)}var o=mD(yt(n),e);return ce.makeTensor(o,n,e)}function Zn(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Zn(n,"float32"),r=Zn(n,"float32");return So(t,r)}var o=Am(yt(n),e);return ce.makeTensor(o,n,e)}function tl(n,e,t){return ce.runKernelFunc((function(r){return r.fill(n,e,t)}),{})}function jK(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return ce.runKernelFunc((function(r){return r.linspace(n,e,t)}),{})}function Nx(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return Zn([0],r);var o=Am(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),o[0]=n;for(var s=1;s<o.length;s++)o[s]=o[s-1]+t;return $r(o,r)}var kD=re({onesLike_:function(n){var e=X(n,"x","onesLike");if(e.dtype==="complex64"){var t=kD(Ei(e)),r=gn(Ka(e));return So(t,r)}return ce.runKernelFunc((function(o){return o.onesLike(e)}),{$x:e},(function(o,s){return{$x:function(){return gn(o)}}}))}}),gn=re({zerosLike_:function(n){var e=X(n,"x","zerosLike");return ce.runKernelFunc((function(t){return t.zerosLike(e)}),{$x:e},(function(t,r){return{$x:function(){return gn(t)}}}))}}),Yr=re({concat_:function(n,e){e===void 0&&(e=0),Y(n.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=Sx(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")})),e=eo(e,t[0].shape)[0];var r=df(t.map((function(a){return a.shape})),e);if(yt(r)===0)return Io([],r);if((t=t.filter((function(a){return a.size>0}))).length===1)return t[0];var o=t.map((function(a){return a.shape}));MK(o,e);var s=t,i={axis:e};return ce.runKernelFunc((function(a){return a.concat(t,e)}),s,(function(a){var l=o.map((function(c){return c[e]}));return F4(a,l,e).map((function(c){return function(){return c}}))}),"Concat",i)}}),VK=re({concat1d_:function(n){return Yr(n,0)}}),zK=re({concat2d_:function(n,e){return Yr(n,e)}}),WK=re({concat3d_:function(n,e){return Yr(n,e)}}),UK=re({concat4d_:function(n,e){return Yr(n,e)}}),F4=re({split_:function(n,e,t){t===void 0&&(t=0);var r,o=X(n,"x","split");return t=eo(t,o.shape)[0],typeof e=="number"?(Y(o.shape[t]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(o.shape[t]/e)):(Y(o.shape[t]===e.reduce((function(s,i){return s+i})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),ce.runKernelFunc((function(s){return s.split(o,r,t)}),{$x:o},(function(s){return{$x:function(){return Yr(s,t)}}}))}});function _d(n,e){return n(e={exports:{}},e.exports),e.exports}var HK=_d((function(n){(function(e,t,r){function o(a){var l,c=this,u=(l=4022871197,function(d){d=d.toString();for(var h=0;h<d.length;h++){var p=.02519603282416938*(l+=d.charCodeAt(h));p-=l=p>>>0,l=(p*=l)>>>0,l+=4294967296*(p-=l)}return 23283064365386963e-26*(l>>>0)});c.next=function(){var d=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(a),c.s0<0&&(c.s0+=1),c.s1-=u(a),c.s1<0&&(c.s1+=1),c.s2-=u(a),c.s2<0&&(c.s2+=1),u=null}function s(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new o(a),u=l&&l.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,u&&(typeof u=="object"&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.alea=i})(0,n)})),GK=_d((function(n){(function(e,t,r){function o(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(0|a)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=0|c.charCodeAt(u),l.next()}function s(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.xor128=i})(0,n)})),qK=_d((function(n){(function(e,t,r){function o(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^d^d<<1)|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(0|a)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=0|c.charCodeAt(u),u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function s(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.xorwow=i})(0,n)})),KK=_d((function(n){(function(e,t,r){function o(a){var l=this;l.next=function(){var c,u,d=l.x,h=l.i;return c=d[h],u=(c^=c>>>7)^c<<24,u^=(c=d[h+1&7])^c>>>10,u^=(c=d[h+3&7])^c>>>3,u^=(c=d[h+4&7])^c<<7,c=d[h+7&7],u^=(c^=c<<13)^c<<9,d[h]=u,l.i=h+1&7,u},(function(c,u){var d,h=[];if(u===(0|u))h[0]=u;else for(u=""+u,d=0;d<u.length;++d)h[7&d]=h[7&d]<<15^u.charCodeAt(d)+h[d+1&7]<<13;for(;h.length<8;)h.push(0);for(d=0;d<8&&h[d]===0;++d);for(d==8?h[7]=-1:h[d],c.x=h,c.i=0,d=256;d>0;--d)c.next()})(l,a)}function s(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=c.next,d.quick=d,u&&(u.x&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.xorshift7=i})(0,n)})),XK=_d((function(n){(function(e,t,r){function o(a){var l=this;l.next=function(){var c,u,d=l.w,h=l.X,p=l.i;return l.w=d=d+1640531527|0,u=h[p+34&127],c=h[p=p+1&127],u^=u<<13,c^=c<<17,u^=u>>>15,c^=c>>>12,u=h[p]=u^c,l.i=p,u+(d^d>>>16)|0},(function(c,u){var d,h,p,g,x,y=[],b=128;for(u===(0|u)?(h=u,u=null):(u+="\0",h=0,b=Math.max(b,u.length)),p=0,g=-32;g<b;++g)u&&(h^=u.charCodeAt((g+32)%u.length)),g===0&&(x=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,g>=0&&(x=x+1640531527|0,p=(d=y[127&g]^=h+x)==0?p+1:0);for(p>=128&&(y[127&(u&&u.length||0)]=-1),p=127,g=512;g>0;--g)h=y[p+34&127],d=y[p=p+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,y[p]=h^d;c.w=x,c.X=y,c.i=p})(l,a)}function s(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=c.next,d.quick=d,u&&(u.X&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.xor4096=i})(0,n)})),YK=_d((function(n){(function(e,t,r){function o(a){var l=this,c="";l.next=function(){var d=l.b,h=l.c,p=l.d,g=l.a;return d=d<<25^d>>>7^h,h=h-p|0,p=p<<24^p>>>8^g,g=g-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-p|0,l.d=p<<16^h>>>16^g,l.a=g-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=0|a):c+=a;for(var u=0;u<c.length+20;u++)l.b^=0|c.charCodeAt(u),l.next()}function s(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.tychei=i})(0,n)})),Yu=_d((function(n){(function(e,t){var r,o=this,s=256,i=6,a="random",l=t.pow(s,i),c=t.pow(2,52),u=2*c,d=s-1;function h(b,C,S){var k=[],N=x((function $(T,D){var A,M=[],j=typeof T;if(D&&j=="object")for(A in T)try{M.push($(T[A],D-1))}catch{}return M.length?M:j=="string"?T:T+"\0"})((C=C==1?{entropy:!0}:C||{}).entropy?[b,y(e)]:b??(function(){try{var $;return r&&($=r.randomBytes)?$=$(s):($=new Uint8Array(s),(o.crypto||o.msCrypto).getRandomValues($)),y($)}catch{var T=o.navigator,D=T&&T.plugins;return[+new Date,o,D,o.screen,y(e)]}})(),3),k),E=new p(k),_=function(){for(var $=E.g(i),T=l,D=0;$<c;)$=($+D)*s,T*=s,D=E.g(1);for(;$>=u;)$/=2,T/=2,D>>>=1;return($+D)/T};return _.int32=function(){return 0|E.g(4)},_.quick=function(){return E.g(4)/4294967296},_.double=_,x(y(E.S),e),(C.pass||S||function($,T,D,A){return A&&(A.S&&g(A,E),$.state=function(){return g(E,{})}),D?(t[a]=$,T):$})(_,N,"global"in C?C.global:this==t,C.state)}function p(b){var C,S=b.length,k=this,N=0,E=k.i=k.j=0,_=k.S=[];for(S||(b=[S++]);N<s;)_[N]=N++;for(N=0;N<s;N++)_[N]=_[E=d&E+b[N%S]+(C=_[N])],_[E]=C;(k.g=function($){for(var T,D=0,A=k.i,M=k.j,j=k.S;$--;)T=j[A=d&A+1],D=D*s+j[d&(j[A]=j[M=d&M+T])+(j[M]=T)];return k.i=A,k.j=M,D})(s)}function g(b,C){return C.i=b.i,C.j=b.j,C.S=b.S.slice(),C}function x(b,C){for(var S,k=b+"",N=0;N<k.length;)C[d&N]=d&(S^=19*C[d&N])+k.charCodeAt(N++);return y(C)}function y(b){return String.fromCharCode.apply(0,b)}if(t["seed"+a]=h,x(t.random(),e),n.exports){n.exports=h;try{r=require("crypto")}catch{}}})([],Math)}));Yu.alea=HK,Yu.xor128=GK,Yu.xorwow=qK,Yu.xorshift7=KK,Yu.xor4096=XK,Yu.tychei=YK;var Pv=Yu.alea,P4=(function(){function n(e,t,r,o,s){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=s||Math.random();this.random=Pv(i.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,o=!1;!o;){var s=void 0,i=void 0,a=void 0;do a=(s=2*this.random()-1)*s+(i=2*this.random()-1)*i;while(a>=1||a===0);var l=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*s*l,r=this.mean+this.stdDev*i*l,this.truncated&&!this.isValidTruncated(t)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n})(),ZK=(function(){function n(e,t,r,o){this.alpha=e,this.beta=1/t,this.dtype=r;var s=o||Math.random();this.randu=Pv(s.toString()),this.randn=new P4(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,o,s,i;;){do o=this.randn.nextValue(),i=1+this.c*o;while(i<=0);if(i*=i*i,t=1-.331*(e=o*o)*e,r=.5*e+this.d*(1-i+Math.log(i)),(s=this.randu())<t||Math.log(s)<r)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n})(),QK=(function(){function n(e,t,r,o){var s=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return s.dtype==null||s.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Pv(o)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n})();function Wt(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",gD(n),new im(n,e,t)}function JK(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var SD=re({batchToSpaceND_:function(n,e,t){var r=X(n,"x","batchToSpaceND"),o=e.reduce((function(s,i){return s*i}));return Y(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),Y(t.length===e.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length})),Y(r.shape[0]%o==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o})),ce.runKernelFunc((function(s){return s.batchToSpaceND(r,e,t)}),{$x:r},(function(s){return{$x:function(){return s.spaceToBatchND(e,t)}}}))}}),eX=re({broadcastTo_:function(n,e){var t=X(n,"broadcastTo","x"),r=t.shape;if(e.some((function(l){return!(l>0)||l%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var o=t.shape.slice();o.length<e.length;)o.unshift(1);t=t.reshape(o)}for(var s=Array.from(e),i=e.length-1;i>=0;i--)if(t.shape[i]===e[i])s[i]=1;else if(t.shape[i]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=s.map((function(l,c){return l>1?c:-1})).filter((function(l){return l>=0}));return a.length===0?t.clone():ce.runKernelFunc((function(l){return l.tile(t,s)}),{input:t},(function(l){return{input:function(){return l.sum(a,!0)}}}))}}),tX=re({cast_:function(n,e){var t=X(n,"x","cast");if(!qq(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return ce.runKernelFunc((function(o){return o.cast(t,e)}),{x:t},(function(o){return{x:function(){return o.clone()}}}),"Cast",r)}}),nX=re({clone_:function(n){var e=X(n,"x","clone",null);return ce.runKernelFunc((function(){return ce.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{$x:e},(function(t){return{$x:function(){return t.toFloat()}}}))}}),rX=re({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var o=X(n,"x","cumsum"),s=xl([e|=0],o.rank),i=o;s!=null&&(i=o.transpose(s));var a=vl(1,o.rank)[0],l=ce.runKernelFunc((function(c){return c.cumsum(i,a,t,r)}),{permutedX:i},(function(c){return{permutedX:function(){return c.cumsum(e,t,!r)}}}));return s!=null&&(l=l.transpose(s)),l}}),oX=re({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=X(n,"x","depthToSpace"),o=t==="NHWC"?r.shape[1]:r.shape[2],s=t==="NHWC"?r.shape[2]:r.shape[3],i=t==="NHWC"?r.shape[3]:r.shape[1];return Y(o*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+`  for depthToSpace with input shape
      `+r.shape})),Y(s*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+s+" and "+e+` for depthToSpace with input shape
          `+r.shape})),Y(i%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+i+" for depthToSpace with input shape "+r.shape})),ce.runKernelFunc((function(a){return a.depthToSpace(r,e,t)}),{$x:r})}}),Ii=re({expandDims_:function(n,e){e===void 0&&(e=0);var t=X(n,"x","expandDims",null);Y(e<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=t.shape.slice();return e<0&&(Y(-(t.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),e=t.rank+e+1),r.splice(e,0,1),sa(t,r)}}),ND=re({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var o=Wt([n,e],r),s=n<=e?n:e,i=0;i<s;++i)o.set(1,i,i);var a=o.toTensor().as2D(n,e);if(t==null)return a;if(t.length===1)return Kh(Ii(a,0),[t[0],1,1]);if(t.length===2)return Kh(Ii(Ii(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return Kh(Ii(Ii(Ii(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),sX=re({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var o=X(n,"logits","multinomial"),s=o.size,i=o.rank;if(s<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+s+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);t=t||Math.random();var a=i===1?o.as2D(1,-1):o,l=ce.runKernelFunc((function(c){return c.multinomial(a,r,e,t)}),{logits2D:a});return i===1?l.as1D():l}}),cC=re({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=X(n,"indices","oneHot","int32"),s=o.shape.concat([e]);return o=o.flatten(),ce.runKernelFunc((function(i){return i.oneHot(o,e,t,r)}),{$indices:o},(function(i){return{$indices:function(){return Zn(o.shape,"float32")}}})).reshape(s)}}),$d=re({pad_:function(n,e,t){t===void 0&&(t=0);var r=X(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:e,constantValue:t};return ce.runKernelFunc((function(s){return s.pad(r,e,t)}),{x:r},(function(s){var i=e.map((function(a){return a[0]}));return{x:function(){return s.slice(i,r.shape)}}}),"PadV2",o)}}),iX=re({pad1d_:function(n,e,t){return t===void 0&&(t=0),Y(e.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),$d(n,[e],t)}}),aX=re({pad2d_:function(n,e,t){return t===void 0&&(t=0),Y(e.length===2&&e[0].length===2&&e[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),$d(n,e,t)}}),lX=re({pad3d_:function(n,e,t){return t===void 0&&(t=0),Y(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),$d(n,e,t)}}),cX=re({pad4d_:function(n,e,t){return t===void 0&&(t=0),Y(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),$d(n,e,t)}}),uX=re({rand_:function(n,e,t){var r=yt(n),o=null;if(t==null||t==="float32")o=new Float32Array(r);else if(t==="int32")o=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);o=new Uint8Array(r)}for(var s=0;s<r;s++)o[s]=e();return ce.makeTensor(o,n,t)}}),dX=re({randomNormal_:function(n,e,t,r,o){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var s=new P4(e,t,r,!1,o),i=Wt(n,r),a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}}),hX=re({randomGamma_:function(n,e,t,r,o){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var s=new ZK(e,t,r,o),i=Wt(n,r),a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}}),ID=re({randomUniform_:function(n,e,t,r,o){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var s=Wt(n,r),i=new QK(e,t,null,o),a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}}),sa=re({reshape_:function(n,e){var t=X(n,"x","reshape",null);e=Hq(e,t.size),Y(t.size===yt(e),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:e};return ce.runKernelFunc((function(o){return o.reshape(t,e)}),{x:t},(function(o){return{x:function(){return o.reshape(t.shape)}}}),"Reshape",r)}}),ED=re({spaceToBatchND_:function(n,e,t){var r=X(n,"x","spaceToBatchND");return Y(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),Y(t.length===e.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length})),Y(r.shape.reduce((function(o,s,i){return i>0&&i<=e.length?o&&(s+t[i-1][0]+t[i-1][1])%e[i-1]==0:o}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()})),ce.runKernelFunc((function(o){return o.spaceToBatchND(r,e,t)}),{$x:r},(function(o){return{$x:function(){return o.batchToSpaceND(e,t)}}}))}}),TD=re({squeeze_:function(n,e){var t=X(n,"x","squeeze");return sa(t,Qu(t.shape,e).newShape)}}),si=re({stack_:function(n,e){e===void 0&&(e=0);var t=Sx(n,"tensors","stack");if(Y(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(e);var r=t[0].rank,o=t[0].shape,s=t[0].dtype;Y(e<=r,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(a){An(o,a.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(a){Y(s===a.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=t.map((function(a){return a.expandDims(e)}));return Yr(i,e)}}),Kh=re({tile_:function(n,e){var t=X(n,"x","tile",null);Y(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}));var r=[t],o={reps:e};return ce.runKernelFunc((function(s,i){var a=s.tile(t,e);return i([t]),a}),{x:t},(function(s,i){var a=i[0];return{x:function(){var l=gn(a);if(a.rank===1)for(var c=0;c<e[0];++c)l=l.add(s.slice([c*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(c=0;c<e[0];++c)for(var u=0;u<e[1];++u)l=l.add(s.slice([c*a.shape[0],u*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(c=0;c<e[0];++c)for(u=0;u<e[1];++u)for(var d=0;d<e[2];++d)l=l.add(s.slice([c*a.shape[0],u*a.shape[1],d*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(c=0;c<e[0];++c)for(u=0;u<e[1];++u)for(d=0;d<e[2];++d)for(var h=0;h<e[3];++h)l=l.add(s.slice([c*a.shape[0],u*a.shape[1],d*a.shape[2],h*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return l}}}),"Tile",o,r)}}),fX=re({truncatedNormal_:function(n,e,t,r,o){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var s=new P4(e,t,r,!0,o),i=Wt(n,r),a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}}),Zr=re({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=X(n,"x","unstack");Y(e>=-t.shape.length&&e<t.shape.length,(function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),e<0&&(e+=t.shape.length);var r={axis:e};return ce.runKernelFunc((function(o){return o.unstack(t,e)}),{x:t},(function(o){return{x:function(){return si(o,e)}}}),"Unpack",r)}}),pX=function(n,e){return pt(this,void 0,void 0,(function(){var t,r,o,s,i,a,l,c,u,d;return mt(this,(function(h){switch(h.label){case 0:return t=X(n,"x","setdiff1d"),r=X(e,"y","setdiff1d"),Y(t.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."})),Y(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),Y(r.rank===1,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,t.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(s=h.sent(),i=new Set(s),a=0,u=0;u<o.length;u++)i.has(o[u])||a++;for(l=new im([a],t.dtype),c=new im([a],"int32"),u=0,d=0;u<o.length;u++)i.has(o[u])||(l.values[d]=o[u],c.values[d]=u,d++);return[2,[l.toTensor(),c.toTensor()]]}}))}))};function Ix(n,e,t,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(n[0]/t),o=o.concat(n.slice(1));else{o=o.concat(n[0]);for(var s=e.length,i=0;i<s;++i)o=o.concat([n[i+1]/e[i],e[i]]);o=o.concat(n.slice(s+1))}return o}function Ex(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var o=e+1;o<n;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var s=[],i=[];for(o=1;o<n;++o)o>=2*e+1||o%2==1?i.push(o):s.push(o);r.push.apply(r,s),r.push(0),r.push.apply(r,i)}return r}function Tx(n,e,t,r){r===void 0&&(r=!0);var o=[];r?o.push(n[0]/t):o.push(n[0]*t);for(var s=1;s<n.length;++s)s<=e.length?r?o.push(e[s-1]*n[s]):o.push(n[s]/e[s-1]):o.push(n[s]);return o}function RD(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function DD(n,e,t){for(var r=n.slice(0,1),o=0;o<t;++o)r.push(n[o+1]-e[o][0]-e[o][1]);return r}function AD(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],o=1,s=0;s<t.length-1;++s)o*=t[s];var i=n.shape,a=t.slice();a.pop();var l=1;for(s=r;s<n.rank;++s)l*=i[s],a.push(i[s]);var c=el(n.shape).map((function(u){return u/l})).concat([1]).slice(0,r);return[a,o,l,c]}var _D=30;function Kw(n){return n<=_D?n:rC(n,Math.floor(Math.sqrt(n)))}function mX(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,s="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+o+".";if(t.rank<o)throw new Error(s+" update.rank < "+o+". ");if(n.length<r+(t.rank-o))throw new Error(s+" Output shape length < "+(r+(t.rank-o)));if(t.rank!==o+n.length-r)throw new Error(s+" update.rank != "+(o+n.length-r));for(var i=0;i<o;++i)if(t.shape[i]!==e.shape[i])throw new Error(s+" updates.shape["+i+"] ("+t.shape[i]+") != indices.shape["+i+"] ("+e.shape[i]+").");for(i=0;i<t.rank-o;++i)if(t.shape[i+o]!==n[i+r])throw new Error(s+" updates.shape["+(i+o)+"] ("+t.shape[i+o]+") != shape["+(i+o)+"] ("+n[i+o]+")")}function gX(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}mX(t,e,n)}function Rx(n,e,t){for(var r=e.shape.length,o=r>1?e.shape[r-1]:1,s=t.length,i=1,a=o;a<s;++a)i*=t[a];var l=o<1?1:o;return{sliceRank:o,numUpdates:yt(e.shape)/l,sliceSize:i,strides:el(t.slice(0,o)).concat([1]),outputSize:yt(t)}}function xX(n,e,t){Y(n.rank===e.length,(function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."})),Y(n.rank===t.length,(function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."}));for(var r=function(s){Y(e[s]+t[s]<=n.shape[s],(function(){return"Error in slice"+n.rank+"D: begin["+s+"] + size["+s+"] ("+(e[s]+t[s])+") would overflow input.shape["+s+"] ("+n.shape[s]+")"}))},o=0;o<n.rank;++o)r(o)}function rI(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function M4(n,e,t){for(var r=[],o=0;o<n.length;o++)r[o]=Math.ceil((e[o]-n[o])/t[o]);return r}function vX(n,e,t,r,o){var s=e[o],i=t[o]||1;(n&1<<o||s==null)&&(s=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[o];return s<0&&(s+=a),s=eC(0,s,a-1)}function yX(n,e,t,r,o){var s=e[o],i=t[o]||1;(n&1<<o||s==null)&&(s=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[o];return s<0&&(s+=a),s=i>0?eC(0,s,a):eC(-1,s,a-1)}function $D(n,e,t){for(var r=t.length,o=0;o<t.length;o++)if(t[o]>1){r=o;break}for(o=r+1;o<t.length;o++)if(e[o]>0||t[o]!==n[o])return!1;return!0}function FD(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function bX(n,e){Y(nC(n),(function(){return"The f passed in variableGrads(f) must be a function"})),Y(e==null||Array.isArray(e)&&e.every((function(u){return u instanceof uf})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=e!=null;if(!t)for(var r in e=[],ce.registeredVariables)e.push(ce.registeredVariables[r]);var o=t?e.filter((function(u){return!u.trainable})):null,s=e.length;Y((e=e.filter((function(u){return u.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+s+" variables is trainable."}));var i=ce.gradients(n,e,null,!0),a=i.value,l=i.grads;Y(l.some((function(u){return u!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),Y(a.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"}));var c={};return e.forEach((function(u,d){l[d]!=null&&(c[u.name]=l[d])})),o?.forEach((function(u){return c[u.name]=null})),{value:a,grads:c}}function Mv(n){return ce.customGrad(n)}var tc=re({softmax_:function(n,e){e===void 0&&(e=-1);var t=X(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return ce.runKernelFunc((function(r,o){var s=r.softmax(t,e);return o([s]),s}),{logits:t},(function(r,o){var s=o[0],i=r.mul(s);return{logits:function(){return i.sub(i.sum([e],!0).mul(s))}}}),"Softmax",{dim:e},[],[!0])}}),wX=re({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=X(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Mv((function(r,o){var s=r.max(e,!0),i=r.sub(s),a=i.toFloat().sub(i.exp().sum(e,!0).log());return o([a]),{value:a,gradFunc:function(l,c){var u=c[0].exp();return l.sub(l.sum(e,!0).mul(u))}}}))(t)}}),PD=(function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n})(),MD=(function(){function n(){}return n.prototype.time=function(e){return ke("time")},n.prototype.read=function(e){return ke("read")},n.prototype.readSync=function(e){return ke("readSync")},n.prototype.numDataIds=function(){return ke("numDataIds")},n.prototype.disposeData=function(e){return ke("disposeData")},n.prototype.write=function(e,t,r){return ke("write")},n.prototype.move=function(e,t,r,o){return ke("move")},n.prototype.memory=function(){return ke("memory")},n.prototype.floatPrecision=function(){return ke("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,o){return ke("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,ke("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return ke("slice")},n.prototype.stridedSlice=function(e,t,r,o){return ke("stridedSlice")},n.prototype.unstack=function(e,t){return ke("unstack")},n.prototype.reverse=function(e,t){return ke("reverse")},n.prototype.concat=function(e,t){return ke("concat")},n.prototype.neg=function(e){return ke("neg")},n.prototype.add=function(e,t){return ke("add")},n.prototype.addN=function(e){return ke("addN")},n.prototype.subtract=function(e,t){return ke("subtract")},n.prototype.multiply=function(e,t){return ke("multiply")},n.prototype.realDivide=function(e,t){return ke("realDivide")},n.prototype.floorDiv=function(e,t){return ke("floorDiv")},n.prototype.sum=function(e,t){return ke("sum")},n.prototype.prod=function(e,t){return ke("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return ke("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return ke("argMin")},n.prototype.argMax=function(e,t){return ke("argMax")},n.prototype.equal=function(e,t){return ke("equal")},n.prototype.notEqual=function(e,t){return ke("notEqual")},n.prototype.less=function(e,t){return ke("less")},n.prototype.lessEqual=function(e,t){return ke("lessEqual")},n.prototype.greater=function(e,t){return ke("greater")},n.prototype.greaterEqual=function(e,t){return ke("greaterEqual")},n.prototype.logicalNot=function(e){return ke("logicalNot")},n.prototype.logicalAnd=function(e,t){return ke("logicalAnd")},n.prototype.logicalOr=function(e,t){return ke("logicalOr")},n.prototype.where=function(e){return ke("where")},n.prototype.select=function(e,t,r){return ke("select")},n.prototype.topk=function(e,t,r){return ke("topk")},n.prototype.min=function(e,t){return ke("min")},n.prototype.minimum=function(e,t){return ke("minimum")},n.prototype.mod=function(e,t){return ke("mod")},n.prototype.max=function(e,t){return ke("max")},n.prototype.maximum=function(e,t){return ke("maximum")},n.prototype.all=function(e,t){return ke("all")},n.prototype.any=function(e,t){return ke("any")},n.prototype.squaredDifference=function(e,t){return ke("squaredDifference")},n.prototype.ceil=function(e){return ke("ceil")},n.prototype.floor=function(e){return ke("floor")},n.prototype.round=function(e){return ke("round")},n.prototype.sign=function(e){return ke("sign")},n.prototype.isNaN=function(e){return ke("isNaN")},n.prototype.isInf=function(e){return ke("isInf")},n.prototype.isFinite=function(e){return ke("isFinite")},n.prototype.pow=function(e,t){return ke("pow")},n.prototype.exp=function(e){return ke("exp")},n.prototype.expm1=function(e){return ke("expm1")},n.prototype.softmax=function(e,t){return ke("softmax")},n.prototype.log=function(e){return ke("log")},n.prototype.log1p=function(e){return ke("log1p")},n.prototype.sqrt=function(e){return ke("sqrt")},n.prototype.rsqrt=function(e){return ke("rsqrt")},n.prototype.square=function(e){return ke("square")},n.prototype.reciprocal=function(e){return ke("reciprocal")},n.prototype.relu=function(e){return ke("relu")},n.prototype.relu6=function(e){return ke("relu6")},n.prototype.prelu=function(e,t){return ke("prelu")},n.prototype.elu=function(e){return ke("elu")},n.prototype.eluDer=function(e,t){return ke("eluDer")},n.prototype.selu=function(e){return ke("selu")},n.prototype.int=function(e){return ke("int")},n.prototype.clip=function(e,t,r){return ke("clip")},n.prototype.abs=function(e){return ke("abs")},n.prototype.complexAbs=function(e){return ke("complexAbs")},n.prototype.sigmoid=function(e){return ke("sigmoid")},n.prototype.softplus=function(e){return ke("softplus")},n.prototype.sin=function(e){return ke("sin")},n.prototype.cos=function(e){return ke("cos")},n.prototype.tan=function(e){return ke("tan")},n.prototype.asin=function(e){return ke("asin")},n.prototype.acos=function(e){return ke("acos")},n.prototype.atan=function(e){return ke("atan")},n.prototype.atan2=function(e,t){return ke("atan2")},n.prototype.sinh=function(e){return ke("sinh")},n.prototype.cosh=function(e){return ke("cosh")},n.prototype.tanh=function(e){return ke("tanh")},n.prototype.asinh=function(e){return ke("asinh")},n.prototype.acosh=function(e){return ke("acosh")},n.prototype.atanh=function(e){return ke("atanh")},n.prototype.erf=function(e){return ke("erf")},n.prototype.step=function(e,t){return ke("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,ke("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return ke("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return ke("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return ke("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,ke("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return ke("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return ke("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return ke("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return ke("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return ke("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return ke("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return ke("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,o){return ke("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return ke("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return ke("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return ke("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return ke("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return ke("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,o){return ke("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return ke("reshape")},n.prototype.cast=function(e,t){return ke("cast")},n.prototype.tile=function(e,t){return ke("tile")},n.prototype.pad=function(e,t,r){return ke("pad")},n.prototype.transpose=function(e,t){return ke("transpose")},n.prototype.gather=function(e,t,r){return ke("gather")},n.prototype.gatherND=function(e,t){return ke("gatherND")},n.prototype.scatterND=function(e,t,r){return ke("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return ke("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return ke("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,o){return ke("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return ke("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,o){return ke("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return ke("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,o,s,i){return ke("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,o,s){return ke("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,o,s,i,a){return ke("LRNGrad")},n.prototype.multinomial=function(e,t,r,o){return ke("multinomial")},n.prototype.oneHot=function(e,t,r,o){return ke("oneHot")},n.prototype.cumsum=function(e,t,r,o){return ke("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,o,s){return ke("nonMaxSuppression")},n.prototype.fft=function(e){return ke("fft")},n.prototype.ifft=function(e){return ke("ifft")},n.prototype.complex=function(e,t){return ke("complex")},n.prototype.real=function(e){return ke("real")},n.prototype.imag=function(e){return ke("imag")},n.prototype.cropAndResize=function(e,t,r,o,s,i){return ke("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return ke("depthToSpace")},n.prototype.split=function(e,t,r){return ke("split")},n.prototype.sparseToDense=function(e,t,r,o){return ke("sparseToDense")},n.prototype.diag=function(e){return ke("diag")},n.prototype.fill=function(e,t,r){return ke("fill")},n.prototype.onesLike=function(e){return ke("onesLike")},n.prototype.zerosLike=function(e){return ke("zerosLike")},n.prototype.linspace=function(e,t,r){return ke("linspace")},n.prototype.dispose=function(){return ke("dispose")},n})();function ke(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function zc(n,e){for(var t=n.length,r=[],o=0;o<t;o++){var s=t-1-o,i=n[s]||1;(e[e.length-1-o]||1)>1&&i===1&&r.unshift(s)}return r}function Qr(n,e){for(var t=[],r=0;r<e.length;r++){var o=n[n.length-r-1],s=e.length-r-1,i=e[s];(o==null||o===1&&i>1)&&t.unshift(s)}return t}function ln(n,e){for(var t=[],r=Math.max(n.length,e.length),o=0;o<r;o++){var s=n[n.length-o-1];s==null&&(s=1);var i=e[e.length-o-1];if(i==null&&(i=1),s===1)t.unshift(i);else if(i===1)t.unshift(s);else{if(s!==i)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(s)}}return t}function lm(n,e,t,r,o,s,i){i===void 0&&(i="channelsLast");var a,l=_x(e),c=l[0],u=l[1];if(i==="channelsLast")a=[c,u,n[3],n[3]];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);a=[c,u,n[1],n[1]]}return Fd(n,a,t,r,o,s,!1,i)}function Dx(n,e,t,r,o,s,i){i===void 0&&(i="NDHWC");var a,l,c=uC(e),u=c[0],d=c[1],h=c[2];if(i==="NDHWC")l="channelsLast",a=[u,d,h,n[4],n[4]];else{if(i!=="NCDHW")throw new Error("Unknown dataFormat "+i);l="channelsFirst",a=[u,d,h,n[1],n[1]]}return Ax(n,a,t,r,o,!1,l,s)}function Fd(n,e,t,r,o,s,i,a){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var l=[-1,-1,-1,-1],c=l[0],u=l[1],d=l[2],h=l[3];if(a==="channelsLast")c=n[0],u=n[1],d=n[2],h=n[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=n[0],h=n[1],u=n[2],d=n[3]}var p,g=e[0],x=e[1],y=e[3],b=_x(t),C=b[0],S=b[1],k=_x(r),N=k[0],E=k[1],_=Xh(g,N),$=Xh(x,E),T=(function(L,U,G,H,O,V,W,B){var q,Q,Z;if(typeof L=="number"){q={top:L,bottom:L,left:L,right:L,type:L===0?"VALID":"NUMBER"};var ne=(function(Be,Xe,Ye,ot,Qe){ot==null&&(ot=OD(Be,Xe,Ye));var ct=Be[0],ie=Be[1],$t=Kp((ct-Xe+2*ot)/Ye+1,Qe);Y(Nr($t),(function(){return"The output # of rows ("+$t+") must be an integer. Change the stride and/or zero pad parameters"}));var Ot=Kp((ie-Xe+2*ot)/Ye+1,Qe);return Y(Nr(Ot),(function(){return"The output # of columns ("+Ot+") must be an integer. Change the stride and/or zero pad parameters"})),[$t,Ot]})([U,G],V,H,L,B);Q=ne[0],Z=ne[1]}else if(L==="same"){Q=Math.ceil(U/H),Z=Math.ceil(G/O);var ge=Math.max(0,(Q-1)*H+V-U),he=Math.max(0,(Z-1)*O+W-G),Se=Math.floor(ge/2),Re=ge-Se,We=Math.floor(he/2);q={top:Se,bottom:Re,left:We,right:he-We,type:"SAME"}}else{if(L!=="valid")throw Error("Unknown padding parameter: "+L);q={top:0,bottom:0,left:0,right:0,type:"VALID"},Q=Math.ceil((U-V+1)/H),Z=Math.ceil((G-W+1)/O)}return{padInfo:q,outHeight:Q,outWidth:Z}})(o,u,d,C,S,_,$,s),D=T.padInfo,A=T.outHeight,M=T.outWidth,j=i?y*h:y;return a==="channelsFirst"?p=[c,j,A,M]:a==="channelsLast"&&(p=[c,A,M,j]),{batchSize:c,dataFormat:a,inHeight:u,inWidth:d,inChannels:h,outHeight:A,outWidth:M,outChannels:j,padInfo:D,strideHeight:C,strideWidth:S,filterHeight:g,filterWidth:x,effectiveFilterHeight:_,effectiveFilterWidth:$,dilationHeight:N,dilationWidth:E,inShape:n,outShape:p,filterShape:e}}function Ax(n,e,t,r,o,s,i,a){s===void 0&&(s=!1),i===void 0&&(i="channelsLast");var l=[-1,-1,-1,-1,-1],c=l[0],u=l[1],d=l[2],h=l[3],p=l[4];if(i==="channelsLast")c=n[0],u=n[1],d=n[2],h=n[3],p=n[4];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);c=n[0],p=n[1],u=n[2],d=n[3],h=n[4]}var g,x=e[0],y=e[1],b=e[2],C=e[4],S=uC(t),k=S[0],N=S[1],E=S[2],_=uC(r),$=_[0],T=_[1],D=_[2],A=Xh(x,$),M=Xh(y,T),j=Xh(b,D),L=(function(W,B,q,Q,Z,ne,ge,he,Se,Re,We){var Be,Xe,Ye,ot;if(typeof W=="number"){Be={top:W,bottom:W,left:W,right:W,front:W,back:W,type:W===0?"VALID":"NUMBER"};var Qe=(function(tn,Ht,Yt,ye,Fe,Oe){Fe==null&&(Fe=OD(tn,Ht,ye));var xt=tn[0],at=tn[1],Lt=tn[2],St=Kp((xt-Ht+2*Fe)/ye+1,Oe);Y(Nr(St),(function(){return"The output # of depths ("+St+") must be an integer. Change the stride and/or zero pad parameters"}));var Rt=Kp((at-Ht+2*Fe)/ye+1,Oe);Y(Nr(Rt),(function(){return"The output # of rows ("+Rt+") must be an integer. Change the stride and/or zero pad parameters"}));var On=Kp((Lt-Ht+2*Fe)/ye+1,Oe);return Y(Nr(On),(function(){return"The output # of columns ("+On+") must be an integer. Change the stride and/or zero pad parameters"})),[St,Rt,On,Yt]})([B,q,Q,1],he,1,Z,W,We);Xe=Qe[0],Ye=Qe[1],ot=Qe[2]}else if(W==="same"){Xe=Math.ceil(B/Z),Ye=Math.ceil(q/ne),ot=Math.ceil(Q/ge);var ct=(Xe-1)*Z+he-B,ie=(Ye-1)*ne+Se-q,$t=(ot-1)*ge+Re-Q,Ot=Math.floor(ct/2),qt=ct-Ot,en=Math.floor(ie/2),hn=ie-en,cn=Math.floor($t/2);Be={top:en,bottom:hn,left:cn,right:$t-cn,front:Ot,back:qt,type:"SAME"}}else{if(W!=="valid")throw Error("Unknown padding parameter: "+W);Be={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Xe=Math.ceil((B-he+1)/Z),Ye=Math.ceil((q-Se+1)/ne),ot=Math.ceil((Q-Re+1)/ge)}return{padInfo:Be,outDepth:Xe,outHeight:Ye,outWidth:ot}})(o,u,d,h,k,N,E,A,M,j,a),U=L.padInfo,G=L.outDepth,H=L.outHeight,O=L.outWidth,V=s?C*p:C;return i==="channelsFirst"?g=[c,V,G,H,O]:i==="channelsLast"&&(g=[c,G,H,O,V]),{batchSize:c,dataFormat:i,inDepth:u,inHeight:d,inWidth:h,inChannels:p,outDepth:G,outHeight:H,outWidth:O,outChannels:V,padInfo:U,strideDepth:k,strideHeight:N,strideWidth:E,filterDepth:x,filterHeight:y,filterWidth:b,effectiveFilterDepth:A,effectiveFilterHeight:M,effectiveFilterWidth:j,dilationDepth:$,dilationHeight:T,dilationWidth:D,inShape:n,outShape:g,filterShape:e}}function OD(n,e,t,r){r===void 0&&(r=1);var o=Xh(e,r);return Math.floor((n[0]*(t-1)-t+o)/2)}function _x(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function uC(n){return typeof n=="number"?[n,n,n]:n}function Xh(n,e){return e<=1?n:n+(n-1)*(e-1)}function Kp(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function hf(n){var e=_x(n),t=e[0],r=e[1],o=e[2];return t===1&&r===1&&o===1}function Os(n,e){return hf(n)||hf(e)}function O4(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function LD(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=Zn(n.shape),o=n.toFloat(),s=t.complex(o,r);return r.dispose(),o.dispose(),s}if(!Kq(n.dtype,e))return ce.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var i=t.real(n);return s=i.cast(e),i.dispose(),s}if(e==="int32")return t.int(n);if(e==="bool"){var a=et(0,n.dtype);return s=t.notEqual(n,a),a.dispose(),s}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function dC(n,e){return ce.makeTensorFromDataId(n.dataId,e,n.dtype)}function BD(n,e,t){var r=(e-n)/(t-1),o=Am(t,"float32");o[0]=n;for(var s=1;s<o.length;s++)o[s]=o[s-1]+r;return $r(o,"float32")}function hC(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function oI(n,e){return{real:n[2*e],imag:n[2*e+1]}}function CX(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function kX(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function SX(n,e,t){var r=(function(s,i,a){return(function(l,c,u){for(var d=0,h=l.length,p=0,g=!1;d<h;){var x=u(c,l[p=d+(h-d>>>1)]);x>0?d=p+1:(h=p,g=!x)}return g?d:-d-1})(s,i,a||NX)})(n,e,t),o=r<0?-(r+1):r;n.splice(o,0,e)}function NX(n,e){return n>e?1:n<e?-1:0}function L4(n,e,t,r,o){return jD(n,e,t,r,o,0).selectedIndices}function B4(n,e,t,r,o,s){var i=jD(n,e,t,r,o,s);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function jD(n,e,t,r,o,s,i,a){a===void 0&&(a=!1);for(var l=Array.from(e).map((function(k,N){return{score:k,boxIndex:N,suppressBeginIndex:0}})).filter((function(k){return k.score>o})).sort(sI),c=s>0?-.5/s:0,u=[],d=[];u.length<t&&l.length>0;){var h=l.pop(),p=h.score,g=h.boxIndex,x=h.suppressBeginIndex;if(p<o)break;for(var y=!1,b=u.length-1;b>=x;--b){var C=IX(n,g,u[b]);if(C>=r){y=!0;break}if(h.score=h.score*EX(r,c,C),h.score<=o)break}h.suppressBeginIndex=u.length,y||(h.score===p?(u.push(g),d.push(h.score)):h.score>o&&SX(l,h,sI))}var S=u.length;return a&&(u.fill(0,S),d.fill(0,S)),{selectedIndices:$r(u,"int32"),selectedScores:$r(d,"float32"),numValidOutputs:et(S,"int32")}}function IX(n,e,t){var r=n.subarray(4*e,4*e+4),o=n.subarray(4*t,4*t+4),s=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),p=(a-s)*(l-i),g=(d-c)*(h-u);if(p<=0||g<=0)return 0;var x=Math.max(s,c),y=Math.max(i,u),b=Math.min(a,d),C=Math.min(l,h),S=Math.max(b-x,0)*Math.max(C-y,0);return S/(p+g-S)}function EX(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function sI(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function VD(n,e,t){var r=new Array(n.rank).fill(0),o=n.shape.slice();return e.map((function(s){o[t]=s;var i=n.slice(r,o);return r[t]+=s,i}))}function zD(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var o=Wt(t,n.dtype);for(r=0;r<o.values.length;++r){for(var s=o.indexToLoc(r),i=new Array(n.rank),a=0;a<i.length;a++)i[a]=s[a]%n.shape[a];var l=n.locToIndex(i);o.values[r]=n.values[l]}return o.toTensor()}function WD(n,e,t,r,o){for(var s=e[e.length-1],i=[n.length/s,s],a=i[0],l=i[1],c=sm(t,a*r),u=sm("int32",a*r),d=0;d<a;d++){for(var h=d*l,p=n.subarray(h,h+l),g=[],x=0;x<p.length;x++)g.push({value:p[x],index:x});g.sort((function(k,N){return N.value-k.value}));var y=d*r,b=c.subarray(y,y+r),C=u.subarray(y,y+r);for(x=0;x<r;x++)b[x]=g[x].value,C[x]=g[x].index}var S=e.slice();return S[S.length-1]=r,[Io(c,S,t),Io(u,S,"int32")]}function j4(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var o=Wt(n,"int32"),s=Wt([t.length,n.length],"int32");for(r=0;r<t.length;r++){var i=o.indexToLoc(t[r]),a=r*n.length;s.values.set(i,a)}return s.toTensor()}var TX=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((function(o,s){return"T"+s}));var t=[];this.variableNames.forEach((function(o){t.push("float v"+o+" = get"+o+"AtOutCoords();")}));var r=this.variableNames.map((function(o){return"v"+o})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},RX=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((function(o,s){return"T"+s}));var t=[];this.variableNames.forEach((function(o){t.push("vec4 v"+o+" = get"+o+"AtOutCoords();")}));var r=this.variableNames.map((function(o){return"v"+o})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},DX=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,o=n.batchSize,s=n.inSize,i=Math.ceil(s/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var a=e==="max"?">":"<",l=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+l+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function UD(n,e){return["x","y","z","w","u","v"].slice(0,e).map((function(t){return n+"."+t}))}function _s(n,e){return e===1?[n]:UD(n,e)}function Go(){var n,e,t,r,o,s,i,a,l,c;return Ae().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",o="texture",s="outputColor",i="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",o="texture2D",s="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:o,output:s,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function rd(n,e,t){t===void 0&&(t="index");var r=el(e);return r.map((function(o,s){return"int "+n[s]+" = "+t+" / "+o+"; "+(s===r.length-1?"int "+n[s+1]+" = "+t+" - "+n[s]+" * "+o:"index -= "+n[s]+" * "+o)+";"})).join("")}function V4(n){var e=el(n).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var HD=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function AX(n,e,t,r){var o=[];n.forEach((function(p){var g=yt(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?o.push("uniform float "+p.name+(g>1?"["+g+"]":"")+";"):(o.push("uniform sampler2D "+p.name+";"),o.push("uniform int offset"+p.name+";"))}));var s,i,a=o.join(`
`),l=n.map((function(p){return(function(g,x,y){y===void 0&&(y=!1);var b="";b+=y?GD(g):Oh(g);var C=g.shapeInfo.logicalShape,S=x.logicalShape;return C.length<=S.length&&(b+=y?(function(k,N){var E,_=k.name,$=_.charAt(0).toUpperCase()+_.slice(1),T="get"+$+"AtOutCoords",D=k.shapeInfo.logicalShape.length,A=N.logicalShape.length,M=zc(k.shapeInfo.logicalShape,N.logicalShape),j=Gn(A),L=A-D,U=["x","y","z","w","u","v"];E=D===0?"":A<2&&M.length>=1?"coords = 0;":M.map((function(q){return"coords."+U[q+L]+" = 0;"})).join(`
`);var G="";G=A<2&&D>0?"coords":k.shapeInfo.logicalShape.map((function(q,Q){return"coords."+U[Q+L]})).join(", ");var H="return outputValue;",O=yt(k.shapeInfo.logicalShape)===1,V=yt(N.logicalShape)===1;if(D!==1||O||V){if(O&&!V)H=A===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(M.length){var W=D-2,B=D-1;M.indexOf(W)>-1&&M.indexOf(B)>-1?H="return vec4(outputValue.x);":M.indexOf(W)>-1?H="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":M.indexOf(B)>-1&&(H="return vec4(outputValue.xx, outputValue.zz);")}}else H=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+T+`() {
      `+j+` coords = getOutputCoords();
      `+E+`
      vec4 outputValue = get`+$+"("+G+`);
      `+H+`
    }
  `})(g,x):(function(k,N){var E=k.name,_=E.charAt(0).toUpperCase()+E.slice(1),$="get"+_+"AtOutCoords",T=N.texShape,D=k.shapeInfo.texShape,A=k.shapeInfo.logicalShape.length,M=N.logicalShape.length;if(!k.shapeInfo.isUniform&&A===M&&k.shapeInfo.flatOffset==null&&uo(D,T))return`
      float `+$+`() {
        return sampleTexture(`+E+`, resultUV);
      }
    `;var j,L=Gn(M),U=zc(k.shapeInfo.logicalShape,N.logicalShape),G=M-A,H=["x","y","z","w","u","v"];j=A===0?"":M<2&&U.length>=1?"coords = 0;":U.map((function(V){return"coords."+H[V+G]+" = 0;"})).join(`
`);var O="";return O=M<2&&A>0?"coords":k.shapeInfo.logicalShape.map((function(V,W){return"coords."+H[W+G]})).join(", "),`
    float `+$+`() {
      `+L+` coords = getOutputCoords();
      `+j+`
      return get`+_+"("+O+`);
    }
  `})(g,x)),b})(p,e,r)})).join(`
`),c=e.texShape,u=Go(),d=(function(p){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+p.texture2D+`(textureSampler, uv).r;
    }
  `})(u),h=(function(p){return p.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+p.varyingFs+` vec2 resultUV;
    `+p.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+p.defineSpecialNaN+`
    `+p.defineSpecialInf+`
    `+p.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+_X+`
    `+$X+`
    `+FX+`
  `})(u);return e.isPacked?(s=(function(p,g){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(k,N){var E=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)];return E[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+E[1]+`.0);
      }
    `:E[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+E[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      return 2 * (resTexRC.x * `+E[1]+` + resTexRC.y);
    }
  `})(0,g);case 2:return(function(k,N){var E=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)];if(uo(k,N))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+E[0]+", "+E[1]+`));
      }
    `;var _=Math.ceil(k[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));

      int index = resTexRC.x * `+E[1]+` + resTexRC.y;
      int r = 2 * (index / `+_+`);
      int c = imod(index, `+_+`) * 2;

      return ivec2(r, c);
    }
  `})(p,g);case 3:return x=p,y=g,b=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],C=Math.ceil(x[2]/2),S=C*Math.ceil(x[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      int b = index / `+S+`;
      index -= b * `+S+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(k,N){for(var E=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)],_=Math.ceil(k[k.length-1]/2),$=_*Math.ceil(k[k.length-2]/2),T=$,D="",A="b, r, c",M=2;M<k.length-1;M++)T*=k[k.length-M-1],D=`
      int b`+M+" = index / "+T+`;
      index -= b`+M+" * "+T+`;
    `+D,A="b"+M+", "+A;return`
    ivec`+k.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      `+D+`

      int b = index / `+$+`;
      index -= b * `+$+`;

      int r = 2 * (index / `+_+`);
      int c = imod(index, `+_+`) * 2;

      return ivec`+k.length+"("+A+`);
    }
  `})(p,g)}var x,y,b,C,S})(e.logicalShape,c),i=(function(p){return`
    void setOutput(vec4 val) {
      `+p.output+` = val;
    }
  `})(u)):(s=(function(p,g){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(b,C){return C[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return resTexRC.x * `+C[1]+` + resTexRC.y;
    }
  `})(0,g);case 2:return(function(b,C){return uo(b,C)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `:b[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+C[0]+", "+C[1]+`));
        int index = resTexRC.x * `+C[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:b[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+C[0]+", "+C[1]+`));
        int index = resTexRC.x * `+C[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = index / `+b[1]+`;
      int c = index - r * `+b[1]+`;
      return ivec2(r, c);
    }
  `})(p,g);case 3:return x=g,y=rd(["r","c","d"],p),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+y+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(b,C){var S=rd(["r","c","d","d2"],b);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      `+S+`
      return ivec4(r, c, d, d2);
    }
  `})(p,g);case 5:return(function(b,C){var S=rd(["r","c","d","d2","d3"],b);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+C[0]+`,
                             `+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+S+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(p,g);case 6:return(function(b,C){var S=rd(["r","c","d","d2","d3","d4"],b);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+S+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(p,g);default:throw new Error(p.length+"-D output sampling is not yet supported")}var x,y})(e.logicalShape,c),i=(function(p){return`
    void setOutput(float val) {
      `+p.output+` = vec4(val, 0, 0, 0);
    }
  `})(u)),r&&(h+=PX),[h,d,i,a,s,l,t].join(`
`)}function Oh(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var s=t.shapeInfo.texShape,i=s[0],a=s[1];if(i===1&&a===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var l=t.shapeInfo.texShape,c=l[0],u=l[1],d=Gu(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+c+", "+u+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 1:return(function(t){var r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Dh(t)+`
      }
    `;var s=t.shapeInfo.texShape,i=s[0],a=s[1];if(a===1&&i===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var l=Gu(r);return a===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+l+") + 0.5) / "+i+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:i===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+l+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+a+", index + "+l+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 2:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),i=t.shapeInfo.texShape;if(i!=null&&uo(r,i)){var a=i[0],l=i[1];return`
    float `+s+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+a+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var c=Qu(r),u=c.newShape,d=c.keptDims,h=u;if(h.length<r.length){var p=Lh(t,h);return`
      `+Oh(p)+`
      float `+s+`(int row, int col) {
        return `+s+"("+Bh(["row","col"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Dh(t)+`
      }
    `;var g=i[0],x=i[1],y=Gu(o);return x===1?`
    float `+s+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+g+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:g===1?`
    float `+s+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+x+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+s+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+y+`;
    vec2 uv = uvFromFlat(`+g+", "+x+`, index);
    return sampleTexture(`+o+`, uv);
  }
`})(n);case 3:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[1]*r[2],a=r[2],l=Qu(r),c=l.newShape,u=l.keptDims,d=c;if(d.length<r.length){var h=Lh(t,d);return`
        `+Oh(h)+`
        float `+s+`(int row, int col, int depth) {
          return `+s+"("+Bh(["row","col","depth"],u)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+a+`, 1)));
        `+Dh(t)+`
      }
    `;var p=t.shapeInfo.texShape,g=p[0],x=p[1],y=t.shapeInfo.flatOffset;if(x===i&&y==null)return`
        float `+s+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+x+".0, "+g+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(x===a&&y==null)return`
    float `+s+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+x+".0, "+g+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var b=Gu(o);return`
      float `+s+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+a+" + depth + "+b+`;
        vec2 uv = uvFromFlat(`+g+", "+x+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `})(n);case 4:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[3],a=r[2]*i,l=r[1]*a,c=Qu(r),u=c.newShape,d=c.keptDims;if(u.length<r.length){var h=Lh(t,u);return`
      `+Oh(h)+`
      float `+s+`(int row, int col, int depth, int depth2) {
        return `+s+"("+Bh(["row","col","depth","depth2"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+a+", "+i+`, 1)));
        `+Dh(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,x=g[0],y=g[1];if(y===l&&p==null)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+x+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(y===i&&p==null)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+x+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var b=Gu(o);return`
    float `+s+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+a+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+x+", "+y+", index + "+b+`);
      return sampleTexture(`+o+`, uv);
    }
  `})(n);case 5:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[4],a=r[3]*i,l=r[2]*a,c=r[1]*l,u=Qu(r),d=u.newShape,h=u.keptDims;if(d.length<r.length){var p=Lh(t,d);return`
      `+Oh(p)+`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        return `+s+"("+Bh(["row","col","depth","depth2","depth3"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+l+", "+a+", "+i+`)) +
          depth3;
        `+Dh(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,x=t.shapeInfo.texShape,y=x[0],b=x[1];if(b===c&&g==null)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+l+", "+a+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+y+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(b===i&&g==null)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+y+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var C=Gu(o);return`
    float `+s+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+l+" + depth * "+a+` +
          depth2 * `+i+" + depth3 + "+C+`;
      vec2 uv = uvFromFlat(`+y+", "+b+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `})(n);case 6:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),i=Qu(r),a=i.newShape,l=i.keptDims;if(a.length<r.length){var c=Lh(t,a);return`
      `+Oh(c)+`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+s+"("+Bh(["row","col","depth","depth2","depth3","depth4"],l)+`);
      }
    `}var u=r[5],d=r[4]*u,h=r[3]*d,p=r[2]*h,g=r[1]*p;if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+g+", "+p+", "+h+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+u+`, 1)));
        `+Dh(t)+`
      }
    `;var x=t.shapeInfo.flatOffset,y=t.shapeInfo.texShape,b=y[0],C=y[1];if(C===g&&x==null)return`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+p+", "+h+", "+d+", "+u+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+b+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(C===u&&x==null)return`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+b+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var S=Gu(o);return`
    float `+s+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+g+" + col * "+p+" + depth * "+h+` +
          depth2 * `+d+" + depth3 * "+u+" + depth4 + "+S+`;
      vec2 uv = uvFromFlat(`+b+", "+C+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `})(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function GD(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Go(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(o){var s=o.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),a=o.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=Go();return`
    vec4 `+i+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+l[0]+", "+l[1]+`, index);
      return `+c.texture2D+"("+s+`, uv);
    }
  `})(n);case 2:return(function(o){var s=o.shapeInfo.logicalShape,i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),l=o.shapeInfo.texShape,c=l[0],u=l[1],d=Go();if(l!=null&&uo(s,l))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+c+`.0);

        return `+d.texture2D+"("+i+`, uv);
      }
    `;var h=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],p=Math.ceil(s[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+p+", "+h[0]+", "+h[1]+`, row, col);
      return `+d.texture2D+"("+i+`, uv);
    }
  `})(n);case 3:return(function(o){var s=o.shapeInfo.logicalShape,i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),l=o.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];if(s[0]===1){var u=s.slice(1),d=Lh(o,u);return`
        `+GD(d)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+Bh(["b","row","col"],[1,2])+`);
        }
      `}var h=c[0],p=c[1],g=Math.ceil(s[2]/2),x=g*Math.ceil(s[1]/2),y=Go();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+h+", "+p+", "+x+", "+g+`, b, row, col);
      return `+y.texture2D+"("+i+`, uv);
    }
  `})(n);default:return(function(o){for(var s=o.shapeInfo.logicalShape,i=s.length,a=o.name,l="get"+a.charAt(0).toUpperCase()+a.slice(1),c=o.shapeInfo.texShape,u=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=u[0],h=u[1],p=Math.ceil(s[i-1]/2),g=p*Math.ceil(s[i-2]/2),x="int b, int row, int col",y="b * "+g+" + (row / 2) * "+p+" + (col / 2)",b=2;b<i-1;b++)x="int b"+b+", "+x,g*=s[i-b-1],y="b"+b+" * "+g+" + "+y;var C=Go();return`
    vec4 `+l+"("+x+`) {
      int index = `+y+`;
      int texR = index / `+h+`;
      int texC = index - texR * `+h+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+h+", "+d+`);
      return `+C.texture2D+"("+a+`, uv);
    }
  `})(n)}}var _X=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,$X=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,FX=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,PX=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Gu(n){return"offset"+n}function Dh(n){var e=n.name,t=yt(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Gn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Lh(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Bh(n,e){return e.map((function(t){return n[t]})).join(", ")}var MX=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Y(n.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var o=n[n.length-1],s=Math.ceil(o/e);this.outputShape=n.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");var i,a,l=this.outputShape,c=l.length,u=Gn(c),d=_s("coords",c);if(s===1){var h=Gn(a=c+1);i=`
        `+h+" sourceLocR = "+h+"("+d.join()+`, 0);
        ++`+d[c-1]+`;
        `+h+" sourceLocG = "+h+"("+d.join()+`, 0);
        ++`+d[c-2]+`;
        `+h+" sourceLocA = "+h+"("+d.join()+`, 0);
        --`+d[c-1]+`;
        `+h+" sourceLocB = "+h+"("+d.join()+`, 0);
        --`+d[c-2]+";"}else a=c,i=`
        `+u+` sourceLocR = coords;
        ++`+d[c-1]+`;
        `+u+` sourceLocG = coords;
        ++`+d[c-2]+`;
        `+u+` sourceLocA = coords;
        --`+d[c-1]+`;
        `+u+` sourceLocB = coords;
        --`+d[c-2]+";";var p=["x","y","z","w","u","v"].slice(0,a),g="."+p[a-1],x=p.map((function($){return"int "+$})),y=_s("sourceLocR",a-1).concat("inIdx.r"),b=_s("sourceLocG",a-1).concat("inIdx.g"),C=_s("sourceLocB",a-1).concat("inIdx.b"),S=_s("sourceLocA",a-1).concat("inIdx.a"),k=t==="max"?"greaterThan":"lessThan",N=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+S.join()+")));",E=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+S.join()+") : 0.)",_=r?"":`
      float getBestIndicesAChannel(`+x.join()+`) {
        return getChannel(getBestIndicesA(`+p.join()+`),
                                          vec2(`+p.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+x.join()+`) {
        return getChannel(getA(`+p.join()+`),
                               vec2(`+p.slice(-2).join()+`));
      }
      `+_+`
      void main() {
        `+u+` coords = getOutputCoords();
        bool hasNextCol = `+d[c-1]+" < "+(l[c-1]-1)+`;
        bool hasNextRow = `+d[c-2]+" < "+(l[c-2]-1)+`;
        `+i+`
        ivec4 srcIdx = ivec4(sourceLocR`+g+", sourceLocG"+g+`,
          sourceLocB`+g+", sourceLocA"+g+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+E+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+N+`
          vec4 candidate = `+E+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+k+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},OX=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,o=n.strideWidth,s=n.dilationHeight,i=n.dilationWidth,a=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=a-1-n.padInfo.top,u=l-1-n.padInfo.left,d=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+u+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+s+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+i+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},LX=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,o=n.strideDepth,s=n.strideHeight,i=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterDepth,d=n.effectiveFilterHeight,h=n.effectiveFilterWidth,p=u-1-n.padInfo.front,g=d-1-n.padInfo.top,x=h-1-n.padInfo.left,y=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+p+", "+g+", "+x+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
            wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+l+`) {
            float dyR = float(dyRCorner + wR) / `+s+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},BX=function(n,e,t,r,o,s){this.outputShape=[],this.variableNames=["x","mean","variance"],ln(n,e),ln(n,t);var i="0.0";r!=null&&(ln(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var a="1.0";o!=null&&(ln(n,o),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+i+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+s+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},jX=function(n,e,t,r,o,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ln(n,e),ln(n,t);var i="vec4(0.0)";r!=null&&(ln(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var a="vec4(1.0)";o!=null&&(ln(n,o),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+i+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+s+`));

        setOutput((x - mean) * inv + offset);
      }
    `},VX="return areal * breal - aimag * bimag;",zX="return areal * bimag + aimag * breal;",iI=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ln(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Xw="return a + b;",Yw="return a - b;",aI="return a * b;",qD="return (a < 0.) ? b * a : a;",pr=function(n,e,t){this.variableNames=["A","B"],this.outputShape=ln(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},KD=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Vl=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ln(e,t);var o=this.outputShape.length,s="";if(r)if(o===0||yt(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          `+Gn(o)+` coords = getOutputCoords();
        `,o===1)s+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var i=_s("coords",o);s+=`
            bool nextRowOutOfBounds =
              (`+i[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+i[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+s+`

        setOutput(result);
      }
    `},WX=(function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(o,s){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(s,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(s,"maxVal")),o.gl.uniform1f(r.minLoc,e),o.gl.uniform1f(r.maxLoc,t)}},n})(),UX=(function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(o,s){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(s,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(s,"maxVal")),o.gl.uniform1f(r.minLoc,e),o.gl.uniform1f(r.maxLoc,t)}},n})(),HX=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},GX=function(n){this.outputShape=[],this.outputShape=df(n,1),this.variableNames=n.map((function(a,l){return"T"+l}));var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var o=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+o+"));")}var s=e.length,i=e[e.length-1];r.push("else setOutput(getT"+s+"(yR, yC-"+i+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},qX=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=df(n,e);var t=this.outputShape,r=t.length,o=Gn(r),s=_s("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map((function(y,b){return"T"+b}));var a=new Array(n.length-1);a[0]=n[0][e];for(var l=1;l<a.length;l++)a[l]=a[l-1]+n[l][e];var c=i[e],u=i.slice(-2),d=i.join(),h="if ("+c+" < "+a[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+u.join()+`));
        }`;for(l=1;l<a.length;l++){var p=a[l-1];h+=`
        if (`+c+" < "+a[l]+"  && "+c+" >= "+a[l-1]+`) {
          return getChannel(
            getT`+l+"("+N0(i,c,p)+`),
            vec2(`+N0(u,c,p)+`));
        }`}var g=a.length,x=a[a.length-1];h+=`
        return getChannel(
          getT`+g+"("+N0(i,c,x)+`),
          vec2(`+N0(u,c,x)+"));",this.userCode=`
      float getValue(`+i.map((function(y){return"int "+y}))+`) {
        `+h+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+s+`), 0., 0., 0.);

        `+s[r-1]+" = "+s[r-1]+` + 1;
        if (`+s[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+s+`);
        }

        `+s[r-2]+" = "+s[r-2]+` + 1;
        if (`+s[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+s+`);
        }

        `+s[r-1]+" = "+s[r-1]+` - 1;
        if (`+s[r-2]+" < "+t[r-2]+` &&
            `+s[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+s+`);
        }
        setOutput(result);
      }
    `};function N0(n,e,t){var r=n.indexOf(e);return n.map((function(o,s){return s===r?o+" - "+t:o})).join()}var KX=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,o=n.padInfo.left,s=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+o+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+s+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},XX=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,o=n.strideWidth,s=n.dataFormat==="channelsLast",i=e-1-n.padInfo.top,a=t-1-n.padInfo.left,l=s?1:2,c=s?2:3,u=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+u+`];

        ivec2 dyCorner = ivec2(coords[`+l+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+s+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},YX=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,o=n.padInfo.front,s=n.padInfo.top,i=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+o+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+s+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+i+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},ZX=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,o=n.strideDepth,s=n.strideHeight,i=n.strideWidth,a=e-1-n.padInfo.front,l=t-1-n.padInfo.top,c=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+l+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+s+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},QX=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,o=n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+s+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+o+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},JX=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,o=n.strideWidth,s=e-1-n.padInfo.top,i=t-1-n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},lI=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.padInfo.top,s=n.padInfo.left,i=n.strideHeight,a=n.strideWidth,l=n.dilationHeight,c=n.dilationWidth,u=n.filterHeight,d=n.filterWidth,h=4*Math.floor(n.inChannels/4),p=n.inChannels%4,g=n.dataFormat==="channelsLast",x=g?1:2,y=g?2:3,b=g?3:1,C="",S="";t&&(C=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,S="result = activation(result);");var k=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+C+`

      const ivec2 strides = ivec2(`+i+", "+a+`);
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+b+`];

        ivec2 xRCCorner =
            ivec2(coords[`+x+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+h+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+g+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(p===1)+`) {

              if (`+g+`) {
                dotProd +=
                    getX(batch, xR, xC, `+h+`) *
                    getW(wR, wC, `+h+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+h+`, xR, xC) *
                    getW(wR, wC, `+h+`, d2);
              }

            } else if (`+(p===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2)
              );

              if (`+g+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(p===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2),
                getW(wR, wC, `+h+` + 2, d2)
              );

              if (`+g+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1),
                  getX(batch, xR, xC, `+h+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC),
                  getX(batch, `+h+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+k+`
        `+S+`
        setOutput(result);
      }
    `},eY=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,o=n.strideDepth,s=n.strideHeight,i=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,u=n.filterDepth,d=n.filterHeight,h=n.filterWidth,p=4*Math.floor(n.inChannels/4),g=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+s+", "+i+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+u+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+p+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(g===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+p+`) *
                  getW(wF, wR, wC, `+p+`, d2);
              } else if (`+(g===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(g===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1),
                  getX(batch, xF, xR, xC, `+p+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2),
                  getW(wF, wR, wC, `+p+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},cI=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.inHeight,s=n.inWidth,i=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,h=n.filterHeight,p=n.filterWidth,g=n.outChannels/n.inChannels,x="",y="";t&&(x=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,y="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+l+", "+c+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+g+`;
        int q = d2 - d1 * `+g+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+s+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+b+`
        `+y+`
        setOutput(result);
      }
    `},uI=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var o=n.inHeight,s=n.inWidth,i=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,h=n.filterHeight,p=n.filterWidth,g=p,x="int xR; int xC; int xCOffset;",y=0;y<h;y++)for(var b=0;b<p;b++)x+=`
          vec4 xTexelR`+y+"C"+2*b+` = vec4(0.);
          vec4 wR`+y+"C"+b+` = vec4(0.);
          vec4 xR`+y+"C"+b+" = vec4(0.);";for(y=0;y<h;y++)for(var C=0;C<g;C++){if(x+=`
          xR = xRCorner + `+y*u+`;
          xC = xCCorner + `+(b=2*C)*d+`;
        `,c===1){if(b<p&&(x+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+s+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+s+`) {
                    xTexelR`+y+"C"+b+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+s+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+s+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+y+"C"+b+" = vec4(previous.zw, xTexelR"+y+"C"+b+`.xy);
                } else {
                  xR`+y+"C"+b+" = vec4(0, 0, xTexelR"+y+"C"+b+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+s+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xR`+y+"C"+b+" = xTexelR"+y+"C"+b+`;
              `,b+1<p)){var S=a%2==0?hD(d):d;d%2==0&&a%2==1||d%2!=0&&a%2!=1?(x+=`
                  xCOffset = xC + `+a%2+" + "+S+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+s+`) {
                    xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(x+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+s+`) {
                      xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+y+"C"+b+` = vec4(0.);
                    }
                  `),x+=`
                  xR`+y+"C"+(b+1)+` = vec4(
                    xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.xy);
                `):x+=`
                  xCOffset = xC + `+S+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+s+`) {
                    xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+y+"C"+(b+1)+" = xTexelR"+y+"C"+(b+2)+`;
                `}}else b<p&&(x+=`
              if(xR >= 0 && xR < `+o+`) {
            `,a%2==1?(x+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+s+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+s+`) {
                  xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+y+"C"+(b+2)+` = vec4(0.);
                }

                xR`+y+"C"+b+` = vec4(
                  xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.zw);
              `,b+1<p&&(x+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+s+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+y+"C"+(b+1)+" = vec4(xTexelR"+y+"C"+(b+2)+`.xy, final.xy);
                `)):(x+=`
                if(xC >= 0 && xC < `+s+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+s+`) {
                  xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+(b+2)+` = vec4(0.);
                }

                xR`+y+"C"+b+` = vec4(
                  xTexelR`+y+"C"+b+".xy, xTexelR"+y+"C"+(b+2)+`.xy);
              `,b+1<p&&(x+=`
                  xR`+y+"C"+(b+1)+` = vec4(
                    xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.zw);
                `)),x+="}");b<p&&(x+=`
            vec4 wTexelR`+y+"C"+b+" = getW("+y+", "+b+`, d1, q);
            wR`+y+"C"+b+" = vec4(wTexelR"+y+"C"+b+".xz, wTexelR"+y+"C"+b+`.xz);
          `,b+1<p&&(x+=`
              vec4 wTexelR`+y+"C"+(b+1)+" = getW("+y+", "+(b+1)+`, d1, q);
              wR`+y+"C"+(b+1)+` =
                vec4(wTexelR`+y+"C"+(b+1)+".xz, wTexelR"+y+"C"+(b+1)+".xz);"))}for(y=0;y<h;y++)for(b=0;b<p;b++)x+="dotProd += xR"+y+"C"+b+" * wR"+y+"C"+b+";";var k="",N="";t&&(k=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,N="result = activation(result);");var E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+k+`

      const ivec2 strides = ivec2(`+l+", "+c+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+x+`

        vec4 result = dotProd;
        `+E+`
        `+N+`
        setOutput(result);
      }
    `},tY=function(n,e,t,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var s=n[0],i=n[1],a=n[2],l=n[3],c=e[0],u=t[0],d=t[1];this.outputShape=[c,u,d,l];var h=r==="bilinear"?1:0,p=[i-1+".0",a-1+".0"],g=p[0],x=p[1],y=u>1?[""+(i-1)/(u-1),"(y2-y1) * height_ratio","y1*"+g+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+g],b=y[0],C=y[1],S=y[2],k=d>1?[""+(a-1)/(d-1),"(x2-x1) * width_ratio","x1*"+x+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+x],N=k[0],E=k[1],_=k[2];this.userCode=`
      const float height_ratio = float(`+b+`);
      const float width_ratio = float(`+N+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+s+`) {
          return;
        }

        float height_scale = `+C+`;
        float width_scale = `+E+`;

        float in_y = `+S+`;
        if( in_y < 0.0 || in_y > `+g+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+_+`;
        if( in_x < 0.0 || in_x > `+x+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+h+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},nY=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=n[n.length-1],s=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Gn(r)+` coords = getOutputCoords();
        int end = `+dI(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+s+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+dI(r,"coords")+` = idx;
          val += getX(`+(function(i,a){if(i===1)return""+a;if(i===2)return a+".x, "+a+".y";if(i===3)return a+".x, "+a+".y, "+a+".z";if(i===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+i+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function dI(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var rY=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=am.DENSE;var e=qp(n),t=Go();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+rd(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},oY=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=am.DENSE;var e=qp(n),t=Go();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+rd(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},sY=(function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n})(),iY=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},aY=function(n){this.variableNames=["A"],this.outTexUsage=ei.DOWNLOAD;var e=Go();this.outputShape=n,this.userCode=`
      `+HD+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},lY=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ei.DOWNLOAD;var e=Go();this.outputShape=n,this.userCode=`
      `+HD+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},cY=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Go(),o=e[0],s=e[1];this.outputShape=n;var i="result";t&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      `+V4(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+s+`;
        int c = imod(flatIndex, `+s+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+s+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+i+`, 0., 0., 0.);
      }
    `},uY=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Go(),o=e[0],s=e[1];this.outputShape=n;var i="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var c=0;c<=1;c++){var u=2*l+c;i+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+n[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+l+" < "+n[1]+`) {
              localCoords[1] += `+l+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+s+`;
              c = imod(flatIndex, `+s+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+s+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+u+`] = values[0];
              } else if(offset == 1) {
                result[`+u+`] = values[1];
              } else if(offset == 2) {
                result[`+u+`] = values[2];
              } else {
                result[`+u+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+V4(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+i+`

        `+r.output+" = "+a+`;
      }
    `},dY="return real * expR - imag * expI;",hY="return real * expI + imag * expR;",hI=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,s=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+s+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},fY=(function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,o){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(t.valueLoc,e)}},n})(),pY=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var o=Gn(this.rank),s=(function(i,a){var l=i.length;if(l>4)throw Error("Gather for rank "+l+" is not yet supported");if(l===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],d=0;d<i.length;d++)d===a?u.push("int(getIndices("+c[d]+"))"):u.push(""+c[d]);return u.join()})(n,t);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+s+`));
      }
    `},mY=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=Gn(e.length),o=Gn(t.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+s+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function gY(n,e){var t=Go();return dK(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function xY(n,e){return gK(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function vY(n,e){return xK(n,e,new Uint16Array([0,1,2,2,1,3]))}function $m(n,e,t,r,o,s,i){yK(t,r);var a=vK(n,e),l=n.TEXTURE_2D;return wt(n,e,(function(){return n.bindTexture(l,a)})),wt(n,e,(function(){return n.texParameteri(l,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)})),wt(n,e,(function(){return n.texParameteri(l,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)})),wt(n,e,(function(){return n.texParameteri(l,n.TEXTURE_MIN_FILTER,n.NEAREST)})),wt(n,e,(function(){return n.texParameteri(l,n.TEXTURE_MAG_FILTER,n.NEAREST)})),wt(n,e,(function(){return n.texImage2D(l,0,o,t,r,0,s,i,null)})),wt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)})),a}function yY(n,e,t,r,o){var s=Fv(t,r);return $m(n,e,s[0],s[1],o.internalFormatFloat,o.textureFormatFloat,n.FLOAT)}function bY(n,e,t,r,o){var s=Fv(t,r);return $m(n,e,s[0],s[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function wY(n,e,t,r,o){var s=Fv(t,r);return $m(n,e,s[0],s[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function CY(n,e,t,r,o){var s=_m(t,r);return $m(n,e,s[0],s[1],o.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function kY(n,e,t,r,o){var s=_m(t,r);return $m(n,e,s[0],s[1],o.internalFormatPackedHalfFloat,n.RGBA,o.textureTypeHalfFloat)}function SY(n,e,t,r){return wt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),JN(n,e,t,"clipSpacePos",r,3,20,0)&&JN(n,e,t,"uv",r,2,20,12)}function NY(n,e,t,r,o,s,i){var a,l,c;wt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),s instanceof Uint8Array?(a=new Uint8Array(r*o*4),l=n.UNSIGNED_BYTE,c=n.RGBA):(a=new Float32Array(r*o*4),l=n.FLOAT,c=i.internalFormatPackedFloat),a.set(s),wt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,c,r,o,0,n.RGBA,l,a)})),wt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function IY(n,e,t,r){wt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),r.data instanceof Uint8Array?wt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)})):wt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)})),wt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function EY(n,e,t,r,o){var s=n.createBuffer();wt(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,s)}));var i=16*t*r;return wt(n,e,(function(){return n.bufferData(n.PIXEL_PACK_BUFFER,i,n.STREAM_READ)})),wt(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)})),wt(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)})),s}function TY(n,e,t){var r=n,o=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function RY(n,e,t,r,o){var s=Fv(t,r),i=s[0],a=s[1],l=new Uint8Array(t*r*4);return wt(n,e,(function(){return n.readPixels(0,0,i,a,o.downloadTextureFormat,n.UNSIGNED_BYTE,l)})),new Float32Array(l.buffer)}function DY(n,e,t,r,o,s,i,a){var l=n,c=new Float32Array((function(u,d){var h=_m(u,d);return h[0]*h[1]*4})(s,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function AY(n,e,t,r){var o=new Float32Array(t*r*4);return wt(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,o)})),o}var _Y=(function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Ae().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,iK(t,e)):this.gl=gl(t);var r="WEBGL_color_buffer_float";if(Ae().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=w0(this.gl,this.debug,"OES_texture_float"),Ri(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=w0(this.gl,this.debug,"OES_texture_half_float");else if(Ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Ri(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=w0(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Ri(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Ri(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=xY(this.gl,this.debug),this.indexBuffer=vY(this.gl,this.debug),this.framebuffer=bK(this.gl,this.debug),this.textureConfig=A4(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return Ae().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;wt(t,this.debug,(function(){return t.finish()})),wt(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),wt(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),wt(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),wt(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),wt(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),yY(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),bY(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),wY(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),IY(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,o){this.throwIfDisposed(),NY(this.gl,this.debug,e,t,r,o,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),kY(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),CY(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(eI(this.gl,this.debug,this.framebuffer),this.outputTexture=null),wt(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var o=this;return this.downloadMatrixDriver(e,(function(){return RY(o.gl,o.debug,t,r,o.textureConfig)}))},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,o,s,i){return DY(this.gl,e,0,0,0,s,i,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return TY(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var o=EY(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,o=this;if(Ae().getBool("WEBGL_FENCE_API_ENABLED")){var s=e,i=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=s.clientWaitSync(i,0,0);return a===s.ALREADY_SIGNALED||a===s.CONDITION_SATISFIED},t=i}else Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(t,Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var o=this;return this.downloadMatrixDriver(e,(function(){return AY(o.gl,o.debug,t,r)}))},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=hK(t,this.debug,e),o=gY(t,this.debug),s=pK(t,this.debug);return wt(t,this.debug,(function(){return t.attachShader(s,o)})),wt(t,this.debug,(function(){return t.attachShader(s,r)})),mK(t,this.debug,s),this.debug&&Hw(t,this.debug,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=SY(t,this.debug,this.program,this.vertexBuffer)),s},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&wt(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Hw(this.gl,this.debug,this.program),wt(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?CK(this.gl,this.debug,e,t):kK(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),wt(this.gl,this.debug,(function(){return r.gl.getAttribLocation(e,t)}))},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),SK(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var o=_m(t,r),s=o[0],i=o[1];this.setOutputMatrixTextureDriver(e,s,i)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,o){this.setOutputMatrixWriteRegionDriver(r,e,o,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&Hw(this.gl,this.debug,this.program),C0(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),wt(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),wt(this.gl,this.debug,(function(){return e.gl.finish()}))},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=w0(this.gl,this.debug,Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),s=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,s),s},n.prototype.endQuery=function(){if(Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return pt(this,void 0,void 0,(function(){var t=this;return mt(this,(function(r){switch(r.label){case 0:return[4,qN((function(){return t.disposed||t.isQueryAvailable(e,Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(e,Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(e,o.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),s&&!this.disjoint}return s=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),s&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return r()}))}))},n.prototype.pollItems=function(){for(var e=(function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1})(this.itemsToPoll.map((function(r){return r.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||qN((function(){return r.pollItems(),r.itemsToPoll.length===0}))},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Gw(this.gl,this.debug,e,this.framebuffer),this.debug&&C0(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Gw(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&C0(this.gl)):eI(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var o=this.gl;Gw(o,this.debug,e,this.framebuffer),this.debug&&C0(o),this.outputTexture=e,wt(o,this.debug,(function(){return o.viewport(0,0,t,r)})),wt(o,this.debug,(function(){return o.scissor(0,0,t,r)}))},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,o){var s=this;this.throwIfDisposed(),wt(this.gl,this.debug,(function(){return s.gl.scissor(e,t,r,o)}))},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n})();function fI(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach((function(t,r){var o=t.logicalShape,s=e[r],i=s.shape;if(!uo(o,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+i+" must match");if(!t.isUniform||!s.isUniform){var a=t.texShape,l=s.isUniform?null:s.texData.texShape;if(!uo(a,l))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+l+" must match")}}))}var $Y=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,o=t.inChannels,s=t.strideWidth,i=t.strideHeight,a=t.padInfo,l=t.outWidth,c=t.dilationWidth,u=t.dilationHeight,d=t.dataFormat,h=a.left,p=a.top,g=o*r,x=Go(),y=d==="channelsLast",b=y?0:1,C=y?1:2,S="",k=0;k<=1;k++)for(var N=0;N<=1;N++)S+=`
          blockIndex = rc.y + `+N+`;
          pos = rc.x + `+k+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+l+")) * "+i+" - "+p+`;
            d0 = offsetY + `+u+" * (pos / "+g+`);

            if(d0 < `+e[b]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+l+".) * "+s+". - "+h+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+g+".) / "+o+`.));

              if(d1 < `+e[C]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+y+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*k+N)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*k+N)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+S+`

        `+x.output+` = result;
      }
    `},FY=function(n,e,t,r,o){this.variableNames=["x"],this.outputShape=[];var s,i=e,a=n[3]-1;this.outputShape=n;var l="float("+t+") + float("+r+") * sum";s=o===.5?"inversesqrt("+l+")":o===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+i+"; j <= "+i+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+s+`;
        setOutput(val);
      }
    `},PY=function(n,e,t,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},MY=function(n,e,t,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var s,i=e,a=n[3]-1;this.outputShape=n;var l="float("+t+") + float("+r+") * sum";s=o===.5?"inversesqrt("+l+")":o===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+i+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+i+"; j <= "+i+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+s+`;
        setOutput(result);
      }
    `},OY=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,o=n.effectiveFilterHeight,s=n.effectiveFilterWidth,i=o-1-n.padInfo.top,a=s-1-n.padInfo.left,l=o*s-1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+s+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+s+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},LY=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,o=n.dilationDepth,s=n.dilationHeight,i=n.dilationWidth,a=n.effectiveFilterDepth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=a-1-n.padInfo.front,d=l-1-n.padInfo.top,h=c-1-n.padInfo.left,p=a*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+d+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+a+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+l+`;
              wR += `+s+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+i+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+p+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+l+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Zw=function(n,e,t,r,o,s,i){t===void 0&&(t=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),s===void 0&&(s=null),i===void 0&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var a=t?n[1]:n[2],l=Math.ceil(a/2),c=t?"i * 2, rc.y":"rc.y, i * 2",u=r?"rc.z, i * 2":"i * 2, rc.z",d=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",g="";s&&(p=i?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+s+`
        }`:`vec4 activation(vec4 x) {
          `+s+`
        }`,g="result = activation(result);");var x=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+p+`

      const float sharedDimension = `+l+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+l+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+u+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+h[0]+`);
          result += (`+d[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+x+`

        `+g+`

        setOutput(result);
      }
    `},BY=(function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,o){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n})(),jY=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},VY=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=_s("rc",e),r=Gn(e),o=(function(a,l,c){if(a===1)return"rc > "+l[0];for(var u="",d=a-2;d<a;d++)u+=c[d]+" >= "+l[d],d<a-1&&(u+="||");return u})(e,n,t),s=(function(a,l,c,u){if(a===1)return"";var d=u.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+l+`;
    bool rEdge = rp1 >= `+c+`;
  `})(e,n[n.length-1],n[n.length-2],t),i=(function(a,l){var c=a.length,u=(function(d,h){for(var p=[],g=0;g<=1;g++)for(var x=0;x<=1;x++){for(var y=(g===0?"r":"rp1")+", "+(x===0?"c":"cp1"),b=2;b<d;b++)y=h[h.length-1-b]+","+y;p.push(y)}return p})(c,l);return c===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+u[0]+`),
          cEdge ? 0. : getA(`+u[1]+`),
          rEdge ? 0. : getA(`+u[2]+`),
          rEdge || cEdge ? 0. : getA(`+u[3]+")"})(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+s+`

            setOutput(vec4(`+i+`));
          }
        }
      `}},zY=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map((function(l,c){return l[0]+n[c]+l[1]}));var r=n.length,o=Gn(r),s=e.map((function(l){return l[0]})).join(","),i=e.map((function(l,c){return l[0]+n[c]})).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+s+`);
      `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+s+`;
        int end = `+i+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},WY=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(y,b){return y[0]+n[b]+y[1]}));for(var r=n.length,o=Gn(r),s=e.map((function(y){return y[0]})).join(","),i=e.map((function(y,b){return y[0]+n[b]})).join(","),a=_s("rc",r),l=_s("source",r),c=a[r-1]+" < "+this.outputShape[r-1],u=r===1?"source":"vec2("+l.slice(-2).join()+")",d=[o+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+c+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+c+") {"],h=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",g=0,x=r===1?2:4;g<x;g++)p+=`
        `+d[g]+`
        if (`+h+`) {
          result[`+g+"] = float("+t+`);
        } else {
          `+o+` source = rc - start;
          result[`+g+"] = getChannel(getX("+l.join()+"), "+u+`);
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+s+`);
      const `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+p+`
        setOutput(result);
      }
    `},Qw=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,o=n.strideHeight,s=n.strideWidth,i=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=n.padInfo.top,d=n.padInfo.left;this.outputShape=n.outShape;var h=e==="avg",p="0.0";if(h||(p="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+s+`);
        const ivec2 pads = ivec2(`+u+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+l+`;
              wR += `+i+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var g=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(g="avgValue / count");var x=4*Math.floor(r/4),y=r%4,b=`
      if (`+h+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+s+`);
      const ivec2 pads = ivec2(`+u+", "+d+`);
      const float initializationValue = `+p+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+p+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+l+`;
            wR += `+i+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+x+`; wC += 4) {
            int xC = xCCorner + wC * `+a+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              getValue(batch, xR, xC + 3 * `+a+`, d)
            );

            `+b+`
          }

          int xC = xCCorner + `+x+`;
          if (`+(y===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+b+`
          } else if (`+(y===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              initializationValue,
              initializationValue
            );

            `+b+`
          } else if (`+(y===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              initializationValue
            );

            `+b+`
          }
        }
        setOutput(`+g+`);
      }
    `}},Jw=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,o=n.strideDepth,s=n.strideHeight,i=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterDepth,d=n.effectiveFilterHeight,h=n.effectiveFilterWidth,p=n.padInfo.front,g=n.padInfo.top,x=n.padInfo.left;this.outputShape=n.outShape;var y=e==="avg",b="0.0";if(y||(b="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+s+", "+i+`);
        const ivec3 pads = ivec3(`+p+", "+g+", "+x+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+u+`;
              wD += `+a+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+l+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+h+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+h+` +
                      wR * `+h+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var C=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(C="avgValue / count");var S=4*Math.floor(r/4),k=r%4,N=`
      if (`+y+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+s+", "+i+`);
      const ivec3 pads = ivec3(`+p+", "+g+", "+x+`);
      const float initializationValue = `+b+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+b+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+u+`;
            wD += `+a+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+S+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+N+`
            }

            int xC = xCCorner + `+S+`;
            if (`+(k===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+N+`
            } else if (`+(k===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+N+`
            } else if (`+(k===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+N+`
            }
          }
          setOutput(`+C+`);
        }
      }
    `}},UY=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,o=n.inSize,s=Math.ceil(o/t);this.outputShape=[r,s];var i="0.0",a="";e==="prod"?i="1.0":e==="min"?(i="1.0 / 1e-20",a="min"):e==="max"&&(i="-1.0 / 1e-20",a="max");var l=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?l="sumValue":e==="prod"?l="prodValue":e==="all"?l="allValue":e==="any"&&(l="anyValue");var c=4*Math.floor(t/4),u=t%4,d=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,h="vec4";e==="all"?(i="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):e==="any"&&(i="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");var p="";o%t>0&&(p=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+i+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+i+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(u===1)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(u===2)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(u===3)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+l+`);
      }
    `},HY=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),t+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+rd(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+V4(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},GY=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],s=r[2],i=n.shape,a=i[1],l=i[2],c=[t&&a>1?o-1:o,t&&l>1?s-1:s],u=[t&&a>1?a-1:a,t&&l>1?l-1:l],d=c[0]/u[0],h=c[1]/u[1],p=1/d,g=1/h,x=2*Math.ceil(p)+2,y=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(s-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},qY=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var o=n[0],s=n[1],i=n[2],a=n[3];this.outputShape=[o,e,t,a];var l=[r&&e>1?s-1:s,r&&t>1?i-1:i],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/c[0]+`,
          `+l[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+s+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},KY=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=n[0],s=n[1],i=n[2],a=n[3];this.outputShape=[o,e,t,a];var l=[r&&e>1?s-1:s,r&&t>1?i-1:i],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+l[0]/c[0]+`,
          `+l[1]/c[1]+`,
          `+l[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+s+".0, "+i+`.0,
                                     `+i+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},XY=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],s=r[2],i=n.shape,a=i[1],l=i[2],c=[t&&a>1?o-1:o,t&&l>1?s-1:s],u=[t&&a>1?a-1:a,t&&l>1?l-1:l],d=c[0]/u[0],h=c[1]/u[1],p=1/d,g=1/h,x=2*Math.ceil(p)+2,y=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+u[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+u[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+s+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},YY=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var o=n[0],s=n[1],i=n[2],a=n[3];this.outputShape=[o,e,t,a];var l=[r&&e>1?s-1:s,r&&t>1?i-1:i],c=[r&&e>1?e-1:e,r&&t>1?t-1:t],u=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/c[0]+`,
          `+l[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+s+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+u+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},ZY=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map((function(s,i){return(function(a){return e.indexOf(a)!==-1&&n[a]!==1?n[a]+" - coords["+a+"] - 1":"coords["+a+"]"})(i)})).join(","),o=Gn(t);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},QY=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=_s("rc",t),o=r[t-1]+" + 1 < "+this.outputShape[t-1],s=r[t-2]+" + 1 < "+this.outputShape[t-2],i=Gn(t);function a(l){var c=n.map((function(u,d){return(function(h,p){return e.indexOf(h)!==-1&&n[h]!==1?n[h]+" - "+p[h]+" - 1":""+p[h]})(d,l)}));return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+i+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(l){return a(l)})(r.slice())+`;
          if(`+o+`){
            result.g = `+(function(l){return l[t-1]="("+l[t-1]+" + 1)",a(l)})(r.slice())+`;
          }
          if(`+s+`) {
            result.b = `+(function(l){return l[t-2]="("+l[t-2]+" + 1)",a(l)})(r.slice())+`;
            if(`+o+`) {
              result.a = `+(function(l){return l[t-1]="("+l[t-1]+" + 1)",l[t-2]="("+l[t-2]+" + 1)",a(l)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},pI=function(n,e,t,r,o,s,i){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;var a=Gn(o.length),l=Gn(s.length),c="";t===1?c="i":t===2&&(c="i, j");var u="getIndices("+c+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var h="getUpdates("+d+")",p=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+o+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+u+`);
              flattenedIndex += index * `+p+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+h+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},JY=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,o=n.inSize,s=n.numSegments,i=s*Math.ceil(o/t);this.outputShape=[r,i];var a=4*Math.floor(t/4),l=t%4,c=`
        sumValue += dot(values, segFilter);
    `,u="";o%t>0&&(u=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var d="";o%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+u+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+s+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+s+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(l===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(l===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(l===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},eZ=function(n,e,t){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)o="resRC",r="resRC";else{for(var s=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=[],l=0;l<e.length;l++)a.push(""+s[l]),l<n&&i.push(""+s[l]);r=i.join(),o=a.join()}var c=Gn(t);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},tZ=(function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=Gn(this.rank),o="uniform int start["+this.rank+"];",s=(function(i){if(i===1)return"sourceLoc";if(i<=6)return e3.slice(0,i).map((function(a){return"sourceLoc."+a})).join(",");throw Error("Slicing for rank "+i+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map((function(i,a){return"sourceLoc."+e3[a]+" = start["+a+"] + coords."+e3[a]+";"})).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+t+`
        setOutput(getSource(`+s+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,o){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),e3=["x","y","z","w","u","v"],nZ=(function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Gn(this.rank),r=_s("coords",this.rank),o=_s("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",i="getChannel(getSource("+o.join()+"), "+s+")",a=`
      result.x = `+i+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+i+`;
        --`+o[this.rank-1]+`;
      }
    `,l=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+i+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+i+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map((function(u,d){return"start["+d+"]"})).join()+");":e.map((function(u,d){return o[d]+" = "+r[d]+" + start["+d+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+a+`
        `+l+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,o){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),rZ=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=Gn(t.length),s=Gn(t.length),i="";if(r===1)i="coords * strides + begin";else{var a=0;i=t.map((function(l,c){return a++,t.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(a-1)+"] * strides["+c+"] + begin["+c+"]"})).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+n+`);
      `+o+" strides = "+o+"("+e+`);

      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+i+`));
      }
    `},oZ=(function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var o,s=mI(t,r),i=gI(e,s,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),s===Qs.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===Qs.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===Qs.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===Qs.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===Qs.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(o),o},n.prototype.releaseTexture=function(e,t,r,o){if(this.freeTextures!=null){var s=gI(t,mI(r,o),o);s in this.freeTextures||(this.freeTextures[s]=[]),this.freeTextures[s].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[s],a=i.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(r){e.gpgpu.deleteMatrixTexture(r)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(o){e.gpgpu.deleteMatrixTexture(o)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n})();function mI(n,e){if(n===ei.UPLOAD)return Qs.PACKED_2X2_FLOAT32;if(n===ei.RENDER||n==null)return(function(t){return Ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Qs.PACKED_2X2_FLOAT32:Qs.UNPACKED_FLOAT32:t?Qs.PACKED_2X2_FLOAT16:Qs.UNPACKED_FLOAT16})(e);if(n===ei.DOWNLOAD||n===ei.PIXELS)return Qs.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function gI(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var sZ=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var o=Gn(this.rank),s=(function(i){var a=i.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+i[0]+")";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],u=0;u<i.length;u++)c.push("imod("+l[u]+", "+i[u]+")");return c.join()})(n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+s+`));
      }
    `},iZ=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var o=Gn(this.rank),s=(function(i){var a=i.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(a),u=0;u<i.length;u++)c[i[u]]=l[u];return c.join()})(e);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+s+`));
    }
    `},aZ=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Gn(this.rank),s=UD("rc",this.rank),i=new Array(this.rank);for(r=0;r<e.length;r++)i[e[r]]=s[r];var a="vec2("+i.slice(-2).join()+")",l="++"+s[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+i.join()+"), "+a+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+l+`) {
        result[1] = `+c+`;
      }
      --`+s[this.rank-1]+`;
      if(++`+s[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+l+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},z4=1.7580993408473768,W4=1.0507009873554805,Xt=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},va="if (isnan(x)) return x;",lZ="return x;",xI="return abs(x);",XD=va+`
  return (x < 0.0) ? 0.0 : x;
`,YD=va+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ZD="return (x >= 0.0) ? x : (exp(x) - 1.0);",cZ=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+z4+`;
  float scale = `+W4+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,vI="return -x;",yI="return ceil(x);",bI="return floor(x);",wI="return exp(x);",CI="return exp(x) - 1.0;",uZ=va+`
  return sin(x);
`,dZ=va+`
  return cos(x);
`,hZ=va+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,fZ=va+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,pZ=va+`
  return atan(x);
`,mZ=va+"return log(x + sqrt(x * x + 1.0));",gZ=va+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,xZ=va+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,I0="return x;",vZ="return x;",QD=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,JD=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,eA=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ap=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},yZ=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=_s("rc",e),r=Gn(e),o=(function(a,l){if(a===1)return"rc";for(var c="",u=0;u<a;u++)c+=l[u],u<a-1&&(c+=",");return c})(e,t),s=t.slice(-2),i=e<=1?"rc":"vec2("+s.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+i+`));
      }
    `},E0={};function T0(n,e){if(e===void 0&&(e=!1),n==="linear")return e?vZ:lZ;if(n==="relu")return e?QD:XD;if(n==="elu")return e?eA:ZD;if(n==="relu6")return e?JD:YD;if(n==="prelu")return e?KD:qD;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var bZ=600,wZ=(function(n){function e(t){var r,o=n.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!Ae().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var s=gl(Ae().getNumber("WEBGL_VERSION"));o.binaryCache=((r=Ae().getNumber("WEBGL_VERSION"))in E0||(E0[r]={}),E0[r]),o.gpgpu=new _Y(s),o.canvas=s.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=t,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=t.gl.canvas;return o.textureManager=new oZ(o.gpgpu),o.numMBBeforeWarning=Ae().global.screen==null?1024:Ae().global.screen.height*Ae().global.screen.width*window.devicePixelRatio*bZ/1024/1024,o.texData=new PD(o,ce),o}return xa(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,o){if(Ae().getBool("DEBUG")&&this.checkNumericalProblems(t),o==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var s={};return this.texData.set(s,{shape:r,dtype:o,values:t,usage:ei.UPLOAD}),s},e.prototype.move=function(t,r,o,s){if(Ae().getBool("DEBUG")&&this.checkNumericalProblems(r),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:o,dtype:s,values:r,usage:ei.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),o=r.values,s=r.dtype,i=r.complexTensors,a=r.slice,l=r.shape,c=r.isPacked;if(a!=null){var u=void 0;u=c?new Ap(l,I0):new Xt(l,I0);var d=this.runWebGLProgram(u,[{dataId:t,shape:l,dtype:s}],s),h=this.readSync(d.dataId);return this.disposeData(d.dataId),h}if(o!=null)return this.convertAndCacheOnCPU(t);if(s==="string")return o;var p,g,x=this.activeTimers!=null;return x&&(p=za()),s==="complex64"?g=hC(i.real.dataSync(),i.imag.dataSync()):g=this.getValuesFromTexture(t),x&&(this.downloadWaitMs+=za()-p),this.convertAndCacheOnCPU(t,g)},e.prototype.read=function(t){return pt(this,void 0,void 0,(function(){var r,o,s,i,a,l,c,u,d,h,p,g,x,y,b,C,S,k,N,E,_,$;return mt(this,(function(T){switch(T.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise((function(D){return r.push(D)}))];if(o=this.texData.get(t),s=o.values,i=o.shape,a=o.slice,l=o.dtype,c=o.complexTensors,u=o.isPacked,a!=null)return d=void 0,d=u?new Ap(i,I0):new Xt(i,I0),h=this.runWebGLProgram(d,[{dataId:t,shape:i,dtype:l}],l),p=this.read(h.dataId),this.disposeData(h.dataId),[2,p];if(s!=null)return[2,this.convertAndCacheOnCPU(t)];if(!Ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ae().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return g=null,l!=="complex64"&&Ae().get("WEBGL_BUFFER_SUPPORTED")&&(x=this.decode(t),y=this.texData.get(x.dataId),g=($=this.gpgpu).createBufferFromTexture.apply($,[y.texture].concat(qp(i)))),this.pendingRead.set(t,[]),l==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:T.sent(),T.label=2;case 2:return l!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return C=T.sent(),S=C[0],k=C[1],b=hC(S,k),[3,5];case 4:g==null?b=this.getValuesFromTexture(t):(N=yt(i),b=this.gpgpu.downloadFloat32MatrixFromBuffer(g,N)),T.label=5;case 5:return x!=null&&this.disposeData(x.dataId),E=this.convertAndCacheOnCPU(t,b),_=this.pendingRead.get(t),this.pendingRead.delete(t),_.forEach((function(D){return D(E)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,E]}}))}))},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var o=t[r];if(!cK(o))throw Ae().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,o=this.texData.get(t),s=o.shape,i=o.dtype,a=o.isPacked,l=yt(s);if(Ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),u=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[u.texture].concat(qp(s))).subarray(0,l);return this.disposeData(c.dataId),d}var h=Ae().getBool("WEBGL_PACK")&&a===!0,p=h?qw(s):s,g=h?new lY(p):new aY(p),x=this.runWebGLProgram(g,[{shape:p,dtype:i,dataId:t}],"float32"),y=this.texData.get(x.dataId),b=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,l);return this.disposeData(x.dataId),b},e.prototype.time=function(t){return pt(this,void 0,void 0,(function(){var r,o,s,i,a,l,c;return mt(this,(function(u){switch(u.label){case 0:return r=this.activeTimers,o=[],s=!1,this.programTimersStack==null?(this.programTimersStack=o,s=!0):this.activeTimers.push(o),this.activeTimers=o,t(),i=cf(this.activeTimers.map((function(d){return d.query}))).filter((function(d){return d!=null})),a=cf(this.activeTimers.map((function(d){return d.name}))).filter((function(d){return d!=null})),this.activeTimers=r,s&&(this.programTimersStack=null),l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return c=u.sent(),l.kernelMs=Wq(c),l.getExtraProfileInfo=function(){return c.map((function(d,h){return{name:a[h],ms:d}})).map((function(d){return d.name+": "+d.ms})).join(", ")},[3,3];case 2:l.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:za(),endMs:null}},e.prototype.endTimer=function(t){return Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=za(),t)},e.prototype.getQueryTime=function(t){return pt(this,void 0,void 0,(function(){var r;return mt(this,(function(o){return Ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),o=r.texture,s=r.dtype,i=r.texShape,a=r.usage,l=r.isPacked,c=r.slice,u=c&&c.origDataId||t,d=this.dataRefCount.get(u);d>1?this.dataRefCount.set(u,d-1):(this.dataRefCount.delete(u),o!=null&&(this.numBytesInGPU-=this.computeBytes(i,s),this.textureManager.releaseTexture(o,i,a,l)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return Ae().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=ce.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every((function(s){return o.texData.get(s.dataId).texture==null&&s.size<r}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var o=this.makeOutput(t.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:ce.keep(t.clone()),imag:ce.keep(r.clone())},o},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,o);if(yt(o)===0)return Io([],o,t.dtype);var s=this.texData.get(t.dataId).isPacked,i=$D(t.shape,r,o);if(s||!i){var a=Ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nZ(o):new tZ(o),l=a.getCustomSetupFunc(r);return this.compileAndRun(a,[t],null,l)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,o)},e.prototype.shallowSlice=function(t,r,o){var s=this.texData.get(t.dataId),i=this.makeOutput(o,t.dtype),a=this.texData.get(i.dataId);Object.assign(a,s),a.shape=o,a.dtype=t.dtype;var l=FD(r,t.strides);s.slice&&(l+=s.slice.flatOffset),a.slice={flatOffset:l,origDataId:s.slice&&s.slice.origDataId||t.dataId};var c=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,c+1),i},e.prototype.stridedSlice=function(t,r,o,s){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,o,s);var i=M4(r,o,s);if(i.some((function(l){return l===0})))return Io([],i);var a=new rZ(r,s,i);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,r){var o=Ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new QY(t.shape,r):new ZY(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var o=t.map((function(p){return Ei(p)})),s=t.map((function(p){return Ka(p)}));return So(this.concat(o,r),this.concat(s,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>Ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(t.length/2),a=this.concat(t.slice(0,i),r),l=this.concat(t.slice(i),r);return this.concat([a,l],r)}if(Ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var c=new qX(t.map((function(p){return p.shape})),r);return this.compileAndRun(c,t)}var u=df(t.map((function(p){return p.shape})),r),d=t.map((function(p){return p.as2D(-1,yt(p.shape.slice(r)))})),h=new GX(d.map((function(p){return p.shape})));return this.compileAndRun(h,d).reshape(u)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,vI,t.dtype);var r=new Xt(t.shape,vI);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,o,s){var i=o?t.shape[2]:t.shape[1],a=s?r.shape[1]:r.shape[2],l=o?t.shape[1]:t.shape[2],c=t.shape[0];if((i===1||a===1)&&l>1e3){o&&(t=t.transpose([0,2,1])),s&&(r=r.transpose([0,2,1]));var u=a===1?t:t.as3D(c,l,1),d=a===1?2:1,h=a===1?r.as3D(c,1,l):r;return this.multiply(u,h).sum(d,!0)}var p=No(t.dtype,r.dtype),g=new Zw(t.shape,[c,i,a],o,s);return this.compileAndRun(g,[t,r],p)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,o=t.b,s=t.transposeA,i=t.transposeB,a=t.bias,l=t.activation,c=t.preluActivationWeights,u=s?r.shape[2]:r.shape[1],d=i?o.shape[1]:o.shape[2],h=r.shape[0],p=No(r.dtype,o.dtype),g=a!=null,x=c!=null,y=l?T0(l,!0):null,b=new Zw(r.shape,[h,u,d],s,i,g,y,x),C=[r,o];return a&&C.push(a),c&&C.push(c),this.compileAndRun(b,C,p)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var o=this.texData.get(t.dataId),s=this.texData.get(r.dataId),i=new iI(VX,t.shape,r.shape),a=new iI(zX,t.shape,r.shape),l=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,s.complexTensors.real),this.makeComplexComponentTensorInfo(r,s.complexTensors.imag)],c=this.compileAndRun(i,l),u=this.compileAndRun(a,l),d=this.complex(c,u);return c.dispose(),u.dispose(),d}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,aI,t.dtype);var h=new pr(aI,t.shape,r.shape);return this.compileAndRun(h,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,o,s,i,a){var l=[t,r,o],c=null;a!=null&&(c=a.shape,l.push(a));var u=null;if(i!=null&&(u=i.shape,l.push(i)),Ae().getBool("WEBGL_PACK_NORMALIZATION")){var d=new jX(t.shape,r.shape,o.shape,c,u,s);return this.compileAndRun(d,l)}var h=new BX(t.shape,r.shape,o.shape,c,u,s);return this.compileAndRun(h,l)},e.prototype.localResponseNormalization4D=function(t,r,o,s,i){var a=Ae().getBool("WEBGL_PACK_NORMALIZATION")?new MY(t.shape,r,o,s,i):new FY(t.shape,r,o,s,i);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,r,o,s,i,a,l){var c=new PY(r.shape,s,i,a,l);return this.compileAndRun(c,[r,o,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var o=this.readSync(t.dataId).map((function(i){return bx(i)}));return zD(Wt(t.shape,t.dtype,o),r)}var s=new sZ(t.shape,r);return this.compileAndRun(s,[t])},e.prototype.pad=function(t,r,o){var s=Ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new WY(t.shape,r,o):new zY(t.shape,r,o);return this.compileAndRun(s,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var o=Ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aZ(t.shape,r):new iZ(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.gather=function(t,r,o){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,o);var s=new pY(t.shape,r.size,o);return this.compileAndRun(s,[t,r])},e.prototype.batchToSpaceND=function(t,r,o){Y(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=r.reduce((function(d,h){return d*h})),i=Ix(t.shape,r,s),a=Ex(i.length,r.length),l=Tx(t.shape,r,s),c=RD(o,r.length),u=DD(l,o,r.length);return t.reshape(i).transpose(a).reshape(l).slice(c,u)},e.prototype.spaceToBatchND=function(t,r,o){Y(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=r.reduce((function(h,p){return h*p})),i=[[0,0]];i.push.apply(i,o);for(var a=1+r.length;a<t.shape.length;++a)i.push([0,0]);var l=t.pad(i),c=Ix(l.shape,r,s,!1),u=Ex(c.length,r.length,!1),d=Tx(l.shape,r,s,!1);return l.reshape(c).transpose(u).reshape(d)},e.prototype.reduce=function(t,r,o){var s=t.shape[0],i=t.shape[1],a=Kw(i),l=new UY({windowSize:a,inSize:i,batchSize:s},r),c=this.compileAndRun(l,[t],o);return c.shape[1]===1?c:this.reduce(c,r,o)},e.prototype.argReduce=function(t,r,o){o===void 0&&(o=null);var s=t.shape[0],i=t.shape[1];o!=null&&(s=o.shape[0],i=o.shape[1]);var a=Kw(i),l=new DX({windowSize:a,inSize:i,batchSize:s},r,o==null),c=[t];o!=null&&c.push(o);var u=this.compileAndRun(l,c,"int32");return u.shape[1]===1?u:this.argReduce(t,r,u)},e.prototype.argReducePacked=function(t,r,o){o===void 0&&(o=null);var s=o!=null?o.shape:t.shape,i=Kw(s[s.length-1]),a=new MX(s,i,r,o==null),l=o==null?[t]:[t,o],c=this.compileAndRun(a,l,"int32");return c.rank===t.rank?this.argReducePacked(t,r,c):c},e.prototype.sum=function(t,r){Ys("sum",r,t.rank);var o=zo(t.shape,r),s=o[0],i=yt(o[1]),a=t.as2D(-1,i),l=jw(t.dtype);return this.reduce(a,"sum",l).reshape(s)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var o=zo(t.shape,r),s=o[0],i=yt(o[1]),a=t.as2D(-1,i),l=jw(t.dtype);return this.reduce(a,"prod",l).reshape(s)},e.prototype.unsortedSegmentSum=function(t,r,o){var s=0,i=xl([s],t.rank),a=t;i!=null&&(a=t.transpose(i),s=vl(1,t.rank)[0]);var l=(function(p,g,x){for(var y=[],b=p.length,C=0;C<b;C++)C!==g?y.push(p[C]):y.push(x);return y})(a.shape,s,o),c=yt([a.shape[s]]),u=a.as2D(-1,c),d=jw(t.dtype),h=this.segOpCompute(u,"unsortedSegmentSum",r,d,o).reshape(l);return i!=null&&(h=h.transpose(_4(i))),h},e.prototype.segOpCompute=function(t,r,o,s,i){var a=t.shape[0],l=t.shape[1],c=(function(h,p){var g,x=!1;for(h<=_D?(g=h,x=!0):g=rC(h,Math.floor(Math.sqrt(h)));!x;)g>p||g===h?x=!0:g=rC(h,g+1);return g})(l,i),u=new JY({windowSize:c,inSize:l,batchSize:a,numSegments:i}),d=this.compileAndRun(u,[t,o],s);return d.shape[1]===i?d:(o=Nx(0,i).tile([l/c]),this.segOpCompute(d,r,o,s,i))},e.prototype.argMinMaxReduce=function(t,r,o){var s=[r];if(Ys("arg"+o.charAt(0).toUpperCase()+o.slice(1),s,t.rank),!Ae().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var i=zo(t.shape,s),a=i[0],l=yt(i[1]),c=t.as2D(-1,l);return this.argReduce(c,o).reshape(a)}return this.argReducePacked(t,o)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,o,s){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var i=new nY(t.shape,o,s);return this.compileAndRun(i,[t])},e.prototype.equal=function(t,r){if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var o=new pr("return float(a == b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new pr("return float(a != b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new pr("return float(a < b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new pr("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new pr("return float(a > b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new pr("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new Xt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new pr("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new pr("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.select=function(t,r,o){var s=new eZ(t.rank,r.shape,r.rank);return this.compileAndRun(s,[t,r,o],No(r.dtype,o.dtype))},e.prototype.where=function(t){kx("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return j4(t.shape,r)},e.prototype.topk=function(t,r,o){return WD(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Ys("min",r,t.rank);var o=zo(t.shape,r),s=o[0],i=yt(o[1]),a=t.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(s)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var o=Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new pr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.mod=function(t,r){var o=Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new pr(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);Ys("max",r,t.rank);var o=zo(t.shape,r),s=o[0],i=yt(o[1]),a=t.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(s)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var o=Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new pr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.all=function(t,r){Ys("all",r,t.rank);var o=zo(t.shape,r),s=o[0],i=yt(o[1]),a=t.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(s)},e.prototype.any=function(t,r){Ys("any",r,t.rank);var o=zo(t.shape,r),s=o[0],i=yt(o[1]),a=t.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(s)},e.prototype.realDivide=function(t,r){if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new pr(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(o,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new pr(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(o,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Xw);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var o=No(t.dtype,r.dtype);if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Xw,o);var s=new pr(Xw,t.shape,r.shape);return this.compileAndRun(s,[t,r],o)},e.prototype.packedUnaryOp=function(t,r,o){var s=new Ap(t.shape,r);return this.compileAndRun(s,[t],o)},e.prototype.packedBinaryOp=function(t,r,o,s,i){i===void 0&&(i=!1);var a=new Vl(o,t.shape,r.shape,i);return this.compileAndRun(a,[t,r],s)},e.prototype.complexSeparableBinaryOp=function(t,r,o){var s=this,i=this.texData.get(t.dataId),a=this.texData.get(r.dataId),l=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(h){var p=h[0],g=h[1],x=s.makeComplexComponentTensorInfo(t,p),y=s.makeComplexComponentTensorInfo(r,g),b=new pr(o,t.shape,r.shape);return s.compileAndRun(b,[x,y],No(p.dtype,g.dtype))})),c=l[0],u=l[1],d=this.complex(c,u);return c.dispose(),u.dispose(),d},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>Ae().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),o=this.addN(t.slice(0,r)),s=this.addN(t.slice(r));return this.addN([o,s])}var i=t.map((function(c){return c.dtype})).reduce((function(c,u){return No(c,u)})),a=t.map((function(c){return c.shape})),l=Ae().getBool("WEBGL_PACK")?new RX(t[0].shape,a):new TX(t[0].shape,a);return this.compileAndRun(l,t,i)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Yw);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var o=No(t.dtype,r.dtype);if(Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Yw,t.dtype);var s=new pr(Yw,t.shape,r.shape);return this.compileAndRun(s,[t,r],o)},e.prototype.pow=function(t,r){var o=Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new pr(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),s=No(t.dtype,r.dtype);return this.compileAndRun(o,[t,r],s)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,yI,t.dtype);var r=new Xt(t.shape,yI);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,bI,t.dtype);var r=new Xt(t.shape,bI);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new Xt(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new Xt(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new Xt(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new Xt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new Xt(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,wI,t.dtype);var r=new Xt(t.shape,wI);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,CI,t.dtype);var r=new Xt(t.shape,CI);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var o=eo([r],t.shape),s=this.max(t,o),i=Ms(s.shape,o),a=this.subtract(t,s.reshape(i)),l=this.exp(a),c=this.sum(l,o).reshape(i);return this.realDivide(l,c)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new Xt(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new Xt(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new Xt(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new Xt(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new Xt(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=Ae().getBool("WEBGL_PACK")?new Ap(t.shape,QD):new Xt(t.shape,XD),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=Ae().getBool("WEBGL_PACK")?new Ap(t.shape,JD):new Xt(t.shape,YD),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var o=Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(KD,t.shape,r.shape):new pr(qD,t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.elu=function(t){if(Ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,eA,t.dtype);var r=new Xt(t.shape,ZD);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var o=Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new pr("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.selu=function(t){var r=new Xt(t.shape,cZ);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new Xt(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,o){var s,i=(s=Ae().getBool("WEBGL_PACK_CLIP")?new UX(t.shape):new WX(t.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(s,[t],null,i)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,xI,t.dtype);var r=new Xt(t.shape,xI);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),o=new HX(t.shape),s=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(o,s)},e.prototype.sigmoid=function(t){var r=new Xt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new Xt(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new Xt(t.shape,uZ);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new Xt(t.shape,dZ);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new Xt(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new Xt(t.shape,hZ);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new Xt(t.shape,fZ);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new Xt(t.shape,pZ);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var o=Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new pr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.sinh=function(t){var r=new Xt(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new Xt(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new Xt(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new Xt(t.shape,mZ);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new Xt(t.shape,gZ);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new Xt(t.shape,xZ);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new Xt(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var o=new Xt(t.shape,(function(s){return s===void 0&&(s=0),va+`
    return x > 0.0 ? 1.0 : float(`+s+`);
  `})(r));return this.compileAndRun(o,[t])},e.prototype.conv2dByMatMul=function(t,r,o,s,i,a){var l=t.shape,c=this.texData.get(t.dataId),u=o.inChannels,d=l[0]*l[1]*l[2],h=o.outChannels,p=o.dataFormat==="channelsLast",g=(d===1||h===1)&&u>1e3,x=l[2]%2!=0&&!!c.isPacked;if(g||!Ae().getBool("WEBGL_LAZILY_UNPACK")||!Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!x){var y=p?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],b=this.reshape(t,[1,y,o.inChannels]),C=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:b,b:C,transposeA:!1,transposeB:!1,bias:s,activation:i,preluActivationWeights:a}),o.outShape)}var S=p?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),k={dataId:t.dataId,shape:[1,S,o.inChannels],dtype:t.dtype},N=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,Y(S0(c.shape,k.shape),(function(){return"packed reshape "+c.shape+" to "+k.shape+" isn't free"}));var E=this.reshape(r,[1,o.inChannels,o.outChannels]),_=this.fusedBatchMatMul({a:k,b:E,transposeA:!1,transposeB:!1,bias:s,activation:i,preluActivationWeights:a}),$=this.texData.get(_.dataId);return Y($.isPacked,(function(){return"batchMatMul result is expected to be packed"})),c.shape=N,$.shape=o.outShape,ce.makeTensorFromDataId(_.dataId,o.outShape,_.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,o,s,i,a){var l=o.filterWidth,c=o.filterHeight,u=o.inChannels,d=o.outWidth,h=o.outHeight,p=o.dataFormat==="channelsLast",g=l*c*u,x=h*d,y=[g,x],b=t.squeeze([0]),C=r.reshape([1,g,-1]),S=new $Y(y,b.shape,o),k=this.compileAndRun(S,[b]).reshape([1,y[0],y[1]]),N=s!=null,E=a!=null,_=i?T0(i,!0):null,$=new Zw(k.shape,[1,x,o.outChannels],!0,!1,N,_,E),T=[k,C];s&&T.push(s),E&&T.push(a);var D=this.compileAndRun($,T);return p?D.reshape([1,h,d,o.outChannels]):D.reshape([1,o.outChannels,h,d])},e.prototype.fusedConv2d=function(t){var r=t.input,o=t.filter,s=t.convInfo,i=t.bias,a=t.activation,l=t.preluActivationWeights;if(s.filterHeight===1&&s.filterWidth===1&&s.dilationHeight===1&&s.dilationWidth===1&&s.strideHeight===1&&s.strideWidth===1&&(s.padInfo.type==="SAME"||s.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,s,i,a,l);if(Ae().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,s,i,a,l);var c=i!=null,u=l!=null,d=a?T0(a,!1):null,h=new lI(s,c,d,u),p=[r,o];return i&&p.push(i),l&&p.push(l),this.compileAndRun(h,p)},e.prototype.conv2d=function(t,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,o);if(Ae().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,o);var s=new lI(o);return this.compileAndRun(s,[t,r])},e.prototype.conv2dDerInput=function(t,r,o){var s=new XX(o);return this.compileAndRun(s,[t,r])},e.prototype.conv2dDerFilter=function(t,r,o){var s=new KX(o);return this.compileAndRun(s,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,o=t.input,s=t.filter,i=t.convInfo,a=t.bias,l=t.activation,c=t.preluActivationWeights,u=Ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,d=l?T0(l,u):null,h=[o,s],p=a!=null,g=c!=null;return p&&h.push(a),g&&h.push(c),u?(r=new uI(i,p,d,g),this.compileAndRun(r,h)):(r=new cI(i,p,d,g),this.compileAndRun(r,h))},e.prototype.depthwiseConv2D=function(t,r,o){var s;return Ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(s=new uI(o),this.compileAndRun(s,[t,r])):(s=new cI(o),this.compileAndRun(s,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,o){var s=new JX(o);return this.compileAndRun(s,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,o){var s=new QX(o);return this.compileAndRun(s,[t,r])},e.prototype.conv3d=function(t,r,o){var s=new eY(o);return this.compileAndRun(s,[t,r])},e.prototype.conv3dDerInput=function(t,r,o){var s=new ZX(o);return this.compileAndRun(s,[t,r])},e.prototype.conv3dDerFilter=function(t,r,o){var s=new YX(o);return this.compileAndRun(s,[t,r])},e.prototype.maxPool=function(t,r){var o=new Qw(r,"max",!1);return this.compileAndRun(o,[t])},e.prototype.avgPool=function(t,r){var o=new Qw(r,"avg",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,o,s){var i=new Qw(s,"max",!0),a=this.compileAndRun(i,[r]),l=new OY(s),c=this.compileAndRun(l,[t,a],r.dtype);return a.dispose(),c},e.prototype.avgPoolBackprop=function(t,r,o){var s=new OX(o);return this.compileAndRun(s,[t],r.dtype)},e.prototype.cast=function(t,r){return LD(t,r,this)},e.prototype.unstack=function(t,r){for(var o=t.shape[r],s=new Array(t.rank-1),i=0,a=0;a<t.rank;a++)a!==r&&(s[i++]=t.shape[a]);var l=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var u=new Array(o);for(a=0;a<u.length;a++)l[r]=a,u[a]=this.slice(t,l,c).reshape(s);return u},e.prototype.avgPool3d=function(t,r){var o=new Jw(r,"avg",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,o){var s=new LX(o);return this.compileAndRun(s,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var o=new Jw(r,"max",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,o,s){var i=new Jw(s,"max",!0),a=this.compileAndRun(i,[r]),l=new LY(s),c=this.compileAndRun(l,[t,a],r.dtype);return a.dispose(),c},e.prototype.reshape=function(t,r){var o=this.texData.get(t.dataId);if(o.isPacked&&!S0(t.shape,r)&&(o.texture===null||!S0(o.shape,r))){var s=this.packedReshape(t,r);return ce.makeTensorFromDataId(s.dataId,s.shape,s.dtype)}return dC(t,r)},e.prototype.resizeBilinear=function(t,r,o,s){var i=Ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new KY(t.shape,r,o,s):new qY(t.shape,r,o,s);return this.compileAndRun(i,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,o){var s=new GY(t,r,o);return this.compileAndRun(s,[t])},e.prototype.resizeNearestNeighbor=function(t,r,o,s){var i=new YY(t.shape,r,o,s);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,o){var s=new XY(t,r,o);return this.compileAndRun(s,[t])},e.prototype.multinomial=function(t,r,o,s){var i=r?t:tc(t),a=i.shape[0],l=i.shape[1],c=new BY(a,l,o),u=c.getCustomSetupFunc(s);return this.compileAndRun(c,[i],"int32",u)},e.prototype.oneHot=function(t,r,o,s){var i=new jY(t.size,r,o,s);return this.compileAndRun(i,[t])},e.prototype.diag=function(t){var r=new iY(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,o,s,i){return kx("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),L4(t.dataSync(),r.dataSync(),o,s,i)},e.prototype.cropAndResize=function(t,r,o,s,i,a){var l=new tY(t.shape,r.shape,s,i,a);return this.compileAndRun(l,[t,r,o],"float32")},e.prototype.depthToSpace=function(t,r,o){Y(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));var s=t.shape[0],i=o==="NHWC"?t.shape[1]:t.shape[2],a=o==="NHWC"?t.shape[2]:t.shape[3],l=o==="NHWC"?t.shape[3]:t.shape[1],c=i*r,u=a*r,d=l/(r*r),h=new sY(o==="NHWC"?[s,c,u,d]:[s,d,c,u],r,o);return this.compileAndRun(h,[t])},e.prototype.split=function(t,r,o){return VD(t,r,o)},e.prototype.scatterND=function(t,r,o){var s=Rx(0,t,o),i=s.sliceRank,a=s.numUpdates,l=s.sliceSize,c=s.strides,u=s.outputSize,d=[u/l,l],h=t.reshape([a,i]),p=r.reshape([a,l]);if(u===0)return dC(Io([]),o);var g=et(0),x=new pI(a,i,h.rank,p.rank,c,d);return this.compileAndRun(x,[p,h,g]).reshape(o)},e.prototype.sparseToDense=function(t,r,o,s){var i=Rx(0,t,o),a=i.sliceRank,l=i.numUpdates,c=i.strides,u=i.outputSize,d=new pI(l,a,t.rank,r.rank,c,[u,1]);return this.compileAndRun(d,[r,t,s]).reshape(o)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var o=this.texData.get(t.dataId),s=new hI(dY,t.shape,r),i=new hI(hY,t.shape,r),a=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag)],l=this.compileAndRun(s,a),c=this.compileAndRun(i,a),u=this.complex(l,c).as2D(t.shape[0],t.shape[1]);return l.dispose(),c.dispose(),u},e.prototype.gatherND=function(t,r){var o=r.shape,s=o[o.length-1],i=AD(t,r),a=i[0],l=i[1],c=i[2],u=i[3],d=r.reshape([l,s]),h=t.reshape([t.size/c,c]),p=new mY(s,u,[l,c]);return this.compileAndRun(p,[h,d]).reshape(a)},e.prototype.fill=function(t,r,o){if((o=o||Dm(r))==="string"){var s=yx(o,yt(t));return s.fill(r),ce.makeTensor(s,t,o,this)}var i=new fY(t,r),a=i.getCustomSetupFunc(r);return this.compileAndRun(i,[],o,a)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,o){return BD(t,r,o)},e.prototype.makeTensorInfo=function(t,r){var o=this.write(null,t,r);return this.texData.get(o).usage=null,{dataId:o,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var o=this.makeTensorInfo(t,r).dataId;return ce.makeTensorFromDataId(o,t,r,this)},e.prototype.unpackTensor=function(t){var r=new yZ(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new VY(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var o=[wx(t.shape)].concat(Cx(t.shape)),s={dtype:t.dtype,shape:o,dataId:t.dataId},i=[wx(r)].concat(Cx(r)),a=new HY(i,o),l=this.runWebGLProgram(a,[s],t.dtype,null,!0);return{dataId:l.dataId,shape:r,dtype:l.dtype}},e.prototype.decode=function(t){var r,o=this.texData.get(t),s=o.isPacked,i=o.shape,a=o.dtype,l=qw(i);return r=s?new oY(l):new rY(l),{dtype:a,shape:i,dataId:this.runWebGLProgram(r,[{shape:l,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,o,s,i){var a=this;i===void 0&&(i=!1);var l=this.makeTensorInfo(t.outputShape,o),c=this.texData.get(l.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===am.DENSE){var u=qp(t.outputShape);c.texShape=u.map((function(S){return 2*S}))}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),yt(l.shape)===0)return c.values=sm(l.dtype,0),l;var d=[],h=r.map((function(S){if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var k=a.texData.get(S.dataId);if(k.texture==null){if(!t.packedInputs&&yt(S.shape)<=Ae().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:k.values};t.packedInputs&&(k.isPacked=!0,k.shape=S.shape)}else if(!!k.isPacked!=!!t.packedInputs)S=k.isPacked?a.unpackTensor(S):a.packTensor(S),d.push(S),k=a.texData.get(S.dataId);else if(k.isPacked&&!S0(k.shape,S.shape)){var N=S,E=S.shape;S.shape=k.shape,S=a.packedReshape(S,E),d.push(S),k=a.texData.get(S.dataId),N.shape=E}return a.uploadToGPU(S.dataId),{shape:S.shape,texData:k,isUniform:!1}}));this.uploadToGPU(l.dataId);var p,g={shape:l.shape,texData:c,isUniform:!1},x=(function(S,k,N){var E="";k.concat(N).forEach((function(T){var D=T.texData!=null&&T.texData.slice!=null&&T.texData.slice.flatOffset>0,A=T.isUniform?"uniform":T.texData.texShape;E+=T.shape+"_"+A+"_"+D}));var _=S.userCode,$=S.constructor.name;return $+="_"+E+"_"+_})(t,h,g),y=this.getAndSaveBinary(x,(function(){return(function(S,k,N,E){var _=k.userCode,$=N.map((function(O,V){var W={logicalShape:O.shape,texShape:O.isUniform?null:O.texData.texShape,isUniform:O.isUniform,isPacked:!O.isUniform&&O.texData.isPacked,flatOffset:null};return O.texData!=null&&O.texData.slice!=null&&O.texData.slice.flatOffset>0&&(W.flatOffset=O.texData.slice.flatOffset),{name:k.variableNames[V],shapeInfo:W}})),T=$.map((function(O){return O.shapeInfo})),D={logicalShape:E.shape,texShape:E.texData.texShape,isUniform:!1,isPacked:E.texData.isPacked,flatOffset:null},A=AX($,D,_,k.packedInputs),M=S.createProgram(A),j=null,L=S.getUniformLocation(M,"NAN",!1);Ae().getNumber("WEBGL_VERSION")===1&&(j=S.getUniformLocation(M,"INFINITY",!1));for(var U={},G=0;G<k.variableNames.length;G++){var H=k.variableNames[G];U[H]=S.getUniformLocation(M,H,!1),U["offset"+H]=S.getUniformLocation(M,"offset"+H,!1)}return{program:k,source:A,webGLProgram:M,uniformLocations:U,inShapeInfos:T,outShapeInfo:D,infLoc:j,nanLoc:L}})(a.gpgpu,t,h,g)})),b=this.activeTimers!=null;if(b&&(p=this.startTimer()),(function(S,k,N,E,_){fI(k.inShapeInfos,N),fI([k.outShapeInfo],[E]);var $=E.texData.texture,T=E.texData.texShape;E.texData.isPacked?S.setOutputPackedMatrixTexture($,T[0],T[1]):S.setOutputMatrixTexture($,T[0],T[1]),S.setProgram(k.webGLProgram),Ae().getNumber("WEBGL_VERSION")===1&&k.infLoc!==null&&S.gl.uniform1f(k.infLoc,1/0),k.nanLoc!==null&&S.gl.uniform1f(k.nanLoc,NaN),N.forEach((function(D,A){var M=k.program.variableNames[A],j=k.uniformLocations[M],L=k.uniformLocations["offset"+M];if(j!=null)if(D.isUniform)if(yt(D.shape)<2)S.gl.uniform1f(j,D.uniformValues[0]);else{var U=D.uniformValues;U instanceof Float32Array||(U=new Float32Array(U)),S.gl.uniform1fv(j,U)}else D.texData.slice!=null&&L!=null&&S.gl.uniform1i(L,D.texData.slice.flatOffset),S.setInputMatrixTexture(D.texData.texture,j,A)})),_?.(S,k.webGLProgram),S.executeProgram()})(this.gpgpu,y,h,g,s),d.forEach((function(S){return a.disposeData(S.dataId)})),b&&(p=this.endTimer(p),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(p)})),!Ae().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&i===!1){var C=this.unpackTensor(l);return this.disposeData(l.dataId),C}return l},e.prototype.compileAndRun=function(t,r,o,s,i){i===void 0&&(i=!1),o=o||r[0].dtype;var a=this.runWebGLProgram(t,r,o,s,i);return ce.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(Ae().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=lt((function(){if(!Ae().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=Ae().getBool("DEBUG");Ae().set("DEBUG",!1);var o=t.abs(et(1e-8)).dataSync()[0];if(Ae().set("DEBUG",r),o>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,o=this.texData.get(t),s=o.shape,i=o.dtype,a=o.values,l=o.texture,c=o.usage,u=o.isPacked;if(l==null){var d,h=this.activeTimers!=null;h&&(d=za());var p=o.texShape;if(p==null&&(p=EK(s,u),o.texShape=p),a!=null){var g=qw(s),x=void 0,y=p[1],b=p[0],C=a instanceof Uint8Array;u?(y=(r=_m(p[0],p[1]))[0],b=r[1],x=new uY(g,[b,y],C)):x=new cY(g,[b,y],C);var S=this.makeTensorInfo([b,y],i);this.texData.get(S.dataId).usage=C?ei.PIXELS:ei.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(S.dataId),y,b,a);var k=this.runWebGLProgram(x,[S],i,null,!0),N=this.texData.get(k.dataId);o.texture=N.texture,o.texShape=N.texShape,o.isPacked=N.isPacked,o.usage=N.usage,this.disposeData(S.dataId),this.texData.delete(k.dataId),o.values=null,h&&(this.uploadWaitMs+=za()-d)}else{var E=this.acquireTexture(p,c,i,u);o.texture=E}}},e.prototype.convertAndCacheOnCPU=function(t,r){var o=this.texData.get(t),s=o.dtype;return this.releaseGPUData(t),r!=null&&(o.values=(function(i,a){if(a==="float32"||a==="complex64")return i;if(a==="int32"||a==="bool"){for(var l=a==="int32"?new Int32Array(i.length):new Uint8Array(i.length),c=0;c<l.length;++c)l[c]=Math.round(i[c]);return l}throw new Error("Unknown dtype "+a)})(r,s)),o.values},e.prototype.acquireTexture=function(t,r,o,s){if(this.numBytesInGPU+=this.computeBytes(t,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,s)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*fD(r)},e})(MD);bD()&&ce.registerBackend("webgl",(function(){return new wZ}),2);var CZ=re({square_:function(n){var e=X(n,"x","square"),t=[e];return ce.runKernelFunc((function(r,o){return o([e]),r.square(e)}),{x:e},null,"Square",{},t,[])}}),cm="SquaredDifference",tA=re({squaredDifference_:function(n,e){var t,r=X(n,"a","squaredDifference"),o=X(e,"b","squaredDifference");t=hr(r,o),r=t[0],o=t[1],ln(r.shape,o.shape);var s={a:r,b:o},i=[r,o];return ce.runKernelFunc((function(a,l){var c=a.squaredDifference(r,o);return l([r,o]),c}),s,(function(a,l){var c=l[0],u=l[1],d=et(2);return{a:function(){return a.mul(c.sub(u).mul(d))},b:function(){return a.mul(u.sub(c).mul(d))}}}),cm,{},i,[])}}),kZ=re({abs_:function(n){var e=X(n,"x","abs");return e.dtype==="complex64"?ce.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):ce.runKernelFunc((function(t,r){var o=t.abs(e);return r([e]),o}),{x:e},(function(t,r){var o=r[0];return{x:function(){return t.mul(o.toFloat().step(-1))}}}),"Abs")}}),SZ=re({acos_:function(n){var e=X(n,"x","acos");return ce.runKernelFunc((function(t,r){var o=t.acos(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(et(1).sub(o.toFloat().square()).sqrt()).neg()}}}))}}),NZ=re({acosh_:function(n){var e=X(n,"x","acosh");return ce.runKernelFunc((function(t,r){var o=t.acosh(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(o.toFloat().square().sub(1).sqrt())}}}))}}),IZ=re({asin_:function(n){var e=X(n,"x","asin");return ce.runKernelFunc((function(t,r){var o=t.asin(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(et(1).sub(o.toFloat().square()).sqrt())}}}))}}),EZ=re({asinh_:function(n){var e=X(n,"x","asinh");return ce.runKernelFunc((function(t,r){var o=t.asinh(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(et(1).add(o.toFloat().square()).sqrt())}}}))}}),TZ=re({atan_:function(n){var e=X(n,"x","atan");return ce.runKernelFunc((function(t,r){var o=t.atan(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().square().add(1))}}}))}}),RZ=re({atanh_:function(n){var e=X(n,"x","atanh");return ce.runKernelFunc((function(t,r){var o=t.atanh(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.div(et(1).sub(o.toFloat().square()))}}}))}}),DZ=re({ceil_:function(n){var e=X(n,"x","ceil");return ce.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return gn(t)}}}))}}),U4=re({clipByValue_:function(n,e,t){var r=X(n,"x","clipByValue");Y(e<=t,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}));var o=[r],s={min:e,max:t};return ce.runKernelFunc((function(i,a){var l=i.clip(r,e,t);return a([r]),l}),{x:r},(function(i,a){var l=a[0];return{x:function(){return i.where(l.greaterEqual(e).logicalAnd(l.lessEqual(t)),gn(i))}}}),"ClipByValue",s,o)}}),AZ=re({cos_:function(n){var e=X(n,"x","cos"),t=[e];return ce.runKernelFunc((function(r,o){var s=r.cos(e);return o([e]),s}),{x:e},(function(r,o){var s=o[0];return{x:function(){return s.toFloat().sin().neg().mul(r)}}}),"Cos",{},t)}}),_Z=re({cosh_:function(n){var e=X(n,"x","cosh");return ce.runKernelFunc((function(t,r){var o=t.cosh(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(t)}}}))}}),$Z=re({erf_:function(n){var e=X(n,"x","erf");return Y(e.dtype==="int32"||e.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),e.dtype==="int32"&&(e=e.toFloat()),ce.runKernelFunc((function(t,r){var o=t.erf(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),fC=re({exp_:function(n){var e=X(n,"x","exp");return ce.runKernelFunc((function(t,r){var o=t.exp(e);return r([o]),o}),{x:e},(function(t,r){return{x:function(){return t.mulStrict(r[0])}}}),"Exp",{},[],[!0])}}),FZ=re({expm1_:function(n){var e=X(n,"x","expm1");return ce.runKernelFunc((function(t,r){var o=t.expm1(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.exp())}}}))}}),PZ=re({floor_:function(n){var e=X(n,"x","floor");return ce.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return gn(t)}}}))}}),MZ=re({log_:function(n){var e=X(n,"x","log"),t=[e];return ce.runKernelFunc((function(r,o){var s=r.log(e);return o([e]),s}),{x:e},(function(r,o){var s=o[0];return{x:function(){return r.div(s.toFloat())}}}),"Log",{},t)}}),OZ=re({log1p_:function(n){var e=X(n,"x","log1p");return ce.runKernelFunc((function(t,r){var o=t.log1p(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.add(1))}}}))}}),LZ=re({logSigmoid_:function(n){var e=X(n,"x","logSigmoid");return ce.runKernelFunc((function(t,r){var o=t.softplus(e.neg()).neg();return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.neg().sigmoid())}}}))}}),$x=re({neg_:function(n){var e=X(n,"x","neg"),t=[e];return ce.runKernelFunc((function(r){return r.neg(e)}),{x:e},(function(r){return{x:function(){return r.neg()}}}),"Neg",{},t)}}),BZ=re({reciprocal_:function(n){var e=X(n,"x","reciprocal");return ce.runKernelFunc((function(t,r){var o=t.reciprocal(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.square().neg())}}}))}}),jZ=re({round_:function(n){var e=X(n,"x","round");return ce.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return gn(t)}}}))}}),nA=re({rsqrt_:function(n){var e=X(n,"x","rsqrt"),t=[e];return ce.runKernelFunc((function(r,o){var s=r.rsqrt(e);return o([e]),s}),{x:e},(function(r,o){var s=o[0];return{x:function(){return r.div(s.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),rA=re({sigmoid_:function(n){var e=X(n,"x","sigmoid");return ce.runKernelFunc((function(t,r){var o=t.sigmoid(e);return r([o]),o}),{x:e},(function(t,r){var o=r[0];return{x:function(){return t.mul(o.mul(et(1).sub(o)))}}}),"Sigmoid")}}),VZ=re({sign_:function(n){var e=X(n,"x","sign");return ce.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return gn(t)}}}))}}),zZ=re({isNaN_:function(n){var e=X(n,"x","isNaN");return ce.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return gn(t)}}}))}}),WZ=re({isInf_:function(n){var e=X(n,"x","isInf");return ce.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return gn(t)}}}))}}),UZ=re({isFinite_:function(n){var e=X(n,"x","isFinite");return ce.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return gn(t)}}}))}}),HZ=re({sin_:function(n){var e=X(n,"x","sin"),t=[e];return ce.runKernelFunc((function(r,o){var s=r.sin(e);return o([e]),s}),{x:e},(function(r,o){var s=o[0];return{x:function(){return s.toFloat().cos().mul(r)}}}),"Sin",{},t)}}),GZ=re({sinh_:function(n){var e=X(n,"x","sinh");return ce.runKernelFunc((function(t,r){var o=t.sinh(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(t)}}}))}}),qZ=re({softplus_:function(n){var e=X(n,"x","softplus");return ce.runKernelFunc((function(t,r){var o=t.softplus(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.sigmoid())}}}))}}),KZ=re({sqrt_:function(n){var e=X(n,"x","sqrt");return ce.runKernelFunc((function(t,r){var o=t.sqrt(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().sqrt().mul(2))}}}))}}),XZ=re({step_:function(n,e){e===void 0&&(e=0);var t=X(n,"x","step");return ce.runKernelFunc((function(r){return r.step(t,e)}),{$x:t},(function(r){return{$x:function(){return gn(r)}}}))}}),YZ=re({tan_:function(n){var e=X(n,"x","tan");return ce.runKernelFunc((function(t,r){var o=t.tan(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.cos().square())}}}))}}),ZZ=re({tanh_:function(n){var e=X(n,"x","tanh");return ce.runKernelFunc((function(t,r){var o=t.tanh(e);return r([o]),o}),{x:e},(function(t,r){var o=r[0];return{x:function(){return et(1).sub(o.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function oA(n,e,t,r,o,s){var i,a,l=X(n,"x","batchNorm"),c=X(e,"mean","batchNorm"),u=X(t,"variance","batchNorm");return o!=null&&(i=X(o,"scale","batchNorm")),r!=null&&(a=X(r,"offset","batchNorm")),Y(l.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),Y(c.rank===2||c.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),Y(u.rank===2||u.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+u.rank+"."})),i!=null&&Y(i.rank===2||i.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."})),a!=null&&Y(a.rank===2||a.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."})),Fm(l,c,u,a,i,s)}function sA(n,e,t,r,o,s){var i,a,l=X(n,"x","batchNorm"),c=X(e,"mean","batchNorm"),u=X(t,"variance","batchNorm");return o!=null&&(i=X(o,"scale","batchNorm")),r!=null&&(a=X(r,"offset","batchNorm")),Y(l.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),Y(c.rank===3||c.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),Y(u.rank===3||u.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+u.rank+"."})),i!=null&&Y(i.rank===3||i.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."})),a!=null&&Y(a.rank===3||a.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."})),Fm(l,c,u,a,i,s)}function iA(n,e,t,r,o,s){var i,a,l=X(n,"x","batchNorm"),c=X(e,"mean","batchNorm"),u=X(t,"variance","batchNorm");return o!=null&&(i=X(o,"scale","batchNorm")),r!=null&&(a=X(r,"offset","batchNorm")),Y(l.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+l.rank+"."})),Y(c.rank===4||c.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),Y(u.rank===4||u.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+u.rank+"."})),i!=null&&Y(i.rank===4||i.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."})),a!=null&&Y(a.rank===4||a.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."})),Fm(l,c,u,a,i,s)}function Fm(n,e,t,r,o,s){s==null&&(s=.001);var i,a,l,c=X(n,"x","batchNorm"),u=X(e,"mean","batchNorm"),d=X(t,"variance","batchNorm");o!=null&&(i=X(o,"scale","batchNorm")),r!=null&&(a=X(r,"offset","batchNorm")),Y(u.rank===d.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Y(a==null||u.rank===a.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Y(i==null||u.rank===i.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),l=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var h=[c,u,d,i];return ce.runKernelFunc((function(p,g){var x=p.batchNormalization(l,R0(u),R0(d),s,R0(i),R0(a));return g([c,u,d,i]),x}),{x:c,mean:u,variance:d,scale:i,offset:a},(function(p,g){var x=g,y=x[0],b=x[1],C=x[2],S=x[3],k=S??et(1),N=Qr(b.shape,l.shape),E=[];if(b.rank===1){for(var _=0;_<l.shape.length-1;++_)E.push(l.shape[_]);E.push(1)}var $=y.sub(b),T=p.mul(k),D=nA(C.add(et(s))),A=D.mul(D).mul(D).mul(et(-.5));return{x:function(){return b.rank===1?p.mul(Kh(D.as4D(1,1,1,b.shape[0]),E)).mul(k).reshape(y.shape):p.mul(D).mul(k).reshape(y.shape)},mean:function(){var M=D.mul(et(-1)).mul(T);return b.rank===1&&(M=M.sum(N)),M.reshape(b.shape)},variance:function(){var M=A.mul($).mul(T);return b.rank===1&&(M=M.sum(N)),M.reshape(b.shape)},scale:function(){var M=$.mul(D),j=p.mul(M);return b.rank===1&&(j=j.sum(N)),j.reshape(b.shape)},offset:function(){var M=p;return b.rank===1&&(M=M.sum(N)),M.reshape(b.shape)}}}),"BatchNormalization",{varianceEpsilon:s},h).reshape(c.shape)}function R0(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Ov(){wD("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var QZ=re({batchNormalization2d_:function(n,e,t,r,o,s){return r===void 0&&(r=.001),Ov(),oA(n,e,t,s,o,r)}}),JZ=re({batchNormalization3d_:function(n,e,t,r,o,s){return r===void 0&&(r=.001),Ov(),sA(n,e,t,s,o,r)}}),eQ=re({batchNormalization4d_:function(n,e,t,r,o,s){return r===void 0&&(r=.001),Ov(),iA(n,e,t,s,o,r)}}),tQ=re({batchNormalization_:function(n,e,t,r,o,s){return r===void 0&&(r=.001),Ov(),Fm(n,e,t,s,o,r)}}),aA=re({batchNorm_:Fm}),nQ=re({batchNorm2d_:oA}),rQ=re({batchNorm3d_:sA}),oQ=re({batchNorm4d_:iA}),Lv=re({logicalAnd_:function(n,e){var t=X(n,"a","logicalAnd","bool"),r=X(e,"b","logicalAnd","bool");return ln(t.shape,r.shape),ce.runKernelFunc((function(o){return o.logicalAnd(t,r)}),{a:t,b:r},null,"LogicalAnd")}}),sQ=re({logicalNot_:function(n){var e=X(n,"x","logicalNot","bool");return ce.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),lA=re({logicalOr_:function(n,e){var t=X(n,"a","logicalOr","bool"),r=X(e,"b","logicalOr","bool");return ln(t.shape,r.shape),ce.runKernelFunc((function(o){return o.logicalOr(t,r)}),{$a:t,$b:r})}}),iQ=re({logicalXor_:function(n,e){var t=X(n,"a","logicalXor","bool"),r=X(e,"b","logicalXor","bool");return ln(t.shape,r.shape),lA(n,e).logicalAnd(Lv(n,e).logicalNot())}}),pd=re({where_:function(n,e,t){var r=X(e,"a","where"),o=X(t,"b","where"),s=X(n,"condition","where","bool");return An(r.shape,o.shape,"Error in where: "),s.rank===1?Y(s.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):An(s.shape,o.shape,"Error in where: "),ce.runKernelFunc((function(i,a){var l=i.select(s,r,o);return a([s]),l}),{$condition:s,$a:r,$b:o},(function(i,a){var l=a[0];return{$condition:function(){return gn(l).toFloat()},$a:function(){return i.mul(l.cast(i.dtype))},$b:function(){return i.mul(l.logicalNot().cast(i.dtype))}}}))}}),cA=function(n){return pt(this,void 0,void 0,(function(){var e,t,r;return mt(this,(function(o){switch(o.label){case 0:return[4,(e=X(n,"condition","whereAsync","bool")).data()];case 1:return t=o.sent(),r=j4(e.shape,t),n!==e&&e.dispose(),[2,r]}}))}))},sn=re({add_:function(n,e){var t,r=X(n,"a","add"),o=X(e,"b","add");t=hr(r,o),r=t[0],o=t[1];var s=ln(r.shape,o.shape);return ce.runKernelFunc((function(i){return i.add(r,o)}),{a:r,b:o},(function(i){return{a:function(){var a=i,l=Qr(r.shape,s);return l.length>0&&(a=a.sum(l)),a.reshape(r.shape)},b:function(){var a=i,l=Qr(o.shape,s);return l.length>0&&(a=a.sum(l)),a.reshape(o.shape)}}}),"Add")}}),aQ=re({addN_:function(n){Y(Array.isArray(n),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),Y(n.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length}));var e=n.map((function(o,s){return X(o,"tensors"+s,"addN")})),t=e[0];e.forEach((function(o){if(o.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(o){if(!uo(o.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return ce.runKernelFunc((function(o){return o.addN(e)}),r,(function(o){var s={};return e.forEach((function(i,a){s[a]=function(){return o.clone()}})),s}),"AddN")}}),lQ=re({addStrict_:function(n,e){var t=X(n,"a","addStrict"),r=X(e,"b","addStrict");return An(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),cQ=re({atan2_:function(n,e){var t,r=X(n,"a","atan2"),o=X(e,"b","atan2");t=hr(r,o),r=t[0],o=t[1];var s=ln(r.shape,o.shape);return ce.runKernelFunc((function(i,a){var l=i.atan2(r,o);return a([r,o]),l}),{$a:r,$b:o},(function(i,a){var l=a[0],c=a[1];return{$a:function(){var u=sn(l.square(),c.square()),d=i.mul(c.div(u)),h=Qr(l.shape,s);return h.length>0&&(d=d.sum(h)),d.reshape(l.shape)},$b:function(){var u=sn(l.square(),c.square()),d=$x(i.mul(l.div(u))),h=Qr(c.shape,s);return h.length>0&&(d=d.sum(h)),d.reshape(c.shape)}}}))}}),na=re({div_:function(n,e){var t,r=X(n,"a","div"),o=X(e,"b","div");if(t=hr(r,o),r=t[0],o=t[1],r.dtype==="int32"&&o.dtype==="int32")return uA(r,o);var s=ln(r.shape,o.shape);return ce.runKernelFunc((function(i,a){var l=i.realDivide(r,o);return a([r,o]),l}),{a:r,b:o},(function(i,a){var l=a[0],c=a[1];return{a:function(){var u=i.div(c.toFloat()),d=Qr(l.shape,s);return d.length>0?u.sum(d).reshape(l.shape):u},b:function(){var u=i.mul(l.toFloat()),d=Qr(c.shape,s);d.length>0&&(u=u.sum(d).reshape(c.shape));var h=c.square();return u.div(h.toFloat()).neg()}}}),"Div")}}),uQ=re({divNoNan_:function(n,e){var t,r=X(n,"a","div"),o=X(e,"b","div");r=(t=hr(r,o))[0],o=t[1];var s=na(r,o),i=gn(s),a=o.equal(i);return pd(a,i,s)}}),dQ=re({divStrict_:function(n,e){var t=X(n,"a","div"),r=X(e,"b","div");return An(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),uA=re({floorDiv_:function(n,e){var t,r=X(n,"a","floorDiv"),o=X(e,"b","floorDiv");t=hr(r,o),r=t[0],o=t[1];var s=ln(r.shape,o.shape);return ce.runKernelFunc((function(i,a){var l=i.floorDiv(r,o);return a([r,o]),l}),{a:r,b:o},(function(i,a){var l=a[0],c=a[1];return{a:function(){var u=i.div(c.toFloat()),d=Qr(l.shape,s);return d.length>0?u.sum(d).reshape(l.shape):u},b:function(){var u=i.mul(l.toFloat()),d=Qr(c.shape,s);d.length>0&&(u=u.sum(d).reshape(c.shape));var h=c.square();return u.div(h.toFloat()).neg()}}}),"FloorDiv")}}),H4=re({maximum_:function(n,e){var t,r=X(n,"a","maximum"),o=X(e,"b","maximum");return t=hr(r,o),r=t[0],o=t[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),ln(r.shape,o.shape),ce.runKernelFunc((function(s,i){var a=s.maximum(r,o);return i([r,o]),a}),{a:r,b:o},(function(s,i){var a=i[0],l=i[1];return{a:function(){return s.mul(a.greaterEqual(l).toFloat())},b:function(){return s.mul(a.less(l).toFloat())}}}),"Maximum")}}),hQ=re({maximumStrict_:function(n,e){var t=X(n,"a","maximumStrict"),r=X(e,"b","maximumStrict");return An(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),dA=re({minimum_:function(n,e){var t,r=X(n,"a","minimum"),o=X(e,"b","minimum");return t=hr(r,o),r=t[0],o=t[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),ln(r.shape,o.shape),ce.runKernelFunc((function(s,i){var a=s.minimum(r,o);return i([r,o]),a}),{a:r,b:o},(function(s,i){var a=i[0],l=i[1];return{a:function(){return s.mul(a.lessEqual(l).toFloat())},b:function(){return s.mul(a.greater(l).toFloat())}}}),"Minimum")}}),fQ=re({minimumStrict_:function(n,e){var t=X(n,"a","minimumStrict"),r=X(e,"b","minimumStrict");return An(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),pQ=re({mod_:function(n,e){var t,r=X(n,"a","mod"),o=X(e,"b","mod");t=hr(r,o),r=t[0],o=t[1];var s=ln(r.shape,o.shape);return ce.runKernelFunc((function(i,a){var l=i.mod(r,o);return a([r,o]),l}),{$a:r,$b:o},(function(i,a){var l=a[0],c=a[1];return{$a:function(){var u=Qr(l.shape,s);return u.length>0?i.sum(u).reshape(l.shape):i},$b:function(){var u=i.mul(l.div(c).floor().neg()),d=Qr(c.shape,s);return d.length>0?u.sum(d).reshape(c.shape):u}}}))}}),mQ=re({modStrict_:function(n,e){var t=X(n,"a","modStrict"),r=X(e,"b","modStrict");return An(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Xo=re({mul_:function(n,e){var t,r=X(n,"a","mul"),o=X(e,"b","mul");t=hr(r,o),r=t[0],o=t[1];var s=ln(r.shape,o.shape);return ce.runKernelFunc((function(i,a){var l=i.multiply(r,o);return a([r,o]),l}),{a:r,b:o},(function(i,a){var l=a[0],c=a[1];return{a:function(){var u=i.mul(c.toFloat()),d=Qr(l.shape,s);return d.length>0?u.sum(d).reshape(l.shape):u},b:function(){var u=i.mul(l.toFloat()),d=Qr(c.shape,s);return d.length>0?u.sum(d).reshape(c.shape):u}}}),"Mul")}}),gQ=re({mulStrict_:function(n,e){var t=X(n,"a","mul"),r=X(e,"b","mul");return An(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Fx=re({pow_:function(n,e){var t,r=X(n,"base","pow"),o=X(e,"exp","pow");t=hr(r,o),r=t[0],o=t[1];var s=ln(r.shape,o.shape),i=[r,o];return ce.runKernelFunc((function(a,l){var c=a.pow(r,o);return l([r,o,c]),c}),{a:r,b:o},(function(a,l){var c=l[0],u=l[1],d=l[2];return{a:function(){var h=u.toFloat(),p=a.mul(h.mul(c.pow(h.sub(et(1))))),g=Qr(c.shape,s);return g.length>0&&(p=p.sum(g)),p.reshape(c.shape)},b:function(){var h=c.greater(0),p=c.log().where(h,gn(c)),g=a.mul(d.mul(p)),x=Qr(u.shape,s);return x.length>0&&(g=g.sum(x)),g.reshape(u.shape)}}}),"Pow",{},i,[!0])}}),xQ=re({powStrict_:function(n,e){return An(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),vQ=re({squaredDifferenceStrict_:function(n,e){var t=X(n,"a","squaredDifferenceStrict"),r=X(e,"b","squaredDifferenceStrict");return An(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Jr=re({sub_:function(n,e){var t,r=X(n,"a","sub"),o=X(e,"b","sub");t=hr(r,o),r=t[0],o=t[1];var s=ln(r.shape,o.shape);return ce.runKernelFunc((function(i){return i.subtract(r,o)}),{a:r,b:o},(function(i){return{a:function(){var a=i,l=Qr(r.shape,s);return l.length>0&&(a=a.sum(l)),a.reshape(r.shape)},b:function(){var a=i,l=Qr(o.shape,s);return l.length>0&&(a=a.sum(l)),a.neg().reshape(o.shape)}}}),"Sub")}}),yQ=re({subStrict_:function(n,e){var t=X(n,"a","subStrict"),r=X(e,"b","subStrict");return An(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),hA=re({equal_:function(n,e){var t,r=X(n,"a","equal"),o=X(e,"b","equal");return t=hr(r,o),r=t[0],o=t[1],ln(r.shape,o.shape),ce.runKernelFunc((function(s){return s.equal(r,o)}),{$a:r,$b:o})}}),bQ=re({equalStrict_:function(n,e){var t=X(n,"a","equalStrict"),r=X(e,"b","equalStrict");return An(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),wQ=re({greater_:function(n,e){var t,r=X(n,"a","greater"),o=X(e,"b","greater");return t=hr(r,o),r=t[0],o=t[1],ln(r.shape,o.shape),ce.runKernelFunc((function(s){return s.greater(r,o)}),{a:r,b:o},null,"Greater")}}),fA=re({greaterEqual_:function(n,e){var t,r=X(n,"a","greaterEqual"),o=X(e,"b","greaterEqual");return t=hr(r,o),r=t[0],o=t[1],ln(r.shape,o.shape),ce.runKernelFunc((function(s,i){var a=s.greaterEqual(r,o);return i([r,o]),a}),{a:r,b:o},(function(s,i){var a=i[0],l=i[1];return{a:function(){return gn(a)},b:function(){return gn(l)}}}),"GreaterEqual")}}),CQ=re({greaterEqualStrict_:function(n,e){var t=X(n,"a","greaterEqualStrict"),r=X(e,"b","greaterEqualStrict");return An(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),kQ=re({greaterStrict_:function(n,e){var t=X(n,"a","greaterStrict"),r=X(e,"b","greaterStrict");return An(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),SQ=re({less_:function(n,e){var t,r=X(n,"a","less"),o=X(e,"b","less");return t=hr(r,o),r=t[0],o=t[1],ln(r.shape,o.shape),ce.runKernelFunc((function(s){return s.less(r,o)}),{a:r,b:o},null,"Less")}}),NQ=re({lessEqual_:function(n,e){var t,r=X(n,"a","lessEqual"),o=X(e,"b","lessEqual");return t=hr(r,o),r=t[0],o=t[1],ln(r.shape,o.shape),ce.runKernelFunc((function(s,i){var a=s.lessEqual(r,o);return i([r,o]),a}),{a:r,b:o},null,"LessEqual")}}),IQ=re({lessEqualStrict_:function(n,e){var t=X(n,"a","lessEqualStrict"),r=X(e,"b","lessEqualStrict");return An(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),EQ=re({lessStrict_:function(n,e){var t=X(n,"a","lessStrict"),r=X(e,"b","lessStrict");return An(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),TQ=re({notEqual_:function(n,e){var t,r=X(n,"a","notEqual"),o=X(e,"b","notEqual");return t=hr(r,o),r=t[0],o=t[1],ln(r.shape,o.shape),ce.runKernelFunc((function(s){return s.notEqual(r,o)}),{a:r,b:o},null,"NotEqual")}}),RQ=re({notEqualStrict_:function(n,e){var t=X(n,"a","notEqualStrict"),r=X(e,"b","notEqualStrict");return An(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function kI(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function SI(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var G4=re({gather_:function(n,e,t){t===void 0&&(t=0);var r=X(n,"x","gather"),o=X(e,"indices","gather","int32");t=eo(t,r.shape)[0];var s=(function(i,a,l){for(var c=i.shape[l],u=[],d=1,h=1,p=0;p<l;p++)u.push(i.shape[p]),d*=i.shape[p];for(p=0;p<a.rank;p++)u.push(a.shape[p]);for(p=l+1;p<i.rank;p++)u.push(i.shape[p]),h*=i.shape[p];return{batchSize:d,sliceSize:h,dimSize:c,outputShape:u}})(r,o,t);return ce.runKernelFunc((function(i,a){var l=i.gather(r,o.flatten(),t);return a([o]),l}),{x:r,indices:o},(function(i,a){var l=a[0];return{x:function(){var c=r.shape,u=l.size,d=c.slice(0,t),h=d.length,p=c.slice(t,c.length).slice(1),g=p.length,x=kI(0,h),y=kI(h+1,h+1+g),b=SI([d,[u],p]),C=i.reshape(b),S=l.reshape([u]),k=SI([[h],x,y]),N=C.transpose(k),E=pA(N,S,r.shape[t]),_=_4(k);return E=E.transpose(_)},indices:function(){return l}}}),"Gather",{axis:t}).reshape(s.outputShape)}}),pA=re({unsortedSegmentSum_:function(n,e,t){var r=X(n,"x","unsortedSegmentSum"),o=X(e,"segmentIds","unsortedSegmentSum","int32");return Y(Nr(t),(function(){return"numSegments must be of dtype int"})),ce.runKernelFunc((function(s,i){var a=s.unsortedSegmentSum(r,o,t);return i([o]),a}),{$x:r},(function(s,i){var a=i[0];return{$x:function(){return(function(l,c){for(var u=H4(c,gn(c)),d=G4(l,u),h=fA(c,et(0,"int32")),p=d.rank-h.rank,g=0;g<p;++g)h=Ii(h,g+1);h=Lv(h,Af(d.shape,"bool"));var x=gn(d);return pd(h,d,x)})(s,a)}}}))}}),DQ=function(n,e,t){return pt(this,void 0,void 0,(function(){var r,o,s,i,a,l,c,u,d,h,p,g,x;return mt(this,(function(y){switch(y.label){case 0:for(r=X(n,"tensor","boolMask"),o=X(e,"mask","boolMask","bool"),s=t??0,i=o.rank,a=r.shape,Y(i>0,(function(){return"mask cannot be scalar"})),An(a.slice(s,s+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),l=1,c=s;c<s+i;c++)l*=a[c];return u=a.slice(0,s).concat([l],a.slice(s+i)),d=r.reshape(u),h=o.reshape([-1]),[4,cA(h)];case 1:return p=y.sent(),g=p.squeeze([1]),x=G4(d,g,s),n!==r&&r.dispose(),e!==o&&o.dispose(),g.dispose(),d.dispose(),h.dispose(),p.dispose(),[2,x]}}))}))};function mA(n,e,t,r,o,s,i){s===void 0&&(s="NHWC"),Y(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var a=n,l=e,c=!1;e.rank===3&&(c=!0,l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),Y(a.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."})),Y(l.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank})),Y(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var u=s==="NHWC"?a[3]:a[1],d=s==="NHWC"?l.shape[3]:l.shape[1];Y(u===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[2]+"."})),Y(d===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+t.shape[3]+"."})),i!=null&&Y(Nr(o),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var h=O4(s),p=Fd(a,t.shape,r,1,o,i,!1,h),g=ce.runKernelFunc((function(x,y){var b=x.conv2dDerInput(l,t,p);return y([t,l]),b}),{dy4D:l,filter:t},(function(x,y){var b=y[0],C=y[1];return{dy4D:function(){return Fi(x,b,r,o,s,1,i)},filter:function(){return q4(x,C,b.shape,r,o,s,i)}}}));return c?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function t3(n){var e=(function(s){return typeof s=="number"?[s,s,s]:s.length===2?[s[0],s[1],1]:s})(n),t=e[0],r=e[1],o=e[2];return t===1&&r===1&&o===1}function gA(n,e,t,r,o){Y(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var s=n,i=e,a=!1;e.rank===4&&(a=!0,i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),s=[1,n[0],n[1],n[2],n[3]]);var l=s[4],c=i.shape[4];Y(s.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+s.length+"."})),Y(i.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank})),Y(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),Y(l===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[3]+"."})),Y(c===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."}));var u=Ax(s,t.shape,r,1,o),d=ce.runKernelFunc((function(h){return h.conv3dDerInput(i,t,u)}),{dy5D:i});return a?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var AQ=re({conv1d_:function(n,e,t,r,o,s,i){o===void 0&&(o="NWC"),s===void 0&&(s=1);var a=X(n,"x","conv1d"),l=X(e,"filter","conv1d"),c=a,u=!1;a.rank===2&&(u=!0,c=a.as3D(1,a.shape[0],a.shape[1])),Y(c.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),Y(l.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."})),i!=null&&Y(Nr(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."})),Y(c.shape[2]===l.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+l.shape[1]+"."})),Y(Os(t,s),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+s+"'"})),Y(o==="NWC",(function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."}));var d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),h=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),p=Fi(h,d,[1,t],r,"NHWC",[1,s],i);return u?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),Fi=re({conv2d_:function(n,e,t,r,o,s,i){o===void 0&&(o="NHWC"),s===void 0&&(s=[1,1]);var a=X(n,"x","conv2d"),l=X(e,"filter","conv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Y(c.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),Y(l.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."})),i!=null&&Y(Nr(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var d=o==="NHWC"?c.shape[3]:c.shape[1];Y(d===l.shape[2],(function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+l.shape[2]+"."})),Y(Os(t,s),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}));var h=O4(o),p=Fd(c.shape,l.shape,t,s,r,i,!1,h),g=[l,c],x=ce.runKernelFunc((function(y,b){var C=y.conv2d(c,l,p);return b([l,c]),C}),{x:c,filter:l},(function(y,b){var C=b,S=C[0],k=C[1];return Y(hf(s),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"})),{x:function(){return xA(k.shape,y,S,t,r,o)},filter:function(){return q4(k,y,S.shape,t,r,o)}}}),"Conv2D",p,g);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),_Q=re({conv3d_:function(n,e,t,r,o,s){o===void 0&&(o="NDHWC"),s===void 0&&(s=[1,1,1]);var i=X(n,"x","conv3d"),a=X(e,"filter","conv3d"),l=i,c=!1;i.rank===4&&(c=!0,l=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),Y(l.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+l.rank+"."})),Y(a.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."})),Y(l.shape[4]===a.shape[3],(function(){return"Error in conv3d: depth of input ("+l.shape[4]+") must match input depth for filter "+a.shape[3]+"."})),Y((function(h,p){return t3(h)||t3(p)})(t,s),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"})),Y(o==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."}));var u=Ax(l.shape,a.shape,t,s,r),d=ce.runKernelFunc((function(h,p){var g=h.conv3d(l,a,u);return p([l,a]),g}),{x:l,$filter:a},(function(h,p){Y(t3(s),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"}));var g=p[0],x=p[1];return{x:function(){return gA(g.shape,h,x,t,r)},$filter:function(){return(function(y,b,C,S,k){var N=y;y.rank===4&&(N=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var E=b;E.rank===4&&(E=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3])),Y(N.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+N.shape+"."})),Y(E.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+E.shape+"."})),Y(C.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+C+"."})),Y(N.shape[4]===C[3],(function(){return"Error in conv3dDerFilter: depth of input "+N.shape[4]+") must match input depth in filter ("+C[3]+"."})),Y(E.shape[4]===C[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+E.shape[4]+") must match output depth for filter ("+C[4]+")."}));var _=Ax(N.shape,C,S,1,k);return ce.runKernelFunc((function($){return $.conv3dDerFilter(N,E,_)}),{x5D:N,dy5D:E})})(g,h,x.shape,t,r)}}}));return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),q4=re({conv2dDerFilter_:function(n,e,t,r,o,s,i){s===void 0&&(s="NHWC");var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var l=e;l.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Y(a.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."})),Y(l.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."})),Y(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var c=s==="NHWC"?a.shape[3]:a.shape[1],u=s==="NHWC"?l.shape[3]:l.shape[1];Y(c===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+t[2]+"."})),Y(u===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+u+") must match output depth for filter ("+t[3]+")."})),i!=null&&Y(Nr(o),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var d=O4(s),h=Fd(a.shape,t,r,1,o,i,!1,d);return ce.runKernelFunc((function(p){return p.conv2dDerFilter(a,l,h)}),{x4D:a,dy4D:l})}}),xA=re({conv2dDerInput_:mA}),Bv=re({depthwiseConv2d_:function(n,e,t,r,o,s,i){s===void 0&&(s=[1,1]);var a=X(n,"x","depthwiseConv2d"),l=X(e,"filter","depthwiseConv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Y(c.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),Y(l.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."})),Y(c.shape[3]===l.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."})),s==null&&(s=[1,1]),Y(Os(t,s),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"})),i!=null&&Y(Nr(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var d=Fd(c.shape,l.shape,t,s,r,i,!0),h=[c,l],p=ce.runKernelFunc((function(g,x){var y=g.depthwiseConv2D(c,l,d);return x([c,l]),y}),{x:c,filter:l},(function(g,x){Y(hf(s),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"}));var y=x[0],b=x[1];return{x:function(){return vA(y.shape,g,b,d)},filter:function(){return yA(y,g,b.shape,d)}}}),"DepthwiseConv2dNative",d,h);return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),vA=re({depthwiseConv2dDerInput_:function(n,e,t,r){var o=e,s=!1;e.rank===3&&(s=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=ce.runKernelFunc((function(a){return a.depthwiseConv2DDerInput(o,t,r)}),{dy4D:o});return s?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),yA=re({depthwiseConv2dDerFilter_:function(n,e,t,r){var o=n;n.rank===3&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=e;return s.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),ce.runKernelFunc((function(i){return i.depthwiseConv2DDerFilter(o,s,r)}),{x4D:o,dy4D:s})}}),K4=re({separableConv2d_:function(n,e,t,r,o,s,i){s===void 0&&(s=[1,1]),i===void 0&&(i="NHWC");var a=X(n,"x","separableConv2d"),l=X(e,"depthwiseFilter","separableConv2d"),c=X(t,"pointwiseFilter","separableConv2d"),u=a,d=!1;if(a.rank===3&&(d=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Y(u.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+u.rank+"."})),Y(l.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."})),Y(c.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."})),Y(c.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),Y(c.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var h=l.shape[2],p=l.shape[3];Y(c.shape[2]===h*p,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*p+", but got "+c.shape[2]+"."}));var g=Bv(u,l,r,o,i,s),x=Fi(g,c,1,"valid",i);return d?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),$Q=re({conv2dTranspose_:function(n,e,t,r,o,s){return mA(t,X(n,"x","conv2dTranspose"),X(e,"filter","conv2dTranspose"),r,o,"NHWC",s)}}),FQ=re({conv3dTranspose_:function(n,e,t,r,o){return gA(t,X(n,"x","conv3dTranspose"),X(e,"filter","conv3dTranspose"),r,o)}}),jv=re({matMul_:function(n,e,t,r){var o;t===void 0&&(t=!1),r===void 0&&(r=!1);var s=X(n,"a","matMul"),i=X(e,"b","matMul");o=hr(s,i),s=o[0],i=o[1];var a=t?s.shape[s.rank-2]:s.shape[s.rank-1],l=r?i.shape[i.rank-1]:i.shape[i.rank-2],c=t?s.shape[s.rank-1]:s.shape[s.rank-2],u=r?i.shape[i.rank-2]:i.shape[i.rank-1],d=s.shape.slice(0,-2),h=i.shape.slice(0,-2),p=yt(d),g=yt(h);Y(s.rank>=2&&i.rank>=2&&s.rank===i.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+i.rank+"."})),Y(uo(d,h),(function(){return"Error in matMul: outer dimensions ("+d+") and ("+h+") of Tensors with shapes "+s.shape+" and "+i.shape+" must match."})),Y(a===l,(function(){return"Error in matMul: inner shapes ("+a+") and ("+l+") of Tensors with shapes "+s.shape+" and "+i.shape+" and transposeA="+t+" and transposeB="+r+" must match."}));var x=s.shape.slice(0,-2).concat([c,u]),y=t?s.as3D(p,a,c):s.as3D(p,c,a),b=r?i.as3D(g,u,l):i.as3D(g,l,u),C={transposeA:t,transposeB:r};return ce.runKernelFunc((function(S,k){var N=S.batchMatMul(y,b,t,r);return k([y,b]),N}),{a:y,b},(function(S,k){var N=k,E=N[0],_=N[1];return t||r?!t&&r?{a:function(){return S.matMul(_,!1,!1)},b:function(){return S.matMul(E,!0,!1)}}:t&&!r?{a:function(){return _.matMul(S,!1,!0)},b:function(){return E.matMul(S,!1,!1)}}:{a:function(){return _.matMul(S,!0,!0)},b:function(){return S.matMul(E,!0,!0)}}:{a:function(){return S.matMul(_,!1,!0)},b:function(){return E.matMul(S,!0,!1)}}}),"BatchMatMul",C).reshape(x)}}),PQ=re({dot_:function(n,e){var t=X(n,"t1","dot"),r=X(e,"t2","dot");Y(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."}));var o=t.rank===1?t.size:t.shape[1],s=r.rank===1?r.size:r.shape[0];return Y(o===s,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+s+"."})),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),MQ=re({outerProduct_:function(n,e){var t=X(n,"v1","outerProduct"),r=X(e,"v2","outerProduct");return Y(t.rank===1&&r.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."})),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),Pm=re({reverse_:function(n,e){var t=X(n,"x","reverse");if(t.rank===0)return t.clone();var r=eo(e,t.shape);return ce.runKernelFunc((function(o){return o.reverse(t,r)}),{$x:t},(function(o){return{$x:function(){return o.reverse(r)}}})).reshapeAs(t)}}),OQ=re({reverse1d_:function(n){var e=X(n,"x","reverse");return Y(e.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),Pm(e,0)}}),LQ=re({reverse2d_:function(n,e){var t=X(n,"x","reverse");return Y(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),Pm(t,e)}}),BQ=re({reverse3d_:function(n,e){var t=X(n,"x","reverse");return Y(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),Pm(t,e)}}),jQ=re({reverse4d_:function(n,e){var t=X(n,"x","reverse");return Y(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),Pm(t,e)}});function bA(n,e,t,r,o,s){var i=X(n,"x","maxPool"),a=i,l=!1;i.rank===3&&(l=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Y(a.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."})),Y(Os(t,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"})),s!=null&&Y(Nr(o),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var c=lm(a.shape,e,t,r,o,s);if(c.filterWidth===1&&c.filterHeight===1&&uo(c.inShape,c.outShape))return i.clone();var u=[a],d=ce.runKernelFunc((function(h,p){var g=h.maxPool(a,c);return p([a,g]),g}),{x:a},(function(h,p){var g=p[0],x=p[1];return{x:function(){return(function(y,b,C,S,k,N,E,_){var $=X(y,"dy","maxPoolBackprop"),T=X(b,"input","maxPoolBackprop"),D=X(C,"output","maxPoolBackprop");Y(T.rank===$.rank,(function(){return"Rank of input ("+T.rank+") does not match rank of dy ("+$.rank+")"})),Y(Os(k,N),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+k+" and dilations '"+N+"'"})),Y($.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+$.rank+"."})),Y(T.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+T.rank+"."}));var A=lm(T.shape,S,k,N,E,_);return ce.runKernelFunc((function(M){return M.maxPoolBackprop($,T,D,A)}),{$dy:$,$input:T})})(h,g,x,e,t,r,o)}}}),"MaxPool",c,u);return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function wA(n,e,t,r,o,s){var i=X(n,"x","avgPool","float32");Y(Os(t,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}));var a=i,l=!1;i.rank===3&&(l=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Y(a.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."})),s!=null&&Y(Nr(o),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var c=lm(a.shape,e,t,r,o,s);if(c.filterWidth===1&&c.filterHeight===1&&uo(c.inShape,c.outShape))return i.clone();var u=ce.runKernelFunc((function(d){return d.avgPool(a,c)}),{x:a},(function(d){return{x:function(){return(function(h,p,g,x,y,b){var C=X(h,"dy","avgPoolBackprop"),S=X(p,"input","avgPoolBackprop");Y(S.rank===C.rank,(function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+C.rank+")"})),Y(Os(x,y),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+y+"'"}));var k=S,N=C,E=!1;S.rank===3&&(E=!0,k=S.as4D(1,S.shape[0],S.shape[1],S.shape[2]),N=C.as4D(1,C.shape[0],C.shape[1],C.shape[2])),Y(N.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+N.rank+"."})),Y(k.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+k.rank+"."}));var _=lm(k.shape,g,x,y,b),$=ce.runKernelFunc((function(T){return T.avgPoolBackprop(N,k,_)}),{dy4D:N,input4D:k});return E?$.as3D($.shape[1],$.shape[2],$.shape[3]):$})(d,a,e,t,r,o)}}}),"AvgPool",c);return u=u.cast(i.dtype),l?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}var lo=re({maxPool_:function(n,e,t,r,o){return bA(n,e,t,1,r,o)}}),Mm=re({avgPool_:function(n,e,t,r,o){return wA(n,e,t,1,r,o)}}),VQ=re({pool_:function(n,e,t,r,o,s){o==null&&(o=[1,1]),s==null&&(s=1),r===0&&(r="valid");var i=X(n,"x","maxPool"),a=i,l=!1;i.rank===3&&(l=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Y(Os(s,o),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+o+"'"}));var c,u=lm(a.shape,e,s,o,r),d=[u.dilationHeight,u.dilationWidth];c=r==="same"?(function(k,N){var E=k.map((function(T,D){return T+(T-1)*(N[D]-1)})).map((function(T){return T-1})),_=E.map((function(T){return Math.floor(T/2)})),$=E.map((function(T,D){return T-_[D]}));return E.map((function(T,D){return[_[D],$[D]]}))})([u.filterHeight,u.filterWidth],d):[[0,0],[0,0]];var h=d[0]===1&&d[1]===1,p=(function(k,N,E){var _=E.map((function(L){return L[0]})),$=E.map((function(L){return L[1]})),T=k.concat(_,$),D=N.map((function(L,U){return(L-T[U]%L)%L})),A=$.map((function(L,U){return L+D[U]})),M=N.map((function(L,U){return[_[U],A[U]]})),j=N.map((function(L,U){return[0,D[U]]}));return[M,j]})([u.inHeight,u.inWidth],d,c),g=p[0],x=p[1],y=h?r:"valid",b=h?a:ED(a,d,g),C=(t==="avg"?function(){return wA(b,e,s,1,y)}:function(){return bA(b,e,s,1,y)})(),S=h?C:SD(C,d,x);return l?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),zQ=re({maxPool3d_:function(n,e,t,r,o,s,i){s===void 0&&(s="NDHWC");var a=X(n,"x","maxPool3d"),l=a,c=!1;a.rank===4&&(c=!0,l=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),i==null&&(i=[1,1,1]),Y(l.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+l.rank+"."})),Y(s==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+s})),Y(Os(t,i),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"})),o!=null&&Y(Nr(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var u=Dx(l.shape,e,t,i,r,o,s),d=ce.runKernelFunc((function(h,p){var g=h.maxPool3d(l,u);return p([l,g]),g}),{x:l},(function(h,p){var g=p[0],x=p[1];return{x:function(){return(function(y,b,C,S,k,N,E,_){var $=X(y,"dy","maxPool3dBackprop"),T=X(b,"input","maxPool3dBackprop"),D=X(C,"output","maxPool3dBackprop"),A=$,M=T,j=D,L=!1;T.rank===4&&(L=!0,A=$.as5D(1,$.shape[0],$.shape[1],$.shape[2],$.shape[3]),M=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3]),j=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3])),Y(A.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+A.rank+"."})),Y(M.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."})),Y(j.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+j.rank+"."})),N==null&&(N=[1,1,1]),Y(Os(k,N),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+k+" and dilations '"+N+"'"})),_!=null&&Y(Nr(E),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+_+" but got pad "+E+"."}));var U=Dx(M.shape,S,k,N,E,_),G=ce.runKernelFunc((function(H){return H.maxPool3dBackprop(A,M,j,U)}),{dy5D:A,input5D:M});return L?G.as4D(G.shape[1],G.shape[2],G.shape[3],G.shape[4]):G})(h,g,x,e,t,i,r,o)}}}));return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),WQ=re({avgPool3d_:function(n,e,t,r,o,s,i){s===void 0&&(s="NDHWC");var a=X(n,"x","avgPool3d","float32"),l=a,c=!1;a.rank===4&&(c=!0,l=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),i==null&&(i=[1,1,1]),Y(l.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+l.rank+"."})),Y(s==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+s})),Y(Os(t,i),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"})),o!=null&&Y(Nr(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var u=Dx(l.shape,e,t,i,r,o,s),d=ce.runKernelFunc((function(h){return h.avgPool3d(l,u)}),{x:l},(function(h){return{x:function(){return(function(p,g,x,y,b,C,S){var k=X(p,"dy","avgPool3dBackprop"),N=X(g,"input","avgPool3dBackprop"),E=k,_=N,$=!1;N.rank===4&&($=!0,E=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),_=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),Y(E.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+E.rank+"."})),Y(_.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+_.rank+"."})),b==null&&(b=[1,1,1]),Y(Os(y,b),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+b+"'"})),S!=null&&Y(Nr(C),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+C+"."}));var T=Dx(_.shape,x,y,b,C,S),D=ce.runKernelFunc((function(A){return A.avgPool3dBackprop(E,_,T)}),{dy5D:E,input5D:_});return $?D.as4D(D.shape[1],D.shape[2],D.shape[3],D.shape[4]):D})(h,l,e,t,i,r,o)}}}));return d=d.cast(l.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),cl=re({slice_:function(n,e,t){var r,o,s=X(n,"x","slice");if(s.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(s.rank-1).fill(0)):e.length<s.rank?e.concat(new Array(s.rank-e.length).fill(0)):e.slice()).forEach((function(l){Y(l!==-1,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=t==null?new Array(s.rank).fill(-1):typeof t=="number"?[t].concat(new Array(s.rank-1).fill(-1)):t.length<s.rank?t.concat(new Array(s.rank-t.length).fill(-1)):t).map((function(l,c){return l>=0?l:(Y(l===-1,(function(){return"Negative size values should be exactly -1 but got "+l+" for the slice() size at index "+c+"."})),s.shape[c]-r[c])})),xX(s,r,o);var i=s.shape,a={begin:r,size:o};return ce.runKernelFunc((function(l){return l.slice(s,r,o)}),{x:s},(function(l){for(var c=[],u=0;u<l.rank;u++)c.push([r[u],i[u]-r[u]-o[u]]);return{x:function(){return l.pad(c)}}}),"Slice",a)}}),UQ=re({slice1d_:function(n,e,t){var r=X(n,"x","slice1d");return Y(r.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),cl(r,[e],[t])}}),HQ=re({slice2d_:function(n,e,t){var r=X(n,"x","slice2d");return Y(r.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),cl(r,e,t)}}),CA=re({slice3d_:function(n,e,t){var r=X(n,"x","slice3d");return Y(r.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),cl(r,e,t)}}),GQ=re({slice4d_:function(n,e,t){var r=X(n,"x","slice4d");return Y(r.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),cl(r,e,t)}});function kA(n,e,t,r,o){return e.rank<t.rank&&(e=e.reshape(Ms(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Ms(n.shape,r))),{x:function(){var s=n.mul(t.equal(e).cast(n.dtype));return o==null?s:s.transpose(o)}}}var qQ=re({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","all","bool"),o=eo(e,r.shape),s=o,i=xl(s,r.rank);i!=null&&(r=r.transpose(i),s=vl(s.length,r.rank));var a=ce.runKernelFunc((function(c){return c.all(r,s)}),{$x:r});if(t){var l=Ms(a.shape,o);return a.reshape(l)}return a}}),KQ=re({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","any","bool"),o=eo(e,r.shape),s=o,i=xl(s,r.rank);i!=null&&(r=r.transpose(i),s=vl(s.length,r.rank));var a=ce.runKernelFunc((function(c){return c.any(r,s)}),{$x:r});if(t){var l=Ms(a.shape,o);return a.reshape(l)}return a}}),XQ=re({argMax_:function(n,e){e===void 0&&(e=0);var t=X(n,"x","argMax");e==null&&(e=0);var r=eo(e,t.shape),o=xl(r,t.rank);o!=null&&(t=t.transpose(o),r=vl(r.length,t.rank));var s={axis:r[0]},i=[t];return ce.runKernelFunc((function(a,l){var c=a.argMax(t,r[0]);return l([t]),c}),{x:t},(function(a,l){var c=l[0];return{x:function(){return gn(c)}}}),"ArgMax",s,i)}}),YQ=re({argMin_:function(n,e){e===void 0&&(e=0);var t=X(n,"x","argMin");e==null&&(e=0);var r=eo(e,t.shape),o=xl(r,t.rank);return o!=null&&(t=t.transpose(o),r=vl(r.length,t.rank)),ce.runKernelFunc((function(s,i){var a=s.argMin(t,r[0]);return i([t]),a}),{$x:t},(function(s,i){var a=i[0];return{$x:function(){return gn(a)}}}))}}),ZQ=re({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","logSumExp"),o=eo(e,r.shape),s=r.max(o,!0),i=r.sub(s).exp().sum(o).log(),a=s.reshape(i.shape).add(i);if(t){var l=Ms(a.shape,o);return a.reshape(l)}return a}}),Vv=re({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","max"),o=r,s=eo(e,r.shape),i=s,a=xl(i,r.rank);a!=null&&(r=r.transpose(a),i=vl(i.length,r.rank));var l=[r],c=ce.runKernelFunc((function(d,h){var p=d.max(r,i);return h([o,p]),p}),{x:r},(function(d,h){return kA(d,h[1],h[0],s,a)}),"Max",{axes:i},l,[!0]);if(t){var u=Ms(c.shape,s);c=c.reshape(u)}return c}}),QQ=re({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","mean"),o=eo(e,r.shape),s=yt(zo(r.shape,o)[1]);return Mv((function(i){var a=et(s);return{value:(a.dtype===i.dtype?i:i.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(l){var c=i.shape.slice();return o.forEach((function(u){c[u]=1})),l.reshape(c).mul(Af(i.shape,"float32")).div(s)}}}))(r)}}),JQ=re({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","min"),o=r,s=eo(e,r.shape),i=s,a=xl(i,r.rank);a!=null&&(r=r.transpose(a),i=vl(i.length,r.rank));var l=[r],c=ce.runKernelFunc((function(d,h){var p=d.min(r,i);return h([o,p]),p}),{x:r},(function(d,h){return kA(d,h[1],h[0],s,a)}),"Min",{axes:i},l,[!0]);if(t){var u=Ms(c.shape,s);c=c.reshape(u)}return c}}),eJ=re({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=eo(e,(n=X(n,"x","moments")).shape),o=n.mean(r,t),s=o.shape;t||(s=Ms(o.shape,r));var i=n.toFloat().sub(o.reshape(s)).square();return{mean:o,variance:i.mean(r,t)}}}),SA=re({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=eo(e,r.shape);return Mv((function(s){var i=xl(o,s.rank),a=o,l=s;i!=null&&(l=s.transpose(i),a=vl(a.length,s.rank));var c=function(p){var g=s.shape.slice();return o.forEach((function(x){g[x]=1})),p.reshape(g).mul(Af(s.shape,"float32"))},u={axes:a},d=ce.runKernelFunc((function(p){return p.sum(l,a)}),{x:l},(function(p){return{x:function(){return c(p)}}}),"Sum",u);if(t){var h=Ms(d.shape,o);d=d.reshape(h)}return{value:d,gradFunc:c}}))(r)}}),tJ=re({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=eo(e,r.shape),s=xl(o,r.rank),i=o,a=r;s!=null&&(a=r.transpose(s),i=vl(i.length,r.rank));var l=ce.runKernelFunc((function(u){return u.prod(a,i)}),{permutedX:a});if(t){var c=Ms(l.shape,o);l=l.reshape(c)}return l}}),NA=re({elu_:function(n){var e=X(n,"x","elu");return ce.runKernelFunc((function(t,r){var o=t.elu(e);return r([o]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){return ce.runKernelFunc((function(s){return s.eluDer(t,o)}),{dy:t,y:o})}}}))}}),nJ=re({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=X(n,"x","leakyRelu");return H4(et(e).mul(t),t)}}),IA=re({prelu_:function(n,e){var t=X(n,"x","prelu"),r=X(e,"alpha","prelu");return ce.runKernelFunc((function(o,s){var i=o.prelu(t,r);return s([t,r]),i}),{x:t,alpha:r},(function(o,s){var i=s[0],a=s[1],l=i.greater(0);return{x:function(){return pd(l,o,o.mul(a))},alpha:function(){var c=pd(l,gn(o),o.mul(i)),u=Qr(a.shape,o.shape);return u.length>0&&(c=c.sum(u)),c.reshape(a.shape)}}}),"Prelu")}}),dr=re({relu_:function(n){var e=X(n,"x","relu");return e.dtype==="bool"?e.toInt():ce.runKernelFunc((function(t,r){var o=t.relu(e);return r([e]),o}),{x:e},(function(t,r){var o=r[0];return{x:function(){return t.mulStrict(o.step().toFloat())}}}),"Relu")}}),EA=re({relu6_:function(n){var e=X(n,"x","relu6");return e.dtype==="bool"?e.toInt():ce.runKernelFunc((function(t,r){var o=t.relu6(e);return r([e]),o}),{x:e},(function(t,r){var o=r[0],s=o.lessEqual(6).mul(o.step());return{x:function(){return t.mulStrict(s.toFloat())}}}),"Relu6")}}),rJ=re({selu_:function(n){var e=X(n,"x","selu");return ce.runKernelFunc((function(t,r){var o=t.selu(e);return r([e]),o}),{$x:e},(function(t,r){var o=r[0];return{$x:function(){var s=o.greater(et(0)),i=et(z4),a=et(W4),l=t.mul(a),c=t.mul(i).mul(o.toFloat().exp());return pd(s,l,c)}}}))}}),nu=re({transpose_:function(n,e){var t=X(n,"x","transpose");if(e==null&&(e=t.shape.map((function(o,s){return s})).reverse()),Y(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."})),e.forEach((function(o){Y(o>=0&&o<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e}))})),t.rank<=1)return t.clone();var r={perm:e};return ce.runKernelFunc((function(o){return o.transpose(t,e)}),{x:t},(function(o){var s=_4(e);return{x:function(){return o.transpose(s)}}}),"Transpose",r)}}),oJ=re({localResponseNormalization_:function(n,e,t,r,o){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),o===void 0&&(o=.5);var s=X(n,"x","localResponseNormalization");Y(s.rank===4||s.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+s.rank+"."})),Y(Nr(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var i=s,a=!1;s.rank===3&&(a=!0,i=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]));var l=ce.runKernelFunc((function(c,u){var d=c.localResponseNormalization4D(i,e,t,r,o);return u([i,d]),d}),{x4D:i},(function(c,u){var d=u[0],h=u[1];return{x4D:function(){return ce.runKernelFunc((function(p){return p.LRNGrad(c,d,h,e,t,r,o)}),{})}}}));return a?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),TA=re({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var o=(function a(l,c,u){if(u===void 0&&(u=null),l.rank===0)return l.abs();if(l.rank!==1&&u===null)return a(l.reshape([-1]),c,u);if(l.rank===1||typeof u=="number"||Array.isArray(u)&&u.length===1){if(c===1)return l.abs().sum(u);if(c===1/0)return l.abs().max(u);if(c===-1/0)return l.abs().min(u);if(c==="euclidean"||c===2)return l.abs().pow(et(2,"int32")).sum(u).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(u)&&u.length===2){if(c===1)return l.abs().sum(u[0]).max(u[1]-1);if(c===1/0)return l.abs().sum(u[1]).max(u[0]);if(c===-1/0)return l.abs().sum(u[1]).min(u[0]);if(c==="fro"||c==="euclidean")return l.square().sum(u).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+u)})(n=X(n,"x","norm"),e,t),s=o.shape;if(r){var i=eo(t,n.shape);s=Ms(o.shape,i)}return o.reshape(s)}}),sJ=re({basicLSTMCell_:function(n,e,t,r,o,s){var i=X(n,"forgetBias","basicLSTMCell"),a=X(e,"lstmKernel","basicLSTMCell"),l=X(t,"lstmBias","basicLSTMCell"),c=X(r,"data","basicLSTMCell"),u=X(o,"c","basicLSTMCell"),d=X(s,"h","basicLSTMCell"),h=c.concat(d,1).matMul(a).add(l),p=h.shape[0],g=h.shape[1]/4,x=[p,g],y=h.slice([0,0],x),b=h.slice([0,g],x),C=h.slice([0,2*g],x),S=h.slice([0,3*g],x),k=y.sigmoid().mulStrict(b.tanh()).addStrict(u.mulStrict(i.add(C).sigmoid())),N=k.tanh().mulStrict(S.sigmoid());return[k,N]}}),iJ=re({multiRNNCell_:function(n,e,t,r){for(var o=X(e,"data","multiRNNCell"),s=Sx(t,"c","multiRNNCell"),i=Sx(r,"h","multiRNNCell"),a=o,l=[],c=0;c<n.length;c++){var u=n[c](a,s[c],i[c]);l.push(u[0]),l.push(u[1]),a=u[1]}var d=[],h=[];for(c=0;c<l.length;c+=2)d.push(l[c]),h.push(l[c+1]);return[d,h]}}),aJ=re({movingAverage_:function(n,e,t,r,o){o===void 0&&(o=!0);var s=X(n,"v","movingAverage"),i=X(e,"x","movingAverage"),a=X(t,"decay","movingAverage");oK(s,i),Y(uo(s.shape,i.shape),(function(){return"Shape mismatch in v and x"}));var l=et(1),c=l.sub(a),u=i.sub(s).mul(c);if(o){Y(r!=null,(function(){return"When using zeroDebias: true, step is required."}));var d=X(r,"step","movingAverage");u=u.div(l.sub(Fx(a,d)))}return s.add(u)}}),lJ=re({stridedSlice_:function(n,e,t,r,o,s,i,a,l){if(o===void 0&&(o=0),s===void 0&&(s=0),i===void 0&&(i=0),a===void 0&&(a=0),l===void 0&&(l=0),r==null&&(r=new Array(e.length)),i!==0)throw new Error("ellipsis mask is not yet supported");var c=X(n,"x","stridedSlice"),u=rI(a),d=c.shape.slice();u.forEach((function(y){e[y]=0,t[y]=1,d.splice(y,0,1)})),c=c.reshape(d);for(var h=0;h<c.rank;h++)e[h]=vX(o,e,r,c.shape,h),t[h]=yX(s,t,r,c.shape,h),r[h]=r[h]||1;var p=rI(l);p.forEach((function(y){t[y]=e[y]+1,r[y]=1}));var g=M4(e,t,r),x=g.filter((function(y,b){return p.indexOf(b)===-1}));return r.every((function(y){return y===1}))?cl(c,e,g).reshape(x):ce.runKernelFunc((function(y){return y.stridedSlice(c,e,t,r)}),{$x:c}).reshape(x)}}),cJ=re({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=X(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var s=ce.runKernelFunc((function(i){return i.topk(r,e,t)}),{$x:r});return{values:s[0],indices:s[1]}}}),uJ=re({scatterND_:function(n,e,t){var r=X(n,"indices","scatterND","int32"),o=X(e,"updates","scatterND");return gX(o,r,t),ce.runKernelFunc((function(s){return s.scatterND(r,o,t)}),{indices:r,updates:o},null,"ScatterNd",{shape:t})}}),X4=re({fft_:function(n){Y(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return ce.runKernelFunc((function(o){return o.fft(r)}),{input:n}).reshape(n.shape)}}),Px=re({ifft_:function(n){Y(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return ce.runKernelFunc((function(o){return o.ifft(r)}),{input:n}).reshape(n.shape)}}),Y4=re({rfft_:function(n,e){Y(n.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+n.dtype}));var t,r=n.shape[n.shape.length-1],o=n.size/r;if(e!=null&&e<r){var s=n.shape.map((function(b){return 0})),i=n.shape.map((function(b){return b}));i[n.shape.length-1]=e,t=n.slice(s,i),r=e}else if(e!=null&&e>r){var a=n.shape.map((function(b){return b}));a[n.shape.length-1]=e-r,t=n.concat(Zn(a),n.shape.length-1),r=e}else t=n;var l=t.zerosLike(),c=So(t,l).as2D(o,r),u=X4(c),d=Math.floor(r/2)+1,h=Ei(u),p=Ka(u),g=h.split([d,r-d],h.shape.length-1),x=p.split([d,r-d],p.shape.length-1),y=t.shape.slice();return y[t.shape.length-1]=d,So(g[0],x[0]).reshape(y)}}),RA=re({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),o=Px(r);return Ei(o)}var s=[t,2*(e-1)],i=Ei(n).as2D(t,e),a=Ka(n).as2D(t,e),l=i.slice([0,1],[t,e-2]).reverse(1),c=a.slice([0,1],[t,e-2]).reverse(1).mul(et(-1)),u=i.concat(l,1),d=a.concat(c,1);return r=So(u,d).as2D(s[0],s[1]),o=Px(r),Ei(o)}}),dJ=Object.freeze({fft:X4,ifft:Px,rfft:Y4,irfft:RA}),hJ=re({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var o=X(n,"sparseIndices","sparseToDense","int32"),s=X(e,"sparseValues","sparseToDense"),i=X(r,"defaultValue","sparseToDense",s.dtype);return(function(a,l,c,u){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var d=a.rank>0?a.shape[0]:1,h=a.rank>1?a.shape[1]:1;if(c.length!==h)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+h+".");var p=l.size;if(l.rank!==0&&(l.rank!==1||p!==d))throw new Error("sparseValues has incorrect shape "+l.shape+", should be [] or ["+d+"]");if(l.dtype!==u.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(o,s,t,i),ce.runKernelFunc((function(a){return a.sparseToDense(o,s,t,i)}),{$sparseIndices:o,$sparseValues:s,$defaultValue:i})}}),fJ=re({gatherND_:function(n,e){var t=X(e,"indices","gatherND","int32"),r=X(n,"x","gatherND");return ce.runKernelFunc((function(o){return o.gatherND(r,t)}),{x:r,indices:t},null,"GatherNd")}}),pJ=re({diag_:function(n){var e=X(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return ce.runKernelFunc((function(r){return r.diag(e)}),{$x:e}).reshape(t)}}),mJ=re({dropout_:function(n,e,t,r){var o=X(n,"x","dropout");if(Y(o.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."})),Y(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),e===0)return n instanceof ur?o.clone():o;var s=(function(l,c){if(c==null)return l.shape.slice();if(uo(l.shape,c))return c;if(l.shape.length===c.length){for(var u=[],d=0;d<l.shape.length;d++)c[d]==null&&l.shape[d]!=null?u.push(l.shape[d]):u.push(c[d]);return u}return c})(o,t),i=1-e,a=ID(s,0,1,"float32",r).add(i).floor().div(i);return o.mul(a)}});function DA(n,e,t){for(var r=1-n%2,o=new Float32Array(n),s=0;s<n;++s){var i=2*Math.PI*s/(n+r-1);o[s]=e-t*Math.cos(i)}return $r(o,"float32")}var Z4=re({hannWindow_:function(n){return DA(n,.5,.5)}}),AA=re({hammingWindow_:function(n){return DA(n,.54,.46)}}),Q4=re({frame_:function(n,e,t,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var s=0,i=[];s+e<=n.size;)i.push(cl(n,s,e)),s+=t;if(r)for(;s<n.size;){var a=s+e-n.size,l=Yr([cl(n,s,e-a),tl([a],o)]);i.push(l),s+=t}return i.length===0?qc([],[0,e]):Yr(i).as2D(i.length,e)}}),_A=re({stft_:function(n,e,t,r,o){var s;o===void 0&&(o=Z4),r==null&&(s=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(s)/Math.log(2)))));for(var i=Q4(n,e,t),a=Xo(i,o(e)),l=[],c=0;c<i.shape[0];c++)l.push(Y4(a.slice([c,0],[1,e]),r));return Yr(l)}}),gJ=Object.freeze({hannWindow:Z4,hammingWindow:AA,frame:Q4,stft:_A}),qo,xJ=function(n,e,t){return t===void 0&&(t=1),pt(this,void 0,void 0,(function(){var r,o,s,i,a,l,c,u,d,h,p,g,x,y;return mt(this,(function(b){switch(b.label){case 0:return r=X(n,"predictions","inTopK"),o=X(e,"targets","inTopK"),Y(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),Y(r.rank-1===o.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank})),An(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),s=r.shape[r.shape.length-1],Y(t>0&&t<=s,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+s+"), but got "+t})),[4,r.data()];case 1:return i=b.sent(),[4,o.data()];case 2:for(a=b.sent(),l=[i.length/s,s],u=l[1],d=sm("bool",c=l[0]),h=0;h<c;h++){for(p=h*u,g=i.subarray(p,p+u),x=[],y=0;y<g.length;y++)x.push({value:g[y],index:y});for(x.sort((function(C,S){return S.value-C.value})),d[h]=0,y=0;y<t;y++)if(x[y].index===a[h]){d[h]=1;break}}return n!==r&&r.dispose(),e!==o&&o.dispose(),[2,Io(d,o.shape,"bool")]}}))}))};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(qo||(qo={}));var vJ=re({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=qo.SUM_BY_NONZERO_WEIGHTS);var o=X(n,"labels","absoluteDifference"),s=X(e,"predictions","absoluteDifference"),i=null;t!=null&&(i=X(t,"weights","absoluteDifference")),An(o.shape,s.shape,"Error in absoluteDifference: ");var a=o.sub(s).abs();return nc(a,i,r)}}),nc=re({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=qo.SUM_BY_NONZERO_WEIGHTS);var r=X(n,"losses","computeWeightedLoss"),o=null;e!=null&&(o=X(e,"weights","computeWeightedLoss"));var s=o==null?r:r.mul(o);if(t===qo.NONE)return s;if(t===qo.SUM)return s.sum();if(t===qo.MEAN){if(o==null)return s.mean();var i=r.size/o.size,a=s.sum().div(o.sum());return i>1?a.div(et(i)):a}if(t===qo.SUM_BY_NONZERO_WEIGHTS){if(o==null)return s.sum().div(et(r.size));var l=o.mul(Af(r.shape)).notEqual(et(0)).sum().toFloat();return s.sum().div(l)}throw Error("Unknown reduction: "+t)}}),yJ=re({cosineDistance_:function(n,e,t,r,o){o===void 0&&(o=qo.SUM_BY_NONZERO_WEIGHTS);var s=X(n,"labels","cosineDistance"),i=X(e,"predictions","cosineDistance"),a=null;r!=null&&(a=X(r,"weights","cosineDistance")),An(s.shape,i.shape,"Error in cosineDistance: ");var l=et(1).sub(s.mul(i).sum(t,!0));return nc(l,a,o)}}),bJ=re({hingeLoss_:function(n,e,t,r){r===void 0&&(r=qo.SUM_BY_NONZERO_WEIGHTS);var o=X(n,"labels","hingeLoss"),s=X(e,"predictions","hingeLoss"),i=null;t!=null&&(i=X(t,"weights","hingeLoss")),An(o.shape,s.shape,"Error in hingeLoss: ");var a=et(1);o=et(2).mul(o).sub(a);var l=a.sub(o.mul(s)).relu();return nc(l,i,r)}}),wJ=re({huberLoss_:function(n,e,t,r,o){r===void 0&&(r=1),o===void 0&&(o=qo.SUM_BY_NONZERO_WEIGHTS);var s=X(n,"labels","huberLoss"),i=X(e,"predictions","huberLoss"),a=null;t!=null&&(a=X(t,"weights","huberLoss")),An(s.shape,i.shape,"Error in huberLoss: ");var l=et(r),c=i.sub(s).abs(),u=dA(c,l),d=c.sub(u),h=et(.5).mul(u.square()).add(l.mul(d));return nc(h,a,o)}}),CJ=re({logLoss_:function(n,e,t,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=qo.SUM_BY_NONZERO_WEIGHTS);var s=X(n,"labels","logLoss"),i=X(e,"predictions","logLoss"),a=null;t!=null&&(a=X(t,"weights","logLoss")),An(s.shape,i.shape,"Error in logLoss: ");var l=et(1),c=et(r),u=s.mul(i.add(c).log()).neg().sub(l.sub(s).mul(l.sub(i).add(c).log()));return nc(u,a,o)}}),kJ=re({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=qo.SUM_BY_NONZERO_WEIGHTS);var o=X(n,"labels","meanSquaredError"),s=X(e,"predictions","meanSquaredError"),i=null;t!=null&&(i=X(t,"weights","meanSquaredError")),An(o.shape,s.shape,"Error in meanSquaredError: ");var a=o.squaredDifference(s);return nc(a,i,r)}}),SJ=re({sigmoidCrossEntropy_:function(n,e,t,r,o){r===void 0&&(r=0),o===void 0&&(o=qo.SUM_BY_NONZERO_WEIGHTS);var s=X(n,"multiClassLabels","sigmoidCrossEntropy"),i=X(e,"logits","sigmoidCrossEntropy"),a=null;if(t!=null&&(a=X(t,"weights","sigmoidCrossEntropy")),An(s.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var l=et(r),c=et(1),u=et(.5);s=s.mul(c.sub(l)).add(u.mul(l))}var d=(function(h,p){var g=X(h,"labels","sigmoidCrossEntropyWithLogits"),x=X(p,"logits","sigmoidCrossEntropyWithLogits");An(g.shape,x.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=x.relu(),b=x.mul(g),C=x.abs().neg().exp().log1p();return y.sub(b).add(C)})(s,i);return nc(d,a,o)}}),NJ=re({softmaxCrossEntropy_:function(n,e,t,r,o){r===void 0&&(r=0),o===void 0&&(o=qo.SUM_BY_NONZERO_WEIGHTS);var s=X(n,"onehotLabels","softmaxCrossEntropy"),i=X(e,"logits","softmaxCrossEntropy"),a=null;if(t!=null&&(a=X(t,"weights","softmaxCrossEntropy")),An(s.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var l=et(r),c=et(1),u=et(s.shape[1]);s=s.mul(c.sub(l)).add(l.div(u))}var d=(function(h,p,g){if(g===void 0&&(g=-1),g===-1&&(g=p.rank-1),g!==p.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+p.rank+" and dim was "+g);return Mv((function(x,y,b){var C=y.logSumExp([g],!0),S=y.toFloat().sub(C);return b([x,S]),{value:S.mul(x).neg().sum([g]),gradFunc:function(k,N){var E=N[0],_=N[1],$=Ms(k.shape,[g]);return[k.reshape($).mul(E.toFloat().sub(_.exp())),k.reshape($).mul(_.exp().sub(E.toFloat()))]}}}))(h,p)})(s,i);return nc(d,a,o)}}),IJ=Object.freeze({get Reduction(){return qo},absoluteDifference:vJ,computeWeightedLoss:nc,cosineDistance:yJ,hingeLoss:bJ,huberLoss:wJ,logLoss:CJ,meanSquaredError:kJ,sigmoidCrossEntropy:SJ,softmaxCrossEntropy:NJ});function NI(n,e){return e===void 0&&(e=!1),ce.tidy((function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],o=ND(t),s=n.clone(),i=qc([[1]],[1,1]),a=i.clone(),l=t>=r?r:t,c=function(d){var h,p=s,g=a,x=o;h=ce.tidy((function(){var y=s.slice([d,d],[t-d,1]),b=y.norm(),C=s.slice([d,d],[1,1]),S=qc([[-1]]).where(C.greater(0),qc([[1]])),k=C.sub(S.mul(b)),N=y.div(k);a=N.shape[0]===1?i.clone():i.concat(N.slice([1,0],[N.shape[0]-1,N.shape[1]]),0);var E=S.matMul(k).div(b).neg(),_=s.slice([d,0],[t-d,r]),$=E.mul(a);if(d===0)s=_.sub($.matMul(a.transpose().matMul(_)));else{var T=_.sub($.matMul(a.transpose().matMul(_)));s=s.slice([0,0],[d,r]).concat(T,0)}var D=o.slice([0,d],[t,o.shape[1]-d]);if(d===0)o=D.sub(D.matMul(a).matMul($.transpose()));else{var A=D.sub(D.matMul(a).matMul($.transpose()));o=o.slice([0,0],[t,d]).concat(A,1)}return[a,s,o]})),a=h[0],s=h[1],o=h[2],Ps([p,g,x])},u=0;u<l;++u)c(u);return!e&&t>r&&(o=o.slice([0,0],[t,r]),s=s.slice([0,0],[r,r])),[o,s]}))}var EJ=re({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=X(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,s=r.shape.slice(-2),i=s[0],a=s[1];if(!(e<=i))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+i+").");if(!(t<=a))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+a+").");e<0&&(e=i),t<0&&(t=a);var l=Nx(0,i,1,"int32").reshape([-1,1]),c=Nx(0,a,1,"int32"),u=Jr(l,c),d=Lv(u.lessEqual(et(+e,"int32")),u.greaterEqual(et(-t,"int32"))),h=Zn([i,a],r.dtype);return si(Zr(r.reshape([-1,i,a])).map((function(p){return pd(d,p,h)}))).reshape(o)}}),TJ=re({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,Y(n!=null&&n.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=n[0].shape[0],r=function(l){Y(n[l].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[l].shape[0]+" vs. "+t+")"}))},o=1;o<n.length;++o)r(o)}else e=!0,n=F4(n,n.shape[0],0).map((function(l){return TD(l,[0])}));Y(n.length<=n[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."}));var s=[],i=n,a=function(l){s.push(ce.tidy((function(){var c=i[l];if(l>0)for(var u=0;u<l;++u){var d=SA(s[u].mulStrict(c)).mul(s[u]);c=c.sub(d)}return c.div(TA(c,"euclidean"))})))};for(o=0;o<n.length;++o)a(o);return e?si(s,0):s}}),RJ=re({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return NI(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce((function(i,a){return i*a})),r=Zr(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],s=[];return r.forEach((function(i){var a=NI(i,e),l=a[0],c=a[1];o.push(l),s.push(c)})),[si(o,0).reshape(n.shape),si(s,0).reshape(n.shape)]}}),DJ=Object.freeze({bandPart:EJ,gramSchmidt:TJ,qr:RJ});function zv(n,e,t,r,o,s){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),s==null&&(s=0);var i=n.shape[0];return t=Math.min(t,i),Y(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),Y(n.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"})),Y(n.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]})),Y(e.rank===1,(function(){return"scores must be a 1D tensor"})),Y(e.shape[0]===i,(function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]})),Y(0<=s&&s<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+s+"'"})),{maxOutputSize:t,iouThreshold:r,scoreThreshold:o,softNmsSigma:s}}var AJ=re({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=X(n,"images","resizeBilinear");Y(r.rank===3||r.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),Y(e.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var o=r,s=!1;r.rank===3&&(s=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e[0],a=e[1],l=ce.runKernelFunc((function(c,u){return u([o]),c.resizeBilinear(o,i,a,t)}),{x:o},(function(c,u){return{x:function(){return ce.runKernelFunc((function(d){return d.resizeBilinearBackprop(c,u[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:i,newWidth:a});return s?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),_J=re({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=X(n,"images","resizeNearestNeighbor");Y(r.rank===3||r.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),Y(e.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),Y(r.dtype==="float32"||r.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var o=r,s=!1;r.rank===3&&(s=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e[0],a=e[1],l=ce.runKernelFunc((function(c,u){return u([o]),c.resizeNearestNeighbor(o,i,a,t)}),{batchImages:o},(function(c,u){return{batchImages:function(){return ce.runKernelFunc((function(d){return d.resizeNearestNeighborBackprop(c,u[0],t)}),{})}}}));return s?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),$J=re({nonMaxSuppression_:function(n,e,t,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var s=X(n,"boxes","nonMaxSuppression"),i=X(e,"scores","nonMaxSuppression"),a=zv(s,i,t,r,o);t=a.maxOutputSize,r=a.iouThreshold,o=a.scoreThreshold;var l={maxOutputSize:t,iouThreshold:r,scoreThreshold:o};return ce.runKernelFunc((function(c){return c.nonMaxSuppression(s,i,t,r,o)}),{boxes:s,scores:i},null,"NonMaxSuppressionV3",l)}}),FJ=function(n,e,t,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),pt(this,void 0,void 0,(function(){var s,i,a,l,c,u,d;return mt(this,(function(h){switch(h.label){case 0:return s=X(n,"boxes","nonMaxSuppressionAsync"),i=X(e,"scores","nonMaxSuppressionAsync"),a=zv(s,i,t,r,o),t=a.maxOutputSize,r=a.iouThreshold,o=a.scoreThreshold,[4,Promise.all([s.data(),i.data()])];case 1:return l=h.sent(),c=l[0],u=l[1],d=L4(c,u,t,r,o),s!==n&&s.dispose(),i!==e&&i.dispose(),[2,d]}}))}))},PJ=re({nonMaxSuppressionWithScore_:function(n,e,t,r,o,s){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),s===void 0&&(s=0);var i=X(n,"boxes","nonMaxSuppression"),a=X(e,"scores","nonMaxSuppression"),l=zv(i,a,t,r,o,s),c={maxOutputSize:t=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:o=l.scoreThreshold,softNmsSigma:s=l.softNmsSigma},u=ce.runKernel("NonMaxSuppressionV5",{boxes:i,scores:a},c);return{selectedIndices:u[0],selectedScores:u[1]}}}),MJ=function(n,e,t,r,o,s){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),s===void 0&&(s=0),pt(this,void 0,void 0,(function(){var i,a,l,c,u,d,h;return mt(this,(function(p){switch(p.label){case 0:return i=X(n,"boxes","nonMaxSuppressionAsync"),a=X(e,"scores","nonMaxSuppressionAsync"),l=zv(i,a,t,r,o,s),t=l.maxOutputSize,r=l.iouThreshold,o=l.scoreThreshold,s=l.softNmsSigma,[4,Promise.all([i.data(),a.data()])];case 1:return c=p.sent(),u=c[0],d=c[1],h=B4(u,d,t,r,o,s),i!==n&&i.dispose(),a!==e&&a.dispose(),[2,h]}}))}))},OJ=re({cropAndResize_:function(n,e,t,r,o,s){var i=X(n,"image","cropAndResize"),a=X(e,"boxes","cropAndResize","float32"),l=X(t,"boxInd","cropAndResize","int32");o=o||"bilinear",s=s||0;var c=a.shape[0];return Y(i.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."})),Y(a.rank===2&&a.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+a.shape+"."})),Y(l.rank===1&&l.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+a.shape+"."})),Y(r.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),Y(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),Y(o==="bilinear"||o==="nearest",(function(){return"method must be bilinear or nearest, but was "+o})),ce.runKernelFunc((function(u,d){return u.cropAndResize(i,a,l,r,o,s)}),{images:i,boxes:a,boxInd:l},null,"CropAndResize",{method:o,extrapolationValue:s,cropSize:r})}}),J4=Object.freeze({resizeBilinear:AJ,resizeNearestNeighbor:_J,nonMaxSuppression:$J,nonMaxSuppressionAsync:FJ,nonMaxSuppressionWithScore:PJ,nonMaxSuppressionWithScoreAsync:MJ,cropAndResize:OJ}),e5=function(n,e){return!(n>0)||e==="linear"},t5=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},n5=function(n,e){var t=e,r=Qr(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},r5=function(n,e,t){if(e==="linear")return n;if(e==="relu")return dr(n);if(e==="elu")return NA(n);if(e==="relu6")return EA(n);if(e==="prelu")return IA(n,t);throw new Error("Unknown fused activation "+e+".")},LJ=re({fusedMatMul_:function(n){var e,t=n.a,r=n.b,o=n.transposeA,s=o!==void 0&&o,i=n.transposeB,a=i!==void 0&&i,l=n.bias,c=n.activation,u=c===void 0?"linear":c,d=n.preluActivationWeights;if(e5(ce.state.gradientDepth,u)===!1){var h=jv(t,r,s,a);return l!=null&&(h=sn(h,l)),r5(h,u,d)}var p=X(t,"a","fused matMul"),g=X(r,"b","fused matMul");e=hr(p,g),p=e[0],g=e[1];var x=s?p.shape[p.rank-2]:p.shape[p.rank-1],y=a?g.shape[g.rank-1]:g.shape[g.rank-2],b=s?p.shape[p.rank-1]:p.shape[p.rank-2],C=a?g.shape[g.rank-2]:g.shape[g.rank-1],S=p.shape.slice(0,-2),k=g.shape.slice(0,-2),N=yt(S),E=yt(k);Y(p.rank>=2&&g.rank>=2&&p.rank===g.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+g.rank+"."})),Y(uo(S,k),(function(){return"Error in fused matMul: outer dimensions ("+S+") and ("+k+") of Tensors with shapes "+p.shape+" and "+g.shape+" must match."})),Y(x===y,(function(){return"Error in fused matMul: inner shapes ("+x+") and ("+y+") of Tensors with shapes "+p.shape+" and "+g.shape+" and transposeA="+s+" and transposeB="+a+" must match."}));var _,$,T=p.shape.slice(0,-2).concat([b,C]),D=s?p.as3D(N,x,b):p.as3D(N,b,x),A=a?g.as3D(E,C,y):g.as3D(E,y,C);l!=null&&ln(T,(_=hr(_=X(l,"bias","fused matMul"),p)[0]).shape),d!=null&&($=X(d,"prelu weights","fused matMul"));var M={a:D,b:A};l!=null&&(M.bias=_),d!=null&&(M.preluActivationWeights=$);var j=[D,A];return ce.runKernelFunc((function(L,U){var G=L.fusedBatchMatMul({a:D,b:A,transposeA:s,transposeB:a,bias:_,activation:u,preluActivationWeights:$});return U([D,A,G]),G}),M,(function(L,U){var G=U[0],H=U[1],O=U[2],V=t5(L,O,u),W={};return l!=null&&(W={bias:function(){return n5(_,V)}}),Object.assign(s||a?!s&&a?{a:function(){return V.matMul(H,!1,!1)},b:function(){return V.matMul(G,!0,!1)}}:s&&!a?{a:function(){return H.matMul(V,!1,!0)},b:function(){return G.matMul(V,!1,!1)}}:{a:function(){return H.matMul(V,!0,!0)},b:function(){return V.matMul(G,!0,!0)}}:{a:function(){return V.matMul(H,!1,!0)},b:function(){return G.matMul(V,!0,!1)}},W)}),"_FusedMatMul",{transposeA:s,transposeB:a,activation:u},j,[!0]).reshape(T)}}),BJ=re({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,o=n.pad,s=n.dataFormat,i=s===void 0?"NHWC":s,a=n.dilations,l=a===void 0?[1,1]:a,c=n.dimRoundingMode,u=n.bias,d=n.activation,h=d===void 0?"linear":d,p=n.preluActivationWeights;if(h=h||"linear",e5(ce.state.gradientDepth,h)===!1){var g=Fi(e,t,r,o,i,l,c);return u!=null&&(g=sn(g,u)),r5(g,h,p)}var x=X(e,"x","conv2d"),y=X(t,"filter","conv2d"),b=x,C=!1;x.rank===3&&(C=!0,b=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),Y(b.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+b.rank+"."})),Y(y.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."})),c!=null&&Y(Nr(o),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."})),Y(b.shape[3]===y.shape[2],(function(){return"Error in conv2d: depth of input ("+b.shape[3]+") must match input depth for filter "+y.shape[2]+"."})),Y(Os(r,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"})),Y(i==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."}));var S,k,N=Fd(b.shape,y.shape,r,l,o,c);u!=null&&(S=hr(S=X(u,"bias","fused conv2d"),x)[0],ln(N.outShape,S.shape)),p!=null&&(k=X(p,"prelu weights","fused conv2d"));var E={x:b,filter:y};u!=null&&(E.bias=S),p!=null&&(E.preluActivationWeights=k);var _=[y,b],$=ce.runKernelFunc((function(T,D){var A=T.fusedConv2d({input:b,filter:y,convInfo:N,bias:S,activation:h,preluActivationWeights:k});return D([y,b,A]),A}),E,(function(T,D){var A=D,M=A[0],j=A[1],L=A[2],U=t5(T,L,h);Y(hf(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+l+"'"}));var G={};return u!=null&&(G={bias:function(){return n5(S,U)}}),Object.assign({x:function(){return xA(j.shape,U,M,r,o)},filter:function(){return q4(j,U,M.shape,r,o)}},G)}),"FusedConv2D",{convInfo:N,activation:h},_,[!0]);return C?$.as3D($.shape[1],$.shape[2],$.shape[3]):$}}),jJ=re({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,o=n.pad,s=n.dataFormat,i=s===void 0?"NHWC":s,a=n.dilations,l=a===void 0?[1,1]:a,c=n.dimRoundingMode,u=n.bias,d=n.activation,h=d===void 0?"linear":d,p=n.preluActivationWeights;if(e5(ce.state.gradientDepth,h)===!1){var g=Bv(e,t,r,o,i,l,c);return u!=null&&(g=sn(g,u)),r5(g,h,p)}var x=X(e,"x","depthwiseConv2d"),y=X(t,"filter","depthwiseConv2d"),b=x,C=!1;x.rank===3&&(C=!0,b=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),Y(b.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+b.rank+"."})),Y(y.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."})),Y(b.shape[3]===y.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+b.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."})),l==null&&(l=[1,1]),Y(Os(r,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"})),c!=null&&Y(Nr(o),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."}));var S,k,N=Fd(b.shape,y.shape,r,l,o,c,!0);u!=null&&(S=hr(S=X(u,"bias","fused conv2d"),x)[0],ln(N.outShape,S.shape)),p!=null&&(k=X(p,"prelu weights","fused depthwiseConv2d"));var E={x:b,filter:y};u!=null&&(E.bias=S),p!=null&&(E.preluActivationWeights=k);var _=[y,b],$=ce.runKernelFunc((function(T,D){var A=T.fusedDepthwiseConv2D({input:b,filter:y,convInfo:N,bias:S,activation:h,preluActivationWeights:k});return D([y,b,A]),A}),E,(function(T,D){Y(hf(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+l+"'"}));var A=D[0],M=D[1],j=D[2],L=t5(T,j,h),U={};return u!=null&&(U={bias:function(){return n5(S,L)}}),Object.assign({x:function(){return vA(M.shape,L,A,N)},filter:function(){return yA(M,L,A.shape,N)}},U)}),"FusedDepthwiseConv2D",{convInfo:N,activation:h},_,[!0]);return C?$.as3D($.shape[1],$.shape[2],$.shape[3]):$}}),VJ=Object.freeze({matMul:LJ,conv2d:BJ,depthwiseConv2d:jJ}),zJ=Object.freeze({image:J4,linalg:DJ,losses:IJ,spectral:dJ,fused:VJ,signal:gJ,square:CZ,squaredDifference:tA,conv1d:AQ,conv2d:Fi,conv3d:_Q,depthwiseConv2d:Bv,separableConv2d:K4,conv2dTranspose:$Q,conv3dTranspose:FQ,op:re,batchNormalization2d:QZ,batchNormalization3d:JZ,batchNormalization4d:eQ,batchNormalization:tQ,batchNorm:aA,batchNorm2d:nQ,batchNorm3d:rQ,batchNorm4d:oQ,booleanMaskAsync:DQ,complex:So,real:Ei,imag:Ka,concat:Yr,concat1d:VK,concat2d:zK,concat3d:WK,concat4d:UK,split:F4,matMul:jv,dot:PQ,outerProduct:MQ,reverse:Pm,reverse1d:OQ,reverse2d:LQ,reverse3d:BQ,reverse4d:jQ,maxPool:lo,avgPool:Mm,pool:VQ,maxPool3d:zQ,avgPool3d:WQ,slice:cl,slice1d:UQ,slice2d:HQ,slice3d:CA,slice4d:GQ,abs:kZ,acos:SZ,acosh:NZ,asin:IZ,asinh:EZ,atan:TZ,atanh:RZ,ceil:DZ,clipByValue:U4,cos:AZ,cosh:_Z,erf:$Z,exp:fC,expm1:FZ,floor:PZ,log:MZ,log1p:OZ,logSigmoid:LZ,neg:$x,reciprocal:BZ,round:jZ,rsqrt:nA,sigmoid:rA,sign:VZ,isNaN:zZ,isInf:WZ,isFinite:UZ,sin:HZ,sinh:GZ,softplus:qZ,sqrt:KZ,step:XZ,tan:YZ,tanh:ZZ,all:qQ,any:KQ,argMax:XQ,argMin:YQ,logSumExp:ZQ,max:Vv,mean:QQ,min:JQ,moments:eJ,sum:SA,prod:tJ,equal:hA,equalStrict:bQ,greater:wQ,greaterEqual:fA,greaterEqualStrict:CQ,greaterStrict:kQ,less:SQ,lessEqual:NQ,lessEqualStrict:IQ,lessStrict:EQ,notEqual:TQ,notEqualStrict:RQ,add:sn,addN:aQ,addStrict:lQ,atan2:cQ,div:na,divNoNan:uQ,divStrict:dQ,floorDiv:uA,maximum:H4,maximumStrict:hQ,minimum:dA,minimumStrict:fQ,mod:pQ,modStrict:mQ,mul:Xo,mulStrict:gQ,pow:Fx,powStrict:xQ,squaredDifferenceStrict:vQ,sub:Jr,subStrict:yQ,elu:NA,leakyRelu:nJ,prelu:IA,relu:dr,relu6:EA,selu:rJ,logicalAnd:Lv,logicalNot:sQ,logicalOr:lA,logicalXor:iQ,where:pd,whereAsync:cA,buffer:Wt,print:JK,batchToSpaceND:SD,broadcastTo:eX,cast:tX,clone:nX,cumsum:rX,depthToSpace:oX,expandDims:Ii,eye:ND,multinomial:sX,oneHot:cC,pad:$d,pad1d:iX,pad2d:aX,pad3d:lX,pad4d:cX,rand:uX,randomNormal:dX,randomGamma:hX,randomUniform:ID,reshape:sa,spaceToBatchND:ED,squeeze:TD,stack:si,tile:Kh,truncatedNormal:fX,unstack:Zr,setdiff1dAsync:pX,fill:tl,linspace:jK,ones:Af,range:Nx,scalar:et,tensor:Io,tensor1d:$r,tensor2d:qc,tensor3d:$4,tensor4d:As,tensor5d:OK,tensor6d:LK,variable:BK,zeros:Zn,onesLike:kD,zerosLike:gn,transpose:nu,softmax:tc,logSoftmax:wX,localResponseNormalization:oJ,norm:TA,gather:G4,unsortedSegmentSum:pA,basicLSTMCell:sJ,multiRNNCell:iJ,movingAverage:aJ,stridedSlice:lJ,topk:cJ,scatterND:uJ,fft:X4,ifft:Px,rfft:Y4,irfft:RA,sparseToDense:hJ,gatherND:fJ,diag:pJ,dropout:mJ,hannWindow:Z4,hammingWindow:AA,frame:Q4,stft:_A,inTopKAsync:xJ});function Me(n,e){Array.isArray(n)||(n=[n]),n.forEach((function(t){t!=null&&Y(t.dtype!=="complex64",(function(){return e+" does not support complex64 tensors."}))}))}function n3(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var WJ=(function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new PD(t,ce),t}return xa(e,n),e.prototype.write=function(t,r,o){this.firstUse&&(this.firstUse=!1,Ae().get("IS_NODE")&&kx(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var s={};return this.data.set(s,{values:t,dtype:o}),s},e.prototype.move=function(t,r,o,s){this.data.set(t,{values:r,dtype:s})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return pt(this,void 0,void 0,(function(){return mt(this,(function(r){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var r=this.data.get(t),o=r.dtype,s=r.complexTensors;return o==="complex64"?hC(this.readSync(s.real.dataId),this.readSync(s.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),o=r;if(t.dtype==="string")try{o=r.map((function(s){return bx(s)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Wt(t.shape,t.dtype,o)},e.prototype.makeOutput=function(t,r,o){var s=this.write(t,r,o);return ce.makeTensorFromDataId(s,r,o,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return pt(this,void 0,void 0,(function(){var r;return mt(this,(function(o){return r=za(),t(),[2,{kernelMs:za()-r}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var o=this.makeOutput(null,t.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:ce.keep(t.clone()),imag:ce.keep(r.clone())},o},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,o){if(Me(t,"slice"),$D(t.shape,r,o)){var s=FD(r,t.strides),i=yt(o);return Io(this.readSync(t.dataId).subarray(s,s+i),o,t.dtype)}for(var a=Wt(o,t.dtype),l=this.bufferSync(t),c=0;c<a.size;++c){var u=a.indexToLoc(c).map((function(d,h){return d+r[h]}));a.values[c]=l.get.apply(l,u)}return a.toTensor()},e.prototype.stridedSlice=function(t,r,o,s){Me(t,"stridedSlice");var i=M4(r,o,s);if(i.some((function(p){return p===0})))return Io([],i);for(var a=Wt(i,t.dtype),l=this.bufferSync(t),c=0;c<a.size;c++){for(var u=a.indexToLoc(c),d=new Array(u.length),h=0;h<d.length;h++)d[h]=u[h]*s[h]+r[h];a.set.apply(a,[l.get.apply(l,d)].concat(u))}return a.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),o=Wt([t.size,t.size],t.dtype),s=o.values,i=0;i<r.length;i++)s[i*t.size+i]=r[i];return o.toTensor()},e.prototype.unstack=function(t,r){for(var o=t.shape[r],s=new Array(t.rank-1),i=0,a=0;a<t.rank;a++)a!==r&&(s[i++]=t.shape[a]);var l=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var u=new Array(o);for(a=0;a<u.length;a++)l[r]=a,u[a]=this.slice(t,l,c).reshape(s);return u},e.prototype.reverse=function(t,r){Me(t,"reverse");for(var o=Wt(t.shape,t.dtype),s=this.bufferSync(t),i=function(l){var c=o.indexToLoc(l),u=c.slice();r.forEach((function(d){return u[d]=t.shape[d]-1-u[d]})),o.set.apply(o,[s.get.apply(s,u)].concat(c))},a=0;a<o.size;a++)i(a);return o.toTensor()},e.prototype.concat=function(t,r){var o=this;if(t[0].dtype==="complex64"){var s=t.map((function(p){return Ei(p)})),i=t.map((function(p){return Ka(p)}));return So(this.concat(s,r),this.concat(i,r))}var a=t.map((function(p){var g=yt(p.shape.slice(r));return p.as2D(-1,g)})),l=df(a.map((function(p){return p.shape})),1),c=Wt(l,t[0].dtype).values;if(a[0].shape[0]===1){var u=0;a.forEach((function(p){c.set(o.readSync(p.dataId),u),u+=p.size}))}else{var d=0;a.forEach((function(p){for(var g=o.readSync(p.dataId),x=0,y=0;y<p.shape[0];++y)for(var b=y*l[1]+d,C=0;C<p.shape[1];++C)c[b+C]=g[x++];d+=p.shape[1]}))}var h=df(t.map((function(p){return p.shape})),r);return Io(c,h,t[0].dtype)},e.prototype.neg=function(t){return Me(t,"neg"),this.multiply(et(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,s,i,a){return{real:o+i,imag:s+a}})):this.broadcastedBinaryOp(t,r,No(t.dtype,r.dtype),(function(o,s){return o+s}))},e.prototype.addN=function(t){var r=this;Me(t,"addN");for(var o=t.map((function(u){return r.readSync(u.dataId)})),s=Wt(t[0].shape,t[0].dtype),i=s.values,a=0;a<t.length;a++)for(var l=o[a],c=0;c<i.length;c++)i[c]+=l[c];return s.toTensor()},e.prototype.softmax=function(t,r){var o=eo([r],t.shape),s=this.max(t,o),i=Ms(s.shape,o),a=this.subtract(t,s.reshape(i)),l=this.exp(a),c=this.sum(l,o).reshape(i);return this.realDivide(l,c)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,s,i,a){return{real:o-i,imag:s-a}})):this.broadcastedBinaryOp(t,r,No(t.dtype,r.dtype),(function(o,s){return o-s}))},e.prototype.pow=function(t,r){return Me([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,s){return Math.pow(o,s)}))},e.prototype.batchMatMul=function(t,r,o,s){Me([t,r],"matMul");for(var i=o?t.shape[1]:t.shape[2],a=o?t.shape[2]:t.shape[1],l=s?r.shape[1]:r.shape[2],c=t.shape[0],u=this.readSync(t.dataId),d=this.readSync(r.dataId),h=o?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],p=h[0],g=h[1],x=h[2],y=s?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],b=y[0],C=y[1],S=y[2],k=a*l,N=Wt([c,a,l],t.dtype),E=N.values,_=this.blockSize,$=0;$<c;$++)for(var T=0;T<a;T+=_)for(var D=0;D<l;D+=_)for(var A=0;A<i;A+=_)for(var M=Math.min(T+_,a),j=Math.min(D+_,l),L=Math.min(A+_,i),U=T;U<M;U++)for(var G=D;G<j;G++){for(var H=0,O=A;O<L;O++)H+=u[$*p+U*g+O*x]*d[O*b+G*C+$*S];E[$*k+(U*l+G)]+=H}return N.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,o=t.b,s=t.transposeA,i=t.transposeB,a=t.bias,l=t.activation,c=t.preluActivationWeights,u=this.batchMatMul(r,o,s,i);return a&&(u=this.add(u,a)),l&&(u=n3(this,u,l,c)),u},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,s,i,a){return{real:o*i-s*a,imag:o*a+s*i}})):this.broadcastedBinaryOp(t,r,No(t.dtype,r.dtype),(function(o,s){return o*s}))},e.prototype.realDivide=function(t,r){return Me([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",(function(o,s){return o/s}))},e.prototype.floorDiv=function(t,r){return Me([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",(function(o,s){return Math.floor(o/s)}))},e.prototype.sum=function(t,r){Me(t,"sum"),Ys("sum",r,t.rank);for(var o=zo(t.shape,r),s=o[0],i=o[1],a=Zn(s,No(t.dtype,"int32")),l=yt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var h=d*l,p=0,g=0;g<l;++g)p+=u[h+g];c[d]=p}return a},e.prototype.prod=function(t,r){Me(t,"sum");for(var o=zo(t.shape,r),s=o[0],i=o[1],a=Zn(s,No(t.dtype,"int32")),l=yt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var h=d*l,p=1,g=0;g<l;++g)p*=u[h+g];c[d]=p}return a},e.prototype.unsortedSegmentSum=function(t,r,o){Me(t,"unsortedSegmentSum");for(var s=[],i=t.rank-r.rank,a=0;a<i;++a)r=r.expandDims(a+1);for(a=0;a<o;++a){var l=et(a,"int32"),c=hA(l,r).asType("float32").mul(t).sum(0);s.push(c)}return si(s)},e.prototype.argMin=function(t,r){Me(t,"argMin");var o=[r];Ys("argMin",o,t.rank);for(var s=zo(t.shape,o),i=s[0],a=s[1],l=Zn(i,"int32"),c=yt(a),u=this.readSync(l.dataId),d=this.readSync(t.dataId),h=0;h<u.length;++h){for(var p=h*c,g=d[p],x=0,y=0;y<c;++y){var b=d[p+y];b<g&&(g=b,x=y)}u[h]=x}return l},e.prototype.argMax=function(t,r){Me(t,"argMax");var o=[r];Ys("argMax",o,t.rank);for(var s=zo(t.shape,o),i=s[0],a=s[1],l=Zn(i,"int32"),c=yt(a),u=this.readSync(l.dataId),d=this.readSync(t.dataId),h=0;h<u.length;++h){for(var p=h*c,g=d[p],x=0,y=0;y<c;++y){var b=d[p+y];b>g&&(g=b,x=y)}u[h]=x}return l},e.prototype.cumsum=function(t,r,o,s){if(Me(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var i=No(t.dtype,"int32"),a=Zn(t.shape,i),l=this.readSync(a.dataId),c=this.readSync(t.dataId),u=t.shape[t.rank-1],d=s?function(y,b){return y+u-b-1}:function(y,b){return y+b},h=0;h<c.length;h+=u)for(var p=0;p<u;p++){var g=d(h,p);if(p===0)l[g]=o?0:c[g];else{var x=d(h,p-1);l[g]=o?c[x]+l[x]:c[g]+l[x]}}return a},e.prototype.equal=function(t,r){return Me([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",(function(o,s){return o===s?1:0}))},e.prototype.notEqual=function(t,r){return Me([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,s){return o!==s?1:0}))},e.prototype.less=function(t,r){return Me([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",(function(o,s){return o<s?1:0}))},e.prototype.lessEqual=function(t,r){return Me([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,s){return o<=s?1:0}))},e.prototype.greater=function(t,r){return Me([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",(function(o,s){return o>s?1:0}))},e.prototype.greaterEqual=function(t,r){return Me([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,s){return o>=s?1:0}))},e.prototype.logicalNot=function(t){Me(t,"logicalNot");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),s=0;s<r.length;++s)o[s]=r[s]?0:1;return this.makeOutput(o,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Me([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",(function(o,s){return o&&s}))},e.prototype.logicalOr=function(t,r){return Me([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",(function(o,s){return o||s}))},e.prototype.select=function(t,r,o){Me([t,r,o],"select");for(var s=this.readSync(t.dataId),i=this.readSync(r.dataId),a=this.readSync(o.dataId),l=Zn(r.shape,No(r.dtype,o.dtype)),c=this.readSync(l.dataId),u=0,d=t.rank===0||t.rank>1||r.rank===1?1:yt(r.shape.slice(1)),h=0;h<s.length;h++)for(var p=0;p<d;p++)s[h]===1?c[u++]=i[h]:c[u++]=a[h];return l},e.prototype.where=function(t){Me([t],"where");var r=this.readSync(t.dataId);return j4(t.shape,r)},e.prototype.topk=function(t,r,o){return Me(t,"topk"),WD(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Me(t,"min"),Ys("min",r,t.rank);for(var o=zo(t.shape,r),s=o[0],i=o[1],a=Zn(s,t.dtype),l=yt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var h=d*l,p=u[h],g=0;g<l;++g){var x=u[h+g];x<p&&(p=x)}c[d]=p}return a},e.prototype.minimum=function(t,r){return Me([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,s){return Math.min(o,s)}))},e.prototype.mod=function(t,r){return Me([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,s){var i=o%s;return o<0&&s<0||o>=0&&s>=0?i:(i+s)%s}))},e.prototype.max=function(t,r){Me(t,"max"),Ys("max",r,t.rank);for(var o=zo(t.shape,r),s=o[0],i=o[1],a=Zn(s,t.dtype),l=yt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var h=d*l,p=u[h],g=0;g<l;++g){var x=u[h+g];x>p&&(p=x)}c[d]=p}return a},e.prototype.maximum=function(t,r){return Me([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,s){return Math.max(o,s)}))},e.prototype.all=function(t,r){Me(t,"all"),Ys("all",r,t.rank);for(var o=zo(t.shape,r),s=o[0],i=o[1],a=Zn(s,t.dtype),l=yt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var h=d*l,p=u[h],g=0;g<l;++g){var x=u[h+g];p=p&&x}c[d]=p}return a},e.prototype.any=function(t,r){Me(t,"any"),Ys("any",r,t.rank);for(var o=zo(t.shape,r),s=o[0],i=o[1],a=Zn(s,t.dtype),l=yt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var h=d*l,p=u[h],g=0;g<l;++g){var x=u[h+g];p=p||x}c[d]=p}return a},e.prototype.squaredDifference=function(t,r){return Me([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,s){var i=o-s;return i*i}))},e.prototype.ceil=function(t){Me(t,"ceil");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s)o[s]=Math.ceil(r[s]);return this.makeOutput(o,t.shape,"float32")},e.prototype.floor=function(t){Me(t,"floor");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s)o[s]=Math.floor(r[s]);return this.makeOutput(o,t.shape,"float32")},e.prototype.sign=function(t){Me(t,"x");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s)r[s]<0?o[s]=-1:r[s]>0?o[s]=1:o[s]=0;return this.makeOutput(o,t.shape,"float32")},e.prototype.isNaN=function(t){Me(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),s=0;s<r.length;++s)Number.isNaN(r[s])&&(o[s]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.isInf=function(t){Me(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),s=0;s<r.length;++s)Math.abs(r[s])===1/0&&(o[s]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.isFinite=function(t){Me(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),s=0;s<r.length;++s)Number.isFinite(r[s])&&(o[s]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.round=function(t){Me(t,"round");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s){var i=Math.floor(r[s]);r[s]-i<.5?o[s]=Math.floor(r[s]):r[s]-i>.5?o[s]=Math.ceil(r[s]):o[s]=i%2==0?i:i+1}return this.makeOutput(o,t.shape,"float32")},e.prototype.exp=function(t){Me(t,"exp");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s)o[s]=Math.exp(r[s]);return this.makeOutput(o,t.shape,"float32")},e.prototype.expm1=function(t){Me(t,"expm1");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s)o[s]=Math.expm1(r[s]);return this.makeOutput(o,t.shape,"float32")},e.prototype.log=function(t){Me(t,"log");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s){var i=r[s];o[s]=Math.log(i)}return this.makeOutput(o,t.shape,"float32")},e.prototype.log1p=function(t){Me(t,"log1p");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s){var i=r[s];o[s]=Math.log1p(i)}return this.makeOutput(o,t.shape,"float32")},e.prototype.sqrt=function(t){Me(t,"sqrt");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s){var i=r[s];o[s]=Math.sqrt(i)}return this.makeOutput(o,t.shape,"float32")},e.prototype.rsqrt=function(t){Me(t,"rsqrt");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s){var i=r[s];o[s]=1/Math.sqrt(i)}return this.makeOutput(o,t.shape,"float32")},e.prototype.reciprocal=function(t){Me(t,"reciprocal");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),s=0;s<r.length;++s)o[s]=1/r[s];return this.makeOutput(o,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Me(t,"relu");for(var r=Zn(t.shape,t.dtype),o=this.readSync(r.dataId),s=this.readSync(t.dataId),i=0;i<s.length;++i)o[i]=Math.max(0,s[i]);return r},e.prototype.relu6=function(t){Me(t,"relu");for(var r=Zn(t.shape,t.dtype),o=this.readSync(r.dataId),s=this.readSync(t.dataId),i=0;i<s.length;++i)o[i]=Math.min(Math.max(0,s[i]),6);return r},e.prototype.prelu=function(t,r){return Me([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,s){return o<0?s*o:o}))},e.prototype.elu=function(t){Me(t,"elu");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var i=o[s];r[s]=i>=0?i:Math.exp(i)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Me([t,r],"eluDer");for(var o=new Float32Array(r.size),s=this.readSync(r.dataId),i=this.readSync(t.dataId),a=0;a<s.length;++a){var l=s[a];o[a]=l>=1?i[a]:i[a]*(l+1)}return this.makeOutput(o,r.shape,"float32")},e.prototype.selu=function(t){Me(t,"selu");for(var r=z4,o=W4,s=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var l=i[a];s[a]=l>=0?o*l:r*(Math.exp(l)-1)}return this.makeOutput(s,t.shape,"float32")},e.prototype.clip=function(t,r,o){Me(t,"clip");for(var s=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var l=i[a];s[a]=l>o?o:l<r?r:l}return this.makeOutput(s,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.abs(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<t.size;++s){var i=o[2*s],a=o[2*s+1];r[s]=Math.hypot(i,a)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Me(t,"int");for(var r=new Int32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=o[s];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Me(t,"sigmoid");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=1/(1+Math.exp(-o[s]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Me(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i){var a=s[i]>-r,l=s[i]<r,c=Math.exp(s[i]),u=void 0;u=l?c:a?s[i]:Math.log(1+c),o[i]=u}return this.makeOutput(o,t.shape,"float32")},e.prototype.sin=function(t){Me(t,"sin");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.sin(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Me(t,"cos");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.cos(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Me(t,"tan");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.tan(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Me(t,"asin");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.asin(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Me(t,"acos");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.acos(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Me(t,"atan");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.atan(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Me([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,s){return Math.atan2(o,s)}))},e.prototype.sinh=function(t){Me(t,"sinh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.sinh(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Me(t,"cosh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.cosh(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Me(t,"tanh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Uq(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Me(t,"asinh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.asinh(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Me(t,"acosh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.acosh(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Me(t,"atanh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s)r[s]=Math.atanh(o[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Me(t,"erf");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var i=Math.sign(o[s]),a=Math.abs(o[s]),l=1/(1+.3275911*a);r[s]=i*(1-((((1.061405429*l-1.453152027)*l+1.421413741)*l-.284496736)*l+.254829592)*l*Math.exp(-a*a))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Me(t,"step");for(var o=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i){var a=s[i];isNaN(a)?o[i]=NaN:o[i]=a>0?1:r}return this.makeOutput(o,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,o=t.filter,s=t.convInfo,i=t.bias,a=t.activation,l=t.preluActivationWeights,c=this.conv2d(r,o,s);return i&&(c=this.add(c,i)),a&&(c=n3(this,c,a,l)),c},e.prototype.conv2d=function(t,r,o){Me([t,r],"conv2d");for(var s=o.filterHeight,i=o.filterWidth,a=o.dilationHeight,l=o.dilationWidth,c=o.padInfo.left,u=o.padInfo.top,d=o.dataFormat==="channelsLast",h=Wt(o.outShape,t.dtype),p=t.strides[0],g=d?t.strides[1]:t.strides[2],x=d?t.strides[2]:1,y=d?1:t.strides[1],b=h.strides[0],C=d?h.strides[1]:h.strides[2],S=d?h.strides[2]:1,k=d?1:h.strides[1],N=this.readSync(t.dataId),E=this.readSync(r.dataId),_=h.values,$=0;$<o.batchSize;++$)for(var T=$*p,D=$*b,A=0;A<o.outHeight;++A)for(var M=D+A*C,j=A*o.strideHeight-u,L=0;L<s;L++){var U=j+L*a;if(!(U<0||U>=o.inHeight))for(var G=L*r.strides[0],H=T+U*g,O=0;O<o.outWidth;++O)for(var V=M+O*S,W=O*o.strideWidth-c,B=0;B<i;B++){var q=W+B*l;if(!(q<0||q>=o.inWidth))for(var Q=H+q*x,Z=G+B*r.strides[1],ne=0;ne<o.inChannels;++ne){for(var ge=N[Q+ne*y],he=0;he<o.outChannels;++he)_[V+he*k]+=ge*E[Z+he];Z+=o.outChannels}}}return h.toTensor()},e.prototype.conv3d=function(t,r,o){for(var s=o.filterDepth,i=o.filterHeight,a=o.filterWidth,l=o.dilationDepth,c=o.dilationHeight,u=o.dilationWidth,d=o.padInfo.front,h=o.padInfo.left,p=o.padInfo.top,g=Wt(o.outShape,t.dtype),x=this.readSync(t.dataId),y=this.readSync(r.dataId),b=g.values,C=0;C<o.batchSize;++C)for(var S=C*t.strides[0],k=C*g.strides[0],N=0;N<o.outDepth;++N)for(var E=k+N*g.strides[1],_=N*o.strideDepth-d,$=0;$<s;$++){var T=_+$*l;if(!(T<0||T>=o.inDepth))for(var D=$*r.strides[0],A=S+T*t.strides[1],M=0;M<o.outHeight;++M)for(var j=E+M*g.strides[2],L=M*o.strideHeight-p,U=0;U<i;U++){var G=L+U*c;if(!(G<0||G>=o.inHeight))for(var H=D+U*r.strides[1],O=A+G*t.strides[2],V=0;V<o.outWidth;++V)for(var W=j+V*o.outChannels,B=V*o.strideWidth-h,q=0;q<a;q++){var Q=B+q*u;if(!(Q<0||Q>=o.inWidth))for(var Z=H+q*r.strides[2],ne=O+Q*o.inChannels,ge=Z,he=0;he<o.inChannels;++he){for(var Se=x[ne+he],Re=0;Re<o.outChannels;++Re)b[W+Re]+=Se*y[ge+Re];ge+=o.outChannels}}}}return g.toTensor()},e.prototype.conv2dDerInput=function(t,r,o){Me([t,r],"conv2dDerInput");for(var s=Wt(o.inShape,"float32"),i=s.values,a=this.readSync(t.dataId),l=this.readSync(r.dataId),c=r.strides,u=c[0],d=c[1],h=c[2],p=o.batchSize,g=o.filterHeight,x=o.filterWidth,y=o.inChannels,b=o.inHeight,C=o.inWidth,S=o.outChannels,k=o.outHeight,N=o.outWidth,E=o.strideHeight,_=o.strideWidth,$=o.dataFormat,T=g-1-o.padInfo.top,D=x-1-o.padInfo.left,A=$==="channelsLast",M=s.strides[0],j=A?s.strides[1]:s.strides[2],L=A?s.strides[2]:1,U=A?1:s.strides[1],G=t.strides[0],H=A?t.strides[1]:t.strides[2],O=A?t.strides[2]:1,V=A?1:t.strides[1],W=0;W<p;++W)for(var B=0;B<y;++B)for(var q=0;q<b;++q)for(var Q=q-T,Z=Math.max(0,Math.ceil(Q/E)),ne=Math.min(k,(g+Q)/E),ge=0;ge<C;++ge){for(var he=ge-D,Se=Math.max(0,Math.ceil(he/_)),Re=Math.min(N,(x+he)/_),We=0,Be=Z;Be<ne;++Be)for(var Xe=Be*E-Q,Ye=Se;Ye<Re;++Ye)for(var ot=G*W+H*Be+O*Ye,Qe=u*(g-1-Xe)+d*(x-1-(Ye*_-he))+h*B,ct=0;ct<S;++ct)We+=a[ot+V*ct]*l[Qe+ct];i[M*W+j*q+L*ge+U*B]=We}return s.toTensor()},e.prototype.conv3dDerInput=function(t,r,o){for(var s=Wt(o.inShape,"float32"),i=s.values,a=s.strides,l=a[0],c=a[1],u=a[2],d=a[3],h=this.readSync(t.dataId),p=t.strides,g=p[0],x=p[1],y=p[2],b=p[3],C=this.readSync(r.dataId),S=r.strides,k=S[0],N=S[1],E=S[2],_=S[3],$=o.batchSize,T=o.filterDepth,D=o.filterHeight,A=o.filterWidth,M=o.inChannels,j=o.inDepth,L=o.inHeight,U=o.inWidth,G=o.outChannels,H=o.outDepth,O=o.outHeight,V=o.outWidth,W=o.strideDepth,B=o.strideHeight,q=o.strideWidth,Q=T-1-o.padInfo.front,Z=D-1-o.padInfo.top,ne=A-1-o.padInfo.left,ge=0;ge<$;++ge)for(var he=0;he<M;++he)for(var Se=0;Se<j;++Se)for(var Re=Se-Q,We=Math.max(0,Math.ceil(Re/W)),Be=Math.min(H,(T+Re)/W),Xe=0;Xe<L;++Xe)for(var Ye=Xe-Z,ot=Math.max(0,Math.ceil(Ye/B)),Qe=Math.min(O,(D+Ye)/B),ct=0;ct<U;++ct){for(var ie=ct-ne,$t=Math.max(0,Math.ceil(ie/q)),Ot=Math.min(V,(A+ie)/q),qt=0,en=We;en<Be;++en)for(var hn=en*W-Re,cn=ot;cn<Qe;++cn)for(var tn=cn*B-Ye,Ht=$t;Ht<Ot;++Ht)for(var Yt=g*ge+x*en+y*cn+b*Ht,ye=k*(T-1-hn)+N*(D-1-tn)+E*(A-1-(Ht*q-ie))+_*he,Fe=0;Fe<G;++Fe)qt+=h[Yt+Fe]*C[ye+Fe];i[l*ge+c*Se+u*Xe+d*ct+he]=qt}return s.toTensor()},e.prototype.conv2dDerFilter=function(t,r,o){Me([t,r],"conv2dDerFilter");for(var s=o.strideHeight,i=o.strideWidth,a=o.filterHeight,l=o.filterWidth,c=o.dataFormat==="channelsLast",u=Wt(o.filterShape,"float32"),d=o.padInfo.left,h=o.padInfo.top,p=this.bufferSync(t),g=this.bufferSync(r),x=0;x<a;++x)for(var y=Math.max(0,Math.ceil((h-x)/s)),b=Math.min(o.outHeight,(o.inHeight+h-x)/s),C=0;C<l;++C)for(var S=Math.max(0,Math.ceil((d-C)/i)),k=Math.min(o.outWidth,(o.inWidth+d-C)/i),N=0;N<o.inChannels;++N)for(var E=0;E<o.outChannels;++E){for(var _=0,$=0;$<o.batchSize;++$)for(var T=y;T<b;++T)for(var D=x+T*s-h,A=S;A<k;++A){var M=C+A*i-d;_+=c?p.get($,D,M,N)*g.get($,T,A,E):p.get($,N,D,M)*g.get($,E,T,A)}u.set(_,x,C,N,E)}return u.toTensor()},e.prototype.conv3dDerFilter=function(t,r,o){for(var s=o.strideDepth,i=o.strideHeight,a=o.strideWidth,l=o.filterDepth,c=o.filterHeight,u=o.filterWidth,d=Wt(o.filterShape,"float32"),h=d.values,p=d.strides,g=p[0],x=p[1],y=p[2],b=p[3],C=this.readSync(r.dataId),S=r.strides,k=S[0],N=S[1],E=S[2],_=S[3],$=this.readSync(t.dataId),T=t.strides,D=T[0],A=T[1],M=T[2],j=T[3],L=o.padInfo.front,U=o.padInfo.left,G=o.padInfo.top,H=0;H<l;++H)for(var O=Math.max(0,Math.ceil((L-H)/s)),V=Math.min(o.outDepth,(o.inDepth+L-H)/s),W=H*g,B=0;B<c;++B)for(var q=Math.max(0,Math.ceil((G-B)/i)),Q=Math.min(o.outHeight,(o.inHeight+G-B)/i),Z=B*x+W,ne=0;ne<u;++ne)for(var ge=Math.max(0,Math.ceil((U-ne)/a)),he=Math.min(o.outWidth,(o.inWidth+U-ne)/a),Se=ne*y+Z,Re=0;Re<o.inChannels;++Re)for(var We=Re*b+Se,Be=0;Be<o.outChannels;++Be){for(var Xe=0,Ye=0;Ye<o.batchSize;++Ye)for(var ot=Ye*D,Qe=Ye*k,ct=O;ct<V;++ct)for(var ie=(H+ct*s-L)*A+ot,$t=ct*N+Qe,Ot=q;Ot<Q;++Ot)for(var qt=(B+Ot*i-G)*M+ie,en=Ot*E+$t,hn=ge;hn<he;++hn){var cn=hn*_+en;Xe+=$[(ne+hn*a-U)*j+qt+Re]*C[cn+Be]}h[We+Be]=Xe}return d.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,o=t.filter,s=t.convInfo,i=t.bias,a=t.activation,l=t.preluActivationWeights,c=this.depthwiseConv2D(r,o,s);return i&&(c=this.add(c,i)),a&&(c=n3(this,c,a,l)),c},e.prototype.depthwiseConv2D=function(t,r,o){Me([t,r],"depthwiseConv2D");for(var s=o.filterHeight,i=o.filterWidth,a=o.dilationHeight,l=o.dilationWidth,c=o.padInfo.left,u=o.padInfo.top,d=o.outChannels/o.inChannels,h=Wt(o.outShape,t.dtype),p=this.readSync(t.dataId),g=this.readSync(r.dataId),x=h.values,y=0;y<o.batchSize;++y)for(var b=y*t.strides[0],C=y*h.strides[0],S=0;S<o.outHeight;++S)for(var k=C+S*h.strides[1],N=S*o.strideHeight-c,E=0;E<s;++E){var _=N+E*a;if(!(_<0||_>=o.inHeight))for(var $=E*r.strides[0],T=b+_*t.strides[1],D=0;D<o.outWidth;++D)for(var A=k+D*h.strides[2],M=D*o.strideWidth-u,j=0;j<i;++j){var L=M+j*l;if(!(L<0||L>=o.inWidth))for(var U=$+j*r.strides[1],G=T+L*o.inChannels,H=A,O=U,V=0;V<o.inChannels;++V){for(var W=p[G+V],B=0;B<d;++B)x[H+B]+=W*g[O+B];H+=d,O+=d}}}return h.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,o){Me([t,r],"depthwiseConv2DDerInput");for(var s=Wt(o.inShape,"float32"),i=s.values,a=s.strides,l=a[0],c=a[1],u=a[2],d=this.readSync(t.dataId),h=t.strides,p=h[0],g=h[1],x=h[2],y=this.readSync(r.dataId),b=r.strides,C=b[0],S=b[1],k=b[2],N=o.batchSize,E=o.filterHeight,_=o.filterWidth,$=o.inChannels,T=o.inHeight,D=o.inWidth,A=o.outChannels,M=o.outHeight,j=o.outWidth,L=o.strideHeight,U=o.strideWidth,G=E-1-o.padInfo.top,H=_-1-o.padInfo.left,O=A/$,V=0;V<N;++V)for(var W=0;W<$;++W)for(var B=0;B<T;++B)for(var q=B-G,Q=Math.max(0,Math.ceil(q/L)),Z=Math.min(M,(E+q)/L),ne=0;ne<D;++ne){for(var ge=ne-H,he=Math.max(0,Math.ceil(ge/U)),Se=Math.min(j,(_+ge)/U),Re=0,We=Q;We<Z;++We)for(var Be=We*L-q,Xe=he;Xe<Se;++Xe)for(var Ye=p*V+g*We+x*Xe,ot=C*(E-1-Be)+S*(_-1-(Xe*U-ge))+k*W,Qe=0;Qe<O;++Qe)Re+=d[Ye+(W*O+Qe)]*y[ot+Qe];i[l*V+c*B+u*ne+W]=Re}return s.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,o){Me([t,r],"depthwiseConv2DDerFilter");for(var s=o.strideHeight,i=o.strideWidth,a=o.filterHeight,l=o.filterWidth,c=Wt(o.filterShape,"float32"),u=o.padInfo.left,d=o.padInfo.top,h=o.outChannels/o.inChannels,p=this.bufferSync(t),g=this.bufferSync(r),x=0;x<a;++x)for(var y=Math.max(0,Math.ceil((d-x)/s)),b=Math.min(o.outHeight,(o.inHeight+d-x)/s),C=0;C<l;++C)for(var S=Math.max(0,Math.ceil((u-C)/i)),k=Math.min(o.outWidth,(o.inWidth+u-C)/i),N=0;N<o.outChannels;++N){for(var E=Math.trunc(N/h),_=N%h,$=0,T=0;T<o.batchSize;++T)for(var D=y;D<b;++D)for(var A=x+D*s-d,M=S;M<k;++M){var j=C+M*i-u;$+=p.get(T,A,j,E)*g.get(T,D,M,N)}c.set($,x,C,E,_)}return c.toTensor()},e.prototype.tile=function(t,r){return Me(t,"tile"),zD(this.bufferSync(t),r)},e.prototype.pad=function(t,r,o){Me(t,"pad");var s=r.map((function(h,p){return h[0]+t.shape[p]+h[1]})),i=r.map((function(h){return h[0]})),a=this.bufferSync(t),l=Wt(s,t.dtype);o!==0&&l.values.fill(o);for(var c=0;c<t.size;c++){var u=a.indexToLoc(c),d=u.map((function(h,p){return h+i[p]}));l.set.apply(l,[a.get.apply(a,u)].concat(d))}return l.toTensor()},e.prototype.transpose=function(t,r){Me(t,"transpose");for(var o=new Array(t.rank),s=0;s<o.length;s++)o[s]=t.shape[r[s]];var i=this.readSync(t.dataId),a=Wt(o,t.dtype),l=this.bufferSync(t);for(s=0;s<t.size;++s){for(var c=l.indexToLoc(s),u=new Array(c.length),d=0;d<u.length;d++)u[d]=c[r[d]];var h=a.locToIndex(u);a.values[h]=i[s]}return a.toTensor()},e.prototype.gather=function(t,r,o){Me([t,r],"gather");var s=t.shape.slice(),i=this.readSync(r.dataId);s[o]=i.length;for(var a=Wt(s,t.dtype),l=this.bufferSync(t),c=0;c<a.size;++c){var u=a.indexToLoc(c),d=u.slice();d[o]=i[u[o]];var h=l.locToIndex(d);a.values[c]=l.values[h]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,r,o){Me([t],"batchToSpaceND");var s=r.reduce((function(d,h){return d*h})),i=Ix(t.shape,r,s),a=Ex(i.length,r.length),l=Tx(t.shape,r,s),c=RD(o,r.length),u=DD(l,o,r.length);return t.reshape(i).transpose(a).reshape(l).slice(c,u)},e.prototype.spaceToBatchND=function(t,r,o){Me([t],"spaceToBatchND");var s=r.reduce((function(h,p){return h*p})),i=[[0,0]];i.push.apply(i,o);for(var a=1+r.length;a<t.shape.length;++a)i.push([0,0]);var l=t.pad(i),c=Ix(l.shape,r,s,!1),u=Ex(c.length,r.length,!1),d=Tx(l.shape,r,s,!1);return l.reshape(c).transpose(u).reshape(d)},e.prototype.pool=function(t,r,o){Me(t,"pool");for(var s=r.strideHeight,i=r.strideWidth,a=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,u=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,p=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(t.dataId),x=Wt(r.outShape,t.dtype),y=x.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3],C=r.outShape[2]*r.outShape[3],S=r.outShape[3],k=0;k<r.batchSize;++k)for(var N=k*b,E=k*t.strides[0],_=0;_<r.inChannels;++_)for(var $=0;$<r.outHeight;++$)for(var T=$*s-d,D=Math.max(0,T),A=Math.min(r.inHeight,c+T),M=N+$*C,j=0;j<r.outWidth;++j){for(var L=j*i-h,U=Math.max(0,L),G=Math.min(r.inWidth,u+L),H=p,O=0,V=0,W=D;W<A;W+=a){for(var B=E+W*t.strides[1],q=U;q<G;q+=l){var Q=g[B+q*t.strides[2]+_];o==="max"&&Q>H?H=Q:o==="avg"&&(O+=Q,V++)}if(isNaN(H))break}y[M+j*S+_]=o==="avg"?O/V:H}return x.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var o=Wt(r.outShape,"int32"),s=r.strideHeight,i=r.strideWidth,a=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,u=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,p=this.bufferSync(t),g=0;g<r.batchSize;++g)for(var x=0;x<r.inChannels;++x)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,C=b;C<0;)C+=a;for(var S=Math.min(r.inHeight,c+b),k=0;k<r.outWidth;++k){for(var N=k*i-h,E=N;E<0;)E+=l;for(var _=Math.min(r.inWidth,u+N),$=Number.NEGATIVE_INFINITY,T=-1,D=C;D<S;D+=a)for(var A=D-b,M=E;M<_;M+=l){var j=M-N,L=p.get(g,D,M,x);L>$&&($=L,T=A*u+j)}o.set(T,g,y,k,x)}}return o.toTensor()},e.prototype.maxPoolBackprop=function(t,r,o,s){Me([r,o],"maxPoolBackprop");for(var i=this.maxPoolPositions(r,s),a=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,u=s.dilationWidth,d=s.effectiveFilterHeight,h=s.effectiveFilterWidth,p=h-1-s.padInfo.left,g=d-1-s.padInfo.top,x=Wt(r.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(t),C=0;C<s.batchSize;++C)for(var S=0;S<s.inChannels;++S)for(var k=0;k<s.inHeight;++k)for(var N=0;N<s.inWidth;++N){for(var E=k-g,_=N-p,$=0,T=0;T<d;T+=c){var D=(E+T)/a;if(!(D<0||D>=s.outHeight||Math.floor(D)!==D))for(var A=0;A<h;A+=u){var M=(_+A)/l;if(!(M<0||M>=s.outWidth||Math.floor(M)!==M)){var j=d*h-1-y.get(C,D,M,S)===T*h+A?1:0;j!==0&&($+=b.get(C,D,M,S)*j)}}}x.set($,C,k,N,S)}return x.toTensor()},e.prototype.avgPoolBackprop=function(t,r,o){Me([t,r],"avgPoolBackprop");for(var s=o.strideHeight,i=o.strideWidth,a=o.filterHeight,l=o.filterWidth,c=o.dilationHeight,u=o.dilationWidth,d=o.effectiveFilterHeight,h=o.effectiveFilterWidth,p=h-1-o.padInfo.left,g=d-1-o.padInfo.top,x=Wt(r.shape,"float32"),y=1/(a*l),b=this.bufferSync(t),C=0;C<o.batchSize;++C)for(var S=0;S<o.inChannels;++S)for(var k=0;k<o.inHeight;++k)for(var N=0;N<o.inWidth;++N){for(var E=k-g,_=N-p,$=0,T=0;T<d;T+=c){var D=(E+T)/s;if(!(D<0||D>=o.outHeight||Math.floor(D)!==D))for(var A=0;A<h;A+=u){var M=(_+A)/i;M<0||M>=o.outWidth||Math.floor(M)!==M||($+=b.get(C,D,M,S))}}x.set($*y,C,k,N,S)}return x.toTensor()},e.prototype.pool3d=function(t,r,o){Me(t,"pool3d");for(var s=r.strideDepth,i=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,b=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=this.readSync(t.dataId),S=Wt(r.outShape,t.dtype),k=S.values,N=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],E=r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[3]*r.outShape[4],$=r.outShape[4],T=0;T<r.batchSize;++T)for(var D=T*N,A=T*t.strides[0],M=0;M<r.inChannels;++M)for(var j=0;j<r.outDepth;++j){for(var L=j*s-g,U=L;U<0;)U+=l;for(var G=Math.min(r.inDepth,d+L),H=D+j*E,O=0;O<r.outHeight;++O){for(var V=O*i-x,W=V;W<0;)W+=c;for(var B=Math.min(r.inHeight,h+V),q=H+O*_,Q=0;Q<r.outWidth;++Q){for(var Z=Q*a-y,ne=Z;ne<0;)ne+=u;for(var ge=Math.min(r.inWidth,p+Z),he=q+Q*$,Se=b,Re=0,We=0,Be=U;Be<G;Be+=l){for(var Xe=A+Be*t.strides[1],Ye=W;Ye<B;Ye+=c){for(var ot=Xe+Ye*t.strides[2],Qe=ne;Qe<ge;Qe+=u){var ct=C[ot+Qe*t.strides[3]+M];if(o==="max"&&ct>Se?Se=ct:o==="avg"&&(Re+=ct,We++),isNaN(Se))break}if(isNaN(Se))break}if(isNaN(Se))break}k[he+M]=o==="avg"?Re/We:Se}}}return S.toTensor()},e.prototype.avgPool3d=function(t,r){return Me(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,o){Me([t,r],"avgPool3dBackprop");for(var s=o.strideDepth,i=o.strideHeight,a=o.strideWidth,l=o.filterDepth,c=o.filterHeight,u=o.filterWidth,d=o.dilationDepth,h=o.dilationHeight,p=o.dilationWidth,g=o.effectiveFilterDepth,x=o.effectiveFilterHeight,y=o.effectiveFilterWidth,b=g-1-o.padInfo.front,C=y-1-o.padInfo.left,S=x-1-o.padInfo.top,k=Wt(r.shape,"float32"),N=1/(l*c*u),E=this.bufferSync(t),_=0;_<o.batchSize;++_)for(var $=0;$<o.inChannels;++$)for(var T=0;T<o.inDepth;++T)for(var D=0;D<o.inHeight;++D)for(var A=0;A<o.inWidth;++A){for(var M=T-b,j=D-S,L=A-C,U=0,G=0;G<g;G+=d){var H=(M+G)/s;if(!(H<0||H>=o.outDepth||Math.floor(H)!==H))for(var O=0;O<x;O+=h){var V=(j+O)/i;if(!(V<0||V>=o.outHeight||Math.floor(V)!==V))for(var W=0;W<y;W+=p){var B=(L+W)/a;B<0||B>=o.outWidth||Math.floor(B)!==B||(U+=E.get(_,H,V,B,$))}}}k.set(U*N,_,T,D,A,$)}return k.toTensor()},e.prototype.maxPool3d=function(t,r){return Me(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var o=Wt(r.outShape,"int32"),s=r.strideDepth,i=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,b=this.bufferSync(t),C=0;C<r.batchSize;++C)for(var S=0;S<r.inChannels;++S)for(var k=0;k<r.outDepth;++k){for(var N=k*s-g,E=N;E<0;)E+=l;for(var _=Math.min(r.inDepth,d+N),$=0;$<r.outHeight;++$){for(var T=$*i-x,D=T;D<0;)D+=c;for(var A=Math.min(r.inHeight,h+T),M=0;M<r.outWidth;++M){for(var j=M*a-y,L=j;L<0;)L+=u;for(var U=Math.min(r.inWidth,p+j),G=Number.NEGATIVE_INFINITY,H=-1,O=E;O<_;O+=l)for(var V=O-N,W=D;W<A;W+=c)for(var B=W-T,q=L;q<U;q+=u){var Q=q-j,Z=b.get(C,O,W,q,S);Z>=G&&(G=Z,H=V*h*p+B*h+Q)}o.set(H,C,k,$,M,S)}}}return o.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,o,s){Me([r,o],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(r,s),a=s.strideDepth,l=s.strideHeight,c=s.strideWidth,u=s.dilationDepth,d=s.dilationHeight,h=s.dilationWidth,p=s.effectiveFilterDepth,g=s.effectiveFilterHeight,x=s.effectiveFilterWidth,y=p-1-s.padInfo.front,b=x-1-s.padInfo.left,C=g-1-s.padInfo.top,S=Wt(r.shape,"float32"),k=this.bufferSync(i),N=this.bufferSync(t),E=0;E<s.batchSize;++E)for(var _=0;_<s.inChannels;++_)for(var $=0;$<s.inDepth;++$)for(var T=0;T<s.inHeight;++T)for(var D=0;D<s.inWidth;++D){for(var A=$-y,M=T-C,j=D-b,L=0,U=0;U<p;U+=u){var G=(A+U)/a;if(!(G<0||G>=s.outDepth||Math.floor(G)!==G))for(var H=0;H<g;H+=d){var O=(M+H)/l;if(!(O<0||O>=s.outHeight||Math.floor(O)!==O))for(var V=0;V<x;V+=h){var W=(j+V)/c;if(!(W<0||W>=s.outWidth||Math.floor(W)!==W)){var B=p*g*x-1-k.get(E,G,O,W,_)===U*g*x+H*x+V?1:0;B!==0&&(L+=N.get(E,G,O,W,_)*B)}}}}S.set(L,E,$,T,D,_)}return S.toTensor()},e.prototype.cast=function(t,r){return LD(t,r,this)},e.prototype.reshape=function(t,r){return dC(t,r)},e.prototype.avgPool=function(t,r){return Me(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,o,s){Me(t,"resizeBilinear");for(var i=t.shape,a=i[0],l=i[1],c=i[2],u=i[3],d=this.readSync(t.dataId),h=new Float32Array(yt([a,r,o,u])),p=[s&&r>1?l-1:l,s&&o>1?c-1:c],g=[s&&r>1?r-1:r,s&&o>1?o-1:o],x=0,y=p[0]/g[0],b=p[1]/g[1],C=0;C<a;C++)for(var S=0;S<r;S++)for(var k=y*S,N=Math.floor(k),E=k-N,_=Math.min(l-1,Math.ceil(k)),$=C*t.strides[0]+N*t.strides[1],T=C*t.strides[0]+_*t.strides[1],D=0;D<o;D++)for(var A=b*D,M=Math.floor(A),j=A-M,L=Math.min(c-1,Math.ceil(A)),U=$+M*t.strides[2],G=T+M*t.strides[2],H=$+L*t.strides[2],O=T+L*t.strides[2],V=0;V<u;V++){var W=d[U+V],B=d[G+V],q=W+(d[H+V]-W)*j,Q=q+(B+(d[O+V]-B)*j-q)*E;h[x++]=Q}return Io(h,[a,r,o,u])},e.prototype.resizeBilinearBackprop=function(t,r,o){Me([t,r],"resizeBilinearBackprop");for(var s=r.shape,i=s[0],a=s[1],l=s[2],c=s[3],u=t.shape,d=u[1],h=u[2],p=new Float32Array(i*a*l*c),g=[o&&d>1?a-1:a,o&&h>1?l-1:l],x=[o&&d>1?d-1:d,o&&h>1?h-1:h],y=g[0]/x[0],b=g[1]/x[1],C=this.readSync(t.dataId),S=0,k=0;k<i;k++)for(var N=k*r.strides[0],E=0;E<d;E++)for(var _=E*y,$=Math.floor(_),T=Math.min(Math.ceil(_),a-1),D=N+$*r.strides[1],A=N+T*r.strides[1],M=_-$,j=1-M,L=0;L<h;L++)for(var U=L*b,G=Math.floor(U),H=Math.min(Math.ceil(U),l-1),O=U-G,V=1-O,W=D+G*r.strides[2],B=D+H*r.strides[2],q=A+G*r.strides[2],Q=A+H*r.strides[2],Z=j*V,ne=j*O,ge=M*V,he=M*O,Se=0;Se<c;Se++){var Re=C[S++];p[W+Se]+=Re*Z,p[B+Se]+=Re*ne,p[q+Se]+=Re*ge,p[Q+Se]+=Re*he}return As(p,[i,l,a,c],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,o,s){Me(t,"resizeNearestNeighbor");for(var i=t.shape,a=i[0],l=i[1],c=i[2],u=i[3],d=this.readSync(t.dataId),h=new Float32Array(a*r*o*u),p=[s&&r>1?l-1:l,s&&o>1?c-1:c],g=[s&&r>1?r-1:r,s&&o>1?o-1:o],x=p[0]/g[0],y=p[1]/g[1],b=0,C=0;C<a;C++)for(var S=C*t.strides[0],k=0;k<r;k++)for(var N=x*k,E=S+Math.min(l-1,s?Math.round(N):Math.floor(N))*t.strides[1],_=0;_<o;_++)for(var $=y*_,T=E+Math.min(c-1,s?Math.round($):Math.floor($))*t.strides[2],D=0;D<u;D++){var A=d[T+D];h[b++]=A}return Io(h,[a,r,o,u],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,o){Me([t,r],"resizeNearestNeighborBackprop");for(var s=r.shape,i=s[0],a=s[1],l=s[2],c=s[3],u=t.shape,d=u[1],h=u[2],p=new Float32Array(i*a*l*c),g=this.readSync(t.dataId),x=[o&&d>1?a-1:a,o&&h>1?l-1:l],y=[o&&d>1?d-1:d,o&&h>1?h-1:h],b=x[0]/y[0],C=x[1]/y[1],S=1/b,k=1/C,N=2*Math.ceil(S)+2,E=2*Math.ceil(k)+2,_=0;_<i;_++)for(var $=_*r.strides[0],T=0;T<a;T++)for(var D=$+T*r.strides[1],A=Math.floor(T*S),M=Math.floor(A-N/2),j=0;j<l;j++)for(var L=D+j*r.strides[2],U=Math.floor(j*k),G=Math.floor(U-E/2),H=0;H<c;H++){for(var O=0,V=0;V<N;V++){var W=V+M;if(!(W<0||W>=d)){var B=$+W*t.strides[1],q=W*b;if(T===Math.min(a-1,o?Math.round(q):Math.floor(q)))for(var Q=0;Q<E;Q++){var Z=Q+G;if(!(Z<0||Z>=h)){var ne=B+Z*t.strides[2],ge=Z*C;j===Math.min(l-1,o?Math.round(ge):Math.floor(ge))&&(O+=g[ne+H])}}}}p[L+H]=O}return As(p,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,o,s,i,a){Me([t,r,o,i,a],"batchNorm");for(var l=this.readSync(t.dataId),c=this.readSync(r.dataId),u=this.readSync(o.dataId),d=i?this.readSync(i.dataId):new Float32Array([1]),h=a?this.readSync(a.dataId):new Float32Array([0]),p=new Float32Array(l.length),g=h.length,x=d.length,y=u.length,b=c.length,C=0,S=0,k=0,N=0,E=0;E<l.length;++E)p[E]=h[C++]+(l[E]-c[S++])*d[k++]/Math.sqrt(u[N++]+s),C>=g&&(C=0),S>=b&&(S=0),k>=x&&(k=0),N>=y&&(N=0);return As(p,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,o,s,i){Me(t,"localResponseNormalization4D");var a=t.shape[3],l=a-1,c=this.readSync(t.dataId),u=t.size,d=new Float32Array(u);function h(y){for(var b=y%a,C=y-b+Math.max(0,b-r),S=y-b+Math.min(b+r,l),k=0;C<=S;C++){var N=c[C];k+=N*N}return k}for(var p=0;p<u;p++){var g=h(p),x=c[p]*Math.pow(o+s*g,-i);d[p]=x}return As(d,t.shape)},e.prototype.LRNGrad=function(t,r,o,s,i,a,l){Me(t,"LRNGrad");for(var c=t.shape[3],u=this.readSync(t.dataId),d=this.readSync(r.dataId),h=this.readSync(o.dataId),p=new Float32Array(t.size),g=t.size,x=0;x<g;x++){for(var y=x%c,b=x-y+Math.max(0,y-s),C=x-y+Math.min(c,y+s+1),S=0,k=b;k<C;k++)S+=Math.pow(d[k],2);for(S=a*S+i,k=b;k<C;k++){var N=-2*a*l*d[k]*h[x]/S;x===k&&(N+=Math.pow(S,-l)),N*=u[x],p[k]+=N}}return As(p,t.shape)},e.prototype.multinomial=function(t,r,o,s){Me(t,"multinomial");for(var i=r?t:tc(t),a=i.shape[0],l=i.shape[1],c=Zn([a,o],"int32"),u=this.readSync(c.dataId),d=this.readSync(i.dataId),h=0;h<a;++h){var p=h*l,g=new Float32Array(l-1);g[0]=d[p];for(var x=1;x<g.length;++x)g[x]=g[x-1]+d[p+x];for(var y=Pv(s.toString()),b=h*o,C=0;C<o;++C){var S=y();u[b+C]=g.length;for(var k=0;k<g.length;k++)if(S<g[k]){u[b+C]=k;break}}}return c},e.prototype.oneHot=function(t,r,o,s){Me(t,"oneHot");var i=new Float32Array(t.size*r);i.fill(s);for(var a=this.readSync(t.dataId),l=0;l<t.size;++l)a[l]>=0&&a[l]<r&&(i[l*r+a[l]]=o);return qc(i,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,o,s,i){return Me(t,"nonMaxSuppression"),L4(this.readSync(t.dataId),this.readSync(r.dataId),o,s,i)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var o=t.shape[0],s=t.shape[1],i=Wt(t.shape,"float32"),a=Wt(t.shape,"float32"),l=Ei(t).as2D(o,s),c=Ka(t).as2D(o,s),u=0;u<o;u++)for(var d=l.slice([u,0],[1,s]),h=c.slice([u,0],[1,s]),p=So(d,h),g=this.readSync(this.fftImpl(p,r).dataId),x=0;x<s;x++){var y=oI(g,x);i.values[u*s+x]=y.real,a.values[u*s+x]=y.imag}return So(i.toTensor(),a.toTensor()).as2D(o,s)},e.prototype.fftImpl=function(t,r){var o=t.as1D(),s=o.size;if(this.isExponentOf2(s)){var i=this.fftRadix2(o,s,r).as2D(t.shape[0],t.shape[1]);return r&&(i=So(Ei(i).div(et(s)),Ka(i).div(et(s)))),i}var a=this.readSync(t.dataId),l=(function(c){for(var u=new Float32Array(c.length/2),d=new Float32Array(c.length/2),h=0;h<c.length;h+=2)u[h/2]=c[h],d[h/2]=c[h+1];return{real:u,imag:d}})(this.fourierTransformByMatmul(a,s,r));return So(l.real,l.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,o){if(r===1)return t;var s=this.readSync(t.dataId),i=r/2,a=(function(b){for(var C=Math.ceil(b.length/4),S=new Float32Array(C),k=new Float32Array(C),N=0;N<b.length;N+=4)S[Math.floor(N/4)]=b[N],k[Math.floor(N/4)]=b[N+1];return{real:S,imag:k}})(s),l=So(a.real,a.imag).as1D(),c=(function(b){for(var C=Math.floor(b.length/4),S=new Float32Array(C),k=new Float32Array(C),N=2;N<b.length;N+=4)S[Math.floor(N/4)]=b[N],k[Math.floor(N/4)]=b[N+1];return{real:S,imag:k}})(s),u=So(c.real,c.imag).as1D();l=this.fftRadix2(l,i,o),u=this.fftRadix2(u,i,o);var d=(function(b,C){for(var S=new Float32Array(b/2),k=new Float32Array(b/2),N=0;N<Math.ceil(b/2);N++){var E=(C?2:-2)*Math.PI*(N/b);S[N]=Math.cos(E),k[N]=Math.sin(E)}return{real:S,imag:k}})(r,o),h=So(d.real,d.imag).mul(u),p=l.add(h),g=l.sub(h),x=Ei(p).concat(Ei(g)),y=Ka(p).concat(Ka(g));return So(x,y).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,o){for(var s=new Float32Array(2*r),i=0;i<r;i++){for(var a=0,l=0,c=0;c<r;c++){var u=kX(i*c,r,o),d=oI(t,c);a+=d.real*u.real-d.imag*u.imag,l+=d.real*u.imag+d.imag*u.real}o&&(a/=r,l/=r),CX(s,a,l,i)}return s},e.prototype.depthToSpace=function(t,r,o){Y(o==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o})),Y(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));for(var s=t.shape[0],i=t.shape[1],a=t.shape[2],l=t.shape[3],c=i*r,u=a*r,d=l/(r*r),h=this.readSync(t.dataId),p=new Float32Array(s*c*u*d),g=0,x=0;x<s;++x)for(var y=0;y<c;++y)for(var b=Math.floor(y/r),C=y%r,S=0;S<u;++S)for(var k=Math.floor(S/r),N=(C*r+S%r)*d,E=0;E<d;++E){var _=E+N+l*(k+a*(b+i*x));p[g++]=h[_]}return As(p,[s,c,u,d])},e.prototype.broadcastedBinaryOp=function(t,r,o,s){var i=ln(t.shape,r.shape),a=Wt(i,o),l=this.readSync(t.dataId),c=this.readSync(r.dataId),u=zc(t.shape,i),d=zc(r.shape,i),h=a.values;if(u.length+d.length===0)for(var p=0;p<h.length;++p)h[p]=s(l[p%l.length],c[p%c.length]);else{var g=this.bufferSync(t),x=this.bufferSync(r),y=function(b){var C=a.indexToLoc(b),S=C.slice(-t.rank);u.forEach((function(_){return S[_]=0}));var k=g.locToIndex(S),N=C.slice(-r.rank);d.forEach((function(_){return N[_]=0}));var E=x.locToIndex(N);h[b]=s(l[k],c[E])};for(p=0;p<h.length;++p)y(p)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,o){var s=ln(t.shape,r.shape),i=Wt(s,"float32"),a=Wt(s,"float32"),l=this.readSync(t.dataId),c=this.readSync(r.dataId),u=zc(t.shape,s),d=zc(r.shape,s),h=i.values,p=a.values;if(u.length+d.length===0)for(var g=0;g<h.length;g++){var x=g%l.length,y=g%c.length,b=o(l[2*x],l[2*x+1],c[2*y],c[2*y+1]);h[g]=b.real,p[g]=b.imag}else{var C=this.bufferSync(this.data.get(t.dataId).complexTensors.real),S=this.bufferSync(this.data.get(r.dataId).complexTensors.real),k=function(N){var E=i.indexToLoc(N),_=E.slice(-t.rank);u.forEach((function(M){return _[M]=0}));var $=C.locToIndex(_),T=E.slice(-r.rank);d.forEach((function(M){return T[M]=0}));var D=S.locToIndex(T),A=o(l[2*$],l[2*$+1],c[2*D],c[2*D+1]);h[N]=A.real,p[N]=A.imag};for(g=0;g<h.length;g++)k(g)}return this.complex(i.toTensor(),a.toTensor())},e.prototype.split=function(t,r,o){return VD(t,r,o)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,o,s,i,a){for(var l=t.shape,c=l[0],u=l[1],d=l[2],h=l[3],p=r.shape[0],g=s[0],x=s[1],y=Wt([p,g,x,h],"float32"),b=this.readSync(r.dataId),C=this.readSync(o.dataId),S=this.readSync(t.dataId),k=t.strides,N=y.strides,E=0;E<p;E++){var _=4*E,$=b[_],T=b[_+1],D=b[_+2],A=b[_+3],M=C[E];if(!(M>=c))for(var j=g>1?(D-$)*(u-1)/(g-1):0,L=x>1?(A-T)*(d-1)/(x-1):0,U=0;U<g;U++){var G=g>1?$*(u-1)+U*j:.5*($+D)*(u-1);if(G<0||G>u-1)for(var H=0;H<x;H++)for(var O=0;O<h;O++){var V=O+H*N[2]+U*N[1]+E*N[0];y.values[V]=a}else if(i==="bilinear"){var W=Math.floor(G),B=Math.ceil(G),q=G-W;for(H=0;H<x;H++)if((Be=x>1?T*(d-1)+H*L:.5*(T+A)*(d-1))<0||Be>d-1)for(O=0;O<h;O++)V=O+H*N[2]+U*N[1]+E*N[0],y.values[V]=a;else{var Q=Math.floor(Be),Z=Math.ceil(Be),ne=Be-Q;for(O=0;O<h;O++){var ge=S[V=O+Q*k[2]+W*k[1]+M*k[0]],he=S[V=O+Z*k[2]+W*k[1]+M*k[0]],Se=S[V=O+Q*k[2]+B*k[1]+M*k[0]],Re=ge+(he-ge)*ne,We=Se+(S[V=O+Z*k[2]+B*k[1]+M*k[0]]-Se)*ne;V=O+H*N[2]+U*N[1]+E*N[0],y.values[V]=Re+(We-Re)*q}}}else for(H=0;H<x;++H){var Be;if((Be=x>1?T*(d-1)+H*L:.5*(T+A)*(d-1))<0||Be>d-1)for(O=0;O<h;O++)V=O+H*N[2]+U*N[1]+E*N[0],y.values[V]=a;else{var Xe=Math.round(Be),Ye=Math.round(G);for(O=0;O<h;O++){var ot=O+Xe*k[2]+Ye*k[1]+M*k[0],Qe=O+H*N[2]+U*N[1]+E*N[0];y.values[Qe]=S[ot]}}}}}return y.toTensor()},e.prototype.sparseToDense=function(t,r,o,s){var i=Rx(0,t,o),a=i.sliceRank,l=i.numUpdates,c=i.sliceSize,u=i.strides,d=i.outputSize;return this.scatter(t,r,o,d,c,l,a,u,s,!1)},e.prototype.gatherND=function(t,r){var o=r.shape,s=o[o.length-1],i=AD(t,r),a=i[0],l=i[1],c=i[2],u=i[3];if(l===0)return Io([],a,t.dtype);for(var d=new im([l,c],t.dtype),h=this.readSync(r.dataId),p=this.readSync(t.dataId),g=0;g<l;g++){for(var x=[],y=0,b=0;b<s;b++){var C=h[g*s+b];y+=C*u[b],x.push(C)}if(y<0||y>=t.size/c)throw new Error("Invalid indices: "+x+" does not index into "+t.shape);for(var S=0;S<c;S++)d.values[g*c+S]=p[y*c+S]}return d.toTensor().reshape(a)},e.prototype.scatterND=function(t,r,o){var s=Rx(0,t,o),i=s.sliceRank,a=s.numUpdates,l=s.sliceSize,c=s.strides,u=s.outputSize,d=et(0);return this.scatter(t,r,o,u,l,a,i,c,d,!0)},e.prototype.fill=function(t,r,o){var s=yx(o=o||Dm(r),yt(t));return s.fill(r),ce.makeTensor(s,t,o,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=yx(t.dtype,yt(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,o){return BD(t,r,o)},e.prototype.scatter=function(t,r,o,s,i,a,l,c,u,d){var h=[s/i,i],p=this.readSync(t.dataId),g=this.readSync(r.dataId);if(s===0)return Io([],o,r.dtype);var x=new im(h,r.dtype);x.values.fill(this.readSync(u.dataId)[0]);for(var y=0;y<a;y++){for(var b=[],C=0,S=0;S<l;S++){var k=p[y*l+S];b.push(k),C+=k*c[S]}if(C<0||C>=s/i)throw new Error("Invalid indices: "+b+" does not index into "+o);for(var N=0;N<i;N++)d?x.values[C*i+N]+=g[y*i+N]:x.values[C*i+N]=r.rank===0?g[0]:g[y*i+N]}return x.toTensor().reshape(o)},e})(MD);ce.registerBackend("cpu",(function(){return new WJ}),1);for(var r3=0,II=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,o=e,s=o.boxes,i=o.scores,a=r,l=a.maxOutputSize,c=a.iouThreshold,u=a.scoreThreshold,d=a.softNmsSigma,h=t;Me(s,"NonMaxSuppressionWithScore");var p=B4(h.data.get(s.dataId).values,h.data.get(i.dataId).values,l,c,u,d);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,o=t;Me(r,"square");for(var s=o.data.get(r.dataId).values,i=new Float32Array(s.length),a=0;a<s.length;++a){var l=s[a];i[a]=l*l}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:cm,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,o=r.a,s=r.b,i=t;Me([o,s],cm);var a=i.data.get(o.dataId).values,l=i.data.get(s.dataId).values,c=(function(h,p,g,x,y,b){var C=ln(h,p),S=C.length,k=el(C),N=sm(y,yt(C)),E=h.length,_=p.length,$=el(h),T=el(p),D=zc(h,C),A=zc(p,C);if(D.length+A.length===0)for(var M=0;M<N.length;++M)N[M]=b(g[M%g.length],x[M%x.length]);else{var j=function(L){var U=Jq(L,S,k),G=U.slice(-E);D.forEach((function(W){return G[W]=0}));var H=XN(G,E,$),O=U.slice(-_);A.forEach((function(W){return O[W]=0}));var V=XN(O,_,T);N[L]=b(g[H],x[V])};for(M=0;M<N.length;++M)j(M)}return[N,C]})(o.shape,s.shape,a,l,o.dtype,(function(h,p){var g=h-p;return g*g})),u=c[0],d=c[1];return{dataId:i.write(u,d,o.dtype),shape:d,dtype:o.dtype}}}];r3<II.length;r3++)uD(II[r3]);var Ah,UJ=function(n){this.variableNames=["A"];var e=Go(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},HJ=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Go(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var o3=0,EI=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,o=e.pixels,s=r.numChannels,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,l=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=l[0],u=l[1],d=[u,c],h=[u,c,s];(a||i)&&(Ah==null&&(Ah=document.createElement("canvas").getContext("2d")),Ah.canvas.width=c,Ah.canvas.height=u,Ah.drawImage(o,0,0,c,u),o=Ah.canvas);var p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=ei.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),o);var g=Ae().getBool("WEBGL_PACK")?new HJ(h):new UJ(h),x=t.runWebGLProgram(g,[p],"int32");return t.disposeData(p.dataId),x}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;kx("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=e,s=o.boxes,i=o.scores,a=r,l=a.maxOutputSize,c=a.iouThreshold,u=a.scoreThreshold,d=a.softNmsSigma,h=t,p=B4(h.readSync(s.dataId),h.readSync(i.dataId),l,c,u,d);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,o=t,s=new Xt(r.shape,"return x * x;");return o.runWebGLProgram(s,[r],r.dtype)}},{kernelName:cm,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,o=r.a,s=r.b,i=t,a=Ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl("return (a - b) * (a - b);",o.shape,s.shape):new pr("return (a - b) * (a - b);",o.shape,s.shape);return i.compileAndRun(a,[o,s])}}];o3<EI.length;o3++)uD(EI[o3]);for(var s3=0,TI=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:cm,gradFunc:function(n,e){var t=e[0],r=e[1],o=et(2);return{a:function(){return Xo(n,Xo(o,Jr(t,r)))},b:function(){return Xo(n,Xo(o,Jr(r,t)))}}}}];s3<TI.length;s3++)zq(TI[s3]);var GJ=(function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n})();Ae().get("IS_BROWSER")&&Ae().setPlatform("browser",new GJ);var i3,qJ=function(){return require("node-fetch")},KJ=(function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return Ae().global.fetch!=null?Ae().global.fetch(e,t):(i3==null&&(i3=qJ()),i3(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n})();Ae().get("IS_NODE")&&Ae().setPlatform("node",new KJ);var pC={float32:4,int32:4,uint16:2,uint8:1,bool:1},Mx=4;function $A(n,e){for(var t={},r=0,o=function(a){var l=a.name,c=a.dtype,u=a.shape,d=yt(u),h=void 0;if("quantization"in a){var p=a.quantization;if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error("Weight "+a.name+" has unknown quantization dtype "+p.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var g=pC[p.dtype],x=n.slice(r,r+d*g),y=p.dtype==="uint8"?new Uint8Array(x):new Uint16Array(x);if(c==="float32")h=Float32Array.from(y,(function(E){return E*p.scale+p.min}));else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+l+"': "+c);h=Int32Array.from(y,(function(E){return Math.round(E*p.scale+p.min)}))}r+=d*g}else if(c==="string"){var b=yt(a.shape);h=[];for(var C=0;C<b;C++){var S=new Uint32Array(n.slice(r,r+Mx))[0];r+=Mx;var k=new Uint8Array(n.slice(r,r+S));h.push(k),r+=S}}else{var N=pC[c];if(x=n.slice(r,r+d*N),c==="float32")h=new Float32Array(x);else if(c==="int32")h=new Int32Array(x);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+l+"': "+c);h=new Uint8Array(x)}r+=d*N}t[l]=Io(h,u,c)},s=0,i=e;s<i.length;s++)o(i[s]);return t}function XJ(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach((function(s){if(e+=s.byteLength,t.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+s.constructor.name)}));var r=new Uint8Array(e),o=0;return t.forEach((function(s){r.set(new Uint8Array(s.buffer),o),o+=s.byteLength})),r.buffer}var mC=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function RI(n){return mC?Buffer.byteLength(n):new Blob([n]).size}function o5(n){var e=0;n.forEach((function(o){e+=o.byteLength}));var t=new Uint8Array(e),r=0;return n.forEach((function(o){t.set(new Uint8Array(o),r),r+=o.byteLength})),t.buffer}function DI(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function Om(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:RI(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:RI(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var ti=(function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var o=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach((function(s){var i=s(e,r);i!==null&&o.push(i)})),o},n})(),Yh="://",Kc=(function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){Y(e!=null,(function(){return"scheme must not be undefined or null."})),e.endsWith(Yh)&&(e=e.slice(0,e.indexOf(Yh))),Y(e.length>0,(function(){return"scheme must not be an empty string."}));var r=n.getInstance();Y(r.managers[e]==null,(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n})();function nx(n){if(n.indexOf(Yh)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Kc.getSchemes().join(","));return{scheme:n.split(Yh)[0],path:n.split(Yh)[1]}}function AI(n,e,t){return t===void 0&&(t=!1),pt(this,void 0,void 0,(function(){var r,o,s,i,a,l,c,u,d;return mt(this,(function(h){switch(h.label){case 0:return Y(n!==e,(function(){return"Old path and new path are the same: '"+n+"'"})),Y((r=ti.getLoadHandlers(n)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+n+"."})),Y(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."})),o=r[0],Y((s=ti.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),Y(s.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),i=s[0],a=nx(n).scheme,l=nx(n).path,c=a===nx(n).scheme,[4,o.load()];case 1:return u=h.sent(),t&&c?[4,Kc.getManager(a).removeModel(l)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,i.save(u)];case 4:return d=h.sent(),!t||c?[3,6]:[4,Kc.getManager(a).removeModel(l)];case 5:h.sent(),h.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var od="models_store",Wc="model_info_store";function FA(){if(!Ae().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function gC(n){var e=n.result;e.createObjectStore(od,{keyPath:"modelPath"}),e.createObjectStore(Wc,{keyPath:"modelPath"})}var Zh=(function(){function n(e){if(this.indexedDB=FA(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},n.prototype.load=function(){return pt(this,void 0,void 0,(function(){return mt(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},n.prototype.databaseAction=function(e,t){var r=this;return new Promise((function(o,s){var i=r.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return gC(i)},i.onsuccess=function(){var a=i.result;if(t==null){var l=a.transaction(od,"readonly"),c=l.objectStore(od).get(r.modelPath);c.onsuccess=function(){if(c.result==null)return a.close(),s(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(x){return a.close(),s(c.error)},l.oncomplete=function(){return a.close()}}else{var u,d=Om(t),h=a.transaction(Wc,"readwrite"),p=h.objectStore(Wc),g=p.put({modelPath:r.modelPath,modelArtifactsInfo:d});g.onsuccess=function(){var x=(u=a.transaction(od,"readwrite")).objectStore(od).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:d});x.onsuccess=function(){return o({modelArtifactsInfo:d})},x.onerror=function(y){var b=(p=h.objectStore(Wc)).delete(r.modelPath);b.onsuccess=function(){return a.close(),s(x.error)},b.onerror=function(C){return a.close(),s(x.error)}}},g.onerror=function(x){return a.close(),s(g.error)},h.oncomplete=function(){u==null?a.close():u.oncomplete=function(){return a.close()}}}},i.onerror=function(a){return s(i.error)}}))},n.URL_SCHEME="indexeddb://",n})(),_I=function(n){return Ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Zh.URL_SCHEME)?(e=n.slice(Zh.URL_SCHEME.length),new Zh(e)):null;var e};ti.registerSaveRouter(_I),ti.registerLoadRouter(_I);var YJ=(function(){function n(){this.indexedDB=FA()}return n.prototype.listModels=function(){return pt(this,void 0,void 0,(function(){var e=this;return mt(this,(function(t){return[2,new Promise((function(r,o){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return gC(s)},s.onsuccess=function(){var i=s.result,a=i.transaction(Wc,"readonly"),l=a.objectStore(Wc).getAll();l.onsuccess=function(){for(var c={},u=0,d=l.result;u<d.length;u++){var h=d[u];c[h.modelPath]=h.modelArtifactsInfo}r(c)},l.onerror=function(c){return i.close(),o(l.error)},a.oncomplete=function(){return i.close()}},s.onerror=function(i){return o(s.error)}}))]}))}))},n.prototype.removeModel=function(e){return pt(this,void 0,void 0,(function(){var t=this;return mt(this,(function(r){var o;return e=(o=e).startsWith(Zh.URL_SCHEME)?o.slice(Zh.URL_SCHEME.length):o,[2,new Promise((function(s,i){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return gC(a)},a.onsuccess=function(){var l,c=a.result,u=c.transaction(Wc,"readwrite"),d=u.objectStore(Wc),h=d.get(e);h.onsuccess=function(){if(h.result==null)return c.close(),i(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var p=d.delete(e),g=function(){var x=(l=c.transaction(od,"readwrite")).objectStore(od).delete(e);x.onsuccess=function(){return s(h.result.modelArtifactsInfo)},x.onerror=function(y){return i(h.error)}};p.onsuccess=g,p.onerror=function(x){return g(),c.close(),i(h.error)}},h.onerror=function(p){return c.close(),i(h.error)},u.oncomplete=function(){l==null?c.close():l.oncomplete=function(){return c.close()}}},a.onerror=function(l){return i(a.error)}}))]}))}))},n})();if(Ae().getBool("IS_BROWSER"))try{Kc.registerManager(Zh.URL_SCHEME,new YJ)}catch{}var Wl="/",jh="tensorflowjs_models",PA="info",ZJ="model_topology",QJ="weight_specs",JJ="weight_data",eee="model_metadata";function MA(n){return{info:[jh,n,PA].join(Wl),topology:[jh,n,ZJ].join(Wl),weightSpecs:[jh,n,QJ].join(Wl),weightData:[jh,n,JJ].join(Wl),modelMetadata:[jh,n,eee].join(Wl)}}function tee(n){var e=n.split(Wl);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Wl)}var Qh=(function(){function n(e){if(!Ae().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=MA(this.modelPath)}return n.prototype.save=function(e){return pt(this,void 0,void 0,(function(){var t,r,o;return mt(this,(function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),o=Om(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(function(i){if(mC)return Buffer.from(i).toString("base64");for(var a=new Uint8Array(i),l="",c=0,u=a.length;c<u;c++)l+=String.fromCharCode(a[c]);return btoa(l)})(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]}))}))},n.prototype.load=function(){return pt(this,void 0,void 0,(function(){var e,t,r,o,s,i,a;return mt(this,(function(l){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=o,(s=this.LS.getItem(this.keys.modelMetadata))!=null&&(i=JSON.parse(s),t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,t.userDefinedMetadata=i.userDefinedMetadata),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(c){if(mC){var u=Buffer.from(c,"base64");return u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)}for(var d=atob(c),h=new Uint8Array(d.length),p=0;p<d.length;++p)h.set([d.charCodeAt(p)],p);return h.buffer})(a),[2,t]}))}))},n.URL_SCHEME="localstorage://",n})(),$I=function(n){return Ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Qh.URL_SCHEME)?(e=n.slice(Qh.URL_SCHEME.length),new Qh(e)):null;var e};ti.registerSaveRouter($I),ti.registerLoadRouter($I);var nee=(function(){function n(){Y(Ae().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),Y(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return n.prototype.listModels=function(){return pt(this,void 0,void 0,(function(){var e,t,r,o,s,i;return mt(this,(function(a){for(e={},t=jh+Wl,r=Wl+PA,o=0;o<this.LS.length;++o)(s=this.LS.key(o)).startsWith(t)&&s.endsWith(r)&&(i=tee(s),e[i]=JSON.parse(this.LS.getItem(s)));return[2,e]}))}))},n.prototype.removeModel=function(e){return pt(this,void 0,void 0,(function(){var t,r;return mt(this,(function(o){var s;if(e=(s=e).startsWith(Qh.URL_SCHEME)?s.slice(Qh.URL_SCHEME.length):s,t=MA(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},n})();if(Ae().getBool("IS_BROWSER"))try{Kc.registerManager(Qh.URL_SCHEME,new nee)}catch{}var ree="model",oee=".json",see=".weights.bin";function FI(n){return new Promise((function(e){return setTimeout(e)})).then(n)}var a3=(function(){function n(e){if(!Ae().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=ree),this.modelTopologyFileName=e+oee,this.weightDataFileName=e+see}return n.prototype.save=function(e){return pt(this,void 0,void 0,(function(){var t,r,o,s,i,a;return mt(this,(function(l){switch(l.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],o={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},s=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(i=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=s,[4,FI((function(){return i.dispatchEvent(new MouseEvent("click"))}))];case 2:return l.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,FI((function(){return a.dispatchEvent(new MouseEvent("click"))}))]);case 3:l.sent(),l.label=4;case 4:return[2,{modelArtifactsInfo:Om(e)}]}}))}))},n.URL_SCHEME="downloads://",n})(),iee=(function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return pt(this,void 0,void 0,(function(){var e,t,r=this;return mt(this,(function(o){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(s,i){var a=new FileReader;a.onload=function(l){var c=JSON.parse(l.target.result),u=c.modelTopology;if(u!=null){t.length===0&&s({modelTopology:u});var d=c.weightsManifest;if(d!=null){var h;try{h=r.checkManifestAndWeightFiles(d,t)}catch(y){return void i(y)}var p=[],g=[],x=[];d.forEach((function(y){y.paths.forEach((function(b){g.push(b),x.push(null)})),p.push.apply(p,y.weights)})),d.forEach((function(y){y.paths.forEach((function(b){var C=new FileReader;C.onload=function(S){var k=S.target.result,N=g.indexOf(b);x[N]=k,x.indexOf(null)===-1&&s({modelTopology:u,weightSpecs:p,weightData:o5(x),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},C.onerror=function(S){return i("Failed to weights data from file of path '"+b+"'.")},C.readAsArrayBuffer(h[b])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(l){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],o=t.map((function(l){return DI(l.name)})),s={},i=0,a=e;i<a.length;i++)a[i].paths.forEach((function(l){var c=DI(l);if(r.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),o.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");s[l]=t[o.indexOf(c)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return s},n})();function PI(n,e,t,r){(function(s){Y(s!=null&&Array.isArray(s)&&s.length>0,(function(){return"promises must be a none empty array"}))})(n),(function(s,i){Y(s>=0&&s<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+s})),Y(i>=0&&i<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+i})),Y(i>=s,(function(){return"startFraction must be no more than endFraction, but got startFraction "+s+" and endFraction "+i}))})(t=t??0,r=r??1);var o=0;return Promise.all(n.map((function(s){return s.then((function(i){var a=t+ ++o/n.length*(r-t);return e(a),i})),s})))}function OA(n,e){return pt(this,void 0,void 0,(function(){var t,r,o,s,i,a,l,c,u;return mt(this,(function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Ae().platform.fetch:e.fetchFunc,r=n.map((function(h){return t(h,e.requestInit,{isBinary:!0})})),o=0,s=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return i=d.sent(),[3,4];case 2:return[4,PI(r,e.onProgress,o,s)];case 3:i=d.sent(),d.label=4;case 4:return a=i.map((function(h){return h.arrayBuffer()})),l=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return u=d.sent(),[3,8];case 6:return[4,PI(a,e.onProgress,l,c)];case 7:u=d.sent(),d.label=8;case 8:return[2,u]}}))}))}function MI(n){var e=this;return function(t,r,o){return r===void 0&&(r=""),pt(e,void 0,void 0,(function(){var s,i,a,l,c,u,d,h,p,g;return mt(this,(function(x){switch(x.label){case 0:if(s=t.map((function(){return!1})),i={},a=o!=null?o.map((function(){return!1})):[],l=[],t.forEach((function(y,b){var C=0;y.weights.forEach((function(S){var k="quantization"in S?S.quantization.dtype:S.dtype,N=pC[k]*yt(S.shape),E=function(){s[b]=!0,i[b]==null&&(i[b]=[]),i[b].push({manifestEntry:S,groupOffset:C,sizeBytes:N})};o!=null?o.forEach((function(_,$){_===S.name&&(E(),a[$]=!0)})):E(),l.push(S.name),C+=N}))})),!a.every((function(y){return y})))throw c=o.filter((function(y,b){return!a[b]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+l.join(", ")+".");return u=s.reduce((function(y,b,C){return b&&y.push(C),y}),[]),d=[],u.forEach((function(y){t[y].paths.forEach((function(b){var C=r+(r.endsWith("/")?"":"/")+b;d.push(C)}))})),[4,n(d)];case 1:return h=x.sent(),p={},g=0,u.forEach((function(y){for(var b=t[y].paths.length,C=0,S=0;S<b;S++)C+=h[g+S].byteLength;for(var k=new ArrayBuffer(C),N=new Uint8Array(k),E=0,_=0;_<b;_++){var $=new Uint8Array(h[g+_]);N.set($,E),E+=$.byteLength}i[y].forEach((function(T){var D=$A(k.slice(T.groupOffset,T.groupOffset+T.sizeBytes),[T.manifestEntry]);for(var A in D)p[A]=D[A]})),g+=b})),[2,p]}}))}))}}ti.registerSaveRouter((function(n){return Ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(a3.URL_SCHEME)?(function(e){return e===void 0&&(e="model"),new a3(e)})(n.slice(a3.URL_SCHEME.length)):null}));var LA=(function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(Y(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=Ae().platform.fetch,Y(e!=null&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&Y(e.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return pt(this,void 0,void 0,(function(){var t,r,o,s;return mt(this,(function(i){switch(i.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],o={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((s=i.sent()).ok)return[2,{modelArtifactsInfo:Om(e),responses:[s]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+s.status+".")}}))}))},n.prototype.load=function(){return pt(this,void 0,void 0,(function(){var e,t,r,o,s,i,a,l,c,u,d,h;return mt(this,(function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,e.json()];case 3:return t=p.sent(),[3,5];case 4:throw p.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=t.modelTopology,s=t.weightsManifest,i=t.generatedBy,a=t.convertedBy,l=t.format,c=t.userDefinedMetadata,o==null&&s==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return s==null?[3,7]:[4,this.loadWeights(s)];case 6:h=p.sent(),u=h[0],d=h[1],p.label=7;case 7:return[2,{modelTopology:o,weightSpecs:u,weightData:d,userDefinedMetadata:c,generatedBy:i,convertedBy:a,format:l}]}}))}))},n.prototype.loadWeights=function(e){return pt(this,void 0,void 0,(function(){var t,r,o,s,i,a,l,c,u,d,h;return mt(this,(function(p){switch(p.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(g){var x=g.lastIndexOf("/"),y=g.lastIndexOf("?"),b=g.substring(0,x),C=y>x?g.substring(y):"";return[b+"/",C]})(t),o=r[0],s=r[1],i=this.weightPathPrefix||o,a=[],l=0,c=e;l<c.length;l++)u=c[l],a.push.apply(a,u.weights);return d=[],e.forEach((function(g){g.paths.forEach((function(x){d.push(i+x+s)}))})),[4,OA(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=p.sent(),[2,[a,o5(h)]]}}))}))},n.URL_SCHEME_REGEX=/^https?:\/\//,n})();function xC(n){return n.match(LA.URL_SCHEME_REGEX)!=null}var OI=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every((function(t){return xC(t)})):xC(n))?vC(n,{onProgress:e}):null};function vC(n,e){return new LA(n,e)}ti.registerSaveRouter(OI),ti.registerLoadRouter(OI);var l3=(function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return pt(this,void 0,void 0,(function(){return mt(this,(function(e){return[2,this.modelArtifacts]}))}))},n})(),aee=(function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){return[2,this.saveHandler(e)]}))}))},n})(),BA=Object.freeze({browserFiles:function(n){return new iee(n)},browserHTTPRequest:function(n,e){return vC(n,e)},concatenateArrayBuffers:o5,decodeWeights:$A,encodeWeights:function(n,e){return pt(this,void 0,void 0,(function(){var t,r,o,s,i,a=this;return mt(this,(function(l){switch(l.label){case 0:for(t=[],r=[],o=Array.isArray(n)?n.map((function(c){return c.name})):Object.keys(n),s=function(c){var u=o[c],d=Array.isArray(n)?n[c].tensor:n[u];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+u+"': "+d.dtype);var h={name:u,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var p=new Promise((function(g){return pt(a,void 0,void 0,(function(){var x,y,b,C,S,k,N;return mt(this,(function(E){switch(E.label){case 0:return[4,d.bytes()];case 1:for(x=E.sent(),y=x.reduce((function(_,$){return _+$.length}),0)+Mx*x.length,b=new Uint8Array(y),C=0,S=0;S<x.length;S++)k=x[S],N=new Uint8Array(new Uint32Array([k.length]).buffer),b.set(N,C),C+=Mx,b.set(k,C),C+=k.length;return g(b),[2]}}))}))}));r.push(p)}else r.push(d.data());e!=null&&(h.group=e),t.push(h)},i=0;i<o.length;++i)s(i);return[4,Promise.all(r)];case 1:return[2,{data:XJ(l.sent()),specs:t}]}}))}))},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new l3(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new l3({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new l3({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return ti.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:Om,getSaveHandlers:function(n){return ti.getSaveHandlers(n)},http:vC,isHTTPScheme:xC,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),pt(this,void 0,void 0,(function(){return mt(this,(function(o){return[2,MI((function(s){return OA(s,{requestInit:r})}))(n,e,t)]}))}))},registerLoadRouter:function(n){return ti.registerLoadRouter(n)},registerSaveRouter:function(n){return ti.registerSaveRouter(n)},weightsLoaderFactory:MI,withSaveHandler:function(n){return new aee(n)},copyModel:function(n,e){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){return[2,AI(n,e,!1)]}))}))},listModels:function(){return pt(this,void 0,void 0,(function(){var n,e,t,r,o,s,i;return mt(this,(function(a){switch(a.label){case 0:n=Kc.getSchemes(),e={},t=0,r=n,a.label=1;case 1:return t<r.length?(o=r[t],[4,Kc.getManager(o).listModels()]):[3,4];case 2:for(i in s=a.sent())e[o+Yh+i]=s[i];a.label=3;case 3:return t++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(n,e){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){return[2,AI(n,e,!0)]}))}))},removeModel:function(n){return pt(this,void 0,void 0,(function(){var e;return mt(this,(function(t){return e=nx(n),[2,Kc.getManager(e.scheme).removeModel(e.path)]}))}))}}),_h;re({confusionMatrix_:function(n,e,t){var r=X(n,"labels","confusionMatrix"),o=X(e,"predictions","confusionMatrix");Y(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),Y(r.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),Y(o.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+o.rank})),Y(r.shape[0]===o.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."})),Y(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var s=cC(r.asType("int32"),t),i=cC(o.asType("int32"),t);return s.transpose().matMul(i).asType("int32")}});var lee=re({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,o=!1,s=!1,i=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)s=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);i=!0}if(o&&o&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(cD("FromPixels",ce.backendName)!=null)return ce.runKernel("FromPixels",{pixels:n},{numChannels:e});var a,l,c=o?[n.videoWidth,n.videoHeight]:[n.width,n.height],u=c[0],d=c[1];if(i?a=n.getContext("2d").getImageData(0,0,u,d).data:r||t?a=n.data:(s||o)&&(_h==null&&(_h=document.createElement("canvas").getContext("2d")),_h.canvas.width=u,_h.canvas.height=d,_h.drawImage(n,0,0,u,d),a=_h.getImageData(0,0,u,d).data),e===4)l=new Int32Array(a);else{var h=u*d;l=new Int32Array(h*e);for(var p=0;p<h;p++)for(var g=0;g<e;++g)l[p*e+g]=a[4*p+g]}return $4(l,[d,u,e],"int32")}}),s5=Object.freeze({toPixels:function(n,e){return pt(this,void 0,void 0,(function(){var t,r,o,s,i,a,l,c,u,d,h,p,g,x,y,b,C,S,k,N,E,_,$;return mt(this,(function(T){switch(T.label){case 0:if(t=X(n,"img","toPixels"),n instanceof ur||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),o=r[0],s=r[1],(i=t.rank===2?1:t.shape[2])>4||i===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,t.data()];case 1:return a=T.sent(),l=t.min(),c=t.max(),[4,Promise.all([l.data(),c.data()])];case 2:if(u=T.sent(),d=u[0],h=u[1],p=d[0],g=h[0],l.dispose(),c.dispose(),t.dtype==="float32"){if(p<0||g>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+g+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(p<0||g>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+g+"].")}for(x=t.dtype==="float32"?255:1,y=new Uint8ClampedArray(s*o*4),b=0;b<o*s;++b)C=void 0,S=void 0,k=void 0,N=void 0,i===1?(C=a[b]*x,S=a[b]*x,k=a[b]*x,N=255):i===3?(C=a[3*b]*x,S=a[3*b+1]*x,k=a[3*b+2]*x,N=255):i===4&&(C=a[4*b]*x,S=a[4*b+1]*x,k=a[4*b+2]*x,N=a[4*b+3]*x),y[(E=4*b)+0]=Math.round(C),y[E+1]=Math.round(S),y[E+2]=Math.round(k),y[E+3]=Math.round(N);return e!=null&&(e.width=s,e.height=o,_=e.getContext("2d"),$=new ImageData(y,s,o),_.putImageData($,0,0)),t!==n&&t.dispose(),[2,y]}}))}))},fromPixels:lee}),cee=(function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n})(),uee=(function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n})();function Pd(n){Y(n.className!=null,(function(){return"Class being registered does not have the static className property defined."})),Y(typeof n.className=="string",(function(){return"className is required to be a string, but got type "+typeof n.className})),Y(n.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),uee.register(n)}var Md=(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return xa(e,n),e.prototype.minimize=function(t,r,o){r===void 0&&(r=!1);var s=this.computeGradients(t,o),i=s.value,a=s.grads;if(o!=null){var l=o.map((function(c){return{name:c.name,tensor:a[c.name]}}));this.applyGradients(l)}else this.applyGradients(a);return Ps(a),r?i:(i.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return bX(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Ps(this.iterations_)},e.prototype.saveIterations=function(){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:et(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return pt(this,void 0,void 0,(function(){return mt(this,(function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return pt(this,void 0,void 0,(function(){var r;return mt(this,(function(o){switch(o.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,t.slice(1)]}}))}))},e})(cee);Object.defineProperty(Md,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var dee=(function(n){function e(t,r,o){o===void 0&&(o=null);var s=n.call(this)||this;return s.learningRate=t,s.rho=r,s.epsilon=o,s.accumulatedGrads=[],s.accumulatedUpdates=[],o==null&&(s.epsilon=ce.backend.epsilon()),s}return xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,s){var i=ce.registeredVariables[o];r.accumulatedGrads[s]==null&&(r.accumulatedGrads[s]={originalName:o+"/accum_grad",variable:lt((function(){return gn(i).variable(!1)}))}),r.accumulatedUpdates[s]==null&&(r.accumulatedUpdates[s]={originalName:o+"/accum_var",variable:lt((function(){return gn(i).variable(!1)}))});var a=Array.isArray(t)?t[s].tensor:t[o];if(a!=null){var l=r.accumulatedGrads[s].variable,c=r.accumulatedUpdates[s].variable;lt((function(){var u=l.mul(r.rho).add(a.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(l.add(r.epsilon).sqrt()).mul(a),h=c.mul(r.rho).add(d.square().mul(1-r.rho));l.assign(u),c.assign(h);var p=d.mul(-r.learningRate).add(i);i.assign(p)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Ps(this.accumulatedGrads.map((function(t){return t.variable}))),Ps(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return pt(this,void 0,void 0,(function(){var t;return mt(this,(function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},e.prototype.setWeights=function(t){return pt(this,void 0,void 0,(function(){var r;return mt(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(r,2*r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e})(Md);Pd(dee);var hee=(function(n){function e(t,r){r===void 0&&(r=.1);var o=n.call(this)||this;return o.learningRate=t,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,s){var i=ce.registeredVariables[o];r.accumulatedGrads[s]==null&&(r.accumulatedGrads[s]={originalName:o+"/accumulator",variable:lt((function(){return tl(i.shape,r.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(t)?t[s].tensor:t[o];if(a!=null){var l=r.accumulatedGrads[s].variable;lt((function(){var c=l.add(a.square());l.assign(c);var u=a.div(c.add(ce.backend.epsilon()).sqrt()).mul(-r.learningRate).add(i);i.assign(u)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Ps(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return pt(this,void 0,void 0,(function(){return mt(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e})(Md);Pd(hee);var fee=(function(n){function e(t,r,o,s){s===void 0&&(s=null);var i=n.call(this)||this;return i.learningRate=t,i.beta1=r,i.beta2=o,i.epsilon=s,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],lt((function(){i.accBeta1=et(r).variable(),i.accBeta2=et(o).variable()})),s==null&&(i.epsilon=ce.backend.epsilon()),i}return xa(e,n),e.prototype.applyGradients=function(t){var r=this,o=Array.isArray(t)?t.map((function(s){return s.name})):Object.keys(t);lt((function(){var s=Jr(1,r.accBeta1),i=Jr(1,r.accBeta2);o.forEach((function(a,l){var c=ce.registeredVariables[a];r.accumulatedFirstMoment[l]==null&&(r.accumulatedFirstMoment[l]={originalName:a+"/m",variable:lt((function(){return gn(c).variable(!1)}))}),r.accumulatedSecondMoment[l]==null&&(r.accumulatedSecondMoment[l]={originalName:a+"/v",variable:lt((function(){return gn(c).variable(!1)}))});var u=Array.isArray(t)?t[l].tensor:t[a];if(u!=null){var d=r.accumulatedFirstMoment[l].variable,h=r.accumulatedSecondMoment[l].variable,p=d.mul(r.beta1).add(u.mul(1-r.beta1)),g=h.mul(r.beta2).add(u.square().mul(1-r.beta2)),x=p.div(s),y=g.div(i);d.assign(p),h.assign(g);var b=x.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(b)}})),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ps(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&Ps(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return pt(this,void 0,void 0,(function(){var t;return mt(this,(function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},e.prototype.setWeights=function(t){return pt(this,void 0,void 0,(function(){var r,o=this;return mt(this,(function(s){switch(s.label){case 0:return[4,this.extractIterations(t)];case 1:return t=s.sent(),lt((function(){o.accBeta1.assign(Fx(o.beta1,o.iterations_+1)),o.accBeta2.assign(Fx(o.beta2,o.iterations_+1))})),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(r,2*r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e})(Md);Pd(fee);var pee=(function(n){function e(t,r,o,s,i){s===void 0&&(s=null),i===void 0&&(i=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=o,a.epsilon=s,a.decay=i,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],lt((function(){a.iteration=et(0).variable(),a.accBeta1=et(r).variable()})),s==null&&(a.epsilon=ce.backend.epsilon()),a}return xa(e,n),e.prototype.applyGradients=function(t){var r=this,o=Array.isArray(t)?t.map((function(s){return s.name})):Object.keys(t);lt((function(){var s=Jr(1,r.accBeta1),i=na(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach((function(a,l){var c=ce.registeredVariables[a];r.accumulatedFirstMoment[l]==null&&(r.accumulatedFirstMoment[l]={originalName:a+"/m",variable:gn(c).variable(!1)}),r.accumulatedWeightedInfNorm[l]==null&&(r.accumulatedWeightedInfNorm[l]={originalName:a+"/v",variable:gn(c).variable(!1)});var u=Array.isArray(t)?t[l].tensor:t[a];if(u!=null){var d=r.accumulatedFirstMoment[l].variable,h=r.accumulatedWeightedInfNorm[l].variable,p=d.mul(r.beta1).add(u.mul(1-r.beta1)),g=h.mul(r.beta2),x=u.abs(),y=g.maximum(x);d.assign(p),h.assign(y);var b=i.div(s).mul(p.div(y.add(r.epsilon))).add(c);c.assign(b)}})),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ps(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&Ps(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return pt(this,void 0,void 0,(function(){return mt(this,(function(r){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e})(Md);Pd(pee);var jA=(function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,s){var i=Array.isArray(t)?t[s].tensor:t[o];if(i!=null){var a=ce.registeredVariables[o];lt((function(){var l=r.c.mul(i).add(a);a.assign(l)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=FK(et(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return pt(this,void 0,void 0,(function(){return mt(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e})(Md);Pd(jA);var mee=(function(n){function e(t,r,o){o===void 0&&(o=!1);var s=n.call(this,t)||this;return s.learningRate=t,s.momentum=r,s.useNesterov=o,s.accumulations=[],s.m=et(s.momentum),s}return xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,s){var i=ce.registeredVariables[o];r.accumulations[s]==null&&(r.accumulations[s]={originalName:o+"/momentum",variable:lt((function(){return gn(i).variable(!1)}))});var a=r.accumulations[s].variable,l=Array.isArray(t)?t[s].tensor:t[o];l!=null&&lt((function(){var c,u=r.m.mul(a).add(l);c=r.useNesterov?r.c.mul(l.add(u.mul(r.m))).add(i):r.c.mul(u).add(i),a.assign(u),i.assign(c)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Ps(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return pt(this,void 0,void 0,(function(){return mt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return pt(this,void 0,void 0,(function(){return mt(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e})(jA);Pd(mee);var gee=(function(n){function e(t,r,o,s,i){r===void 0&&(r=.9),o===void 0&&(o=0),s===void 0&&(s=null),i===void 0&&(i=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=o,a.epsilon=s,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=i,s==null&&(a.epsilon=ce.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,s){var i=ce.registeredVariables[o];r.accumulatedMeanSquares[s]==null&&(r.accumulatedMeanSquares[s]={originalName:o+"/rms",variable:lt((function(){return gn(i).variable(!1)}))}),r.accumulatedMoments[s]==null&&(r.accumulatedMoments[s]={originalName:o+"/momentum",variable:lt((function(){return gn(i).variable(!1)}))}),r.accumulatedMeanGrads[s]==null&&r.centered&&(r.accumulatedMeanGrads[s]={originalName:o+"/mg",variable:lt((function(){return gn(i).variable(!1)}))});var a=Array.isArray(t)?t[s].tensor:t[o];if(a!=null){var l=r.accumulatedMeanSquares[s].variable,c=r.accumulatedMoments[s].variable;lt((function(){var u=l.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[s].variable,h=d.mul(r.decay).add(a.mul(1-r.decay)),p=c.mul(r.momentum).add(a.mul(r.learningRate).div(u.sub(h.square().add(r.epsilon)).sqrt()));l.assign(u),d.assign(h),c.assign(p);var g=i.sub(p);i.assign(g)}else{var x=l.mul(r.decay).add(a.square().mul(1-r.decay));p=c.mul(r.momentum).add(a.mul(r.learningRate).div(x.add(r.epsilon).sqrt())),l.assign(x),c.assign(p),g=i.sub(p),i.assign(g)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Ps(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&Ps(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&Ps(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return pt(this,void 0,void 0,(function(){var t;return mt(this,(function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},e.prototype.setWeights=function(t){return pt(this,void 0,void 0,(function(){var r;return mt(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(r,2*r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e})(Md);Pd(gee);ur.prototype.squaredDifference=function(n){return tA(this,n)},Ee=zJ;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var yC=function(n,e){return yC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},yC(n,e)};function zt(n,e){yC(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Uo=function(){return Uo=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Uo.apply(this,arguments)};function Ct(n,e,t,r){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(n,[])).next())})}function kt(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,o,s,i;return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(s=c[0]&2?o.return:c[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,c[1])).done)return s;switch(o=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,o=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],o=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Xp(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),o=0,e=0;e<t;e++)for(var s=arguments[e],i=0,a=s.length;i<a;i++,o++)r[o]=s[i];return r}var Jh=(function(){function n(e,t){if(!ld(e)||!ld(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n})();function Wv(n,e){return n instanceof ur&&n.shape.length===e}function xee(n){return Wv(n,2)}function Uv(n){return Wv(n,3)}function Xc(n){return Wv(n,4)}function vee(n){return n%1!==0}function LI(n){return n%2===0}function yee(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function BI(n){return n&&n.width&&n.height}function bee(n,e){var t=n.width,r=n.height,o=e/Math.max(r,t);return new Jh(Math.round(t*o),Math.round(r*o))}function i5(n){return n.reduce(function(e,t){return e.add(t)},new Tn(0,0)).div(new Tn(n.length,n.length))}function um(n,e,t){return Array(n).fill(0).map(function(r,o){return e+o*t})}function ld(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function jI(n){return ld(n)&&0<=n&&n<=1}var Tn=(function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n})(),ru=(function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},o=[r.left,r.top,r.right,r.bottom].every(ld),s=[r.x,r.y,r.width,r.height].every(ld);if(!s&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=s?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=i[0],l=i[1],c=i[2],u=i[3];n.assertIsValidBox({x:a,y:l,width:c,height:u},"Box.constructor",t),this._x=a,this._y=l,this._width=c,this._height=u}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(ld)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Tn(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Tn(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Tn(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Tn(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(i){return Math.round(i)}),t=e[0],r=e[1],o=e[2],s=e[3];return new n({x:t,y:r,width:o,height:s})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(i){return Math.floor(i)}),t=e[0],r=e[1],o=e[2],s=e[3];return new n({x:t,y:r,width:o,height:s})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,o=e.width,s=e.height,i=Math.abs(o-s);return o<s&&(t-=i/2,o+=i),s<o&&(r-=i/2,s+=i),new n({x:t,y:r,width:o,height:s})},n.prototype.rescale=function(e){var t=BI(e)?e.width:e,r=BI(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],o=r[0],s=r[1],i=r[2],a=r[3];return new n({x:o,y:s,width:i,height:a})},n.prototype.clipAtImageBorders=function(e,t){var r=this,o=r.x,s=r.y,i=r.right,a=r.bottom,l=Math.max(o,0),c=Math.max(s,0),u=i-l,d=a-c,h=Math.min(u,e-l),p=Math.min(d,t-c);return new n({x:l,y:c,width:h,height:p}).floor()},n.prototype.shift=function(e,t){var r=this,o=r.width,s=r.height,i=this.x+e,a=this.y+t;return new n({x:i,y:a,width:o,height:s})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,o=this.height+1,s=1,i=1,a=r,l=o,c=this.left,u=this.top,d=this.right,h=this.bottom;return d>t&&(a=-d+t+r,d=t),h>e&&(l=-h+e+o,h=e),c<1&&(l=2-c,c=1),u<1&&(l=2-u,u=1),{dy:i,edy:l,dx:s,edx:a,y:u,ey:h,x:c,ex:d,w:r,h:o}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n})(),Hv=(function(n){zt(e,n);function e(t,r,o,s,i){return i===void 0&&(i=!1),n.call(this,{left:t,top:r,right:o,bottom:s},i)||this}return e})(ru),VA=(function(){function n(e,t,r,o,s){this._imageDims=new Jh(s.width,s.height),this._score=e,this._classScore=t,this._className=r,this._box=new ru(o).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new ru(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n})(),yl=(function(n){zt(e,n);function e(t,r,o){return n.call(this,t,t,"",r,o)||this}return e.prototype.forSize=function(t,r){var o=n.prototype.forSize.call(this,t,r),s=o.score,i=o.relativeBox,a=o.imageDims;return new e(s,i,a)},e})(VA);function wee(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),o=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),s=r*o;return t?s/(n.area+e.area-s):s/Math.min(n.area,e.area)}function Cee(n){var e=n.map(function(a){return a.x}),t=n.map(function(a){return a.y}),r=e.reduce(function(a,l){return l<a?l:a},1/0),o=t.reduce(function(a,l){return l<a?l:a},1/0),s=e.reduce(function(a,l){return a<l?l:a},0),i=t.reduce(function(a,l){return a<l?l:a},0);return new Hv(r,o,s,i)}function dm(n,e,t,r){r===void 0&&(r=!0);for(var o=e.map(function(a,l){return{score:a,boxIndex:l}}).sort(function(a,l){return a.score-l.score}).map(function(a){return a.boxIndex}),s=[],i=function(){var a=o.pop();s.push(a);for(var l=o,c=[],u=0;u<l.length;u++){var d=l[u],h=n[a],p=n[d];c.push(wee(h,p,r))}o=o.filter(function(g,x){return c[x]<=t})};o.length>0;)i();return s}function Lm(n,e){return lt(function(){var t=e[0],r=e[1],o=e[2],s=tl(Xp(n.shape.slice(0,3),[1]),t),i=tl(Xp(n.shape.slice(0,3),[1]),r),a=tl(Xp(n.shape.slice(0,3),[1]),o),l=Yr([s,i,a],3);return Jr(n,l)})}function kee(n,e){return e===void 0&&(e=!1),lt(function(){var t=n.shape.slice(1),r=t[0],o=t[1];if(r===o)return n;var s=Math.abs(r-o),i=Math.round(s*(e?.5:1)),a=r>o?2:1,l=function(p){var g=n.shape.slice();return g[a]=p,tl(g,0)},c=l(i),u=s-c.shape[a],d=e&&u?l(u):null,h=[d,n,c].filter(function(p){return!!p}).map(function(p){return p.toFloat()});return Yr(h,a)})}function c3(n){return 1/(1+Math.exp(-n))}var a5=(function(n){zt(e,n);function e(t,r,o,s,i){return i===void 0&&(i=!1),n.call(this,{x:t,y:r,width:o,height:s},i)||this}return e})(ru),See=.5,Nee=.43,Iee=.45,Ox=(function(){function n(e,t,r){r===void 0&&(r=new Tn(0,0));var o=t.width,s=t.height;this._imgDims=new Jh(o,s),this._shift=r,this._positions=e.map(function(i){return i.mul(new Tn(o,s)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Tn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Tn(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Tn(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof yl?e.box.floor():new ru(e);return this.shiftBy(r.x,r.y).align(null,t)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),s=o.useDlibAlignment,i=o.minBoxPadding;return s?this.alignDlib():this.alignMinBbox(i)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],o=e[2],s=function(d){return o.sub(d).magnitude()},i=(s(t)+s(r))/2,a=Math.floor(i/Iee),l=i5(e),c=Math.floor(Math.max(0,l.x-See*a)),u=Math.floor(Math.max(0,l.y-Nee*a));return new a5(c,u,Math.min(a,this.imageWidth+c),Math.min(a,this.imageHeight+u))},n.prototype.alignMinBbox=function(e){var t=Cee(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n})(),Eee=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],i5([t[3],t[4]])]},e})(Ox),Tee=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(i5)},e})(Ox),VI=(function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+yee(this.distance)+")":"")},n})(),zI=(function(n){zt(e,n);function e(t,r){var o=n.call(this,t)||this;return o._label=r,o}return e.assertIsValidLabeledBox=function(t,r){if(ru.assertIsValidBox(t,r),!ld(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e})(ru),D0=(function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n})();(function(n){zt(e,n);function e(t,r,o,s){var i=n.call(this,t,r)||this;return i._score=o,i._classScore=s,i}return e.assertIsValidPredictedBox=function(t,r){if(zI.assertIsValidLabeledBox(t,r),!jI(t.score)||!jI(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(zI);function Ree(n){return n.detection instanceof yl}function l5(n,e){var t={detection:e};return Object.assign({},n,t)}function zA(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function WA(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(o,s){n.readFile(r,function(i,a){return i?s(i):o(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function UA(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},s=WA();return Uo({Canvas:n||(function(){function i(){}return i})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function i(){}return i})(),Image:e||(function(){function i(){}return i})(),ImageData:global.ImageData||(function(){function i(){}return i})(),Video:global.HTMLVideoElement||(function(){function i(){}return i})(),createCanvasElement:t,createImageElement:r,fetch:o},s)}function HA(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function GA(){return typeof global=="object"&&typeof require=="function"&&typeof hB<"u"&&typeof process<"u"&&!!process.version}var Hr;function Dee(){if(!Hr)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Hr}function bC(n){Hr=n}function c5(){HA()&&bC(zA()),GA()&&bC(UA())}function Aee(n){if(Hr||c5(),!Hr)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?Hr.Canvas:e,r=n.Image,o=r===void 0?Hr.Image:r;Hr.Canvas=t,Hr.Image=o,Hr.createCanvasElement=n.createCanvasElement||(function(){return new t}),Hr.createImageElement=n.createImageElement||(function(){return new o}),Hr.ImageData=n.ImageData||Hr.ImageData,Hr.Video=n.Video||Hr.Video,Hr.fetch=n.fetch||Hr.fetch,Hr.readFile=n.readFile||Hr.readFile}var Qo={getEnv:Dee,setEnv:bC,initialize:c5,createBrowserEnv:zA,createFileSystem:WA,createNodejsEnv:UA,monkeyPatch:Aee,isBrowser:HA,isNodejs:GA};c5();function qA(n){return!Qo.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function md(n){var e=Qo.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var o=qA(n);if(!(o instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var s=o.getContext("2d");if(!s)throw new Error("resolveContext2d - canvas 2d context is null");return s}var WI;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(WI||(WI={}));function KA(n){var e=Qo.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function _ee(n){return new Promise(function(e,t){if(n instanceof Qo.getEnv().Canvas||KA(n))return e();function r(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",r),s.currentTarget.removeEventListener("error",o),e(s))}function o(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",r),s.currentTarget.removeEventListener("error",o),t(s))}n.addEventListener("load",r),n.addEventListener("error",o)})}function XA(n){var e=Qo.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Jh(n.naturalWidth,n.naturalHeight):n instanceof r?new Jh(n.videoWidth,n.videoHeight):new Jh(n.width,n.height)}function Gv(n){var e=n.width,t=n.height,r=Qo.getEnv().createCanvasElement,o=r();return o.width=e,o.height=t,o}function u5(n,e){var t=Qo.getEnv().ImageData;if(!(n instanceof t)&&!KA(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=XA(n),o=r.width,s=r.height,i=Gv({width:o,height:s});return n instanceof t?md(i).putImageData(n,0,0):md(i).drawImage(n,0,0,o,s),i}function $ee(n,e){return Ct(this,void 0,void 0,function(){var t,r,o,s,i,a;return kt(this,function(l){switch(l.label){case 0:return t=Qo.getEnv().createCanvasElement(),r=n.shape.slice(Xc(n)?1:0),o=r[0],s=r[1],i=r[2],a=lt(function(){return n.as3D(o,s,i).toInt()}),[4,s5.toPixels(a,t)];case 1:return l.sent(),a.dispose(),[2,t]}})})}function UI(n){var e=Qo.getEnv(),t=e.Image,r=e.Canvas,o=e.Video;return n instanceof t||n instanceof r||n instanceof o}function Fee(n,e,t){t===void 0&&(t=!1);var r=Qo.getEnv(),o=r.Image,s=r.Canvas;if(!(n instanceof o||n instanceof s))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=XA(n),a=e/Math.max(i.height,i.width),l=a*i.width,c=a*i.height,u=Gv({width:e,height:e}),d=n instanceof s?n:u5(n),h=Math.abs(l-c)/2,p=t&&l<c?h:0,g=t&&c<l?h:0;return md(u).drawImage(d,p,g,l,c),u}var Lx=(function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(o,s){if(Uv(o)){r._imageTensors[s]=o,r._inputDimensions[s]=o.shape;return}if(Xc(o)){var i=o.shape[0];if(i!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+i+" passed, but not supported in input array");r._imageTensors[s]=o,r._inputDimensions[s]=o.shape.slice(1);return}var a=o instanceof Qo.getEnv().Canvas?o:u5(o);r._canvases[s]=a,r._inputDimensions[s]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return um(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return bee({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,lt(function(){var o=um(r.batchSize,0,1).map(function(i){var a=r.getInput(i);if(a instanceof ur){var l=Xc(a)?a:a.expandDims();return l=kee(l,t),(l.shape[1]!==e||l.shape[2]!==e)&&(l=J4.resizeBilinear(l,[e,e])),l.as3D(e,e,3)}if(a instanceof Qo.getEnv().Canvas)return s5.fromPixels(Fee(a,e,t));throw new Error("toBatchTensor - at batchIdx "+i+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),s=si(o.map(function(i){return i.toFloat()})).as4D(r.batchSize,e,e,3);return s})},n})();function fo(n){return Ct(this,void 0,void 0,function(){var e,t,r;return kt(this,function(o){switch(o.label){case 0:if(n instanceof Lx)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(s){return Array.isArray(n)?" at input index "+s+":":""},r=e.map(qA),r.forEach(function(s,i){if(!UI(s)&&!Uv(s)&&!Xc(s))throw typeof e[i]=="string"?new Error("toNetInput -"+t(i)+" string passed, but could not resolve HTMLElement for element id "+e[i]):new Error("toNetInput -"+t(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Xc(s)){var a=s.shape[0];if(a!==1)throw new Error("toNetInput -"+t(i)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(s){return UI(s)&&_ee(s)}))];case 1:return o.sent(),[2,new Lx(r,Array.isArray(n))]}})})}function d5(n,e){return Ct(this,void 0,void 0,function(){var t,r,o,s,i,a,l;return kt(this,function(c){switch(c.label){case 0:return t=Qo.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,fo(n)];case 1:if(o=c.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return s=o.getInput(0),s instanceof t?(i=s,[3,4]):[3,2];case 2:return[4,$ee(s)];case 3:i=c.sent(),c.label=4;case 4:r=i,c.label=5;case 5:return a=md(r),l=e.map(function(u){return u instanceof yl?u.forSize(r.width,r.height).box.floor():u}).map(function(u){return u.clipAtImageBorders(r.width,r.height)}),[2,l.map(function(u){var d=u.x,h=u.y,p=u.width,g=u.height,x=Gv({width:p,height:g});return md(x).putImageData(a.getImageData(d,h,p,g),0,0),x})]}})})}function h5(n,e){return Ct(this,void 0,void 0,function(){return kt(this,function(t){if(!Uv(n)&&!Xc(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Xc(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,lt(function(){var r=n.shape.slice(Xc(n)?1:0),o=r[0],s=r[1],i=r[2],a=e.map(function(c){return c instanceof yl?c.forSize(s,o).box:c}).map(function(c){return c.clipAtImageBorders(s,o)}),l=a.map(function(c){var u=c.x,d=c.y,h=c.width,p=c.height;return CA(n.as3D(o,s,i),[d,u,0],[p,h,i])});return l})]})})}function Pee(n,e){return Ct(this,void 0,void 0,function(){var t,r;return kt(this,function(o){switch(o.label){case 0:return t=Qo.getEnv().fetch,[4,t(n,e)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function Mee(n){return Ct(this,void 0,void 0,function(){return kt(this,function(e){switch(e.label){case 0:return[4,Pee(n)];case 1:return[2,e.sent().json()]}})})}function YA(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var o=n.split("/").filter(function(a){return a}),s=n.endsWith(".json")?o[o.length-1]:t,i=r+(n.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return i=n.startsWith("/")?"/"+i:i,{modelBaseUri:i,manifestUri:i==="/"?"/"+s:i+"/"+s}}function Oee(n,e){return Ct(this,void 0,void 0,function(){var t,r,o,s;return kt(this,function(i){switch(i.label){case 0:return t=YA(n,e),r=t.manifestUri,o=t.modelBaseUri,[4,Mee(r)];case 1:return s=i.sent(),[2,BA.loadWeights(s,o)]}})})}var rc=(function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,o=t.objProp;return r[o]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),o=r.obj,s=r.objProp;o[s].dispose(),o[s]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof uf})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof uf)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,o=t.tensor;e.reassignParamFromPath(r,o.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,o=t.tensor,s=Io(o.dataSync());o.dispose(),e.reassignParamFromPath(r,s)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return Ct(this,void 0,void 0,function(){return kt(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return Ct(this,void 0,void 0,function(){var t;return kt(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Oee(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return Ct(this,void 0,void 0,function(){var t,r,o,s,i,a,l,c,u,d;return kt(this,function(h){switch(h.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Qo.getEnv().readFile,r=YA(e,this.getDefaultModelName()),o=r.manifestUri,s=r.modelBaseUri,i=function(p){return Promise.all(p.map(function(g){return t(g).then(function(x){return x.buffer})}))},a=BA.weightsLoaderFactory(i),u=(c=JSON).parse,[4,t(o)];case 1:return l=u.apply(c,[h.sent().toString()]),[4,a(l,s)];case 2:return d=h.sent(),this.loadFromWeightMap(d),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,o=t.params;this._paramMappings=r,this._params=o},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,o=t.params;this._paramMappings=r,this._params=o},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(s,i){if(!s.nextObj.hasOwnProperty(i))throw new Error("traversePropertyPath - object does not have property "+i+", for path "+e);return{obj:s.nextObj,objProp:i,nextObj:s.nextObj[i]}},{nextObj:this.params}),r=t.obj,o=t.objProp;if(!r||!o||!(r[o]instanceof ur))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:o}},n})();function ni(n,e,t){return lt(function(){var r=K4(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=sn(r,e.bias),r})}function u3(n,e,t){return t===void 0&&(t=!1),lt(function(){var r=dr(t?sn(Fi(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):ni(n,e.conv0,[2,2])),o=ni(r,e.conv1,[1,1]),s=dr(sn(r,o)),i=ni(s,e.conv2,[1,1]);return dr(sn(r,sn(o,i)))})}function A0(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),lt(function(){var o=dr(t?sn(Fi(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):ni(n,e.conv0,r?[2,2]:[1,1])),s=ni(o,e.conv1,[1,1]),i=dr(sn(o,s)),a=ni(i,e.conv2,[1,1]),l=dr(sn(o,sn(s,a))),c=ni(l,e.conv3,[1,1]);return dr(sn(o,sn(s,sn(a,c))))})}function aa(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),lt(function(){var o=sn(Fi(n,e.filters,[1,1],t),e.bias);return r?dr(o):o})}function oc(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function qv(n,e){return function(t,r,o,s){var i=As(n(t*r*o*o),[o,o,t,r]),a=$r(n(r));return e.push({paramPath:s+"/filters"},{paramPath:s+"/bias"}),{filters:i,bias:a}}}function f5(n,e){return function(t,r,o){var s=qc(n(t*r),[t,r]),i=$r(n(r));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:s,bias:i}}}var ZA=(function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n})();function p5(n,e){return function(t,r,o){var s=As(n(9*t),[3,3,t,1]),i=As(n(t*r),[1,1,t,r]),a=$r(n(r));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new ZA(s,i,a)}}function m5(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),o=n(e+"/bias",1);return new ZA(t,r,o)}}function hu(n,e){return function(t,r,o){var s=n[t];if(!Wv(s,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+s);return e.push({originalPath:t,paramPath:o||t}),s}}function sc(n){var e=n;function t(o){var s=e.slice(0,o);return e=e.slice(o),s}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function QA(n,e){var t=qv(n,e),r=p5(n,e);function o(i,a,l,c){c===void 0&&(c=!1);var u=c?t(i,a,3,l+"/conv0"):r(i,a,l+"/conv0"),d=r(a,a,l+"/conv1"),h=r(a,a,l+"/conv2");return{conv0:u,conv1:d,conv2:h}}function s(i,a,l,c){c===void 0&&(c=!1);var u=o(i,a,l,c),d=u.conv0,h=u.conv1,p=u.conv2,g=r(a,a,l+"/conv3");return{conv0:d,conv1:h,conv2:p,conv3:g}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:s}}function Lee(n){var e=[],t=sc(n),r=t.extractWeights,o=t.getRemainingWeights,s=QA(r,e).extractDenseBlock4Params,i=s(3,32,"dense0",!0),a=s(32,64,"dense1"),l=s(64,128,"dense2"),c=s(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:i,dense1:a,dense2:l,dense3:c}}}function JA(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function e_(n,e){var t=hu(n,e),r=JA(t),o=m5(t);function s(a,l){l===void 0&&(l=!1);var c=l?r(a+"/conv0"):o(a+"/conv0"),u=o(a+"/conv1"),d=o(a+"/conv2");return{conv0:c,conv1:u,conv2:d}}function i(a,l){l===void 0&&(l=!1);var c=l?r(a+"/conv0"):o(a+"/conv0"),u=o(a+"/conv1"),d=o(a+"/conv2"),h=o(a+"/conv3");return{conv0:c,conv1:u,conv2:d,conv3:h}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:i}}function Bee(n){var e=[],t=e_(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return oc(n,e),{params:r,paramMappings:e}}var t_=(function(n){zt(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return lt(function(){var o=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],i=Lm(o,s).div(et(255)),a=A0(i,r.dense0,!0);return a=A0(a,r.dense1),a=A0(a,r.dense2),a=A0(a,r.dense3),a=Mm(a,[7,7],[2,2],"valid"),a})},e.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var r;return kt(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,fo(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Bee(t)},e.prototype.extractParams=function(t){return Lee(t)},e})(rc);function Ya(n,e){return lt(function(){return sn(jv(n,e.weights),e.bias)})}function jee(n,e,t){var r=[],o=sc(n),s=o.extractWeights,i=o.getRemainingWeights,a=f5(s,r),l=a(e,t,"fc");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:l}}}function Vee(n){var e=[],t=hu(n,e);function r(s){var i=t(s+"/weights",2),a=t(s+"/bias",1);return{weights:i,bias:a}}var o={fc:r("fc")};return oc(n,e),{params:o,paramMappings:e}}function n_(n){var e={},t={};return Object.keys(n).forEach(function(r){var o=r.startsWith("fc")?t:e;o[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var r_=(function(n){zt(e,n);function e(t,r){var o=n.call(this,t)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return lt(function(){var s=t instanceof Lx?r.faceFeatureExtractor.forwardInput(t):t;return Ya(s.as2D(s.shape[0],-1),o.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.params,s=r.paramMappings;this._params=o,this._paramMappings=s},e.prototype.extractClassifierParams=function(t){return jee(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=n_(t),o=r.featureExtractorMap,s=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),Vee(s)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),s=o*r+o,i=t.slice(0,t.length-s),a=t.slice(t.length-s);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},e})(rc),HI=["neutral","happy","sad","angry","fearful","disgusted","surprised"],zee=(function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);HI.forEach(function(r,o){t[r]=e[o]})}return n.prototype.asSortedArray=function(){var e=this;return HI.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n})(),Wee=(function(n){zt(e,n);function e(t){return t===void 0&&(t=new t_),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return lt(function(){return tc(r.runNet(t))})},e.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var r;return kt(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,fo(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.predictExpressions=function(t){return Ct(this,void 0,void 0,function(){var r,o,s,i,a=this;return kt(this,function(l){switch(l.label){case 0:return[4,fo(t)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),[4,Promise.all(Zr(o).map(function(c){return Ct(a,void 0,void 0,function(){var u;return kt(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return u=d.sent(),c.dispose(),[2,u]}})})}))];case 3:return s=l.sent(),o.dispose(),i=s.map(function(c){return new zee(c)}),[2,r.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e})(r_);function o_(n,e){var t={expressions:e};return Object.assign({},n,t)}function Uee(n){return Ree(n)&&n.landmarks instanceof Ox&&n.unshiftedLandmarks instanceof Ox&&n.alignedRect instanceof yl}function g5(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),o=r.align(),s=n.detection.imageDims,i=new yl(n.detection.score,o.rescale(s.reverse()),s),a={landmarks:r,unshiftedLandmarks:e,alignedRect:i};return Object.assign({},n,a)}function Hee(n,e){var t=qv(n,e),r=p5(n,e);function o(i,a,l){var c=r(i,a,l+"/separable_conv0"),u=r(a,a,l+"/separable_conv1"),d=t(i,a,1,l+"/expansion_conv");return{separable_conv0:c,separable_conv1:u,expansion_conv:d}}function s(i,a){var l=r(i,i,a+"/separable_conv0"),c=r(i,i,a+"/separable_conv1"),u=r(i,i,a+"/separable_conv2");return{separable_conv0:l,separable_conv1:c,separable_conv2:u}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:s}}function Gee(n,e){var t=[],r=sc(n),o=r.extractWeights,s=r.getRemainingWeights,i=Hee(o,t),a=i.extractConvParams,l=i.extractSeparableConvParams,c=i.extractReductionBlockParams,u=i.extractMainBlockParams,d=a(3,32,3,"entry_flow/conv_in"),h=c(32,64,"entry_flow/reduction_block_0"),p=c(64,128,"entry_flow/reduction_block_1"),g={conv_in:d,reduction_block_0:h,reduction_block_1:p},x={};um(e,0,1).forEach(function(S){x["main_block_"+S]=u(128,"middle_flow/main_block_"+S)});var y=c(128,256,"exit_flow/reduction_block"),b=l(256,512,"exit_flow/separable_conv"),C={reduction_block:y,separable_conv:b};if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:t,params:{entry_flow:g,middle_flow:x,exit_flow:C}}}function qee(n,e){var t=hu(n,e),r=JA(t),o=m5(t);function s(a){var l=o(a+"/separable_conv0"),c=o(a+"/separable_conv1"),u=r(a+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:u}}function i(a){var l=o(a+"/separable_conv0"),c=o(a+"/separable_conv1"),u=o(a+"/separable_conv2");return{separable_conv0:l,separable_conv1:c,separable_conv2:u}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:s,extractMainBlockParams:i}}function Kee(n,e){var t=[],r=qee(n,t),o=r.extractConvParams,s=r.extractSeparableConvParams,i=r.extractReductionBlockParams,a=r.extractMainBlockParams,l=o("entry_flow/conv_in"),c=i("entry_flow/reduction_block_0"),u=i("entry_flow/reduction_block_1"),d={conv_in:l,reduction_block_0:c,reduction_block_1:u},h={};um(e,0,1).forEach(function(y){h["main_block_"+y]=a("middle_flow/main_block_"+y)});var p=i("exit_flow/reduction_block"),g=s("exit_flow/separable_conv"),x={reduction_block:p,separable_conv:g};return oc(n,t),{params:{entry_flow:d,middle_flow:h,exit_flow:x},paramMappings:t}}function s_(n,e,t){return sn(Fi(n,e.filters,t,"same"),e.bias)}function d3(n,e,t){t===void 0&&(t=!0);var r=t?dr(n):n;return r=ni(r,e.separable_conv0,[1,1]),r=ni(dr(r),e.separable_conv1,[1,1]),r=lo(r,[3,3],[2,2],"same"),r=sn(r,s_(n,e.expansion_conv,[2,2])),r}function Xee(n,e){var t=ni(dr(n),e.separable_conv0,[1,1]);return t=ni(dr(t),e.separable_conv1,[1,1]),t=ni(dr(t),e.separable_conv2,[1,1]),t=sn(t,n),t}var Yee=(function(n){zt(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return lt(function(){var s=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=Lm(s,i).div(et(256)),l=dr(s_(a,o.entry_flow.conv_in,[2,2]));return l=d3(l,o.entry_flow.reduction_block_0,!1),l=d3(l,o.entry_flow.reduction_block_1),um(r._numMainBlocks,0,1).forEach(function(c){l=Xee(l,o.middle_flow["main_block_"+c])}),l=d3(l,o.exit_flow.reduction_block),l=dr(ni(l,o.exit_flow.separable_conv,[1,1])),l})},e.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var r;return kt(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,fo(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Kee(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return Gee(t,this._numMainBlocks)},e})(rc);function Zee(n){var e=[],t=sc(n),r=t.extractWeights,o=t.getRemainingWeights,s=f5(r,e),i=s(512,1,"fc/age"),a=s(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:i,gender:a}}}}function Qee(n){var e=[],t=hu(n,e);function r(s){var i=t(s+"/weights",2),a=t(s+"/bias",1);return{weights:i,bias:a}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return oc(n,e),{params:o,paramMappings:e}}var Bx;(function(n){n.FEMALE="female",n.MALE="male"})(Bx||(Bx={}));var Jee=(function(n){zt(e,n);function e(t){t===void 0&&(t=new Yee(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return lt(function(){var s=t instanceof Lx?r.faceFeatureExtractor.forwardInput(t):t,i=Mm(s,[7,7],[2,2],"valid").as2D(s.shape[0],-1),a=Ya(i,o.fc.age).as1D(),l=Ya(i,o.fc.gender);return{age:a,gender:l}})},e.prototype.forwardInput=function(t){var r=this;return lt(function(){var o=r.runNet(t),s=o.age,i=o.gender;return{age:s,gender:tc(i)}})},e.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var r;return kt(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,fo(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Ct(this,void 0,void 0,function(){var r,o,s,i,a,l,c=this;return kt(this,function(u){switch(u.label){case 0:return[4,fo(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),s=Zr(o.age),i=Zr(o.gender),a=s.map(function(d,h){return{ageTensor:d,genderTensor:i[h]}}),[4,Promise.all(a.map(function(d){var h=d.ageTensor,p=d.genderTensor;return Ct(c,void 0,void 0,function(){var g,x,y,b,C;return kt(this,function(S){switch(S.label){case 0:return[4,h.data()];case 1:return g=S.sent()[0],[4,p.data()];case 2:return x=S.sent()[0],y=x>.5,b=y?Bx.MALE:Bx.FEMALE,C=y?x:1-x,h.dispose(),p.dispose(),[2,{age:g,gender:b,genderProbability:C}]}})})}))];case 3:return l=u.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?l:l[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.params,s=r.paramMappings;this._params=o,this._paramMappings=s},e.prototype.extractClassifierParams=function(t){return Zee(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=n_(t),o=r.featureExtractorMap,s=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),Qee(s)},e.prototype.extractParams=function(t){var r=1539,o=t.slice(0,t.length-r),s=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(s)},e})(rc),i_=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,o){var s=o.map(function(a){var l=a.width,c=a.height,u=r/Math.max(c,l);return{width:l*u,height:c*u}}),i=s.length;return lt(function(){var a=function(h,p){return si([tl([68],h),tl([68],p)],1).as2D(1,136).as1D()},l=function(h,p){var g=s[h],x=g.width,y=g.height;return p(x,y)?Math.abs(x-y)/2:0},c=function(h){return l(h,function(p,g){return p<g})},u=function(h){return l(h,function(p,g){return g<p})},d=t.mul(tl([i,136],r)).sub(si(Array.from(Array(i),function(h,p){return a(c(p),u(p))}))).div(si(Array.from(Array(i),function(h,p){return a(s[p].width,s[p].height)})));return d})},e.prototype.forwardInput=function(t){var r=this;return lt(function(){var o=r.runNet(t);return r.postProcess(o,t.inputSize,t.inputDimensions.map(function(s){var i=s[0],a=s[1];return{height:i,width:a}}))})},e.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var r;return kt(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,fo(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Ct(this,void 0,void 0,function(){var r,o,s,i=this;return kt(this,function(a){switch(a.label){case 0:return[4,fo(t)];case 1:return r=a.sent(),o=lt(function(){return Zr(i.forwardInput(r))}),[4,Promise.all(o.map(function(l,c){return Ct(i,void 0,void 0,function(){var u,d,h,p,g;return kt(this,function(x){switch(x.label){case 0:return h=(d=Array).from,[4,l.data()];case 1:return u=h.apply(d,[x.sent()]),p=u.filter(function(y,b){return LI(b)}),g=u.filter(function(y,b){return!LI(b)}),[2,new Tee(Array(68).fill(0).map(function(y,b){return new Tn(p[b],g[b])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return s=a.sent(),o.forEach(function(l){return l.dispose()}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e})(r_),a_=(function(n){zt(e,n);function e(t){return t===void 0&&(t=new t_),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e})(i_);function ete(n){var e=[],t=e_(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return oc(n,e),{params:r,paramMappings:e}}function tte(n){var e=[],t=sc(n),r=t.extractWeights,o=t.getRemainingWeights,s=QA(r,e).extractDenseBlock3Params,i=s(3,32,"dense0",!0),a=s(32,64,"dense1"),l=s(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:i,dense1:a,dense2:l}}}var nte=(function(n){zt(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return lt(function(){var o=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],i=Lm(o,s).div(et(255)),a=u3(i,r.dense0,!0);return a=u3(a,r.dense1),a=u3(a,r.dense2),a=Mm(a,[14,14],[2,2],"valid"),a})},e.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var r;return kt(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,fo(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return ete(t)},e.prototype.extractParams=function(t){return tte(t)},e})(rc),rte=(function(n){zt(e,n);function e(t){return t===void 0&&(t=new nte),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e})(i_);(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(a_);function ote(n,e){return sn(Xo(n,e.weights),e.biases)}function x5(n,e,t,r,o){o===void 0&&(o="same");var s=e.conv,i=s.filters,a=s.bias,l=Fi(n,i,t,o);return l=sn(l,a),l=ote(l,e.scale),r?dr(l):l}function ste(n,e){return x5(n,e,[1,1],!0)}function l_(n,e){return x5(n,e,[1,1],!1)}function c_(n,e){return x5(n,e,[2,2],!0,"valid")}function ite(n,e){function t(a,l,c){var u=n(a),d=u.length/(l*c*c);if(vee(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+u.length+", numFilters: "+l+", filterSize: "+c);return lt(function(){return nu(As(u,[l,d,c,c]),[2,3,1,0])})}function r(a,l,c,u){var d=t(a,l,c),h=$r(n(l));return e.push({paramPath:u+"/filters"},{paramPath:u+"/bias"}),{filters:d,bias:h}}function o(a,l){var c=$r(n(a)),u=$r(n(a));return e.push({paramPath:l+"/weights"},{paramPath:l+"/biases"}),{weights:c,biases:u}}function s(a,l,c,u){var d=r(a,l,c,u+"/conv"),h=o(l,u+"/scale");return{conv:d,scale:h}}function i(a,l,c,u,d){d===void 0&&(d=!1);var h=s((d?.5:1)*a,l,c,u+"/conv1"),p=s(a,l,c,u+"/conv2");return{conv1:h,conv2:p}}return{extractConvLayerParams:s,extractResidualLayerParams:i}}function ate(n){var e=sc(n),t=e.extractWeights,r=e.getRemainingWeights,o=[],s=ite(t,o),i=s.extractConvLayerParams,a=s.extractResidualLayerParams,l=i(4704,32,7,"conv32_down"),c=a(9216,32,3,"conv32_1"),u=a(9216,32,3,"conv32_2"),d=a(9216,32,3,"conv32_3"),h=a(36864,64,3,"conv64_down",!0),p=a(36864,64,3,"conv64_1"),g=a(36864,64,3,"conv64_2"),x=a(36864,64,3,"conv64_3"),y=a(147456,128,3,"conv128_down",!0),b=a(147456,128,3,"conv128_1"),C=a(147456,128,3,"conv128_2"),S=a(589824,256,3,"conv256_down",!0),k=a(589824,256,3,"conv256_1"),N=a(589824,256,3,"conv256_2"),E=a(589824,256,3,"conv256_down_out"),_=lt(function(){return nu(qc(t(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var $={conv32_down:l,conv32_1:c,conv32_2:u,conv32_3:d,conv64_down:h,conv64_1:p,conv64_2:g,conv64_3:x,conv128_down:y,conv128_1:b,conv128_2:C,conv256_down:S,conv256_1:k,conv256_2:N,conv256_down_out:E,fc:_};return{params:$,paramMappings:o}}function lte(n,e){var t=hu(n,e);function r(i){var a=t(i+"/scale/weights",1),l=t(i+"/scale/biases",1);return{weights:a,biases:l}}function o(i){var a=t(i+"/conv/filters",4),l=t(i+"/conv/bias",1),c=r(i);return{conv:{filters:a,bias:l},scale:c}}function s(i){return{conv1:o(i+"/conv1"),conv2:o(i+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:s}}function cte(n){var e=[],t=lte(n,e),r=t.extractConvLayerParams,o=t.extractResidualLayerParams,s=r("conv32_down"),i=o("conv32_1"),a=o("conv32_2"),l=o("conv32_3"),c=o("conv64_down"),u=o("conv64_1"),d=o("conv64_2"),h=o("conv64_3"),p=o("conv128_down"),g=o("conv128_1"),x=o("conv128_2"),y=o("conv256_down"),b=o("conv256_1"),C=o("conv256_2"),S=o("conv256_down_out"),k=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!xee(k))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+k);var N={conv32_down:s,conv32_1:i,conv32_2:a,conv32_3:l,conv64_down:c,conv64_1:u,conv64_2:d,conv64_3:h,conv128_down:p,conv128_1:g,conv128_2:x,conv256_down:y,conv256_1:b,conv256_2:C,conv256_down_out:S,fc:k};return oc(n,e),{params:N,paramMappings:e}}function Oa(n,e){var t=ste(n,e.conv1);return t=l_(t,e.conv2),t=sn(t,n),t=dr(t),t}function _0(n,e){var t=c_(n,e.conv1);t=l_(t,e.conv2);var r=Mm(n,2,2,"valid"),o=Zn(r.shape),s=r.shape[3]!==t.shape[3],i=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(i){var a=Xp(t.shape);a[1]=1;var l=Zn(a);t=Yr([t,l],1);var c=Xp(t.shape);c[2]=1;var u=Zn(c);t=Yr([t,u],2)}return r=s?Yr([r,o],3):r,t=sn(r,t),t=dr(t),t}var ute=(function(n){zt(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return lt(function(){var o=t.toBatchTensor(150,!0).toFloat(),s=[122.782,117.001,104.298],i=Lm(o,s).div(et(256)),a=c_(i,r.conv32_down);a=lo(a,3,2,"valid"),a=Oa(a,r.conv32_1),a=Oa(a,r.conv32_2),a=Oa(a,r.conv32_3),a=_0(a,r.conv64_down),a=Oa(a,r.conv64_1),a=Oa(a,r.conv64_2),a=Oa(a,r.conv64_3),a=_0(a,r.conv128_down),a=Oa(a,r.conv128_1),a=Oa(a,r.conv128_2),a=_0(a,r.conv256_down),a=Oa(a,r.conv256_1),a=Oa(a,r.conv256_2),a=_0(a,r.conv256_down_out);var l=a.mean([1,2]),c=jv(l,r.fc);return c})},e.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var r;return kt(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,fo(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Ct(this,void 0,void 0,function(){var r,o,s,i=this;return kt(this,function(a){switch(a.label){case 0:return[4,fo(t)];case 1:return r=a.sent(),o=lt(function(){return Zr(i.forwardInput(r))}),[4,Promise.all(o.map(function(l){return l.data()}))];case 2:return s=a.sent(),o.forEach(function(l){return l.dispose()}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return cte(t)},e.prototype.extractParams=function(t){return ate(t)},e})(rc);function u_(n,e){var t={descriptor:e};return Object.assign({},n,t)}function d_(n,e){var t={age:e};return Object.assign({},n,t)}function h_(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var f_=(function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,o=t.scaleFactor,s=t.maxNumScales,i=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=s||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(l){return typeof l!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(l){return typeof l!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n})();function dte(n,e){function t(l,c){var u=As(n(9*l),[3,3,l,1]),d=$r(n(l)),h=$r(n(l)),p=$r(n(l)),g=$r(n(l));return e.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:u,batch_norm_scale:d,batch_norm_offset:h,batch_norm_mean:p,batch_norm_variance:g}}function r(l,c,u,d,h){var p=As(n(l*c*u*u),[u,u,l,c]),g=$r(n(c));return e.push({paramPath:d+"/filters"},{paramPath:d+"/"+(h?"batch_norm_offset":"bias")}),{filters:p,bias:g}}function o(l,c,u,d){var h=r(l,c,u,d,!0),p=h.filters,g=h.bias;return{filters:p,batch_norm_offset:g}}function s(l,c,u){var d=t(l,u+"/depthwise_conv"),h=o(l,c,1,u+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:h}}function i(){var l=o(3,32,3,"mobilenetv1/conv_0"),c=s(32,64,"mobilenetv1/conv_1"),u=s(64,128,"mobilenetv1/conv_2"),d=s(128,128,"mobilenetv1/conv_3"),h=s(128,256,"mobilenetv1/conv_4"),p=s(256,256,"mobilenetv1/conv_5"),g=s(256,512,"mobilenetv1/conv_6"),x=s(512,512,"mobilenetv1/conv_7"),y=s(512,512,"mobilenetv1/conv_8"),b=s(512,512,"mobilenetv1/conv_9"),C=s(512,512,"mobilenetv1/conv_10"),S=s(512,512,"mobilenetv1/conv_11"),k=s(512,1024,"mobilenetv1/conv_12"),N=s(1024,1024,"mobilenetv1/conv_13");return{conv_0:l,conv_1:c,conv_2:u,conv_3:d,conv_4:h,conv_5:p,conv_6:g,conv_7:x,conv_8:y,conv_9:b,conv_10:C,conv_11:S,conv_12:k,conv_13:N}}function a(){var l=o(1024,256,1,"prediction_layer/conv_0"),c=o(256,512,3,"prediction_layer/conv_1"),u=o(512,128,1,"prediction_layer/conv_2"),d=o(128,256,3,"prediction_layer/conv_3"),h=o(256,128,1,"prediction_layer/conv_4"),p=o(128,256,3,"prediction_layer/conv_5"),g=o(256,64,1,"prediction_layer/conv_6"),x=o(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),b=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),C=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),S=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),k=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),N=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),_=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),$=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),D=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),A=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),M={box_encoding_predictor:y,class_predictor:b},j={box_encoding_predictor:C,class_predictor:S},L={box_encoding_predictor:k,class_predictor:N},U={box_encoding_predictor:E,class_predictor:_},G={box_encoding_predictor:$,class_predictor:T},H={box_encoding_predictor:D,class_predictor:A};return{conv_0:l,conv_1:c,conv_2:u,conv_3:d,conv_4:h,conv_5:p,conv_6:g,conv_7:x,box_predictor_0:M,box_predictor_1:j,box_predictor_2:L,box_predictor_3:U,box_predictor_4:G,box_predictor_5:H}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:a}}function hte(n){var e=[],t=sc(n),r=t.extractWeights,o=t.getRemainingWeights,s=dte(r,e),i=s.extractMobilenetV1Params,a=s.extractPredictionLayerParams,l=i(),c=a(),u=$4(r(5118*4),[1,5118,4]),d={extra_dim:u};if(e.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:l,prediction_layer:c,output_layer:d},paramMappings:e}}function fte(n,e){var t=hu(n,e);function r(c,u,d){var h=t(c+"/Conv2d_"+u+"_pointwise/weights",4,d+"/filters"),p=t(c+"/Conv2d_"+u+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:h,batch_norm_offset:p}}function o(c){var u="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",h=u+"/depthwise_conv",p=u+"/pointwise_conv",g=t(d+"/depthwise_weights",4,h+"/filters"),x=t(d+"/BatchNorm/gamma",1,h+"/batch_norm_scale"),y=t(d+"/BatchNorm/beta",1,h+"/batch_norm_offset"),b=t(d+"/BatchNorm/moving_mean",1,h+"/batch_norm_mean"),C=t(d+"/BatchNorm/moving_variance",1,h+"/batch_norm_variance");return{depthwise_conv:{filters:g,batch_norm_scale:x,batch_norm_offset:y,batch_norm_mean:b,batch_norm_variance:C},pointwise_conv:r("MobilenetV1",c,p)}}function s(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function i(c,u){var d=t(c+"/weights",4,u+"/filters"),h=t(c+"/biases",1,u+"/bias");return{filters:d,bias:h}}function a(c){var u=i("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),d=i("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:u,class_predictor:d}}function l(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:l}}function pte(n){var e=[],t=fte(n,e),r=t.extractMobilenetV1Params,o=t.extractPredictionLayerParams,s=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Uv(s))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+s);var i={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:s}};return oc(n,e),{params:i,paramMappings:e}}function Ba(n,e,t){return lt(function(){var r=Fi(n,e.filters,t,"same");return r=sn(r,e.batch_norm_offset),U4(r,0,6)})}var mte=.0010000000474974513;function gte(n,e,t){return lt(function(){var r=Bv(n,e.filters,t,"same");return r=aA(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,mte),U4(r,0,6)})}function xte(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function vte(n,e){return lt(function(){var t=null,r=Ba(n,e.conv_0,[2,2]),o=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(o.forEach(function(s,i){var a=i+1,l=xte(a);r=gte(r,s.depthwise_conv,l),r=Ba(r,s.pointwise_conv,[1,1]),a===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function yte(n,e,t,r,o){var s=n.shape[0],i=Math.min(t,s),a=e.map(function(u,d){return{score:u,boxIndex:d}}).filter(function(u){return u.score>o}).sort(function(u,d){return d.score-u.score}),l=function(u){return u<=r?1:0},c=[];return a.forEach(function(u){if(!(c.length>=i)){for(var d=u.score,h=c.length-1;h>=0;--h){var p=bte(n,u.boxIndex,c[h]);if(p!==0&&(u.score*=l(p),u.score<=o))break}d===u.score&&c.push(u.boxIndex)}}),c}function bte(n,e,t){var r=n.arraySync(),o=Math.min(r[e][0],r[e][2]),s=Math.min(r[e][1],r[e][3]),i=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),l=Math.min(r[t][0],r[t][2]),c=Math.min(r[t][1],r[t][3]),u=Math.max(r[t][0],r[t][2]),d=Math.max(r[t][1],r[t][3]),h=(i-o)*(a-s),p=(u-l)*(d-c);if(h<=0||p<=0)return 0;var g=Math.max(o,l),x=Math.max(s,c),y=Math.min(i,u),b=Math.min(a,d),C=Math.max(y-g,0)*Math.max(b-x,0);return C/(h+p-C)}function wte(n){var e=Zr(nu(n,[1,0])),t=[Jr(e[2],e[0]),Jr(e[3],e[1])],r=[sn(e[0],na(t[0],et(2))),sn(e[1],na(t[1],et(2)))];return{sizes:t,centers:r}}function Cte(n,e){var t=wte(n),r=t.sizes,o=t.centers,s=Zr(nu(e,[1,0])),i=na(Xo(fC(na(s[2],et(5))),r[0]),et(2)),a=sn(Xo(na(s[0],et(10)),r[0]),o[0]),l=na(Xo(fC(na(s[3],et(5))),r[1]),et(2)),c=sn(Xo(na(s[1],et(10)),r[1]),o[1]);return nu(si([Jr(a,i),Jr(c,l),sn(a,i),sn(c,l)]),[1,0])}function kte(n,e,t){return lt(function(){var r=n.shape[0],o=Cte(sa(Kh(t.extra_dim,[r,1,1]),[-1,4]),sa(n,[-1,4]));o=sa(o,[r,o.shape[0]/r,4]);var s=rA(cl(e,[0,0,1],[-1,-1,-1])),i=cl(s,[0,0,0],[-1,-1,1]);i=sa(i,[r,i.shape[1]]);var a=Zr(o),l=Zr(i);return{boxes:a,scores:l}})}function $h(n,e){return lt(function(){var t=n.shape[0],r=sa(aa(n,e.box_encoding_predictor),[t,-1,1,4]),o=sa(aa(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function Ste(n,e,t){return lt(function(){var r=Ba(n,t.conv_0,[1,1]),o=Ba(r,t.conv_1,[2,2]),s=Ba(o,t.conv_2,[1,1]),i=Ba(s,t.conv_3,[2,2]),a=Ba(i,t.conv_4,[1,1]),l=Ba(a,t.conv_5,[2,2]),c=Ba(l,t.conv_6,[1,1]),u=Ba(c,t.conv_7,[2,2]),d=$h(e,t.box_predictor_0),h=$h(n,t.box_predictor_1),p=$h(o,t.box_predictor_2),g=$h(i,t.box_predictor_3),x=$h(l,t.box_predictor_4),y=$h(u,t.box_predictor_5),b=Yr([d.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,x.boxPredictionEncoding,y.boxPredictionEncoding],1),C=Yr([d.classPrediction,h.classPrediction,p.classPrediction,g.classPrediction,x.classPrediction,y.classPrediction],1);return{boxPredictions:b,classPredictions:C}})}var Bm=(function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,o=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n})(),p_=(function(n){zt(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return lt(function(){var o=t.toBatchTensor(512,!1).toFloat(),s=Jr(Xo(o,et(.007843137718737125)),et(1)),i=vte(s,r.mobilenetv1),a=Ste(i.out,i.conv11,r.prediction_layer),l=a.boxPredictions,c=a.classPredictions;return kte(l,c,r.output_layer)})},e.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var r;return kt(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,fo(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),Ct(this,void 0,void 0,function(){var o,s,i,a,l,c,u,d,h,p,g,x,y,b,C,S,k,N,E,_,$;return kt(this,function(T){switch(T.label){case 0:return o=new Bm(r),s=o.maxResults,i=o.minConfidence,[4,fo(t)];case 1:for(a=T.sent(),l=this.forwardInput(a),c=l.boxes,u=l.scores,d=c[0],h=u[0],p=1;p<c.length;p++)c[p].dispose(),u[p].dispose();return y=(x=Array).from,[4,h.data()];case 2:return g=y.apply(x,[T.sent()]),b=.5,C=yte(d,g,s,b,i),S=a.getReshapedInputDimensions(0),k=a.inputSize,N=k/S.width,E=k/S.height,_=d.arraySync(),$=C.map(function(D){var A=[Math.max(0,_[D][0]),Math.min(1,_[D][2])].map(function(H){return H*E}),M=A[0],j=A[1],L=[Math.max(0,_[D][1]),Math.min(1,_[D][3])].map(function(H){return H*N}),U=L[0],G=L[1];return new yl(g[D],new a5(U,M,G-U,j-M),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),d.dispose(),h.dispose(),[2,$]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return pte(t)},e.prototype.extractParams=function(t){return hte(t)},e})(rc);(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(p_);var Nte=.4,Ite=[new Tn(.738768,.874946),new Tn(2.42204,2.65704),new Tn(4.30971,7.04493),new Tn(10.246,4.59428),new Tn(12.6868,11.8741)],Ete=[new Tn(1.603231,2.094468),new Tn(6.041143,7.080126),new Tn(2.882459,3.518061),new Tn(4.266906,5.178857),new Tn(9.041765,10.66308)],Tte=[117.001,114.697,97.404],Rte="tiny_yolov2_model",Dte="tiny_yolov2_separable_conv_model",$0=function(n){return typeof n=="number"};function Ate(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!$0(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return $0(e.x)&&$0(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every($0)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function v5(n){return lt(function(){var e=Xo(n,et(.10000000149011612));return sn(dr(Jr(n,e)),e)})}function Mc(n,e){return lt(function(){var t=$d(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Fi(t,e.conv.filters,[1,1],"valid"),t=Jr(t,e.bn.sub),t=Xo(t,e.bn.truediv),t=sn(t,e.conv.bias),v5(t)})}function Oc(n,e){return lt(function(){var t=$d(n,[[0,0],[1,1],[1,1],[0,0]]);return t=K4(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=sn(t,e.bias),v5(t)})}function _te(n,e){var t=qv(n,e);function r(i,a){var l=$r(n(i)),c=$r(n(i));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:l,truediv:c}}function o(i,a,l){var c=t(i,a,3,l+"/conv"),u=r(a,l+"/bn");return{conv:c,bn:u}}var s=p5(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:o,extractSeparableConvParams:s}}function $te(n,e,t,r){var o=sc(n),s=o.extractWeights,i=o.getRemainingWeights,a=[],l=_te(s,a),c=l.extractConvParams,u=l.extractConvWithBatchNormParams,d=l.extractSeparableConvParams,h;if(e.withSeparableConvs){var p=r[0],g=r[1],x=r[2],y=r[3],b=r[4],C=r[5],S=r[6],k=r[7],N=r[8],E=e.isFirstLayerConv2d?c(p,g,3,"conv0"):d(p,g,"conv0"),_=d(g,x,"conv1"),$=d(x,y,"conv2"),T=d(y,b,"conv3"),D=d(b,C,"conv4"),A=d(C,S,"conv5"),M=k?d(S,k,"conv6"):void 0,j=N?d(k,N,"conv7"):void 0,L=c(N||k||S,5*t,1,"conv8");h={conv0:E,conv1:_,conv2:$,conv3:T,conv4:D,conv5:A,conv6:M,conv7:j,conv8:L}}else{var p=r[0],g=r[1],x=r[2],y=r[3],b=r[4],C=r[5],S=r[6],k=r[7],N=r[8],E=u(p,g,"conv0"),_=u(g,x,"conv1"),$=u(x,y,"conv2"),T=u(y,b,"conv3"),D=u(b,C,"conv4"),A=u(C,S,"conv5"),M=u(S,k,"conv6"),j=u(k,N,"conv7"),L=c(N,5*t,1,"conv8");h={conv0:E,conv1:_,conv2:$,conv3:T,conv4:D,conv5:A,conv6:M,conv7:j,conv8:L}}if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:h,paramMappings:a}}function Fte(n,e){var t=hu(n,e);function r(a){var l=t(a+"/sub",1),c=t(a+"/truediv",1);return{sub:l,truediv:c}}function o(a){var l=t(a+"/filters",4),c=t(a+"/bias",1);return{filters:l,bias:c}}function s(a){var l=o(a+"/conv"),c=r(a+"/bn");return{conv:l,bn:c}}var i=m5(t);return{extractConvParams:o,extractConvWithBatchNormParams:s,extractSeparableConvParams:i}}function Pte(n,e){var t=[],r=Fte(n,t),o=r.extractConvParams,s=r.extractConvWithBatchNormParams,i=r.extractSeparableConvParams,a;if(e.withSeparableConvs){var l=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?o("conv0"):i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:l>7?i("conv6"):void 0,conv7:l>8?i("conv7"):void 0,conv8:o("conv8")}}else a={conv0:s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:s("conv6"),conv7:s("conv7"),conv8:o("conv8")};return oc(n,t),{params:a,paramMappings:t}}var GI;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(GI||(GI={}));var y5=(function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,o=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n})(),m_=(function(n){zt(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return Ate(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var o=Mc(t,r.conv0);return o=lo(o,[2,2],[2,2],"same"),o=Mc(o,r.conv1),o=lo(o,[2,2],[2,2],"same"),o=Mc(o,r.conv2),o=lo(o,[2,2],[2,2],"same"),o=Mc(o,r.conv3),o=lo(o,[2,2],[2,2],"same"),o=Mc(o,r.conv4),o=lo(o,[2,2],[2,2],"same"),o=Mc(o,r.conv5),o=lo(o,[2,2],[1,1],"same"),o=Mc(o,r.conv6),o=Mc(o,r.conv7),aa(o,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var o=this.config.isFirstLayerConv2d?v5(aa(t,r.conv0,"valid",!1)):Oc(t,r.conv0);return o=lo(o,[2,2],[2,2],"same"),o=Oc(o,r.conv1),o=lo(o,[2,2],[2,2],"same"),o=Oc(o,r.conv2),o=lo(o,[2,2],[2,2],"same"),o=Oc(o,r.conv3),o=lo(o,[2,2],[2,2],"same"),o=Oc(o,r.conv4),o=lo(o,[2,2],[2,2],"same"),o=Oc(o,r.conv5),o=lo(o,[2,2],[1,1],"same"),o=r.conv6?Oc(o,r.conv6):o,o=r.conv7?Oc(o,r.conv7):o,aa(o,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var o=this,s=this.params;if(!s)throw new Error("TinyYolov2 - load model before inference");return lt(function(){var i=t.toBatchTensor(r,!1).toFloat();return i=o.config.meanRgb?Lm(i,o.config.meanRgb):i,i=i.div(et(256)),o.config.withSeparableConvs?o.runMobilenet(i,s):o.runTinyYolov2(i,s)})},e.prototype.forward=function(t,r){return Ct(this,void 0,void 0,function(){var o;return kt(this,function(s){switch(s.label){case 0:return o=this.forwardInput,[4,fo(t)];case 1:return[4,o.apply(this,[s.sent(),r])];case 2:return[2,s.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),Ct(this,void 0,void 0,function(){var o,s,i,a,l,c,u,d,h,p,g,x,y,b,C=this;return kt(this,function(S){switch(S.label){case 0:return o=new y5(r),s=o.inputSize,i=o.scoreThreshold,[4,fo(t)];case 1:return a=S.sent(),[4,this.forwardInput(a,s)];case 2:return l=S.sent(),c=lt(function(){return Zr(l)[0].expandDims()}),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(c,a.getReshapedInputDimensions(0),i)];case 3:return d=S.sent(),l.dispose(),c.dispose(),h=d.map(function(k){return k.box}),p=d.map(function(k){return k.score}),g=d.map(function(k){return k.classScore}),x=d.map(function(k){return C.config.classes[k.label]}),y=dm(h.map(function(k){return k.rescale(s)}),p,this.config.iouThreshold,!0),b=y.map(function(k){return new VA(p[k],g[k],x[k],h[k],u)}),[2,b]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return Pte(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return $te(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,o){return Ct(this,void 0,void 0,function(){var s,i,a,l,c,u,d,h,p,g,x,y,b,C,S,k,N,E,_,$,T,D,A,M,j,L,U,G,H,O=this;return kt(this,function(V){switch(V.label){case 0:return s=r.width,i=r.height,a=Math.max(s,i),l=a/s,c=a/i,u=t.shape[1],d=this.config.anchors.length,h=lt(function(){var W=t.reshape([u,u,d,O.boxEncodingSize]),B=W.slice([0,0,0,0],[u,u,d,4]),q=W.slice([0,0,0,4],[u,u,d,1]),Q=O.withClassScores?tc(W.slice([0,0,0,5],[u,u,d,O.config.classes.length]),3):et(0);return[B,q,Q]}),p=h[0],g=h[1],x=h[2],y=[],[4,g.array()];case 1:return b=V.sent(),[4,p.array()];case 2:C=V.sent(),S=0,V.label=3;case 3:if(!(S<u))return[3,12];k=0,V.label=4;case 4:if(!(k<u))return[3,11];N=0,V.label=5;case 5:return N<d?(E=c3(b[S][k][N][0]),!o||E>o?(_=(k+c3(C[S][k][N][0]))/u*l,$=(S+c3(C[S][k][N][1]))/u*c,T=Math.exp(C[S][k][N][2])*this.config.anchors[N].x/u*l,D=Math.exp(C[S][k][N][3])*this.config.anchors[N].y/u*c,A=_-T/2,M=$-D/2,j={row:S,col:k,anchor:N},this.withClassScores?[4,this.extractPredictedClass(x,j)]:[3,7]):[3,9]):[3,10];case 6:return H=V.sent(),[3,8];case 7:H={classScore:1,label:0},V.label=8;case 8:L=H,U=L.classScore,G=L.label,y.push(Uo({box:new Hv(A,M,A+T,M+D),score:E,classScore:E*U,label:G},j)),V.label=9;case 9:return N++,[3,5];case 10:return k++,[3,4];case 11:return S++,[3,3];case 12:return p.dispose(),g.dispose(),x.dispose(),[2,y]}})})},e.prototype.extractPredictedClass=function(t,r){return Ct(this,void 0,void 0,function(){var o,s,i,a;return kt(this,function(l){switch(l.label){case 0:return o=r.row,s=r.col,i=r.anchor,[4,t.array()];case 1:return a=l.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,u){return a[o][s][i][u]}).map(function(c,u){return{classScore:c,label:u}}).reduce(function(c,u){return c.classScore>u.classScore?c:u})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e})(rc),Mte=(function(n){zt(e,n);function e(t){t===void 0&&(t=!0);var r=this,o=Object.assign({},{withSeparableConvs:t,iouThreshold:Nte,classes:["face"]},t?{anchors:Ete,meanRgb:Tte}:{anchors:Ite,withClassScores:!0});return r=n.call(this,o)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Ct(this,void 0,void 0,function(){var o;return kt(this,function(s){switch(s.label){case 0:return[4,this.detect(t,r)];case 1:return o=s.sent(),[2,o.map(function(i){return new yl(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?Dte:Rte},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(m_),Bp=(function(n){zt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e})(y5),jm=(function(){function n(){}return n.prototype.then=function(e){return Ct(this,void 0,void 0,function(){var t;return kt(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return Ct(this,void 0,void 0,function(){return kt(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n})();function Kv(n,e,t,r,o){return o===void 0&&(o=function(s){var i=s.alignedRect;return i}),Ct(this,void 0,void 0,function(){var s,i,a,l,c;return kt(this,function(u){switch(u.label){case 0:return s=n.map(function(d){return Uee(d)?o(d):d.detection}),a=r,a?[3,5]:e instanceof ur?[4,h5(e,s)]:[3,2];case 1:return l=u.sent(),[3,4];case 2:return[4,d5(e,s)];case 3:l=u.sent(),u.label=4;case 4:a=l,u.label=5;case 5:return i=a,[4,t(i)];case 6:return c=u.sent(),i.forEach(function(d){return d instanceof ur&&d.dispose()}),[2,c]}})})}function b5(n,e,t,r,o){return Ct(this,void 0,void 0,function(){var s=this;return kt(this,function(i){return[2,Kv([n],e,function(a){return Ct(s,void 0,void 0,function(){return kt(this,function(l){return[2,t(a[0])]})})},r,o)]})})}function Ote(n){return lt(function(){return si(Zr(n,3).reverse(),3)})}var F0=2,jx=12;function Lte(n,e){var t=qv(n,e),r=f5(n,e);function o(c,u){var d=$r(n(c));return e.push({paramPath:u}),d}function s(c,u,d){d===void 0&&(d=!1);var h=t(c[0],c[1],3,u+"/conv1"),p=o(c[1],u+"/prelu1_alpha"),g=t(c[1],c[2],3,u+"/conv2"),x=o(c[2],u+"/prelu2_alpha"),y=t(c[2],c[3],d?2:3,u+"/conv3"),b=o(c[3],u+"/prelu3_alpha");return{conv1:h,prelu1_alpha:p,conv2:g,prelu2_alpha:x,conv3:y,prelu3_alpha:b}}function i(){var c=s([3,10,16,32],"pnet"),u=t(32,2,1,"pnet/conv4_1"),d=t(32,4,1,"pnet/conv4_2");return Uo(Uo({},c),{conv4_1:u,conv4_2:d})}function a(){var c=s([3,28,48,64],"rnet",!0),u=r(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),h=r(128,2,"rnet/fc2_1"),p=r(128,4,"rnet/fc2_2");return Uo(Uo({},c),{fc1:u,prelu4_alpha:d,fc2_1:h,fc2_2:p})}function l(){var c=s([3,32,64,64],"onet"),u=t(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),h=r(1152,256,"onet/fc1"),p=o(256,"onet/prelu5_alpha"),g=r(256,2,"onet/fc2_1"),x=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return Uo(Uo({},c),{conv4:u,prelu4_alpha:d,fc1:h,prelu5_alpha:p,fc2_1:g,fc2_2:x,fc2_3:y})}return{extractPNetParams:i,extractRNetParams:a,extractONetParams:l}}function Bte(n){var e=sc(n),t=e.extractWeights,r=e.getRemainingWeights,o=[],s=Lte(t,o),i=s.extractPNetParams,a=s.extractRNetParams,l=s.extractONetParams,c=i(),u=a(),d=l();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:u,onet:d},paramMappings:o}}function jte(n,e){var t=hu(n,e);function r(u){var d=t(u+"/weights",4,u+"/filters"),h=t(u+"/bias",1);return{filters:d,bias:h}}function o(u){var d=t(u+"/weights",2),h=t(u+"/bias",1);return{weights:d,bias:h}}function s(u){return t(u,1)}function i(u){var d=r(u+"/conv1"),h=s(u+"/prelu1_alpha"),p=r(u+"/conv2"),g=s(u+"/prelu2_alpha"),x=r(u+"/conv3"),y=s(u+"/prelu3_alpha");return{conv1:d,prelu1_alpha:h,conv2:p,prelu2_alpha:g,conv3:x,prelu3_alpha:y}}function a(){var u=i("pnet"),d=r("pnet/conv4_1"),h=r("pnet/conv4_2");return Uo(Uo({},u),{conv4_1:d,conv4_2:h})}function l(){var u=i("rnet"),d=o("rnet/fc1"),h=s("rnet/prelu4_alpha"),p=o("rnet/fc2_1"),g=o("rnet/fc2_2");return Uo(Uo({},u),{fc1:d,prelu4_alpha:h,fc2_1:p,fc2_2:g})}function c(){var u=i("onet"),d=r("onet/conv4"),h=s("onet/prelu4_alpha"),p=o("onet/fc1"),g=s("onet/prelu5_alpha"),x=o("onet/fc2_1"),y=o("onet/fc2_2"),b=o("onet/fc2_3");return Uo(Uo({},u),{conv4:d,prelu4_alpha:h,fc1:p,prelu5_alpha:g,fc2_1:x,fc2_2:y,fc2_3:b})}return{extractPNetParams:a,extractRNetParams:l,extractONetParams:c}}function Vte(n){var e=[],t=jte(n,e),r=t.extractPNetParams,o=t.extractRNetParams,s=t.extractONetParams,i=r(),a=o(),l=s();return oc(n,e),{params:{pnet:i,rnet:a,onet:l},paramMappings:e}}function wC(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function zte(n,e,t){for(var r=t[0],o=t[1],s=jx/n,i=[],a=Math.min(r,o)*s,l=0;a>=12;)i.push(s*Math.pow(e,l)),a=a*e,l+=1;return i}var w5=(function(n){zt(e,n);function e(t,r,o,s){return n.call(this,{left:t,top:r,right:o,bottom:s},!0)||this}return e})(ru);function g_(n){return lt(function(){return Xo(Jr(n,et(127.5)),et(.0078125))})}function ef(n,e){return lt(function(){return sn(dr(n),Xo(e,$x(dr($x(n)))))})}function C5(n,e,t){return t===void 0&&(t=!1),lt(function(){var r=aa(n,e.conv1,"valid");return r=ef(r,e.prelu1_alpha),r=lo(r,t?[2,2]:[3,3],[2,2],"same"),r=aa(r,e.conv2,"valid"),r=ef(r,e.prelu2_alpha),r=t?r:lo(r,[3,3],[2,2],"valid"),r=aa(r,e.conv3,"valid"),r=ef(r,e.prelu3_alpha),r})}function Wte(n,e){return lt(function(){var t=C5(n,e,!0),r=aa(t,e.conv4_1,"valid"),o=Ii(Vv(r,3),3),s=tc(Jr(r,o),3),i=aa(t,e.conv4_2,"valid");return{prob:s,regions:i}})}function Ute(n,e){return lt(function(){var t=wC(e,n.shape.slice(1)),r=t.height,o=t.width,s=J4.resizeBilinear(n,[r,o]),i=g_(s);return nu(i,[0,2,1,3])})}function Hte(n,e,t,r){for(var o=[],s=n.arraySync(),i=0;i<n.shape[0];i++)for(var a=0;a<n.shape[1];a++)s[i][a]>=r&&o.push(new Tn(a,i));var l=o.map(function(c){var u=new Hv(Math.round((c.y*F0+1)/t),Math.round((c.x*F0+1)/t),Math.round((c.y*F0+jx)/t),Math.round((c.x*F0+jx)/t)),d=s[c.y][c.x],h=e.arraySync(),p=new w5(h[c.y][c.x][0],h[c.y][c.x][1],h[c.y][c.x][2],h[c.y][c.x][3]);return{cell:u,score:d,region:p}});return l}function Gte(n,e,t,r,o){o.stage1=[];var s=e.map(function(h){return lt(function(){var p={scale:h},g=Ute(n,h),x=Date.now(),y=Wte(g,r),b=y.prob,C=y.regions;p.pnet=Date.now()-x;var S=Zr(Zr(b,3)[1])[0],k=Zr(C)[0];return{scoresTensor:S,regionsTensor:k,scale:h,statsForScale:p}})}),i=s.map(function(h){var p=h.scoresTensor,g=h.regionsTensor,x=h.scale,y=h.statsForScale,b=Hte(p,g,x,t);if(p.dispose(),g.dispose(),!b.length)return o.stage1.push(y),[];var C=Date.now(),S=dm(b.map(function(k){return k.cell}),b.map(function(k){return k.score}),.5);return y.nms=Date.now()-C,y.numBoxes=S.length,o.stage1.push(y),S.map(function(k){return b[k]})}),a=i.reduce(function(h,p){return h.concat(p)},[]),l=[],c=[];if(a.length>0){var u=Date.now(),d=dm(a.map(function(h){return h.cell}),a.map(function(h){return h.score}),.7);o.stage1_nms=Date.now()-u,c=d.map(function(h){return a[h].score}),l=d.map(function(h){return a[h]}).map(function(h){var p=h.cell,g=h.region;return new Hv(p.left+g.left*p.width,p.top+g.top*p.height,p.right+g.right*p.width,p.bottom+g.bottom*p.height).toSquare().round()})}return{boxes:l,scores:c}}function x_(n,e,t){var r=t.width,o=t.height;return Ct(this,void 0,void 0,function(){var s,i,a,l=this;return kt(this,function(c){switch(c.label){case 0:return s=md(n),[4,Promise.all(e.map(function(u){return Ct(l,void 0,void 0,function(){var d,h,p,g,x,y,b,C;return kt(this,function(S){return d=u.padAtBorders(n.height,n.width),h=d.y,p=d.ey,g=d.x,x=d.ex,y=g-1,b=h-1,C=s.getImageData(y,b,x-y,p-b),[2,Qo.isNodejs()?u5(C):createImageBitmap(C)]})})}))];case 1:return i=c.sent(),a=[],i.forEach(function(u){var d=Gv({width:r,height:o}),h=md(d);h.drawImage(u,0,0,r,o);for(var p=h.getImageData(0,0,r,o).data,g=[],x=0;x<p.length;x+=4)g.push(p[x+2]),g.push(p[x+1]),g.push(p[x]);a.push(g)}),[2,a.map(function(u){var d=lt(function(){var h=nu(As(u,[1,r,o,3]),[0,2,1,3]).toFloat();return g_(h)});return d})]}})})}function qte(n,e){return lt(function(){var t=C5(n,e),r=sa(t,[t.shape[0],e.fc1.weights.shape[0]]),o=Ya(r,e.fc1),s=ef(o,e.prelu4_alpha),i=Ya(s,e.fc2_1),a=Ii(Vv(i,1),1),l=tc(Jr(i,a),1),c=Ya(s,e.fc2_2),u=Zr(l,1)[1];return{scores:u,regions:c}})}function Kte(n,e,t,r,o){return Ct(this,void 0,void 0,function(){var s,i,a,l,c,u,d,h,p,g,x,y,b,C;return kt(this,function(S){switch(S.label){case 0:return s=Date.now(),[4,x_(n,e,{width:24,height:24})];case 1:return i=S.sent(),o.stage2_extractImagePatches=Date.now()-s,s=Date.now(),a=i.map(function(k){var N=qte(k,r);return k.dispose(),N}),o.stage2_rnet=Date.now()-s,l=a.length>1?Yr(a.map(function(k){return k.scores})):a[0].scores,d=(u=Array).from,[4,l.data()];case 2:return c=d.apply(u,[S.sent()]),l.dispose(),h=c.map(function(k,N){return{score:k,idx:N}}).filter(function(k){return k.score>t}).map(function(k){var N=k.idx;return N}),p=h.map(function(k){return e[k]}),g=h.map(function(k){return c[k]}),x=[],y=[],p.length>0&&(s=Date.now(),b=dm(p,g,.7),o.stage2_nms=Date.now()-s,C=b.map(function(k){var N=a[h[k]].regions.arraySync();return new w5(N[0][0],N[0][1],N[0][2],N[0][3])}),y=b.map(function(k){return g[k]}),x=b.map(function(k,N){return p[k].calibrate(C[N])})),a.forEach(function(k){k.regions.dispose(),k.scores.dispose()}),[2,{boxes:x,scores:y}]}})})}function Xte(n,e){return lt(function(){var t=C5(n,e);t=lo(t,[2,2],[2,2],"same"),t=aa(t,e.conv4,"valid"),t=ef(t,e.prelu4_alpha);var r=sa(t,[t.shape[0],e.fc1.weights.shape[0]]),o=Ya(r,e.fc1),s=ef(o,e.prelu5_alpha),i=Ya(s,e.fc2_1),a=Ii(Vv(i,1),1),l=tc(Jr(i,a),1),c=Ya(s,e.fc2_2),u=Ya(s,e.fc2_3),d=Zr(l,1)[1];return{scores:d,regions:c,points:u}})}function Yte(n,e,t,r,o){return Ct(this,void 0,void 0,function(){var s,i,a,l,c,u,d,h,p,g,x,y,b,C,S;return kt(this,function(k){switch(k.label){case 0:return s=Date.now(),[4,x_(n,e,{width:48,height:48})];case 1:return i=k.sent(),o.stage3_extractImagePatches=Date.now()-s,s=Date.now(),a=i.map(function(N){var E=Xte(N,r);return N.dispose(),E}),o.stage3_onet=Date.now()-s,l=a.length>1?Yr(a.map(function(N){return N.scores})):a[0].scores,d=(u=Array).from,[4,l.data()];case 2:return c=d.apply(u,[k.sent()]),l.dispose(),h=c.map(function(N,E){return{score:N,idx:E}}).filter(function(N){return N.score>t}).map(function(N){var E=N.idx;return E}),p=h.map(function(N){var E=a[N].regions.arraySync();return new w5(E[0][0],E[0][1],E[0][2],E[0][3])}),g=h.map(function(N,E){return e[N].calibrate(p[E])}),x=h.map(function(N){return c[N]}),y=[],b=[],C=[],g.length>0&&(s=Date.now(),S=dm(g,x,.7,!1),o.stage3_nms=Date.now()-s,y=S.map(function(N){return g[N]}),b=S.map(function(N){return x[N]}),C=S.map(function(N,E){return Array(5).fill(0).map(function(_,$){var T=a[N].points.arraySync();return new Tn(T[0][$]*(y[E].width+1)+y[E].left,T[0][$+5]*(y[E].height+1)+y[E].top)})})),a.forEach(function(N){N.regions.dispose(),N.scores.dispose(),N.points.dispose()}),[2,{boxes:y,scores:b,points:C}]}})})}var Zte=(function(n){zt(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return Ct(this,void 0,void 0,function(){return kt(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return Ct(this,void 0,void 0,function(){return kt(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),Ct(this,void 0,void 0,function(){var o,s,i,a,l,c,u,d,h,p,g,x,y,b,C,S,k,N,E,_,$;return kt(this,function(T){switch(T.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(s=t.canvases[0],!s)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},a=Date.now(),l=lt(function(){return Ote(Ii(s5.fromPixels(s)).toFloat())}),c=function(D){return l.dispose(),i.total=Date.now()-a,D},u=l.shape.slice(1),d=u[0],h=u[1],p=new f_(r),g=p.minFaceSize,x=p.scaleFactor,y=p.maxNumScales,b=p.scoreThresholds,C=p.scaleSteps,S=(C||zte(g,x,[d,h])).filter(function(D){var A=wC(D,[d,h]);return Math.min(A.width,A.height)>jx}).slice(0,y),i.scales=S,i.pyramid=S.map(function(D){return wC(D,[d,h])}),k=Date.now(),[4,Gte(l,S,b[0],o.pnet,i)];case 1:return N=T.sent(),i.total_stage1=Date.now()-k,N.boxes.length?(i.stage2_numInputBoxes=N.boxes.length,k=Date.now(),[4,Kte(s,N.boxes,b[1],o.rnet,i)]):[2,c({results:[],stats:i})];case 2:return E=T.sent(),i.total_stage2=Date.now()-k,E.boxes.length?(i.stage3_numInputBoxes=E.boxes.length,k=Date.now(),[4,Yte(s,E.boxes,b[2],o.onet,i)]):[2,c({results:[],stats:i})];case 3:return _=T.sent(),i.total_stage3=Date.now()-k,$=_.boxes.map(function(D,A){return g5(l5({},new yl(_.scores[A],new a5(D.left/h,D.top/d,D.width/h,D.height/d),{height:d,width:h})),new Eee(_.points[A].map(function(M){return M.sub(new Tn(D.left,D.top)).div(new Tn(D.width,D.height))}),{width:D.width,height:D.height}))}),[2,c({results:$,stats:i})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),Ct(this,void 0,void 0,function(){var o;return kt(this,function(s){switch(s.label){case 0:return o=this.forwardInput,[4,fo(t)];case 1:return[4,o.apply(this,[s.sent(),r])];case 2:return[2,s.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),Ct(this,void 0,void 0,function(){var o;return kt(this,function(s){switch(s.label){case 0:return o=this.forwardInput,[4,fo(t)];case 1:return[2,o.apply(this,[s.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Vte(t)},e.prototype.extractParams=function(t){return Bte(t)},e})(rc),Qte=.4,Jte=[new Tn(1.603231,2.094468),new Tn(6.041143,7.080126),new Tn(2.882459,3.518061),new Tn(4.266906,5.178857),new Tn(9.041765,10.66308)],ene=[117.001,114.697,97.404],tne=(function(n){zt(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:Qte,classes:["face"],anchors:Jte,meanRgb:ene,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Ct(this,void 0,void 0,function(){var o;return kt(this,function(s){switch(s.label){case 0:return[4,this.detect(t,r)];case 1:return o=s.sent(),[2,o.map(function(i){return new yl(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(m_),Yo={ssdMobilenetv1:new p_,tinyFaceDetector:new tne,tinyYolov2:new Mte,mtcnn:new Zte,faceLandmark68Net:new a_,faceLandmark68TinyNet:new rte,faceRecognitionNet:new ute,faceExpressionNet:new Wee,ageGenderNet:new Jee},v_=(function(n){zt(e,n);function e(t,r,o){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s.extractedFaces=o,s}return e})(jm),k5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r,o=this;return kt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),[4,Kv(t,this.input,function(i){return Ct(o,void 0,void 0,function(){return kt(this,function(a){switch(a.label){case 0:return[4,Promise.all(i.map(function(l){return Yo.faceExpressionNet.predictExpressions(l)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=s.sent(),[2,t.map(function(i,a){return o_(i,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new E5(this,this.input)},e})(v_),S5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r;return kt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),t?[4,b5(t,this.input,function(s){return Yo.faceExpressionNet.predictExpressions(s)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,o_(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new T5(this,this.input)},e})(v_),N5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new R5(this,this.input)},e.prototype.withFaceDescriptors=function(){return new A5(this,this.input)},e})(k5),I5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new D5(this,this.input)},e.prototype.withFaceDescriptor=function(){return new _5(this,this.input)},e})(S5),y_=(function(n){zt(e,n);function e(t,r,o){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s.extractedFaces=o,s}return e})(jm),E5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r,o=this;return kt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),[4,Kv(t,this.input,function(i){return Ct(o,void 0,void 0,function(){return kt(this,function(a){switch(a.label){case 0:return[4,Promise.all(i.map(function(l){return Yo.ageGenderNet.predictAgeAndGender(l)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=s.sent(),[2,t.map(function(i,a){var l=r[a],c=l.age,u=l.gender,d=l.genderProbability;return d_(h_(i,u,d),c)})]}})})},e.prototype.withFaceExpressions=function(){return new k5(this,this.input)},e})(y_),T5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r,o,s,i;return kt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,b5(t,this.input,function(l){return Yo.ageGenderNet.predictAgeAndGender(l)},this.extractedFaces)]:[2];case 2:return r=a.sent(),o=r.age,s=r.gender,i=r.genderProbability,[2,d_(h_(t,s,i),o)]}})})},e.prototype.withFaceExpressions=function(){return new S5(this,this.input)},e})(y_),R5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new N5(this,this.input)},e.prototype.withFaceDescriptors=function(){return new A5(this,this.input)},e})(E5),D5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new I5(this,this.input)},e.prototype.withFaceDescriptor=function(){return new _5(this,this.input)},e})(T5),b_=(function(n){zt(e,n);function e(t,r){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o}return e})(jm),A5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r;return kt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,Kv(t,this.input,function(s){return Promise.all(s.map(function(i){return Yo.faceRecognitionNet.computeFaceDescriptor(i)}))},null,function(s){return s.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(s,i){return u_(t[i],s)})]}})})},e.prototype.withFaceExpressions=function(){return new N5(this,this.input)},e.prototype.withAgeAndGender=function(){return new R5(this,this.input)},e})(b_),_5=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r;return kt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),t?[4,b5(t,this.input,function(s){return Yo.faceRecognitionNet.computeFaceDescriptor(s)},null,function(s){return s.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,u_(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new I5(this,this.input)},e.prototype.withAgeAndGender=function(){return new D5(this,this.input)},e})(b_),w_=(function(n){zt(e,n);function e(t,r,o){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s.useTinyLandmarkNet=o,s}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Yo.faceLandmark68TinyNet:Yo.faceLandmark68Net},enumerable:!0,configurable:!0}),e})(jm),nne=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r,o,s,i,a=this;return kt(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return t=l.sent(),r=t.map(function(c){return c.detection}),this.input instanceof ur?[4,h5(this.input,r)]:[3,3];case 2:return s=l.sent(),[3,5];case 3:return[4,d5(this.input,r)];case 4:s=l.sent(),l.label=5;case 5:return o=s,[4,Promise.all(o.map(function(c){return a.landmarkNet.detectLandmarks(c)}))];case 6:return i=l.sent(),o.forEach(function(c){return c instanceof ur&&c.dispose()}),[2,t.map(function(c,u){return g5(c,i[u])})]}})})},e.prototype.withFaceExpressions=function(){return new N5(this,this.input)},e.prototype.withAgeAndGender=function(){return new R5(this,this.input)},e.prototype.withFaceDescriptors=function(){return new A5(this,this.input)},e})(w_),rne=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r,o,s,i;return kt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?(r=t.detection,this.input instanceof ur?[4,h5(this.input,[r])]:[3,3]):[2];case 2:return s=a.sent(),[3,5];case 3:return[4,d5(this.input,[r])];case 4:s=a.sent(),a.label=5;case 5:return o=s,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return i=a.sent(),o.forEach(function(l){return l instanceof ur&&l.dispose()}),[2,g5(t,i)]}})})},e.prototype.withFaceExpressions=function(){return new I5(this,this.input)},e.prototype.withAgeAndGender=function(){return new D5(this,this.input)},e.prototype.withFaceDescriptor=function(){return new _5(this,this.input)},e})(w_),C_=(function(n){zt(e,n);function e(t,r){r===void 0&&(r=new Bm);var o=n.call(this)||this;return o.input=t,o.options=r,o}return e})(jm),k_=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r,o,s;return kt(this,function(i){switch(i.label){case 0:return t=this,r=t.input,o=t.options,o instanceof f_?[4,Yo.mtcnn.forward(r,o)]:[3,2];case 1:return[2,i.sent().map(function(a){return a.detection})];case 2:if(s=o instanceof Bp?function(a){return Yo.tinyFaceDetector.locateFaces(a,o)}:o instanceof Bm?function(a){return Yo.ssdMobilenetv1.locateFaces(a,o)}:o instanceof y5?function(a){return Yo.tinyYolov2.locateFaces(a,o)}:null,!s)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,s(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return Ct(t,void 0,void 0,function(){var o;return kt(this,function(s){switch(s.label){case 0:return[4,this.run()];case 1:return o=s.sent(),[2,r(o.map(function(i){return l5({},i)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new nne(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new k5(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new E5(this.runAndExtendWithFaceDetections(),this.input)},e})(C_),one=(function(n){zt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,r;return kt(this,function(o){switch(o.label){case 0:return[4,new k_(this.input,this.options)];case 1:return t=o.sent(),r=t[0],t.forEach(function(s){s.score>r.score&&(r=s)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return Ct(t,void 0,void 0,function(){var o;return kt(this,function(s){switch(s.label){case 0:return[4,this.run()];case 1:return o=s.sent(),[2,r(o?l5({},o):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new rne(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new S5(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new T5(this.runAndExtendWithFaceDetection(),this.input)},e})(C_);function P0(n,e){return e===void 0&&(e=new Bm),new one(n,e)}function sne(n,e){return e===void 0&&(e=new Bm),new k_(n,e)}function S_(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(o,s){return o-r[s]}).reduce(function(o,s){return o+Math.pow(s,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,s=function(){return"person "+o++};this._labeledDescriptors=r.map(function(i){if(i instanceof D0)return i;if(i instanceof Float32Array)return new D0(s(),[i]);if(i.descriptor&&i.descriptor instanceof Float32Array)return new D0(s(),[i.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return S_(r,e)}).reduce(function(r,o){return r+o},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,s=r.label;return new VI(s,t.computeMeanDistance(e,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new VI("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return D0.fromJSON(r)});return new n(t,e.distanceThreshold)},n})();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ine=1e-7,ane=1e-4;class N_{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class $5{refCount(e){return Rs("refCount")}incRef(e){return Rs("incRef")}timerAvailable(){return!0}time(e){return Rs("time")}read(e){return Rs("read")}readSync(e){return Rs("readSync")}readToGPU(e,t){return Rs("readToGPU")}numDataIds(){return Rs("numDataIds")}disposeData(e,t){return Rs("disposeData")}write(e,t,r){return Rs("write")}move(e,t,r,o,s){return Rs("move")}createTensorFromGPUData(e,t,r){return Rs("createTensorFromGPUData")}memory(){return Rs("memory")}floatPrecision(){return Rs("floatPrecision")}epsilon(){return this.floatPrecision()===32?ine:ane}dispose(){return Rs("dispose")}}function Rs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lne(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Vh(n,e,t)}function gd(n,e,t){return Math.max(n,Math.min(e,t))}function F5(n){return n%2===0?n:n+1}function Vh(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function cne(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function K(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function P5(n,e,t=""){K(In(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function I_(n){K(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function De(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function In(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ff(n){return n%1===0}function CC(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function tf(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function qI(n,e=o=>0,t,r){return new Promise((o,s)=>{let i=0;const a=()=>{if(n()){o();return}i++;const l=e(i);if(t!=null&&i>=t){s();return}r!=null?r(a,l):setTimeout(a,l)};a()})}function E_(n,e){let t=1,r=-1;for(let s=0;s<n.length;++s)if(n[s]>=0)t*=n[s];else if(n[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(n[s]<0)throw Error(`Shapes can not be < 0. Found ${n[s]} at dim ${s}`);if(r===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const o=n.slice();return o[r]=e/t,o}function Qt(n,e){const t=e.length;return n=n==null?e.map((r,o)=>o):[].concat(n),K(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),K(n.every(r=>ff(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function fu(n,e){const t=[],r=[],o=e!=null&&Array.isArray(e)&&e.length===0,s=e==null||o?null:Qt(e,n).sort();let i=0;for(let a=0;a<n.length;++a){if(s!=null){if(s[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(s[i]==null||s[i]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),s[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Eo(n,e){return mr(n,e)}function mr(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function une(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function dne(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function T_(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Vx(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function hne(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Vm(n){return typeof n=="string"||n instanceof String}function fne(n){return typeof n=="boolean"}function kC(n){return typeof n=="number"}function _f(n){return Array.isArray(n)?_f(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":kC(n)?"float32":Vm(n)?"string":fne(n)?"bool":"float32"}function SC(n){return!!(n&&n.constructor&&n.call&&n.apply)}function NC(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Nt(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function R_(n,e,t,r=!1){const o=new Array;if(e.length===1){const s=e[0]*(r?2:1);for(let i=0;i<s;i++)o[i]=t[n+i]}else{const s=e[0],i=e.slice(1),a=i.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<s;l++)o[l]=R_(n+l*a,i,t,r)}return o}function la(n,e,t=!1){if(n.length===0)return e[0];const r=n.reduce((o,s)=>o*s)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return R_(0,n,e,t)}function pne(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function M5(n,e){const t=To(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function To(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function D_(n,e){const t=n.reduce((r,o)=>r*o,1);if(e==null||e==="float32")return la(n,new Float32Array(t));if(e==="int32")return la(n,new Int32Array(t));if(e==="bool")return la(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function ic(n){n.forEach(e=>{K(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function nl(n,e,t){if(e===0)return 0;if(e===1)return n[0];let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=t[o]*n[o];return r}function $f(n,e,t){if(e===0)return[];if(e===1)return[n];const r=new Array(e);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(n/t[o]),n-=r[o]*t[o];return r[r.length-1]=n,r}function O5(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KI="tfjsflags";class mne{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=gne,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Ce().getBool("IS_TEST")||Ce().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){const o=this.urlFlags[e];Ce().getBool("IS_TEST")||Ce().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${o}.`),this.set(e,o)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(O5(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);KI in e&&e[KI].split(",").forEach(r=>{const[o,s]=r.split(":");this.urlFlags[o]=vne(o,s)})}}function gne(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(xne(e,r[0],r[1]),r.join("="))),e}function xne(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function vne(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function Ce(){return A_}let A_=null;function yne(n){A_=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let h3;function __(){if(h3==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");h3=n}return h3}function bne(){const n=__();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function L5(n,e){const t=bne();if(t.has(n))return t.get(n);{const r=e();return t.set(n,r),t.get(n)}}const Xv="Abs",zm="Acos",Wm="Acosh",Ff="Add",B5="AddN",j5="All",V5="Any",Yv="ArgMax",Zv="ArgMin",Um="Asin",Hm="Asinh",Gm="Atan",qm="Atanh",Km="Atan2",Qv="AvgPool",z5="AvgPoolGrad",Jv="AvgPool3D",W5="AvgPool3DGrad",e2="BatchMatMul",t2="BatchToSpaceND",U5="Bincount",H5="BitwiseAnd",wne="BroadcastTo",$_="BroadcastArgs",Xm="Cast",Ym="Ceil",Zm="ClipByValue",G5="Complex",n2="ComplexAbs",r2="Concat",o2="Conv2D",q5="Conv2DBackpropFilter",s2="Conv2DBackpropInput",i2="Conv3D",K5="Conv3DBackpropFilterV2",X5="Conv3DBackpropInputV2",Qm="Cos",Jm="Cosh",Y5="Cumprod",a2="Cumsum",Z5="CropAndResize",Q5="DenseBincount",J5="DepthToSpace",l2="DepthwiseConv2dNative",e6="DepthwiseConv2dNativeBackpropFilter",t6="DepthwiseConv2dNativeBackpropInput",F_="Diag",c2="Dilation2D",IC="Dilation2DBackpropInput",EC="Dilation2DBackpropFilter",Cne="Draw",e1="RealDiv",n6="Einsum",t1="Elu",r6="EluGrad",n1="Erf",u2="Equal",r1="Exp",d2="ExpandDims",o1="Expm1",o6="FFT",s6="Fill",i6="FlipLeftRight",s1="Floor",i1="FloorDiv",h2="FusedBatchNorm",f2="GatherV2",P_="GatherNd",p2="Greater",a1="GreaterEqual",l1="Identity",a6="IFFT",l6="Imag",c1="IsFinite",u1="IsInf",d1="IsNan",m2="LeakyRelu",g2="Less",x2="LessEqual",M_="LinSpace",h1="Log",f1="Log1p",v2="LogicalAnd",y2="LogicalNot",b2="LogicalOr",kne="LogSoftmax",w2="LRN",c6="LRNGrad",C2="Max",p1="Maximum",k2="MaxPool",u6="MaxPoolGrad",S2="MaxPool3D",d6="MaxPool3DGrad",O_="MaxPoolWithArgmax",N2="Mean",I2="Min",m1="Minimum",E2="MirrorPad",g1="Mod",L_="Multinomial",x1="Multiply",T2="Neg",R2="NotEqual",h6="NonMaxSuppressionV3",f6="NonMaxSuppressionV4",p6="NonMaxSuppressionV5",D2="OnesLike",A2="OneHot",_2="Pack",$2="PadV2",v1="Pow",F2="Prelu",P2="Prod",B_="RaggedGather",j_="RaggedRange",V_="RaggedTensorToTensor",m6="Range",g6="Real",y1="Reciprocal",b1="Relu",M2="Reshape",O2="ResizeNearestNeighbor",x6="ResizeNearestNeighborGrad",L2="ResizeBilinear",v6="ResizeBilinearGrad",w1="Relu6",B2="Reverse",C1="Round",k1="Rsqrt",z_="ScatterNd",W_="TensorScatterUpdate",U_="SearchSorted",j2="Select",S1="Selu",V2="Slice",N1="Sin",I1="Sinh",E1="Sign",T1="Sigmoid",R1="Softplus",D1="Sqrt",z2="Sum",W2="SpaceToBatchND",U2="SplitV",H2="Softmax",H_="SparseFillEmptyRows",G_="SparseReshape",q_="SparseSegmentMean",K_="SparseSegmentSum",X_="SparseToDense",A1="SquaredDifference",y6="Square",b6="StaticRegexReplace",w6="StridedSlice",Y_="StringNGrams",Z_="StringSplit",Q_="StringToHashBucketFast",_1="Sub",$1="Tan",F1="Tanh",P1="Tile",C6="TopK",k6="Transform",nf="Transpose",S6="Unique",G2="Unpack",q2="UnsortedSegmentSum",K2="ZerosLike",M1="Step",Sne="FromPixels",N6="RotateWithOffset",zx="_FusedMatMul",Wx="FusedConv2D",J_="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Js(...n){Ce().getBool("IS_TEST")||Ce().getBool("PROD")||console.warn(...n)}function Nne(...n){Ce().getBool("IS_TEST")||Ce().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ux=L5("kernelRegistry",()=>new Map),TC=L5("gradRegistry",()=>new Map);function XI(n,e){const t=t$(n,e);return Ux.get(t)}function YI(n){return TC.get(n)}function ZI(n){const e=Ux.entries(),t=[];for(;;){const{done:r,value:o}=e.next();if(r)break;const[s,i]=o,[a]=s.split("_");a===n&&t.push(i)}return t}function e$(n){const{kernelName:e,backendName:t}=n,r=t$(e,t);Ux.has(r)&&Js(`The kernel '${e}' for backend '${t}' is already registered`),Ux.set(r,n)}function Ine(n){const{kernelName:e}=n;TC.has(e)&&Ce().getBool("DEBUG")&&Js(`Overriding the gradient for '${e}'`),TC.set(e,n)}function t$(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n$(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var f3,QI;function Ene(){if(QI)return f3;QI=1,f3=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,A,M){this.low=D|0,this.high=A|0,this.unsigned=!!M}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var r={},o={};function s(D,A){var M,j,L;return A?(D>>>=0,(L=0<=D&&D<256)&&(j=o[D],j)?j:(M=a(D,(D|0)<0?-1:0,!0),L&&(o[D]=M),M)):(D|=0,(L=-128<=D&&D<128)&&(j=r[D],j)?j:(M=a(D,D<0?-1:0,!1),L&&(r[D]=M),M))}e.fromInt=s;function i(D,A){if(isNaN(D))return A?C:b;if(A){if(D<0)return C;if(D>=g)return _}else{if(D<=-x)return $;if(D+1>=x)return E}return D<0?i(-D,A).neg():a(D%p|0,D/p|0,A)}e.fromNumber=i;function a(D,A,M){return new e(D,A,M)}e.fromBits=a;var l=Math.pow;function c(D,A,M){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return b;if(typeof A=="number"?(M=A,A=!1):A=!!A,M=M||10,M<2||36<M)throw RangeError("radix");var j;if((j=D.indexOf("-"))>0)throw Error("interior hyphen");if(j===0)return c(D.substring(1),A,M).neg();for(var L=i(l(M,8)),U=b,G=0;G<D.length;G+=8){var H=Math.min(8,D.length-G),O=parseInt(D.substring(G,G+H),M);if(H<8){var V=i(l(M,H));U=U.mul(V).add(i(O))}else U=U.mul(L),U=U.add(i(O))}return U.unsigned=A,U}e.fromString=c;function u(D,A){return typeof D=="number"?i(D,A):typeof D=="string"?c(D,A):a(D.low,D.high,typeof A=="boolean"?A:D.unsigned)}e.fromValue=u;var d=65536,h=1<<24,p=d*d,g=p*p,x=g/2,y=s(h),b=s(0);e.ZERO=b;var C=s(0,!0);e.UZERO=C;var S=s(1);e.ONE=S;var k=s(1,!0);e.UONE=k;var N=s(-1);e.NEG_ONE=N;var E=a(-1,2147483647,!1);e.MAX_VALUE=E;var _=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=_;var $=a(0,-2147483648,!1);e.MIN_VALUE=$;var T=e.prototype;return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},T.toString=function(A){if(A=A||10,A<2||36<A)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq($)){var M=i(A),j=this.div(M),L=j.mul(M).sub(this);return j.toString(A)+L.toInt().toString(A)}else return"-"+this.neg().toString(A);for(var U=i(l(A,6),this.unsigned),G=this,H="";;){var O=G.div(U),V=G.sub(O.mul(U)).toInt()>>>0,W=V.toString(A);if(G=O,G.isZero())return W+H;for(;W.length<6;)W="0"+W;H=""+W+H}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq($)?64:this.neg().getNumBitsAbs();for(var A=this.high!=0?this.high:this.low,M=31;M>0&&(A&1<<M)==0;M--);return this.high!=0?M+33:M+1},T.isZero=function(){return this.high===0&&this.low===0},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return(this.low&1)===1},T.isEven=function(){return(this.low&1)===0},T.equals=function(A){return t(A)||(A=u(A)),this.unsigned!==A.unsigned&&this.high>>>31===1&&A.high>>>31===1?!1:this.high===A.high&&this.low===A.low},T.eq=T.equals,T.notEquals=function(A){return!this.eq(A)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(A){return this.comp(A)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(A){return this.comp(A)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(A){return this.comp(A)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(A){return this.comp(A)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(A){if(t(A)||(A=u(A)),this.eq(A))return 0;var M=this.isNegative(),j=A.isNegative();return M&&!j?-1:!M&&j?1:this.unsigned?A.high>>>0>this.high>>>0||A.high===this.high&&A.low>>>0>this.low>>>0?-1:1:this.sub(A).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq($)?$:this.not().add(S)},T.neg=T.negate,T.add=function(A){t(A)||(A=u(A));var M=this.high>>>16,j=this.high&65535,L=this.low>>>16,U=this.low&65535,G=A.high>>>16,H=A.high&65535,O=A.low>>>16,V=A.low&65535,W=0,B=0,q=0,Q=0;return Q+=U+V,q+=Q>>>16,Q&=65535,q+=L+O,B+=q>>>16,q&=65535,B+=j+H,W+=B>>>16,B&=65535,W+=M+G,W&=65535,a(q<<16|Q,W<<16|B,this.unsigned)},T.subtract=function(A){return t(A)||(A=u(A)),this.add(A.neg())},T.sub=T.subtract,T.multiply=function(A){if(this.isZero())return b;if(t(A)||(A=u(A)),n){var M=n.mul(this.low,this.high,A.low,A.high);return a(M,n.get_high(),this.unsigned)}if(A.isZero())return b;if(this.eq($))return A.isOdd()?$:b;if(A.eq($))return this.isOdd()?$:b;if(this.isNegative())return A.isNegative()?this.neg().mul(A.neg()):this.neg().mul(A).neg();if(A.isNegative())return this.mul(A.neg()).neg();if(this.lt(y)&&A.lt(y))return i(this.toNumber()*A.toNumber(),this.unsigned);var j=this.high>>>16,L=this.high&65535,U=this.low>>>16,G=this.low&65535,H=A.high>>>16,O=A.high&65535,V=A.low>>>16,W=A.low&65535,B=0,q=0,Q=0,Z=0;return Z+=G*W,Q+=Z>>>16,Z&=65535,Q+=U*W,q+=Q>>>16,Q&=65535,Q+=G*V,q+=Q>>>16,Q&=65535,q+=L*W,B+=q>>>16,q&=65535,q+=U*V,B+=q>>>16,q&=65535,q+=G*O,B+=q>>>16,q&=65535,B+=j*W+L*V+U*O+G*H,B&=65535,a(Q<<16|Z,B<<16|q,this.unsigned)},T.mul=T.multiply,T.divide=function(A){if(t(A)||(A=u(A)),A.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&A.low===-1&&A.high===-1)return this;var M=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,A.low,A.high);return a(M,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:b;var j,L,U;if(this.unsigned){if(A.unsigned||(A=A.toUnsigned()),A.gt(this))return C;if(A.gt(this.shru(1)))return k;U=C}else{if(this.eq($)){if(A.eq(S)||A.eq(N))return $;if(A.eq($))return S;var G=this.shr(1);return j=G.div(A).shl(1),j.eq(b)?A.isNegative()?S:N:(L=this.sub(A.mul(j)),U=j.add(L.div(A)),U)}else if(A.eq($))return this.unsigned?C:b;if(this.isNegative())return A.isNegative()?this.neg().div(A.neg()):this.neg().div(A).neg();if(A.isNegative())return this.div(A.neg()).neg();U=b}for(L=this;L.gte(A);){j=Math.max(1,Math.floor(L.toNumber()/A.toNumber()));for(var H=Math.ceil(Math.log(j)/Math.LN2),O=H<=48?1:l(2,H-48),V=i(j),W=V.mul(A);W.isNegative()||W.gt(L);)j-=O,V=i(j,this.unsigned),W=V.mul(A);V.isZero()&&(V=S),U=U.add(V),L=L.sub(W)}return U},T.div=T.divide,T.modulo=function(A){if(t(A)||(A=u(A)),n){var M=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,A.low,A.high);return a(M,n.get_high(),this.unsigned)}return this.sub(this.div(A).mul(A))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return a(~this.low,~this.high,this.unsigned)},T.and=function(A){return t(A)||(A=u(A)),a(this.low&A.low,this.high&A.high,this.unsigned)},T.or=function(A){return t(A)||(A=u(A)),a(this.low|A.low,this.high|A.high,this.unsigned)},T.xor=function(A){return t(A)||(A=u(A)),a(this.low^A.low,this.high^A.high,this.unsigned)},T.shiftLeft=function(A){return t(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?a(this.low<<A,this.high<<A|this.low>>>32-A,this.unsigned):a(0,this.low<<A-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(A){return t(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?a(this.low>>>A|this.high<<32-A,this.high>>A,this.unsigned):a(this.high>>A-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(A){if(t(A)&&(A=A.toInt()),A&=63,A===0)return this;var M=this.high;if(A<32){var j=this.low;return a(j>>>A|M<<32-A,M>>>A,this.unsigned)}else return A===32?a(M,0,this.unsigned):a(M>>>A-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},T.toBytes=function(A){return A?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var A=this.high,M=this.low;return[M&255,M>>>8&255,M>>>16&255,M>>>24,A&255,A>>>8&255,A>>>16&255,A>>>24]},T.toBytesBE=function(){var A=this.high,M=this.low;return[A>>>24,A>>>16&255,A>>>8&255,A&255,M>>>24,M>>>16&255,M>>>8&255,M&255]},e.fromBytes=function(A,M,j){return j?e.fromBytesLE(A,M):e.fromBytesBE(A,M)},e.fromBytesLE=function(A,M){return new e(A[0]|A[1]<<8|A[2]<<16|A[3]<<24,A[4]|A[5]<<8|A[6]<<16|A[7]<<24,M)},e.fromBytesBE=function(A,M){return new e(A[4]<<24|A[5]<<16|A[6]<<8|A[7],A[0]<<24|A[1]<<16|A[2]<<8|A[3],M)},f3}var r$=Ene();const o$=gv(r$),Tne=P9({__proto__:null,default:o$},[r$]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ju=o$||Tne;function X2(n){return Ju.fromString(n,!0,16)}const s$=X2("c3a5c85c97cb3127"),Zu=X2("b492b66fbe98f273"),Ho=X2("9ae16a3b2f90404f");function RC(n){return n.xor(n.shru(47))}function i$(n,e,t){const r=n.slice(e,e+t);return Ju.fromBytes(Array.from(r),!0,!0)}function Bn(n,e){return i$(n,e,8)}function JI(n,e){return i$(n,e,4)}function Gr(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Yc(n,e,t=X2("9ddfea08eb382d69")){let r=n.xor(e).mul(t);r=r.xor(r.shru(47));let o=e.xor(r).mul(t);return o=o.xor(o.shru(47)),o=o.mul(t),o}function Rne(n,e,t,r,o,s){o=o.add(n),s=Gr(s.add(o).add(r),21);const i=o;return o=o.add(e),o=o.add(t),s=s.add(Gr(o,44)),[o.add(r),s.add(i)]}function M0(n,e,t,r){return Rne(Bn(n,e),Bn(n,e+8),Bn(n,e+16),Bn(n,e+24),t,r)}function Dne(n,e=n.length){if(e>=8){const t=Ho.add(e*2),r=Bn(n,0).add(Ho),o=Bn(n,e-8),s=Gr(o,37).mul(t).add(r),i=Gr(r,25).add(o).mul(t);return Yc(s,i,t)}if(e>=4){const t=Ho.add(e*2),r=JI(n,0);return Yc(r.shl(3).add(e),JI(n,e-4),t)}if(e>0){const t=n[0],r=n[e>>1],o=n[e-1],s=t+(r<<8),i=e+(o<<2);return RC(Ho.mul(s).xor(s$.mul(i))).mul(Ho)}return Ho}function Ane(n,e=n.length){const t=Ho.add(e*2),r=Bn(n,0).mul(Zu),o=Bn(n,8),s=Bn(n,e-8).mul(t),i=Bn(n,e-16).mul(Ho);return Yc(Gr(r.add(o),43).add(Gr(s,30)).add(i),r.add(Gr(o.add(Ho),18)).add(s),t)}function _ne(n,e=n.length){const t=Ho.add(e*2),r=Bn(n,0).mul(Ho),o=Bn(n,8),s=Bn(n,e-8).mul(t),i=Bn(n,e-16).mul(Ho),a=Gr(r.add(o),43).add(Gr(s,30)).add(i),l=Yc(a,r.add(Gr(o.add(Ho),18)).add(s),t),c=Bn(n,16).mul(t),u=Bn(n,24),d=a.add(Bn(n,e-32)).mul(t),h=l.add(Bn(n,e-24)).mul(t);return Yc(Gr(c.add(u),43).add(Gr(d,30)).add(h),c.add(Gr(u.add(r),18)).add(d),t)}function $ne(n,e=n.length){const t=Ju.fromNumber(81,!0);if(e<=32)return e<=16?Dne(n,e):Ane(n,e);if(e<=64)return _ne(n,e);let r=t,o=t.mul(Zu).add(113),s=RC(o.mul(Ho).add(113)).mul(Ho),i=[Ju.UZERO,Ju.UZERO],a=[Ju.UZERO,Ju.UZERO];r=r.mul(Ho).add(Bn(n,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do r=Gr(r.add(o).add(i[0]).add(Bn(n,l+8)),37).mul(Zu),o=Gr(o.add(i[1]).add(Bn(n,l+48)),42).mul(Zu),r=r.xor(a[1]),o=o.add(i[0]).add(Bn(n,l+40)),s=Gr(s.add(a[0]),33).mul(Zu),i=M0(n,l,i[1].mul(Zu),r.add(a[0])),a=M0(n,l+32,s.add(a[1]),o.add(Bn(n,l+16))),[s,r]=[r,s],l+=64;while(l!==c);const d=Zu.add(s.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=Gr(r.add(o).add(i[0]).add(Bn(n,l+8)),37).mul(d),o=Gr(o.add(i[1]).add(Bn(n,l+48)),42).mul(d),r=r.xor(a[1].mul(9)),o=o.add(i[0].mul(9).add(Bn(n,l+40))),s=Gr(s.add(a[0]),33).mul(d),i=M0(n,l,i[1].mul(d),r.add(a[0])),a=M0(n,l+32,s.add(a[1]),o.add(Bn(n,l+16))),[s,r]=[r,s],Yc(Yc(i[0],a[0],d).add(RC(o).mul(s$)).add(s),Yc(i[1],a[1],d).add(r),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pu(n,e){return e==="string"?Zc(n):Od([n],e)}function Fne(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Od(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=xd(n)),Ce().getBool("DEBUG")&&une(n,e),Fne(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function as(){return Ce().platform.now()}function Zc(n,e="utf-8"){return e=e||"utf-8",Ce().platform.encode(n,e)}function ou(n,e="utf-8"){return e=e||"utf-8",Ce().platform.decode(n,e)}function _i(n){return Ce().platform.isTypedArray!=null?Ce().platform.isTypedArray(n):n$(n)}function xd(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||O5(n)||n==null||_i(n)&&t)e.push(n);else if(Array.isArray(n)||_i(n))for(let r=0;r<n.length;++r)xd(n[r],e,t);else{let r=-1;for(const o of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(o)&&(r=Math.max(r,Number(o)));for(let o=0;o<=r;o++)xd(n[o],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pne{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new One)}profileKernel(e,t,r){let o;const s=()=>{o=r()};let i;const a=as();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(s);else{s();for(const c of o)c.dataSync();i=Promise.resolve({kernelMs:as()-a})}if(Ce().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){const u=o[c];u.data().then(d=>{Mne(d,u.dtype,e)})}return{kernelName:e,outputs:o,inputs:t,timeMs:i.then(c=>c.kernelMs),extraInfo:i.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:r,timeMs:o,inputs:s,extraInfo:i}=e;r.forEach(a=>{Promise.all([a.data(),o,i]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],s,l[2])})})}}function Mne(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){const o=n[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${t}'`),!0}return!1}class One{logKernelProfile(e,t,r,o,s,i){const a=typeof o=="number"?tf(`${o}ms`,9):o.error,l=tf(e,25),c=t.rank,u=t.size,d=tf(t.shape.toString(),14);let h="";for(const p in s){const g=s[p];if(g!=null){const x=g.shape||t.shape,y=x.length;h+=`${p}: ${y}D ${y>0?x:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${h}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lne(n,e,t){const r={},o={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<n.length;l++){const c=n[l],u=c.inputs;for(const d in u){const h=u[d];let p=!1;for(let g=0;g<e.length;g++)if(r[h.id]){c.outputs.forEach(x=>r[x.id]=!0),p=!0,o[c.id]=!0;break}if(p)break}}const s={};s[t.id]=!0;const i={};for(let l=n.length-1;l>=0;l--){const c=n[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(s[c.outputs[d].id]){for(const h in u)s[u[h].id]=!0,i[c.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const c=n[l];if(o[c.id]&&i[c.id]){const u={};for(const h in c.inputs){const p=c.inputs[h];r[p.id]&&(u[h]=p)}const d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function Bne(n,e,t,r){for(let o=e.length-1;o>=0;o--){const s=e[o],i=[];if(s.outputs.forEach(l=>{const c=n[l.id];c!=null?i.push(c):i.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(i);for(const l in s.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=t(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=s.inputs[l];if(!In(c.shape,u.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(n[u.id]==null)n[u.id]=c;else{const d=n[u.id];n[u.id]=r(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eE=20,_p=3,p3=7;function jne(n,e,t,r){const o=Nt(e),s=Vne(n,e,t,o),i=e.length,a=rx(n,e,t,o,s),l=["Tensor"];return r&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Vne(n,e,t,r){const o=De(e),s=r[r.length-1],i=new Array(s).fill(0),a=e.length,l=t==="complex64"?Vp(n):n;if(a>1)for(let c=0;c<o/s;c++){const u=c*s;for(let d=0;d<s;d++)i[d]=Math.max(i[d],jp(l[u+d],0,t).length)}return i}function jp(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(p3))} + ${parseFloat(n[1].toFixed(p3))}j`:Vm(n)?r=`'${n}'`:t==="bool"?r=a$(n):r=parseFloat(n.toFixed(p3)).toString(),tf(r,e)}function a$(n){return n===0?"false":"true"}function rx(n,e,t,r,o,s=!0){const i=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const x=Vp(n);return[jp(x[0],0,t)]}return t==="bool"?[a$(n[0])]:[n[0].toString()]}if(l===1){if(a>eE){const y=_p*i;let b=Array.from(n.slice(0,y)),C=Array.from(n.slice((a-_p)*i,a*i));return t==="complex64"&&(b=Vp(b),C=Vp(C)),["["+b.map((S,k)=>jp(S,o[k],t)).join(", ")+", ..., "+C.map((S,k)=>jp(S,o[a-_p+k],t)).join(", ")+"]"]}return["["+(t==="complex64"?Vp(n):Array.from(n)).map((y,b)=>jp(y,o[b],t)).join(", ")+"]"]}const c=e.slice(1),u=r.slice(1),d=r[0]*i,h=[];if(a>eE){for(let x=0;x<_p;x++){const y=x*d,b=y+d;h.push(...rx(n.slice(y,b),c,t,u,o,!1))}h.push("...");for(let x=a-_p;x<a;x++){const y=x*d,b=y+d;h.push(...rx(n.slice(y,b),c,t,u,o,x===a-1))}}else for(let x=0;x<a;x++){const y=x*d,b=y+d;h.push(...rx(n.slice(y,b),c,t,u,o,x===a-1))}const p=l===2?",":"";h[0]="["+(a>0?h[0]+p:"");for(let x=1;x<h.length-1;x++)h[x]=" "+h[x]+p;let g=`,
`;for(let x=2;x<l;x++)g+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(s?"":g),h}function Vp(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ho{constructor(e,t,r){if(this.dtype=t,this.shape=e.slice(),this.size=De(e),r!=null){const o=r.length;K(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||mr(t,this.size),this.strides=Nt(e)}set(e,...t){t.length===0&&(t=[0]),K(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const r=this.locToIndex(t);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const o of e){if(o<0||o>=this.shape[t]){const s=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(s)}t++}let r=e[e.length-1];for(let o=0;o<e.length-1;++o)r+=this.strides[o]*e[o];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return ra().makeTensor(this.values,this.shape,this.dtype)}}let ra=null,zh=null;function zne(n){ra=n}function Wne(n){zh=n}class _r{constructor(e,t,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=De(e),this.strides=Nt(e),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return zh.buffer(this.shape,this.dtype,e)}bufferSync(){return zh.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return la(this.shape,e,this.dtype==="complex64")}arraySync(){return la(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=ra().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(r=>ou(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),ra().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=ra().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>ou(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await ra().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),ra().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return zh.print(this,e)}clone(){return this.throwIfDisposed(),zh.clone(this)}toString(e=!1){const t=this.dataSync();return jne(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),zh.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),ra().makeVariable(this,e,t,r)}}Object.defineProperty(_r,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function Te(){return L5("Tensor",()=>_r)}Te();class Hx extends _r{constructor(e,t,r,o){super(e.shape,e.dtype,e.dataId,o),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!In(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);ra().disposeTensor(this),this.dataId=e.dataId,ra().incRef(this,null)}dispose(){ra().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Hx,Symbol.hasInstance,{value:n=>n instanceof _r&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var tE;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(tE||(tE={}));var DC;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(DC||(DC={}));var AC;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(AC||(AC={}));var _C;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(_C||(_C={}));var $C;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})($C||($C={}));const Une={float32:_C,int32:DC,bool:AC,complex64:$C};function Ls(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Une[n][e]}function I6(n){return Ls(n,"int32")}function l$(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function c$(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xr(n,e){if(n.dtype===e.dtype)return[n,e];const t=Ls(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function u$(n){const e=[];return d$(n,e,new Set),e}function d$(n,e,t){if(n==null)return;if(n instanceof _r){e.push(n);return}if(!Hne(n))return;const r=n;for(const o in r){const s=r[o];t.has(s)||(t.add(s),d$(s,e,t))}}function Hne(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3(n){return n.kernelName!=null}class nE{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class pf{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new nE}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Js(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Pne(this.backendInstance),!0}setupRegisteredKernels(){ZI(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){ZI(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=t.factory();if(r&&!(r instanceof $5)&&typeof r.then=="function"){const o=++this.pendingBackendInitId,s=r.then(i=>o<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(o<this.pendingBackendInitId||(this.pendingBackendInit=null,Js(`Initialization of backend ${e} failed`),Js(i.stack||i.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Js(`Initialization of backend ${e} failed`),Js(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t],{success:o,asyncInit:s}=this.initializeBackend(r);if(s||o)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const r=this.state.tensorInfo.get(t),o=r.backend,s=this.readSync(t),i=o.refCount(t);o.disposeData(t,!0),r.backend=e,e.move(t,s,r.shape,r.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let o;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(o),()=>(o=t(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o))}scopedRun(e,t,r){e();try{const o=r();return t(),o}catch(o){throw t(),o}}nextTensorId(){return pf.nextTensorId++}nextVariableId(){return pf.nextVariableId++}clone(e){const t=le.runKernel(l1,{x:e}),r={x:e},o=i=>({x:()=>{const a="float32",l={x:i},c={dtype:a};return le.runKernel(Xm,l,c)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[t],o,s,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(XI(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){const o=this.backend.numDataIds();let s=0;r.forEach(l=>{s+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=o-t-s-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[];const o=this.isTapeOn(),s=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=m3(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(m3(e)){const{kernelName:g,inputs:x,attrs:y}=e;this.backendName==null&&this.backend;const b=XI(g,this.backendName);K(b!=null,()=>`Cannot find registered kernel '${g}' for backend '${this.backendName}'`),a=()=>{const C=this.backend.numDataIds();l=b.kernelFunc({inputs:x,attrs:y,backend:this.backend});const S=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(g,C,S);const k=S.map(N=>N.rank!=null?N:this.makeTensorFromTensorInfo(N));if(o){const N=this.getTensorsForGradient(g,x,k);r=this.saveTensorsForBackwardMode(N)}return k}}else{const{forwardFunc:g}=e,x=y=>{o&&(r=y.map(b=>this.keep(this.clone(b))))};a=()=>{const y=this.backend.numDataIds();l=this.tidy(()=>g(this.backend,x));const b=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,y,b),b}}const{inputs:u,attrs:d}=e,h=m3(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(p=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),o&&this.addTapeNode(c,u,t,h,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(g=>u[g]!=null?u[g].shape:null),outputShapes:t.map(g=>g.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){const o=YI(e);if(o!=null){const s=o.inputsToSave||[],i=o.outputsToSave||[];let a;o.saveAllInputs?(K(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(c=>t[c])):a=s.map(c=>t[c]);const l=r.filter((c,u)=>i[u]);return a.concat(l)}return[]}makeTensor(e,t,r,o){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;let s=e;r==="string"&&Vm(e[0])&&(s=e.map(l=>Zc(l)));const i=o.write(s,t,r),a=new _r(t,r,i,this.nextTensorId());if(this.trackTensor(a,o),r==="string"){const l=this.state.tensorInfo.get(i),c=hne(s);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,t,r,o){r=r||"float32";const s={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(s,o)}makeTensorFromTensorInfo(e,t){const{dataId:r,shape:o,dtype:s}=e,i=new _r(o,s,r,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,r,o){r=r||this.nextVariableId().toString(),o!=null&&o!==e.dtype&&(e=e.cast(o));const s=new Hx(e,t,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Vx(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Hx||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*Vx(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(o=>o.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const o of this.state.activeProfile.kernels)o.kernelTimeMs=await o.kernelTimeMs,o.extraInfo=await o.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,o,s,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:s},l=YI(e);l!=null&&(o=l.gradFunc),o!=null&&(a.gradient=c=>(c=c.map((u,d)=>{if(u==null){const h=r[d],p=To(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return u}),o(c.length>1?c:c[0],s,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=u$(e),r=new Set(t.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){const i=this.state.activeScope.track[s];!i.kept&&!r.has(i.id)&&i.dispose()}const o=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(s=>{!s.kept&&s.scopeId===o.id&&this.track(s)})}gradients(e,t,r,o=!1){if(K(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));K(s instanceof _r,()=>"The result y returned by f() must be a tensor.");const i=Lne(this.state.activeTape,t,s);if(!o&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[s.id]=r??Gne(s.shape),Bne(a,i,c=>this.tidy(c),qne);const l=t.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:s,grads:l}})}customGrad(e){return K(SC(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{K(t.every(a=>a instanceof _r),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const o={};t.forEach((a,l)=>{o[l]=a});const s=(a,l)=>(r=e(...t,l),K(r.value instanceof _r,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),K(SC(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),i=(a,l)=>{const c=r.gradFunc(a,l),u=Array.isArray(c)?c:[c];K(u.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),K(u.every(h=>h instanceof _r),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return u.forEach((h,p)=>{d[p]=()=>h}),d};return this.runKernelFunc({forwardFunc:s,backwardsFunc:i,inputs:o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=as(),r=await this.backend.time(e);return r.wallMs=as()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new nE;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}pf.nextTensorId=0;pf.nextVariableId=0;function Gne(n){const e=M5(De(n),"float32");return le.makeTensor(e,n,"float32")}function h$(){const n=__();if(n._tfengine==null){const e=new mne(n);n._tfengine=new pf(e)}return yne(n._tfengine.ENV),zne(()=>n._tfengine),n._tfengine}const le=h$();function qne(n,e){const t={a:n,b:e};return le.runKernel(Ff,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kne(){return typeof navigator<"u"&&navigator!=null}function f$(n){if(n||Kne()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function p$(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fs=Ce();fs.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});fs.registerFlag("IS_BROWSER",()=>p$());fs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");fs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));fs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));fs.registerFlag("PROD",()=>!1);fs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>fs.getBool("DEBUG"));fs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);fs.registerFlag("IS_TEST",()=>!1);fs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>fs.getBool("DEBUG"));fs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);fs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);fs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2(n,e){let t=n;if(_i(n))return e==="string"?[]:[n.length];if(l$(n)){const o=n.channels||"RGBA";return[n.height,n.width*o.length]}else if(c$(n))return[n.buffer.size/(e==null?4:Vx(e))];if(!Array.isArray(n))return[];const r=[];for(;Array.isArray(t)||_i(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&Ce().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&m$(n,r,[]),r}function m$(n,e,t){if(t=t||[],!Array.isArray(n)&&!_i(n)){K(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}K(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),K(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const r=e.slice(1);for(let o=0;o<n.length;++o)m$(n[o],r,t.concat(o))}function rE(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function ee(n,e,t,r="numeric"){if(n instanceof Te())return rE(r,n.dtype,e,t),n;let o=_f(n);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),rE(r,o,e,t),n==null||!_i(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const s=Y2(n,o);!_i(n)&&!Array.isArray(n)&&(n=[n]);const a=o!=="string"?Od(n,o):xd(n,[],!0);return le.makeTensor(a,s,o)}function g$(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((s,i)=>ee(s,`${e}[${i}]`,t,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xne="__op";function me(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Xne;const o=(...s)=>{le.startScope(t);try{const i=r(...s);return O5(i)&&console.error("Cannot return a Promise inside of tidy."),le.endScope(i),i}catch(i){throw le.endScope(null),i}};return Object.defineProperty(o,"name",{value:t,configurable:!0}),o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yne(n,e){const t=ee(n,"real","complex"),r=ee(e,"imag","complex");P5(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);const o={real:t,imag:r};return le.runKernel(G5,o)}const mf=me({complex_:Yne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z2(n,e,t,r){if(r==null)r=_f(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(c$(n)||l$(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return le.backend.createTensorFromGPUData(n,e||t,r)}if(!_i(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ic(e);const o=De(e),s=De(t);K(o===s,()=>`Based on the provided shape, [${e}], the tensor should have ${o} values but has ${s}`);for(let i=0;i<t.length;++i){const a=t[i],l=i===t.length-1?a!==De(e.slice(i)):!0;K(t[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!_i(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?Od(n,r):xd(n,[],!0),le.makeTensor(n,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x$(n,e,t){const r=Y2(n,t);return Z2(n,e,r,t)}class Pf{static join(e){return new Pf(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>_i(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let r=0;r<e.length;r++){const o=e[r];r!==e.length-1&&o.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const s=t+o.byteLength;this.shards.push({buffer:o,start:t,end:s}),t=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const o=t-e,s=new ArrayBuffer(o),i=new Uint8Array(s);let a=0;for(let l=r;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,h=a,g=Math.min(t,c.end)-c.start,x=new Uint8Array(c.buffer,d,g-d);if(i.set(x,h),a+=x.length,t<c.end)break}return s}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(o){return e<o.start?-1:e>=o.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=Zne(this.shards,t);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function Zne(n,e){let t=0,r=n.length;for(;t<=r;){const o=Math.floor((r-t)/2)+t,s=e(n[o]);if(s===0)return o;s<0?r=o:t=o+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ja(){return le}function oE(){return le.memory()}function ve(n,e){return le.tidy(n,e)}function rn(n){u$(n).forEach(t=>t.dispose())}function rl(n){return le.keep(n)}function Qne(n){return le.setBackend(n)}function Jne(){return le.ready()}function ere(){return le.backendName}function v$(n,e,t=1){return le.registerBackend(n,e,t)}function tre(){return le.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sE=4;async function iE(n,e){const t=[],r=[],o=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<o.length;++i){const a=o[i],l=Array.isArray(n)?n[i].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async d=>{const h=await l.bytes(),p=h.reduce((y,b)=>y+b.length,0)+sE*h.length,g=new Uint8Array(p);let x=0;for(let y=0;y<h.length;y++){const b=h[y],C=new Uint8Array(new Uint32Array([b.length]).buffer);g.set(C,x),x+=sE,g.set(b,x),x+=b.length}d(g)});r.push(u)}else r.push(l.data());e!=null&&(c.group=e),t.push(c)}const s=await Promise.all(r);return{data:nre(s),specs:t}}function nre(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(s=>{if(e+=s.byteLength,t.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});const r=new Uint8Array(e);let o=0;return t.forEach(s=>{r.set(new Uint8Array(s.buffer),o),o+=s.byteLength}),r.buffer}const E6=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function aE(n){return E6?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function rre(n){if(E6)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let r=0,o=e.length;r<o;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function ore(n){if(E6){const r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function sre(n){return Pf.join(n)}function y$(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:aE(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:aE(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Pf(n.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vo{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Vo.instance==null&&(Vo.instance=new Vo),Vo.instance}static registerSaveRouter(e){Vo.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Vo.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Vo.getHandlers(e,"save")}static getLoadHandlers(e,t){return Vo.getHandlers(e,"load",t)}static getHandlers(e,t,r){const o=[];return(t==="load"?Vo.getInstance().loadRouters:Vo.getInstance().saveRouters).forEach(i=>{const a=i(e,r);a!==null&&o.push(a)}),o}}const ire=n=>Vo.getSaveHandlers(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FC="tensorflowjs",PC=1,sd="models_store",Uc="model_info_store";function b$(){if(!Ce().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function MC(n){const e=n.result;e.createObjectStore(sd,{keyPath:"modelPath"}),e.createObjectStore(Uc,{keyPath:"modelPath"})}class vd{constructor(e){if(this.indexedDB=b$(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,o)=>{const s=this.indexedDB.open(FC,PC);s.onupgradeneeded=()=>MC(s),s.onsuccess=()=>{const i=s.result;if(t==null){const a=i.transaction(sd,"readonly"),c=a.objectStore(sd).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return i.close(),o(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=u=>(i.close(),o(c.error)),a.oncomplete=()=>i.close()}else{t.weightData=Pf.join(t.weightData);const a=y$(t),l=i.transaction(Uc,"readwrite");let c=l.objectStore(Uc),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return o(h)}let d;u.onsuccess=()=>{d=i.transaction(sd,"readwrite");const h=d.objectStore(sd);let p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(g){return o(g)}p.onsuccess=()=>r({modelArtifactsInfo:a}),p.onerror=g=>{c=l.objectStore(Uc);const x=c.delete(this.modelPath);x.onsuccess=()=>(i.close(),o(p.error)),x.onerror=y=>(i.close(),o(p.error))}},u.onerror=h=>(i.close(),o(u.error)),l.oncomplete=()=>{d==null?i.close():d.oncomplete=()=>i.close()}}},s.onerror=i=>o(s.error)})}}vd.URL_SCHEME="indexeddb://";const w$=n=>Ce().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(vd.URL_SCHEME)?are(n.slice(vd.URL_SCHEME.length)):null;Vo.registerSaveRouter(w$);Vo.registerLoadRouter(w$);function are(n){return new vd(n)}function lre(n){return n.startsWith(vd.URL_SCHEME)?n.slice(vd.URL_SCHEME.length):n}class cre{constructor(){this.indexedDB=b$()}async listModels(){return new Promise((e,t)=>{const r=this.indexedDB.open(FC,PC);r.onupgradeneeded=()=>MC(r),r.onsuccess=()=>{const o=r.result,s=o.transaction(Uc,"readonly"),a=s.objectStore(Uc).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(o.close(),t(a.error)),s.oncomplete=()=>o.close()},r.onerror=o=>t(r.error)})}async removeModel(e){return e=lre(e),new Promise((t,r)=>{const o=this.indexedDB.open(FC,PC);o.onupgradeneeded=()=>MC(o),o.onsuccess=()=>{const s=o.result,i=s.transaction(Uc,"readwrite"),a=i.objectStore(Uc),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return s.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),d=()=>{c=s.transaction(sd,"readwrite");const p=c.objectStore(sd).delete(e);p.onsuccess=()=>t(l.result.modelArtifactsInfo),p.onerror=g=>r(l.error)};u.onsuccess=d,u.onerror=h=>(d(),s.close(),r(l.error))}},l.onerror=u=>(s.close(),r(l.error)),i.oncomplete=()=>{c==null?s.close():c.oncomplete=()=>s.close()}},o.onerror=s=>r(o.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ul="/",Wh="tensorflowjs_models",C$="info",ure="model_topology",dre="weight_specs",hre="weight_data",fre="model_metadata";function k$(n){return{info:[Wh,n,C$].join(Ul),topology:[Wh,n,ure].join(Ul),weightSpecs:[Wh,n,dre].join(Ul),weightData:[Wh,n,hre].join(Ul),modelMetadata:[Wh,n,fre].join(Ul)}}function S$(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function pre(n){const e=n.split(Ul);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Ul)}function mre(n){return n.startsWith(yd.URL_SCHEME)?n.slice(yd.URL_SCHEME.length):n}class yd{constructor(e){if(!Ce().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=k$(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),o=y$(e),s=Pf.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,rre(s));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:o}}catch{throw S$(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${o.modelTopologyBytes}, weightSpecsBytes=${o.weightSpecsBytes}, weightDataBytes=${o.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;const o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(o==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=o;const s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){const a=JSON.parse(s);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=ore(i),t}}yd.URL_SCHEME="localstorage://";const N$=n=>Ce().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(yd.URL_SCHEME)?gre(n.slice(yd.URL_SCHEME.length)):null;Vo.registerSaveRouter(N$);Vo.registerLoadRouter(N$);function gre(n){return new yd(n)}class xre{constructor(){K(Ce().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),K(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Wh+Ul,r=Ul+C$;for(let o=0;o<this.LS.length;++o){const s=this.LS.key(o);if(s.startsWith(t)&&s.endsWith(r)){const i=pre(s);e[i]=JSON.parse(this.LS.getItem(s))}}return e}async removeModel(e){e=mre(e);const t=k$(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(t.info));return S$(t),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lE="://";class Va{constructor(){this.managers={}}static getInstance(){return Va.instance==null&&(Va.instance=new Va),Va.instance}static registerManager(e,t){K(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(lE)&&(e=e.slice(0,e.indexOf(lE))),K(e.length>0,()=>"scheme must not be an empty string.");const r=Va.getInstance();K(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=t}static getManager(e){const t=Va.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Va.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vre{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!Ce().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const o=this.functionRefs[r.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return n$(e)}}if(Ce().get("IS_BROWSER")){Ce().setPlatform("browser",new vre);try{Va.registerManager(yd.URL_SCHEME,new xre)}catch{}try{Va.registerManager(vd.URL_SCHEME,new cre)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yre={importFetch:()=>require("node-fetch")};let g3;class bre{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return Ce().global.fetch!=null?Ce().global.fetch(e,t):(g3==null&&(g3=yre.importFetch()),g3(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}Ce().get("IS_NODE")&&!Ce().get("IS_BROWSER")&&Ce().setPlatform("node",new bre);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zt(n,e="float32",t){return e=e||"float32",ic(n),new ho(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wre(n,e){const t=ee(n,"x","cast");if(!dne(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:t},o={dtype:e};return le.runKernel(Xm,r,o)}const nt=me({cast_:wre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cre(n){const t={x:ee(n,"x","clone","string_or_numeric")};return le.runKernel(l1,t)}const cd=me({clone_:Cre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kre(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */h$();const Sre={buffer:Zt,cast:nt,clone:cd,print:kre};Wne(Sre);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nre(n,e){let t=ee(n,"a","add"),r=ee(e,"b","add");[t,r]=xr(t,r);const o={a:t,b:r};return le.runKernel(Ff,o)}const Ue=me({add_:Nre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ire(n,e){let t=ee(n,"a","floorDiv"),r=ee(e,"b","floorDiv");[t,r]=xr(t,r);const o={a:t,b:r};return le.runKernel(i1,o)}const I$=me({floorDiv_:Ire});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ere(n,e){let t=ee(n,"a","div"),r=ee(e,"b","div");if([t,r]=xr(t,r),t.dtype==="int32"&&r.dtype==="int32")return I$(t,r);const o={a:t,b:r},s={};return le.runKernel(e1,o,s)}const Et=me({div_:Ere});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tre(n,e){let t=ee(n,"a","mul"),r=ee(e,"b","mul");[t,r]=xr(t,r);const o={a:t,b:r};return le.runKernel(x1,o)}const ae=me({mul_:Tre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rre(n){const e=ee(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return le.runKernel(n2,t)}else{const t={x:e};return le.runKernel(Xv,t)}}const Wo=me({abs_:Rre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dre(n){const t={x:ee(n,"x","acos")};return le.runKernel(zm,t)}const Are=me({acos_:Dre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _re(n){const t={x:ee(n,"x","acosh")};return le.runKernel(Wm,t)}const $re=me({acosh_:_re});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(n,e=null,t=!1){const o={x:ee(n,"x","all","bool")},s={axis:e,keepDims:t};return le.runKernel(j5,o,s)}const E$=me({all_:Fre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pre(n,e=null,t=!1){const o={x:ee(n,"x","any","bool")},s={axis:e,keepDims:t};return le.runKernel(V5,o,s)}const OC=me({any_:Pre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mre(n,e=0){const r={x:ee(n,"x","argMax")},o={axis:e};return le.runKernel(Yv,r,o)}const hm=me({argMax_:Mre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ore(n,e=0){const r={x:ee(n,"x","argMin")},o={axis:e};return le.runKernel(Zv,r,o)}const Lre=me({argMin_:Ore});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bre(n){const t={x:ee(n,"x","asin")};return le.runKernel(Um,t)}const jre=me({asin_:Bre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vre(n){const t={x:ee(n,"x","asinh")};return le.runKernel(Hm,t)}const zre=me({asinh_:Vre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wre(n){const t={x:ee(n,"x","atan")};return le.runKernel(Gm,t)}const Ure=me({atan_:Wre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hre(n,e){let t=ee(n,"a","atan2"),r=ee(e,"b","atan2");[t,r]=xr(t,r);const o={a:t,b:r};return le.runKernel(Km,o)}const Gre=me({atan2_:Hre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qre(n){const t={x:ee(n,"x","atanh")};return le.runKernel(qm,t)}const Kre=me({atanh_:qre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O1(n,e,t,r,o="NHWC",s){const i=n[3],a=[...e,i],l=lc(o);return po(n,a,t,s,r,null,null,l)}function Pi(n,e,t,r,o,s,i="channelsLast"){const[a,l]=fm(e);let c;if(i==="channelsLast")c=[a,l,n[3],n[3]];else if(i==="channelsFirst")c=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return po(n,c,t,r,o,s,!1,i)}function ac(n,e,t,r,o,s,i="NDHWC"){const[a,l,c]=LC(e);let u,d;if(i==="NDHWC")d="channelsLast",u=[a,l,c,n[4],n[4]];else if(i==="NCDHW")d="channelsFirst",u=[a,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return mu(n,u,t,r,o,!1,d,s)}function po(n,e,t,r,o,s,i=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=n;else if(a==="channelsFirst")[l,d,c,u]=n;else throw new Error(`Unknown dataFormat ${a}`);const[h,p,,g]=e,[x,y]=fm(t),[b,C]=fm(r),S=rf(h,b),k=rf(p,C),{padInfo:N,outHeight:E,outWidth:_}=Zre(o,c,u,x,y,S,k,s,a),$=i?g*d:g;let T;return a==="channelsFirst"?T=[l,$,E,_]:a==="channelsLast"&&(T=[l,E,_,$]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:E,outWidth:_,outChannels:$,padInfo:N,strideHeight:x,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:S,effectiveFilterWidth:k,dilationHeight:b,dilationWidth:C,inShape:n,outShape:T,filterShape:e}}function mu(n,e,t,r,o,s=!1,i="channelsLast",a){let[l,c,u,d,h]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,c,u,d,h]=n;else if(i==="channelsFirst")[l,h,c,u,d]=n;else throw new Error(`Unknown dataFormat ${i}`);const[p,g,x,,y]=e,[b,C,S]=LC(t),[k,N,E]=LC(r),_=rf(p,k),$=rf(g,N),T=rf(x,E),{padInfo:D,outDepth:A,outHeight:M,outWidth:j}=Qre(o,c,u,d,b,C,S,_,$,T,a),L=s?y*h:y;let U;return i==="channelsFirst"?U=[l,L,A,M,j]:i==="channelsLast"&&(U=[l,A,M,j,L]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:u,inWidth:d,inChannels:h,outDepth:A,outHeight:M,outWidth:j,outChannels:L,padInfo:D,strideDepth:b,strideHeight:C,strideWidth:S,filterDepth:p,filterHeight:g,filterWidth:x,effectiveFilterDepth:_,effectiveFilterHeight:$,effectiveFilterWidth:T,dilationDepth:k,dilationHeight:N,dilationWidth:E,inShape:n,outShape:U,filterShape:e}}function Xre(n,e,t,r,o){r==null&&(r=T6(n,e,t));const s=n[0],i=n[1],a=pm((s-e+2*r)/t+1,o),l=pm((i-e+2*r)/t+1,o);return[a,l]}function Yre(n,e,t,r,o,s){o==null&&(o=T6(n,e[0],r[0]));const i=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*o>=e[a]&&(i[a]=pm((n[a]-e[a]+2*o)/r[a]+1,s));return i}function T6(n,e,t,r=1){const o=rf(e,r);return Math.floor((n[0]*(t-1)-t+o)/2)}function fm(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function LC(n){return typeof n=="number"?[n,n,n]:n}function rf(n,e){return e<=1?n:n+(n-1)*(e-1)}function Zre(n,e,t,r,o,s,i,a,l){let c,u,d;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const p=Xre([e,t],s,r,n,a);u=p[0],d=p[1]}else if(n==="same"){u=Math.ceil(e/r),d=Math.ceil(t/o);const h=Math.max(0,(u-1)*r+s-e),p=Math.max(0,(d-1)*o+i-t),g=Math.floor(h/2),x=h-g,y=Math.floor(p/2),b=p-y;c={top:g,bottom:x,left:y,right:b,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-s+1)/r),d=Math.ceil((t-i+1)/o);else if(typeof n=="object"){const h=l==="channelsLast"?n[1][0]:n[2][0],p=l==="channelsLast"?n[1][1]:n[2][1],g=l==="channelsLast"?n[2][0]:n[3][0],x=l==="channelsLast"?n[2][1]:n[3][1];c={top:h,bottom:p,left:g,right:x,type:h===0&&p===0&&g===0&&x===0?"VALID":"EXPLICIT"},u=pm((e-s+h+p)/r+1,a),d=pm((t-i+g+x)/o+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:u,outWidth:d}}function Qre(n,e,t,r,o,s,i,a,l,c,u){let d,h,p,g;if(n==="valid"&&(n=0),typeof n=="number"){d={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const y=Yre([e,t,r,1],[a,l,c],1,[o,s,i],n,u);h=y[0],p=y[1],g=y[2]}else if(n==="same"){h=Math.ceil(e/o),p=Math.ceil(t/s),g=Math.ceil(r/i);const x=(h-1)*o+a-e,y=(p-1)*s+l-t,b=(g-1)*i+c-r,C=Math.floor(x/2),S=x-C,k=Math.floor(y/2),N=y-k,E=Math.floor(b/2),_=b-E;d={top:k,bottom:N,left:E,right:_,front:C,back:S,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:d,outDepth:h,outHeight:p,outWidth:g}}function pm(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function bd(n){const[e,t,r]=fm(n);return e===1&&t===1&&r===1}function Do(n,e){return bd(n)||bd(e)}function wd(n){return fm(n).every(e=>e>0)}function lc(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function ms(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")K(ff(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(o=>{K(ff(o),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${o}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jre(n,e){const r={x:ee(n,"x","reshape","string_or_numeric")},o={shape:e};return le.runKernel(M2,r,o)}const pe=me({reshape_:Jre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eoe(n,e,t,r,o){const s=ee(n,"x","avgPool","float32"),i=1;K(Do(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=s,l=!1;s.rank===3&&(l=!0,a=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),K(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),ms("avgPool",r,o);const c={x:a},u={filterSize:e,strides:t,pad:r,dimRoundingMode:o};let d=le.runKernel(Qv,c,u);return d=nt(d,s.dtype),l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const R6=me({avgPool_:eoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(n,e,t,r,o,s="NDHWC"){const i=ee(n,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=pe(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),K(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),K(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),K(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),ms("avgPool3d",r,o);const c={x:a},u={filterSize:e,strides:t,pad:r,dimRoundingMode:o,dataFormat:s};let d=le.runKernel(Jv,c,u);return d=nt(d,a.dtype),l?pe(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const noe=me({avgPool3d_:toe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(n,e=0){K(n.length>=1,()=>"Pass at least one tensor to concat");const t=g$(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),t.length===1)return cd(t[0]);const r=t,o={axis:e};return le.runKernel(r2,r,o)}const ds=me({concat_:roe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(n,e,t=!1,r=!1){let o=ee(n,"a","matMul"),s=ee(e,"b","matMul");[o,s]=xr(o,s);const i={a:o,b:s},a={transposeA:t,transposeB:r};return le.runKernel(e2,i,a)}const Sn=me({matMul_:ooe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function soe(n){const t={x:ee(n,"x","sigmoid","float32")};return le.runKernel(T1,t)}const Mf=me({sigmoid_:soe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(n,e,t){const r=ee(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const o={x:r},s={begin:e,size:t};return le.runKernel(V2,o,s)}const jn=me({slice_:ioe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(n){const t={x:ee(n,"x","tanh","float32")};return le.runKernel(F1,t)}const Q2=me({tanh_:aoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(n,e,t){const r=ee(n,"x","batchToSpaceND"),o=e.reduce((a,l)=>a*l);K(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),K(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),K(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${o}`);const s={x:r},i={blockShape:e,crops:t};return le.runKernel(t2,s,i)}const D6=me({batchToSpaceND_:loe});function coe(n){let e;return n.rank===0||n.rank===1?e=pe(n,[1,1,1,n.size]):n.rank===2?e=pe(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=pe(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(n,e,t,r,o,s){s==null&&(s=.001);const i=ee(n,"x","batchNorm"),a=ee(e,"mean","batchNorm"),l=ee(t,"variance","batchNorm");let c;o!=null&&(c=ee(o,"scale","batchNorm"));let u;r!=null&&(u=ee(r,"offset","batchNorm")),K(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),K(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),K(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:coe(i),scale:c,offset:u,mean:a,variance:l},p={varianceEpsilon:s},g=le.runKernel(h2,h,p);return pe(g,i.shape)}const J2=me({batchNorm_:uoe});function doe(n,e,t,r,o,s){const i=ee(n,"x","batchNorm"),a=ee(e,"mean","batchNorm"),l=ee(t,"variance","batchNorm");let c;o!=null&&(c=ee(o,"scale","batchNorm"));let u;return r!=null&&(u=ee(r,"offset","batchNorm")),K(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),K(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),K(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&K(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&K(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),J2(i,a,l,u,c,s)}const hoe=me({batchNorm2d_:doe});function foe(n,e,t,r,o,s){const i=ee(n,"x","batchNorm"),a=ee(e,"mean","batchNorm"),l=ee(t,"variance","batchNorm");let c;o!=null&&(c=ee(o,"scale","batchNorm"));let u;return r!=null&&(u=ee(r,"offset","batchNorm")),K(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),K(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),K(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&K(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&K(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),J2(i,a,l,u,c,s)}const poe=me({batchNorm3d_:foe});function moe(n,e,t,r,o,s){const i=ee(n,"x","batchNorm"),a=ee(e,"mean","batchNorm"),l=ee(t,"variance","batchNorm");let c;o!=null&&(c=ee(o,"scale","batchNorm"));let u;return r!=null&&(u=ee(r,"offset","batchNorm")),K(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),K(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),K(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&K(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&K(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),J2(i,a,l,u,c,s)}const goe=me({batchNorm4d_:moe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe(n,e,t){const r=ee(n,"x","bincount"),o=ee(e,"weights","bincount");K(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),K(t>=0,()=>`size must be non-negative, but got ${t}.`),K(o.size===r.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${o.shape}.`);const s={x:r,weights:o},i={size:t};return le.runKernel(U5,s,i)}const voe=me({bincount_:xoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yoe(n,e){let t=ee(n,"broadcastTo","x");const r=t.shape;if(ic(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=pe(t,c)}const o=t.shape,s=Array.from(e);for(let c=e.length-1;c>=0;c--)if(o[c]===e[c])s[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(s.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return cd(t);const a={x:t},l={reps:s};return le.runKernel(P1,a,l)}const Yp=me({broadcastTo_:yoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function boe(n){const t={x:ee(n,"x","ceil","float32")};return le.runKernel(Ym,t)}const woe=me({ceil_:boe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ey(n,e,t){ic(n),t=t||_f(e);const r={shape:n,value:e,dtype:t};return le.runKernel(s6,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Coe(n,e,t){const r=ee(n,"x","clipByValue");if(K(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return ey(r.shape,e,r.dtype);const o={x:r},s={clipValueMin:e,clipValueMax:t};return le.runKernel(Zm,o,s)}const ai=me({clipByValue_:Coe});function koe(n){return ds(n,0)}const Soe=me({concat1d_:koe});function Noe(n,e){return ds(n,e)}const Ioe=me({concat2d_:Noe});function Eoe(n,e){return ds(n,e)}const Toe=me({concat3d_:Eoe});function Roe(n,e){return ds(n,e)}const Doe=me({concat4d_:Roe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aoe(n,e,t,r,o="NHWC",s=[1,1],i){const a=ee(n,"x","conv2d","float32"),l=ee(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),K(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),K(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),ms("conv2d",r,i);const d=o==="NHWC"?c.shape[3]:c.shape[1];K(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),K(Do(t,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`),K(wd(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),K(wd(t),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:c,filter:l},p={strides:t,pad:r,dataFormat:o,dilations:s,dimRoundingMode:i},g=le.runKernel(o2,h,p);return u?pe(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const Cd=me({conv2d_:Aoe});function _oe(n,e,t,r,o="NWC",s=1,i){const a=ee(n,"x","conv1d"),l=ee(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=pe(a,[1,a.shape[0],a.shape[1]])),K(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),K(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),ms("conv1d",r,i),K(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),K(Do(t,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${s}'`),K(wd(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),K(wd(t),()=>"Error in conv1D: Stride should be larger than 0."),K(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);const d=pe(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=pe(c,[c.shape[0],1,c.shape[1],c.shape[2]]),y=Cd(h,d,[1,t],r,"NHWC",[1,s],i);return u?pe(y,[y.shape[2],y.shape[3]]):pe(y,[y.shape[0],y.shape[2],y.shape[3]])}const T$=me({conv1d_:_oe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(n,e,t,r,o,s="NHWC",i){K(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,c=!1;e.rank===3&&(c=!0,l=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),K(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),K(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),K(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const u=s==="NHWC"?a[3]:a[1],d=s==="NHWC"?l.shape[3]:l.shape[1];K(u===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[2]}.`),K(d===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${t.shape[3]}.`),ms("conv2dDerInput",o,i);const h={dy:l,filter:t},p={strides:r,pad:o,dataFormat:s,dimRoundingMode:i,inputShape:a},g=le.runKernel(s2,h,p);return c?pe(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const A6=me({conv2DBackpropInput_:$oe});function Foe(n,e,t,r,o,s){const i=ee(n,"x","conv2dTranspose"),a=ee(e,"filter","conv2dTranspose");return A6(t,i,a,r,o,"NHWC",s)}const R$=me({conv2dTranspose_:Foe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Poe(n,e,t,r,o="NDHWC",s=[1,1,1]){const i=ee(n,"x","conv3d"),a=ee(e,"filter","conv3d");let l=i,c=!1;i.rank===4&&(c=!0,l=pe(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),K(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),K(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),K(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),K(Do(t,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`),K(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`),K(wd(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),K(wd(t),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},d={strides:t,pad:r,dataFormat:o,dilations:s},h=le.runKernel(i2,u,d);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Moe=me({conv3d_:Poe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ooe(n,e,t,r,o){K(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let s=n,i=e,a=!1;e.rank===4&&(a=!0,i=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,n[0],n[1],n[2],n[3]]);const l=s[4],c=i.shape[4];K(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),K(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),K(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),K(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),K(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);const u={dy:i,filter:t},d={pad:o,strides:r,inputShape:s},h=le.runKernel(X5,u,d);return a?pe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const D$=me({conv3DBackpropInput_:Ooe});function Loe(n,e,t,r,o){const s=ee(n,"x","conv3dTranspose"),i=ee(e,"filter","conv3dTranspose");return D$(t,s,i,r,o)}const Boe=me({conv3dTranspose_:Loe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(n){const t={x:ee(n,"x","cos","float32")};return le.runKernel(Qm,t)}const _6=me({cos_:joe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Voe(n){const t={x:ee(n,"x","cosh","float32")};return le.runKernel(Jm,t)}const A$=me({cosh_:Voe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zoe(n,e=0,t=!1,r=!1){const s={x:ee(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:r};return le.runKernel(Y5,s,i)}const BC=me({cumprod_:zoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Woe(n,e=0,t=!1,r=!1){const s={x:ee(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:r};return le.runKernel(a2,s,i)}const _$=me({cumsum_:Woe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(n,e,t,r=!1){const o=ee(n,"x","denseBincount"),s=ee(e,"weights","denseBincount");K(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),K(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),K(t>=0,()=>`size must be non-negative, but got ${t}.`),K(s.size===o.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${s.shape}.`);const i={x:o,weights:s},a={size:t,binaryOutput:r};return le.runKernel(Q5,i,a)}const cE=me({denseBincount_:Uoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hoe(n,e,t="NHWC"){const r=ee(n,"x","depthToSpace","float32"),o=t==="NHWC"?r.shape[1]:r.shape[2],s=t==="NHWC"?r.shape[2]:r.shape[3],i=t==="NHWC"?r.shape[3]:r.shape[1];K(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),K(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e}  for depthToSpace with input shape
    ${r.shape}`),K(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e} for depthToSpace with input shape
        ${r.shape}`),K(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`);const a={x:r},l={blockSize:e,dataFormat:t};return le.runKernel(J5,a,l)}const Goe=me({depthToSpace_:Hoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(n,e,t,r,o="NHWC",s=[1,1],i){const a=ee(n,"x","depthwiseConv2d","float32"),l=ee(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),K(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),K(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=o==="NHWC"?c.shape[3]:c.shape[1];K(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),ms("depthwiseConv2d",r,i);const h={x:c,filter:l},p={strides:t,pad:r,dataFormat:o,dilations:s,dimRoundingMode:i},g=le.runKernel(l2,h,p);return u?pe(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const $6=me({depthwiseConv2d_:qoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Koe(n,e,t,r,o=[1,1],s="NHWC"){const i=ee(n,"x","dilation2d"),a=ee(e,"filter","dilation2d");K(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),K(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),K(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let l=i,c=!1;i.rank===3&&(l=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0),K(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},d={strides:t,pad:r,dilations:o},h=le.runKernel(c2,u,d);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Xoe=me({dilation2d_:Koe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gf(n,e){const t=n.length,r=[];for(let o=0;o<t;o++){const s=t-1-o,i=n[s]||1;(e[e.length-1-o]||1)>1&&i===1&&r.unshift(s)}return r}function Lr(n,e){const t=[];for(let r=0;r<e.length;r++){const o=n[n.length-r-1],s=e.length-r-1,i=e[s];(o==null||o===1&&i>1)&&t.unshift(s)}return t}function Ut(n,e){const t=Math.max(n.length,e.length),r=new Array(t);for(let o=0;o<t;o++){let s=n[n.length-o-1];s==null&&(s=1);let i=e[e.length-o-1];if(i==null&&(i=1),s===1)r[t-o-1]=i;else if(i===1)r[t-o-1]=s;else if(s!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else r[t-o-1]=s}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yoe(n,e){let t=ee(n,"a","equal","string_or_numeric"),r=ee(e,"b","equal","string_or_numeric");[t,r]=xr(t,r),Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(u2,o)}const ul=me({equal_:Yoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zoe(n,e,t){const r=ee(e,"a","where"),o=ee(t,"b","where"),s=ee(n,"condition","where","bool"),i=Ut(Ut(s.shape,r.shape),o.shape),a=Yp(s,i),l=Yp(r,i),c=Yp(o,i),u={condition:a,t:l,e:c};return le.runKernel(j2,u)}const Zo=me({where_:Zoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qoe(n){const t={x:ee(n,"x","zerosLike")};return le.runKernel(K2,t)}const pn=me({zerosLike_:Qoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Joe(n,e){let t=ee(n,"a","div"),r=ee(e,"b","div");[t,r]=xr(t,r);const o=Et(t,r),s=pn(o),i=ul(r,s);return Zo(i,s,o)}const ese=me({divNoNan_:Joe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tse(n,e){const t=ee(n,"t1","dot"),r=ee(e,"t2","dot");K((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);const o=t.rank===1?t.size:t.shape[1],s=r.rank===1?r.size:r.shape[0];if(K(o===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${s}.`),t.rank===1&&r.rank===1){const i=pe(t,[1,-1]),a=pe(r,[-1,1]),l=Sn(i,a);return pe(l,[])}else if(t.rank===1&&r.rank===2){const i=pe(t,[1,-1]),a=pe(r,[r.shape[0],r.shape[1]]),l=Sn(i,a);return pe(l,[l.size])}else if(t.rank===2&&r.rank===1){const i=pe(r,[-1,1]),a=Sn(t,i);return pe(a,[a.size])}else{const i=pe(r,[r.shape[0],r.shape[1]]);return Sn(t,i)}}const nse=me({dot_:tse});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rse(n,...e){const t=e.map((o,s)=>ee(o,`tensors${s}`,"einsum")),r={equation:n};return le.runKernel(n6,t,r)}const $p=me({einsum_:rse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ose(n){const t={x:ee(n,"x","elu","float32")};return le.runKernel(t1,t)}const ty=me({elu_:ose});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sse(n){let e=ee(n,"x","erf");K(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=nt(e,"float32"));const t={x:e};return le.runKernel(n1,t)}const $$=me({erf_:sse});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function F$(n,e,t){const r=n.length+e.length,o=[];let s=0,i=0;for(let a=0;a<r;a++)t.indexOf(a)===-1?o.push(n[s++]):o.push(e[i++]);return o}function to(n,e){const t=[],r=n.length;for(let s=0;s<r;s++)e.indexOf(s)===-1&&t.push(n[s]);const o=e.map(s=>n[s]);return[t,o]}function Ir(n,e){const t=e.map(r=>1);return F$(n,t,e)}function mo(n,e,t){K(F6(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function sr(n,e){if(F6(n,e))return null;const t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function gu(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function vr(n,e){const t=[];for(let r=e-n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(n,e=null,t=!1){const o={x:ee(n,"x","max")},s={reductionIndices:e,keepDims:t};return le.runKernel(C2,o,s)}const ca=me({max_:ise});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ase(n,e=null,t=!1){const o={x:ee(n,"x","min")},s={axis:e,keepDims:t};return le.runKernel(I2,o,s)}const Gx=me({min_:ase});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lse(n,e){let t=ee(n,"base","pow"),r=ee(e,"exp","pow");[t,r]=xr(t,r);const o={a:t,b:r};return le.runKernel(v1,o)}const kd=me({pow_:lse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nn(n,e){if((_i(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&_i(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Z2(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cse(n){const t={x:ee(n,"x","sqrt","float32")};return le.runKernel(D1,t)}const Ro=me({sqrt_:cse});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function use(n){const e=ee(n,"x","square"),t={};return le.runKernel("Square",{x:e},t)}const Hn=me({square_:use});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(n,e=null,t=!1){let r=ee(n,"x","sum");r.dtype==="bool"&&(r=nt(r,"int32"));const o={x:r},s={axis:e,keepDims:t};return le.runKernel(z2,o,s)}const It=me({sum_:dse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hse(n,e="euclidean",t=null,r=!1){n=ee(n,"x","norm");const o=P$(n,e,t);let s=o.shape;if(r){const i=Qt(t,n.shape);s=Ir(o.shape,i)}return pe(o,s)}function P$(n,e,t=null){if(n.rank===0)return Wo(n);if(n.rank!==1&&t===null)return P$(pe(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return It(Wo(n),t);if(e===1/0)return ca(Wo(n),t);if(e===-1/0)return Gx(Wo(n),t);if(e==="euclidean"||e===2)return Ro(It(kd(Wo(n),Nn(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return ca(It(Wo(n),t[0]),t[1]-1);if(e===1/0)return ca(It(Wo(n),t[1]),t[0]);if(e===-1/0)return Gx(It(Wo(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Ro(It(Hn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const ny=me({norm_:hse});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fse(n,e=null,t=!1){return ny(n,"euclidean",e,t)}const pse=me({euclideanNorm_:fse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mse(n){const t={x:ee(n,"x","exp")};return le.runKernel(r1,t)}const dl=me({exp_:mse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gse(n,e=0){const t=ee(n,"x","expandDims","string_or_numeric");K(e<=t.rank,()=>"Axis must be <= rank of the tensor");const r={input:t},o={dim:e};return le.runKernel(d2,r,o)}const cs=me({expandDims_:gse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(n){const t={x:ee(n,"x","expm1")};return le.runKernel(o1,t)}const vse=me({expm1_:xse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yse(n,e){const t=ee(n,"x","tile","string_or_numeric");K(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const r={x:t},o={reps:e};return le.runKernel(P1,r,o)}const ia=me({tile_:yse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bse(n,e,t,r="float32"){e==null&&(e=n);const o=Zt([n,e],r),s=n<=e?n:e;for(let a=0;a<s;++a)o.set(1,a,a);const i=pe(o.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return ia(cs(i,0),[t[0],1,1]);if(t.length===2)return ia(cs(cs(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return ia(cs(cs(cs(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const M$=me({eye_:bse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(n){const t={x:ee(n,"x","floor","float32")};return le.runKernel(s1,t)}const ry=me({floor_:wse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cse(n,e,t=0,r=0){const o=ee(n,"x","gather"),s=ee(e,"indices","gather","int32"),i={x:o,indices:s},a={axis:t,batchDims:r};return le.runKernel(f2,i,a)}const P6=me({gather_:Cse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kse(n,e){let t=ee(n,"a","greater","string_or_numeric"),r=ee(e,"b","greater","string_or_numeric");[t,r]=xr(t,r),Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(p2,o)}const ui=me({greater_:kse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(n,e){let t=ee(n,"a","greaterEqual","string_or_numeric"),r=ee(e,"b","greaterEqual","string_or_numeric");[t,r]=xr(t,r),Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(a1,o)}const Ld=me({greaterEqual_:Sse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(n){const t={input:ee(n,"input","imag")};return le.runKernel(l6,t)}const M6=me({imag_:Nse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(n){const t={x:ee(n,"x","isFinite")};return le.runKernel(c1,t)}const Ese=me({isFinite_:Ise});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tse(n){const t={x:ee(n,"x","isInf")};return le.runKernel(u1,t)}const Rse=me({isInf_:Tse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dse(n){const t={x:ee(n,"x","isNaN")};return le.runKernel(d1,t)}const Ase=me({isNaN_:Dse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _se(n,e=.2){const r={x:ee(n,"x","leakyRelu")},o={alpha:e};return le.runKernel(m2,r,o)}const O6=me({leakyRelu_:_se});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(n,e){let t=ee(n,"a","less","string_or_numeric"),r=ee(e,"b","less","string_or_numeric");[t,r]=xr(t,r),Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(g2,o)}const qx=me({less_:$se});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fse(n,e){let t=ee(n,"a","lessEqual","string_or_numeric"),r=ee(e,"b","lessEqual","string_or_numeric");[t,r]=xr(t,r),Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(x2,o)}const Of=me({lessEqual_:Fse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(n,e=5,t=1,r=1,o=.5){const s=ee(n,"x","localResponseNormalization");K(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),K(ff(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=s,a=!1;s.rank===3&&(a=!0,i=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const l={x:i},c={depthRadius:e,bias:t,alpha:r,beta:o},u=le.runKernel(w2,l,c);return a?pe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const Mse=me({localResponseNormalization_:Pse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ose(n){const t={x:ee(n,"x","log","float32")};return le.runKernel(h1,t)}const hl=me({log_:Ose});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lse(n){const t={x:ee(n,"x","log1p")};return le.runKernel(f1,t)}const O$=me({log1p_:Lse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse(n,e){K(SC(n),()=>"The f passed in variableGrads(f) must be a function"),K(e==null||Array.isArray(e)&&e.every(c=>c instanceof Hx),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const c in le.registeredVariables)e.push(le.registeredVariables[c])}const r=t?e.filter(c=>!c.trainable):null,o=e.length;e=e.filter(c=>c.trainable),K(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);const s=!0,{value:i,grads:a}=le.gradients(n,e,null,s);K(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),K(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r?.forEach(c=>l[c.name]=null),{value:i,grads:l}}function xf(n){return le.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jse(n){const t={x:ee(n,"x","neg")};return le.runKernel(T2,t)}const gr=me({neg_:jse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vse(n){const t={x:ee(n,"x","softplus")};return le.runKernel(R1,t)}const L1=me({softplus_:Vse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zse(n){const e=ee(n,"x","logSigmoid");return xf(r=>({value:gr(L1(gr(r))),gradFunc:i=>ae(i,Mf(gr(r)))}))(e)}const Wse=me({logSigmoid_:zse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(n,e){let t=ee(n,"a","sub"),r=ee(e,"b","sub");[t,r]=xr(t,r);const o={a:t,b:r};return le.runKernel(_1,o)}const _t=me({sub_:Use});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hse(n,e=-1){const t=ee(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return xf((o,s)=>{const a=ca(o,e,!0),l=_t(o,a),c=_t(nt(l,"float32"),hl(It(dl(l),e,!0)));return s([c]),{value:c,gradFunc:(d,h)=>{const[p]=h,g=!0,x=dl(p);return _t(d,ae(It(d,e,g),x))}}})(t)}const L$=me({logSoftmax_:Hse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(n,e=null,t=!1){const r=ee(n,"x","logSumExp"),o=Qt(e,r.shape),s=ca(r,o,!0),i=_t(r,s),a=dl(i),l=It(a,o),c=hl(l),u=Ue(pe(s,c.shape),c);if(t){const d=Ir(u.shape,o);return pe(u,d)}return u}const B$=me({logSumExp_:Gse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(n,e){const t=ee(n,"a","logicalAnd","bool"),r=ee(e,"b","logicalAnd","bool");Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(v2,o)}const Yl=me({logicalAnd_:qse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kse(n){const t={x:ee(n,"x","logicalNot","bool")};return le.runKernel(y2,t)}const L6=me({logicalNot_:Kse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xse(n,e){const t=ee(n,"a","logicalOr","bool"),r=ee(e,"b","logicalOr","bool");Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(b2,o)}const j$=me({logicalOr_:Xse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yse(n,e){const t=ee(n,"a","logicalXor","bool"),r=ee(e,"b","logicalXor","bool");return Ut(t.shape,r.shape),Yl(j$(n,e),L6(Yl(n,e)))}const Zse=me({logicalXor_:Yse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qse(n,e,t,r,o){const s=ee(n,"x","maxPool"),i=1;let a=s,l=!1;s.rank===3&&(l=!0,a=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),K(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),K(Do(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ms("maxPool",r,o);const c={x:a},u={filterSize:e,strides:t,pad:r,dimRoundingMode:o},d=le.runKernel(k2,c,u);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const B6=me({maxPool_:Qse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jse(n,e=[1,1,1],t,r,o,s="NDHWC"){const i=ee(n,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=pe(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),K(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),K(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),ms("maxPool3d",r,o);const c={x:a},u={filterSize:e,strides:t,pad:r,dimRoundingMode:o,dataFormat:s},d=le.runKernel(S2,c,u);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const eie=me({maxPool3d_:Jse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tie(n,e){let t=ee(n,"a","maximum"),r=ee(e,"b","maximum");[t,r]=xr(t,r),t.dtype==="bool"&&(t=nt(t,"int32"),r=nt(r,"int32")),Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(p1,o)}const xu=me({maximum_:tie});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nie(n,e=null,t=!1){const o={x:ee(n,"x","mean")},s={axis:e,keepDims:t};return le.runKernel(N2,o,s)}const Sr=me({mean_:nie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qr(n,e="float32"){if(ic(n),e==="complex64"){const r=qr(n,"float32"),o=qr(n,"float32");return mf(r,o)}const t=To(De(n),e);return le.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vu(n,e="float32"){if(ic(n),e==="complex64"){const r=vu(n,"float32"),o=qr(n,"float32");return mf(r,o)}const t=M5(De(n),e);return le.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rie(n,e){let t=ee(n,"a","minimum"),r=ee(e,"b","minimum");[t,r]=xr(t,r),t.dtype==="bool"&&(t=nt(t,"int32"),r=nt(r,"int32")),Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(m1,o)}const mm=me({minimum_:rie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oie(n,e,t){K(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const r=ee(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");K(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const o=t==="reflect"?1:0;for(let a=0;a<r.rank;a++)K(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),K(e[a][0]>=0&&e[a][0]<=r.shape[a]-o&&e[a][1]>=0&&e[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);const s={paddings:e,mode:t},i={x:r};return le.runKernel(E2,i,s)}const sie=me({mirrorPad_:oie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iie(n,e){let t=ee(n,"a","mod"),r=ee(e,"b","mod");[t,r]=xr(t,r);const o={a:t,b:r};return le.runKernel(g1,o)}const aie=me({mod_:iie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lie(n,e=null,t=!1){n=ee(n,"x","moments");const r=Qt(e,n.shape),o=Sr(n,r,t);let s=o.shape;t||(s=Ir(o.shape,r));const i=Hn(_t(nt(n,"float32"),pe(o,s))),a=Sr(i,r,t);return{mean:o,variance:a}}const j6=me({moments_:lie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cie(n,e){let t=ee(n,"a","notEqual","string_or_numeric"),r=ee(e,"b","notEqual","string_or_numeric");[t,r]=xr(t,r),Ut(t.shape,r.shape);const o={a:t,b:r};return le.runKernel(R2,o)}const Kx=me({notEqual_:cie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uie(n,e,t=1,r=0,o="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:ee(n,"indices","oneHot","int32")},a={dtype:o,depth:e,onValue:t,offValue:r};return le.runKernel(A2,i,a)}const V$=me({oneHot_:uie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function die(n){const t={x:ee(n,"x","onesLike")};return le.runKernel(D2,t)}const $i=me({onesLike_:die});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hie(n,e,t=0){const r=ee(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:e,constantValue:t},s={x:r};return le.runKernel($2,s,o)}const V6=me({pad_:hie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fie(n,e,t){const r=ee(n,"x","spaceToBatchND");K(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),K(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),K(r.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const o={x:r},s={blockShape:e,paddings:t};return le.runKernel(W2,o,s)}const z6=me({spaceToBatchND_:fie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pie(n,e,t,r,o,s,i){o==null&&(o=[1,1]),s==null&&(s=1),r===0&&(r="valid");const a=ee(n,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),K(Do(s,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${o}'`);const u=Pi(l.shape,e,s,o,r),d=[u.dilationHeight,u.dilationWidth];let h;r==="same"?h=gie([u.filterHeight,u.filterWidth],d):h=[[0,0],[0,0]];const p=d[0]===1&&d[1]===1,[g,x]=mie([u.inHeight,u.inWidth],d,h),y=p?r:"valid",b=p?l:z6(l,d,g),S=(t==="avg"?()=>R6(b,e,s,y,i):()=>B6(b,e,s,y,i))(),k=p?S:D6(S,d,x);return c?pe(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function mie(n,e,t){const r=t.map(u=>u[0]),o=t.map(u=>u[1]),s=n.concat(r,o),i=e.map((u,d)=>(u-s[d]%u)%u),a=o.map((u,d)=>u+i[d]),l=e.map((u,d)=>[r[d],a[d]]),c=e.map((u,d)=>[0,i[d]]);return[l,c]}function gie(n,e){const r=n.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),o=r.map(i=>Math.floor(i/2)),s=r.map((i,a)=>i-o[a]);return r.map((i,a)=>[o[a],s[a]])}const xie=me({pool_:pie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vie(n,e){const t=ee(n,"x","prelu"),r=ee(e,"alpha","prelu"),o={x:t,alpha:r};return le.runKernel(F2,o)}const W6=me({prelu_:vie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yie(n,e=null,t=!1){let r=ee(n,"x","prod");r.dtype==="bool"&&(r=nt(r,"int32"));const o={x:r},s={axis:e,keepDims:t};return le.runKernel(P2,o,s)}const bie=me({prod_:yie});var ox={exports:{}},wie=ox.exports,uE;function Cie(){return uE||(uE=1,(function(n){(function(e,t,r){function o(l){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function s(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function i(l,c){var u=new o(l),d=c&&c.state,h=u.next;return h.int32=function(){return u.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}function a(){var l=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){l+=u.charCodeAt(d);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=i:this.alea=i})(wie,n)})(ox)),ox.exports}var sx={exports:{}},kie=sx.exports,dE;function Sie(){return dE||(dE=1,(function(n){(function(e,t,r){function o(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function s(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,g=(h+p)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.xor128=i})(kie,n)})(sx)),sx.exports}var ix={exports:{}},Nie=ix.exports,hE;function Iie(){return hE||(hE=1,(function(n){(function(e,t,r){function o(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function s(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,g=(h+p)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.xorwow=i})(Nie,n)})(ix)),ix.exports}var ax={exports:{}},Eie=ax.exports,fE;function Tie(){return fE||(fE=1,(function(n){(function(e,t,r){function o(a){var l=this;l.next=function(){var u=l.x,d=l.i,h,p;return h=u[d],h^=h>>>7,p=h^h<<24,h=u[d+1&7],p^=h^h>>>10,h=u[d+3&7],p^=h^h>>>3,h=u[d+4&7],p^=h^h<<7,h=u[d+7&7],h=h^h<<13,p^=h^h<<9,u[d]=p,l.i=d+1&7,p};function c(u,d){var h,p=[];if(d===(d|0))p[0]=d;else for(d=""+d,h=0;h<d.length;++h)p[h&7]=p[h&7]<<15^d.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],u.x=p,u.i=0,h=256;h>0;--h)u.next()}c(l,a)}function s(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,g=(h+p)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(u.x&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.xorshift7=i})(Eie,n)})(ax)),ax.exports}var lx={exports:{}},Rie=lx.exports,pE;function Die(){return pE||(pE=1,(function(n){(function(e,t,r){function o(a){var l=this;l.next=function(){var u=l.w,d=l.X,h=l.i,p,g;return l.w=u=u+1640531527|0,g=d[h+34&127],p=d[h=h+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,g=d[h]=g^p,l.i=h,g+(u^u>>>16)|0};function c(u,d){var h,p,g,x,y,b=[],C=128;for(d===(d|0)?(p=d,d=null):(d=d+"\0",p=0,C=Math.max(C,d.length)),g=0,x=-32;x<C;++x)d&&(p^=d.charCodeAt((x+32)%d.length)),x===0&&(y=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,x>=0&&(y=y+1640531527|0,h=b[x&127]^=p+y,g=h==0?g+1:0);for(g>=128&&(b[(d&&d.length||0)&127]=-1),g=127,x=512;x>0;--x)p=b[g+34&127],h=b[g=g+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,b[g]=p^h;u.w=y,u.X=b,u.i=g}c(l,a)}function s(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,g=(h+p)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(u.X&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.xor4096=i})(Rie,n)})(lx)),lx.exports}var cx={exports:{}},Aie=cx.exports,mE;function _ie(){return mE||(mE=1,(function(n){(function(e,t,r){function o(a){var l=this,c="";l.next=function(){var d=l.b,h=l.c,p=l.d,g=l.a;return d=d<<25^d>>>7^h,h=h-p|0,p=p<<24^p>>>8^g,g=g-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-p|0,l.d=p<<16^h>>>16^g,l.a=g-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function s(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,g=(h+p)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&s(u,c),d.state=function(){return s(c,{})}),d}t&&t.exports?t.exports=i:this.tychei=i})(Aie,n)})(cx)),cx.exports}var ux={exports:{}};const $ie={},Fie=Object.freeze(Object.defineProperty({__proto__:null,default:$ie},Symbol.toStringTag,{value:"Module"})),Pie=aj(Fie);var Mie=ux.exports,gE;function Oie(){return gE||(gE=1,(function(n){(function(e,t,r){var o=256,s=6,i=52,a="random",l=r.pow(o,s),c=r.pow(2,i),u=c*2,d=o-1,h;function p(k,N,E){var _=[];N=N==!0?{entropy:!0}:N||{};var $=b(y(N.entropy?[k,S(t)]:k??C(),3),_),T=new g(_),D=function(){for(var A=T.g(s),M=l,j=0;A<c;)A=(A+j)*o,M*=o,j=T.g(1);for(;A>=u;)A/=2,M/=2,j>>>=1;return(A+j)/M};return D.int32=function(){return T.g(4)|0},D.quick=function(){return T.g(4)/4294967296},D.double=D,b(S(T.S),t),(N.pass||E||function(A,M,j,L){return L&&(L.S&&x(L,T),A.state=function(){return x(T,{})}),j?(r[a]=A,M):A})(D,$,"global"in N?N.global:this==r,N.state)}function g(k){var N,E=k.length,_=this,$=0,T=_.i=_.j=0,D=_.S=[];for(E||(k=[E++]);$<o;)D[$]=$++;for($=0;$<o;$++)D[$]=D[T=d&T+k[$%E]+(N=D[$])],D[T]=N;(_.g=function(A){for(var M,j=0,L=_.i,U=_.j,G=_.S;A--;)M=G[L=d&L+1],j=j*o+G[d&(G[L]=G[U=d&U+M])+(G[U]=M)];return _.i=L,_.j=U,j})(o)}function x(k,N){return N.i=k.i,N.j=k.j,N.S=k.S.slice(),N}function y(k,N){var E=[],_=typeof k,$;if(N&&_=="object")for($ in k)try{E.push(y(k[$],N-1))}catch{}return E.length?E:_=="string"?k:k+"\0"}function b(k,N){for(var E=k+"",_,$=0;$<E.length;)N[d&$]=d&(_^=N[d&$]*19)+E.charCodeAt($++);return S(N)}function C(){try{var k;return h&&(k=h.randomBytes)?k=k(o):(k=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(k)),S(k)}catch{var N=e.navigator,E=N&&N.plugins;return[+new Date,e,E,e.screen,S(t)]}}function S(k){return String.fromCharCode.apply(0,k)}if(b(r.random(),t),n.exports){n.exports=p;try{h=Pie}catch{}}else r["seed"+a]=p})(typeof self<"u"?self:Mie,[],Math)})(ux)),ux.exports}var x3,xE;function Lie(){if(xE)return x3;xE=1;var n=Cie(),e=Sie(),t=Iie(),r=Tie(),o=Die(),s=_ie(),i=Oie();return i.alea=n,i.xor128=e,i.xorwow=t,i.xorshift7=r,i.xor4096=o,i.tychei=s,x3=i,x3}var U6=Lie();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z${constructor(e,t,r,o,s){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=s||Math.random();this.random=U6.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const o=this.nextVal;return this.nextVal=NaN,o}let e,t,r=!1;for(;!r;){let o,s,i;do o=2*this.random()-1,s=2*this.random()-1,i=o*o+s*s;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*a,t=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Bie{constructor(e=0,t=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=U6.alea(o)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(n,e=0,t=1,r,o){if(ic(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const s=new z$(e,t,r,!1,o),i=Zt(n,r);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}const Vie=me({randomNormal_:jie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zie(n,e=0,t=1,r="float32",o){ic(n);const s=Zt(n,r),i=new Bie(e,t,null,o);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}const B1=me({randomUniform_:zie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gm(n,e,t=1,r="float32"){if(t===0)throw new Error("Cannot have a step of zero");const o={start:n,stop:e,step:t,dtype:r};return le.runKernel(m6,{},o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wie(n){const t={input:ee(n,"input","real")};return le.runKernel(g6,t)}const Xx=me({real_:Wie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uie(n){const t={x:ee(n,"x","reciprocal")};return le.runKernel(y1,t)}const Hie=me({reciprocal_:Uie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gie(n){const t={x:ee(n,"x","relu")};return le.runKernel(b1,t)}const Bd=me({relu_:Gie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qie(n){const t={x:ee(n,"x","relu6")};return le.runKernel(w1,t)}const W$=me({relu6_:qie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kie(n,e){const r={x:ee(n,"x","reverse")},o={dims:e};return le.runKernel(B2,r,o)}const Sd=me({reverse_:Kie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xie(n){const t={x:ee(n,"x","round")};return le.runKernel(C1,t)}const U$=me({round_:Xie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(n){const t={x:ee(n,"x","rsqrt","float32")};return le.runKernel(k1,t)}const H$=me({rsqrt_:Yie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zie(n){const t={x:ee(n,"x","selu")};return le.runKernel(S1,t)}const G$=me({selu_:Zie});function Qie(n,e,t,r,o,s=[1,1],i="NHWC"){const a=ee(n,"x","separableConv2d"),l=ee(e,"depthwiseFilter","separableConv2d"),c=ee(t,"pointwiseFilter","separableConv2d");let u=a,d=!1;if(a.rank===3&&(d=!0,u=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");K(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),K(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),K(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),K(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),K(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const h=l.shape[2],p=l.shape[3];K(c.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`);const g=$6(u,l,r,o,i,s),y=Cd(g,c,1,"valid",i);return d?pe(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const q$=me({separableConv2d_:Qie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jie(n){const t={x:ee(n,"x","sign")};return le.runKernel(E1,t)}const eae=me({sign_:Jie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tae(n){const t={x:ee(n,"x","sin","float32")};return le.runKernel(N1,t)}const K$=me({sin_:tae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nae(n){const t={x:ee(n,"x","sinh")};return le.runKernel(I1,t)}const X$=me({sinh_:nae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(n,e,t){const r=ee(n,"x","slice1d");return K(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),jn(r,[e],[t])}const H6=me({slice1d_:rae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oae(n,e,t){const r=ee(n,"x","slice2d");return K(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),jn(r,e,t)}const Y$=me({slice2d_:oae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sae(n,e,t){const r=ee(n,"x","slice3d");return K(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),jn(r,e,t)}const G6=me({slice3d_:sae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(n,e,t){const r=ee(n,"x","slice4d");return K(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),jn(r,e,t)}const Yx=me({slice4d_:iae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aae(n,e=-1){const t=ee(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const r={logits:t},o={dim:e};return le.runKernel(H2,r,o)}const q6=me({softmax_:aae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(n){K(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return le.runKernel(o6,e)}const Z$=me({fft_:lae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(n){K(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return le.runKernel(a6,e)}const jC=me({ifft_:cae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uae(n){const e=n.shape[n.shape.length-1],t=n.size/e;let r;if(e<=2){const o=pe(n,[t,e]);r=jC(o)}else{const o=[t,2*(e-1)],s=pe(Xx(n),[t,e]),i=pe(M6(n),[t,e]),a=Sd(jn(s,[0,1],[t,e-2]),1),l=ae(Sd(jn(i,[0,1],[t,e-2]),1),Nn(-1)),c=ds([s,a],1),u=ds([i,l],1),d=pe(mf(c,u),[o[0],o[1]]);r=jC(d)}if(r=Xx(r),n.rank===3&&n.shape[0]!==0){const o=r,s=n.shape[0];r=pe(r,[s,r.shape[0]/s,r.shape[1]]),o.dispose()}return r}const dae=me({irfft_:uae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(n,e,t=0){const o={x:ee(n,"x","split")},s={numOrSizeSplits:e,axis:t};return le.runKernel(U2,o,s)}const ii=me({split_:hae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fae(n,e){K(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const r=n.size/t;let o;if(e!=null&&e<t){const g=n.shape.map(y=>0),x=n.shape.map(y=>y);x[n.shape.length-1]=e,o=jn(n,g,x),t=e}else if(e!=null&&e>t){const g=n.shape.map(x=>x);g[n.shape.length-1]=e-t,o=ds([n,qr(g)],n.shape.length-1),t=e}else o=n;const s=pn(o),i=pe(mf(o,s),[r,t]),a=Z$(i),l=Math.floor(t/2)+1,c=Xx(a),u=M6(a),d=ii(c,[l,t-l],c.shape.length-1),h=ii(u,[l,t-l],u.shape.length-1),p=o.shape.slice();return p[o.shape.length-1]=l,pe(mf(d[0],h[0]),p)}const pae=me({rfft_:fae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mae(n,e){let t=ee(n,"a","squaredDifference"),r=ee(e,"b","squaredDifference");[t,r]=xr(t,r),Ut(t.shape,r.shape);const o={a:t,b:r},s={};return le.runKernel(A1,o,s)}const gae=me({squaredDifference_:mae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xae(n,e){const t=ee(n,"x","squeeze","string_or_numeric");return pe(t,fu(t.shape,e).newShape)}const j1=me({squeeze_:xae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vae(n,e=0){const t=g$(n,"tensors","stack","string_or_numeric");K(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&K(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const r=t,o={axis:e};return le.runKernel(_2,r,o)}const Zl=me({stack_:vae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(n,e=0){const r={x:ee(n,"x","step")},o={alpha:e};return le.runKernel(M1,r,o)}const V1=me({step_:yae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bae(n,e,t,r,o=0,s=0,i=0,a=0,l=0){const u={x:ee(n,"x","stridedSlice","string_or_numeric")},d={begin:e,end:t,strides:r,beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return le.runKernel(w6,u,d)}const wae=me({stridedSlice_:bae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cae(n){const t={x:ee(n,"x","tan","float32")};return le.runKernel($1,t)}const kae=me({tan_:Cae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fs(n,e){I_(n);const t=Y2(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Z2(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v3(n,e,t){if(I_(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Y2(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Z2(n,e,r,t)}function Q$(n,e,t){const r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${o}.`;if(t.rank<o)throw new Error(s+` update.rank < ${o}. `);if(n.length<r+(t.rank-o))throw new Error(s+` Output shape length < ${r+(t.rank-o)}`);if(t.rank!==o+n.length-r)throw new Error(s+` update.rank != ${o+n.length-r}`);for(let i=0;i<o;++i)if(t.shape[i]!==e.shape[i])throw new Error(s+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-o;++i)if(t.shape[i+o]!==n[i+r])throw new Error(s+` updates.shape[${i+o}] (${t.shape[i+o]}) != shape[${i+o}] (${n[i+o]})`)}function Sae(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Q$(t,e,n)}function jd(n,e,t){const r=e.shape.length,o=r>1?e.shape[r-1]:1,s=t.length;let i=1;for(let d=o;d<s;++d)i*=t[d];const a=o<1?1:o,l=De(e.shape)/a,c=[...Nt(t.slice(0,o)),1],u=De(t);return{sliceRank:o,numUpdates:l,sliceSize:i,strides:c,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nae(n,e=1,t=!0){const r=ee(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const o=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${e}`);const s={x:r},i={k:e,sorted:t},[a,l]=le.runKernel(C6,s,i);return{values:a,indices:l}}const Iae=me({topk_:Nae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eae(n,e=0,t=1,r,o){if(ic(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const s=new z$(e,t,r,!0,o),i=Zt(n,r);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}const J$=me({truncatedNormal_:Eae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tae(n,e=0){const t=ee(n,"x","unique","string_or_numeric");K(t.rank>0,()=>"The input tensor must be at least 1D");const r={x:t},o={axis:e},[s,i]=le.runKernel(S6,r,o);return{values:s,indices:i}}const Rae=me({unique_:Tae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dae(n,e,t){const r=ee(n,"x","unsortedSegmentSum"),o=ee(e,"segmentIds","unsortedSegmentSum","int32");K(ff(t),()=>"numSegments must be of dtype int");const s={x:r,segmentIds:o},i={numSegments:t};return le.runKernel(q2,s,i)}const eF=me({unsortedSegmentSum_:Dae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aae(n,e=0){const t=ee(n,"x","unstack","string_or_numeric");K(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const r={value:t},o={axis:e};return le.runKernel(G2,r,o)}const Nd=me({unstack_:Aae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ae(n,e=!0,t,r){return le.makeVariable(n,e,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tF(n,e){const t=[];for(let s=0;s<e.length;s++)e[s]&&t.push(s);const r=Zt(n,"int32"),o=Zt([t.length,n.length],"int32");for(let s=0;s<t.length;s++){const i=r.indexToLoc(t[s]),a=s*n.length;o.values.set(i,a)}return o.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ae(n,e,t){const r=ee(n,"x","transpose");if(e==null&&(e=r.shape.map((i,a)=>a).reverse()),K(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(i=>{K(i>=0&&i<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const o={x:r},s={perm:e};return r.dtype==="complex64"?ve(()=>{let i=Xx(r),a=M6(r);return i=le.runKernel(nf,{x:i},s),a=le.runKernel(nf,{x:a},s),t&&(a=gr(a)),mf(i,a)}):le.runKernel(nf,o,s)}const fn=me({transpose_:$ae});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fae(n,e){if(e==null)return n.shape.slice();if(In(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pae(n,e,t,r){const o=ee(n,"x","dropout");if(K(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),K(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof _r?o.clone():o;const s=Fae(o,t),i=1-e,a=Et(ry(Ue(B1(s,0,1,"float32",r),i)),i);return ae(o,a)}const Mae=me({dropout_:Pae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oae(n,e,t,r,o,s="NHWC",i){let a=n;n.rank===3&&(a=pe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),K(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),K(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),K(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const c=s==="NHWC"?a.shape[3]:a.shape[1],u=s==="NHWC"?l.shape[3]:l.shape[1];K(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),K(u===t[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${t[3]}).`),ms("conv2dDerFilter",o,i);const d={x:a,dy:l},h={strides:r,pad:o,dataFormat:s,dimRoundingMode:i,filterShape:t};return le.runKernel(q5,d,h)}const K6=me({conv2DBackpropFilter_:Oae});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X6(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return ae(n,V1(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function Y6(n,e){let t=e;const r=Lr(n.shape,e.shape);return r.length>0&&(t=It(t,r)),pe(t,n.shape)}function Z6(n,e,t,r){if(e==="linear")return n;if(e==="relu")return Bd(n);if(e==="elu")return ty(n);if(e==="relu6")return W$(n);if(e==="prelu")return W6(n,t);if(e==="leakyrelu")return O6(n,r);if(e==="sigmoid")return Mf(n);throw new Error(`Unknown fused activation ${e}.`)}const Q6=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lae({x:n,filter:e,strides:t,pad:r,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",Q6(le.state.gradientDepth,l)===!1){K(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let E=Cd(n,e,t,r,o,s,i);return a!=null&&(E=Ue(E,a)),Z6(E,l,c,u)}const d=ee(n,"x","conv2d","float32"),h=ee(e,"filter","conv2d","float32");let p=d,g=!1;d.rank===3&&(g=!0,p=pe(d,[1,d.shape[0],d.shape[1],d.shape[2]])),K(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),K(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),ms("fused conv2d",r,i);const x=o==="NHWC"?p.shape[3]:p.shape[1];K(h.shape[2]===x,()=>`Error in conv2d: depth of input (${x}) must match input depth for filter ${h.shape[2]}.`),K(Do(t,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`);const y=po(p.shape,h.shape,t,s,r,i);let b;a!=null&&(b=ee(a,"bias","fused conv2d"),[b]=xr(b,d),o==="NHWC"?Ut(y.outShape,b.shape):(K(b.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`),K(b.shape.length===0||b.shape[0]===y.outChannels||b.shape[0]===1,()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${y.outChannels})`)));let C;if(c!=null){const E=c.shape;if(K(E.length<=1||E.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${E.length}.`),E.length===1)K(E[0]===1||E[0]===y.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${E}) is not compatible with the number of output channels (${y.outChannels}).`);else if(E.length===3)try{Ut(E,y.outShape)}catch{const $=`Error in fused conv2d: PReLU activation weights (${E}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error($)}C=ee(c,"prelu weights","fused conv2d")}const S=(E,_)=>{K(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);const[$,T,D,A]=_,M=X6(E,D,l);K(bd(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const j=A6(T.shape,M,$,t,r),L=K6(T,M,$.shape,t,r),U=[j,L];if(A!=null){const G=Y6(A,M);U.push(G)}return U},k={x:p,filter:h,bias:b,preluActivationWeights:C},N={strides:t,pad:r,dataFormat:o,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:u};return a==null?xf((_,$,T)=>{let D=le.runKernel(Wx,k,N);return T([$,_,D]),g&&(D=pe(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:S}})(p,h):xf((_,$,T,D)=>{let A=le.runKernel(Wx,k,N);return D([$,_,A,T]),g&&(A=pe(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:S}})(p,h,b)}const Bae=me({fusedConv2d_:Lae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(n,e,t,r,o,s=[1,1],i){let a=n;n.rank===3&&(a=pe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:r,pad:o,dimRoundingMode:i,dilations:s,filterShape:t};return le.runKernel(e6,c,u)}const Vae=me({depthwiseConv2dNativeBackpropFilter_:jae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zae(n,e,t,r,o,s=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:t},u={strides:r,pad:o,dimRoundingMode:i,dilations:s,inputShape:n},d=le.runKernel(t6,c,u);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Wae=me({depthwiseConv2dNativeBackpropInput_:zae});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uae({a:n,b:e,transposeA:t=!1,transposeB:r=!1,bias:o,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(Q6(le.state.gradientDepth,s)===!1){let A=Sn(n,e,t,r);return o!=null&&(A=Ue(A,o)),Z6(A,s,i,a)}let l=ee(n,"a","fused matMul"),c=ee(e,"b","fused matMul");[l,c]=xr(l,c);const u=t?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=t?l.shape[l.rank-1]:l.shape[l.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],g=l.shape.slice(0,-2),x=c.shape.slice(0,-2),y=De(g),b=De(x);K(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${t} and transposeB=${r} must match.`);const S=Ut(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),k=t?pe(l,[y,u,h]):pe(l,[y,h,u]),N=r?pe(c,[b,p,d]):pe(c,[b,d,p]);let E;o!=null&&(E=ee(o,"bias","fused matMul"),[E]=xr(E,l),Ut(S,E.shape));let _;i!=null&&(_=ee(i,"prelu weights","fused matMul"));const $=(A,M)=>{const[j,L,U,G]=M,H=X6(pe(A,U.shape),U,s);let O,V;if(!t&&!r?(O=Sn(H,L,!1,!0),V=Sn(j,H,!0,!1)):!t&&r?(O=Sn(H,L,!1,!1),V=Sn(H,j,!0,!1)):t&&!r?(O=Sn(L,H,!1,!0),V=Sn(j,H,!1,!1)):(O=Sn(L,H,!0,!0),V=Sn(H,j,!0,!0)),o!=null){const W=Y6(G,H);return[O,V,W]}else return[O,V]},T={a:k,b:N,bias:E,preluActivationWeights:_},D={transposeA:t,transposeB:r,activation:s,leakyreluAlpha:a};return o==null?xf((M,j,L)=>{const U=le.runKernel(zx,T,D);return L([M,j,U]),{value:pe(U,S),gradFunc:$}})(k,N):xf((M,j,L,U)=>{const G=le.runKernel(zx,T,D);return U([M,j,G,L]),{value:pe(G,S),gradFunc:$}})(k,N,E)}const vE=me({fusedMatMul_:Uae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hae(n,e,t,r,o="bilinear",s=0){const i=ee(n,"image","cropAndResize"),a=ee(e,"boxes","cropAndResize","float32"),l=ee(t,"boxInd","cropAndResize","int32"),c=a.shape[0];K(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),K(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),K(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),K(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),K(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),K(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);const u={image:i,boxes:a,boxInd:l},d={method:o,extrapolationValue:s,cropSize:r};return le.runKernel(Z5,u,d)}const Gae=me({cropAndResize_:Hae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(n){const e=ee(n,"image","flipLeftRight","float32");K(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return le.runKernel(i6,t,{})}const Kae=me({flipLeftRight_:qae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(n){const e=ee(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];K(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),K(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const o=new Array(e.rank);return o.fill(1,0,t),o[t]=3,ia(e,o)}const Yae=me({grayscaleToRGB_:Xae});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zae(n){const e=ee(n,"image","RGBToGrayscale"),t=e.rank-1,r=e.shape[t];K(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),K(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const o=e.dtype,s=nt(e,"float32"),i=Fs([.2989,.587,.114]);let a;switch(e.rank){case 2:a=$p("ij,j->i",s,i);break;case 3:a=$p("ijk,k->ij",s,i);break;case 4:a=$p("ijkl,l->ijk",s,i);break;case 5:a=$p("ijklm,m->ijkl",s,i);break;case 6:a=$p("ijklmn,n->ijklm",s,i);break;default:throw new Error("Not a valid tensor rank.")}return a=cs(a,-1),nt(a,o)}const Qae=me({rgbToGrayscale_:Zae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jae(n,e,t=0,r=.5){const o=ee(n,"image","rotateWithOffset","float32");K(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);const s={image:o},i={radians:e,fillValue:t,center:r};return le.runKernel(N6,s,i)}const ele=me({rotateWithOffset_:Jae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lf(n,e,t,r,o,s){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),s==null&&(s=0);const i=n.shape[0];return t=Math.min(t,i),K(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),K(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),K(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),K(e.rank===1,()=>"scores must be a 1D tensor"),K(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),K(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:t,iouThreshold:r,scoreThreshold:o,softNmsSigma:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tle(n,e,t,r=.5,o=Number.NEGATIVE_INFINITY){const s=ee(n,"boxes","nonMaxSuppression","float32"),i=ee(e,"scores","nonMaxSuppression","float32"),a=Lf(s,i,t,r,o);t=a.maxOutputSize,r=a.iouThreshold,o=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:r,scoreThreshold:o};return le.runKernel(h6,{boxes:s,scores:i},l)}const nle=me({nonMaxSuppression_:tle});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rle(n,e,t){const r=ole(n,e,t),o=r<0?-(r+1):r;n.splice(o,0,e)}function ole(n,e,t){return ile(n,e,t||sle)}function sle(n,e){return n>e?1:n<e?-1:0}function ile(n,e,t){let r=0,o=n.length,s=0,i=!1;for(;r<o;){s=r+(o-r>>>1);const a=t(e,n[s]);a>0?r=s+1:(o=s,i=!a)}return i?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(n,e,t,r,o){return nk(n,e,t,r,o,0)}function ek(n,e,t,r,o,s){return nk(n,e,t,r,o,0,!1,s,!0)}function tk(n,e,t,r,o,s){return nk(n,e,t,r,o,s,!0)}function nk(n,e,t,r,o,s,i=!1,a=!1,l=!1){const c=[];for(let y=0;y<e.length;y++)e[y]>o&&c.push({score:e[y],boxIndex:y,suppressBeginIndex:0});c.sort(yE);const u=s>0?-.5/s:0,d=[],h=[];for(;d.length<t&&c.length>0;){const y=c.pop(),{score:b,boxIndex:C,suppressBeginIndex:S}=y;if(b<o)break;let k=!1;for(let N=d.length-1;N>=S;--N){const E=ale(n,C,d[N]);if(E>=r){k=!0;break}if(y.score=y.score*lle(r,u,E),y.score<=o)break}y.suppressBeginIndex=d.length,k||(y.score===b?(d.push(C),h.push(y.score)):y.score>o&&rle(c,y,yE))}const p=d.length,g=t-p;a&&g>0&&(d.push(...new Array(g).fill(0)),h.push(...new Array(g).fill(0)));const x={selectedIndices:d};return i&&(x.selectedScores=h),l&&(x.validOutputs=p),x}function ale(n,e,t){const r=n.subarray(e*4,e*4+4),o=n.subarray(t*4,t*4+4),s=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),p=(a-s)*(l-i),g=(d-c)*(h-u);if(p<=0||g<=0)return 0;const x=Math.max(s,c),y=Math.max(i,u),b=Math.min(a,d),C=Math.min(l,h),S=Math.max(b-x,0)*Math.max(C-y,0);return S/(p+g-S)}function lle(n,e,t){const r=Math.exp(e*t*t);return t<=n?r:0}function yE(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function cle(n,e,t,r=.5,o=Number.NEGATIVE_INFINITY){const s=ee(n,"boxes","nonMaxSuppressionAsync"),i=ee(e,"scores","nonMaxSuppressionAsync"),a=Lf(s,i,t,r,o);t=a.maxOutputSize,r=a.iouThreshold,o=a.scoreThreshold;const l=await Promise.all([s.data(),i.data()]),c=l[0],u=l[1],{selectedIndices:d}=J6(c,u,t,r,o);return s!==n&&s.dispose(),i!==e&&i.dispose(),Fs(d,"int32")}const ule=cle;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dle(n,e,t,r=.5,o=Number.NEGATIVE_INFINITY,s=0){const i=ee(n,"boxes","nonMaxSuppression"),a=ee(e,"scores","nonMaxSuppression"),l=Lf(i,a,t,r,o,s);t=l.maxOutputSize,r=l.iouThreshold,o=l.scoreThreshold,s=l.softNmsSigma;const c={boxes:i,scores:a},u={maxOutputSize:t,iouThreshold:r,scoreThreshold:o,softNmsSigma:s},d=le.runKernel(p6,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}const hle=me({nonMaxSuppressionWithScore_:dle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function fle(n,e,t,r=.5,o=Number.NEGATIVE_INFINITY,s=0){const i=ee(n,"boxes","nonMaxSuppressionAsync"),a=ee(e,"scores","nonMaxSuppressionAsync"),l=Lf(i,a,t,r,o,s);t=l.maxOutputSize,r=l.iouThreshold,o=l.scoreThreshold,s=l.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),u=c[0],d=c[1],{selectedIndices:h,selectedScores:p}=tk(u,d,t,r,o,s);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Fs(h,"int32"),selectedScores:Fs(p)}}const ple=fle;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(n,e,t,r=.5,o=Number.NEGATIVE_INFINITY,s=!1){const i=ee(n,"boxes","nonMaxSuppression"),a=ee(e,"scores","nonMaxSuppression"),l=Lf(i,a,t,r,o,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h={boxes:i,scores:a},p={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:s},g=le.runKernel(f6,h,p);return{selectedIndices:g[0],validOutputs:g[1]}}const gle=me({nonMaxSuppressionPadded_:mle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function xle(n,e,t,r=.5,o=Number.NEGATIVE_INFINITY,s=!1){const i=ee(n,"boxes","nonMaxSuppressionAsync"),a=ee(e,"scores","nonMaxSuppressionAsync"),l=Lf(i,a,t,r,o,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:g,validOutputs:x}=ek(h,p,c,u,d,s);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Fs(g,"int32"),validOutputs:Nn(x,"int32")}}const vle=xle;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yle(n,e,t=!1,r=!1){const o=ee(n,"images","resizeBilinear");K(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),K(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),K(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const a={images:s},l={alignCorners:t,halfPixelCenters:r,size:e},c=le.runKernel(L2,a,l);return i?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const nF=me({resizeBilinear_:yle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ble(n,e,t=!1,r=!1){const o=ee(n,"images","resizeNearestNeighbor");K(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),K(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),K(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),K(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const a={images:s},l={alignCorners:t,halfPixelCenters:r,size:e},c=le.runKernel(O2,a,l);return i?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const rF=me({resizeNearestNeighbor_:ble});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wle(n,e="binary",t=!1,r=.5){const o=ee(n,"image","threshold"),s=.2989,i=.587,a=.114,l=o.shape[0]*o.shape[1];let c=ae(Fs([r]),255),u,d,h,p;if(K(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),K(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),K(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),K(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),o.shape[2]===3){[u,d,h]=ii(o,[1,1,1],-1);const y=ae(u,s),b=ae(d,i),C=ae(h,a);p=Ue(Ue(y,b),C)}else p=n;if(e==="otsu"){const y=voe(nt(U$(p),"int32"),x$([]),256);c=Cle(y,l)}const g=t?Of(p,c):ui(p,c);return nt(ae(g,255),"int32")}function Cle(n,e){let t=Fs([-1]),r=Fs([0]),o=Fs([0]),s,i,a,l,c,u;for(let d=0;d<n.size-1;d++){s=jn(n,0,d+1),i=jn(n,d+1),c=Et(It(s),e),u=Et(It(i),e);const h=It(ae(s,gm(0,s.size)));a=Et(h,It(s));const p=ey(i.shape,s.size),g=Ue(gm(0,i.size),p),x=ae(i,g);l=Et(It(x),It(i));const y=_t(a,l),b=_t(a,l),C=ae(c,u);o=ae(ae(C,y),b);const S=ui(o,r);r=Zo(S,o,r),t=Zo(S,Fs([d]),t)}return t}const kle=me({threshold_:wle});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(n,e,t="nearest",r="constant",o=0,s){const i=ee(n,"image","transform","float32"),a=ee(e,"transforms","transform","float32");K(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),K(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),K(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);const l={image:i,transforms:a},c={interpolation:t,fillMode:r,fillValue:o,outputShape:s};return le.runKernel(k6,l,c)}const Nle=me({transform_:Sle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(n,e,t){const r=ee(n,"a","bandPart");K(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const o=r.shape,[s,i]=r.shape.slice(-2);let a,l;typeof e=="number"?(K(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),K(e<=s,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`),a=ee(e<0?s:e,"numLower","bandPart")):(K(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Zo(qx(e,0),s,mm(e,s))),typeof t=="number"?(K(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),K(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),l=ee(t<0?i:t,"numUpper","bandPart")):(K(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Zo(qx(t,0),i,mm(t,i)));const c=pe(gm(0,s,1,"int32"),[-1,1]),u=gm(0,i,1,"int32"),d=_t(c,u),h=Yl(Of(d,a),Ld(d,gr(l))),p=qr([s,i],r.dtype);return pe(Zl(Nd(pe(r,[-1,s,i])).map(g=>Zo(h,g,p))),o)}const Ele=me({bandPart_:Ile});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(n){let e;if(Array.isArray(n)){e=!1,K(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const o=n[0].shape[0];for(let s=1;s<n.length;++s)K(n[s].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[s].shape[0]} vs. ${o})`)}else e=!0,n=ii(n,n.shape[0],0).map(o=>j1(o,[0]));K(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],r=n;for(let o=0;o<n.length;++o)t.push(le.tidy(()=>{let s=r[o];if(o>0)for(let i=0;i<o;++i){const a=ae(It(ae(t[i],s)),t[i]);s=_t(s,a)}return Et(s,ny(s,"euclidean"))}));return e?Zl(t,0):t}const Rle=me({gramSchmidt_:Tle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dle(n,e=!1){if(K(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return bE(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),r=Nd(pe(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],s=[];r.forEach(l=>{const[c,u]=bE(l,e);o.push(c),s.push(u)});const i=pe(Zl(o,0),n.shape),a=pe(Zl(s,0),n.shape);return[i,a]}}function bE(n,e=!1){return le.tidy(()=>{K(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],r=n.shape[1];let o=M$(t),s=cd(n);const i=v3([[1]],[1,1]);let a=cd(i);const l=t>=r?r:t;for(let c=0;c<l;++c){const u=s,d=a,h=o;[a,s,o]=le.tidy(()=>{const p=jn(s,[c,c],[t-c,1]),g=ny(p),x=jn(s,[c,c],[1,1]),y=Zo(ui(x,0),v3([[-1]]),v3([[1]])),b=_t(x,ae(y,g)),C=Et(p,b);C.shape[0]===1?a=cd(i):a=ds([i,jn(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const S=gr(Et(Sn(y,b),g)),k=jn(s,[c,0],[t-c,r]),N=ae(S,a),E=fn(a);if(c===0)s=_t(k,Sn(N,Sn(E,k)));else{const T=_t(k,Sn(N,Sn(E,k)));s=ds([jn(s,[0,0],[c,r]),T],0)}const _=fn(N),$=jn(o,[0,c],[t,o.shape[1]-c]);if(c===0)o=_t($,Sn(Sn($,a),_));else{const T=_t($,Sn(Sn($,a),_));o=ds([jn(o,[0,0],[t,c]),T],1)}return[a,s,o]}),rn([u,d,h])}return!e&&t>r&&(o=jn(o,[0,0],[t,r]),s=jn(s,[0,0],[r,r])),[o,s]})}const Ale=me({qr_:Dle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hl={flipLeftRight:Kae,grayscaleToRGB:Yae,resizeNearestNeighbor:rF,resizeBilinear:nF,rgbToGrayscale:Qae,rotateWithOffset:ele,cropAndResize:Gae,nonMaxSuppression:nle,nonMaxSuppressionAsync:ule,nonMaxSuppressionWithScore:hle,nonMaxSuppressionWithScoreAsync:ple,nonMaxSuppressionPadded:gle,nonMaxSuppressionPaddedAsync:vle,threshold:kle,transform:Nle},_le={bandPart:Ele,gramSchmidt:Rle,qr:Ale};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $le=new Map,Fle=new Map;class Bf{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Ti{constructor(){this.classNameMap={}}static getMap(){return Ti.instance==null&&(Ti.instance=new Ti),Ti.instance}static register(e){Ti.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Le(n,e,t){K(n.className!=null,()=>"Class being registered does not have the static className property defined."),K(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),K(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const r=t,o=e+">"+r;return Ti.register(n),$le.set(o,n),Fle.set(n,o),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yu extends Bf{minimize(e,t=!1,r){const{value:o,grads:s}=this.computeGradients(e,r);if(r!=null){const i=r.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(i)}else this.applyGradients(s);return rn(s),t?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return Bse(e,t)}dispose(){this.iterations_!=null&&rn(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Nn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(yu,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oF extends yu{static get className(){return"Adadelta"}constructor(e,t,r=null){super(),this.learningRate=e,this.rho=t,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=le.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,o)=>{const s=le.registeredVariables[r],i=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${r}/accum_grad`,variable:ve(()=>pn(s).variable(i))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${r}/accum_var`,variable:ve(()=>pn(s).variable(i))});const a=Array.isArray(e)?e[o].tensor:e[r];if(a==null)return;const l=this.accumulatedGrads[o].variable,c=this.accumulatedUpdates[o].variable;ve(()=>{const u=Ue(ae(l,this.rho),ae(Hn(a),1-this.rho)),d=ae(Et(Ro(Ue(c,this.epsilon)),Ro(Ue(l,this.epsilon))),a),h=Ue(ae(c,this.rho),ae(Hn(d),1-this.rho));l.assign(u),c.assign(h);const p=Ue(ae(d,-this.learningRate),s);s.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(rn(this.accumulatedGrads.map(e=>e.variable)),rn(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,t).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedUpdates=e.slice(t,t*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sF extends yu{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,o)=>{const s=le.registeredVariables[r];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${r}/accumulator`,variable:ve(()=>ey(s.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[o].tensor:e[r];if(i==null)return;const a=this.accumulatedGrads[o].variable;ve(()=>{const l=Ue(a,Hn(i));a.assign(l);const c=Ue(ae(Et(i,Ro(Ue(l,le.backend.epsilon()))),-this.learningRate),s);s.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&rn(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iF extends yu{static get className(){return"Adam"}constructor(e,t,r,o=null){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ve(()=>{this.accBeta1=Nn(t).variable(),this.accBeta2=Nn(r).variable()}),o==null&&(this.epsilon=le.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);ve(()=>{const r=_t(1,this.accBeta1),o=_t(1,this.accBeta2);t.forEach((s,i)=>{const a=le.registeredVariables[s],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:ve(()=>pn(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${s}/v`,variable:ve(()=>pn(a).variable(l))});const c=Array.isArray(e)?e[i].tensor:e[s];if(c==null)return;const u=this.accumulatedFirstMoment[i].variable,d=this.accumulatedSecondMoment[i].variable,h=Ue(ae(u,this.beta1),ae(c,1-this.beta1)),p=Ue(ae(d,this.beta2),ae(Hn(c),1-this.beta2)),g=Et(h,r),x=Et(p,o);u.assign(h),d.assign(p);const y=Ue(ae(Et(g,Ue(Ro(x),this.epsilon)),-this.learningRate),a);a.assign(y)}),this.accBeta1.assign(ae(this.accBeta1,this.beta1)),this.accBeta2.assign(ae(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&rn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&rn(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ve(()=>{this.accBeta1.assign(kd(this.beta1,this.iterations_+1)),this.accBeta2.assign(kd(this.beta2,this.iterations_+1))});const t=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,t).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aF extends yu{static get className(){return"Adamax"}constructor(e,t,r,o=null,s=0){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=o,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ve(()=>{this.iteration=Nn(0).variable(),this.accBeta1=Nn(t).variable()}),o==null&&(this.epsilon=le.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);ve(()=>{const r=_t(1,this.accBeta1),o=Et(-this.learningRate,Ue(ae(this.iteration,this.decay),1));t.forEach((s,i)=>{const a=le.registeredVariables[s],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:pn(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${s}/v`,variable:pn(a).variable(l)});const c=Array.isArray(e)?e[i].tensor:e[s];if(c==null)return;const u=this.accumulatedFirstMoment[i].variable,d=this.accumulatedWeightedInfNorm[i].variable,h=Ue(ae(u,this.beta1),ae(c,1-this.beta1)),p=ae(d,this.beta2),g=Wo(c),x=xu(p,g);u.assign(h),d.assign(x);const y=Ue(ae(Et(o,r),Et(h,Ue(x,this.epsilon))),a);a.assign(y)}),this.iteration.assign(Ue(this.iteration,1)),this.accBeta1.assign(ae(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&rn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&rn(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rk extends yu{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,o)=>{const s=Array.isArray(e)?e[o].tensor:e[r];if(s==null)return;const i=le.registeredVariables[r];ve(()=>{const a=Ue(ae(this.c,s),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=rl(Nn(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lF extends rk{static get className(){return"Momentum"}constructor(e,t,r=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=r,this.accumulations=[],this.m=Nn(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,o)=>{const s=le.registeredVariables[r];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${r}/momentum`,variable:ve(()=>pn(s).variable(!1))});const i=this.accumulations[o].variable,a=Array.isArray(e)?e[o].tensor:e[r];a!=null&&ve(()=>{let l;const c=Ue(ae(this.m,i),a);this.useNesterov?l=Ue(ae(this.c,Ue(a,ae(c,this.m))),s):l=Ue(ae(this.c,c),s),i.assign(c),s.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&rn(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cF extends yu{static get className(){return"RMSProp"}constructor(e,t=.9,r=0,o=null,s=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=r,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,o==null&&(this.epsilon=le.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,o)=>{const s=le.registeredVariables[r],i=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${r}/rms`,variable:ve(()=>pn(s).variable(i))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${r}/momentum`,variable:ve(()=>pn(s).variable(i))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${r}/mg`,variable:ve(()=>pn(s).variable(i))});const a=Array.isArray(e)?e[o].tensor:e[r];if(a==null)return;const l=this.accumulatedMeanSquares[o].variable,c=this.accumulatedMoments[o].variable;ve(()=>{const u=Ue(ae(l,this.decay),ae(Hn(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[o].variable,h=Ue(ae(d,this.decay),ae(a,1-this.decay)),p=Et(ae(a,this.learningRate),Ro(_t(u,Ue(Hn(h),this.epsilon)))),g=Ue(ae(c,this.momentum),p);l.assign(u),d.assign(h),c.assign(g);const x=_t(s,g);s.assign(x)}else{const d=Ue(ae(l,this.decay),ae(Hn(a),1-this.decay)),h=Ue(ae(c,this.momentum),Et(ae(a,this.learningRate),Ro(Ue(d,this.epsilon))));l.assign(d),c.assign(h);const p=_t(s,h);s.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&rn(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&rn(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&rn(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,t).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedMoments=e.slice(t,t*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ple=[oF,sF,iF,aF,lF,cF,rk];function Mle(){for(const n of Ple)Le(n)}function ok(n,e){const t=n.shape.length,r=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${t}`);if(De(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const o=e.shape,s=o[o.length-1];let i=1;for(let d=0;d<o.length-1;++d)i*=o[d];const a=n.shape,l=o.slice();l.pop();let c=1;for(let d=s;d<t;++d)c*=a[d],l.push(a[d]);const u=[...Nt(n.shape).map(d=>d/c),1].slice(0,s);return[l,i,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VC=-2,Ole=-1;function sk(n,e,t){const r=n.shape.length;K(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),K(r===t.length,()=>`Error in slice${r}D: Length of size ${t} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)K(e[o]+t[o]<=n.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${e[o]+t[o]}) would overflow input.shape[${o}] (${n.shape[o]})`)}function Lle(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function ik(n,e,t){const r=[];for(let o=0;o<n.length;o++)r[o]=Math.ceil((e[o]-n[o])/t[o]);return r}function uF(n,e,t,r){const o=[...n];for(let s=o.length;s<r.length;s++)o.push(1);for(let s=0;s<t;s++)s===0?o[e]=1:(o.splice(e,0,1),o.pop());return o}function dF(n,e,t){return t<=n?t:t-(e-1)}function hF(n,e){const t=[];for(let r=0;r<n;r++)t.push(e+r);return t}function Ble(n,e,t,r,o,s,i,a,l){const c=n.length;let u=new Array(c),d=new Array(c),h=new Array(c);if(e.length&&t>0){const p=e[0],g=t+1;u=fF(i,p,g,r,n),d=pF(a,p,g,o,n),h=uF(s,p,g,n)}else for(let p=0;p<c;p++)u[p]=gF(i,r,s,n,p,l),d[p]=xF(a,o,s,n,p,l),h[p]=mF(s,p,l);return{begin:u,end:d,strides:h}}function fF(n,e,t,r,o){const s=[...o],i=hF(t,e);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=0;else{const l=dF(e,t,a);let c=r[l];n&1<<l&&(c=0),s[a]=c}return s}function pF(n,e,t,r,o){const s=[...o],i=hF(t,e);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const l=dF(e,t,a);let c=r[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),s[a]=c}for(let a=0;a<s.length;a++){const l=o[a];s[a]<0&&(s[a]+=l),s[a]=gd(0,s[a],o[a])}return s}function mF(n,e,t){let r=n[e];return(t&1<<e||r==null)&&(r=1),r}function gF(n,e,t,r,o,s){let i=e[o];const a=t[o]||1;(n&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=r[o];return i<0&&(i+=l),i=gd(0,i,l-1),i}function xF(n,e,t,r,o,s){let i=e[o];const a=t[o]||1;(n&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=r[o];return i<0&&(i+=l),a>0?i=gd(0,i,l):i=gd(-1,i,l-1),i}function ak(n,e,t){let r=t.length;for(let o=0;o<t.length;o++)if(t[o]>1){r=o;break}for(let o=r+1;o<t.length;o++)if(e[o]>0||t[o]!==n[o])return!1;return!0}function lk(n,e){let t=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function oy(n,e,t){let r;const o=n.shape.length;typeof e=="number"?r=[e,...new Array(o-1).fill(0)]:e.length<o?r=e.concat(new Array(o-e.length).fill(0)):r=e.slice(),r.forEach(i=>{K(i!==-1,()=>"slice() does not support negative begin indexing.")});let s;return t==null?s=new Array(o).fill(-1):typeof t=="number"?s=[t,...new Array(o-1).fill(-1)]:t.length<o?s=t.concat(new Array(o-t.length).fill(-1)):s=t,s=s.map((i,a)=>i>=0?i:(K(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-r[a])),[r,s]}function ck(n,e,t,r,o,s,i,a,l){let c;if(r==null?(c=new Array(e.length),c.fill(1)):c=r,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let S=0;S<d.dims;S++)u&&(1<<S&a)!==0&&d.numAddAxisAfterEllipsis++,1<<S&i&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};jle(d,h);let p=!0,g=!0,x=!0;const y=[],b=[];for(let S=0;S<n.length;++S){if(h.strides[S]===0)throw Error(`strides[${S}] must be non-zero`);const k=!!(h.shrinkAxisMask&1<<S),N=n[S];if(N===-1){y.push(k?1:-1);continue}const E=[h.beginMask&1<<S,h.endMask&1<<S],_=[h.strides[S]>0?0:-1,h.strides[S]>0?N:N-1];if(k&&h.strides[S]<=0)throw Error("only stride 1 allowed on non-range indexing.");x=x&&h.strides[S]===1;const $=!!(h.beginMask&1<<S&&h.endMask&1<<S);if(h.beginValid&&h.endValid){if(k){const M=h.begin[S]<0?N+h.begin[S]:h.begin[S];if(h.begin[S]=M,h.end[S]=h.begin[S]+1,M<0||M>=N)throw Error(`slice index ${h.begin[S]} of dimension ${S} out of bounds.`)}else h.begin[S]=wE(h.begin[S],0,h.strides[S],N,E,_),h.end[S]=wE(h.end[S],1,h.strides[S],N,E,_);const A=h.strides[S]===1&&h.begin[S]===0&&h.end[S]===N;p=p&&A,g=g&&(S===0&&h.strides[S]===1||A)}else p=p&&h.strides[S]===1&&$,g=g&&(S===0&&h.strides[S]===1||$);let T,D=!1;if(h.beginValid&&h.endValid?(T=h.end[S]-h.begin[S],D=!0):k?(T=1,D=!0):$&&N>=0&&(h.strides[S]<0?T=-N:T=N,D=!0),D){let A;T===0||T<0!=h.strides[S]<0?A=0:A=Math.trunc(T/h.strides[S])+(T%h.strides[S]!==0?1:0),y.push(A)}else y.push(-1)}for(let S=0;S<h.finalShapeGatherIndices.length;++S){const k=h.finalShapeGatherIndices[S];k>=0?b.push(y[k]):k===VC&&b.push(1)}return{finalShapeSparse:b.filter((S,k)=>h.finalShapeGatherIndices[k]!==VC),finalShape:b,isIdentity:p,sliceDim0:g,isSimpleSlice:x,begin:h.begin,end:h.end,strides:h.strides}}function jle(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){const o=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<o;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r}else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(VC),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(Ole),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function wE(n,e,t,r,o,s){if(o[e])return t>0?s[e]:s[e+1&1];{const i=n<0?r+n:n;return i<s[0]?s[0]:i>s[1]?s[1]:i}}const Vle=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:sk,computeFlatOffset:lk,computeOutShape:ik,getNormalizedAxes:Ble,isSliceContinous:ak,maskToAxes:Lle,parseSliceParams:oy,sliceInfo:ck,startForAxis:gF,startIndicesWithElidedDims:fF,stopForAxis:xF,stopIndicesWithElidedDims:pF,stridesForAxis:mF,stridesWithElidedDims:uF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zle{static sgd(e){return new rk(e)}static momentum(e,t,r=!1){return new lF(e,t,r)}static rmsprop(e,t=.9,r=0,o=null,s=!1){return new cF(e,t,r,o,s)}static adam(e=.001,t=.9,r=.999,o=null){return new iF(e,t,r,o)}static adadelta(e=.001,t=.95,r=null){return new oF(e,t,r)}static adamax(e=.002,t=.9,r=.999,o=null,s=0){return new aF(e,t,r,o,s)}static adagrad(e,t=.1){return new sF(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fh=zle;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wle=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function vF(){return new Promise(n=>Wle(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uk(n,e){const t=n[0].length;n.forEach((o,s)=>{K(o.length===t,()=>`Error in concat${t}D: rank of tensors[${s}] must be the same as the rank of the rest (${t})`)}),K(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const r=n[0];n.forEach((o,s)=>{for(let i=0;i<t;i++)K(i===e||o[i]===r[i],()=>`Error in concat${t}D: Shape of tensors[${s}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function ol(n,e){const t=n[0].slice();for(let r=1;r<n.length;r++)t[e]+=n[r][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var oa;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(oa||(oa={}));function yF(n,e,t){let r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${r.length}`);for(let o=1;o<t.length;++o){const s=t[o],i=r[r.length-t.length+o],a=r[i];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${o+n}] = ${s} but shape[${o+n}] = ${a}`)}else r[i]=s}return r}function bF(n){const e={FIRST_DIM_SIZE:oa.FIRST_DIM_SIZE,VALUE_ROWIDS:oa.VALUE_ROWIDS,ROW_LENGTHS:oa.ROW_LENGTHS,ROW_SPLITS:oa.ROW_SPLITS,ROW_LIMITS:oa.ROW_LIMITS,ROW_STARTS:oa.ROW_STARTS},t=[];for(const r of n)if(r in e)t.push(e[r]);else break;return t}function wF(n){return n.length===0?0:n[0]===oa.FIRST_DIM_SIZE?n.length-1:n.length}function CF(n,e){if(n==null||e==null)return;const t=n.length,r=e.length;if(t>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${r})`);for(let o=0;o<Math.min(t,r-1);++o){const s=n[o],i=e[o+1];if(s>=0&&i>=0&&s!==1&&s!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${o-n.length}] = ${s} but ragged tensor input.flatValues.shape[${o-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dk=30;function sy(n){return n<=dk?n:NC(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hk(n,e,t){const r=t*(typeof n=="number"?n:n[0]),o=e*(typeof n=="number"?n:n[1]);return[r,o]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z1(n,e,t,r=!0){let o=[];if(r)o=o.concat(e.slice(0)),o.push(n[0]/t),o=o.concat(n.slice(1));else{o=o.concat(n[0]);const s=e.length;for(let i=0;i<s;++i)o=o.concat([n[i+1]/e[i],e[i]]);o=o.concat(n.slice(s+1))}return o}function W1(n,e,t=!0){const r=[];if(t){r.push(e);for(let o=e+1;o<n;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{const o=[],s=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?s.push(i):o.push(i);r.push(...o),r.push(0),r.push(...s)}return r}function U1(n,e,t,r=!0){const o=[];r?o.push(n[0]/t):o.push(n[0]*t);for(let s=1;s<n.length;++s)s<=e.length?r?o.push(e[s-1]*n[s]):o.push(n[s]/e[s-1]):o.push(n[s]);return o}function fk(n,e){const t=[0];for(let r=0;r<e;++r)t.push(n[r][0]);return t}function pk(n,e,t){const r=n.slice(0,1);for(let o=0;o<t;++o)r.push(n[o+1]-e[o][0]-e[o][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iy=1.7580993408473768,ay=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mk=.3275911,gk=.254829592,xk=-.284496736,vk=1.421413741,yk=-1.453152027,bk=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function kF(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function SF(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let o=0;o<n.length;o+=4)t[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:t,imag:r}}function NF(n){const e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let o=2;o<n.length;o+=4)t[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:t,imag:r}}function wk(n,e){const t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function IF(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function EF(n,e){const t=new Float32Array(n/2),r=new Float32Array(n/2);for(let o=0;o<Math.ceil(n/2);o++){const s=(e?2:-2)*Math.PI*(o/n);t[o]=Math.cos(s),r[o]=Math.sin(s)}return{real:t,imag:r}}function TF(n,e,t){const r=(t?2:-2)*Math.PI*(n/e),o=Math.cos(r),s=Math.sin(r);return{real:o,imag:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y3="->",Ule=/->/g,CE=",",kE="...";function Ck(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Ule,"").length)/y3.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${y3}").`);const[r,o]=n.split(y3);K(r.indexOf(kE)===-1,()=>`The ellipsis notation ("${kE}") is not supported yet.`);const s=r.split(CE),i=s.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<o.length;++h){const p=o[h];if(!s.some(g=>g.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let h=0;h<r.length;++h){const p=r[h];a.indexOf(p)===-1&&p!==CE&&a.push(p)}const l=new Array(s.length);for(let h=0;h<i;++h){if(new Set(s[h].split("")).size!==s[h].length)throw new Error(`Found duplicate axes in input component ${s[h]}. Support for duplicate axes in input is not implemented yet.`);l[h]=[];for(let p=0;p<s[h].length;++p)l[h].push(a.indexOf(s[h][p]))}const c=a.length,u=o.length,d=[];for(let h=u;h<c;++h)d.push(h);return{allDims:a,summedDims:d,idDims:l}}function kk(n,e){let t=new Array(n);t.fill(-1);for(let o=0;o<e.length;++o)t[e[o]]=o;const r=[];for(let o=0;o<n;++o)t[o]===-1&&r.push(o);return t=t.filter(o=>o!==-1),{permutationIndices:t,expandDims:r}}function Sk(n,e,t){const r=new Array(n);for(let o=0;o<t.length;++o){const s=t[o].shape;for(let i=0;i<e[o].length;++i)r[e[o][i]]===void 0?r[e[o][i]]=s[i]:K(r[e[o][i]]===s[i],()=>`Expected dimension ${r[e[o][i]]} at axis ${i} of input shaped ${JSON.stringify(s)}, but got dimension ${s[i]}`)}}function Nk(n,e){const t=n,r=[];let o=0;n.length===0&&t.push(-1),o=n.length+1;for(let i=0;i<o;++i)r.push([]);const s=[];for(let i=0;i<t.length;++i){const a=t[i],l=Hle(e,a);for(const c of l)s.indexOf(c)===-1&&(r[i].push(c),s.push(c))}return{path:t,steps:r}}function Ik(n){return n.every((e,t)=>e===t)}function Hle(n,e){const t=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function Ek(n,e,t=0){let r=[];if(typeof e=="number")K(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(n.shape[t]/e);else{const o=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);K(o<=1,()=>"There should be only one negative value in split array.");const s=e.indexOf(-1);if(s!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[s]=n.shape[t]-i}K(n.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RF(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function DF(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function AF(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _F(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function $F(n,e){return`size ${n} must be non-negative, not ${e}`}function FF(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function PF(n,e){const t=De(n),r=De(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${e}`}function MF(n,e){const t=De(n),r=De(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zC(){return"segment ids must be >= 0"}function OF(){return"segment ids are not increasing"}function LF(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function BF(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jF(n,e){let t=!1,r;for(n<=dk?(r=n,t=!0):r=NC(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=NC(n,r+1);return r}function VF(n,e,t){const r=[],o=n.length;for(let s=0;s<o;s++)s!==e?r.push(n[s]):r.push(t);return r}function Tk(n,e,t,r){const o=e.shape.length,s=n.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(t<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${t}).`);for(let d=0;d<r;++d)if(n.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${n.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const i=n.shape[t],a=[];let l=1,c=1,u=1;for(let d=0;d<r;++d)a.push(n.shape[d]),l*=n.shape[d];for(let d=r;d<t;d++)a.push(n.shape[d]),c*=n.shape[d];for(let d=r;d<o;d++)a.push(e.shape[d]);for(let d=t+1;d<s;d++)a.push(n.shape[d]),u*=n.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:i,outputShape:a}}const Gle=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Tk,computeOutShape:VF,segOpComputeOptimalWindowSize:jF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jl(n){try{return n.map(e=>ou(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function zF(n){return n.map(e=>Zc(e))}const qle=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:gk,ERF_A2:xk,ERF_A3:vk,ERF_A4:yk,ERF_A5:bk,ERF_P:mk,PARALLELIZE_THRESHOLD:dk,get RowPartitionType(){return oa},SELU_SCALE:ay,SELU_SCALEALPHA:iy,applyActivation:Z6,assertAndGetBroadcastShape:Ut,assertAxesAreInnerMostDims:mo,assertParamsConsistent:uk,assignToTypedArray:IF,axesAreInnerMostDims:F6,calculateShapes:jd,checkEinsumDimSizes:Sk,checkPadOnDimRoundingMode:ms,combineLocations:F$,combineRaggedTensorToTensorShapes:yF,complexWithEvenIndex:SF,complexWithOddIndex:NF,computeConv2DInfo:po,computeConv3DInfo:mu,computeDefaultPad:T6,computeDilation2DInfo:O1,computeOptimalWindowSize:sy,computeOutAndReduceShapes:to,computeOutShape:ol,computePool2DInfo:Pi,computePool3DInfo:ac,convertConv2DDataFormat:lc,decodeEinsumEquation:Ck,eitherStridesOrDilationsAreOne:Do,expandShapeToKeepDim:Ir,exponent:TF,exponents:EF,fromStringArrayToUint8:zF,fromUint8ToStringArray:Jl,getAxesPermutation:sr,getBroadcastDims:gf,getComplexWithIndex:wk,getEinsumComputePath:Nk,getEinsumPermutation:kk,getFusedBiasGradient:Y6,getFusedDyActivation:X6,getImageCenter:hk,getInnerMostAxes:vr,getPermuted:W1,getRaggedRank:wF,getReductionAxes:Lr,getReshaped:z1,getReshapedPermuted:U1,getRowPartitionTypesHelper:bF,getSliceBeginCoords:fk,getSliceSize:pk,getSparseFillEmptyRowsIndicesDenseShapeMismatch:RF,getSparseFillEmptyRowsNegativeIndexErrorMessage:DF,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:AF,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:FF,getSparseReshapeInputOutputMismatchErrorMessage:MF,getSparseReshapeInputOutputMultipleErrorMessage:PF,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:_F,getSparseReshapeNegativeOutputDimErrorMessage:$F,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:BF,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:zC,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:OF,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:LF,getUndoAxesPermutation:gu,isIdentityPermutation:Ik,log:Nne,mergeRealAndImagArrays:Ql,prepareAndValidate:ok,prepareSplitSize:Ek,segment_util:Gle,shouldFuse:Q6,slice_util:Vle,splitRealAndImagArrays:kF,stridesOrDilationsArePositive:wd,tupleValuesAreOne:bd,upcastType:Ls,validateDefaultValueShape:CF,validateInput:Sae,validateUpdateShape:Q$,warn:Js},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Mle();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WF={kernelName:Xv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,V1(nt(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kle={kernelName:zm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Hn(nt(t,"float32")),o=Ro(_t(Nn(1),r));return gr(Et(n,o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xle={kernelName:Wm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Ro(_t(Hn(nt(t,"float32")),1));return Et(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yle={kernelName:Ff,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,o=Ut(t.shape,r.shape);return{a:()=>{let a=n;const l=Lr(t.shape,o);return l.length>0&&(a=It(a,l)),pe(a,t.shape)},b:()=>{let a=n;const l=Lr(r.shape,o);return l.length>0&&(a=It(a,l)),pe(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zle={kernelName:B5,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((r,o)=>{t[o]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qle={kernelName:Yv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pn(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jle={kernelName:Zv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pn(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ece={kernelName:Um,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,Ro(_t(Nn(1),Hn(nt(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tce={kernelName:Hm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Ro(Ue(Nn(1),Hn(nt(t,"float32"))));return Et(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce={kernelName:Km,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,o=Ut(t.shape,r.shape);return{a:()=>{const a=Ue(Hn(t),Hn(r));let l=ae(n,Et(r,a));const c=Lr(t.shape,o);return c.length>0&&(l=It(l,c)),pe(l,t.shape)},b:()=>{const a=Ue(Hn(t),Hn(r));let l=gr(ae(n,Et(t,a)));const c=Lr(r.shape,o);return c.length>0&&(l=It(l,c)),pe(l,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rce={kernelName:Gm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,Ue(Hn(nt(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oce={kernelName:qm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,_t(Nn(1),Hn(nt(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(n,e,t,r,o,s){const i=ee(n,"dy","avgPool3dGrad"),a=ee(e,"input","avgPool3dGrad");let l=i,c=a,u=!1;a.rank===4&&(u=!0,l=pe(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),c=pe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),K(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),K(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),ms("avgPool3dGrad",o,s);const d={dy:l,input:c},h={filterSize:t,strides:r,pad:o,dimRoundingMode:s},p=le.runKernel(W5,d,h);return u?pe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const ice=me({avgPool3dGrad_:sce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ace={kernelName:Jv,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:o,strides:s,pad:i,dimRoundingMode:a}=t;return{x:()=>ice(n,r,o,s,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lce(n,e,t,r,o){const s=ee(n,"dy","avgPoolGrad"),i=ee(e,"input","avgPoolGrad");K(i.rank===s.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${s.rank})`);let a=i,l=s,c=!1;i.rank===3&&(c=!0,a=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),K(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),K(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},d={filterSize:t,strides:r,pad:o},h=le.runKernel(z5,u,d);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const cce=me({avgPoolGrad_:lce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uce={kernelName:Qv,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:o,strides:s,pad:i}=t;return{x:()=>cce(n,r,o,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dce={kernelName:e2,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[r,o]=e,{transposeA:s,transposeB:i}=t;return!s&&!i?{a:()=>Sn(n,o,!1,!0),b:()=>Sn(r,n,!0,!1)}:!s&&i?{a:()=>Sn(n,o,!1,!1),b:()=>Sn(n,r,!0,!1)}:s&&!i?{a:()=>Sn(o,n,!1,!0),b:()=>Sn(r,n,!1,!1)}:{a:()=>Sn(o,n,!0,!0),b:()=>Sn(n,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hce={kernelName:t2,gradFunc:(n,e,t)=>{const{blockShape:r,crops:o}=t;return{x:()=>z6(n,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fce={kernelName:wne,gradFunc:(n,e,t)=>{const r=t,o=r.inputShape,s=r.shape,i=Array.from(s);for(let l=o.length-1;l>=0;l--)if(o[l]===s[l])i[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${s}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>It(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pce={kernelName:Xm,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mce={kernelName:Ym,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gce={kernelName:Zm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{clipValueMin:o,clipValueMax:s}=t;return{x:()=>Zo(Yl(Ld(r,o),Of(r,s)),n,pn(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xce={kernelName:n2,inputsToSave:["x"],gradFunc:WF.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vce={kernelName:r2,saveAllInputs:!0,gradFunc:(n,e,t)=>{const r=e.map(l=>l.shape),{axis:o}=t,s=Qt(o,e[0].shape)[0],i=r.map(l=>l[s]);return ii(n,i,s).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yce={kernelName:o2,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,o]=e,{dilations:s,strides:i,pad:a,dataFormat:l}=t;return K(bd(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>A6(r.shape,n,o,i,a,l),filter:()=>K6(r,n,o.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bce={kernelName:s2,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[r,o]=e,{strides:s,pad:i,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Cd(n,o,s,i,a,1,l),filter:()=>K6(n,r,o.shape,s,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(n,e,t,r,o){let s=n;n.rank===4&&(s=pe(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),K(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),K(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),K(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),K(s.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${t[3]}.`),K(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:s,dy:i},l={strides:r,pad:o,filterShape:t};return le.runKernel(K5,a,l)}const Cce=me({conv3DBackpropFilter_:wce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kce={kernelName:i2,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:o,pad:s}=t;K(bd(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[i,a]=e;return{x:()=>D$(i.shape,n,a,o,s),filter:()=>Cce(i,n,a.shape,o,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sce={kernelName:Qm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(gr(K$(nt(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nce={kernelName:Jm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(X$(nt(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ice={kernelName:a2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:o,exclusive:s,reverse:i}=t;return{x:()=>{const a=sr([o],r.rank);let l=_$(n,o,s,!i);return a!=null&&(l=fn(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ece={kernelName:l2,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:o,pad:s,dimRoundingMode:i}=t,a=r??[1,1];K(bd(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return K(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),K(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),K(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),K(Do(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),ms("depthwiseConv2d",s,i),{x:()=>Wae(l.shape,n,c,o,s,a,i),filter:()=>Vae(l,n,c.shape,o,s,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tce={kernelName:c2,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,o]=e,s={x:r,filter:o,dy:n},i={x:r,filter:o,dy:n};return{x:()=>le.runKernel(IC,s,t),filter:()=>le.runKernel(EC,i,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rce={kernelName:t1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,r={dy:n,y:t};return{x:()=>le.runKernel(r6,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dce={kernelName:n1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=ae(dl(gr(Hn(t))),2/Math.sqrt(Math.PI));return{x:()=>ae(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ace={kernelName:r1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ce={kernelName:d2,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>pe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ce={kernelName:o1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,dl(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fce={kernelName:s1,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pce={kernelName:i1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,o=Ut(t.shape,r.shape);return{a:()=>{const a=Et(n,nt(r,"float32")),l=Lr(t.shape,o);return l.length>0?pe(It(a,l),t.shape):a},b:()=>{let a=ae(n,nt(t,"float32"));const l=Lr(r.shape,o);l.length>0&&(a=pe(It(a,l),r.shape));const c=Hn(r);return gr(Et(a,nt(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mce={kernelName:h2,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:r}=t,[o,s,i,a]=e,l=a??Nn(1),c=Lr(s.shape,o.shape),u=[];if(s.rank===1){for(let k=0;k<o.shape.length-1;++k)u.push(o.shape[k]);u.push(1)}const d=_t(o,s),h=ae(n,l),p=H$(Ue(i,Nn(r))),g=ae(ae(ae(p,p),p),Nn(-.5));return{x:()=>s.rank===1?pe(ae(ae(n,ia(pe(p,[1,1,1,s.shape[0]]),u)),l),o.shape):pe(ae(ae(n,p),l),o.shape),mean:()=>{let k=ae(ae(p,Nn(-1)),h);return s.rank===1&&(k=It(k,c)),pe(k,s.shape)},variance:()=>{let k=ae(ae(g,d),h);return s.rank===1&&(k=It(k,c)),pe(k,s.shape)},scale:()=>{const k=ae(d,p);let N=ae(n,k);return s.rank===1&&(N=It(N,c)),pe(N,s.shape)},offset:()=>{let k=n;return s.rank===1&&(k=It(k,c)),pe(k,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oce={kernelName:f2,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[r,o]=e,{axis:s,batchDims:i}=t,a=Qt(s,r.shape)[0],l=(c,u,d)=>()=>{const h=c.shape,p=u.size,g=h.slice(0,a),x=g.length,y=h.slice(s,h.length).slice(1),b=y.length,C=SE(0,x),S=SE(x+1,x+1+b),k=NE([g,[p],y]),N=pe(d,k),E=pe(u,[p]),_=NE([[x],C,S]),$=fn(N,_);let T=eF($,E,c.shape[a]);const D=gu(_);return T=fn(T,D),T};if(i===1){const c=r.shape[0],u=r.split(c,0);return{x:()=>Zl(u.map((p,g)=>l(p,o.slice(g,1),n.slice(g,1))())).reshape(r.shape),indices:()=>o}}else return{x:l(r,o,n),indices:()=>o}}};function SE(n,e){const t=[];for(let r=n;r<e;++r)t.push(r);return t}function NE(n){const e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lce={kernelName:a1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>pn(t),b:()=>pn(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bce={kernelName:l1,gradFunc:n=>({x:()=>nt(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jce={kernelName:c1,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vce={kernelName:u1,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zce={kernelName:d1,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wce={kernelName:m2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{alpha:o}=t,s=ui(r,0);return{x:()=>Zo(s,n,ae(n,o))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uce={kernelName:f1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,Ue(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hce={kernelName:h1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,nt(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gce={kernelName:kne,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{axis:o}=t;return{logits:()=>{const i=dl(r);return _t(n,ae(It(n,o,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qce(n,e,t,r=5,o=1,s=1,i=.5){const a={x:n,y:e,dy:t},l={depthRadius:r,bias:o,alpha:s,beta:i};return le.runKernel(c6,a,l)}const Kce=me({localResponseNormalizationBackprop_:qce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xce={kernelName:w2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,o]=e,{depthRadius:s,bias:i,alpha:a,beta:l}=t;return{x:()=>Kce(r,o,n,s,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UF(n,e,t,r){return e.rank<t.rank&&(e=pe(e,Ir(e.shape,r))),n.rank<t.rank&&(n=pe(n,Ir(n.shape,r))),{x:()=>ae(n,nt(ul(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IE={kernelName:C2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{reductionIndices:o}=r,s=e[0],i=e[1],a=Qt(o,s.shape),l=UF(n,i,s,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yce={kernelName:p1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>ae(n,nt(Ld(t,r),"float32")),b:()=>ae(n,nt(qx(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zce(n,e,t,r,o,s,i){const a=ee(n,"dy","maxPool3dGrad"),l=ee(e,"input","maxPool3dGrad"),c=ee(t,"output","maxPool3dGrad");let u=a,d=l,h=c,p=!1;l.rank===4&&(p=!0,u=pe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=pe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=pe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),K(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),K(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),K(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),ms("maxPool3dGrad",s,i);const g={dy:u,input:d,output:h},x={filterSize:r,strides:o,pad:s,dimRoundingMode:i},y=le.runKernel(d6,g,x);return p?pe(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const Qce=me({maxPool3dGrad_:Zce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jce={kernelName:S2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,o]=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=t;return{x:()=>Qce(n,r,o,s,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue(n,e,t,r,o,s,i){const a=ee(n,"dy","maxPoolGrad"),l=ee(e,"input","maxPoolGrad"),c=ee(t,"output","maxPoolGrad");K(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),K(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),K(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),ms("maxPoolGrad",s,i);const u={dy:a,input:l,output:c},d={filterSize:r,strides:o,pad:s,dimRoundingMode:i};return le.runKernel(u6,u,d)}const tue=me({maxPoolGrad_:eue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nue={kernelName:k2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,o]=e,{filterSize:s,strides:i,pad:a}=t;return{x:()=>tue(n,r,o,s,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rue={kernelName:N2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:o}=t,s=Qt(o,r.shape),a=to(r.shape,s)[1],l=De(a);return{x:()=>{const u=r.shape.slice();s.forEach(p=>{u[p]=1});const d=pe(n,u);return Et(ae(d,vu(r.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oue={kernelName:I2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{axis:o}=r,[s,i]=e,a=Qt(o,s.shape),l=UF(n,i,s,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sue={kernelName:m1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>ae(n,nt(Of(t,r),"float32")),b:()=>ae(n,nt(ui(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iue={kernelName:E2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:o}=t,s=o.map(i=>i[0]);return{x:()=>jn(n,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aue={kernelName:g1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,o=Ut(t.shape,r.shape);return{a:()=>{const a=Lr(t.shape,o);return a.length>0?pe(It(n,a),t.shape):n},b:()=>{const a=ae(n,gr(ry(Et(t,r)))),l=Lr(r.shape,o);return l.length>0?pe(It(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lue={kernelName:x1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,o=Ut(t.shape,r.shape);return{a:()=>{const a=ae(n,nt(r,"float32")),l=Lr(t.shape,o);return l.length>0?pe(It(a,l),t.shape):a},b:()=>{const a=ae(n,nt(t,"float32")),l=Lr(r.shape,o);return l.length>0?pe(It(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cue={kernelName:T2,gradFunc:n=>({x:()=>gr(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uue={kernelName:A2,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>qr(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const due={kernelName:D2,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hue={kernelName:_2,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:r}=t;return Nd(n,r).map(s=>()=>s)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EE={kernelName:$2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:o}=t,s=o.map(i=>i[0]);return{x:()=>jn(n,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fue={kernelName:v1,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,r,o]=e,s=t,i=r,a=Ut(s.shape,i.shape);return{a:()=>{const u=nt(i,"float32");let d=ae(n,ae(u,kd(s,_t(u,Nn(1)))));const h=Lr(s.shape,a);return h.length>0&&(d=It(d,h)),pe(d,s.shape)},b:()=>{const u=ui(s,0),d=Zo(u,hl(s),pn(s));let h=ae(n,ae(o,d));const p=Lr(i.shape,a);return p.length>0&&(h=It(h,p)),pe(h,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pue={kernelName:F2,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,r]=e,o=ui(t,0);return{x:()=>Zo(o,n,ae(n,r)),alpha:()=>{let s=Zo(o,pn(n),ae(n,t));const i=Lr(r.shape,n.shape);return i.length>0&&(s=It(s,i)),pe(s,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mue(n,e,t){const r=n.shape.slice();r[t]=1;const o=pe(e,r),s=BC(n,t,!0,!1),i=BC(n,t,!0,!0),a=ae(s,i);return ae(o,a)}function gue(n,e,t){const r=n.shape.length,o=r-t.length,s=sr(t,r);let i=n;s!=null&&(i=fn(n,s));const a=i.shape.slice(),c=a.splice(r-t.length,t.length).reduce((h,p)=>h*p,1);a.push(c);const u=i.reshape(a);let d=mue(u,e,o);if(d=d.reshape(i.shape),s!=null){const h=gu(s);d=fn(d,h)}return d}const xue={kernelName:P2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:o}=t;let s=[];return o==null?s=r.shape.map((i,a)=>a):typeof o=="number"?s=[o]:s=o,{x:()=>gue(r,n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vue={kernelName:e1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,o=Ut(t.shape,r.shape);return{a:()=>{const a=Et(n,nt(r,"float32")),l=Lr(t.shape,o);return l.length>0?pe(It(a,l),t.shape):a},b:()=>{let a=ae(n,nt(t,"float32"));const l=Lr(r.shape,o);l.length>0&&(a=pe(It(a,l),r.shape));const c=Hn(r);return gr(Et(a,nt(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yue={kernelName:y1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,gr(Hn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bue={kernelName:w1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=ae(Of(t,6),V1(t));return{x:()=>ae(n,nt(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wue={kernelName:b1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,nt(V1(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cue={kernelName:M2,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kue={kernelName:L2,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,o={dy:n,images:r};return{images:()=>le.runKernel(v6,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sue={kernelName:O2,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,o={dy:n,images:r};return{images:()=>le.runKernel(x6,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nue={kernelName:B2,gradFunc:(n,e,t)=>{const{dims:r}=t,o=Qt(r,n.shape);return{x:()=>Sd(n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iue={kernelName:C1,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eue={kernelName:k1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>gr(Et(n,ae(kd(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tue={kernelName:j2,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>nt(pn(t),"float32"),t:()=>ae(n,nt(t,n.dtype)),e:()=>ae(n,nt(L6(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rue={kernelName:S1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=ui(t,Nn(0)),o=Nn(iy),s=Nn(ay),i=ae(n,s),a=ae(ae(n,o),dl(nt(t,"float32")));return Zo(r,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Due={kernelName:T1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,ae(t,_t(Nn(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aue={kernelName:E1,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ue={kernelName:N1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(_6(nt(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ue={kernelName:I1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(A$(nt(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fue={kernelName:V2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{begin:o,size:s}=t,i=r.shape,[a,l]=oy(r,o,s),c=[];for(let u=0;u<n.rank;u++)c.push([a[u],i[u]-a[u]-l[u]]);return{x:()=>V6(n,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pue={kernelName:H2,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{dim:o}=t,s=!0,i=ae(n,r);return{logits:()=>_t(i,ae(It(i,[o],s),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mue={kernelName:R1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,Mf(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TE={kernelName:W2,gradFunc:(n,e,t)=>{const{blockShape:r,paddings:o}=t;return{x:()=>D6(n,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RE={kernelName:U2,gradFunc:(n,e,t)=>{const{axis:r}=t;return{x:()=>ds(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oue={kernelName:D1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,ae(Ro(nt(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lue={kernelName:y6,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,ae(nt(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bue={kernelName:A1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,o=Nn(2);return{a:()=>ae(n,ae(o,_t(t,r))),b:()=>ae(n,ae(o,_t(r,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jue={kernelName:M1,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vue={kernelName:_1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,o=Ut(t.shape,r.shape);return{a:()=>{let a=n;const l=Lr(t.shape,o);return l.length>0&&(a=It(a,l)),pe(a,t.shape)},b:()=>{let a=n;const l=Lr(r.shape,o);return l.length>0&&(a=It(a,l)),pe(gr(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zue={kernelName:z2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,o=r.shape.slice(),{axis:s}=t;Qt(s,r.shape).forEach(c=>{o[c]=1});const a=pe(n,o),l=ae(a,vu(r.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wue={kernelName:$1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,Hn(_6(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uue={kernelName:F1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(_t(Nn(1),Hn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hue={kernelName:P1,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{reps:o}=t;return{x:()=>{let i=pn(r);if(r.rank===1)for(let a=0;a<o[0];++a)i=Ue(i,jn(n,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)i=Ue(i,jn(n,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)i=Ue(i,jn(n,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)for(let u=0;u<o[3];++u)i=Ue(i,jn(n,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gue={kernelName:nf,gradFunc:(n,e,t)=>{const r=t,{perm:o}=r,s=gu(o);return{x:()=>fn(n,s)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const que={kernelName:G2,gradFunc:(n,e,t)=>{const r=t,{axis:o}=r;return{value:()=>Zl(n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kue={kernelName:q2,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xue(n,t)}}};function Xue(n,e){const t=xu(e,pn(e)),r=P6(n,t);let o=Ld(e,Nn(0,"int32"));const s=r.rank-o.rank;for(let a=0;a<s;++a)o=cs(o,a+1);o=Yl(o,vu(r.shape,"bool"));const i=pn(r);return Zo(o,r,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yue={kernelName:K2,gradFunc:n=>({x:()=>pn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zue=[WF,Kle,Xle,Yle,Zle,Qle,Jle,ece,tce,nce,rce,oce,ace,uce,dce,hce,fce,pce,mce,gce,xce,vce,bce,yce,kce,Sce,Nce,Ice,Ece,Tce,vue,Rce,Dce,Ace,_ce,$ce,Pce,Fce,Mce,Oce,Lce,Bce,jce,Vce,zce,Wce,Uce,Hce,Gce,Xce,IE,IE,Yce,Jce,nue,rue,oue,sue,iue,aue,lue,cue,uue,due,hue,EE,EE,fue,pue,xue,yue,bue,wue,Cue,kue,Sue,Nue,Iue,Eue,Tue,Rue,Due,Aue,_ue,$ue,Fue,Pue,Mue,TE,TE,RE,RE,Oue,Bue,Lue,jue,Vue,zue,Wue,Uue,Hue,Gue,que,Kue,Yue];for(const n of Zue)Ine(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.abs=function(){return this.throwIfDisposed(),Wo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.acos=function(){return this.throwIfDisposed(),Are(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.acosh=function(){return this.throwIfDisposed(),$re(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.add=function(n){return this.throwIfDisposed(),Ue(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.all=function(n,e){return this.throwIfDisposed(),E$(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.any=function(n,e){return this.throwIfDisposed(),OC(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.argMax=function(n){return this.throwIfDisposed(),hm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.argMin=function(n){return this.throwIfDisposed(),Lre(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.asScalar=function(){return this.throwIfDisposed(),K(this.size===1,()=>"The array must have only 1 element."),pe(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.asType=function(n){return this.throwIfDisposed(),nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.as1D=function(){return this.throwIfDisposed(),pe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.as2D=function(n,e){return this.throwIfDisposed(),pe(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),pe(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),pe(this,[n,e,t,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.as5D=function(n,e,t,r,o){return this.throwIfDisposed(),pe(this,[n,e,t,r,o])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.asin=function(){return this.throwIfDisposed(),jre(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.asinh=function(){return this.throwIfDisposed(),zre(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.atan=function(){return this.throwIfDisposed(),Ure(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.atan2=function(n){return this.throwIfDisposed(),Gre(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.atanh=function(){return this.throwIfDisposed(),Kre(this)};Te().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),R6(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),D6(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.batchNorm=function(n,e,t,r,o){return this.throwIfDisposed(),J2(this,n,e,t,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Yp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.cast=function(n){return this.throwIfDisposed(),nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.ceil=function(){return this.throwIfDisposed(),woe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),ai(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof _r&&(n=[n]),ds([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.conv1d=function(n,e,t,r,o,s){return this.throwIfDisposed(),T$(this,n,e,t,r,o,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.conv2dTranspose=function(n,e,t,r,o){return this.throwIfDisposed(),R$(this,n,e,t,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.conv2d=function(n,e,t,r,o,s){return this.throwIfDisposed(),Cd(this,n,e,t,r,o,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.cos=function(){return this.throwIfDisposed(),_6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.cosh=function(){return this.throwIfDisposed(),A$(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),BC(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),_$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),Goe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.depthwiseConv2d=function(n,e,t,r,o,s){return this.throwIfDisposed(),$6(this,n,e,t,r,o,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.dilation2d=function(n,e,t,r,o){return this.throwIfDisposed(),Xoe(this,n,e,t,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.divNoNan=function(n){return this.throwIfDisposed(),ese(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.div=function(n){return this.throwIfDisposed(),Et(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.dot=function(n){return this.throwIfDisposed(),nse(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.elu=function(){return this.throwIfDisposed(),ty(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.equal=function(n){return this.throwIfDisposed(),ul(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.erf=function(){return this.throwIfDisposed(),$$(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),pse(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.exp=function(){return this.throwIfDisposed(),dl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.expandDims=function(n){return this.throwIfDisposed(),cs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.expm1=function(){return this.throwIfDisposed(),vse(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.fft=function(){return this.throwIfDisposed(),Z$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.flatten=function(){return this.throwIfDisposed(),pe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.floor=function(){return this.throwIfDisposed(),ry(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.floorDiv=function(n){return this.throwIfDisposed(),I$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.gather=function(n,e,t){return this.throwIfDisposed(),P6(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Ld(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.greater=function(n){return this.throwIfDisposed(),ui(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.ifft=function(){return this.throwIfDisposed(),jC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.irfft=function(){return this.throwIfDisposed(),dae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.isFinite=function(){return this.throwIfDisposed(),Ese(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.isInf=function(){return this.throwIfDisposed(),Rse(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.isNaN=function(){return this.throwIfDisposed(),Ase(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.leakyRelu=function(n){return this.throwIfDisposed(),O6(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.lessEqual=function(n){return this.throwIfDisposed(),Of(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.less=function(n){return this.throwIfDisposed(),qx(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),Mse(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.logSigmoid=function(){return this.throwIfDisposed(),Wse(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.logSoftmax=function(n){return this.throwIfDisposed(),L$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),B$(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.log=function(){return this.throwIfDisposed(),hl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.log1p=function(){return this.throwIfDisposed(),O$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Yl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.logicalNot=function(){return this.throwIfDisposed(),L6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.logicalOr=function(n){return this.throwIfDisposed(),j$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.logicalXor=function(n){return this.throwIfDisposed(),Zse(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Sn(this,n,e,t)};Te().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),B6(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.max=function(n,e){return this.throwIfDisposed(),ca(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.maximum=function(n){return this.throwIfDisposed(),xu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.mean=function(n,e){return this.throwIfDisposed(),Sr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.min=function(n,e){return this.throwIfDisposed(),Gx(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.minimum=function(n){return this.throwIfDisposed(),mm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),sie(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.mod=function(n){return this.throwIfDisposed(),aie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.mul=function(n){return this.throwIfDisposed(),ae(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.neg=function(){return this.throwIfDisposed(),gr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.norm=function(n,e,t){return this.throwIfDisposed(),ny(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.notEqual=function(n){return this.throwIfDisposed(),Kx(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),V$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.onesLike=function(){return this.throwIfDisposed(),$i(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.pad=function(n,e){return this.throwIfDisposed(),V6(this,n,e)};Te().prototype.pool=function(n,e,t,r,o,s){return this.throwIfDisposed(),xie(this,n,e,t,r,o,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.pow=function(n){return this.throwIfDisposed(),kd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.prelu=function(n){return this.throwIfDisposed(),W6(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.prod=function(n,e){return this.throwIfDisposed(),bie(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.reciprocal=function(){return this.throwIfDisposed(),Hie(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.relu=function(){return this.throwIfDisposed(),Bd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.relu6=function(){return this.throwIfDisposed(),W$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.reshapeAs=function(n){return this.throwIfDisposed(),pe(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.reshape=function(n){return this.throwIfDisposed(),pe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),nF(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),rF(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.reverse=function(n){return this.throwIfDisposed(),Sd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.rfft=function(){return this.throwIfDisposed(),pae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.round=function(){return this.throwIfDisposed(),U$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.rsqrt=function(){return this.throwIfDisposed(),H$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.selu=function(){return this.throwIfDisposed(),G$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.separableConv2d=function(n,e,t,r,o,s){return this.throwIfDisposed(),q$(this,n,e,t,r,o,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.sigmoid=function(){return this.throwIfDisposed(),Mf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.sign=function(){return this.throwIfDisposed(),eae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.sin=function(){return this.throwIfDisposed(),K$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.sinh=function(){return this.throwIfDisposed(),X$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.slice=function(n,e){return this.throwIfDisposed(),jn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.softmax=function(n){return this.throwIfDisposed(),q6(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.softplus=function(){return this.throwIfDisposed(),L1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),z6(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.split=function(n,e){return this.throwIfDisposed(),ii(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.sqrt=function(){return this.throwIfDisposed(),Ro(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.square=function(){return this.throwIfDisposed(),Hn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.squaredDifference=function(n){return this.throwIfDisposed(),gae(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.squeeze=function(n){return this.throwIfDisposed(),j1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof _r?[this,n]:[this,...n];return Zl(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.step=function(n){return this.throwIfDisposed(),V1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.stridedSlice=function(n,e,t,r,o,s,i,a){return this.throwIfDisposed(),wae(this,n,e,t,r,o,s,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.sub=function(n){return this.throwIfDisposed(),_t(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.sum=function(n,e){return this.throwIfDisposed(),It(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.tan=function(){return this.throwIfDisposed(),kae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.tanh=function(){return this.throwIfDisposed(),Q2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.tile=function(n){return this.throwIfDisposed(),ia(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.toBool=function(){return this.throwIfDisposed(),nt(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.toFloat=function(){return this.throwIfDisposed(),nt(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.toInt=function(){return this.throwIfDisposed(),nt(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.topk=function(n,e){return this.throwIfDisposed(),Iae(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.transpose=function(n){return this.throwIfDisposed(),fn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.unique=function(n){return this.throwIfDisposed(),Rae(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),eF(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.unstack=function(n){return this.throwIfDisposed(),Nd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.where=function(n,e){return this.throwIfDisposed(),Zo(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Te().prototype.zerosLike=function(){return this.throwIfDisposed(),pn(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Wa extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Wa.prototype)}}class Di extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Di.prototype)}}class se extends Error{constructor(e){super(e),Object.setPrototypeOf(this,se.prototype)}}class Gt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Gt.prototype)}}class Rk extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Rk.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class HF{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Id(n,e){if(Array.isArray(n)){let t=[];for(let r=0;r<e;r++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Ua(n,e){if(!n)throw new Rk(e)}function DE(n,e){let t=0;for(const r of n)r===e&&t++;return t}function us(n){return n.length===1?n[0]:n}function Dn(n){return Array.isArray(n)?n:[n]}function zl(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function ed(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let ki={};function Dk(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function WC(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>WC(e));else{const e=Object.keys(n);for(const t of e){const r=n[t];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[t]=r.value:WC(r))}}}function H1(n,e={},t={},r="object",o=!1){if(typeof n=="string"){const s=n;let i;if(s in t)i=t[s];else if(s in ki)i=ki[s];else if(i=e[s],i==null)throw new se(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const s=n;if(s.className==null||s.config==null)throw new se(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);const i=s.className;let a,l;if(i in t?[a,l]=t[i]:i in ki?[a,l]=ki.className:i in e&&([a,l]=e[i]),a==null)throw new se(`Unknown ${r}: ${i}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const p of Object.keys(ki))c[p]=ki[p];for(const p of Object.keys(t))c[p]=t[p];const u=s.config;u.customObjects=c;const d=Object.assign({},ki);for(const p of Object.keys(t))ki[p]=t[p];WC(s.config);const h=l(a,s.config,t,o);return ki=Object.assign({},d),h}else{const c=Object.assign({},ki);for(const d of Object.keys(t))ki[d]=t[d];const u=new a(s.config);return ki=Object.assign({},c),u}}}function Que(n,e){return n<e?-1:n>e?1:0}function O0(n,e){return-1*Que(n,e)}function Qc(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function Jue(n){if(n==null)throw new se(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Vd(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new se(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function Ak(n,e,t=0,r=1/0){return Ua(t>=0),Ua(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(o=>typeof o===e)}function Kr(n,e){Array.isArray(n)?(K(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,r)=>Kr(t,`element ${r+1} of ${e}`))):K(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${GF(n)}.`)}function GF(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>GF(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function ede(n,e,t){let r=t!=null?t():as(),o;return(...i)=>{const a=t!=null?t():as();return a-r<e||(r=a,o=n(...i)),o}}function qF(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let tde=0;function KF(){return tde++}const L0={};function ly(n=""){return n in L0||(L0[n]=0),L0[n]+=1,n+L0[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const nde=["channelsFirst","channelsLast"],rde=["nearest","bilinear"],ode=["valid","same","causal"],sde=["max","avg"],ide=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ph=new Map;function yr(n){Vd(nde,"DataFormat",n)}function ade(n){Vd(rde,"InterpolationFormat",n)}function di(n){Vd(ode,"PaddingMode",n)}function XF(n){Vd(sde,"PoolMode",n)}const Zp=[],AE="/";function ud(n,e){Zp.push(n);try{const t=e();return Zp.pop(),t}catch(t){throw Zp.pop(),t}}function lde(){return Zp.length===0?"":Zp.join(AE)+AE}function YF(n){if(!QF(n))throw new Error("Not a valid tensor name: '"+n+"'");return lde()+n}function ZF(n){if(!QF(n))throw new Error("Not a valid tensor name: '"+n+"'");Ph.has(n)||Ph.set(n,0);const e=Ph.get(n);if(Ph.set(n,Ph.get(n)+1),e>0){const t=`${n}_${e}`;return Ph.set(t,1),t}else return n}const cde=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function QF(n){return!!n.match(cde)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ude(n){return n===parseInt(n.toString(),10)}function Jc(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let r=1;for(let o=e;o<t;++o)r*=n[o];return r}function vf(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r<e&&(e=r)}return e}function su(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r>e&&(e=r)}return e}function fa(n,e){if(e<n)throw new se(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let r=n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let b3;function Fr(){return b3==null&&(b3=tre().epsilon()),b3}function pa(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sl(n,e){return nt(n,e)}function G1(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),pe(n,t)}function dde(n,e){return ve(()=>{if(n.shape.length!==2)throw new se(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=G1(n,1);return UC(t,[1,e,1])})}function hde(n){const e=[Jc(n.shape)];return pe(n,e)}function fde(n){if(n.rank<=1)throw new se(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Jc(n.shape,1)];return pe(n,e)}function dd(n,e,t){return ve(()=>{switch(n.rank){case 1:return H6(n,e,t);case 2:return Y$(n,[e,0],[t,n.shape[1]]);case 3:return G6(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Yx(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return jn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return jn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new se(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function w3(n,e,t){return ve(()=>{switch(n.rank){case 1:return H6(n,e,t);case 2:return Y$(n,[0,e],[n.shape[0],t]);case 3:return G6(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Yx(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new se(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function B0(n,e,t,r){return ve(()=>{switch(n.rank){case 1:return H6(n,e,t);case 2:switch(r){case 1:return dd(n,e,t);case 2:return w3(n,e,t);default:throw new se(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return dd(n,e,t);case 2:return G6(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return w3(n,e,t);default:throw new se(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return dd(n,e,t);case 2:return Yx(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Yx(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return w3(n,e,t);default:throw new se(`The axis is not within the rank of the tensor ${r}`)}default:throw new se(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function _k(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),ds(n,e)}function _E(n,e){switch(n.rank){case 1:return Soe([n,e]);case 2:return Ioe([n,e],0);case 3:return Toe([n,e],0);case 4:return Doe([n,e],0);default:throw new se(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function UC(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new se(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return ia(n,e)}function cy(n,e=0,t=1,r,o){return Vie(n,e,t,r,o)}function il(n,e,t,r){if(n.rank<2||e.rank<2)throw new Gt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const o=n.shape.slice(-1)[0],s=e.shape.slice(-2)[0];if(o!==s)throw new Gt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return vE({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?HC(n.rank,r,pa()):null,activation:t});{const o=n.shape.slice(),s=o.pop();n=pe(n,[-1,s]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),c=[...i,a],u=Array.from({length:e.rank},(g,x)=>x===0?e.rank-2:x<=e.rank-2?x-1:x);e=pe(fn(e,u),[l,-1]);const d=[...o,...c];return pe(vE({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?HC(n.rank,r,pa()):null,activation:t}),d)}}function JF(n,e,t){return ve(()=>(Array.isArray(e)?e=Fs(e,"int32"):e=nt(e,"int32"),P6(n,e,t)))}function q1(n){return ae(n,n)}function HC(n,e,t){const r=e.shape;if(e.rank!==1&&e.rank!==n)throw new se(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return r.length===1?pe(e,[1,r[0],1,1,1]):pe(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?pe(e,[1,1,1,1,r[0]]):pe(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?pe(e,[1,r[0],1,1]):pe(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?pe(e,[1,1,1,r[0]]):pe(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?pe(e,[1,r[0],1]):pe(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?pe(e,[1,1,r[0]]):pe(e,[1].concat(r))}else if(n<3)return e;throw new se(`Unsupported input rank by biasAdd: ${e.rank}`)}function ya(n,e,t){return ve(()=>(t==null&&(t=pa()),yr(t),Ue(n,HC(n.rank,e,t))))}function pde(n,e=1){if(e!==1)throw new Gt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return ty(n)}function mde(n){return ve(()=>Et(n,Ue(Wo(n),1)))}function eP(n,e,t,r){return ve(()=>Mae(n,e,t,r))}function gde(n){return ve(()=>{const e=Ue(.5,ae(.2,n));return ai(e,0,1)})}function K1(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xde=["fanIn","fanOut","fanAvg"],vde=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yde(n){Vd(xde,"FanMode",n)}function bde(n){Vd(vde,"Distribution",n)}class Mi extends Bf{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class tP extends Mi{apply(e,t){return qr(e,t)}}tP.className="Zeros";Le(tP);class $k extends Mi{apply(e,t){return vu(e,t)}}$k.className="Ones";Le($k);class nP extends Mi{constructor(e){if(super(),typeof e!="object")throw new se(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new se(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ve(()=>ae(Nn(this.value),vu(e,t)))}getConfig(){return{value:this.value}}}nP.className="Constant";Le(nP);class rP extends Mi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return B1(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}rP.className="RandomUniform";Le(rP);class oP extends Mi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Gt(`randomNormal does not support dType ${t}.`);return cy(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}oP.className="RandomNormal";Le(oP);class sP extends Mi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Gt(`truncatedNormal does not support dType ${t}.`);return J$(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}sP.className="TruncatedNormal";Le(sP);class iP extends Mi{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ve(()=>{if(e.length!==2||e[0]!==e[1])throw new se("Identity matrix initializer can only be used for 2D square matrices.");return ae(this.gain,M$(e[0]))})}getConfig(){return{gain:this.gain}}}iP.className="Identity";Le(iP);function wde(n,e="channelsLast"){let t,r;if(yr(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const o=Jc(n,2);t=n[1]*o,r=n[0]*o}else if(e==="channelsLast"){const o=Jc(n,0,n.length-2);t=n[n.length-2]*o,r=n[n.length-1]*o}}else{const o=Jc(n);t=Math.sqrt(o),r=Math.sqrt(o)}return[t,r]}class Bs extends Mi{constructor(e){if(super(),e.scale<0)throw new se(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,yde(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,bde(this.distribution),this.seed=e.seed}apply(e,t){const r=wde(e),o=r[0],s=r[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,o):this.mode==="fanOut"?i/=Math.max(1,s):i/=Math.max(1,(o+s)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Gt(`${this.getClassName()} does not support dType ${t}.`);return J$(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*i);return B1(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Bs.className="VarianceScaling";Le(Bs);class Fk extends Bs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Bs.className}}Fk.className="GlorotUniform";Le(Fk);class Pk extends Bs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Bs.className}}Pk.className="GlorotNormal";Le(Pk);class Mk extends Bs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Bs.className}}Mk.className="HeNormal";Le(Mk);class Ok extends Bs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Bs.className}}Ok.className="HeUniform";Le(Ok);class Lk extends Bs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Bs.className}}Lk.className="LeCunNormal";Le(Lk);class Bk extends Bs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Bs.className}}Bk.className="LeCunUniform";Le(Bk);class aP extends Mi{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ve(()=>{if(e.length<2)throw new Gt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const r=De(e.slice(0,-1)),o=e[e.length-1],s=r*o;s>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${s}) elements: Slowness may result.`);const i=[Math.max(o,r),Math.min(o,r)],a=cy(i,0,1,t,this.seed),l=_le.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(o,r)*Math.min(o,r)],[Math.min(o,r)+1]);return c=ae(c,d.sign()),r<o&&(c=c.transpose()),ae(Nn(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}aP.className="Orthogonal";Le(aP);const $E={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function FE(n,e={}){return H1(n,Ti.getMap().classNameMap,e,"initializer")}function or(n){return Dk(n)}function Qn(n){if(typeof n=="string"){const e=n in $E?$E[n]:n;if(e==="GlorotNormal")return new Pk;if(e==="GlorotUniform")return new Fk;if(e==="HeNormal")return new Mk;if(e==="HeUniform")return new Ok;if(e==="LeCunNormal")return new Lk;if(e==="LeCunUniform")return new Bk;{const t={};return t.className=e,t.config={},FE(t)}}else return n instanceof Mi?n:FE(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GC(n){return Array.isArray(n)&&Array.isArray(n[0])}function Zx(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Mt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new se(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function xn(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new se(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qx(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((r,o)=>r*o);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const PE="Variable";class Cde{constructor(e,t="float32",r=PE,o=!0,s=null){this.dtype=t??"float32",this.shape=e.shape,this.id=KF(),r=r??PE,this.originalName=YF(r),this.name=ZF(this.originalName),this.trainable_=o,this.constraint=s,this.val=_ae(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),kde(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function kde(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function qC(n){return n.map(e=>e.read())}function jk(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pr{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class fl{constructor(e,t,r,o,s,i,a){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=o,this.callArgs=s,this.outputTensorIndex=a,this.id=KF(),i!=null&&(this.originalName=YF(i),this.name=ZF(this.originalName)),this.rank=t.length}}let Sde=0,uy=class{constructor(e,t){this.callArgs=t,this.id=Sde++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},Nde=0;class Jt extends Bf{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Nde++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const r=this.getClassName();t=zl(r)+"_"+ly(r)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let s=null;e.batchSize!=null&&(s=e.batchSize),r=[s].concat(e.inputShape)}this.batchInputShape=r;let o=e.dtype;o==null&&(o=e.inputDType),o==null&&(o="float32"),this.dtype=o}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Di(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new se(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return us(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return us(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Wa(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Wa(`Layer ${this.name} is not connected, no input to return.`);return us(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Wa(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Wa(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return us(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Dn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=Dn(this.inputSpec);if(t.length!==r.length)throw new se(`Layer ${this.name} expects ${r.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let o=0;o<t.length;o++){const s=t[o],i=r[o];if(i==null)continue;const a=s.rank;if(i.ndim!=null&&a!==i.ndim)throw new se(`Input ${o} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new se(`Input ${o} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new se(`Input ${o} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&s.dtype!==i.dtype)throw new se(`Input ${o} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${s.dtype}.`);if(i.axes){const l=s.shape;for(const c in i.axes){const u=Number(c),d=i.axes[c],h=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(h)===-1)throw new se(`Input ${o} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const c=i.shape[l],u=s.shape[l];if(c!=null&&u!=null&&c!==u)throw new se(`Input ${o} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${s.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const r=Dn(e),o=Tde(e),s=Rde(e);if(o===s)throw new se("Arguments to apply() must be all SymbolicTensors or all Tensors");return ud(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of Dn(e))i.push(a.shape);this.build(us(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(e),s){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);const a=Dn(i),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(i=us(l),this.activityRegularizer!=null)throw new Gt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=Ide(e),a=this.computeOutputShape(i);let l;const c=Ede(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new fl(c,u,this,Dn(e),t,this.name,d)):l=new fl(c,a,this,Dn(e),t,this.name),this.addInboundNode(e,l,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new Gt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&e[o]!=null&&e[o]!==r&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Wa(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const r=JSON.stringify(t.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Wa(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Di(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Qx(this.weights)}build(e){this.built=!0}getWeights(e=!1){return qC(e?this.trainableWeights:this.weights)}setWeights(e){ve(()=>{const t=this.weights;if(t.length!==e.length)throw new se(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const r=[],o=qC(t);for(let s=0;s<o.length;++s){const i=o[s],a=t[s],l=e[s];if(!In(i.shape,l.shape))throw new se(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}jk(r)})}addWeight(e,t,r,o,s,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new se(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=l!=null?l():Qn("zeros"));const c=o.apply(t,r),u=new Cde(c,r,e,i,a);return c.dispose(),s!=null&&this.addLoss(()=>s.apply(u.read())),i==null&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Dn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,r){if(!this.supportsMasking)return;const o=this.computeMask(e,r),s=Dn(t),i=Dn(o);if(s.length!==i.length)throw new Error(`${this.name} outputs ${s.length} tensors but ${s.length} masks for those tensors`);for(let a=0;a<s.length;a++)s[a].kerasMask=i[a]}addInboundNode(e,t,r,o,s,i,a=null){const l=Dn(e);t=Dn(t),r=Dn(r),o=Dn(o),s=Zx(s),i=Zx(i);const c=[],u=[],d=[];for(const h of l)c.push(h.sourceLayer),u.push(h.nodeIndex),d.push(h.tensorIndex);new uy({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:t,inputMasks:r,outputMasks:o,inputShapes:s,outputShapes:i},a);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function Ide(n){n=Dn(n);const e=[];for(const t of n)e.push(t.shape);return us(e)}function Ede(n){return"float32"}function lP(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const r=e.inboundNodes[t];if(r.inboundLayers.length===0)return r.inputTensors;{const o=[];for(let s=0;s<r.inboundLayers.length;s++){const i=r.inputTensors[s],a=r.inboundLayers[s],l=r.nodeIndices[s],c=lP(i,a,l);for(const u of c)o.indexOf(u)===-1&&o.push(u)}return o}}}function Tde(n){let e=!0;for(const t of Dn(n))if(!(t instanceof fl)){e=!1;break}return e}function Rde(n){let e=!0;for(const t of Dn(n))if(t instanceof fl){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class X1 extends Jt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:ly("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new se("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new se("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new se("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=t,this.dtype=r,this.inputSpec=[{shape:t}];const o=new fl(this.dtype,this.batchInputShape,this,[],{},this.name);o.nodeIndex=0,o.tensorIndex=0,new uy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new se(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}X1.className="InputLayer";Le(X1);function Dde(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new se("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new X1({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ade(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return nt(e,n.dtype)}catch{throw new se(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Hc{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Hc)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Ade(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new se(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof fl){if(this.id2Value[e.id]==null)throw new se(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new se(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof fl){if(this.id2Value[e.id]==null)throw new se(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new se(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&rn(this.id2Mask)}}const Jx=new HF,ev=new HF;function _de(n){Jx?.setMaxEntries(n),ev?.setMaxEntries(n)}function zp(n,e,t,r){const o=t==null?!1:t.training,s=Array.isArray(n),i=s?n:[n],a=i.map(g=>g.name),l=[],c=e.names();for(const g of a)c.indexOf(g)!==-1?l.push(e.getValue(g)):l.push(null);const u=a.join(",")+"|"+e.names().sort().join(",");let d=Jx.get(u),h;if(d==null){const g=$de(i,e);d=g.sorted,h=g.recipientCounts,Jx.put(u,d),ev.put(u,h)}h={},o||Object.assign(h,ev.get(u));const p=new Hc(e);for(let g=0;g<d.length;++g){const x=d[g],y=x.sourceLayer;if(y instanceof X1)continue;const b=[],C=[],S=[];let k=!1;for(const T of x.inputs){const D=p.getValue(T),A=p.getMask(T);b.push(D),C.push(A),A!=null&&(k=!0),o||(h[T.name]--,h[T.name]===0&&!e.hasKey(T)&&a.indexOf(T.name)===-1&&!D.isDisposed&&T.sourceLayer.stateful!==!0&&S.push(D))}k&&(t=t||{},t.mask=C[0]);const N=Dn(y.apply(b,t));let E=null;y.supportsMasking&&(E=y.computeMask(b,C));const _=Pde(x),$=Array.isArray(_)?_:[_];for(let T=0;T<$.length;++T){p.hasKey($[T])||p.add($[T],N[T],Array.isArray(E)?E[0]:E);const D=a.indexOf($[T].name);D!==-1&&(l[D]=N[T])}o||rn(S)}return p.disposeMasks(),s?l:l[0]}function $de(n,e){K(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],r={};if(n.length===1){const o=ME(n[0],e);t=o.sorted,r=o.recipientMap}else{const o=new Set;for(const s of n){const{sorted:i,recipientMap:a}=ME(s,e);for(const l of i)o.has(l.name)||(t.push(l),o.add(l.name));for(const l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:t,recipientCounts:Fde(r)}}function Fde(n){const e={};for(const t in n)e[t]=n[t].size;return e}function ME(n,e){const t=new Set,r=[],o={};for(const a of e.names())t.add(a);const s=[],i=[];for(s.push(n);s.length>0;){const a=s[s.length-1];if(t.has(a.name)){s.pop();continue}const l=i[i.length-1]===s.length-1;if(a.inputs.length===0||l)s.pop(),r.push(a),t.add(a.name),l&&i.pop();else{i.push(s.length-1);for(const c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!t.has(c.name)&&s.push(c)}}return{sorted:r,recipientMap:o}}function Pde(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(const o of n.sourceLayer.inboundNodes[r].outputTensors)if(o.id===n.id){t=r;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mde=Ce();Mde.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,_de);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vk(n,e){return ve(()=>Ro(It(ae(n,n),e,!0)))}class Y1 extends Bf{getConfig(){return{}}}class cP extends Y1{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ve(()=>{const t=Vk(e,this.axis),r=ai(t,0,this.maxValue);return ae(e,Et(r,Ue(Fr(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}cP.className="MaxNorm";Le(cP);class uP extends Y1{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ve(()=>Et(e,Ue(Fr(),Vk(e,this.axis))))}getConfig(){return{axis:this.axis}}}uP.className="UnitNorm";Le(uP);class dP extends Y1{apply(e){return Bd(e)}}dP.className="NonNeg";Le(dP);class hP extends Y1{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ve(()=>{const t=Vk(e,this.axis),r=Ue(ae(this.rate,ai(t,this.minValue,this.maxValue)),ae(1-this.rate,t));return ae(e,Et(r,Ue(Fr(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}hP.className="MinMaxNorm";Le(hP);const OE={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Mr(n){return Dk(n)}function LE(n,e={}){return H1(n,Ti.getMap().classNameMap,e,"constraint")}function Or(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in OE?OE[n]:n,config:{}};return LE(t)}else return n instanceof Y1?n:LE(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function qu(n){if(n==null)return;const e=[],t=[],r=[];for(const o in n){const s=n[o];if(typeof s!="number"){const i=s;e.push(i.data()),t.push(o),r.push(i)}}if(e.length>0){const o=await Promise.all(e);for(let s=0;s<o.length;++s)n[t[s]]=o[s][0];rn(r)}}function fP(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var BE;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(BE||(BE={}));const Ode=125;class xm{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class Lde{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class Bde extends xm{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const r=t.size==null?0:t.size;this.seen+=r;for(const o in t){const s=t[o];if(typeof s=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+s*r;else{let i;o in this.totals?i=this.totals[o]:this.totals[o]=0;const a=ve(()=>Ue(this.totals[o],ae(s,r)));this.totals[o]=a,i?.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?t[r]=this.totals[r]/this.seen:ve(()=>{const o=ae(Et(1,this.seen),this.totals[r]);t[r]=o,this.totals[r].dispose(),rl(t[r])}))}}class jde extends xm{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const r in t)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(t[r])}async syncData(){const e=[],t=[],r=[];for(const s in this.history){const i=this.history[s];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),t.push(s),r.push(a)}}const o=await Promise.all(e);for(let s=0;s<o.length;++s)this.history[t[s]][r[s]].dispose(),this.history[t[s]][r[s]]=o[s][0]}}class Vde extends xm{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||vF,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Ode),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");kC(this.yieldEvery)&&(this.maybeWait=ede(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,r){const o=[];this.yield!=null&&(await qu(r),o.push(this.yield(e,t,r))),o.push(this.nextFrameFunc()),await Promise.all(o)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await qu(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const r=[];this.epochEnd!=null&&(await qu(t),r.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,t){this.batchBegin!=null&&(await qu(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const r=[];this.batchEnd!=null&&(await qu(t),r.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):kC(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await qu(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await qu(e),await this.trainEnd(e))}}function pP(n,e){return n==null&&(n={}),n instanceof xm?[n]:Array.isArray(n)&&n[0]instanceof xm?n:Dn(n).map(r=>new Vde(r,e))}class Ni{constructor(){}static registerCallbackConstructor(e,t){K(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Ni.checkForDuplicate(t),Ni.constructors[e]==null&&(Ni.constructors[e]=[]),Ni.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Ni.constructors)Ni.constructors[+t].forEach(o=>{if(o===e)throw new se("Duplicate callback constructor.")})}static clear(){Ni.constructors={}}static createCallbacks(e){const t=[];for(const r in Ni.constructors){const o=+r;e>=o&&t.push(...Ni.constructors[o])}return t.map(r=>new r)}}Ni.constructors={};function mP(n,e,t,r,o,s,i,a,l){const c=new jde,u=[new Bde,...Ni.createCallbacks(e)];n!=null&&u.push(...n),u.push(c);const d=new Lde(u);return d.setParams({epochs:t,initialEpoch:r,samples:o,steps:s,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gl(n,e={},t=!1){return H1(n,Ti.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tv(n,e){return ve(()=>{n.dtype!=="float32"&&(n=nt(n,"float32"));const t=It(q1(n),e,!0),r=ey(t.shape,Fr()),o=Ro(xu(t,r));return Et(n,o)})}function dy(n,e){return ve(()=>Sr(q1(_t(e,n)),-1))}function zk(n,e){return ve(()=>Sr(Wo(_t(e,n)),-1))}function Wk(n,e){return ve(()=>{const t=_t(n,e),r=ai(Wo(n),Fr(),Number.MAX_VALUE),o=Wo(Et(t,r));return ae(100,Sr(o,-1))})}function zde(n,e){return ve(()=>{const t=ai(e,Fr(),Number.MAX_VALUE),r=hl(Ue(1,t)),o=ai(n,Fr(),Number.MAX_VALUE),s=hl(Ue(1,o));return Sr(q1(_t(r,s)),-1)})}function Wde(n,e){return ve(()=>{const t=xu(0,_t(1,ae(n,e)));return Sr(q1(t),-1)})}function Ude(n,e){return ve(()=>{const t=xu(0,_t(1,ae(n,e)));return Sr(t,-1)})}function Hde(n,e){return ve(()=>{const t=It(ae(n,e),-1),r=ca(ae(_t(1,n),e),-1);return xu(0,Ue(1,_t(r,t)))})}function Gde(n,e){return ve(()=>{const t=Math.log(2),r=_t(e,n),o=_t(Ue(r,L1(ae(-2,r))),t);return Sr(o,-1)})}function vm(n,e,t=!1){return ve(()=>{if(t)e=q6(e);else{const r=It(e,e.shape.length-1,!0);e=Et(e,r)}return e=ai(e,Fr(),1-Fr()),gr(It(ae(nt(n,"float32"),hl(e)),e.shape.length-1))})}function nv(n,e,t=!1){return ve(()=>{const r=nt(ry(hde(n)),"int32");e=ai(e,Fr(),1-Fr());const o=e.shape,s=pe(V$(r,o[o.length-1]),o);return vm(s,e,t)})}function qde(n,e){if(!In(n.shape,e.shape))throw new se(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ve(()=>{const t=Bd(e),r=gr(Wo(e));return Ue(_t(t,ae(e,n)),O$(dl(r)))})}function hy(n,e){return ve(()=>{let t;return t=ai(e,Fr(),1-Fr()),t=hl(Et(t,_t(1,t))),Sr(qde(n,t),-1)})}function Kde(n,e){return ve(()=>{const t=ai(n,Fr(),1),r=ai(e,Fr(),1);return It(ae(n,hl(Et(t,r))),-1)})}function Xde(n,e){return ve(()=>{const t=hl(Ue(Fr(),e));return Sr(_t(e,ae(n,t)),-1)})}function gP(n,e){return ve(()=>{const t=tv(n,-1),r=tv(e,-1),o=ae(t,r);return gr(It(o,-1))})}const rv={meanSquaredError:dy,meanAbsoluteError:zk,meanAbsolutePercentageError:Wk,meanSquaredLogarithmicError:zde,squaredHinge:Wde,hinge:Ude,categoricalHinge:Hde,logcosh:Gde,categoricalCrossentropy:vm,sparseCategoricalCrossentropy:nv,binaryCrossentropy:hy,kullbackLeiblerDivergence:Kde,poisson:Xde,cosineProximity:gP};function C3(n){if(typeof n=="string"){if(n in rv)return rv[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new se(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xP(n,e){return ve(()=>{const t=ae(.5,$i(e)),r=sl(ui(e,t),n.dtype);return Sr(ul(n,r),-1)})}function vP(n,e){return ve(()=>sl(ul(hm(n,-1),hm(e,-1)),"float32"))}function Yde(n,e){return ve(()=>nt(It(Yl(ul(n,1),ul(e,1))),"float32"))}function Zde(n,e){return ve(()=>nt(It(Yl(ul(n,0),ul(e,1))),"float32"))}function Qde(n,e){return ve(()=>{const t=Yde(n,e),r=Zde(n,e),o=Ue(t,r);return nt(Zo(ui(o,0),Et(t,o),0),"float32")})}function Jde(n,e){return hy(n,e)}function ehe(n,e){return n.rank===e.rank&&(n=j1(n,[n.rank-1])),e=hm(e,-1),e.dtype!==n.dtype&&(e=nt(e,n.dtype)),nt(ul(n,e),"float32")}const the=dy,nhe=dy,rhe=zk,ohe=zk,she=Wk,ihe=Wk,yP=vm,ahe=gP,bP=nv,ov={binaryAccuracy:xP,categoricalAccuracy:vP,precision:Qde,categoricalCrossentropy:yP,sparseCategoricalCrossentropy:bP,mse:the,MSE:nhe,mae:rhe,MAE:ohe,mape:she,MAPE:ihe,cosine:ahe};function lhe(n){if(typeof n=="string"&&n in ov)return ov[n];if(typeof n!="string"&&n!=null)return n;throw new se(`Unknown metric ${n}`)}function j0(n){if(Ua(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(rv))if(rv[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(ov))if(ov[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function che(n){const e={Adagrad:()=>Fh.adagrad(.01),Adadelta:()=>Fh.adadelta(1,.95,Fr()),Adam:()=>Fh.adam(.001,.9,.999,Fr()),Adamax:()=>Fh.adamax(.002,.9,.999,Fr(),0),RMSProp:()=>Fh.rmsprop(.001,.9,0,Fr()),SGD:()=>Fh.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new se(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jE=1*1024*1024;function VE(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!KC(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const r=JSON.stringify(n);r.length>jE&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${jE}.`)}}function KC(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!KC(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!KC(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uhe(n,e,t,r=console.log){const o=hhe(n),s=["Layer (type)","Input Shape","Output shape","Param #"];o?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(u=>Math.floor(e*u)));let i;if(!o){s.push("Receives inputs"),i=[];for(const u in n.nodesByDepth)i.push(...n.nodesByDepth[u])}r("_".repeat(e)),sv(s,t,r),r("=".repeat(e));const a=n.layers;for(let u=0;u<a.length;++u)o?fhe(a[u],t,r):phe(a[u],t,i,r),r((u===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=dhe(n),c=Qx(n.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(e))}function dhe(n){let e;return n.collectedTrainableWeights!=null?e=Qx(n.collectedTrainableWeights):e=Qx(n.trainableWeights),e}function hhe(n){let e=!0;const t=[],r=[];for(const o in n.nodesByDepth)t.push(n.nodesByDepth[o]);for(const o of t){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){e=!1;break}r.push(...o)}if(e)for(const o of n.layers){let s=!1;for(const i of o.inboundNodes)if(r.indexOf(i)!==-1)if(s){e=!1;break}else s=!0;if(!e)break}return e}function sv(n,e,t=console.log){let r="";for(let o=0;o<n.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=n[o],r=r.slice(0,e[o]),r+=" ".repeat(e[o]-r.length);t(r)}function fhe(n,e,t){let r,o;try{o=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const s=n.name,i=n.getClassName(),a=[`${s} (${i})`,o,r,n.countParams().toString()];sv(a,e,t)}function phe(n,e,t,r){let o,s;try{s=n.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{s="multiple"}try{o=JSON.stringify(n.outputShape)}catch{o="multiple"}const i=[];for(const d of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(d)===-1))for(let h=0;h<d.inboundLayers.length;++h){const p=d.inboundLayers[h].name,g=d.nodeIndices[h],x=d.tensorIndices[h];i.push(`${p}[${g}][${x}]`)}const a=n.name,l=n.getClassName(),c=i.length===0?"":i[0],u=[`${a} (${l})`,s,o,n.countParams().toString(),c];sv(u,e,r);for(let d=1;d<i.length;++d)sv(["","","","",i[d]],e,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wP(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function XC(n,e){if(n===null)return null;if(typeof n=="string")return ed(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let o=0;o<r;++o){const s=n[o];wP(e,o,s)?t.push(s):t.push(XC(s,e))}return t}else{const t={};for(const r of Object.keys(n)){const o=n[r];if(r==="name"&&typeof o=="string")t[r]=o;else{const s=ed(r);t[s]=XC(o,s)}}return t}}function YC(n,e){if(n==null)return null;if(typeof n=="string")return zl(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let o=0;o<r;++o){const s=n[o];wP(e,o,s)?t.push(s):t.push(YC(s,e))}return t}else{const t={};for(const r of Object.keys(n)){const o=n[r],s=zl(r);(r==="name"||r==="className")&&typeof o=="string"?t[s]=o:t[s]=YC(o,r)}return t}}/** @license See the LICENSE file. */const CP="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mhe=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class ea extends Jt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=ly(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Qc(this.inputs).length!==this.inputs.length)throw new se(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);Qc(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const S=C.sourceLayer,k=C.nodeIndex,N=C.tensorIndex;this.outputLayers.push(S),this.outputLayersNodeIndices.push(k),this.outputLayersTensorIndices.push(N)}for(const C of this.inputs){const S=C.sourceLayer,k=C.nodeIndex,N=C.tensorIndex;Ua(k===0,"input layer has >1 nodes"),Ua(N===0,"input layer has >1 tensors"),this.inputLayers.push(S),this.inputLayersNodeIndices.push(k),this.inputLayersTensorIndices.push(N)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const S=this.inputLayers[C];if(!(S instanceof X1))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${C} (0-based) originates from layer type ${S.getClassName()}.`);this.inputNames.push(S.name),this.feedInputShapes.push(S.batchInputShape),this.feedInputNames.push(S.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const t={},r={},o={},s={},i={},a=[],l=(C,S,k,N,E,_)=>{(N==null||E==null||_==null)&&(N=C.sourceLayer,E=C.nodeIndex,_=C.tensorIndex);const $=N.inboundNodes[E];if(k.indexOf($)!==-1)throw new Di(`The tensor ${C.name} at layer "${N.name}" is part of a cycle.`);if(S.indexOf($)!==-1)return;this.containerNodes.add(ea.nodeKey(N,E)),N.id in i||(i[N.id]=Object.keys(i).length),k.indexOf($)===-1&&k.push($);const T=$.inboundLayers.length;for(let D=0;D<T;D++){const A=$.inputTensors[D],M=$.inboundLayers[D],j=$.nodeIndices[D],L=$.tensorIndices[D];l(A,S,k,M,j,L)}for(S.push($);k.indexOf($)>=0;)k.splice(k.indexOf($),1);a.push($)},c=[],u=[];for(const C of this.outputs)l(C,c,u);const d=a.slice().reverse();for(const C of d){r[C.id]=C,C.id in t||(t[C.id]=0);let S=t[C.id];const k=o[C.outboundLayer.id]==null?0:o[C.outboundLayer.id];S=Math.max(S,k),o[C.outboundLayer.id]=S,s[C.outboundLayer.id]=C.outboundLayer,t[C.id]=S;for(let N=0;N<C.inboundLayers.length;N++){const E=C.inboundLayers[N],_=C.nodeIndices[N],$=E.inboundNodes[_],T=t[$.id]==null?0:t[$.id];t[$.id]=Math.max(S+1,T),r[$.id]=$}}const h={};for(const C in t){const S=t[C];S in h||(h[S]=[]),h[S].push(r[C])}const p={};for(const C in o){const S=o[C];S in p||(p[S]=[]),p[S].push(s[C])}let g=Object.keys(p).map(C=>parseInt(C,10)).sort(O0);this.layers=[];for(const C of g){const S=p[C];S.sort((k,N)=>{const E=i[k.id],_=i[N.id];return E<_?-1:E>_?1:0});for(const k of S)k instanceof ea&&this.internalContainerRefs.push(k),this.layers.push(k)}this.layersByDepth=p,g=Object.keys(h).map(C=>parseInt(C,10)).sort(O0);const x=this.inputs.slice(),y=[];for(const C of g)for(const S of h[C]){const k=S.outboundLayer;if(k!=null){for(const N of S.inputTensors)if(x.indexOf(N)===-1)throw new Di(`Graph disconnected: cannot obtain value for tensor ${N} at layer "${k.name}". The following previous layers were accessed without issue: ${y}`);for(const N of S.outputTensors)x.push(N);y.push(k.name)}}this.nodesByDepth=h;const b=this.layers.map(C=>C.name);for(const C of b){const S=b.filter(k=>k===C).length;if(S!==1)throw new Di(`The name "${C}" is used ${S} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(b))}this.outboundNodes=[],this.inboundNodes=[],new uy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new se("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.layers)t.push(...r.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const r={};let o=0;const s=mhe(e);s&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=s?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(r[u]!=null)throw new se(`Duplicate weight name: ${u}`);r[u]=c,o++}const i=[];for(const a in e){let l=a;if(r[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(r[l]!=null)i.push([r[l],e[a]]);else if(t)throw new se(`Provided weight data has no target variable: ${a}`);delete r[l]}if(t){const a=[];for(const l in r)a.push(l);if(a.length>0)throw new se(`${a.length} of ${o} weights are not set: ${a}`)}jk(i)}parseWeights(e){for(const t in Object.keys(e)){const r=t.split("/"),o=["vars","layer_checkpoint_dependencies"],s=r.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!o.includes(i)).join("/");s!==t&&(e[s]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${CP}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const r=YC(this.updatedConfig());return t?JSON.stringify(r):r}call(e,t){return ve(()=>{e=Dn(e);const r=new Hc;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],e[o]);return zp(this.outputs,r,t)})}computeMask(e,t){return ve(()=>{e=Dn(e);let r;return t==null?r=Id(null,e.length):r=Dn(t),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const t=Zx(e);if(t.length!==this.inputLayers.length)throw new se(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],c=t[a],u=l.name+"_0_0";r[u]=c}const o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(O0);if(o.length>1)for(const a of o){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(x=>x.id).indexOf(u.id)!==-1)continue;const d=[];for(let x=0;x<c.inboundLayers.length;x++){const y=c.inboundLayers[x],b=c.nodeIndices[x],C=c.tensorIndices[x],S=`${y.name}_${b}_${C}`,k=r[S];d.push(k)}const h=u.computeOutputShape(us(d)),p=Zx(h),g=u.inboundNodes.indexOf(c);for(let x=0;x<p.length;x++){const y=`${u.name}_${g}_${x}`;r[y]=p[x]}}}const s=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;i.push(d)}for(let a=0;a<i.length;a++){const l=i[a];Ua(l in r),s.push(r[l])}return us(s)}runInternalGraph(e,t){t==null&&(t=Id(null,e.length));const r={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],d=t[l];r[c.id]=[u,d]}const o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(O0);for(const l of o){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,h=u.inputTensors,p=u.outputTensors,g=new Array;for(const x of h)x.id in r&&g.push(r[x.id]);if(g.length===h.length){let x={},y,b,C,S;if(u.callArgs!=null&&(x=u.callArgs),g.length===1){const[k,N]=g[0];x.mask==null&&(x.mask=N),C=Dn(d.call(k,x)),S=Dn(d.computeMask(k,N)),y=[k],b=[N]}else y=g.map(k=>k[0]),b=g.map(k=>k[1]),x.mask==null&&(x.mask=b),C=Dn(d.call(y,x)),S=Dn(d.computeMask(y,b));if(d.activityRegularizer)throw new Gt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let k=0;k<p.length;++k){const N=p[k],E=C[k],_=S[k];r[N.id]=[E,_]}}}}const s=[],i=[],a=[];for(const l of this.outputs){Ua(l.id in r,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=r[l.id];a.push(c.shape),s.push(c),i.push(u)}return[s,i,a]}buildNodeConversionMap(e){const t={};let r;for(const o of this.layers){r=o instanceof ea?1:0;for(let s=0;s<o.inboundNodes.length;s++){const i=ea.nodeKey(o,s);this.containerNodes.has(i)&&(t[i]=r,r+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new se("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const r of this.layers)if(r.name===e)return r;throw new se(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new se(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ve(()=>{const e=[];for(const t of this.layers)for(let r=0;r<t.inboundNodes.length;++r){const o=ea.nodeKey(t,r);this.containerNodes.has(o)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),r=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),c=[];for(let d=0;d<i.inboundNodes.length;d++){const h=i.inboundNodes[d],p=ea.nodeKey(i,d);let g={};if(this.containerNodes.has(p)){if(h.callArgs)try{JSON.stringify(h.callArgs),g=h.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),g={}}if(h.inboundLayers.length>0){const x=[];for(let y=0;y<h.inboundLayers.length;y++){const b=h.inboundLayers[y],C=h.nodeIndices[y],S=h.tensorIndices[y],k=ea.nodeKey(b,C);let N=t[k];N==null&&(N=0),x.push([b.name,N,S,g])}c.push(x)}}}const u={};u.name=i.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}e.layers=r;const o=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],c=ea.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=t[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[i];o.push([a.name,u,d])}e.inputLayers=o;const s=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],c=ea.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=t[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[i];s.push([a.name,u,d])}return e.outputLayers=s,e}static fromConfig(e,t,r={},o=!1){const s={},i={};function a(y,b){y.name in i?i[y.name].push(b):i[y.name]=[b]}function l(y,b){const C=[];let S;for(const k of b){const N=k[0],E=k[1],_=k[2];if(S=k[3]==null?{}:k[3],!(N in s)){a(y,b);return}const $=s[N];if($.inboundNodes.length<=E){a(y,b);return}const T=$.inboundNodes[E];C.push(T.outputTensors[_])}C.length>0&&y.apply(us(C),S)}function c(y){const b=y.name,C=Gl(y,t.customObjects!=null?t.customObjects:{});C.setFastWeightInitDuringBuild(o),s[b]=C,y.inboundNodes.forEach(k=>{if(!(k instanceof Array))throw new se(`Corrupted configuration, expected array for nodeData: ${k}`);a(C,k)})}const u=t.name,d=t.layers;for(const y of d)c(y);for(;!Jue(i);)for(const y of d){const b=s[y.name];if(b.name in i){const C=i[b.name];delete i[b.name];for(const S of C)l(b,S)}}const h=[],p=[],g=t.inputLayers;for(const y of g){const b=y[0],C=y[1],S=y[2];Ua(b in s);const N=s[b].inboundNodes[C].outputTensors;h.push(N[S])}const x=t.outputLayers;for(const y of x){const b=y[0],C=y[1],S=y[2];Ua(b in s);const N=s[b].inboundNodes[C].outputTensors;p.push(N[S])}return new e({inputs:h,outputs:p,name:u})}get stateful(){if(this._stateful)throw new se("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ve(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ghe(n,e,t){const r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(o=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const o=[];return e.forEach(s=>{s in n?o.push(n[s]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${t} must be either an array with ${r} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function kP(n,e){return ghe(n,e,"classWeight")}async function SP(n,e,t,r){if(t!=null){const o=ve(()=>{if(n.shape.length===1)return cd(n);if(n.shape.length===2){if(n.shape[1]>1)return hm(n,1);if(n.shape[1]===1)return pe(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await o.data());rn(o);const i=[];return s.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),Fs(i,"float32")}else return null}function xhe(n,e){return ae(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const vhe=32;function NP(n,e){let t,r;const o=e;t=o.xs,r=o.ys,K(t!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const s=zE("input",n.inputNames,t),i=zE("output",n.outputNames,r),a=s[0].shape[0];K(s.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),K(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<s.length;l++)K(s[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<i.length;l++)K(i[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:s,ys:i}}function zE(n,e,t){if(t instanceof _r)return[t];if(Array.isArray(t))return K(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const r=[];for(const o of e){if(t[o]==null)throw new se(`The feature data generated by the dataset lacks the required ${n} key '${o}'.`);r.push(t[o])}return r}}function yhe(n){if(n.length===3)throw new Gt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function bhe(n,e,t){const r=t.batchesPerEpoch!=null;if(K(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),K(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),K(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),K(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),K(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const o=t.validationData!=null;let s,i;if(o)if(WE(t.validationData))K(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const y=yhe(t.validationData);s=y.xs,i=y.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let c;o?c=l.slice().concat(l.map(y=>"val_"+y)):c=l.slice();const u=pP(t.callbacks,t.yieldEvery),d=t.verbose==null?1:t.verbose,{callbackList:h,history:p}=mP(u,d,t.epochs,null,null,whe(e,t),null,o,c);h.setModel(n),n.history=p,await h.onTrainBegin(),n.stopTraining_=!1;let g=t.initialEpoch==null?0:t.initialEpoch,x=await e.iterator();for(;g<t.epochs;){const y={};await h.onEpochBegin(g);let b=0,C=0;for(r||(x=await e.iterator());!r||b<t.batchesPerEpoch;){const S=await x.next();if(r&&S.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${b} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(S.value!=null){const{xs:k,ys:N}=NP(n,S.value),E={};E.batch=C,E.size=k[0].shape[0],await h.onBatchBegin(C,E);const _=[];if(t.classWeight!=null){const D=kP(t.classWeight,n.outputNames);for(let A=0;A<D.length;++A)_.push(await SP(N[A],null,D[A]))}const $=k.concat(N).concat(_),T=a($);rn($);for(let D=0;D<l.length;++D){const A=l[D],M=T[D];E[A]=M,rl(M)}await h.onBatchEnd(C,E),fP(E),C++,b++}if(r?b>=t.batchesPerEpoch:S.done){if(o){let k;WE(t.validationData)?k=Dn(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):k=Dn(n.evaluate(s,i,{batchSize:t.validationBatchSize==null?vhe:t.validationBatchSize,verbose:0}));for(let N=0;N<n.metricsNames.length;++N)y[`val_${n.metricsNames[N]}`]=k[N]}break}if(n.stopTraining_)break}if(await h.onEpochEnd(g,y),g++,n.stopTraining_)break}return await h.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function whe(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function WE(n){return typeof n.iterator=="function"}function Che(n){return typeof n.next=="function"}async function khe(n,e,t){t=t||{};const r=t.batches!=null,o=n.testFunction;let s=[];if(t.verbose>0)throw new Gt("Verbose mode is not implemented yet.");K(!r||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=Che(e)?e:await e.iterator();let a=0,l=0;for(;!r||l<t.batches;){const c=await i.next();if(s=ve(()=>{if(c.value){const{xs:u,ys:d}=NP(n,c.value),h=u.concat(d),p=ve(()=>o(h));if(rn(h),l===0)for(let x=0;x<p.length;++x)s.push(Nn(0));const g=h[0].shape[0];for(let x=0;x<p.length;++x){const y=p[x],b=s[x];s[x]=ve(()=>Ue(s[x],ae(g,y))),l>0&&rn(b)}rn(p),a+=g,++l}return s}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<s.length;++c){const u=s[c];s[c]=Et(s[c],a),rn(u)}return us(s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function k3(n){K(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Fp(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(r=>dd(r,e,t-e)):dd(n,e,t-e)}function ZC(n,e){return ve(()=>n==null?null:Array.isArray(n)?n.map(t=>ZC(t,e)):JF(n,e.dtype==="int32"?e:nt(e,"int32")))}function S3(n,e){const t=[];let r=0,o=null;for(;r<n;)o=r+e,o>=n&&(o=n),t.push([r,o]),r=o;return t}function IP(n){const e=[];n instanceof _r&&(n=[n]);for(let t=0;t<n.length;++t){const r=n[t];if(r.rank===1)e.push(G1(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function Qi(n,e){if(n==null)return;const t=[];if(e instanceof _r)t.push(e.id);else if(Array.isArray(e))e.forEach(o=>t.push(o.id));else if(e!=null)for(const o in e){const s=e[o];t.push(s.id)}const r=[];if(n instanceof _r)t.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(o=>{t.indexOf(o.id)===-1&&r.push(o)});else if(n!=null)for(const o in n){const s=n[o];t.indexOf(s.id)===-1&&r.push(s)}r.forEach(o=>{o.isDisposed||o.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function She(n){return n instanceof _r}function QC(n){return Array.isArray(n)}function UE(n){return!She(n)&&!QC(n)}function HE(n,e,t,r=!0,o=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(QC(n)&&n.length>0)i=!0;else if(UE(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new se(`Error when checking model ${o} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let s;if(UE(n)){n=n,s=[];for(const i of e){if(n[i]==null)throw new se(`No data provided for "${i}". Need data for each key in: ${e}`);s.push(n[i])}}else if(QC(n)){if(n=n,n.length!==e.length)throw new se(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);s=n}else{if(n=n,e.length>1)throw new se(`The model ${o} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);s=[n]}if(s=IP(s),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=s[i];if(a.shape.length!==t[i].length)throw new se(`Error when checking ${o}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[i].length;++l){if(l===0&&!r)continue;const c=a.shape[l],u=t[i][l];if(u!=null&&u>=0&&c!==u)throw new se(`${o} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${o} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function Nhe(n,e,t){const r=Qc(n.map(s=>s.shape[0]));r.sort();const o=Qc(e.map(s=>s.shape[0]));if(o.sort(),r.length>1)throw new se(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(s=>s.shape))}`);if(o.length>1)throw new se(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(r.length>0&&o.length>0&&!In(r,o))throw new se(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function Ihe(n,e,t){const r=[dy,hy,vm];for(let o=0;o<n.length;++o){const s=n[o],i=e[o],a=t[o];if(i!=null){if(i===vm&&s.shape[s.shape.length-1]===1)throw new se(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(i)!==-1){const l=s.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const d=l[u],h=c[u];if(h!=null&&d!==h)throw new se(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function GE(n,e,t,r=!0,o=""){let s;if(Array.isArray(n)){if(n.length!==e.length)throw new se(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);s=n}else{if(e.length>1)throw new se(`The model expects ${e.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);s=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=s[i];if(a.shape.length!==t[i].length)throw new se(`Error when checking ${o}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[i].length;++l){if(l===0&&!r)continue;const c=a.shape[l],u=t[i][l];if(u!=null&&u!==c)throw new se(`Error when checking ${o}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Ehe(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(r=>t);{const r=[];for(const o of e){let s=t.hasOwnProperty(o)?t[o]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}const The="layers-model";class of extends ea{constructor(e){super(e),this.isTraining=!1}summary(e,t,r=console.log){if(!this.built)throw new se("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");uhe(this,e,t,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=che(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof yu))throw new se("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new se(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(C3(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new se(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>C3(a))}else{const i=C3(e.loss);this.outputs.forEach(a=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ud("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(r.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const o=Ehe(e.metrics,this.outputNames),s=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};ud("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(r.indexOf(i)!==-1)continue;const a=o[i];(c=>{let d,h,p;for(const g of c){if(typeof g=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(g)!==-1){const y=this.internalOutputShapes[i];y[y.length-1]===1||this.lossFunctions[i]===hy?["accuracy","acc"].indexOf(g)!==-1?h=xP:["crossentropy","ce"].indexOf(g)!==-1&&(h=Jde):this.lossFunctions[i]===nv?["accuracy","acc"].indexOf(g)!==-1?h=ehe:["crossentropy","ce"].indexOf(g)!==-1&&(h=bP):["accuracy","acc"].indexOf(g)!==-1?h=vP:["crossentropy","ce"].indexOf(g)!==-1&&(h=yP);let b;["accuracy","acc"].indexOf(g)!==-1?b="acc":["crossentropy","ce"].indexOf(g)!==-1&&(b="ce"),p=h,d=""+b}else p=lhe(g),d=""+j0(g);let x;ud(d,()=>{x=p}),s(i,d,x)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,r={}){const o=r.batchSize==null?32:r.batchSize;k3(o);const i=this.standardizeUserDataXY(e,t,!0,o);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,o,r.verbose,r.steps);return us(c)}finally{Qi(i[0],e),Qi(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),khe(this,e,t)}checkNumSamples(e,t,r,o="steps"){let s;if(r!=null){if(s=null,t!=null)throw new se(`If ${o} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new se(`Either the input data should have a defined shape, or ${o} shoud be specified.`);return s}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new se("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(t),o=r?t:[t],s=this.retrieveSymbolicTensors(o),i=new Hc;if(e instanceof _r&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new se(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new se(`No value is provided for the model's input ${l.name}`);i.add(l,c)}const a=zp(s,i);return r?a:a[0]}retrieveSymbolicTensors(e){const t=Id(null,e.length);let r=e.length;for(const o of this.layers){const s=Array.isArray(o.output)?o.output:[o.output],i=s.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(t[a]=s[l],r--),r===0)break}if(r===0)break}if(r>0){const o=[];throw t.forEach((s,i)=>{s==null&&o.push(e[i])}),new se(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(o)}`)}return t}predictLoop(e,t=32,r=!1){return ve(()=>{const o=this.checkNumSamples(e);if(r)throw new Gt("Verbose predictLoop() is not implemented yet.");const s=S3(o,t),i=this.outputs.map(a=>[]);for(let a=0;a<s.length;++a)ve(()=>{const c=s[a][0],u=s[a][1],d=Fp(e,c,u),h=[];if(Array.isArray(d))for(let g=0;g<d.length;++g)h.push({key:this.inputs[g],value:d[g]});else h.push({key:this.inputs[0],value:d});const p=new Hc(h);return zp(this.outputs,p)}).forEach((c,u)=>i[u].push(c));return us(i.map(a=>ds(a,0)))})}predict(e,t={}){const r=IP(e);GE(r,this.inputNames,this.feedInputShapes,!1);try{const o=t.batchSize==null?32:t.batchSize;return k3(o),this.predictLoop(r,o)}finally{Qi(r,e)}}predictOnBatch(e){GE(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,r=!0,o){if(this.optimizer_==null)throw new Di("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const s=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===nv?s.push(a.slice(0,a.length-1).concat([1])):s.push(a)}if(e=HE(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=HE(t,this.feedOutputNames,s,!1,"target"),Nhe(e,t),Ihe(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&o!=null&&o>0&&e[0].shape[0]%o!==0)throw new se(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${o}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,r,o,s=!0,i){const[a,l]=this.standardizeUserDataXY(e,t,s,i);if(r!=null)throw new Error("sample weight is not supported yet.");let c=null;if(o!=null){const u=kP(o,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await SP(l[d],null,u[d]))}return[a,l,c]}testLoop(e,t,r,o=0,s){return ve(()=>{const i=this.checkNumSamples(t,r,s,"steps"),a=[];if(o>0)throw new Gt("Verbose mode is not implemented yet.");if(s!=null)throw new Gt("steps mode in testLoop() is not implemented yet");{const l=S3(i,r),c=Fs(fa(0,i));for(let u=0;u<l.length;++u){const d=l[u][0],h=l[u][1],p=dd(c,d,h-d),g=ZC(t,p),x=e(g);if(u===0)for(let y=0;y<x.length;++y)a.push(Nn(0));for(let y=0;y<x.length;++y){const b=x[y];a[y]=Ue(a[y],ae(h-d,b))}}for(let u=0;u<a.length;++u)a[u]=Et(a[u],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let r=0;r<e.length;++r){const o=e[r];let s=o;if(DE(e,o)>1){const i=DE(e.slice(0,r),o);s+=`_${i}`}t.push(s)}return t}makeTrainFunction(){return e=>{const t=[],r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const d=[];for(let x=0;x<this.inputs.length;++x)d.push({key:this.inputs[x],value:r[x]});const h=new Hc(d),p=zp(this.outputs,h,{training:!0});let g;for(let x=0;x<this.lossFunctions.length;++x){const y=this.lossFunctions[x];let b=y(o[x],p[x]);s[x]!=null&&(b=xhe(b,s[x]));const C=Sr(b);t.push(C),x===0?g=b:g=Ue(g,b)}for(let x=0;x<this.metricsTensors.length;++x){let y;if(this.outputs.length>1&&x<this.outputs.length)y=t[x];else{const b=this.metricsTensors[x][0],C=this.metricsTensors[x][1];y=Sr(b(o[C],p[C]))}rl(y),i.push(y)}return g=Sr(g),this.calculateLosses().forEach(x=>{g=Ue(g,x)}),g},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>ve(()=>{const t=[];let r;const o=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let c=0;c<this.inputs.length;++c)i.push({key:this.inputs[c],value:o[c]});const a=new Hc(i),l=zp(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=Sr(u(s[c],l[c]));c===0?r=d:r=Ue(r,d),t.push(r)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],h=Sr(u(s[d],l[d]));t.push(h)}return t})}async fit(e,t,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let o,s,i,a,l,c,u,d,h;try{const p=r.batchSize==null?32:r.batchSize;k3(p);const x=await this.standardizeUserData(e,t,r.sampleWeight,r.classWeight,!1,p);o=x[0],s=x[1],h=x[2];let y=!1,b;if(r.validationData!=null&&r.validationData.length>0){if(y=!0,r.validationData.length===2)l=r.validationData[0],c=r.validationData[1];else throw r.validationData.length===3?new Gt("validationData including sample weights is not supported yet."):new se(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const D=await this.standardizeUserData(l,c,null,null,!0,p);u=D[0],d=D[1],b=u.concat(d)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){y=!0;const T=Math.floor(o[0].shape[0]*(1-r.validationSplit)),D=o[0].shape[0];u=Fp(o,T,D),i=o,o=Fp(o,0,T),d=Fp(s,T,D),a=s,s=Fp(s,0,T),b=u.concat(d)}else r.validationSteps!=null&&(y=!0);const C=o.concat(s).concat(h);this.checkTrainableWeightsConsistency();const S=this.makeTrainFunction(),k=this.getDedupedMetricsNames();let N,E;y?(this.makeTestFunction(),N=this.testFunction,E=k.slice().concat(k.map(T=>"val_"+T))):(N=null,b=[],E=k.slice());const _=pP(r.callbacks,r.yieldEvery);return await this.fitLoop(S,C,k,p,r.epochs,r.verbose,_,N,b,r.shuffle,E,r.initialEpoch,null,null)}finally{this.isTraining=!1,Qi(o,e),Qi(s,t),Qi(i,e),Qi(a,t),Qi(u,l),Qi(d,c),h!=null&&rn(h)}}async fitLoop(e,t,r,o,s,i,a,l,c,u,d,h,p,g){o==null&&(o=32),s==null&&(s=1),u==null&&(u=!0),h==null&&(h=0);let x=!1;if(l!=null&&c!=null&&(x=!0),g!=null&&(x=!0,p==null))throw new se("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const y=this.checkNumSamples(t,o,p,"steps_per_epoch");let b;y!=null&&(b=fa(0,y)),i==null&&(i=1);const{callbackList:C,history:S}=mP(a,i,s,h,y,p,o,x,d);C.setModel(this),this.history=S,await C.onTrainBegin(),this.stopTraining_=!1;for(let k=h;k<s;++k){await C.onEpochBegin(k);const N={};if(p!=null)throw new Gt("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Gt("batch shuffling is not implemneted yet");u&&lne(b);const E=Fs(b),_=S3(y,o);for(let $=0;$<_.length;++$){const T={};if(await C.onBatchBegin($,T),ve(()=>{const D=_[$][0],A=_[$][1],M=dd(E,D,A-D);T.batch=$,T.size=A-D;const j=ZC(t,M),L=e(j);for(let U=0;U<r.length;++U){const G=r[U],H=L[U];T[G]=H,rl(H)}if($===_.length-1&&x){const U=this.testLoop(l,c,o);for(let G=0;G<r.length;++G){const H=r[G],O=U[G];rl(O),N["val_"+H]=O}}}),await C.onBatchEnd($,T),fP(T),this.stopTraining_)break}E.dispose()}if(await C.onEpochEnd(k,N),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return bhe(this,e,t)}async trainOnBatch(e,t){const r=await this.standardizeUserData(e,t),o=r[0],s=r[1],a=this.makeTrainFunction()(o.concat(s)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return rn(a),Qi(r[0],e),Qi(r[1],t),us(l)}getNamedWeights(e){const t=[],r=e!=null&&e.trainableOnly,o=r?this.trainableWeights:this.weights,s=this.getWeights(r);for(let i=0;i<o.length;++i)r&&!o[i].trainable||t.push({name:o[i].originalName,tensor:s[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=oE().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-oE().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=zl(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>zl(t))}else{const t=Object.keys(this.loss);e={};const r=this.loss;for(const o of t)if(typeof r[o]=="string")e[o]=zl(r[o]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[zl(j0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>zl(j0(e)));{const e={};for(const t in this.metrics)e[t]=zl(j0(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=XC(e.optimizer_config),r=Gl(t);let o;if(typeof e.loss=="string")o=ed(e.loss);else if(Array.isArray(e.loss))o=e.loss.map(i=>ed(i));else if(e.loss!=null){o={};for(const i in e.loss)o[i]=ed(e.loss[i])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(i=>ed(i));else if(e.metrics!=null){s={};for(const i in e.metrics)s[i]=ed(e.metrics[i])}this.compile({loss:o,metrics:s,optimizer:r})}async save(e,t){if(typeof e=="string"){const c=ire(e);if(c.length===0)throw new se(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new se(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new se("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await iE(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:The,generatedBy:`TensorFlow.js tfjs-layers v${CP}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await iE(await this.optimizer.getWeights(),c);r.specs.push(...d),r.data=sre([r.data,u])}return this.userDefinedMetadata!=null&&(VE(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,e.save(a)}setUserDefinedMetadata(e){VE(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}of.className="Model";Le(of);class EP extends of{}EP.className="Functional";Le(EP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ym extends of{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:ly("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new se(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof ym||e instanceof of;let r;if(t){if(r=e,r.outputs.length!==1)throw new se("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new se("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new se("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const o=Dde({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(o)}if(t)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new se(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new se("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=lP(this.outputs[0])}this.inboundNodes=[],new uy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Id(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(o=>o.shape),outputShapes:this.outputs[0].shape})}else{const o=e.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(xn(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new of({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,r=console.log){this.built||this.build(),super.summary(e,t,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,r={}){if(!this.built)throw new Di("The model needs to be compiled before being used.");return this.model.evaluate(e,t,r)}async evaluateDataset(e,t){if(!this.built)throw new Di("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,r={}){if(!this.built)throw new Di("The model needs to be compiled before being used.");return this.model.fit(e,t,r)}async fitDataset(e,t){if(!this.built)throw new Di("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,r={},o=!1){let s,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new se("Legacy serialization format not supported yet.");s=t}else K(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof ym))throw new Gt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of s){const u=Gl(l,void 0,o);o&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new se("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new se("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const r={};r.className=t.getClassName(),r.config=t.getConfig(),e.push(r)}return{name:this.name,layers:e}}}ym.className="Sequential";Le(ym);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Ao=class extends Bf{getConfig(){return{}}};class TP extends Ao{apply(e,t=1){return pde(e,t)}}TP.className="elu";Le(TP);class RP extends Ao{apply(e){return G$(e)}}RP.className="selu";Le(RP);class DP extends Ao{apply(e){return Bd(e)}}DP.className="relu";Le(DP);class AP extends Ao{apply(e){return ve(()=>mm(6,Bd(e)))}}AP.className="relu6";Le(AP);class _P extends Ao{apply(e){return e}}_P.className="linear";Le(_P);class $P extends Ao{apply(e){return Mf(e)}}$P.className="sigmoid";Le($P);class FP extends Ao{apply(e){return gde(e)}}FP.className="hardSigmoid";Le(FP);class PP extends Ao{apply(e){return L1(e)}}PP.className="softplus";Le(PP);class MP extends Ao{apply(e){return mde(e)}}MP.className="softsign";Le(MP);class OP extends Ao{apply(e){return Q2(e)}}OP.className="tanh";Le(OP);let Uk=class extends Ao{apply(e,t=-1){return q6(e,t)}};Uk.className="softmax";Le(Uk);class LP extends Ao{apply(e,t=-1){return L$(e,t)}}LP.className="logSoftmax";Le(LP);class BP extends Ao{apply(e){return ve(()=>ve(()=>{const t=Math.sqrt(2),r=ae(.5,Ue(1,$$(Et(e,t))));return ae(e,r)}))}}BP.className="gelu";Le(BP);class jP extends Ao{apply(e){return ve(()=>ae(.5,ae(e,Ue(1,Q2(ae(Ro(Et(2,Math.PI)),Ue(e,ae(.044715,kd(e,3)))))))))}}jP.className="gelu_new";Le(jP);class VP extends Ao{apply(e){return ve(()=>ae(e,Q2(L1(e))))}}VP.className="mish";Le(VP);class zP extends Ao{apply(e,t=1){return ve(()=>ae(Mf(ae(e,t)),e))}}zP.className="swish";Le(zP);function iu(n){return n.getClassName()}function N3(n,e={}){return H1(n,Ti.getMap().classNameMap,e,"activation")}function au(n){if(n==null){const e={};return e.className="linear",e.config={},N3(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},N3(e)}else return n instanceof Ao?n:N3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rhe(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class WP extends Bf{}class UP extends WP{constructor(e){super(),Rhe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ve(()=>{let t=qr([1]);return this.hasL1&&(t=Ue(t,It(ae(this.l1,Wo(e))))),this.hasL2&&(t=Ue(t,It(ae(this.l2,q1(e))))),pe(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}UP.className="L1L2";Le(UP);const qE={l1l2:"L1L2"};function Mn(n){return Dk(n)}function KE(n,e={}){return H1(n,Ti.getMap().classNameMap,e,"regularizer")}function Jn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in qE?qE[n]:n,config:{}};return KE(t)}else return n instanceof WP?n:KE(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class HP extends Jt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Mt(e);let r=Bd(e);return this.maxValue!=null&&(r=ai(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}HP.className="ReLU";Le(HP);class GP extends Jt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=Mt(e);return O6(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}GP.className="LeakyReLU";Le(GP);class qP extends Jt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Qn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Jn(e.alphaRegularizer),this.alphaConstraint=Or(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new se(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=xn(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const o of this.sharedAxes)t[o-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let o=1;o<e.length;++o)r[o]=e[o];this.inputSpec=[new Pr({ndim:e.length,axes:r})],this.built=!0}call(e,t){return e=Mt(e),W6(e,this.alpha.read())}getConfig(){const e={alphaInitializer:or(this.alphaInitializer),alphaRegularizer:Mn(this.alphaRegularizer),alphaConstraint:Mr(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}qP.className="PReLU";Le(qP);let KP=class extends Jt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Gt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=Mt(e);return ty(r)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};KP.className="ELU";Le(KP);class XP extends Jt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const r=Mt(e);return ae(r,nt(ui(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}XP.className="ThresholdedReLU";Le(XP);class YP extends Jt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Uk().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ve(()=>{let r=Mt(e);const o=t.mask;if(o!=null){const s=ae(_t(vu(r.shape),nt(o,r.dtype)),Nn(-1e9));r=Ue(r,s)}return this.axis instanceof Array?this.axis.length>1?dl(_t(r,B$(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}YP.className="Softmax";Le(YP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sf(n,e,t){if(typeof n=="number")return Id(n,e);if(n.length!==e)throw new se(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let r=0;r<e;++r){const o=n[r];if(!ude(o))throw new se(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${o}`)}return n}function ua(n,e,t,r,o=1){if(n==null)return n;const s=e+(e-1)*(o-1);let i;return t==="same"?i=n:i=n-s+1,Math.floor((i+r-1)/r)}function Ha(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+su([t-e,0]);else if(r==="same")n=n*e;else throw new se(`Unsupport padding mode: ${r}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hk(n,e){return ve(()=>(yr(e),e==="channelsFirst"?fn(n,[0,2,3,1]):n))}function ZP(n,e){return ve(()=>(yr(e),e==="channelsFirst"?fn(n,[0,2,3,4,1]):n))}function Dhe(n,e,t,r=1,o="valid",s,i=1){return ve(()=>{if(s==null&&(s=pa()),yr(s),n.shape.length!==3)throw new se(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new se(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new se(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(s==="channelsFirst"&&(n=fn(n,[0,2,1])),o==="causal")throw new Gt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=T$(n,e,r,o==="same"?"same":"valid","NWC",i);return t!=null&&(a=ya(a,t)),a})}function XE(n,e,t,r=[1,1],o="valid",s,i,a=null){return ve(()=>{if(s==null&&(s=pa()),yr(s),n.rank!==3&&n.rank!==4)throw new se(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new se(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=Hk(n,s);if(o==="causal")throw new Gt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=Bae({x:l,filter:e,strides:r,pad:o==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),s==="channelsFirst"&&(l=fn(l,[0,3,1,2])),l})}function Ahe(n,e,t,r=[1,1,1],o="valid",s,i){return ve(()=>{if(s==null&&(s=pa()),yr(s),n.rank!==4&&n.rank!==5)throw new se(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new se(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=ZP(n,s);if(o==="causal")throw new Gt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Moe(a,e,r,o==="same"?"same":"valid","NDHWC",i),t!=null&&(a=ya(a,t)),s==="channelsFirst"&&(a=fn(a,[0,4,1,2,3])),a})}class fy extends Jt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",fy.verifyArgs(t),this.rank=e,Kr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Gt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=sf(t.kernelSize,e,"kernelSize"),this.strides=sf(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,di(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,yr(this.dataFormat),this.activation=au(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Qn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Or(t.biasConstraint),this.biasRegularizer=Jn(t.biasRegularizer),this.activityRegularizer=Jn(t.activityRegularizer),this.dilationRate=sf(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new se(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new se(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new se(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Ua("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Ak(e.kernelSize,"number",1,3))throw new se(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:iu(this.activation),useBias:this.useBias,biasInitializer:or(this.biasInitializer),biasRegularizer:Mn(this.biasRegularizer),activityRegularizer:Mn(this.activityRegularizer),biasConstraint:Mr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class jf extends fy{constructor(e,t){super(e,t),this.kernel=null,jf.verifyArgs(t),this.filters=t.filters,Kr(this.filters,"filters"),this.kernelInitializer=Qn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Or(t.kernelConstraint),this.kernelRegularizer=Jn(t.kernelRegularizer)}build(e){e=xn(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new se(`The channel dimension of the input should be defined. Found ${e[t]}`);const r=e[t],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:r}}],this.built=!0}call(e,t){return ve(()=>{e=Mt(e);let r;const o=this.bias==null?null:this.bias.read(),s=qF(this.activation.getClassName());if(s!=null&&this.rank===2)r=XE(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=Dhe(e,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=XE(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=Ahe(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Gt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=xn(e);const t=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let s=0;s<r.length;++s){const i=ua(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);t.push(i)}let o=[e[0]];return this.dataFormat==="channelsLast"?(o=o.concat(t),o.push(this.filters)):(o.push(this.filters),o=o.concat(t)),o}getConfig(){const e={filters:this.filters,kernelInitializer:or(this.kernelInitializer),kernelRegularizer:Mn(this.kernelRegularizer),kernelConstraint:Mr(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new se(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Z1 extends jf{constructor(e){super(2,e),Z1.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ak(e.kernelSize,"number",1,2))throw new se(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Z1.className="Conv2D";Le(Z1);class Q1 extends jf{constructor(e){super(3,e),Q1.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new se(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Q1.className="Conv3D";Le(Q1);class QP extends Z1{constructor(e){if(super(e),this.inputSpec=[new Pr({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new se(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=xn(e),e.length!==4)throw new se("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new se("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],o=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Pr({ndim:4,axes:{[t]:r}})],this.built=!0}call(e,t){return ve(()=>{let r=Mt(e);if(r.shape.length!==4)throw new se(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const o=r.shape,s=o[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=o[i],c=o[a],u=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],p=this.strides[1],g=Ha(l,h,u,this.padding),x=Ha(c,p,d,this.padding),y=[s,g,x,this.filters];this.dataFormat!=="channelsLast"&&(r=fn(r,[0,2,3,1]));let b=R$(r,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=fn(b,[0,3,1,2])),this.bias!=null&&(b=ya(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=xn(e);const t=e.slice();let r,o,s;this.dataFormat==="channelsFirst"?(r=1,o=2,s=3):(r=3,o=1,s=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return t[r]=this.filters,t[o]=Ha(t[o],l,i,this.padding),t[s]=Ha(t[s],c,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}QP.className="Conv2DTranspose";Le(QP);class JP extends Q1{constructor(e){if(super(e),this.inputSpec=[new Pr({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new se(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=xn(e),e.length!==5)throw new se("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new se("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],o=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Pr({ndim:5,axes:{[t]:r}})],this.built=!0}call(e,t){return ve(()=>{let r=Mt(e);if(r.shape.length!==5)throw new se(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const o=r.shape,s=o[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const c=o[l],u=o[i],d=o[a],h=this.kernelSize[0],p=this.kernelSize[1],g=this.kernelSize[2],x=this.strides[0],y=this.strides[1],b=this.strides[2],C=Ha(c,x,h,this.padding),S=Ha(u,y,p,this.padding),k=Ha(d,b,g,this.padding),N=[s,C,S,k,this.filters];this.dataFormat!=="channelsLast"&&(r=fn(r,[0,2,3,4,1]));let E=Boe(r,this.kernel.read(),N,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(E=fn(E,[0,4,1,2,3])),this.bias!==null&&(E=ya(E,this.bias.read(),this.dataFormat)),this.activation!==null&&(E=this.activation.apply(E)),E})}computeOutputShape(e){e=xn(e);const t=e.slice();let r,o,s,i;this.dataFormat==="channelsFirst"?(r=1,o=2,s=3,i=4):(r=4,o=1,s=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],h=this.strides[2];return t[r]=this.filters,t[o]=Ha(t[o],u,a,this.padding),t[s]=Ha(t[s],d,l,this.padding),t[i]=Ha(t[i],h,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}JP.className="Conv3DTranspose";Le(JP);class eM extends jf{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new se("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new se("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new se(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Qn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Jn(t.depthwiseRegularizer),this.depthwiseConstraint=Or(t.depthwiseConstraint),this.pointwiseInitializer=Qn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Jn(t.pointwiseRegularizer),this.pointwiseConstraint=Or(t.pointwiseConstraint)}build(e){if(e=xn(e),e.length<this.rank+2)throw new se(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new se(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const r=e[t],o=this.kernelSize.concat([r,this.depthMultiplier]),s=[];for(let a=0;a<this.rank;++a)s.push(1);s.push(r*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Pr({ndim:this.rank+2,axes:{[t]:r}})],this.built=!0}call(e,t){return ve(()=>{e=Mt(e);let r;if(this.rank===1)throw new Gt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=fn(e,[0,2,3,1])),r=q$(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=ya(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=fn(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=or(this.depthwiseInitializer),e.pointwiseInitializer=or(this.pointwiseInitializer),e.depthwiseRegularizer=Mn(this.depthwiseRegularizer),e.pointwiseRegularizer=Mn(this.pointwiseRegularizer),e.depthwiseConstraint=Mr(this.depthwiseConstraint),e.pointwiseConstraint=Mr(this.pointwiseConstraint),e}}eM.className="SeparableConv";class tM extends eM{constructor(e){super(2,e)}}tM.className="SeparableConv2D";Le(tM);class py extends jf{constructor(e){super(1,e),py.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ak(e.kernelSize,"number",1,1))throw new se(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}py.className="Conv1D";Le(py);class nM extends Jt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ve(()=>{if(e=Mt(e),this.dataFormat==="channelsLast"){const r=B0(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return B0(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=B0(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return B0(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}nM.className="Cropping2D";Le(nM);class rM extends Jt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,ade(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,r]}else{const t=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],t,r,e[3]]}}call(e,t){return ve(()=>{let r=Mt(e);const o=r.shape;if(this.dataFormat==="channelsFirst"){r=fn(r,[0,2,3,1]);const s=this.size[0]*o[2],i=this.size[1]*o[3],a=this.interpolation==="nearest"?Hl.resizeNearestNeighbor(r,[s,i]):Hl.resizeBilinear(r,[s,i]);return fn(a,[0,3,1,2])}else{const s=this.size[0]*o[1],i=this.size[1]*o[2];return this.interpolation==="nearest"?Hl.resizeNearestNeighbor(r,[s,i]):Hl.resizeBilinear(r,[s,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}rM.className="UpSampling2D";Le(rM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _he(n,e,t=[1,1],r="valid",o,s){return ve(()=>{o==null&&(o=pa()),yr(o);let i=Hk(n,o);if(n.rank!==4)throw new se(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new se(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=$6(i,e,t,r==="same"?"same":"valid","NHWC",s),o==="channelsFirst"&&(i=fn(i,[0,3,1,2])),i})}class oM extends fy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Qn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Or(e.depthwiseConstraint),this.depthwiseRegularizer=Jn(e.depthwiseRegularizer)}build(e){if(e=xn(e),e.length<4)throw new se(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new se(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const r=e[t],o=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",o,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ve(()=>{e=Mt(e);let r=_he(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=ya(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=xn(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=ua(t,this.kernelSize[0],this.padding,this.strides[0]),i=ua(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],o,s,i]:[e[0],s,i,o]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=or(this.depthwiseInitializer),e.depthwiseRegularizer=Mn(this.depthwiseRegularizer),e.depthwiseConstraint=Mr(this.depthwiseRegularizer),e}}oM.className="DepthwiseConv2D";Le(oM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sM(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new se("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function o(s){return s==null||Array.isArray(s)?s:[s]}return e=o(e),t=o(t),{inputs:n,initialState:e,constants:t}}function iM(n,e,t,r=!1,o,s,i=!1,a=!1){return ve(()=>{const l=e.shape.length;if(l<3)throw new se(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(fa(2,l));e=fn(e,c),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=nt(nt(o,"bool"),"float32"),o.rank===l-1&&(o=cs(o,-1)),o=fn(o,c)),r&&(e=Sd(e,0),o!=null&&(o=Sd(o,0)));const u=[];let d,h=t;const p=e.shape[0],g=Nd(e);let x;o!=null&&(x=Nd(o));for(let b=0;b<p;++b){const C=g[b],S=ve(()=>n(C,h));if(o==null)d=S[0],h=S[1];else{const k=ve(()=>{const N=x[b],E=_t($i(N),N),_=Ue(ae(S[0],N),ae(h[0],E)),$=h.map((T,D)=>Ue(ae(S[1][D],N),ae(T,E)));return{output:_,newStates:$}});d=k.output,h=k.newStates}a&&u.push(d)}let y;return a&&(y=Zl(u,1)),[d,y,h]})}class bu extends Jt{constructor(e){super(e);let t;if(e.cell==null)throw new se("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Kk({cells:e.cell}):t=e.cell,t.stateSize==null)throw new se("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Pr({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return fa(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){GC(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const r=t[0];let o;if(this.returnSequences?o=[e[0],e[1],r]:o=[e[0],r],this.returnState){const s=[];for(const i of t)s.push([e[0],i]);return[o].concat(s)}else return o}computeMask(e,t){return ve(()=>{Array.isArray(t)&&(t=t[0]);const r=this.returnSequences?t:null;if(this.returnState){const o=this.states.map(s=>null);return[r].concat(o)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let r=0;r<e;++r)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Gt("Constants support is not implemented in RNN yet.");GC(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new Pr({shape:[t,null,...r]});const o=[e[0]].concat(e.slice(2));this.cell.build(o);let s;if(Array.isArray(this.cell.stateSize)?s=this.cell.stateSize:s=[this.cell.stateSize],this.stateSpec!=null){if(!In(this.stateSpec.map(i=>i.shape[i.shape.length-1]),s))throw new se(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map(i=>new Pr({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ve(()=>{if(!this.stateful)throw new Wa("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new se("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>qr([r,o])):this.states_=[qr([r,this.cell.stateSize])];else if(e==null)rn(this.states_),this.keptStates!=null&&(rn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>qr([r,o])):this.states_[0]=qr([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new se(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):rn(this.states_);for(let o=0;o<this.states_.length;++o){const s=e[o],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[o]:this.cell.stateSize,a=[r,i];if(!In(s.shape,a))throw new se(`State ${o} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${s.shape}`);this.states_[o]=s}}this.states_=this.states_.map(o=>rl(o.clone()))})}apply(e,t){let r=t==null?null:t.initialState,o=t==null?null:t.constants;t==null&&(t={});const s=sM(e,r,o,this.numConstants);e=s.inputs,r=s.initialState,o=s.constants;let i=[],a=[];if(r!=null){t.initialState=r,i=i.concat(r),this.stateSpec=[];for(const c of r)this.stateSpec.push(new Pr({shape:c.shape}));a=a.concat(this.stateSpec)}if(o!=null&&(t.constants=o,i=i.concat(o),this.numConstants=o.length),i[0]instanceof fl){const c=[e].concat(i),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,t);return this.inputSpec=d,h}else return super.apply(e,t)}call(e,t){return ve(()=>{const r=t==null?null:t.mask,o=t==null?null:t.training;let s=t==null?null:t.initialState;e=Mt(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==i)throw new se(`RNN Layer has ${i} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:o},c=iM((g,x)=>{const y=this.cell.call([g].concat(x),a);return[y[0],y.slice(1)]},e,s,this.goBackwards,r,null,this.unroll,this.returnSequences),u=c[0],d=c[1],h=c[2];this.stateful&&this.resetStates(h,o);const p=this.returnSequences?d:u;return this.returnState?[p].concat(h):p})}getInitialState(e){return ve(()=>{let t=qr(e.shape);return t=It(t,[1,2]),t=G1(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?UC(t,[1,r]):t):this.cell.stateSize>1?[UC(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===bu.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}static fromConfig(e,t,r={}){const o=t.cell,s=Gl(o,r);return new e(Object.assign(t,{cell:s}))}}bu.className="RNN";Le(bu);class my extends Jt{}class Gk extends my{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Kr(this.units,"units"),this.activation=au(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Qn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Qn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Qn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Jn(e.kernelRegularizer),this.recurrentRegularizer=Jn(e.recurrentRegularizer),this.biasRegularizer=Jn(e.biasRegularizer),this.kernelConstraint=Or(e.kernelConstraint),this.recurrentConstraint=Or(e.recurrentConstraint),this.biasConstraint=Or(e.biasConstraint),this.dropout=vf([1,su([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=vf([1,su([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=xn(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ve(()=>{if(e=e,e.length!==2)throw new se(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const o=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=lu({ones:()=>$i(e),rate:this.dropout,training:o,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=lu({ones:()=>$i(r),rate:this.recurrentDropout,training:o,dropoutFunc:this.dropoutFunc}));let s;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?s=il(ae(e,i),this.kernel.read()):s=il(e,this.kernel.read()),this.bias!=null&&(s=ya(s,this.bias.read())),a!=null&&(r=ae(r,a));let l=Ue(s,il(r,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:iu(this.activation),useBias:this.useBias,kernelInitializer:or(this.kernelInitializer),recurrentInitializer:or(this.recurrentInitializer),biasInitializer:or(this.biasInitializer),kernelRegularizer:Mn(this.kernelRegularizer),recurrentRegularizer:Mn(this.recurrentRegularizer),biasRegularizer:Mn(this.biasRegularizer),activityRegularizer:Mn(this.activityRegularizer),kernelConstraint:Mr(this.kernelConstraint),recurrentConstraint:Mr(this.recurrentConstraint),biasConstraint:Mr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Gk.className="SimpleRNNCell";Le(Gk);class aM extends bu{constructor(e){e.cell=new Gk(e),super(e)}call(e,t){return ve(()=>{this.cell.dropoutMask!=null&&(rn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(rn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,o=t==null?null:t.training,s=t==null?null:t.initialState;return super.call(e,{mask:r,training:o,initialState:s})})}static fromConfig(e,t){return new e(t)}}aM.className="SimpleRNN";Le(aM);class qk extends my{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new se("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Kr(this.units,"units"),this.activation=au(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=au(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Qn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Qn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Qn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Jn(e.kernelRegularizer),this.recurrentRegularizer=Jn(e.recurrentRegularizer),this.biasRegularizer=Jn(e.biasRegularizer),this.kernelConstraint=Or(e.kernelConstraint),this.recurrentConstraint=Or(e.recurrentConstraint),this.biasConstraint=Or(e.biasConstraint),this.dropout=vf([1,su([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=vf([1,su([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=xn(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ve(()=>{if(e=e,e.length!==2)throw new se(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training==null?!1:t.training;let o=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=lu({ones:()=>$i(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=lu({ones:()=>$i(o),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=ae(e,s[0]));let u=il(e,this.kernel.read());this.useBias&&(u=ya(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(o=ae(o,i[0]));const d=this.recurrentKernel.read(),[h,p]=ii(d,[2*this.units,this.units],d.rank-1),g=il(o,h),[x,y,b]=ii(u,3,u.rank-1),[C,S]=ii(g,2,g.rank-1);a=this.recurrentActivation.apply(Ue(x,C)),l=this.recurrentActivation.apply(Ue(y,S));const k=il(ae(l,o),p);c=this.activation.apply(Ue(b,k));const N=Ue(ae(a,o),ae(Ue(1,gr(a)),c));return[N,N]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:iu(this.activation),recurrentActivation:iu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:or(this.kernelInitializer),recurrentInitializer:or(this.recurrentInitializer),biasInitializer:or(this.biasInitializer),kernelRegularizer:Mn(this.kernelRegularizer),recurrentRegularizer:Mn(this.recurrentRegularizer),biasRegularizer:Mn(this.biasRegularizer),activityRegularizer:Mn(this.activityRegularizer),kernelConstraint:Mr(this.kernelConstraint),recurrentConstraint:Mr(this.recurrentConstraint),biasConstraint:Mr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}qk.className="GRUCell";Le(qk);class lM extends bu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new qk(e),super(e)}call(e,t){return ve(()=>{this.cell.dropoutMask!=null&&(rn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(rn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,o=t==null?null:t.training,s=t==null?null:t.initialState;return super.call(e,{mask:r,training:o,initialState:s})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}lM.className="GRU";Le(lM);class gy extends my{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Kr(this.units,"units"),this.activation=au(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=au(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Qn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Qn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Qn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Jn(e.kernelRegularizer),this.recurrentRegularizer=Jn(e.recurrentRegularizer),this.biasRegularizer=Jn(e.biasRegularizer),this.kernelConstraint=Or(e.kernelConstraint),this.recurrentConstraint=Or(e.recurrentConstraint),this.biasConstraint=Or(e.biasConstraint),this.dropout=vf([1,su([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=vf([1,su([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=xn(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let o;if(this.useBias){if(this.unitForgetBias){const s=this.biasInitializer,i=this.units;o=new(t=class extends Mi{apply(l,c){const u=s.apply([i]),d=new $k().apply([i]),h=s.apply([i*2]);return _E(_E(u,d),h)}},t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,o,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ve(()=>{const r=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new se(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=e[1];const s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=lu({ones:()=>$i(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=lu({ones:()=>$i(o),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(e=ae(e,i[0]));let h=il(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(o=ae(o,a[0])),h=Ue(h,il(o,this.recurrentKernel.read())),this.useBias&&(h=ya(h,this.bias.read()));const[p,g,x,y]=ii(h,4,h.rank-1);l=this.recurrentActivation.apply(p),c=this.recurrentActivation.apply(g),u=Ue(ae(c,s),ae(l,this.activation.apply(x))),d=this.recurrentActivation.apply(y);const b=ae(d,this.activation.apply(u));return[b,b,u]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:iu(this.activation),recurrentActivation:iu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:or(this.kernelInitializer),recurrentInitializer:or(this.recurrentInitializer),biasInitializer:or(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Mn(this.kernelRegularizer),recurrentRegularizer:Mn(this.recurrentRegularizer),biasRegularizer:Mn(this.biasRegularizer),activityRegularizer:Mn(this.activityRegularizer),kernelConstraint:Mr(this.kernelConstraint),recurrentConstraint:Mr(this.recurrentConstraint),biasConstraint:Mr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}gy.className="LSTMCell";Le(gy);class cM extends bu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new gy(e),super(e)}call(e,t){return ve(()=>{this.cell.dropoutMask!=null&&(rn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(rn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,o=t==null?null:t.training,s=t==null?null:t.initialState;return super.call(e,{mask:r,training:o,initialState:s})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}cM.className="LSTM";Le(cM);class Kk extends my{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ve(()=>{e=e;let r=e.slice(1);const o=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?o.push(r.splice(0,a.stateSize.length)):o.push(r.splice(0,1));o.reverse();const s=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];r=o[a],a===0?i=[e[0]].concat(r):i=[i[0]].concat(r),i=l.call(i,t),s.push(i.slice(1))}r=[];for(const a of s.slice().reverse())r.push(...a);return[i[0]].concat(r)})}build(e){GC(e)&&(e=e[0]),e=e;let t;this.cells.forEach((r,o)=>{ud(`RNNCell_${o}`,()=>{r.build(e),Array.isArray(r.stateSize)?t=r.stateSize[0]:t=r.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=s=>({className:s.getClassName(),config:s.getConfig()}),o={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),o)}static fromConfig(e,t,r={}){const o=[];for(const s of t.cells)o.push(Gl(s,r));return new e({cells:o})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.cells)t.push(...r.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return qC(e)}setWeights(e){const t=[];for(const r of this.cells){const o=r.weights.length,s=e.splice(o);for(let i=0;i<r.weights.length;++i)t.push([r.weights[i],s[i]])}jk(t)}}Kk.className="StackedRNNCells";Le(Kk);function lu(n){const{ones:e,rate:t,training:r=!1,count:o=1,dropoutFunc:s}=n,i=()=>s!=null?s(e(),t):eP(e(),t),a=()=>K1(i,e,r);return!o||o<=1?rl(a().clone()):Array(o).fill(void 0).map(a).map(c=>rl(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var $he=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t};class uM extends bu{constructor(e){if(e.unroll)throw new Gt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Gt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Pr({ndim:5})]}call(e,t){return ve(()=>{if(this.cell.dropoutMask!=null&&(rn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(rn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new se("ConvRNN2D cell does not support constants");const r=t==null?null:t.mask,o=t==null?null:t.training,s=t==null?null:t.initialState;return super.call(e,{mask:r,training:o,initialState:s})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ve(()=>{const{stateSize:t}=this.cell,r=e.shape,o=this.computeSingleOutputShape(r),s=[o[0],...o.slice(2)],i=qr(s);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){ve(()=>{if(!this.stateful)throw new Wa("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,o=this.computeSingleOutputShape(r),s=[o[0],...o.slice(2)];if(r[0]==null)throw new se("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>qr(s)):this.states_=[qr(s)];else if(e==null)rn(this.states_),this.keptStates!=null&&(rn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>qr(s)):this.states_[0]=qr(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new se(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):rn(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=s;if(!In(l.shape,c))throw new se(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>rl(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:r,kernelSize:o,padding:s,strides:i,dilationRate:a}=this.cell,l=t==="channelsFirst",c=e[l?3:2],u=e[l?4:3],d=ua(c,o[0],s,i[0],a[0]),h=ua(u,o[1],s,i[1],a[1]);return[...e.slice(0,2),...l?[r,d,h]:[d,h,r]]}}uM.className="ConvRNN2D";class Xk extends gy{constructor(e){const{filters:t,kernelSize:r,strides:o,padding:s,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Kr(this.filters,"filters"),this.kernelSize=sf(r,2,"kernelSize"),this.kernelSize.forEach(l=>Kr(l,"kernelSize")),this.strides=sf(o||1,2,"strides"),this.strides.forEach(l=>Kr(l,"strides")),this.padding=s||"valid",di(this.padding),this.dataFormat=i||"channelsLast",yr(this.dataFormat),this.dilationRate=sf(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Kr(l,"dilationRate"))}build(e){var t;e=xn(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new se(`The channel dimension of the input should be defined. Found ${e[r]}`);const o=e[r],s=4,i=this.kernelSize.concat([o,this.filters*s]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(t=class extends Mi{apply(h,p){const g=c.apply([u]),x=vu([u]),y=c.apply([u*2]);return _k([g,x,y])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ve(()=>{if(e.length!==3)throw new se(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training||!1,o=e[0],s=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=lu({ones:()=>$i(o),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(W,B,q)=>!B||!B[q]?W:ae(B[q],W);let u=c(o,l,0),d=c(o,l,1),h=c(o,l,2),p=c(o,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=lu({ones:()=>$i(s),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const g=this.recurrentDropoutMask;let x=c(s,g,0),y=c(s,g,1),b=c(s,g,2),C=c(s,g,3);const S=3,[k,N,E,_]=ii(this.kernel.read(),a,S),[$,T,D,A]=this.useBias?ii(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,k,$,this.padding),d=this.inputConv(d,N,T,this.padding),h=this.inputConv(h,E,D,this.padding),p=this.inputConv(p,_,A,this.padding);const[M,j,L,U]=ii(this.recurrentKernel.read(),a,S);x=this.recurrentConv(x,M),y=this.recurrentConv(y,j),b=this.recurrentConv(b,L),C=this.recurrentConv(C,U);const G=this.recurrentActivation.apply(Ue(u,x)),H=this.recurrentActivation.apply(Ue(d,y)),O=Ue(ae(H,i),ae(G,this.activation.apply(Ue(h,b)))),V=ae(this.recurrentActivation.apply(Ue(p,C)),this.activation.apply(O));return[V,V,O]})}getConfig(){const e=super.getConfig(),{units:t}=e,r=$he(e,["units"]),o={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),o)}inputConv(e,t,r,o){const s=Cd(e,t,this.strides,o||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?ya(s,r,this.dataFormat):s}recurrentConv(e,t){return Cd(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Xk.className="ConvLSTM2DCell";Le(Xk);class dM extends uM{constructor(e){const t=new Xk(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}dM.className="ConvLSTM2D";Le(dM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Yk extends Jt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,r=[];for(let o=0;o<this.noiseShape.length;++o)r.push(this.noiseShape[o]==null?t[o]:this.noiseShape[o]);return r}call(e,t){return ve(()=>{this.invokeCallHook(e,t);const r=Mt(e);if(0<this.rate&&this.rate<1){const o=t.training==null?!1:t.training,s=this.getNoiseShape(r);return K1(()=>eP(r,this.rate,s,this.seed),()=>r,o)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Yk.className="Dropout";Le(Yk);class hM extends Yk{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}hM.className="SpatialDropout1D";Le(hM);class fM extends Jt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Kr(this.units,"units"),this.activation=au(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Qn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Qn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Or(e.kernelConstraint),this.biasConstraint=Or(e.biasConstraint),this.kernelRegularizer=Jn(e.kernelRegularizer),this.biasRegularizer=Jn(e.biasRegularizer),this.activityRegularizer=Jn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=xn(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=xn(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ve(()=>{this.invokeCallHook(e,t);const r=Mt(e),o=qF(this.activation.getClassName());let s;return o!=null?s=il(r,this.kernel.read(),o,this.bias?this.bias.read():null):(s=il(r,this.kernel.read()),this.bias!=null&&(s=ya(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){const e={units:this.units,activation:iu(this.activation),useBias:this.useBias,kernelInitializer:or(this.kernelInitializer),biasInitializer:or(this.biasInitializer),kernelRegularizer:Mn(this.kernelRegularizer),biasRegularizer:Mn(this.biasRegularizer),activityRegularizer:Mn(this.activityRegularizer),kernelConstraint:Mr(this.kernelConstraint),biasConstraint:Mr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}fM.className="Dense";Le(fM);class pM extends Jt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=xn(e);for(const t of e.slice(1))if(t==null)throw new se(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Jc(e,1)]}call(e,t){return ve(()=>{this.invokeCallHook(e,t);let r=Mt(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const o=[0];for(let s=2;s<r.rank;++s)o.push(s);o.push(1),r=fn(r,o)}return fde(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}pM.className="Flatten";Le(pM);class mM extends Jt{constructor(e){super(e),this.supportsMasking=!0,this.activation=au(e.activation)}call(e,t){return ve(()=>{this.invokeCallHook(e,t);const r=Mt(e);return this.activation.apply(r)})}getConfig(){const e={activation:iu(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}mM.className="Activation";Le(mM);class gM extends Jt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ve(()=>(e=Mt(e),dde(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}gM.className="RepeatVector";Le(gM);class xM extends Jt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const r="Total size of new array must be unchanged.",o=t.slice();let s=1,i=null;for(let l=0;l<o.length;++l){const c=o[l];if(this.isUnknown(c))if(i===null)i=l;else throw new se("Can only specifiy one unknown dimension.");else s*=c}const a=Jc(e);if(i!==null){if(s===0||a%s!==0)throw new se(r);o[i]=a/s}else if(a!==s)throw new se(r);return o}computeOutputShape(e){let t=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ve(()=>{this.invokeCallHook(e,t);const r=Mt(e),o=r.shape,s=o.slice(0,1).concat(this.fixUnknownDimension(o.slice(1),this.targetShape));return pe(r,s)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}xM.className="Reshape";Le(xM);class vM extends Jt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=fa(1,e.dims.length+1);if(!In(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Pr({ndim:this.dims.length+1})]}computeOutputShape(e){e=xn(e);const t=e.slice();return this.dims.forEach((r,o)=>{t[o+1]=e[r]}),t}call(e,t){return fn(Mt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}vM.className="Permute";Le(vM);class yM extends Jt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const r=Mt(e);return OC(Kx(r,this.maskValue),-1)}call(e,t){return ve(()=>{this.invokeCallHook(e,t);const r=Mt(e),i=OC(Kx(r,this.maskValue),-1,!0);return ae(r,nt(i,r.dtype))})}}yM.className="Masking";Le(yM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bM extends Jt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Dn(e.inputLength))}this.inputDim=e.inputDim,Kr(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Kr(this.outputDim,"outputDim"),this.embeddingsInitializer=Qn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Jn(e.embeddingsRegularizer),this.activityRegularizer=Jn(e.activityRegularizer),this.embeddingsConstraint=Or(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ve(()=>this.maskZero?(e=Mt(e),Kx(e,pn(e))):null)}computeOutputShape(e){if(e=xn(e),this.inputLength==null)return[...e,this.outputDim];const t=Dn(this.inputLength);if(t.length!==e.length-1)throw new se(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let o=0;o<t.length;++o){const s=t[o],i=e[o+1];if(s!=null&&i!=null&&s!==i)throw new se(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(t[r]=i),r++}}return[e[0],...t,this.outputDim]}call(e,t){return ve(()=>{this.invokeCallHook(e,t);let r=Mt(e);r.dtype!=="int32"&&(r=sl(r,"int32"));const o=JF(this.embeddings.read(),pe(r,[r.size]));return pe(o,xn(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:or(this.embeddingsInitializer),embeddingsRegularizer:Mn(this.embeddingsRegularizer),activityRegularizer:Mn(this.activityRegularizer),embeddingsConstraint:Mr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}bM.className="Embedding";Le(bM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zd extends Jt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Gt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const r=e.slice(0,e.length-t.length);for(let o=0;o<t.length;++o){const s=e[e.length-t.length+o],i=t[o];if(s==null||i==null||s<0||i<0)r.push(null);else if(s===1)r.push(i);else if(i===1)r.push(s);else{if(s!==i)throw new se("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));r.push(s)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[xn(e)]),e=e,e.length<2)throw new se(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const s of e)s!=null&&s[0]!==null&&t.push(s[0]);if(t=Qc(t),t.length>1)throw new se(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let s=1;s<e.length;++s){const i=e[s]==null?null:e[s].slice(1);r=this.computeElementwiseOpOutputShape(r,i)}const o=e.map(s=>s.length);e.indexOf(null)===-1&&Qc(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ve(()=>{if(e=e,this.reshapeRequired){const r=[],o=e.map(s=>s.rank);if(o.indexOf(null)===-1){const s=su(o);for(let i of e){const a=i.rank;for(let l=0;l<s-a;++l)i=G1(i,1);r.push(i)}return this.mergeFunction(r)}else{let s=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,d=u[0],h=u.slice(1).concat([d]);let p=pe(l,[d].concat(Jc(u.slice(1))));p=fn(p,[1,0]),p=pe(p,h),r.push(p),s=!0}else if(c>1){const u=fa(1,c).concat([0]);r.push(fn(l,u)),s=!0}else r.push(l)}let i=this.mergeFunction(r);const a=i.rank;if(s){if(a==null){const l=i.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));i=pe(fn(pe(i,[-1,u]),[1,0]),d)}else if(a>1){const l=[a-1].concat(fa(0,a-1));i=fn(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let o=1;o<e.length;++o){const s=e[o]==null?null:e[o].slice(1);t=this.computeElementwiseOpOutputShape(t,s)}let r=[];for(const o of e)o!=null&&o[0]!==null&&r.push(o[0]);return r=Qc(r),r.length===1?t=r.concat(t):t=[null].concat(t),t}computeMask(e,t){return ve(()=>{if(t==null)return null;if(!Array.isArray(t))throw new se("`mask` should be an Array");if(!Array.isArray(e))throw new se("`inputs` should be an Array");if(t.length!==e.length)throw new se(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(o=>o==null))return null;t=t.map(o=>o==null?o:cs(o,0));let r=t[0];for(let o=1;o<t.length-1;++o)r=Yl(r,t[o]);return r})}}class wM extends zd{constructor(e){super(e)}mergeFunction(e){return ve(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Ue(t,e[r]);return t})}}wM.className="Add";Le(wM);class CM extends zd{constructor(e){super(e)}mergeFunction(e){return ve(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=ae(t,e[r]);return t})}}CM.className="Multiply";Le(CM);class kM extends zd{constructor(e){super(e)}mergeFunction(e){return ve(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Ue(t,e[r]);return ae(1/e.length,t)})}}kM.className="Average";Le(kM);class SM extends zd{constructor(e){super(e)}mergeFunction(e){return ve(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=xu(t,e[r]);return t})}}SM.className="Maximum";Le(SM);class NM extends zd{constructor(e){super(e)}mergeFunction(e){return ve(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=mm(t,e[r]);return t})}}NM.className="Minimum";Le(NM);class IM extends zd{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new se("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const o of e)if(o!=null){t=!1;break}if(t)return;const r=[];for(let o=0;o<e.length;++o){const s=e[o].slice();s.splice(this.axis,1);let i=!1;for(const a of r)if(In(a,s)){i=!0;break}i||r.push(s)}if(r.length>1)throw new se("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ve(()=>_k(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new se("A `Concatenate` layer should be called on a list of inputs.");const t=e,r=t[0].slice(),o=this.axis<0?r.length+this.axis:this.axis;for(const s of t.slice(1)){if(r[o]==null||s[o]==null){r[o]=null;break}r[o]+=s[o]}return r}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new se("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new se("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new se(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ve(()=>{let r=!0;if(t.forEach(i=>{if(i!=null){r=!1;return}}),r)return null;const o=[];for(let i=0;i<e.length;++i)t[i]==null?o.push(nt($i(e[i]),"bool")):t[i].rank<e[i].rank?o.push(cs(t[i],-1)):o.push(t[i]);const s=ds(o,this.axis);return E$(s,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}IM.className="Concatenate";Le(IM);function Pp(n,e){for(;n<0;)n+=e;return n}function Fhe(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Gt("batchDot is not implemented for tensors of 4D or higher rank yet");if(K(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),K(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Gt("batchDot is not implemented for complex64-type Tensors yet.");const r=n.shape.length,o=e.shape.length;t==null&&(t=[r-1,o-2]);const s=t;return ve(()=>{let i;if(r>o){i=r-o;const l=[];for(let c=0;c<i;++c)l.push(1);e=pe(e,e.shape.concat(l))}else if(o>r){i=o-r;const l=[];for(let c=0;c<i;++c)l.push(1);n=pe(n,n.shape.concat(l))}else i=0;let a;if(n.shape.length===2&&e.shape.length===2)s[0]===s[1]?a=It(ae(n,e),s[0]):a=It(ae(fn(n,[1,0]),e),s[1]);else{const l=s[0]!==n.shape.length-1,c=s[1]===e.shape.length-1;a=Sn(n,e,l,c)}if(i>0){let l;r>o?l=r+o-3:l=r-1;const c=[];for(let u=l;u<l+i;++u)c.push(u);a=j1(a,c)}return a.shape.length===1&&(a=cs(a,1)),a})}class EM extends zd{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){K(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],r=e[1];if(t.length>3||r.length>3)throw new Gt("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(t,r);if(t[o[0]]!==r[o[1]])throw new se(`Dimension incompatibility: ${t[o[0]]} !== ${r[o[1]]}`)}mergeFunction(e){if(e.length!==2)throw new se(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],r=e[1],o;return Array.isArray(this.axes)?o=this.axes.map((s,i)=>Pp(s,e[i].shape.length)):o=[Pp(this.axes,t.shape.length),Pp(this.axes,r.shape.length)],this.normalize&&(t=tv(t,o[0]),r=tv(r,o[1])),Fhe(t,r,o)}interpretAxes(e,t){let r;return Array.isArray(this.axes)?r=this.axes:r=[Pp(this.axes,e.length),Pp(this.axes,t.length)],r}computeOutputShape(e){K(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),r=e[1].slice();if(t.length>3||r.length>3)throw new Gt("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(t,r);t.splice(o[0],1),r.splice(o[1],1),r.splice(0,1);const s=t.concat(r);return s.length===1&&s.push(1),s}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}EM.className="Dot";Le(EM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class TM extends Jt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ve(()=>{this.invokeCallHook(e,t);const r=Mt(e);return K1(()=>Ue(cy(r.shape,0,this.stddev),r),()=>r,t.training||!1)})}}TM.className="GaussianNoise";Le(TM);class RM extends Jt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ve(()=>{this.invokeCallHook(e,t);const r=Mt(e);return this.rate>0&&this.rate<1?K1(()=>{const s=Math.sqrt(this.rate/(1-this.rate));return ae(r,cy(r.shape,1,s))},()=>r,t.training||!1):r})}}RM.className="GaussianDropout";Le(RM);class DM extends Jt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Mt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ve(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return K1(()=>{const s=Mt(e),a=-1.6732632423543772*1.0507009873554805;let l=Ld(B1(r),this.rate);l=sl(l,"float32");const c=((1-this.rate)*(1+this.rate*a**2))**-.5,u=-c*a*this.rate,d=Ue(ae(s,l),ae(Ue(l,-1),a));return Ue(ae(d,c),u)},()=>Mt(e),t.training||!1)}return e})}}DM.className="AlphaDropout";Le(DM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bm(n,e,t,r,o,s=.001){let i;if(n.rank===2)i=hoe(n,e,t,r,o,s);else if(n.rank===3)i=poe(n,e,t,r,o,s);else if(n.rank===4)i=goe(n,e,t,r,o,s);else throw new Gt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function Phe(n,e,t,r,o=.001){return ve(()=>{const s=j6(n,r),i=s.mean,a=s.variance;return[bm(n,i,a,t,e,o),i,a]})}function Mhe(n,e,t,r,o=.001){return ve(()=>{const s=j6(n,r),i=s.mean,a=s.variance,l=[];for(const g of fa(0,n.rank))r.indexOf(g)!==-1?l.push(1):l.push(n.shape[g]);const c=pe(i,l),u=pe(a,l),d=e==null?null:pe(e,l),h=t==null?null:pe(t,l);return[bm(n,c,u,h,d,o),i,a]})}function Ohe(n,e,t,r,o=.001){return In(r.slice().sort(),fa(0,n.rank-1))?Phe(n,e,t,r,o):Mhe(n,e,t,r,o)}class AM extends Jt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Qn(e.betaInitializer||"zeros"),this.gammaInitializer=Qn(e.gammaInitializer||"ones"),this.movingMeanInitializer=Qn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Qn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Or(e.betaConstraint),this.gammaConstraint=Or(e.gammaConstraint),this.betaRegularizer=Jn(e.betaRegularizer),this.gammaRegularizer=Jn(e.gammaRegularizer)}build(e){e=xn(e);const t=this.axis>=0?this.axis:this.axis+e.length,r=e[t];if(r==null)throw new se(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Pr({ndim:e.length,axes:{[t]:r}})];const o=[r];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ve(()=>{const r=t.training==null?!1:t.training,o=Mt(e),s=o.shape,i=s.length,a=fa(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const c=Id(1,i);c[l]=s[l];const u=a.slice();u.sort();const d=!In(u,fa(0,i).slice(0,i-1)),h=()=>{if(d){const C=pe(this.movingMean.read(),c),S=pe(this.movingVariance.read(),c),k=this.center?pe(this.beta.read(),c):null,N=this.scale?pe(this.gamma.read(),c):null;return bm(o,C,S,k,N,this.epsilon)}else return bm(o,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return h();const[p,g,x]=Ohe(o,this.gamma.read(),this.beta.read(),a,this.epsilon),y=(C,S,k)=>{ve(()=>{const N=1-k,E=C.read(),_=ae(_t(E,S),N);C.write(_t(E,_))})};return(()=>{y(this.movingMean,g,this.momentum),y(this.movingVariance,x,this.momentum)})(),p})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:or(this.betaInitializer),gammaInitializer:or(this.gammaInitializer),movingMeanInitializer:or(this.movingMeanInitializer),movingVarianceInitializer:or(this.movingVarianceInitializer),betaRegularizer:Mn(this.betaRegularizer),gammaRegularizer:Mn(this.gammaRegularizer),betaConstraint:Mr(this.betaConstraint),gammaConstraint:Mr(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}AM.className="BatchNormalization";Le(AM);class _M extends Jt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Qn(e.betaInitializer||"zeros"),this.gammaInitializer=Qn(e.gammaInitializer||"ones"),this.betaRegularizer=Jn(e.betaRegularizer),this.gammaRegularizer=Jn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=xn(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=t);for(const s of this.axis)if(s<0||s>=t)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==Qc(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(s=>e[s]),o=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,o):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,o):this.beta=null,this.built=!0}call(e,t){const r=Mt(e),o=r.shape,s=o.length;return ve(()=>{let{mean:a,variance:l}=j6(r,this.axis,!0);const c=Id(1,s);for(const x of this.axis)c[x]=o[x];const u=x=>x!=null&&x.shape.length!==s?pe(x,c):x;let d=this.scale?u(this.gamma.read()):null,h=this.center?u(this.beta.read()):null;const p=[],g=[];for(let x=0;x<s;++x)this.axis.indexOf(x)!==-1?(p.push(o[x]),g.push(1)):(p.push(1),g.push(o[x]));return a=ia(a,p),l=ia(l,p),d!=null&&(d=ia(d,g)),h!=null&&(h=ia(h,g)),bm(r,a,l,h,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:or(this.betaInitializer),gammaInitializer:or(this.gammaInitializer),betaRegularizer:Mn(this.betaRegularizer),gammaRegularizer:Mn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}_M.className="LayerNormalization";Le(_M);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lhe(n,e,t){return ve(()=>{if(n.rank!==4)throw new se(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new se("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=pa()),t!=="channelsLast"&&t!=="channelsFirst")throw new se(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],V6(n,r)})}class $M extends Jt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?pa():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new se(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,r;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new se(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new se(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[t,r]}this.inputSpec=[new Pr({ndim:4})]}computeOutputShape(e){e=xn(e);let t,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],t,r]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],t,r,e[3]])}call(e,t){return ve(()=>Lhe(Mt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}$M.className="ZeroPadding2D";Le($M);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xy(n,e,t,r,o,s){return ve(()=>{yr(o),XF(s),di(r),t==null&&(t=[1,1]),r==null&&(r="valid"),o==null&&(o=pa()),s==null&&(s="max"),n=Hk(n,o);let i;const a=r==="same"?"same":"valid";return s==="max"?i=B6(n,e,t,a):i=R6(n,e,t,a),o==="channelsFirst"&&(i=fn(i,[0,3,1,2])),i})}function FM(n,e,t,r,o,s){return ve(()=>{yr(o),XF(s),di(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),o==null&&(o=pa()),s==null&&(s="max"),n=ZP(n,o);let i;const a=r==="same"?"same":"valid";return s==="max"?i=eie(n,e,t,a):i=noe(n,e,t,a),o==="channelsFirst"&&(i=fn(i,[0,4,1,2,3])),i})}class PM extends Jt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new se(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Kr(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new se(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Kr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,di(this.padding),this.inputSpec=[new Pr({ndim:3})]}computeOutputShape(e){e=xn(e);const t=ua(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ve(()=>{this.invokeCallHook(e,t),e=G1(Mt(e),2);const r=this.poolingFunction(Mt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return j1(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class MM extends PM{constructor(e){super(e)}poolingFunction(e,t,r,o,s){return yr(s),di(o),xy(e,t,r,o,s,"max")}}MM.className="MaxPooling1D";Le(MM);class OM extends PM{constructor(e){super(e)}poolingFunction(e,t,r,o,s){return yr(s),di(o),xy(e,t,r,o,s,"avg")}}OM.className="AveragePooling1D";Le(OM);class LM extends Jt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new se(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Kr(this.poolSize,"poolSize"),Kr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),di(this.padding),this.inputSpec=[new Pr({ndim:4})]}computeOutputShape(e){e=xn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=ua(t,this.poolSize[0],this.padding,this.strides[0]),r=ua(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r]:[e[0],t,r,e[3]]}call(e,t){return ve(()=>(this.invokeCallHook(e,t),this.poolingFunction(Mt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class BM extends LM{constructor(e){super(e)}poolingFunction(e,t,r,o,s){return yr(s),di(o),xy(e,t,r,o,s,"max")}}BM.className="MaxPooling2D";Le(BM);class jM extends LM{constructor(e){super(e)}poolingFunction(e,t,r,o,s){return yr(s),di(o),xy(e,t,r,o,s,"avg")}}jM.className="AveragePooling2D";Le(jM);class VM extends Jt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new se(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Kr(this.poolSize,"poolSize"),Kr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),di(this.padding),this.inputSpec=[new Pr({ndim:5})]}computeOutputShape(e){e=xn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=ua(t,this.poolSize[0],this.padding,this.strides[0]),r=ua(r,this.poolSize[1],this.padding,this.strides[1]),o=ua(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r,o]:[e[0],t,r,o,e[4]]}call(e,t){return ve(()=>(this.invokeCallHook(e,t),this.poolingFunction(Mt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class zM extends VM{constructor(e){super(e)}poolingFunction(e,t,r,o,s){return yr(s),di(o),FM(e,t,r,o,s,"max")}}zM.className="MaxPooling3D";Le(zM);class WM extends VM{constructor(e){super(e)}poolingFunction(e,t,r,o,s){return yr(s),di(o),FM(e,t,r,o,s,"avg")}}WM.className="AveragePooling3D";Le(WM);class UM extends Jt{constructor(e){super(e),this.inputSpec=[new Pr({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Gt}}class HM extends UM{constructor(e){super(e||{})}call(e,t){return ve(()=>{const r=Mt(e);return Sr(r,1)})}}HM.className="GlobalAveragePooling1D";Le(HM);class GM extends UM{constructor(e){super(e||{})}call(e,t){return ve(()=>{const r=Mt(e);return ca(r,1)})}}GM.className="GlobalMaxPooling1D";Le(GM);class qM extends Jt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),this.inputSpec=[new Pr({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Gt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class KM extends qM{call(e,t){return ve(()=>{const r=Mt(e);return this.dataFormat==="channelsLast"?Sr(r,[1,2]):Sr(r,[2,3])})}}KM.className="GlobalAveragePooling2D";Le(KM);class XM extends qM{call(e,t){return ve(()=>{const r=Mt(e);return this.dataFormat==="channelsLast"?ca(r,[1,2]):ca(r,[2,3])})}}XM.className="GlobalMaxPooling2D";Le(XM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class YM extends Jt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,r={}){const o=t.layer,s=Gl(o,r);delete t.layer;const i={layer:s};return Object.assign(i,t),new e(i)}}class ZM extends YM{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=xn(e),e.length<3)throw new se(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=xn(e);const t=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(t),o=e[1];return[r[0],o].concat(r.slice(1))}call(e,t){return ve(()=>(e=Mt(e),iM((i,a)=>[Mt(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}ZM.className="TimeDistributed";Le(ZM);function Bhe(n){Vd(ide,"BidirectionalMergeMode",n)}const jhe="concat";class QM extends YM{constructor(e){super(e);const t=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=t,this.forwardLayer=Gl(r),t.goBackwards=t.goBackwards!==!0;const o={};if(o.className=e.layer.getClassName(),o.config=t,this.backwardLayer=Gl(o),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?jhe:e.mergeMode,Bhe(this.mergeMode),e.weights)throw new Gt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,r=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let r,o,s;return this.returnState&&(s=t.slice(1)),r=t[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,o=[r]):this.mergeMode==null?o=[r,r.slice()]:o=[r],this.returnState?this.mergeMode==null?o.concat(s).concat(s.slice()):[r].concat(s).concat(s.slice()):us(o)}apply(e,t){let r=t==null?null:t.initialState,o=t==null?null:t.constants;t==null&&(t={});const s=sM(e,r,o,this.numConstants);if(e=s.inputs,r=s.initialState,o=s.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&o==null)return super.apply(e,t);const i=[],a=[];if(r!=null){const c=r.length;if(c%2>0)throw new se("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,i.push(...r);const u=r.map(d=>new Pr({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(o!=null)throw new Gt("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof fl;for(const c of i)if(c instanceof fl!==l)throw new se("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(i),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,t);return this.inputSpec=d,h}else return super.apply(e,t)}call(e,t){return ve(()=>{const r=t.initialState;let o,s;if(r==null)o=this.forwardLayer.call(e,t),s=this.backwardLayer.call(e,t);else{const l=r.slice(0,r.length/2),c=r.slice(r.length/2);o=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),s=this.backwardLayer.call(e,Object.assign(t,{initialState:c}))}let i;this.returnState&&(Array.isArray(o)&&(i=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),this.returnSequences&&(s=Sd(s,1));let a;return this.mergeMode==="concat"?a=_k([o,s]):this.mergeMode==="sum"?a=Ue(o,s):this.mergeMode==="ave"?a=ae(.5,Ue(o,s)):this.mergeMode==="mul"?a=ae(o,s):this.mergeMode==null&&(a=[o,s]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ud(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ud(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[t,t]:r=t:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const s=this.forwardLayer.states.map(i=>null);return Array.isArray(r)?r.concat(s).concat(s):[r].concat(s).concat(s)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const r=Gl(t.layer);if(delete t.layer,t.numConstants!=null)throw new Gt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const o=t;return o.layer=r,new e(o)}}QM.className="Bidirectional";Le(QM);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class JM extends Jt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ve(()=>(e=Mt(e),e.dtype!=="float32"&&(e=sl(e,"float32")),Ue(ae(e,this.scale),this.offset)))}}JM.className="Rescaling";Le(JM);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:Vhe,cropAndResize:zhe}=Hl;class eO extends Jt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,r,o,s,i,a,l){return ve(()=>{let c,u=!1;const d=t/i,h=r/a,p=(o+t)/i,g=(s+r)/a,x=[d,h,p,g],y=[];e.rank===3?(u=!0,c=Zl([e])):c=e;for(let N=0;N<c.shape[0];N++)y.push(x);const b=x$(y,[y.length,4]),C=gm(0,y.length,1,"int32"),k=zhe(c,b,C,[o,s],"nearest");return sl(u?Mt(Nd(k)):k,l)})}upsize(e,t,r,o){return ve(()=>{const s=Vhe(e,[t,r]);return sl(s,o)})}call(e,t){return ve(()=>{const r=Mt(e),o=r.dtype,s=r.shape,i=s[s.length-3],a=s[s.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(r,l,c,this.height,this.width,i,a,o):this.upsize(e,this.height,this.width,o)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=xn(e);const t=e.length-3,r=e.length-2;return e[t]=this.height,e[r]=this.width,e}}eO.className="CenterCrop";Le(eO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Whe(n,e,t,r){let o=Mt(n);if(o.dtype!=="int32"&&(o=sl(o,"int32")),e==="int")return o;const s=o.shape;if(o.rank===0&&(o=cs(o,-1)),e==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=cs(o,-1)),o.rank>2)throw new se(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${s} which would result in output rank ${o.rank}.`);const i=["multiHot","oneHot"].includes(e),a=o;let l;if(typeof r<"u"&&e==="count"?l=cE(a,r,t,i):l=cE(a,[],t,i),e!=="tfIdf")return l;if(r)return ae(l,r);throw new se("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tO extends Jt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=xn(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ve(()=>{e=Mt(e),e.dtype!=="int32"&&(e=sl(e,"int32"));let r;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new se(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);r=Mt(t.countWeights)}const o=ca(e),s=Gx(e),i=ui(this.numTokens,o).bufferSync().get(0),a=Ld(s,0).bufferSync().get(0);if(!(i&&a))throw new se(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return Whe(e,this.outputMode,this.numTokens,r)})}}tO.className="CategoryEncoding";Le(tO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Uhe=["bilinear","nearest"],YE=new Set(Uhe);class nO extends Jt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(YE.has(e.interpolation))this.interpolation=e.interpolation;else throw new se(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=xn(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ve(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return Hl.resizeBilinear(e,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Hl.resizeNearestNeighbor(e,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...YE]} are supported`)})}}nO.className="Resizing";Le(nO);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rO{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}rO.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class oO extends Jt{constructor(e){super(e),this.randomGenerator=new rO(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}oO.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Hhe=["bilinear","nearest"],ZE=new Set(Hhe);class sO extends oO{constructor(e){super(e);const{factor:t,interpolation:r="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new se(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new se(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new se(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(ZE.has(r))this.interpolation=r;else throw new se(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=xn(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ve(()=>{const r=Mt(e);this.imgHeight=r.shape[r.shape.length-3];const o=r.shape[r.shape.length-2];this.widthFactor=B1([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let s=this.widthFactor.dataSync()[0]*o;s=Math.round(s);const i=[this.imgHeight,s];switch(this.interpolation){case"bilinear":return Hl.resizeBilinear(e,i);case"nearest":return Hl.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...ZE]} are supported`)}})}}sO.className="RandomWidth";Le(sO);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ghe=Ce();Ghe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var QE;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(QE||(QE={}));var JE;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(JE||(JE={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var e9;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(e9||(e9={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ht(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&K(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qhe=tF;class vy extends $5{nextDataId(){return vy.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new N_(this,ja())}write(e,t,r){this.firstUse&&(this.firstUse=!1,Ce().get("IS_NODE")&&Js(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const o={id:this.nextDataId()};return this.data.set(o,{values:e,dtype:r,refCount:1}),o}makeTensorInfo(e,t,r){let o;if(t==="string"&&r!=null&&r.length>0&&Vm(r[0])){const s=r.map(i=>Zc(i));o=this.write(s,e,t)}else o=this.write(r,e,t);return{dataId:o,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,r,o,s){this.data.set(e,{values:t,dtype:o,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:r}=this.data.get(e);if(t==="complex64"){const o=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return Ql(o,s)}return pne(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(o=>ou(o));return Zt(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Zt(e.shape,e.dtype,t)}makeOutput(e,t,r){return ja().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=as();return e(),{kernelMs:as()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){ht([e],"where");const t=this.readSync(e.dataId);return qhe(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}vy.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iO(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const Khe=n=>{const{x:e}=n.inputs,t=n.backend;ht(e,"abs");let r=new Float32Array(De(e.shape));const o=t.data.get(e.dataId).values;return r=iO(o),t.makeOutput(r,e.shape,e.dtype)},Xhe={kernelName:Xv,backendName:"cpu",kernelFunc:Khe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function br(n){return(e,t,r,o,s)=>{const i=Ut(e,t),a=i.length,l=Nt(i),c=De(i),u=Eo(s,c),d=e.length,h=t.length,p=Nt(e),g=Nt(t),x=gf(e,i),y=gf(t,i);if(x.length+y.length===0)for(let b=0;b<u.length;++b)u[b]=n(r[b%r.length],o[b%o.length]);else for(let b=0;b<u.length;++b){const C=$f(b,a,l),S=C.slice(-d);x.forEach(_=>S[_]=0);const k=nl(S,d,p),N=C.slice(-h);y.forEach(_=>N[_]=0);const E=nl(N,h,g);u[b]=n(r[k],o[E])}return[u,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(n){const{inputs:e,backend:t}=n,{real:r,imag:o}=e,s=t.data.get(r.dataId).values,i=t.data.get(o.dataId).values,a=t.makeTensorInfo(r.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",s),imag:t.makeTensorInfo(o.shape,"float32",i)},a}const Yhe={kernelName:G5,backendName:"cpu",kernelFunc:$s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iv(n,e,t="float32"){if(t==="complex64"){const o=iv(n,e,"float32"),s=iv(n,e,"float32");return $s({inputs:{real:o,imag:s},backend:n})}const r=To(De(e),t);return n.makeTensorInfo(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pl(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Zhe={kernelName:l1,backendName:"cpu",kernelFunc:pl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ed(n){const{inputs:e,backend:t}=n,{input:r}=e,o=t.data.get(r.dataId).complexTensorInfos.real,s=t.data.get(o.dataId).values;return t.makeTensorInfo(o.shape,o.dtype,s)}const Qhe={kernelName:g6,backendName:"cpu",kernelFunc:Ed};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aO(n,e,t,r){if(r==="int32"){const o=Int32Array.from(n);return[e,"int32",o]}if(r==="bool"){const o=Od([0],t),[s,i]=br((a,l)=>a!==l?1:0)(e,[],n,o,"bool");return[i,"bool",s]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}function cu(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{dtype:s}=r;if(s==="complex64"){if(o.dtype==="complex64")return pl({inputs:{x:o},backend:t});const u=iv(t,o.shape,o.dtype),d=cu({inputs:{x:o},backend:t,attrs:{dtype:"float32"}}),h=$s({inputs:{real:d,imag:u},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),h}if(o.dtype==="complex64"){const u=Ed({inputs:{input:o},backend:t}),d=cu({inputs:{x:u},backend:t,attrs:{dtype:s}});return t.disposeIntermediateTensorInfo(u),d}if(!T_(o.dtype,s)){const u=pl({inputs:{x:o},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:s}}const i=t.data.get(o.dataId).values,[a,l,c]=aO(i,o.shape,o.dtype,s);return t.makeTensorInfo(a,l,c)}const Jhe={kernelName:Xm,backendName:"cpu",kernelFunc:cu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jr(n,e,t,r){return t==null?({inputs:o,backend:s})=>{const{a:i,b:a}=o,l=s;ht([i,a],n);const c=l.data.get(i.dataId).values,u=l.data.get(a.dataId).values,d=i.dtype==="string"?Jl(c):c,h=i.dtype==="string"?Jl(u):u,p=r||i.dtype,[g,x]=e(i.shape,a.shape,d,h,p);return l.makeTensorInfo(x,p,g)}:({inputs:o,backend:s})=>{const{a:i,b:a}=o,l=s;if(i.dtype==="complex64"||a.dtype==="complex64"){const c=cu({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,h=u.complexTensorInfos.imag,p=l.data.get(d.dataId).values,g=l.data.get(h.dataId).values,x=cu({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),y=l.data.get(x.dataId),b=y.complexTensorInfos.real,C=y.complexTensorInfos.imag,S=l.data.get(b.dataId).values,k=l.data.get(C.dataId).values,[N,E,_]=t(i.shape,a.shape,p,g,S,k),$=l.makeTensorInfo(_,"float32",N),T=l.makeTensorInfo(_,"float32",E),D=$s({inputs:{real:$,imag:T},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(x),l.disposeIntermediateTensorInfo($),l.disposeIntermediateTensorInfo(T),D}else{const c=l.data.get(i.dataId).values,u=l.data.get(a.dataId).values,d=r||i.dtype,[h,p]=e(i.shape,a.shape,c,u,d);return l.makeTensorInfo(p,d,h)}}}function Zk(n){return(e,t,r,o,s,i)=>{const a=Ut(e,t),l=De(a),c=a.length,u=Nt(a),d=Eo("float32",l),h=Eo("float32",l),p=gf(e,a),g=gf(t,a),x=Ql(r,o),y=Ql(s,i),b=e.length,C=Nt(e),S=t.length,k=Nt(t);if(p.length+g.length===0)for(let N=0;N<d.length;N++){const E=N%x.length,_=N%y.length,$=n(x[E*2],x[E*2+1],y[_*2],y[_*2+1]);d[N]=$.real,h[N]=$.imag}else for(let N=0;N<d.length;N++){const E=$f(N,c,u),_=E.slice(-b);p.forEach(M=>_[M]=0);const $=nl(_,b,C),T=E.slice(-S);g.forEach(M=>T[M]=0);const D=nl(T,S,k),A=n(x[$*2],x[$*2+1],y[D*2],y[D*2+1]);d[N]=A.real,h[N]=A.imag}return[d,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lO=br(((n,e)=>n+e)),efe=Zk(((n,e,t,r)=>({real:n+t,imag:e+r}))),yf=jr(Ff,lO,efe),tfe={kernelName:Ff,backendName:"cpu",kernelFunc:yf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qk(n,e,t,r,o){const s=De(r),i=To(o,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(s>0?i[l]+=e[a]:i[l]+=1)}return i}function cO(n,e,t,r=!1){const o=n.shape[0],s=n.shape[1],i=Zt([o,t],e.dtype);for(let a=0;a<o;a++)for(let l=0;l<s;l++){const c=n.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?i.set(1,a,c):e.size>0?i.set(i.get(a,c)+e.get(a,l),a,c):i.set(i.get(a,c)+1,a,c))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uO=br(((n,e)=>n&e)),nfe=jr(H5,uO),rfe={kernelName:H5,backendName:"cpu",kernelFunc:nfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bl(n){return(e,t,r)=>{const o=mr(t,e.length);for(let s=0;s<e.length;++s)o[s]=n(e[s],r);return o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _n(n,e,t){const r=bl(e);return wu(n,r,t)}function wu(n,e,t){return({inputs:r,attrs:o,backend:s})=>{const{x:i}=r;ht(i,n);const a=s,l=a.data.get(i.dataId).values;let c;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=Jl(l)}else c=l;const u=t||i.dtype,d=e(c,u,o);return a.makeTensorInfo(i.shape,u,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dO=bl(n=>Math.ceil(n)),ofe=wu(Ym,dO),sfe={kernelName:Ym,backendName:"cpu",kernelFunc:ofe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hO(n,e,t,r){const o=mr(t,De(e));if(r&&t!=="string"){let s=0;n.forEach(i=>{const a=De(i.shape);o.set(i.vals,s),s+=a})}else{let s=0;n.forEach(i=>{const a=t==="string"?Jl(i.vals):i.vals;let l=0;for(let c=0;c<i.shape[0];++c){const u=c*e[1]+s;for(let d=0;d<i.shape[1];++d)o[u+d]=a[l++]}s+=i.shape[1]})}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fO=br((n,e)=>n===e?1:0),pO=jr(u2,fO,null,"bool"),ife={kernelName:u2,backendName:"cpu",kernelFunc:pO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mO=bl(n=>Math.exp(n)),gO=wu(r1,mO,"float32"),afe={kernelName:r1,backendName:"cpu",kernelFunc:gO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xO=bl(n=>Math.expm1(n)),lfe=wu(o1,xO),cfe={kernelName:o1,backendName:"cpu",kernelFunc:lfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vO=bl(n=>Math.floor(n)),ufe=wu(s1,vO),dfe={kernelName:s1,backendName:"cpu",kernelFunc:ufe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yO=br((n,e)=>Math.floor(n/e)),hfe=jr(i1,yO,null,"int32"),ffe={kernelName:i1,backendName:"cpu",kernelFunc:hfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bO(n,e,t,r,o,s,i,a,l){const c=Zt([r,s],t);for(let u=0;u<r;u++){const d=[];let h=0;for(let p=0;p<o;p++){const g=n[u*o+p];h+=g*i[p],d.push(g)}if(h<0||h>=l/s)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let p=0;p<s;p++)c.values[u*s+p]=e.get(...e.indexToLoc(h*s+p))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wO(n,e,t){const r=Zt(t,n.dtype);for(let o=0;o<r.size;++o){const i=r.indexToLoc(o).slice(),a=i[0],l=i[2],c=e.locToIndex([a,l]);i[2]=e.values[c];const u=n.locToIndex(i);0<=u&&u<n.values.length&&(r.values[o]=n.values[u])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CO=br((n,e)=>n>e?1:0),pfe=jr(p2,CO,null,"bool"),mfe={kernelName:p2,backendName:"cpu",kernelFunc:pfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kO=br((n,e)=>n>=e?1:0),gfe=jr(a1,kO,null,"bool"),xfe={kernelName:a1,backendName:"cpu",kernelFunc:gfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SO=br((n,e)=>n<e?1:0),vfe=jr(g2,SO,null,"bool"),yfe={kernelName:g2,backendName:"cpu",kernelFunc:vfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NO=br((n,e)=>n<=e?1:0),bfe=jr(x2,NO,null,"bool"),wfe={kernelName:x2,backendName:"cpu",kernelFunc:bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IO(n,e,t){const r=(e-n)/(t-1),o=To(t,"float32");o[0]=n;for(let s=1;s<o.length;s++)o[s]=o[s-1]+r;return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EO=bl(n=>Math.log(n)),Cfe=wu(h1,EO),kfe={kernelName:h1,backendName:"cpu",kernelFunc:Cfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TO(n,e,t,r){const o=Eo(r,De(t));for(let s=0;s<o.length;++s){const i=s*e;let a=n[i];for(let l=0;l<e;++l){const c=n[i+l];(Number.isNaN(c)||c>a)&&(a=c)}o[s]=a}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RO=br(((n,e)=>Math.max(n,e))),Sfe=jr(p1,RO),Nfe={kernelName:p1,backendName:"cpu",kernelFunc:Sfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DO=br(((n,e)=>Math.min(n,e))),Ife=jr(m1,DO),Efe={kernelName:m1,backendName:"cpu",kernelFunc:Ife};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jk=br(((n,e)=>n*e)),Tfe=Zk(((n,e,t,r)=>({real:n*t-e*r,imag:n*r+e*t}))),yy=jr(x1,Jk,Tfe),Rfe={kernelName:x1,backendName:"cpu",kernelFunc:yy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AO(n,e,t){const r=pu(-1,t);return Jk([],e,r,n,t)}function Dfe(n){const{inputs:e,backend:t}=n,{x:r}=e;ht(r,"neg");const o=t.data.get(r.dataId).values,[s,i]=AO(o,r.shape,r.dtype);return t.makeTensorInfo(i,r.dtype,s)}const Afe={kernelName:T2,backendName:"cpu",kernelFunc:Dfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _O=br(((n,e)=>n!==e?1:0)),_fe=jr(R2,_O,null,"bool"),$fe={kernelName:R2,backendName:"cpu",kernelFunc:_fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(n,e,t,r,o){const s=e.length,i=De(e),a=Nt(e),l=Nt(o),c=Eo(t,De(o));for(let u=0;u<i;++u){const d=$f(u,s,a),h=new Array(d.length);for(let g=0;g<h.length;g++)h[g]=d[r[g]];const p=nl(h,s,l);c[p]=n[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ps(n){const{inputs:e,attrs:t,backend:r}=n,{x:o}=e,{perm:s}=t;ht(o,"transpose");const i=o.shape.length,a=new Array(i);for(let d=0;d<a.length;d++)a[d]=o.shape[s[d]];const l=r.data.get(o.dataId).values,c=e8(l,o.shape,o.dtype,s,a);return{dataId:r.write(c,a,o.dtype),shape:a,dtype:o.dtype}}const Ffe={kernelName:nf,backendName:"cpu",kernelFunc:ps};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $O(n,e,t,r){const[o,s]=to(n,r),i=Ls(e,"int32"),a=To(De(o),i),l=De(s);for(let c=0;c<a.length;++c){const u=c*l;let d=1;for(let h=0;h<l;++h)d*=t[u+h];a[c]=d}return{outVals:a,outShape:o,outDtype:i}}function Pfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r;ht(o,"prod");const a=o.shape.length,l=Qt(s,o.shape),c=sr(l,a);let u=l,d=o;const h=[];c!=null&&(d=ps({inputs:{x:o},backend:t,attrs:{perm:c}}),h.push(d),u=vr(u.length,a));const p=t.data.get(d.dataId).values,{outVals:g,outShape:x,outDtype:y}=$O(d.shape,d.dtype,p,u);let b=x;return i&&(b=Ir(x,l)),h.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.makeTensorInfo(b,y,g)}const Mfe={kernelName:P2,backendName:"cpu",kernelFunc:Pfe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ofe(n,e,t){n.forEach((r,o)=>{if(r<0||r>=t){const s=$f(o,e.length,Nt(e)).join(",");throw new Error(`indices[${s}] = ${r} is not in [0, ${t})`)}})}function Lfe(n,e){for(let t=0;t<n.length;++t){const r=n[t],o=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>o)throw new Error("Ragged splits must not point past values");for(let s=1;s<r.length;++s)if(r[s-1]>r[s])throw new Error("Ragged splits must be sorted in ascending order")}}function Bfe(n,e,t,r){const o=[];let s=0;const i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);Lfe(t,r);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<n.length;++c){let u=n[c],d=n[c]+1;for(let h=0;h<t.length;++h){const p=t[h],g=h+e.length-1;if(g>=0){const x=a[g],y=x[x.length-1]-p[u];for(let b=u;b<d;++b)a[g].push(p[b+1]+y)}u=p[u],d=p[d]}d!==u&&(o.push([u,d]),s+=d-u)}return{outSplits:a,valueSlices:o,numValues:s}}function jfe(n){const e=[];for(let t=0;t<n.length;++t){const r=n[t].length,o=mr("int32",r);e.push(o),n[t].forEach((s,i)=>o[i]=s)}return e}function t9(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<n.length;r++)t[e-1]*=n[r];return t}function Vfe(n,e,t,r,o,s){const i=t9(e,2)[1],a=t9(s,2)[1];let l=0;for(const c of t)for(let u=c[0];u<c[1];++u){for(let d=0;d<r;++d)o[l*a+d]=n[u*i+d];++l}}function zfe(n,e,t,r,o){const s=e.slice();s[0]=o;const i=mr(t,De(s)),a=n.length,l=a===0?0:a/e[0];return Vfe(n,e,r,l,i,s),[i,s]}function FO(n,e,t,r,o,s,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(Ofe(s,i,l),r.length===0)throw new Error("params.rank must be nonzero");const c=r[0],{outSplits:u,valueSlices:d,numValues:h}=Bfe(s,i,n,c),p=jfe(u),g=zfe(t,r,o,d,h);return[p,g[0],g[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n9=2147483647;function PO(n,e,t,r,o,s,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=o.length===0,c=i.length===0,u=[];a||u.push(e[0]),l||u.push(o[0]),c||u.push(i[0]);for(let y=1;y<u.length;++y)if(u[y]!==u[y-1])throw new Error("starts, limits, and deltas must have the same shape");const d=u.length===0?1:u[0],h=mr("int32",d+1);h[0]=0;for(let y=0;y<d;++y){const b=a?n[0]:n[y],C=l?r[0]:r[y],S=c?s[0]:s[y];if(S===0)throw new Error("Requires delta != 0");let k;if(S>0&&C<b||S<0&&C>b)k=0;else if(k=Math.ceil(Math.abs((C-b)/S)),k>n9)throw new Error(`Requires ((limit - start) / delta) <= ${n9}`);h[y+1]=h[y]+k}const p=h[d],g=mr(t,p);let x=0;for(let y=0;y<d;++y){const b=h[y+1]-h[y];let C=a?n[0]:n[y];const S=c?s[0]:s[y];for(let k=0;k<b;++k)g[x++]=C,C+=S}return[h,g]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Si=oa;class av{constructor(e,t,r,o,s,i,a,l,c,u){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=o,this.valuesDType=s,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=bF(u),this.raggedRank=wF(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Si.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Si.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Si.VALUE_ROWIDS:return av.getMaxWidthValueRowID(t);case Si.ROW_SPLITS:return av.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Si[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let o=0;o<t-1;++o){const s=e[o+1]-e[o];s>r&&(r=s)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,o=e[0],s=0;for(let i=1;i<t;++i){const a=e[i];a!==o&&(o=a,s=Math.max(i-r,s),r=i)}return Math.max(t-r,s)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return o9(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;CF(r,t);const o=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=yF(this.raggedRank,o,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,r){const o=Math.min(e,r),s=[];let i=0;for(let a=0;a<o;++a,i+=t)s.push(i);for(let a=o;a<e;++a)s.push(-1);return K(s.length===e,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(e,t,r,o){const s=e.length,i=[];for(let a=0;a<s-1;++a){const l=e[a+1]-e[a];let c=Math.min(o,l),u=t[a];u===-1&&(c=0);for(let d=0;d<c;++d)i.push(u),u+=r;for(let d=0;d<l-c;++d)i.push(-1)}if(s>0&&i.length!==e[s-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,r,o){const s=e.length,i=[];if(s===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let c=t[l];i.push(c);for(let u=1;u<s;++u){const d=e[u];if(d===l)c>=0&&(++a,a<o?c+=r:c=-1);else{if(a=0,l=d,d>=t.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${t.length}`);c=t[d]}i.push(c)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,r,o){const s=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Si.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,t,r,o);case Si.ROW_SPLITS:if(s.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(s,t,r,o);default:throw new Error(`Unsupported partition type: ${Si[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Si.FIRST_DIM_SIZE:return e[0];case Si.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Si.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Si[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let l=o.length-2;l>=0;--l)o[l]=o[l+1]*r[l+1];const s=o9(r,!1),i=mr(this.valuesDType,De(s));if(o[0]*r[0]>0){let l=this.calculateFirstParentOutputIndex(t,o[0],r[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,o[c],r[c]);this.setOutput(this.raggedRank,l,i,s)}return[s,i]}setOutput(e,t,r,o){if(r.length===0)return;const s=this.values,i=r;let a=o.slice();a=a.slice(e+1);const l=De(a),c=t.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const g=this.defaultValueShape;ve(()=>{const x=pe(u,g);u=Yp(x,a).dataSync()})}let d=0,h=0,p=0;for(let g=0;g<=c;++g){let x=g<c?t[g]:-1;if(x===p){++p;continue}if(h<p){const y=s.subarray(d*l),b=i.subarray(h*l),C=(p-h)*l;r9(b,y,C)}if(g>=c){const y=r.length;x=Math.floor(y/l)}if(x>p)if(this.defaultValue.length===1)i.subarray(p*l,x*l).fill(this.defaultValue[0]),p=x;else for(;x>p;){const y=i.slice(p*l);r9(y,u,l),++p}x<0?(d=g+1,h=p):(d=g,h=p,p=h+1)}}}function r9(n,e,t){for(let r=0;r<t;r++)n[r]=e[r]}function o9(n,e){const t=[];for(let r of n){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function MO(n,e,t,r,o,s,i,a,l,c){return new av(n,e,t,r,o,s,i,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OO(n,e,t,r){const o=n===e,s=n<e&&t<0,i=e<n&&t>1;if(o||s||i)return To(0,r);const a=Math.abs(Math.ceil((e-n)/t)),l=To(a,r);e<n&&t===1&&(t=-1),l[0]=n;for(let c=1;c<l.length;c++)l[c]=l[c-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LO=bl(n=>1/Math.sqrt(n)),Wfe=wu(k1,LO),Ufe={kernelName:k1,backendName:"cpu",kernelFunc:Wfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function id(n,e,t,r,o,s,i,a,l,c){const u=[r/o,o],d=n.values,h=e.values;if(r===0)return Zt(t,e.dtype);const p=l instanceof ho?l:Zt(u,e.dtype);typeof l=="string"||typeof l=="number"?p.values.fill(l):typeof l=="boolean"&&p.values.fill(+l);for(let g=0;g<s;g++){const x=[];let y=0;for(let b=0;b<i;b++){const C=d[g*i+b];x.push(C),y+=C*a[b]}if(y<0||y>=r/o)throw new Error(`Invalid indices: ${x} does not index into ${t}`);for(let b=0;b<o;b++)c?p.values[y*o+b]+=h[g*o+b]:p.values[y*o+b]=e.rank===0?h[0]:h[g*o+b]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hfe=bl(n=>1/(1+Math.exp(-n))),BO=_n(T1,n=>1/(1+Math.exp(-n))),Gfe={kernelName:T1,backendName:"cpu",kernelFunc:BO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jO(n,e,t,r,o){const s=ak(r,e,t),i=De(t),a=Nt(r);if(s){const d=lk(e,a);return o==="string"?n.slice(d,d+i):n.subarray(d,d+i)}const l=o==="string"?Jl(n):n,c=Zt(r,o,l),u=Zt(t,o);for(let d=0;d<u.size;++d){const h=u.indexToLoc(d),p=h.map((g,x)=>g+e[x]);u.set(c.get(...p),...h)}return o==="string"?zF(u.values):u.values}function Td(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{begin:s,size:i}=r;ht(o,"slice");const[a,l]=oy(o,s,i);sk(o,a,l);const c=t.data.get(o.dataId).values,u=jO(c,a,l,o.shape,o.dtype);return t.makeTensorInfo(l,o.dtype,u)}const qfe={kernelName:V2,backendName:"cpu",kernelFunc:Td};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VO(n,e,t,r,o,s,i){const a=e[0],l=s[0],c=new Array(l),u=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(RF(a));const y=mr(t,0),b=mr(o,0);return[y,[0,d],b,c,u]}let h=!0,p=0;const g=new Array(l).fill(0);for(let y=0;y<a;++y){const b=n[y*d];if(b<0)throw new Error(DF(y,b));if(b>=l)throw new Error(AF(y,b,l));++g[b],h=h&&b>=p,p=b}let x=!0;for(let y=0;y<l;++y){const b=g[y]===0;c[y]=b,x=x&&!b,g[y]=Math.max(g[y],1),y>0&&(g[y]+=g[y-1])}if(x&&h){const y=n,b=r;for(let C=0;C<a;++C)u[C]=C;return[y,[a,d],b,c,u]}else{const y=g[l-1],b=mr(t,y*d),C=mr(o,y),S=new Array(l).fill(0);for(let k=0;k<a;++k){const N=n[k*d],E=S[N],_=(N===0?0:g[N-1])+E;S[N]++;for(let $=0;$<d;++$)b[_*d+$]=n[k*d+$];C[_]=r[k],u[k]=_}for(let k=0;k<l;++k)if(S[k]===0){const E=k===0?0:g[k-1];b[E*d+0]=k;for(let _=1;_<d;++_)b[E*d+_]=0;C[E]=i}return[b,[y,d],C,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zO(n,e,t,r,o){const s=De(r),i=e[0],a=o.length,l=[];let c=1,u=-1;for(let y=0;y<a;++y){const b=o[y];if(b===-1){if(u!==-1)throw new Error(_F(u,y));u=y,l.push(1)}else{if(b<0)throw new Error($F(y,b));c*=b,l.push(b)}}if(u!==-1){if(c<=0)throw new Error(FF());const y=Math.trunc(s/c);if(c*y!==s)throw new Error(PF(r,l));l[u]=y}if(De(l)!==s)throw new Error(MF(r,l));const h=r.length,p=[];if(h>0){p[h-1]=1;for(let y=h-2;y>=0;--y)p[y]=p[y+1]*r[y+1]}const g=[];if(a>0){g[a-1]=1;for(let y=a-2;y>=0;--y)g[y]=g[y+1]*l[y+1]}const x=mr(t,i*a);for(let y=0;y<i;++y){let b=0;for(let C=0;C<h;++C)b+=n[y*h+C]*p[C];for(let C=0;C<a;++C)x[y*a+C]=Math.trunc(b/g[C]),b%=g[C]}return[x,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8(n,e,t,r,o,s=!1,i=0){const a=r.length,l=[e[0],n.length/e[0]],c=l[1],d=a>0?o[a-1]+1:0;if(d<0)throw new Error(zC());const h=e.slice();h[0]=d;const p=h.reduce((S,k)=>S*k,1),g=mr(t,p);if(a===0)return d>0&&g.fill(i),[g,h];if(d<=0)throw new Error(zC());let x=0,y=1,b=0,C=o[x];for(;;){let S=0;if(y<a){if(S=o[y],C===S){++y;continue}if(C>=S)throw new Error(OF())}if(C<0||C>=d)throw new Error(LF(C,d));C>b&&g.fill(i,b*c,C*c);for(let k=x;k<y;++k){const N=r[k];if(N<0||N>=l[0])throw new Error(BF(k,r[k],l[0]));for(let E=0;E<c;E++)g[C*c+E]+=n[N*c+E]}if(s)for(let k=0;k<c;k++)g[C*c+k]/=y-x;if(x=y,++y,b=C+1,C=S,y>a)break}return b<d&&g.fill(i,b*c,d*c),[g,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kfe=bl(n=>Math.sqrt(n)),Xfe=_n(D1,n=>Math.sqrt(n)),Yfe={kernelName:D1,backendName:"cpu",kernelFunc:Xfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WO=br(((n,e)=>{const t=n-e;return t*t})),Zfe=jr(A1,WO),Qfe={kernelName:A1,backendName:"cpu",kernelFunc:Zfe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UO=bl((n,e)=>{const{pattern:t,replaceGlobal:r,rewrite:o}=e;return n.replace(new RegExp(t,r?"g":""),o)}),Jfe=wu(b6,UO),epe={kernelName:b6,backendName:"cpu",kernelFunc:Jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HO(n,e,t,r){const o=Zt(n,e.dtype);for(let s=0;s<o.size;s++){const i=o.indexToLoc(s),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*t[l]+r[l];o.set(e.get(...a),...i)}return o}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tpe{constructor(e,t,r,o,s,i){this.separator=Zc(e),this.nGramWidths=t,this.leftPad=Zc(r),this.rightPad=Zc(o),this.padWidth=s,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)}createNGrams(e,t,r,o,s,i){for(let a=0;a<s;++a){const l=this.getPadWidth(i),c=Math.max(0,l-a),u=Math.max(0,l-(s-(a+1))),d=i-(c+u),h=t+(c>0?0:a-l);let p=0;p+=c*this.leftPad.length;for(let C=0;C<d;++C)p+=e[h+C].length;p+=u*this.rightPad.length;const g=c+u+d-1;p+=g*this.separator.length,r[o+a]=new Uint8Array(p);const x=r[o+a];let y=0;const b=C=>C.forEach(S=>x[y++]=S);for(let C=0;C<c;++C)b(this.leftPad),b(this.separator);for(let C=0;C<d-1;++C)b(e[h+C]),b(this.separator);if(d>0){b(e[h+d-1]);for(let C=0;C<u;++C)b(this.separator),b(this.rightPad)}else{for(let C=0;C<u-1;++C)b(this.rightPad),b(this.separator);b(this.rightPad)}}}compute(e,t){const r=e.length,o=t.length;if(o>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<o;++c){let u=t[c]>=l;if(u=u&&t[c]<=r,!u)throw new Error(`Invalid split value ${t[c]}, must be in [${l}, ${r}]`);l=t[c]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}const s=o-1,i=mr("int32",o);if(r===0||o===0){const l=new Array(r);for(let c=0;c<=s;++c)i[c]=0;return[l,i]}i[0]=0;for(let l=1;l<=s;++l){const c=t[l]-t[l-1];let u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),i[l]=i[l-1]+u}const a=new Array(i[s]);for(let l=0;l<s;++l){const c=t[l];let u=i[l];if(this.nGramWidths.forEach(d=>{const h=t[l+1]-t[l],p=this.getNumNGrams(h,d);this.createNGrams(e,c,a,u,p,d),u+=p}),this.preserveShort&&u===i[l]){const d=t[l+1]-t[l];if(d===0)continue;const h=d+2*this.padWidth;this.createNGrams(e,c,a,u,1,h)}}return[a,i]}}function GO(n,e,t,r,o,s,i,a){return new tpe(t,r,o,s,i,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function npe(n,e,t,r){if(!n.length)return;if(e.length===0){for(let s=0;s<n.length;++s)r.push(n.subarray(s,s+1));return}if(e.length===1){const s=e[0];let i=n.indexOf(s);for(;i!==-1;){const a=n.subarray(0,i);(!t||a.length!==0)&&r.push(a),n=n.subarray(i+1),i=n.indexOf(s)}(!t||n.length!==0)&&r.push(n);return}let o=0;for(let s=0;s<n.length+1;s++)if(s===n.length||e.indexOf(n[s])!==-1){const i=n.subarray(o,s);(!t||i.length!==0)&&r.push(i),o=s+1}}function qO(n,e,t){const r=n.length,o=[];let s=0,i=0;const a=new Array(r);for(let h=0;h<r;++h){const p=o.length;npe(n[h],e,t,o);const g=o.length-p;a[h]=g,s+=g,i=Math.max(i,g)}const l=mr("int32",s*2),c=new Array(s),u=[r,i];let d=0;for(let h=0;h<r;++h)for(let p=0;p<a[h];++p)l[d*2]=h,l[d*2+1]=p,c[d]=o[d],++d;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KO(n,e){const t=mr("int32",n.length);for(let r=0;r<n.length;++r)t[r]=$ne(n[r]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XO=br(((n,e)=>n-e)),rpe=Zk(((n,e,t,r)=>({real:n-t,imag:e-r}))),n8=jr(_1,XO,rpe),ope={kernelName:_1,backendName:"cpu",kernelFunc:n8};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YO(n,e){const t=new Array(n.rank);for(let o=0;o<t.length;o++)t[o]=n.shape[o]*e[o];const r=Zt(t,n.dtype);for(let o=0;o<r.values.length;++o){const s=r.indexToLoc(o),i=new Array(n.rank);for(let l=0;l<i.length;l++)i[l]=s[l]%n.shape[l];const a=n.locToIndex(i);r.values[o]=n.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wp=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function ZO(n,e,t=0,r=n.length-1){for(;r>t;){if(r-t>600){const a=r-t+1,l=e-t+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),h=Math.max(t,Math.floor(e-l*u/a+d)),p=Math.min(r,Math.floor(e+(a-l)*u/a+d));ZO(n,e,h,p)}const o=n[e];let s=t,i=r;for(Vh(n,t,e),Wp(n[r],o)>0&&Vh(n,t,r);s<i;){for(Vh(n,s,i),s++,i--;Wp(n[s],o)<0;)s=s+1;for(;Wp(n[i],o)>0;)i=i-1}Wp(n[t],o)===0?Vh(n,t,i):(i=i+1,Vh(n,i,r)),i<=e&&(t=i+1),e<=i&&(r=i-1)}}function QO(n,e,t,r,o){const s=e[e.length-1],[i,a]=[n.length/s,s],l=Eo(t,i*r),c=Eo("int32",i*r);for(let d=0;d<i;d++){const h=d*a,p=n.subarray(h,h+a);let g=new Array(p.length);p.forEach((C,S)=>g[S]={value:C,index:S}),r<g.length&&(ZO(g,r),g=g.slice(0,r)),o&&g.sort(Wp);const x=d*r,y=l.subarray(x,x+r),b=c.subarray(x,x+r);for(let C=0;C<r;C++)y[C]=g[C].value,b[C]=g[C].index}const u=e.slice();return u[u.length-1]=r,[Zt(u,t,l),Zt(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JO(n,e,t,r){const o=Qt(e,t)[0],s=[1,t[0],1];for(let g=0;g<o;g++)s[0]*=t[g];s[1]=t[o];for(let g=o+1;g<t.length;g++)s[2]*=t[g];const i=new Map,a=new Int32Array(t[o]),l=new ho(s,r,n),c=[],u=s[0]===1&&s[2]===1;for(let g=0;g<t[o];g++){let x;if(u)x=n[g].toString();else{const b=[];for(let C=0;C<s[0];C++)for(let S=0;S<s[2];S++)b.push(l.get(C,g,S));x=b.join(",")}const y=i.get(x);if(y!=null)a[g]=y;else{const b=i.size;i.set(x,b),a[g]=b,c.push(g)}}const d=s.slice();d[1]=i.size;const h=new ho(d,r);c.forEach((g,x)=>{for(let y=0;y<s[0];y++)for(let b=0;b<s[2];b++)h.set(l.get(y,g,b),y,x,b)});const p=t.slice();return p[o]=d[1],{outputValues:h.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const spe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:lO,bincountImpl:Qk,bincountReduceImpl:cO,bitwiseAndImpl:uO,castImpl:aO,ceilImpl:dO,concatImpl:hO,equalImpl:fO,expImpl:mO,expm1Impl:xO,floorDivImpl:yO,floorImpl:vO,gatherNdImpl:bO,gatherV2Impl:wO,greaterEqualImpl:kO,greaterImpl:CO,lessEqualImpl:NO,lessImpl:SO,linSpaceImpl:IO,logImpl:EO,maxImpl:TO,maximumImpl:RO,minimumImpl:DO,multiplyImpl:Jk,negImpl:AO,notEqualImpl:_O,prodImpl:$O,raggedGatherImpl:FO,raggedRangeImpl:PO,raggedTensorToTensorImpl:MO,rangeImpl:OO,rsqrtImpl:LO,scatterImpl:id,sigmoidImpl:Hfe,simpleAbsImpl:iO,sliceImpl:jO,sparseFillEmptyRowsImpl:VO,sparseReshapeImpl:zO,sparseSegmentReductionImpl:t8,sqrtImpl:Kfe,squaredDifferenceImpl:WO,staticRegexReplaceImpl:UO,stridedSliceImpl:HO,stringNGramsImpl:GO,stringSplitImpl:qO,stringToHashBucketFastImpl:KO,subImpl:XO,tileImpl:YO,topKImpl:QO,transposeImpl:e8,uniqueImpl:JO},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */v$("cpu",()=>new vy,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eL=_n(t1,n=>n>=0?n:Math.exp(n)-1),ipe={kernelName:t1,backendName:"cpu",kernelFunc:eL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{alpha:s}=r;ht([o],"leakyRelu");const i=De(o.shape),a=t.data.get(o.dataId).values,l=Eo("float32",i);for(let c=0;c<a.length;c++)l[c]=a[c]<0?s*a[c]:a[c];return t.makeTensorInfo(o.shape,"float32",l)}const ape={kernelName:m2,backendName:"cpu",kernelFunc:tL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lpe=br((n,e)=>n<0?e*n:n);function nL(n){const{inputs:e,backend:t}=n,{x:r,alpha:o}=e;ht([r,o],"prelu");const s=t.data.get(r.dataId).values,i=t.data.get(o.dataId).values,[a,l]=lpe(r.shape,o.shape,s,i,"float32");return t.makeTensorInfo(l,"float32",a)}const cpe={kernelName:F2,backendName:"cpu",kernelFunc:nL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rL=_n(b1,n=>Math.max(0,n)),upe={kernelName:b1,backendName:"cpu",kernelFunc:rL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oL=_n(w1,n=>Math.min(Math.max(0,n),6)),dpe={kernelName:w1,backendName:"cpu",kernelFunc:oL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lv(n,e,t,r,o){if(t==="linear")return pl({inputs:{x:e},backend:n});if(t==="relu")return rL({inputs:{x:e},backend:n});if(t==="elu")return eL({inputs:{x:e},backend:n});if(t==="relu6")return oL({inputs:{x:e},backend:n});if(t==="prelu")return nL({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return tL({inputs:{x:e},backend:n,attrs:{alpha:o}});if(t==="sigmoid")return BO({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vn(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{shape:s}=r,i=De(o.shape),a=E_(s,i),l=De(a);K(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(o.dataId);const c=t.data.get(o.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}const hpe={kernelName:M2,backendName:"cpu",kernelFunc:Vn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sL(n){const{inputs:e,backend:t,attrs:r}=n,{a:o,b:s}=e,{transposeA:i,transposeB:a}=r;ht([o,s],"matMul");const l=o.shape.length,c=s.shape.length,u=i?o.shape[l-2]:o.shape[l-1],d=a?s.shape[c-1]:s.shape[c-2],h=i?o.shape[l-1]:o.shape[l-2],p=a?s.shape[c-2]:s.shape[c-1],g=o.shape.slice(0,-2),x=s.shape.slice(0,-2),y=De(g),b=De(x),S=Ut(o.shape.slice(0,-2),s.shape.slice(0,-2)).concat([h,p]);K(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${o.shape} and ${s.shape} and transposeA=${i} and transposeB=${a} must match.`);const k=i?[y,u,h]:[y,h,u],N=a?[b,p,d]:[b,d,p],E=Vn({inputs:{x:o},backend:t,attrs:{shape:k}}),_=Vn({inputs:{x:s},backend:t,attrs:{shape:N}}),$=i?E.shape[1]:E.shape[2],T=i?E.shape[2]:E.shape[1],D=a?_.shape[1]:_.shape[2],A=Math.max(y,b),M=t.data.get(E.dataId).values,j=t.data.get(_.dataId).values,L=Nt(E.shape),U=Nt(_.shape),[G,H,O]=i?[L[0],1,L[1]]:[L[0],L[1],1],[V,W,B]=a?[1,U[1],U[0]]:[U[1],1,U[0]],q=T*D,Q=Zt([A,T,D],E.dtype),Z=Q.values,ne=t.blockSize;for(let ge=0;ge<A;ge++){const he=ge%y,Se=ge%b;for(let Re=0;Re<T;Re+=ne){const We=Math.min(Re+ne,T);for(let Be=0;Be<D;Be+=ne){const Xe=Math.min(Be+ne,D);for(let Ye=0;Ye<$;Ye+=ne){const ot=Math.min(Ye+ne,$);for(let Qe=Re;Qe<We;Qe++)for(let ct=Be;ct<Xe;ct++){let ie=0;for(let $t=Ye;$t<ot;$t++){const Ot=M[he*G+Qe*H+$t*O],qt=j[$t*V+ct*W+Se*B];ie+=Ot*qt}Z[ge*q+(Qe*D+ct)]+=ie}}}}}return t.disposeIntermediateTensorInfo(E),t.disposeIntermediateTensorInfo(_),t.makeTensorInfo(S,Q.dtype,Q.values)}const fpe={kernelName:e2,backendName:"cpu",kernelFunc:sL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ppe(n){const{inputs:e,backend:t,attrs:r}=n,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;let h,p,g;const x=[];h=sL({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:c},backend:t}),i&&(p=yf({inputs:{a:h,b:i},backend:t}),x.push(h),h=p),u&&(g=lv(t,h,u,a,d),x.push(h),h=g);for(const b of x)t.disposeIntermediateTensorInfo(b);return h}const mpe={kernelName:zx,backendName:"cpu",kernelFunc:ppe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gpe=_n(zm,n=>Math.acos(n)),xpe={kernelName:zm,backendName:"cpu",kernelFunc:gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vpe=_n(Wm,n=>Math.acosh(n)),ype={kernelName:Wm,backendName:"cpu",kernelFunc:vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bpe(n){const{inputs:e,backend:t}=n,r=e;ht(e,"addN");const o=r.map(a=>t.data.get(a.dataId).values),s=Zt(r[0].shape,r[0].dtype),i=s.values;for(let a=0;a<r.length;a++){const l=o[a];for(let c=0;c<i.length;c++)i[c]+=l[c]}return t.makeTensorInfo(s.shape,s.dtype,s.values)}const wpe={kernelName:B5,backendName:"cpu",kernelFunc:bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r;ht(o,"all");const a=Qt(s,o.shape);let l=a;const c=sr(l,o.shape.length);let u=o;c!=null&&(u=ps({inputs:{x:o},backend:t,attrs:{perm:c}}),l=vr(l.length,o.shape.length)),mo("all",l,u.shape.length);const[d,h]=to(u.shape,l),p=De(h),g=To(De(d),u.dtype),x=t.data.get(u.dataId).values;for(let b=0;b<g.length;++b){const C=b*p;let S=x[C];for(let k=0;k<p;++k){const N=x[C+k];S=S&&N}g[b]=S}c!=null&&t.disposeIntermediateTensorInfo(u);const y=t.makeTensorInfo(d,u.dtype,g);if(i){const b=Ir(d,a),C=Vn({inputs:{x:y},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(y),C}return y}const kpe={kernelName:j5,backendName:"cpu",kernelFunc:Cpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Spe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r;ht(o,"any");const a=Qt(s,o.shape);let l=a;const c=sr(l,o.shape.length);let u=o;c!=null&&(u=ps({inputs:{x:o},backend:t,attrs:{perm:c}}),l=vr(l.length,o.shape.length)),mo("any",l,u.shape.length);const[d,h]=to(u.shape,l),p=De(h),g=To(De(d),u.dtype),x=t.data.get(u.dataId).values;for(let b=0;b<g.length;++b){const C=b*p;let S=x[C];for(let k=0;k<p;++k){const N=x[C+k];S=S||N}g[b]=S}c!=null&&t.disposeIntermediateTensorInfo(u);const y=t.makeTensorInfo(d,u.dtype,g);if(i){const b=Ir(d,a),C=Vn({inputs:{x:y},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(y),C}return y}const Npe={kernelName:V5,backendName:"cpu",kernelFunc:Spe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ipe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s}=r;ht(o,"argMax");let i=Qt(s,o.shape);const a=sr(i,o.shape.length);let l=o;const c=[];a!=null&&(l=ps({inputs:{x:o},backend:t,attrs:{perm:a}}),c.push(l),i=vr(i.length,l.shape.length)),i=[i[0]],mo("argMax",i,l.shape.length);const[u,d]=to(l.shape,i),h=De(u),p=To(h,"int32"),g=De(d),x=t.data.get(l.dataId).values;for(let y=0;y<p.length;++y){const b=y*g;let C=x[b],S=0;for(let k=0;k<g;++k){const N=x[b+k];N>C&&(C=N,S=k)}p[y]=S}return c.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.makeTensorInfo(u,"int32",p)}const Epe={kernelName:Yv,backendName:"cpu",kernelFunc:Ipe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s}=r;ht(o,"argMin");let i=Qt(s,o.shape);const a=sr(i,o.shape.length);let l=o;const c=[];a!=null&&(l=ps({inputs:{x:o},backend:t,attrs:{perm:a}}),c.push(l),i=vr(i.length,l.shape.length)),i=[i[0]],mo("argMin",i,l.shape.length);const[u,d]=to(l.shape,i),h=De(u),p=To(h,"int32"),g=De(d),x=t.data.get(l.dataId).values;for(let y=0;y<p.length;++y){const b=y*g;let C=x[b],S=0;for(let k=0;k<g;++k){const N=x[b+k];N<C&&(C=N,S=k)}p[y]=S}return c.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.makeTensorInfo(u,"int32",p)}const Rpe={kernelName:Zv,backendName:"cpu",kernelFunc:Tpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dpe=_n(Um,n=>Math.asin(n)),Ape={kernelName:Um,backendName:"cpu",kernelFunc:Dpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _pe=_n(Hm,n=>Math.asinh(n)),$pe={kernelName:Hm,backendName:"cpu",kernelFunc:_pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fpe=_n(Gm,n=>Math.atan(n)),Ppe={kernelName:Gm,backendName:"cpu",kernelFunc:Fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mpe=br((n,e)=>Math.atan2(n,e)),Ope=jr(Km,Mpe),Lpe={kernelName:Km,backendName:"cpu",kernelFunc:Ope};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bpe=_n(qm,n=>Math.atanh(n)),jpe={kernelName:qm,backendName:"cpu",kernelFunc:Bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8(n,e,t,r,o,s){const i=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,u=o.effectiveFilterHeight,d=o.effectiveFilterWidth,h=o.padInfo.top,p=o.padInfo.left,g=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Zt(o.outShape,t),y=x.values,b=o.outShape[1]*o.outShape[2]*o.outShape[3],C=o.outShape[2]*o.outShape[3],S=o.outShape[3];for(let k=0;k<o.batchSize;++k){const N=k*b,E=k*r[0];for(let _=0;_<o.inChannels;++_)for(let $=0;$<o.outHeight;++$){const T=$*i-h,D=Math.max(0,T),A=Math.min(o.inHeight,u+T),M=N+$*C;for(let j=0;j<o.outWidth;++j){const L=j*a-p,U=Math.max(0,L),G=Math.min(o.inWidth,d+L);let H=g,O=0,V=0;for(let B=D;B<A;B+=l){const q=E+B*r[1];for(let Q=U;Q<G;Q+=c){const Z=q+Q*r[2],ne=n[Z+_];s==="max"&&ne>H?H=ne:s==="avg"&&(O+=ne,V++)}if(isNaN(H))break}const W=M+j*S+_;y[W]=s==="avg"?O/V:H}}}return x}function iL(n,e,t,r,o=!1,s=!1){const i=Zt(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,x=Zt(e,t,n);for(let y=0;y<r.batchSize;++y)for(let b=0;b<r.inChannels;++b)for(let C=0;C<r.outHeight;++C){const S=C*a-p;let k=S;for(;k<0;)k+=c;const N=Math.min(r.inHeight,d+S);for(let E=0;E<r.outWidth;++E){const _=E*l-g;let $=_;for(;$<0;)$+=u;const T=Math.min(r.inWidth,h+_);let D=Number.NEGATIVE_INFINITY,A=-1;for(let M=k;M<N;M+=c){const j=M-S;for(let L=$;L<T;L+=u){const U=L-_,G=x.get(y,M,L,b);G>D&&(D=G,o?A=s?((y*r.inHeight+M)*r.inWidth+L)*r.inChannels+b:(M*r.inWidth+L)*r.inChannels+b:A=j*h+U)}}i.set(A,y,C,E,b)}}return i}function aL(n,e,t,r,o,s){const i=o.strideDepth,a=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,u=o.dilationHeight,d=o.dilationWidth,h=o.effectiveFilterDepth,p=o.effectiveFilterHeight,g=o.effectiveFilterWidth,x=o.padInfo.front,y=o.padInfo.top,b=o.padInfo.left,C=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=Zt(o.outShape,t),k=S.values,N=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],E=o.outShape[2]*o.outShape[3]*o.outShape[4],_=o.outShape[3]*o.outShape[4],$=o.outShape[4];for(let T=0;T<o.batchSize;++T){const D=T*N,A=T*r[0];for(let M=0;M<o.inChannels;++M)for(let j=0;j<o.outDepth;++j){const L=j*i-x;let U=L;for(;U<0;)U+=c;const G=Math.min(o.inDepth,h+L),H=D+j*E;for(let O=0;O<o.outHeight;++O){const V=O*a-y;let W=V;for(;W<0;)W+=u;const B=Math.min(o.inHeight,p+V),q=H+O*_;for(let Q=0;Q<o.outWidth;++Q){const Z=Q*l-b;let ne=Z;for(;ne<0;)ne+=d;const ge=Math.min(o.inWidth,g+Z),he=q+Q*$;let Se=C,Re=0,We=0;for(let Xe=U;Xe<G;Xe+=c){const Ye=A+Xe*r[1];for(let ot=W;ot<B;ot+=u){const Qe=Ye+ot*r[2];for(let ct=ne;ct<ge;ct+=d){const ie=Qe+ct*r[3],$t=n[ie+M];if(s==="max"&&$t>Se?Se=$t:s==="avg"&&(Re+=$t,We++),isNaN(Se))break}if(isNaN(Se))break}if(isNaN(Se))break}const Be=he+M;k[Be]=s==="avg"?Re/Math.max(We,1):Se}}}}return S}function Vpe(n,e){const t=Zt(e.outShape,"int32"),r=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,g=e.padInfo.left;for(let x=0;x<e.batchSize;++x)for(let y=0;y<e.inChannels;++y)for(let b=0;b<e.outDepth;++b){const C=b*r-h;let S=C;for(;S<0;)S+=i;const k=Math.min(e.inDepth,c+C);for(let N=0;N<e.outHeight;++N){const E=N*o-p;let _=E;for(;_<0;)_+=a;const $=Math.min(e.inHeight,u+E);for(let T=0;T<e.outWidth;++T){const D=T*s-g;let A=D;for(;A<0;)A+=l;const M=Math.min(e.inWidth,d+D);let j=Number.NEGATIVE_INFINITY,L=-1;for(let U=S;U<k;U+=i){const G=U-C;for(let H=_;H<$;H+=a){const O=H-E;for(let V=A;V<M;V+=l){const W=V-D,B=n.get(x,U,H,V,y);B>=j&&(j=B,L=G*u*d+O*u+W)}}}t.set(L,x,b,N,T,y)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e;ht(o,"avgPool");const{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=r,c=1;K(Do(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Pi(o.shape,s,i,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&In(u.inShape,u.outShape))d=pl({inputs:{x:o},backend:t});else{const h=t.data.get(o.dataId).values,p=Nt(o.shape),g=r8(h,o.shape,o.dtype,p,u,"avg");d=t.makeTensorInfo(u.outShape,o.dtype,g.values)}return d}const Wpe={kernelName:Qv,backendName:"cpu",kernelFunc:zpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Upe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=r;ht(o,"avgPool3d");const u=ac(o.shape,s,i,1,a,l,c),d=t.data.get(o.dataId).values,h=aL(d,o.shape,o.dtype,Nt(o.shape),u,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}const Hpe={kernelName:Jv,backendName:"cpu",kernelFunc:Upe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gpe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,input:s}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:c}=r;ht([o,s],"avgPool3DGrad");const u=ac(s.shape,i,a,1,l,c),d=u.strideDepth,h=u.strideHeight,p=u.strideWidth,g=u.filterDepth,x=u.filterHeight,y=u.filterWidth,b=u.dilationDepth,C=u.dilationHeight,S=u.dilationWidth,k=u.effectiveFilterDepth,N=u.effectiveFilterHeight,E=u.effectiveFilterWidth,_=k-1-u.padInfo.front,$=E-1-u.padInfo.left,T=N-1-u.padInfo.top,D=Zt(s.shape,"float32"),A=1/(g*x*y),M=t.bufferSync(o);for(let j=0;j<u.batchSize;++j)for(let L=0;L<u.inChannels;++L)for(let U=0;U<u.inDepth;++U)for(let G=0;G<u.inHeight;++G)for(let H=0;H<u.inWidth;++H){const O=U-_,V=G-T,W=H-$;let B=0;for(let q=0;q<k;q+=b){const Q=(O+q)/d;if(!(Q<0||Q>=u.outDepth||Math.floor(Q)!==Q))for(let Z=0;Z<N;Z+=C){const ne=(V+Z)/h;if(!(ne<0||ne>=u.outHeight||Math.floor(ne)!==ne))for(let ge=0;ge<E;ge+=S){const he=(W+ge)/p;if(he<0||he>=u.outWidth||Math.floor(he)!==he)continue;const Se=M.get(j,Q,ne,he,L);B+=Se}}}D.set(B*A,j,U,G,H,L)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const qpe={kernelName:W5,backendName:"cpu",kernelFunc:Gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kpe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,input:s}=e,i=s;ht([o,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=Pi(i.shape,a,l,1,c),d=u.strideHeight,h=u.strideWidth,p=u.filterHeight,g=u.filterWidth,x=u.dilationHeight,y=u.dilationWidth,b=u.effectiveFilterHeight,C=u.effectiveFilterWidth,S=C-1-u.padInfo.left,k=b-1-u.padInfo.top,N=Zt(i.shape,"float32"),E=1/(p*g),_=t.data.get(o.dataId).values,$=Zt(o.shape,"float32",_);for(let T=0;T<u.batchSize;++T)for(let D=0;D<u.inChannels;++D)for(let A=0;A<u.inHeight;++A)for(let M=0;M<u.inWidth;++M){const j=A-k,L=M-S;let U=0;for(let G=0;G<b;G+=x){const H=(j+G)/d;if(!(H<0||H>=u.outHeight||Math.floor(H)!==H))for(let O=0;O<C;O+=y){const V=(L+O)/h;if(V<0||V>=u.outWidth||Math.floor(V)!==V)continue;const W=$.get(T,H,V,D);U+=W}}N.set(U*E,T,A,M,D)}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const Xpe={kernelName:z5,backendName:"cpu",kernelFunc:Kpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ype(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,scale:s,offset:i,mean:a,variance:l}=e;K(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),K(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),K(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ht([o,a,l,s,i],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);const u=t.data.get(o.dataId).values,d=t.data.get(a.dataId).values,h=t.data.get(l.dataId).values,p=s?t.data.get(s.dataId).values:new Float32Array([1]),g=i?t.data.get(i.dataId).values:new Float32Array([0]),x=new Float32Array(u.length),y=g.length,b=p.length,C=h.length,S=d.length;let k=0,N=0,E=0,_=0;for(let $=0;$<u.length;++$)x[$]=g[k++]+(u[$]-d[N++])*p[E++]/Math.sqrt(h[_++]+c),k>=y&&(k=0),N>=S&&(N=0),E>=b&&(E=0),_>=C&&(_=0);return t.makeTensorInfo(o.shape,o.dtype,x)}const Zpe={kernelName:h2,backendName:"cpu",kernelFunc:Ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{blockShape:s,crops:i}=r;ht([o],"batchToSpaceND");const a=s.reduce((b,C)=>b*C),l=z1(o.shape,s,a),c=W1(l.length,s.length),u=U1(o.shape,s,a),d=fk(i,s.length),h=pk(u,i,s.length),p=Vn({inputs:{x:o},backend:t,attrs:{shape:l}}),g=ps({inputs:{x:p},backend:t,attrs:{perm:c}}),x=Vn({inputs:{x:g},backend:t,attrs:{shape:u}}),y=Td({inputs:{x},backend:t,attrs:{begin:d,size:h}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}const Jpe={kernelName:t2,backendName:"cpu",kernelFunc:Qpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eme(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,weights:s}=e,{size:i}=r,a=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values,c=Qk(a,l,s.dtype,s.shape,i);return t.makeTensorInfo([i],s.dtype,c)}const tme={kernelName:U5,backendName:"cpu",kernelFunc:eme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nme(n){const{inputs:e,backend:t}=n,{s0:r,s1:o}=e,s=t.data.get(r.dataId).values,i=t.data.get(o.dataId).values,a=Ut(Array.from(s),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const rme={kernelName:$_,backendName:"cpu",kernelFunc:nme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ome=_n(Zm,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),sme={kernelName:Zm,backendName:"cpu",kernelFunc:ome};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ime=n=>{const{x:e}=n.inputs,t=n.backend,r=new Float32Array(De(e.shape)),o=t.data.get(e.dataId),s=o.complexTensorInfos.real,i=o.complexTensorInfos.imag,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],d=l[c];r[c]=Math.hypot(u,d)}return t.makeOutput(r,e.shape,"float32")},ame={kernelName:n2,backendName:"cpu",kernelFunc:ime};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bf(n){const{inputs:e,backend:t}=n,{input:r}=e,o=t.data.get(r.dataId).complexTensorInfos.imag,s=t.data.get(o.dataId).values;return t.makeTensorInfo(o.shape,o.dtype,s)}const lme={kernelName:l6,backendName:"cpu",kernelFunc:bf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wf(n){const{inputs:e,backend:t,attrs:r}=n,{axis:o}=r,s=Qt(o,e[0].shape)[0],i=e.map(x=>x.shape);uk(i,s);let a=ol(e.map(x=>x.shape),s);if(De(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(x=>De(x.shape)>0);if(l.length===1)return pl({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const x=l.map(k=>Ed({inputs:{input:k},backend:t})),y=l.map(k=>bf({inputs:{input:k},backend:t})),b=wf({inputs:x,backend:t,attrs:{axis:s}}),C=wf({inputs:y,backend:t,attrs:{axis:s}}),S=$s({inputs:{real:b,imag:C},backend:t});return x.forEach(k=>t.disposeIntermediateTensorInfo(k)),y.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(C),S}const c=l.map(x=>{const b=[-1,De(x.shape.slice(s))];return Vn({inputs:{x},backend:t,attrs:{shape:b}})}),u=c.map(x=>({vals:t.data.get(x.dataId).values,shape:x.shape}));a=ol(c.map(x=>x.shape),1);const d=c[0].shape[0]===1,h=hO(u,a,e[0].dtype,d),p=ol(l.map(x=>x.shape),s),g=t.makeTensorInfo(p,e[0].dtype,h);return c.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const cme={kernelName:r2,backendName:"cpu",kernelFunc:wf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;ht([o,s],"conv2d");const d=lc(l),h=po(o.shape,s.shape,i,c,a,u,!1,d),p=h.filterHeight,g=h.filterWidth,x=h.dilationHeight,y=h.dilationWidth,b=h.padInfo.left,C=h.padInfo.top,S=h.dataFormat==="channelsLast",k=new ho(h.outShape,o.dtype),N=Nt(o.shape),E=Nt(s.shape),_=N[0],$=S?N[1]:N[2],T=S?N[2]:1,D=S?1:N[1],A=k.strides[0],M=S?k.strides[1]:k.strides[2],j=S?k.strides[2]:1,L=S?1:k.strides[1],U=t.data.get(o.dataId).values,G=t.data.get(s.dataId).values,H=k.values;for(let O=0;O<h.batchSize;++O){const V=O*_,W=O*A;for(let B=0;B<h.outHeight;++B){const q=W+B*M,Q=B*h.strideHeight-C;for(let Z=0;Z<p;++Z){const ne=Q+Z*x;if(ne<0||ne>=h.inHeight)continue;const ge=Z*E[0],he=V+ne*$;for(let Se=0;Se<h.outWidth;++Se){const Re=q+Se*j,We=Se*h.strideWidth-b;for(let Be=0;Be<g;++Be){const Xe=We+Be*y;if(Xe<0||Xe>=h.inWidth)continue;const Ye=ge+Be*E[1],ot=he+Xe*T;let Qe=Ye;for(let ct=0;ct<h.inChannels;++ct){const ie=U[ot+ct*D];for(let $t=0;$t<h.outChannels;++$t)H[Re+$t*L]+=ie*G[Qe+$t];Qe+=h.outChannels}}}}}}return t.makeTensorInfo(k.shape,k.dtype,H)}const ume={kernelName:o2,backendName:"cpu",kernelFunc:lL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dme(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;ht([o,s],"conv2dBackpropFilter");const d=lc(l),h=po(o.shape,u,i,1,a,c,!1,d),{strideHeight:p,strideWidth:g,filterHeight:x,filterWidth:y}=h,b=h.dataFormat==="channelsLast",C=new ho(h.filterShape,"float32"),S=h.padInfo.left,k=h.padInfo.top,N=t.data.get(o.dataId).values,E=t.data.get(s.dataId).values,_=new ho(o.shape,o.dtype,N),$=new ho(s.shape,s.dtype,E);for(let T=0;T<x;++T){const D=Math.max(0,Math.ceil((k-T)/p)),A=Math.min(h.outHeight,(h.inHeight+k-T)/p);for(let M=0;M<y;++M){const j=Math.max(0,Math.ceil((S-M)/g)),L=Math.min(h.outWidth,(h.inWidth+S-M)/g);for(let U=0;U<h.inChannels;++U)for(let G=0;G<h.outChannels;++G){let H=0;for(let O=0;O<h.batchSize;++O)for(let V=D;V<A;++V){const W=T+V*p-k;for(let B=j;B<L;++B){const q=M+B*g-S;b?H+=_.get(O,W,q,U)*$.get(O,V,B,G):H+=_.get(O,U,W,q)*$.get(O,G,V,B)}}C.set(H,T,M,U,G)}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const hme={kernelName:q5,backendName:"cpu",kernelFunc:dme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fme(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;ht([o,s],"conv2dBackpropInput");const d=Nt(s.shape),h=Nt(o.shape);let p=lc(c);const g=po(i,s.shape,a,1,l,u,!1,p),x=new ho(g.inShape,"float32"),y=x.values,b=t.data.get(o.dataId).values,C=t.data.get(s.dataId).values,[S,k,N]=d,{batchSize:E,filterHeight:_,filterWidth:$,inChannels:T,inHeight:D,inWidth:A,outChannels:M,outHeight:j,outWidth:L,strideHeight:U,strideWidth:G}=g;p=g.dataFormat;const H=_-1-g.padInfo.top,O=$-1-g.padInfo.left,V=p==="channelsLast",W=x.strides[0],B=V?x.strides[1]:x.strides[2],q=V?x.strides[2]:1,Q=V?1:x.strides[1],Z=h[0],ne=V?h[1]:h[2],ge=V?h[2]:1,he=V?1:h[1];for(let Se=0;Se<E;++Se)for(let Re=0;Re<T;++Re)for(let We=0;We<D;++We){const Be=We-H,Xe=Math.max(0,Math.ceil(Be/U)),Ye=Math.min(j,(_+Be)/U);for(let ot=0;ot<A;++ot){const Qe=ot-O,ct=Math.max(0,Math.ceil(Qe/G)),ie=Math.min(L,($+Qe)/G);let $t=0;for(let qt=Xe;qt<Ye;++qt){const en=qt*U-Be;for(let hn=ct;hn<ie;++hn){const cn=hn*G-Qe,tn=Z*Se+ne*qt+ge*hn,Ht=S*(_-1-en)+k*($-1-cn)+N*Re;for(let Yt=0;Yt<M;++Yt){const ye=b[tn+he*Yt],Fe=C[Ht+Yt];$t+=ye*Fe}}}const Ot=W*Se+B*We+q*ot+Q*Re;y[Ot]=$t}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const pme={kernelName:s2,backendName:"cpu",kernelFunc:fme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mme(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=r;ht([o,s],"conv3d");const c=mu(o.shape,s.shape,i,l,a),{filterDepth:u,filterHeight:d,filterWidth:h,dilationDepth:p,dilationHeight:g,dilationWidth:x,padInfo:y}=c,b=y.front,C=y.left,S=y.top,k=new ho(c.outShape,o.dtype),N=t.data.get(o.dataId).values,E=t.data.get(s.dataId).values,_=k.values,$=Nt(o.shape),T=Nt(s.shape);for(let D=0;D<c.batchSize;++D){const A=D*$[0],M=D*k.strides[0];for(let j=0;j<c.outDepth;++j){const L=M+j*k.strides[1],U=j*c.strideDepth-b;for(let G=0;G<u;++G){const H=U+G*p;if(H<0||H>=c.inDepth)continue;const O=G*T[0],V=A+H*$[1];for(let W=0;W<c.outHeight;++W){const B=L+W*k.strides[2],q=W*c.strideHeight-S;for(let Q=0;Q<d;++Q){const Z=q+Q*g;if(Z<0||Z>=c.inHeight)continue;const ne=O+Q*T[1],ge=V+Z*$[2];for(let he=0;he<c.outWidth;++he){const Se=B+he*c.outChannels,Re=he*c.strideWidth-C;for(let We=0;We<h;++We){const Be=Re+We*x;if(Be<0||Be>=c.inWidth)continue;const Xe=ne+We*T[2],Ye=ge+Be*c.inChannels;let ot=Xe;for(let Qe=0;Qe<c.inChannels;++Qe){const ct=N[Ye+Qe];for(let ie=0;ie<c.outChannels;++ie)_[Se+ie]+=ct*E[ot+ie];ot+=c.outChannels}}}}}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const gme={kernelName:i2,backendName:"cpu",kernelFunc:mme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xme(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:l}=r;ht([o,s],"conv3dBackpropFilterV2");const c=Nt(o.shape),u=Nt(s.shape),d=mu(o.shape,l,i,1,a),h=d.strideDepth,p=d.strideHeight,g=d.strideWidth,x=d.filterDepth,y=d.filterHeight,b=d.filterWidth,C=new ho(d.filterShape,"float32"),S=C.values,[k,N,E,_]=C.strides,$=t.data.get(s.dataId).values,[T,D,A,M]=u,j=t.data.get(o.dataId).values,[L,U,G,H]=c,O=d.padInfo.front,V=d.padInfo.left,W=d.padInfo.top;for(let B=0;B<x;++B){const q=Math.max(0,Math.ceil((O-B)/h)),Q=Math.min(d.outDepth,(d.inDepth+O-B)/h),Z=B*k;for(let ne=0;ne<y;++ne){const ge=Math.max(0,Math.ceil((W-ne)/p)),he=Math.min(d.outHeight,(d.inHeight+W-ne)/p),Se=ne*N+Z;for(let Re=0;Re<b;++Re){const We=Math.max(0,Math.ceil((V-Re)/g)),Be=Math.min(d.outWidth,(d.inWidth+V-Re)/g),Xe=Re*E+Se;for(let Ye=0;Ye<d.inChannels;++Ye){const ot=Ye*_+Xe;for(let Qe=0;Qe<d.outChannels;++Qe){let ct=0;for(let ie=0;ie<d.batchSize;++ie){const $t=ie*L,Ot=ie*T;for(let qt=q;qt<Q;++qt){const hn=(B+qt*h-O)*U+$t,cn=qt*D+Ot;for(let tn=ge;tn<he;++tn){const Yt=(ne+tn*p-W)*G+hn,ye=tn*A+cn;for(let Fe=We;Fe<Be;++Fe){const xt=(Re+Fe*g-V)*H+Yt,at=Fe*M+ye;ct+=j[xt+Ye]*$[at+Qe]}}}}S[ot+Qe]=ct}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const vme={kernelName:K5,backendName:"cpu",kernelFunc:xme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yme(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,filter:s}=e,{pad:i,strides:a,inputShape:l}=r;ht([o],"conv3dBackpropInputV2");const c=Nt(o.shape),u=Nt(s.shape),d=mu(l,s.shape,a,1,i),h=new ho(d.inShape,"float32"),p=h.values,[g,x,y,b]=h.strides,C=t.data.get(o.dataId).values,[S,k,N,E]=c,_=t.data.get(s.dataId).values,[$,T,D,A]=u,{batchSize:M,filterDepth:j,filterHeight:L,filterWidth:U,inChannels:G,inDepth:H,inHeight:O,inWidth:V,outChannels:W,outDepth:B,outHeight:q,outWidth:Q,strideDepth:Z,strideHeight:ne,strideWidth:ge}=d,he=j-1-d.padInfo.front,Se=L-1-d.padInfo.top,Re=U-1-d.padInfo.left;for(let We=0;We<M;++We)for(let Be=0;Be<G;++Be)for(let Xe=0;Xe<H;++Xe){const Ye=Xe-he,ot=Math.max(0,Math.ceil(Ye/Z)),Qe=Math.min(B,(j+Ye)/Z);for(let ct=0;ct<O;++ct){const ie=ct-Se,$t=Math.max(0,Math.ceil(ie/ne)),Ot=Math.min(q,(L+ie)/ne);for(let qt=0;qt<V;++qt){const en=qt-Re,hn=Math.max(0,Math.ceil(en/ge)),cn=Math.min(Q,(U+en)/ge);let tn=0;for(let Ht=ot;Ht<Qe;++Ht){const Yt=Ht*Z-Ye;for(let ye=$t;ye<Ot;++ye){const Fe=ye*ne-ie;for(let Oe=hn;Oe<cn;++Oe){const xt=Oe*ge-en,at=S*We+k*Ht+N*ye+E*Oe,Lt=$*(j-1-Yt)+T*(L-1-Fe)+D*(U-1-xt)+A*Be;for(let St=0;St<W;++St){const Rt=C[at+St],On=_[Lt+St];tn+=Rt*On}}}}p[g*We+x*Xe+y*ct+b*qt+Be]=tn}}}return t.makeTensorInfo(h.shape,h.dtype,h.values)}const bme={kernelName:X5,backendName:"cpu",kernelFunc:yme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wme=_n(Qm,n=>Math.cos(n)),Cme={kernelName:Qm,backendName:"cpu",kernelFunc:wme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kme=_n(Jm,n=>Math.cosh(n)),Sme={kernelName:Jm,backendName:"cpu",kernelFunc:kme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nme(n){const{inputs:e,backend:t,attrs:r}=n,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:c}=r,[u,d,h,p]=o.shape,g=s.shape[0],[x,y]=a,b=Zt([g,x,y,p],"float32"),C=t.data.get(s.dataId).values,S=t.data.get(i.dataId).values,k=t.data.get(o.dataId).values,N=Nt(o.shape),E=Nt(b.shape);for(let _=0;_<g;_++){const $=_*4,T=C[$],D=C[$+1],A=C[$+2],M=C[$+3],j=S[_];if(j>=u)continue;const L=x>1?(A-T)*(d-1)/(x-1):0,U=y>1?(M-D)*(h-1)/(y-1):0;for(let G=0;G<x;G++){const H=x>1?T*(d-1)+G*L:.5*(T+A)*(d-1);if(H<0||H>d-1){for(let O=0;O<y;O++)for(let V=0;V<p;V++){const W=V+O*E[2]+G*E[1]+_*E[0];b.values[W]=c}continue}if(l==="bilinear"){const O=Math.floor(H),V=Math.ceil(H),W=H-O;for(let B=0;B<y;B++){const q=y>1?D*(h-1)+B*U:.5*(D+M)*(h-1);if(q<0||q>h-1){for(let ge=0;ge<p;ge++){const he=ge+B*E[2]+G*E[1]+_*E[0];b.values[he]=c}continue}const Q=Math.floor(q),Z=Math.ceil(q),ne=q-Q;for(let ge=0;ge<p;ge++){let he=ge+Q*N[2]+O*N[1]+j*N[0];const Se=k[he];he=ge+Z*N[2]+O*N[1]+j*N[0];const Re=k[he];he=ge+Q*N[2]+V*N[1]+j*N[0];const We=k[he];he=ge+Z*N[2]+V*N[1]+j*N[0];const Be=k[he],Xe=Se+(Re-Se)*ne,Ye=We+(Be-We)*ne;he=ge+B*E[2]+G*E[1]+_*E[0],b.values[he]=Xe+(Ye-Xe)*W}}}else for(let O=0;O<y;++O){const V=y>1?D*(h-1)+O*U:.5*(D+M)*(h-1);if(V<0||V>h-1){for(let q=0;q<p;q++){const Q=q+O*E[2]+G*E[1]+_*E[0];b.values[Q]=c}continue}const W=Math.round(V),B=Math.round(H);for(let q=0;q<p;q++){const Q=q+W*N[2]+B*N[1]+j*N[0],Z=q+O*E[2]+G*E[1]+_*E[0];b.values[Z]=k[Q]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const Ime={kernelName:Z5,backendName:"cpu",kernelFunc:Nme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eme(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,exclusive:i,reverse:a}=r;ht(o,"cumprod");const l=sr([s],o.shape.length);let c=o;l!=null&&(c=ps({inputs:{x:o},backend:t,attrs:{perm:l}}));const u=vr(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Ls(c.dtype,"int32"),h=M5(De(c.shape),d),p=t.data.get(c.dataId).values,g=c.shape[c.shape.length-1],x=a?(b,C)=>b+g-C-1:(b,C)=>b+C;for(let b=0;b<p.length;b+=g)for(let C=0;C<g;C++){const S=x(b,C);if(C===0)h[S]=i?1:p[S];else{const k=x(b,C-1);h[S]=i?p[k]*h[k]:p[S]*h[k]}}const y=t.makeTensorInfo(c.shape,d,h);if(l!=null){const b=gu(l),C=ps({inputs:{x:y},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(c),C}return y}const Tme={kernelName:Y5,backendName:"cpu",kernelFunc:Eme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rme(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,exclusive:i,reverse:a}=r;ht(o,"cumsum");const l=sr([s],o.shape.length);let c=o;l!=null&&(c=ps({inputs:{x:o},backend:t,attrs:{perm:l}}));const u=vr(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Ls(c.dtype,"int32"),h=To(De(c.shape),d),p=t.data.get(c.dataId).values,g=c.shape[c.shape.length-1],x=a?(b,C)=>b+g-C-1:(b,C)=>b+C;for(let b=0;b<p.length;b+=g)for(let C=0;C<g;C++){const S=x(b,C);if(C===0)h[S]=i?0:p[S];else{const k=x(b,C-1);h[S]=i?p[k]+h[k]:p[S]+h[k]}}const y=t.makeTensorInfo(c.shape,d,h);if(l!=null){const b=gu(l),C=ps({inputs:{x:y},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(c),C}return y}const Dme={kernelName:a2,backendName:"cpu",kernelFunc:Rme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ame(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,weights:s}=e,{size:i,binaryOutput:a}=r;if(o.shape.length===1){const l=t.data.get(o.dataId).values,c=t.data.get(s.dataId).values,u=Qk(l,c,s.dtype,s.shape,i);return t.makeTensorInfo([i],s.dtype,u)}else if(o.shape.length===2){const l=t.bufferSync(o),c=t.bufferSync(s),u=cO(l,c,i,a);return t.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const _me={kernelName:Q5,backendName:"cpu",kernelFunc:Ame};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $me(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{blockSize:s,dataFormat:i}=r;K(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=o.shape[0],l=o.shape[1],c=o.shape[2],u=o.shape[3],d=l*s,h=c*s,p=u/(s*s),g=t.data.get(o.dataId).values,x=new Float32Array(a*d*h*p);let y=0;for(let b=0;b<a;++b)for(let C=0;C<d;++C){const S=Math.floor(C/s),k=C%s;for(let N=0;N<h;++N){const E=Math.floor(N/s),_=N%s,$=(k*s+_)*p;for(let T=0;T<p;++T){const A=T+$+u*(E+c*(S+l*b));x[y++]=g[A]}}}return t.makeTensorInfo([a,d,h,p],o.dtype,x)}const Fme={kernelName:J5,backendName:"cpu",kernelFunc:$me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cL(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:c}=r;ht([o,s],"depthwiseConv2DNative");const u=Nt(o.shape),d=Nt(s.shape);let h=l;h==null&&(h=[1,1]),K(Do(i,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const p=po(o.shape,s.shape,i,h,a,c,!0),{filterHeight:g,filterWidth:x,dilationHeight:y,dilationWidth:b,padInfo:C}=p,S=C.left,k=C.top,N=p.outChannels/p.inChannels,E=new ho(p.outShape,o.dtype),_=t.data.get(o.dataId).values,$=t.data.get(s.dataId).values,T=E.values;for(let D=0;D<p.batchSize;++D){const A=D*u[0],M=D*E.strides[0];for(let j=0;j<p.outHeight;++j){const L=M+j*E.strides[1],U=j*p.strideHeight-k;for(let G=0;G<g;++G){const H=U+G*y;if(H<0||H>=p.inHeight)continue;const O=G*d[0],V=A+H*u[1];for(let W=0;W<p.outWidth;++W){const B=L+W*E.strides[2],q=W*p.strideWidth-S;for(let Q=0;Q<x;++Q){const Z=q+Q*b;if(Z<0||Z>=p.inWidth)continue;const ne=O+Q*d[1],ge=V+Z*p.inChannels;let he=B,Se=ne;for(let Re=0;Re<p.inChannels;++Re){const We=_[ge+Re];for(let Be=0;Be<N;++Be)T[he+Be]+=We*$[Se+Be];he+=N,Se+=N}}}}}}return t.makeTensorInfo(E.shape,E.dtype,E.values)}const Pme={kernelName:l2,backendName:"cpu",kernelFunc:cL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mme(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,dy:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;ht([o,s],"depthwiseConv2dNativeBackpropFilter");const d=po(o.shape,u,i,a,l,c,!0),{strideHeight:h,strideWidth:p,filterHeight:g,filterWidth:x}=d,y=new ho(d.filterShape,"float32"),b=d.padInfo.left,C=d.padInfo.top,S=d.outChannels/d.inChannels,k=t.data.get(o.dataId).values,N=new ho(o.shape,o.dtype,k),E=t.data.get(s.dataId).values,_=new ho(s.shape,s.dtype,E);for(let $=0;$<g;++$){const T=Math.max(0,Math.ceil((C-$)/h)),D=Math.min(d.outHeight,(d.inHeight+C-$)/h);for(let A=0;A<x;++A){const M=Math.max(0,Math.ceil((b-A)/p)),j=Math.min(d.outWidth,(d.inWidth+b-A)/p);for(let L=0;L<d.outChannels;++L){const U=Math.trunc(L/S),G=L%S;let H=0;for(let O=0;O<d.batchSize;++O)for(let V=T;V<D;++V){const W=$+V*h-C;for(let B=M;B<j;++B){const q=A+B*p-b;H+=N.get(O,W,q,U)*_.get(O,V,B,L)}}y.set(H,$,A,U,G)}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const Ome={kernelName:e6,backendName:"cpu",kernelFunc:Mme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lme(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;ht([o,s],"depthwiseConv2DNativeBackpropInput");const d=Nt(o.shape),h=Nt(s.shape),p=po(u,s.shape,i,a,l,c,!0),g=new ho(p.inShape,"float32"),x=g.values,[y,b,C]=g.strides,S=t.data.get(o.dataId).values,[k,N,E]=d,_=t.data.get(s.dataId).values,[$,T,D]=h,{batchSize:A,filterHeight:M,filterWidth:j,inChannels:L,inHeight:U,inWidth:G,outChannels:H,outHeight:O,outWidth:V,strideHeight:W,strideWidth:B}=p,q=M-1-p.padInfo.top,Q=j-1-p.padInfo.left,Z=H/L;for(let ne=0;ne<A;++ne)for(let ge=0;ge<L;++ge)for(let he=0;he<U;++he){const Se=he-q,Re=Math.max(0,Math.ceil(Se/W)),We=Math.min(O,(M+Se)/W);for(let Be=0;Be<G;++Be){const Xe=Be-Q,Ye=Math.max(0,Math.ceil(Xe/B)),ot=Math.min(V,(j+Xe)/B);let Qe=0;for(let ct=Re;ct<We;++ct){const ie=ct*W-Se;for(let $t=Ye;$t<ot;++$t){const Ot=$t*B-Xe,qt=k*ne+N*ct+E*$t,en=$*(M-1-ie)+T*(j-1-Ot)+D*ge;for(let hn=0;hn<Z;++hn){const cn=ge*Z+hn,tn=S[qt+cn],Ht=_[en+hn];Qe+=tn*Ht}}}x[y*ne+b*he+C*Be+ge]=Qe}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const Bme={kernelName:t6,backendName:"cpu",kernelFunc:Lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jme(n){const{inputs:e,backend:t}=n,{x:r}=e,o=De(r.shape),s=t.data.get(r.dataId).values,i=Zt([o,o],r.dtype),a=i.values;for(let c=0;c<s.length;c++)a[c*o+c]=s[c];const l=[...r.shape,...r.shape];return t.makeTensorInfo(l,i.dtype,i.values)}const Vme={kernelName:F_,backendName:"cpu",kernelFunc:jme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zme={kernelName:c2,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:o}=n,{strides:s,pad:i,dilations:a}=t,l=e,c=l.data.get(r.dataId).values,u=r.shape.length,d=l.data.get(o.dataId).values,h=o.shape.length,{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:C,padInfo:S,strideHeight:k,strideWidth:N,filterHeight:E,filterWidth:_,dilationHeight:$,dilationWidth:T,outShape:D}=O1(r.shape,o.shape,s,i,"NHWC",a),A=De(D),M=D.length,j=mr(r.dtype,A);for(let U=0;U<p;++U)for(let G=0;G<b;++G){const H=G*k-S.top;for(let O=0;O<C;++O){const V=O*N-S.left;for(let W=0;W<y;++W){let B=Number.MIN_SAFE_INTEGER;for(let Q=0;Q<E;++Q){const Z=H+Q*$;if(Z>=0&&Z<g)for(let ne=0;ne<_;++ne){const ge=V+ne*T;if(ge>=0&&ge<x){const he=nl([U,Z,ge,W],u,Nt(r.shape)),Se=nl([Q,ne,W],h,Nt(o.shape)),Re=c[he]+d[Se];Re>B&&(B=Re)}}}const q=nl([U,G,O,W],M,Nt(D));j[q]=B}}}return{dataId:l.write(Od(j,r.dtype),D,r.dtype),shape:D,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wme={kernelName:EC,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:o,dy:s}=n,{strides:i,pad:a,dilations:l}=t,c=e,u=la(r.shape,c.data.get(r.dataId).values),d=la(o.shape,c.data.get(o.dataId).values),{batchSize:h,inHeight:p,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:C,strideHeight:S,strideWidth:k,filterHeight:N,filterWidth:E,dilationHeight:_,dilationWidth:$,outShape:T}=O1(r.shape,o.shape,i,a,"NHWC",l);K(s.rank===T.length,()=>`Error in ${EC}, dy must have the same rank as output ${T.length}, but got ${s.rank}`);const D=la(T,c.data.get(s.dataId).values),A=D_(o.shape,o.dtype);for(let j=0;j<h;++j)for(let L=0;L<y;++L){const U=L*S-C.top;for(let G=0;G<b;++G){const H=G*k-C.left;for(let O=0;O<x;++O){let V=Number.MIN_SAFE_INTEGER,W=0,B=0;for(let q=0;q<N;++q){const Q=U+q*_;if(Q>=0&&Q<p)for(let Z=0;Z<E;++Z){const ne=H+Z*$;if(ne>=0&&ne<g){const ge=u[j][Q][ne][O]+d[q][Z][O];ge>V&&(V=ge,W=q,B=Z)}}}A[W][B][O]+=D[j][L][G][O]}}}return{dataId:c.write(Od(A,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ume={kernelName:IC,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:o,dy:s}=n,{strides:i,pad:a,dilations:l}=t,c=e,u=la(r.shape,c.data.get(r.dataId).values),d=la(o.shape,c.data.get(o.dataId).values),{batchSize:h,inHeight:p,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:C,strideHeight:S,strideWidth:k,filterHeight:N,filterWidth:E,dilationHeight:_,dilationWidth:$,outShape:T}=O1(r.shape,o.shape,i,a,"NHWC",l);K(s.rank===T.length,()=>`Error in ${IC}, dy must have the same rank as output ${T.length}, but got ${s.rank}`);const D=la(T,c.data.get(s.dataId).values),A=D_(r.shape,r.dtype);for(let j=0;j<h;++j)for(let L=0;L<y;++L){const U=L*S-C.top;for(let G=0;G<b;++G){const H=G*k-C.left;for(let O=0;O<x;++O){let V=Number.MIN_SAFE_INTEGER,W=U<0?0:U,B=H<0?0:H;for(let q=0;q<N;++q){const Q=U+q*_;if(Q>=0&&Q<p)for(let Z=0;Z<E;++Z){const ne=H+Z*$;if(ne>=0&&ne<g){const ge=u[j][Q][ne][O]+d[q][Z][O];ge>V&&(V=ge,W=Q,B=ne)}}}A[j][W][B][O]+=D[j][L][G][O]}}}return{dataId:c.write(Od(A,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hme(n){const{inputs:e,backend:t,attrs:r}=n,{image:o}=e,{canvas:s,options:i}=r,{contextOptions:a,imageOptions:l}=i||{},c=l?.alpha||1,u=a?.contextType||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=s.getContext(u,a?.contextAttributes||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[h,p]=o.shape.slice(0,2),g=o.shape.length===2?1:o.shape[2],x=t.data.get(o.dataId).values,y=o.dtype==="float32"?255:1,b=new Uint8ClampedArray(p*h*4);for(let S=0;S<h*p;++S){const k=[0,0,0,255*c];for(let E=0;E<g;E++){const _=x[S*g+E];if(o.dtype==="float32"){if(_<0||_>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${_}.`)}else if(o.dtype==="int32"&&(_<0||_>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${_}.`);g===1?(k[0]=_*y,k[1]=_*y,k[2]=_*y):k[E]=_*y}const N=S*4;b[N+0]=Math.round(k[0]),b[N+1]=Math.round(k[1]),b[N+2]=Math.round(k[2]),b[N+3]=Math.round(k[3])}s.width=p,s.height=h;const C=new ImageData(b,p,h);return d.putImageData(C,0,0),o}const Gme={kernelName:Cne,backendName:"cpu",kernelFunc:Hme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J1(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r;ht(o,"sum");let a;o.dtype==="bool"?a=cu({inputs:{x:o},backend:t,attrs:{dtype:"int32"}}):a=pl({inputs:{x:o},backend:t});const l=a.shape.length,c=Qt(s,a.shape),u=sr(c,l);let d=c,h=a;u!=null&&(h=ps({inputs:{x:a},backend:t,attrs:{perm:u}}),d=vr(d.length,l)),mo("sum",d,h.shape.length);const[p,g]=to(h.shape,d),x=Ls(h.dtype,"int32");let y=iv(t,p,x);const b=De(g),C=t.data.get(y.dataId).values,S=t.data.get(h.dataId).values;for(let k=0;k<C.length;++k){const N=k*b;let E=0;for(let _=0;_<b;++_)E+=S[N+_];C[k]=E}if(i){const k=Ir(y.shape,c),N=y;y=Vn({inputs:{x:y},backend:t,attrs:{shape:k}}),t.disposeIntermediateTensorInfo(N)}return t.disposeIntermediateTensorInfo(a),u!=null&&t.disposeIntermediateTensorInfo(h),y}const qme={kernelName:z2,backendName:"cpu",kernelFunc:J1};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kme(n){const{inputs:e,backend:t,attrs:r}=n,{equation:o}=r,s=e,{allDims:i,summedDims:a,idDims:l}=Ck(o,s.length);Sk(i.length,l,s);const{path:c,steps:u}=Nk(a,l),d=u.length;let h=null,p=i.length;const g=[];for(let x=0;x<d;++x){for(const y of u[x]){const{permutationIndices:b,expandDims:C}=kk(p,l[y]);let S;Ik(b)?S=s[y]:(S=ps({inputs:{x:s[y]},backend:t,attrs:{perm:b}}),g.push(S));const k=S.shape.slice();for(let N=0;N<C.length;++N)k.splice(C[N],0,1);In(S.shape,k)||(S=Vn({inputs:{x:S},backend:t,attrs:{shape:k}}),g.push(S)),h===null?h=S:(h=yy({inputs:{a:S,b:h},backend:t}),g.push(h))}x<d-1&&(c[x]>=0&&(h=J1({inputs:{x:h},backend:t,attrs:{axis:c[x]-(i.length-p),keepDims:!1}}),g.push(h)),p--)}for(const x of g)x!==h&&t.disposeIntermediateTensorInfo(x);return h}const Xme={kernelName:n6,backendName:"cpu",kernelFunc:Kme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yme(n){const{inputs:e,backend:t}=n,{dy:r,y:o}=e;ht([r,o],"eluGrad");const s=new Float32Array(De(o.shape)),i=t.data.get(o.dataId).values,a=t.data.get(r.dataId).values;for(let l=0;l<i.length;++l){const c=i[l];c>=0?s[l]=a[l]:s[l]=a[l]*(c+1)}return t.makeTensorInfo(o.shape,"float32",s)}const Zme={kernelName:r6,backendName:"cpu",kernelFunc:Yme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qme=mk,Jme=gk,e1e=xk,t1e=vk,n1e=yk,r1e=bk,o1e=_n(n1,n=>{const e=Math.sign(n),t=Math.abs(n),r=1/(1+Qme*t);return e*(1-((((r1e*r+n1e)*r+t1e)*r+e1e)*r+Jme)*r*Math.exp(-t*t))}),s1e={kernelName:n1,backendName:"cpu",kernelFunc:o1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uv(n){const{inputs:e,backend:t,attrs:r}=n,{input:o}=e,{dim:s}=r,i=o.shape.length,a=o.shape.slice();let l=s;return s<0&&(K(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+s+1),a.splice(l,0,1),Vn({inputs:{x:o},backend:t,attrs:{shape:a}})}const i1e={kernelName:d2,backendName:"cpu",kernelFunc:uv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a1e=br((n,e)=>n/e),o8=jr(e1,a1e),JC={kernelName:e1,backendName:"cpu",kernelFunc:o8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uL(n,e,t){const r=n.shape,o=r[0],s=r[1],i=t.data.get(n.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,c=[o,s],u=De(c),d=Eo("float32",u),h=Eo("float32",u);for(let y=0;y<o;y++){const b=Td({inputs:{x:a},backend:t,attrs:{begin:[y,0],size:[1,s]}}),C=Td({inputs:{x:l},backend:t,attrs:{begin:[y,0],size:[1,s]}}),S=$s({inputs:{real:b,imag:C},backend:t}),{real:k,imag:N}=l1e(S,e,t),E=Ql(k,N);for(let _=0;_<s;_++){const $=wk(E,_);d[y*s+_]=$.real,h[y*s+_]=$.imag}t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(S)}const p=t.makeTensorInfo(c,"float32",d),g=t.makeTensorInfo(c,"float32",h),x=$s({inputs:{real:p,imag:g},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}function l1e(n,e,t){const r=De(n.shape),o=t.data.get(n.dataId),s=t.data.get(o.complexTensorInfos.real.dataId).values,i=t.data.get(o.complexTensorInfos.imag.dataId).values;if(c1e(r)){const a=e4(s,i,r,e,t),l=[n.shape[0],n.shape[1]];if(e){const c=t.makeTensorInfo(l,"float32",a.real),u=t.makeTensorInfo(l,"float32",a.imag),d=t.makeTensorInfo([],"float32",pu(r,"float32")),h=pl({inputs:{x:d},backend:t}),p=JC.kernelFunc({inputs:{a:c,b:d},backend:t}),g=JC.kernelFunc({inputs:{a:u,b:h},backend:t}),x=t.data.get(p.dataId).values,y=t.data.get(g.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),{real:x,imag:y}}return a}else{const a=Ql(s,i),l=u1e(a,r,e);return kF(l)}}function c1e(n){return(n&n-1)===0}function e4(n,e,t,r,o){if(t===1)return{real:n,imag:e};const s=Ql(n,e),i=t/2,a=SF(s),l=a.real,c=a.imag,u=[l.length],d=o.makeTensorInfo(u,"float32",l),h=o.makeTensorInfo(u,"float32",c),p=$s({inputs:{real:d,imag:h},backend:o}),g=NF(s),x=g.real,y=g.imag,b=[x.length],C=o.makeTensorInfo(b,"float32",x),S=o.makeTensorInfo(b,"float32",y),k=$s({inputs:{real:C,imag:S},backend:o}),N=e4(l,c,i,r,o),E=N.real,_=N.imag,$=[E.length],T=o.makeTensorInfo($,"float32",E),D=o.makeTensorInfo($,"float32",_),A=$s({inputs:{real:T,imag:D},backend:o}),M=e4(x,y,i,r,o),j=M.real,L=M.imag,U=[j.length],G=o.makeTensorInfo(U,"float32",j),H=o.makeTensorInfo(U,"float32",L),O=$s({inputs:{real:G,imag:H},backend:o}),V=EF(t,r),W=[V.real.length],B=o.makeTensorInfo(W,"float32",V.real),q=o.makeTensorInfo(W,"float32",V.imag),Q=$s({inputs:{real:B,imag:q},backend:o}),Z=yy({inputs:{a:Q,b:O},backend:o}),ne=yf({inputs:{a:A,b:Z},backend:o}),ge=n8({inputs:{a:A,b:Z},backend:o}),he=Ed({inputs:{input:ne},backend:o}),Se=Ed({inputs:{input:ge},backend:o}),Re=bf({inputs:{input:ne},backend:o}),We=bf({inputs:{input:ge},backend:o}),Be=wf({inputs:[he,Se],backend:o,attrs:{axis:0}}),Xe=wf({inputs:[Re,We],backend:o,attrs:{axis:0}}),Ye=o.data.get(Be.dataId).values,ot=o.data.get(Xe.dataId).values;return o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(S),o.disposeIntermediateTensorInfo(k),o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(D),o.disposeIntermediateTensorInfo(A),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(H),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(q),o.disposeIntermediateTensorInfo(Q),o.disposeIntermediateTensorInfo(Z),o.disposeIntermediateTensorInfo(ne),o.disposeIntermediateTensorInfo(ge),o.disposeIntermediateTensorInfo(he),o.disposeIntermediateTensorInfo(Re),o.disposeIntermediateTensorInfo(Se),o.disposeIntermediateTensorInfo(We),o.disposeIntermediateTensorInfo(Be),o.disposeIntermediateTensorInfo(Xe),{real:Ye,imag:ot}}function u1e(n,e,t){const r=new Float32Array(e*2);for(let o=0;o<e;o++){let s=0,i=0;for(let a=0;a<e;a++){const l=TF(o*a,e,t),c=wk(n,a);s+=c.real*l.real-c.imag*l.imag,i+=c.real*l.imag+c.imag*l.real}t&&(s/=e,i/=e),IF(r,s,i,o)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d1e(n){const{inputs:e,backend:t}=n,{input:r}=e,o=De(r.shape),s=r.shape[r.shape.length-1],i=o/s,a=Vn({inputs:{x:r},backend:t,attrs:{shape:[i,s]}}),l=uL(a,!1,t),c=Vn({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const h1e={kernelName:o6,backendName:"cpu",kernelFunc:d1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s8(n){const{backend:e,attrs:t}=n,{shape:r,value:o,dtype:s}=t,i=s||_f(o),a=mr(i,De(r));return p1e(a,o,i),e.makeTensorInfo(r,i,a)}const f1e={kernelName:s6,backendName:"cpu",kernelFunc:s8};function p1e(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m1e={kernelName:i6,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,o=t,s=Eo(r.dtype,De(r.shape)),[i,a,l,c]=r.shape,u=o.data.get(r.dataId).values;for(let h=0;h<i;h++){const p=h*l*a*c;for(let g=0;g<a;g++){const x=g*(l*c);for(let y=0;y<l;y++){const b=y*c;for(let C=0;C<c;C++){const S=Math.round(l-y-1),k=p+x+b+C;let N=u[k];if(S>=0&&S<l){const E=S*c,_=p+x+E+C;N=u[_]}s[k]=N}}}}return{dataId:o.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:g}=r;let x=lL({inputs:{x:o,filter:s},backend:t,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(i){const y=x;if(u==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const b=Vn({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});x=yf({inputs:{a:x,b},backend:t}),t.disposeIntermediateTensorInfo(b)}else x=yf({inputs:{a:x,b:i},backend:t});t.disposeIntermediateTensorInfo(y)}if(p){const y=x;if(u==="NCHW"&&p==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const b=Vn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});x=lv(t,x,p,b,g),t.disposeIntermediateTensorInfo(b)}else x=lv(t,x,p,a,g);t.disposeIntermediateTensorInfo(y)}return x}const x1e={kernelName:Wx,backendName:"cpu",kernelFunc:g1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:g}=r;let x=cL({inputs:{x:o,filter:s},backend:t,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(i){const y=x;x=yf({inputs:{a:x,b:i},backend:t}),t.disposeIntermediateTensorInfo(y)}if(p){const y=x;x=lv(t,x,p,a,g),t.disposeIntermediateTensorInfo(y)}return x}const y1e={kernelName:J_,backendName:"cpu",kernelFunc:v1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1e(n){const{inputs:e,backend:t}=n,{params:r,indices:o}=e,s=De(r.shape),i=o.shape,a=i[i.length-1],[l,c,u,d]=ok(r,o);if(c===0)return t.makeTensorInfo(l,r.dtype,[]);const h=t.data.get(o.dataId).values,p=t.bufferSync(r),g=bO(h,p,r.dtype,c,a,u,d,r.shape,s);return t.makeTensorInfo(l,r.dtype,g.values)}const w1e={kernelName:P_,backendName:"cpu",kernelFunc:b1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,indices:s}=e,{axis:i,batchDims:a}=r;ht([o,s],"gatherV2");const l=Qt(i,o.shape)[0],c=t.data.get(s.dataId).values,u=o.shape[l];for(let k=0;k<c.length;++k){const N=c[k];K(N<=u-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);const h=De(s.shape),p=Tk(o,s,l,d),g=Vn({inputs:{x:o},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),x=Vn({inputs:{x:s},backend:t,attrs:{shape:[p.batchSize,h/p.batchSize]}}),y=[p.batchSize,p.outerSize,h/p.batchSize,p.sliceSize],b=t.bufferSync(x),C=t.bufferSync(g),S=wO(C,b,y);return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.makeTensorInfo(p.outputShape,S.dtype,S.values)}const k1e={kernelName:f2,backendName:"cpu",kernelFunc:C1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1e(n){const{inputs:e,backend:t}=n,{input:r}=e,o=De(r.shape),s=r.shape[r.shape.length-1],i=o/s,a=Vn({inputs:{x:r},backend:t,attrs:{shape:[i,s]}}),l=uL(a,!0,t),c=Vn({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const N1e={kernelName:a6,backendName:"cpu",kernelFunc:S1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I1e=_n(c1,n=>Number.isFinite(n)?1:0,"bool"),E1e={kernelName:c1,backendName:"cpu",kernelFunc:I1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T1e=_n(u1,n=>Math.abs(n)===1/0?1:0,"bool"),R1e={kernelName:u1,backendName:"cpu",kernelFunc:T1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D1e=_n(d1,n=>Number.isNaN(n)?1:0,"bool"),A1e={kernelName:d1,backendName:"cpu",kernelFunc:D1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _1e(n){const{backend:e,attrs:t}=n,{start:r,stop:o,num:s}=t,i=IO(r,o,s);return e.makeTensorInfo([i.length],"float32",i)}const $1e={kernelName:M_,backendName:"cpu",kernelFunc:_1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F1e=_n(f1,n=>Math.log1p(n)),P1e={kernelName:f1,backendName:"cpu",kernelFunc:F1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M1e=br((n,e)=>n&&e),O1e=jr(v2,M1e,null,"bool"),L1e={kernelName:v2,backendName:"cpu",kernelFunc:O1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B1e=_n(y2,n=>n?0:1,"bool"),j1e={kernelName:y2,backendName:"cpu",kernelFunc:B1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V1e=br((n,e)=>n||e),z1e=jr(b2,V1e,null,"bool"),W1e={kernelName:b2,backendName:"cpu",kernelFunc:z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:l}=r;ht(o,"LRN");const c=o.shape[3],u=c-1,d=t.data.get(o.dataId).values,h=De(o.shape),p=new Float32Array(h);function g(x){const y=x%c;let b=x-y+Math.max(0,y-s);const C=x-y+Math.min(y+s,u);let S=0;for(;b<=C;b++){const k=d[b];S+=k*k}return S}for(let x=0;x<h;x++){const y=g(x),b=d[x]*Math.pow(i+a*y,-l);p[x]=b}return t.makeTensorInfo(o.shape,o.dtype,p)}const H1e={kernelName:w2,backendName:"cpu",kernelFunc:U1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r;ht(i,"LRNGrad");const d=De(i.shape),h=i.shape[3],p=t.data.get(i.dataId).values,g=t.data.get(o.dataId).values,x=t.data.get(s.dataId).values,y=new Float32Array(d),b=d;for(let C=0;C<b;C++){const S=C%h,k=C-S+Math.max(0,S-a),N=C-S+Math.min(h,S+a+1);let E=0;for(let _=k;_<N;_++)E+=Math.pow(g[_],2);E=c*E+l;for(let _=k;_<N;_++){let $=-2*c*u*g[_]*x[C]/E;C===_&&($+=Math.pow(E,-u)),$*=p[C],y[_]+=$}}return t.makeTensorInfo(i.shape,o.dtype,y)}const q1e={kernelName:c6,backendName:"cpu",kernelFunc:G1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{reductionIndices:s,keepDims:i}=r,a=t;let l=o.shape;const c=l.length,u=Qt(s,l);let d=u;const h=sr(d,c);let p=a.data.get(o.dataId).values;if(h!=null){const k=new Array(c);for(let N=0;N<k.length;N++)k[N]=l[h[N]];p=e8(p,l,o.dtype,h,k),d=vr(d.length,c),l=k}ht(o,"max"),mo("max",d,c);const[g,x]=to(l,d),y=De(x),b=TO(p,y,g,o.dtype),C=a.write(b,g,o.dtype);let S=g;return i&&(S=Ir(g,u)),{dataId:C,shape:S,dtype:o.dtype}}const K1e={kernelName:C2,backendName:"cpu",kernelFunc:dL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e;ht(o,"maxPool");const{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=r,c=1;K(Do(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Pi(o.shape,s,i,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&In(u.inShape,u.outShape))d=pl({inputs:{x:o},backend:t});else{const h=t.data.get(o.dataId).values,p=Nt(o.shape),g=r8(h,o.shape,o.dtype,p,u,"max");d=t.makeTensorInfo(u.outShape,o.dtype,g.values)}return d}const Y1e={kernelName:k2,backendName:"cpu",kernelFunc:X1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=r;ht(o,"maxPool3d");const u=ac(o.shape,s,i,1,a,l,c),d=t.data.get(o.dataId).values,h=aL(d,o.shape,o.dtype,Nt(o.shape),u,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}const Q1e={kernelName:S2,backendName:"cpu",kernelFunc:Z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J1e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,input:s}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:c}=r;ht([o,s],"maxPool3DGrad");const u=ac(s.shape,i,a,1,l,c),d=t.bufferSync(s),h=Vpe(d,u),p=u.strideDepth,g=u.strideHeight,x=u.strideWidth,y=u.dilationDepth,b=u.dilationHeight,C=u.dilationWidth,S=u.effectiveFilterDepth,k=u.effectiveFilterHeight,N=u.effectiveFilterWidth,E=S-1-u.padInfo.front,_=N-1-u.padInfo.left,$=k-1-u.padInfo.top,T=Zt(s.shape,"float32"),D=t.bufferSync(o);for(let A=0;A<u.batchSize;++A)for(let M=0;M<u.inChannels;++M)for(let j=0;j<u.inDepth;++j)for(let L=0;L<u.inHeight;++L)for(let U=0;U<u.inWidth;++U){const G=j-E,H=L-$,O=U-_;let V=0;for(let W=0;W<S;W+=y){const B=(G+W)/p;if(!(B<0||B>=u.outDepth||Math.floor(B)!==B))for(let q=0;q<k;q+=b){const Q=(H+q)/g;if(!(Q<0||Q>=u.outHeight||Math.floor(Q)!==Q))for(let Z=0;Z<N;Z+=C){const ne=(O+Z)/x;if(ne<0||ne>=u.outWidth||Math.floor(ne)!==ne)continue;const ge=S*k*N-1-h.get(A,B,Q,ne,M),he=W*k*N+q*N+Z,Se=ge===he?1:0;if(Se===0)continue;const Re=D.get(A,B,Q,ne,M);V+=Re*Se}}}T.set(V,A,j,L,U,M)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const ege={kernelName:d6,backendName:"cpu",kernelFunc:J1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tge(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,input:s,output:i}=e,a=s;ht([s,i],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,h=Pi(a.shape,l,c,1,u,d),p=t.data.get(a.dataId).values,g=Zt(h.outShape,a.dtype,iL(p,a.shape,a.dtype,h).values),x=h.strideHeight,y=h.strideWidth,b=h.dilationHeight,C=h.dilationWidth,S=h.effectiveFilterHeight,k=h.effectiveFilterWidth,N=k-1-h.padInfo.left,E=S-1-h.padInfo.top,_=Zt(a.shape,"float32"),$=t.data.get(o.dataId).values,T=Zt(o.shape,"float32",$);for(let D=0;D<h.batchSize;++D)for(let A=0;A<h.inChannels;++A)for(let M=0;M<h.inHeight;++M)for(let j=0;j<h.inWidth;++j){const L=M-E,U=j-N;let G=0;for(let H=0;H<S;H+=b){const O=(L+H)/x;if(!(O<0||O>=h.outHeight||Math.floor(O)!==O))for(let V=0;V<k;V+=C){const W=(U+V)/y;if(W<0||W>=h.outWidth||Math.floor(W)!==W)continue;const B=S*k-1-g.get(D,O,W,A),q=H*k+V,Q=B===q?1:0;if(Q===0)continue;const Z=T.get(D,O,W,A);G+=Z*Q}}_.set(G,D,M,j,A)}return t.makeTensorInfo(_.shape,_.dtype,_.values)}const nge={kernelName:u6,backendName:"cpu",kernelFunc:tge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rge(n,e,t,r,o){const s=Nt(e),i=r8(n,e,t,s,o,"max"),a=iL(n,e,t,o,!0,r);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oge={kernelName:O_,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=e,l=t;ht(r,"MaxPoolWithArgmax");const c=l.data.get(r.dataId).values,u=Pi(r.shape,o,s,[1,1],i),[d,h]=rge(c,r.shape,r.dtype,a,u),p=l.write(d,u.outShape,r.dtype),g=l.write(h,u.outShape,r.dtype);return[{dataId:p,shape:u.outShape,dtype:r.dtype},{dataId:g,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sge(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r,a=Qt(s,o.shape),c=to(o.shape,a)[1],u=De(c),d=[],h=t.makeTensorInfo([],"float32",new Float32Array([u]));d.push(h);const p=cu({inputs:{x:o},backend:t,attrs:{dtype:"float32"}});d.push(p);const g=o8({inputs:{a:p,b:h},backend:t});d.push(g);const x=J1({inputs:{x:g},backend:t,attrs:{axis:s,keepDims:i}});return d.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const ige={kernelName:N2,backendName:"cpu",kernelFunc:sge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function age(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r;ht(o,"min");const a=Qt(s,o.shape);let l=a;const c=sr(l,o.shape.length);let u=o;c!=null&&(u=ps({inputs:{x:o},backend:t,attrs:{perm:c}}),l=vr(l.length,o.shape.length)),mo("min",l,u.shape.length);const[d,h]=to(u.shape,l),p=De(h),g=To(De(d),u.dtype),x=t.data.get(u.dataId).values;for(let b=0;b<g.length;++b){const C=b*p;let S=x[C];for(let k=0;k<p;++k){const N=x[C+k];(Number.isNaN(N)||N<S)&&(S=N)}g[b]=S}c!=null&&t.disposeIntermediateTensorInfo(u);const y=t.makeTensorInfo(d,u.dtype,g);if(i){const b=Ir(d,a),C=Vn({inputs:{x:y},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(y),C}return y}const lge={kernelName:I2,backendName:"cpu",kernelFunc:age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cge(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{paddings:s,mode:i}=r;ht(o,"mirrorPad");const a=s.map((S,k)=>S[0]+o.shape[k]+S[1]),l=s.map(S=>S[0]),c=s.map((S,k)=>S[0]+o.shape[k]),u=i==="reflect"?0:1,d=t.data.get(o.dataId).values,h=o.shape.length,p=Nt(o.shape),g=De(a),x=a.length,y=Nt(a),b=Eo(o.dtype,g);for(let S=0;S<g;S++){let k=$f(S,x,y);for(let E=0;E<x;E++)k[E]<l[E]?k[E]=l[E]*2-k[E]-u:k[E]>=c[E]&&(k[E]=(c[E]-1)*2-k[E]+u);k=k.map((E,_)=>E-l[_]);const N=nl(k,h,p);b[S]=d[N]}return{dataId:t.write(b,a,o.dtype),shape:a,dtype:o.dtype}}const uge={kernelName:E2,backendName:"cpu",kernelFunc:cge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dge=br(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),hge=jr(g1,dge),fge={kernelName:g1,backendName:"cpu",kernelFunc:hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hL(n){const{inputs:e,backend:t,attrs:r}=n,{logits:o}=e,{dim:s}=r,i=o.shape.length;let a=s;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=Qt([a],o.shape),c=dL({inputs:{x:o},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),u=Ir(c.shape,l),d=Vn({inputs:{x:c},backend:t,attrs:{shape:u}}),h=n8({inputs:{a:o,b:d},backend:t}),p=gO({inputs:{x:h},backend:t}),g=J1({inputs:{x:p},backend:t,attrs:{axis:l,keepDims:!1}}),x=Vn({inputs:{x:g},backend:t,attrs:{shape:u}}),y=o8({inputs:{a:p,b:x},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}const pge={kernelName:H2,backendName:"cpu",kernelFunc:hL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mge(n){const{inputs:e,backend:t,attrs:r}=n,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=r;ht(o,"multinomial");const l=a?o:hL({inputs:{logits:o},backend:t,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=t.data.get(l.dataId).values,h=[c,s],p=To(De(h),"int32");for(let g=0;g<c;++g){const x=g*u,y=new Float32Array(u-1);y[0]=d[x];for(let S=1;S<y.length;++S)y[S]=y[S-1]+d[x+S];const b=U6.alea(i.toString()),C=g*s;for(let S=0;S<s;++S){const k=b();p[C+S]=y.length;for(let N=0;N<y.length;N++)if(k<y[N]){p[C+S]=N;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(h,"int32",p)}const gge={kernelName:L_,backendName:"cpu",kernelFunc:mge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xge=J6;function vge(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=r;ht(o,"NonMaxSuppression");const c=t.data.get(o.dataId).values,u=t.data.get(s.dataId).values,{selectedIndices:d}=xge(c,u,i,a,l);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const yge={kernelName:h6,backendName:"cpu",kernelFunc:vge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bge=ek;function wge(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;ht(o,"NonMaxSuppressionPadded");const u=t.data.get(o.dataId).values,d=t.data.get(s.dataId).values,{selectedIndices:h,validOutputs:p}=bge(u,d,i,a,l,c);return[t.makeTensorInfo([h.length],"int32",new Int32Array(h)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const Cge={kernelName:f6,backendName:"cpu",kernelFunc:wge};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kge=tk;function Sge(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;ht(o,"NonMaxSuppressionWithScore");const u=t.data.get(o.dataId).values,d=t.data.get(s.dataId).values,h=i,p=a,g=l,x=c,{selectedIndices:y,selectedScores:b}=kge(u,d,h,p,g,x);return[t.makeTensorInfo([y.length],"int32",new Int32Array(y)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const Nge={kernelName:p6,backendName:"cpu",kernelFunc:Sge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ige(n){const{inputs:e,backend:t,attrs:r}=n,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:l}=r;ht(o,"oneHot");const c=De(o.shape),u=new Float32Array(c*i);u.fill(l);const d=t.data.get(o.dataId).values;for(let h=0;h<c;++h)d[h]>=0&&d[h]<i&&(u[h*i+d[h]]=a);return t.makeTensorInfo([...o.shape,i],s,u)}const Ege={kernelName:A2,backendName:"cpu",kernelFunc:Ige};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dv(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const o=Ed({inputs:{input:r},backend:t}),s=dv({inputs:{x:o},backend:t}),i=bf({inputs:{input:r},backend:t}),a=dv({inputs:{x:i},backend:t}),l=$s({inputs:{real:s,imag:a},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return s8({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const Tge={kernelName:K2,backendName:"cpu",kernelFunc:dv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const o=Ed({inputs:{input:r},backend:t}),s=fL({inputs:{x:o},backend:t}),i=bf({inputs:{input:r},backend:t}),a=dv({inputs:{x:i},backend:t}),l=$s({inputs:{real:s,imag:a},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return s8({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const Rge={kernelName:D2,backendName:"cpu",kernelFunc:fL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pL(n){const{inputs:e,backend:t,attrs:r}=n,{axis:o}=r;if(e.length===1)return uv({inputs:{input:e[0]},backend:t,attrs:{dim:o}});const s=e[0].shape,i=e[0].dtype;e.forEach(u=>{P5(s,u.shape,"All tensors passed to stack must have matching shapes"),K(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=uv({inputs:{input:u},backend:t,attrs:{dim:o}});return a.push(d),d}),c=wf({inputs:l,backend:t,attrs:{axis:o}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),c}const Dge={kernelName:_2,backendName:"cpu",kernelFunc:pL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Age(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{paddings:s,constantValue:i}=r;ht(o,"pad");const a=s.map((C,S)=>C[0]+o.shape[S]+C[1]),l=s.map(C=>C[0]),c=t.data.get(o.dataId).values,u=De(o.shape),d=o.shape.length,h=Nt(o.shape),p=De(a),g=a.length,x=Nt(a),y=Eo(o.dtype,p);i!==0&&y.fill(i);for(let C=0;C<u;C++){const k=$f(C,d,h).map((E,_)=>E+l[_]),N=nl(k,g,x);y[N]=c[C]}return{dataId:t.write(y,a,o.dtype),shape:a,dtype:o.dtype}}const mL={kernelName:$2,backendName:"cpu",kernelFunc:Age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ge=br((n,e)=>Math.pow(n,e)),$ge=jr(v1,_ge),Fge={kernelName:v1,backendName:"cpu",kernelFunc:$ge};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pge(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=e,{outputRaggedRank:a}=r,l=o.map(b=>t.data.get(b.dataId).values),c=o.map(b=>b.shape),u=t.data.get(s.dataId).values,d=t.data.get(i.dataId).values,[h,p,g]=FO(l,c,u,s.shape,s.dtype,d,i.shape),x=h.map(b=>t.makeTensorInfo([b.length],"int32",b)),y=t.makeTensorInfo(g,s.dtype,p);return x.concat([y])}const Mge={kernelName:B_,backendName:"cpu",kernelFunc:Pge};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oge(n){const{inputs:e,backend:t}=n,{starts:r,limits:o,deltas:s}=e,i=t.data.get(r.dataId).values,a=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values,[c,u]=PO(i,r.shape,r.dtype,a,o.shape,l,s.shape),d=t.makeTensorInfo([c.length],"int32",c),h=t.makeTensorInfo([u.length],r.dtype,u);return[d,h]}const Lge={kernelName:j_,backendName:"cpu",kernelFunc:Oge};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bge(n){const{inputs:e,backend:t,attrs:r}=n,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=t.data.get(o.dataId).values,u=t.data.get(s.dataId).values,d=t.data.get(i.dataId).values,h=a.map(y=>t.data.get(y.dataId).values),p=a.map(y=>y.shape),[g,x]=MO(c,o.shape,u,s.shape,s.dtype,d,i.shape,h,p,l);return t.makeTensorInfo(g,s.dtype,x)}const jge={kernelName:V_,backendName:"cpu",kernelFunc:Bge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vge(n){const{backend:e,attrs:t}=n,{start:r,stop:o,dtype:s,step:i}=t,a=OO(r,o,i,s);return e.makeTensorInfo([a.length],s,a)}const zge={kernelName:m6,backendName:"cpu",kernelFunc:Vge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wge=_n(y1,n=>1/n),Uge={kernelName:y1,backendName:"cpu",kernelFunc:Wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hge(n){const{inputs:e,backend:t,attrs:r}=n,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=r;ht(o,"resizeBilinear");const l=Nt(o.shape),[c,u]=a,[d,h,p,g]=o.shape,x=t.data.get(o.dataId).values,y=new Float32Array(De([d,c,u,g])),b=[s&&c>1?h-1:h,s&&u>1?p-1:p],C=[s&&c>1?c-1:c,s&&u>1?u-1:u];let S=0;const k=b[0]/C[0],N=b[1]/C[1];for(let E=0;E<d;E++)for(let _=0;_<c;_++){let $;i?$=k*(_+.5)-.5:$=k*_;const T=Math.max(0,Math.floor($)),D=$-T,A=Math.min(h-1,Math.ceil($)),M=E*l[0]+T*l[1],j=E*l[0]+A*l[1];for(let L=0;L<u;L++){let U;i?U=N*(L+.5)-.5:U=N*L;const G=Math.max(0,Math.floor(U)),H=U-G,O=Math.min(p-1,Math.ceil(U)),V=M+G*l[2],W=j+G*l[2],B=M+O*l[2],q=j+O*l[2];for(let Q=0;Q<g;Q++){const Z=x[V+Q],ne=x[W+Q],ge=x[B+Q],he=x[q+Q],Se=Z+(ge-Z)*H,Re=ne+(he-ne)*H,We=Se+(Re-Se)*D;y[S++]=We}}}return t.makeTensorInfo([d,c,u,g],"float32",y)}const Gge={kernelName:L2,backendName:"cpu",kernelFunc:Hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qge(n){const{inputs:e,backend:t,attrs:r}=n,{images:o,dy:s}=e,{alignCorners:i}=r;ht([s,o],"resizeBilinearGrad");const a=Nt(o.shape),[l,c,u,d]=o.shape,[,h,p]=s.shape,g=new Float32Array(l*c*u*d),x=[i&&h>1?c-1:c,i&&p>1?u-1:u],y=[i&&h>1?h-1:h,i&&p>1?p-1:p],b=x[0]/y[0],C=x[1]/y[1],S=t.data.get(s.dataId).values;let k=0;for(let N=0;N<l;N++){const E=N*a[0];for(let _=0;_<h;_++){const $=_*b,T=Math.floor($),D=Math.min(Math.ceil($),c-1),A=E+T*a[1],M=E+D*a[1],j=$-T,L=1-j;for(let U=0;U<p;U++){const G=U*C,H=Math.floor(G),O=Math.min(Math.ceil(G),u-1),V=G-H,W=1-V,B=A+H*a[2],q=A+O*a[2],Q=M+H*a[2],Z=M+O*a[2],ne=L*W,ge=L*V,he=j*W,Se=j*V;for(let Re=0;Re<d;Re++){const We=S[k++];g[B+Re]+=We*ne,g[q+Re]+=We*ge,g[Q+Re]+=We*he,g[Z+Re]+=We*Se}}}}return t.makeTensorInfo([l,u,c,d],"float32",g)}const Kge={kernelName:v6,backendName:"cpu",kernelFunc:qge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xge(n){const{inputs:e,backend:t,attrs:r}=n,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=r;ht(o,"resizeNearestNeighbor");const l=Nt(o.shape),[c,u]=a,[d,h,p,g]=o.shape,x=t.data.get(o.dataId).values,y=new Float32Array(d*c*u*g),b=[s&&c>1?h-1:h,s&&u>1?p-1:p],C=[s&&c>1?c-1:c,s&&u>1?u-1:u],S=b[0]/C[0],k=b[1]/C[1];let N=0;for(let E=0;E<d;E++){const _=E*l[0];for(let $=0;$<c;$++){const T=i?S*($+.5):S*$;let D=Math.min(h-1,s?Math.round(T):Math.floor(T));i&&(D=Math.max(0,D));const A=_+D*l[1];for(let M=0;M<u;M++){const j=i?k*(M+.5):k*M;let L=Math.min(p-1,s?Math.round(j):Math.floor(j));i&&(L=Math.max(0,L));const U=A+L*l[2];for(let G=0;G<g;G++){const H=x[U+G];y[N++]=H}}}}return t.makeTensorInfo([d,c,u,g],o.dtype,y)}const Yge={kernelName:O2,backendName:"cpu",kernelFunc:Xge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zge(n){const{inputs:e,backend:t,attrs:r}=n,{images:o,dy:s}=e,{alignCorners:i}=r;ht([s,o],"resizeNearestNeighborGrad");const a=Nt(o.shape),l=Nt(s.shape),[c,u,d,h]=o.shape,[,p,g]=s.shape,x=new Float32Array(c*u*d*h),y=t.data.get(s.dataId).values,b=[i&&p>1?u-1:u,i&&g>1?d-1:d],C=[i&&p>1?p-1:p,i&&g>1?g-1:g],S=b[0]/C[0],k=b[1]/C[1],N=1/S,E=1/k,_=Math.ceil(N)*2+2,$=Math.ceil(E)*2+2;for(let T=0;T<c;T++){const D=T*a[0];for(let A=0;A<u;A++){const M=D+A*a[1],j=Math.floor(A*N),L=Math.floor(j-_/2);for(let U=0;U<d;U++){const G=M+U*a[2],H=Math.floor(U*E),O=Math.floor(H-$/2);for(let V=0;V<h;V++){let W=0;for(let B=0;B<_;B++){const q=B+L;if(q<0||q>=p)continue;const Q=D+q*l[1],Z=q*S,ne=Math.min(u-1,i?Math.round(Z):Math.floor(Z));if(A===ne)for(let ge=0;ge<$;ge++){const he=ge+O;if(he<0||he>=g)continue;const Se=Q+he*l[2],Re=he*k,We=Math.min(d-1,i?Math.round(Re):Math.floor(Re));U===We&&(W+=y[Se+V])}}x[G+V]=W}}}}return t.makeTensorInfo(o.shape,o.dtype,x)}const Qge={kernelName:x6,backendName:"cpu",kernelFunc:Zge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jge(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{dims:s}=r;ht(o,"reverse");const i=o.shape.length,a=Qt(s,o.shape);if(i===0)return pl({inputs:{x:o},backend:t});const l=new ho(o.shape,o.dtype),c=t.bufferSync(o);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),h=d.slice();a.forEach(p=>h[p]=o.shape[p]-1-h[p]),l.set(c.get(...h),...d)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const e0e={kernelName:B2,backendName:"cpu",kernelFunc:Jge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t0e={kernelName:N6,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:o,fillValue:s,center:i}=e,a=t,l=Eo(r.dtype,De(r.shape)),[c,u,d,h]=r.shape,[p,g]=hk(i,u,d),x=255,y=Math.sin(o),b=Math.cos(o),C=a.data.get(r.dataId).values;for(let k=0;k<c;k++){const N=k*d*u*h;for(let E=0;E<u;E++){const _=E*(d*h);for(let $=0;$<d;$++){const T=$*h;for(let D=0;D<h;D++){const A=[c,E,$,D],M=A[2],j=A[1];let L=(M-p)*b-(j-g)*y,U=(M-p)*y+(j-g)*b;L=Math.round(L+p),U=Math.round(U+g);let G=s;if(typeof s!="number"&&(D===3?G=x:G=s[D]),L>=0&&L<d&&U>=0&&U<u){const O=U*(d*h),V=L*h,W=N+O+V+D;G=C[W]}const H=N+_+T+D;l[H]=G}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n0e=_n(C1,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),r0e={kernelName:C1,backendName:"cpu",kernelFunc:n0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(n){const{inputs:e,backend:t,attrs:r}=n,{indices:o,updates:s}=e,{shape:i}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=jd(s,o,i),h=!0,p=t.bufferSync(o),g=t.bufferSync(s),x=id(p,g,i,d,c,l,a,u,0,h);return t.makeTensorInfo(i,x.dtype,x.values)}const s0e={kernelName:z_,backendName:"cpu",kernelFunc:o0e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i0e(n,e){let t=0,r=n.length,o=0;for(;t<r;)o=Math.floor((t+r)/2),n[o]<e?t=o+1:r=o;return r}function a0e(n,e){let t=0,r=n.length,o=0;for(;t<r;)o=Math.floor((t+r)/2),n[o]<=e?t=o+1:r=o;return r}function l0e(n,e,t,r,o,s){const i=mr("int32",t*o);for(let a=0;a<t;++a){const l=n.slice(a*r,(a+1)*r),c=a*o;for(let u=0;u<o;++u)i[c+u]=s==="left"?i0e(l,e[u+c]):a0e(l,e[u+c])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c0e(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:o,values:s}=e,{side:i}=r,a=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values,c=l0e(a,l,o.shape[0],o.shape[1],s.shape[1],i);return t.makeTensorInfo(s.shape,"int32",c)}const u0e={kernelName:U_,backendName:"cpu",kernelFunc:c0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d0e(n){const{inputs:e,backend:t}=n,{condition:r,t:o,e:s}=e;ht([r,o,s],"select");const i=r.shape.length,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,c=t.data.get(s.dataId).values,u=Ls(o.dtype,s.dtype),d=To(De(o.shape),u);let h=0;const p=i===0||i>1||o.shape.length===1?1:De(o.shape.slice(1));for(let g=0;g<a.length;g++)for(let x=0;x<p;x++)a[g]===1?d[h++]=l[g]:d[h++]=c[g];return t.makeTensorInfo(o.shape,u,d)}const h0e={kernelName:j2,backendName:"cpu",kernelFunc:d0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f0e=iy,p0e=ay,m0e=_n(S1,n=>n>=0?p0e*n:f0e*(Math.exp(n)-1)),g0e={kernelName:S1,backendName:"cpu",kernelFunc:m0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x0e=_n(E1,n=>n<0?-1:n>0?1:0),v0e={kernelName:E1,backendName:"cpu",kernelFunc:x0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y0e=_n(N1,n=>Math.sin(n)),b0e={kernelName:N1,backendName:"cpu",kernelFunc:y0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w0e=_n(I1,n=>Math.sinh(n)),C0e={kernelName:I1,backendName:"cpu",kernelFunc:w0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k0e=11920928955078125e-23,s9=Math.log(k0e)+2,S0e=_n(R1,n=>{const e=n>-s9,t=n<s9,r=Math.exp(n);let o;return t?o=r:e?o=n:o=Math.log(1+r),o}),N0e={kernelName:R1,backendName:"cpu",kernelFunc:S0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I0e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{blockShape:s,paddings:i}=r;ht([o],"spaceToBatchND");const a=De(s),l=[[0,0]];l.push(...i);for(let E=1+s.length;E<o.shape.length;++E)l.push([0,0]);const c=mL.kernelFunc({inputs:{x:o},backend:t,attrs:{paddings:l,constantValue:0}}),u=z1(c.shape,s,a,!1),d=W1(u.length,s.length,!1),h=U1(c.shape,s,a,!1),x=Vn({inputs:{x:c},backend:t,attrs:{shape:u}}),C=ps({inputs:{x},backend:t,attrs:{perm:d}}),N=Vn({inputs:{x:C},backend:t,attrs:{shape:h}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(C),N}const E0e={kernelName:W2,backendName:"cpu",kernelFunc:I0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0e(n){const{inputs:e,backend:t}=n,{indices:r,values:o,denseShape:s,defaultValue:i}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,c=t.data.get(s.dataId).values,u=t.data.get(i.dataId).values[0],[d,h,p,g,x]=VO(a,r.shape,r.dtype,l,o.dtype,c,u);return[t.makeTensorInfo(h,r.dtype,d),t.makeTensorInfo([h[0]],o.dtype,p),t.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(y=>Number(y)))),t.makeTensorInfo([x.length],r.dtype,new Int32Array(x))]}const R0e={kernelName:H_,backendName:"cpu",kernelFunc:T0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0e(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:o,newShape:s}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const i=Array.from(t.data.get(o.dataId).values),a=t.data.get(r.dataId).values,l=Array.from(t.data.get(s.dataId).values),[c,u,d]=zO(a,r.shape,r.dtype,i,l);return[t.makeTensorInfo(u,r.dtype,c),t.makeTensorInfo([d.length],s.dtype,new Int32Array(d))]}const A0e={kernelName:G_,backendName:"cpu",kernelFunc:D0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _0e(n){const{inputs:e,backend:t}=n,{data:r,indices:o,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(o.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(r.dataId).values,a=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values,[c,u]=t8(i,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(u,r.dtype,c)}const $0e={kernelName:q_,backendName:"cpu",kernelFunc:_0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F0e(n){const{inputs:e,backend:t}=n,{data:r,indices:o,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(o.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(r.dataId).values,a=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values,[c,u]=t8(i,r.shape,r.dtype,a,l);return t.makeTensorInfo(u,r.dtype,c)}const P0e={kernelName:K_,backendName:"cpu",kernelFunc:F0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0e(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=jd(s,o,a),p=!1,g=t.bufferSync(o);let x;switch(s.dtype){case"bool":{const y=t.bufferSync(s),b=!!t.data.get(i.dataId).values[0];x=id(g,y,a,h,u,c,l,d,b,p);break}case"float32":{const y=t.bufferSync(s),b=t.data.get(i.dataId).values[0];x=id(g,y,a,h,u,c,l,d,b,p);break}case"int32":{const y=t.bufferSync(s),b=t.data.get(i.dataId).values[0];x=id(g,y,a,h,u,c,l,d,b,p);break}case"string":{const y=t.bufferSync(s),b=ou(t.data.get(i.dataId).values[0]);x=id(g,y,a,h,u,c,l,d,b,p);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return t.makeTensorInfo(a,x.dtype,x.values)}const O0e={kernelName:X_,backendName:"cpu",kernelFunc:M0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L0e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{numOrSizeSplits:s,axis:i}=r,a=Qt(i,o.shape)[0],l=Ek(o,s,a),c=new Array(o.shape.length).fill(0),u=o.shape.slice();return l.map(d=>{const h=[...u];h[a]=d;const p=Td({inputs:{x:o},backend:t,attrs:{begin:c,size:h}});return c[a]+=d,p})}const B0e={kernelName:U2,backendName:"cpu",kernelFunc:L0e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j0e={kernelName:y6,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,r=e;ht(t,"square");const o=r.data.get(t.dataId).values,s=new Float32Array(o.length);for(let a=0;a<o.length;++a){const l=o[a];s[a]=l*l}return{dataId:r.write(s,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V0e=_n(M1,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),z0e={kernelName:M1,backendName:"cpu",kernelFunc:V0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W0e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{begin:s,end:i,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=r;ht(o,"stridedSlice");const{finalShapeSparse:p,finalShape:g,isIdentity:x,sliceDim0:y,isSimpleSlice:b,begin:C,end:S,strides:k}=ck(o.shape,s,i,a,l,c,u,d,h);let N;if(x)N=Vn({inputs:{x:o},backend:t,attrs:{shape:g}});else if(y||b){K(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const E=ik(C,S,k),_=Td({inputs:{x:o},backend:t,attrs:{begin:C,size:E}});N=Vn({inputs:{x:_},backend:t,attrs:{shape:g}}),t.disposeIntermediateTensorInfo(_)}else{const E=t.bufferSync(o),_=HO(p,E,k,C);N=t.makeTensorInfo(g,_.dtype,_.values)}return N}const U0e={kernelName:w6,backendName:"cpu",kernelFunc:W0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0e(n){const{inputs:e,backend:t,attrs:r}=n,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:d}=e,h=t.data.get(u.dataId).values,p=t.data.get(d.dataId).values,[g,x]=GO(h,p,o,s,i,a,l,c);return[t.makeTensorInfo([g.length],"string",g),t.makeTensorInfo(d.shape,"int32",x)]}const G0e={kernelName:Y_,backendName:"cpu",kernelFunc:H0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0e(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:o}=r,{input:s,delimiter:i}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values[0],[c,u,d]=qO(a,l,o),h=u.length;return[t.makeTensorInfo([h,2],"int32",c),t.makeTensorInfo([h],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const K0e={kernelName:Z_,backendName:"cpu",kernelFunc:q0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X0e(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:o}=r,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(s.dataId).values,a=KO(i,o);return t.makeTensorInfo(s.shape,"int32",a)}const Y0e={kernelName:Q_,backendName:"cpu",kernelFunc:X0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z0e=_n($1,n=>Math.tan(n)),Q0e={kernelName:$1,backendName:"cpu",kernelFunc:Z0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J0e=_n(F1,n=>Math.tanh(n)),exe={kernelName:F1,backendName:"cpu",kernelFunc:J0e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function txe(n){const{inputs:e,backend:t}=n,{tensor:r,indices:o,updates:s}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=jd(s,o,r.shape),d=!1,h=t.bufferSync(o),p=t.bufferSync(s),g=t.bufferSync(r),x=id(h,p,r.shape,u,l,a,i,c,g,d);return t.makeTensorInfo(r.shape,x.dtype,x.values)}const nxe={kernelName:W_,backendName:"cpu",kernelFunc:txe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{reps:s}=r;ht(o,"tile");const i=YO(t.bufferSync(o),s);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const oxe={kernelName:P1,backendName:"cpu",kernelFunc:rxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{k:s,sorted:i}=r;ht(o,"topk");const a=t.data.get(o.dataId).values,[l,c]=QO(a,o.shape,o.dtype,s,i);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}const ixe={kernelName:C6,backendName:"cpu",kernelFunc:sxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function axe(n){const{inputs:e,attrs:t,backend:r}=n,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:c}=t,[u,d,h,p]=o.shape,[g,x]=c??[d,h],y=[u,g,x,p],b=Nt(o.shape),C=b[0],S=b[1],k=b[2],N=Nt(y),E=N[0],_=N[1],$=N[2],T=Eo(o.dtype,De(y));T.fill(l);const D=r.data.get(o.dataId).values,A=r.data.get(s.dataId).values;for(let j=0;j<u;++j){const L=s.shape[0]===1?A:A.subarray(j*8,j*8+8);for(let U=0;U<g;++U)for(let G=0;G<x;++G)for(let H=0;H<p;++H){let O;const V=L[6]*G+L[7]*U+1;if(V===0)continue;const W=(L[0]*G+L[1]*U+L[2])/V,B=(L[3]*G+L[4]*U+L[5])/V,q=i9(W,h,a),Q=i9(B,d,a);switch(i){case"nearest":O=fxe(D,d,h,C,S,k,j,Q,q,H,l);break;case"bilinear":O=pxe(D,d,h,C,S,k,j,Q,q,H,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const Z=j*E+U*_+G*$+H;T[Z]=O}return r.makeTensorInfo(y,o.dtype,T)}return{dataId:r.write(T,y,o.dtype),shape:o.shape,dtype:o.dtype}}const lxe={kernelName:k6,backendName:"cpu",kernelFunc:axe};function i9(n,e,t){switch(t){case"reflect":return cxe(n,e);case"wrap":return uxe(n,e);case"nearest":return hxe(n,e);case"constant":default:return dxe(n)}}function cxe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{const r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return gd(0,t,e-1)}function uxe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{const r=e-1;t-=e*Math.trunc(t/r)}return gd(0,t,e-1)}function dxe(n,e){return n}function hxe(n,e){return gd(0,n,e-1)}function Up(n,e,t,r,o,s,i,a,l,c,u){const d=i*r+a*o+l*s+c;return 0<=a&&a<e&&0<=l&&l<t?n[d]:u}function fxe(n,e,t,r,o,s,i,a,l,c,u){const d=Math.round(a),h=Math.round(l);return Up(n,e,t,r,o,s,i,d,h,c,u)}function pxe(n,e,t,r,o,s,i,a,l,c,u){const d=Math.floor(a),h=Math.floor(l),p=d+1,g=h+1,x=(g-l)*Up(n,e,t,r,o,s,i,d,h,c,u)+(l-h)*Up(n,e,t,r,o,s,i,d,g,c,u),y=(g-l)*Up(n,e,t,r,o,s,i,p,h,c,u)+(l-h)*Up(n,e,t,r,o,s,i,p,g,c,u);return(p-a)*x+(a-d)*y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mxe(n){const{inputs:e,attrs:t,backend:r}=n,{axis:o}=t,{x:s}=e;ht(s,"unique");const i=r.data.get(s.dataId).values,{outputValues:a,outputShape:l,indices:c}=JO(i,o,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const gxe={kernelName:S6,backendName:"cpu",kernelFunc:mxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xxe(n){const{inputs:e,backend:t,attrs:r}=n,{value:o}=e;let{axis:s}=r;s<0&&(s+=o.shape.length);const i=o.shape.length,a=o.shape[s],l=new Array(i-1);let c=0;for(let p=0;p<i;p++)p!==s&&(l[c++]=o.shape[p]);const u=new Array(i).fill(0),d=o.shape.slice();d[s]=1;const h=new Array(a);for(let p=0;p<h.length;p++){u[s]=p;const g=Td({inputs:{x:o},backend:t,attrs:{begin:u,size:d}});h[p]=Vn({inputs:{x:g},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(g)}return h}const vxe={kernelName:G2,backendName:"cpu",kernelFunc:xxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,segmentIds:s}=e,{numSegments:i}=r;ht(o,"unsortedSegmentSum");const a=o.shape.length,l=s.shape.length,c=[],u=[],d=a-l;let h=s;for(let g=0;g<d;++g){const x=uv({inputs:{input:h},backend:t,attrs:{dim:g+1}});h=x,u.push(x)}for(let g=0;g<i;++g){const x=pu(g,"int32"),y=t.makeTensorInfo([],"int32",x),b=pO({inputs:{a:y,b:h},backend:t}),C=cu({inputs:{x:b},backend:t,attrs:{dtype:"float32"}}),S=yy({inputs:{a:C,b:o},backend:t}),k=J1({inputs:{x:S},backend:t,attrs:{axis:0,keepDims:!1}});c.push(k),u.push(y),u.push(b),u.push(C),u.push(S),u.push(k)}const p=pL({inputs:c,backend:t,attrs:{axis:0}});return u.forEach(g=>t.disposeIntermediateTensorInfo(g)),p}const bxe={kernelName:q2,backendName:"cpu",kernelFunc:yxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wxe=[mpe,Xhe,xpe,ype,tfe,wpe,kpe,Npe,Epe,Rpe,Ape,$pe,Ppe,Lpe,jpe,Wpe,Hpe,qpe,Xpe,fpe,Zpe,Jpe,tme,rfe,rme,Jhe,sfe,sme,Yhe,ame,cme,ume,hme,pme,gme,vme,bme,Cme,Sme,Ime,Tme,Dme,_me,Fme,Pme,Ome,Bme,Vme,zme,Wme,Ume,Gme,Xme,ipe,Zme,ife,s1e,afe,i1e,cfe,h1e,f1e,m1e,dfe,ffe,x1e,y1e,w1e,k1e,mfe,xfe,Zhe,N1e,lme,E1e,R1e,A1e,ape,yfe,wfe,$1e,kfe,P1e,L1e,j1e,W1e,H1e,q1e,K1e,Nfe,Y1e,Q1e,ege,nge,oge,ige,lge,Efe,uge,fge,gge,Rfe,Afe,yge,Cge,Nge,$fe,Ege,Rge,Dge,mL,Fge,cpe,Mfe,Mge,Lge,jge,zge,Qhe,JC,Uge,upe,dpe,hpe,Gge,Kge,Yge,Qge,e0e,t0e,r0e,Ufe,s0e,u0e,h0e,g0e,Gfe,v0e,b0e,C0e,qfe,pge,N0e,E0e,R0e,A0e,$0e,P0e,O0e,B0e,Yfe,j0e,Qfe,epe,z0e,U0e,G0e,K0e,Y0e,ope,qme,Q0e,exe,nxe,oxe,ixe,lxe,Ffe,gxe,vxe,bxe,Tge];for(const n of wxe)e$(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const td={},V0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Cxe(n,e){td[n]=e}function ma(n,e){if(!(n in td)||e!=null){const r=Sxe(n,e);if(r!==null)td[n]=r;else return console.log("Could not get context for WebGL version",n),null}const t=td[n];return t==null||t.isContextLost()?(delete td[n],ma(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),td[n])}function kxe(n){if(!Ce().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Sxe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??kxe(n);return t.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete td[n]},!1),Ce().getBool("SOFTWARE_WEBGL_ENABLED")&&(V0.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",V0)||t.getContext("experimental-webgl",V0):t.getContext("webgl2",V0)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wm;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(wm||(wm={}));var ri;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ri||(ri={}));var co;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(co||(co={}));function eg(n,e){return[e,n]}function Nxe(n,e){return n*e}function z0(n){const e=De(n),t=Math.ceil(e/4);return CC(t)}function Vf(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function Ixe(n,e){const[t,r]=Vf(n,e);return t*r*4}function i8(n,e){const t=n;let r,o,s,i,a,l,c,u,d,h;return Ce().getNumber("WEBGL_VERSION")===2?(r=t.R32F,o=t.R16F,s=t.RGBA16F,i=t.RGBA32F,a=t.RED,c=4,u=1,d=t.HALF_FLOAT,h=t.FLOAT,l=t.RGBA8):(r=n.RGBA,o=n.RGBA,s=n.RGBA,i=t.RGBA,a=n.RGBA,c=4,u=4,d=e!=null?e.HALF_FLOAT_OES:null,h=n.FLOAT,l=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tt(n,e){const t=e();return Ce().getBool("DEBUG")&&Exe(n),t}function Exe(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+Axe(n,e))}const Txe=596e-10,Rxe=65504;function Dxe(n){return!!(Ce().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Txe<Math.abs(n)&&Math.abs(n)<Rxe)}function Axe(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function W0(n,e){return cc(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function _xe(n,e){const t=cc(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(tt(n,()=>n.shaderSource(t,e)),tt(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function $xe(n,e){const t=cc(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(tt(n,()=>n.shaderSource(t,e)),tt(n,()=>n.compileShader(t)),Ce().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw gL(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const Fxe=/ERROR: [0-9]+:([0-9]+):/g;function gL(n,e){const t=Fxe.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const r=+t[1],o=n.split(`
`),s=o.length.toString().length+2,i=o.map((d,h)=>tf((h+1).toString(),s)+d);let a=0;for(let d=0;d<i.length;d++)a=Math.max(i[d].length,a);const l=i.slice(0,r-1),c=i.slice(r-1,r),u=i.slice(r);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${tf(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function Pxe(n){return cc(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function Mxe(n,e){if(tt(n,()=>n.linkProgram(e)),!Ce().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function I3(n,e){if(tt(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Oxe(n,e){const t=cc(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return tt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),tt(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function Lxe(n,e){const t=cc(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return tt(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),tt(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function Bxe(n){return cc(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function jxe(n,e){const t=Ce().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const r=`[${n}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){const r=`[${n}x${e}]`,o=`[${t}x${t}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function Vxe(n){return cc(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function a9(n,e,t,r,o,s,i){const a=n.getAttribLocation(e,t);return a===-1?!1:(tt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),tt(n,()=>n.vertexAttribPointer(a,o,n.FLOAT,!1,s,i)),tt(n,()=>n.enableVertexAttribArray(a)),!0)}function zxe(n,e,t){qxe(n,t),tt(n,()=>n.activeTexture(n.TEXTURE0+t)),tt(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function Wxe(n,e,t){return cc(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function Uxe(n,e,t){return n.getUniformLocation(e,t)}function Hxe(n,e,t,r){tt(n,()=>zxe(n,e,r)),tt(n,()=>n.uniform1i(t,r))}function E3(n,e,t){tt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),tt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function l9(n,e){tt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),tt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function U0(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Gxe(n,e))}function Gxe(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function cc(n,e,t){const r=tt(n,()=>e());if(r==null)throw new Error(t);return r}function qxe(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){const o=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Cf(n,e=2){return De(n.slice(0,n.length-e))}function kf(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function H0(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Cf(n),...kf(n)]),e}function Kxe(n,e=!1){let t=Ce().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Ce().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&Ce().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=t/2),e&&(t=t*2,r=r*2,n=n.map((a,l)=>l>=n.length-2?F5(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=fu(n).newShape);let o=De(n),s=null;n.length<=1&&o<=t?s=[1,o]:n.length===2&&n[0]<=t&&n[1]<=t?s=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?s=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?s=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?s=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(s=[n[0],n[1]*n[2]*n[3]]);const i=s!=null&&Math.max(...s)>r&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(s==null||i)if(e){const a=Cf(n);let l=2,c=2;n.length&&([l,c]=kf(n)),o=a*(l/2)*(c/2),s=CC(o).map(u=>u*2)}else s=CC(o);return s}function G0(n){return n%2===0}function hv(n,e){if(n=n.slice(-2),e=e.slice(-2),In(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],r=e[e.length-1];if(t===r||G0(t)&&G0(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&G0(n[0])&&G0(e[0])}let T3,R3;function Xxe(n){if(T3==null){const e=ma(n);T3=e.getParameter(e.MAX_TEXTURE_SIZE)}return T3}function Yxe(n){if(R3==null){const e=ma(n);R3=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,R3)}function Zxe(n){if(n===0)return 0;let e;const t=ma(n);return Ai(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Ai(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ai(n,e){return n.getExtension(e)!=null}function c9(n){try{if(ma(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Qxe(n){if(n===0)return!1;const e=ma(n);if(n===1){if(!Ai(e,"OES_texture_float"))return!1}else if(!Ai(e,"EXT_color_buffer_float"))return!1;return t4(e)}function Jxe(n){if(n===0)return!1;const e=ma(n);if(n===1){if(!Ai(e,"OES_texture_float")||!Ai(e,"WEBGL_color_buffer_float"))return!1}else{if(Ai(e,"EXT_color_buffer_float"))return t4(e);const r="EXT_color_buffer_half_float";if(Ai(e,r)){const o=e.getExtension(r);return eve(e,o)}return!1}return t4(e)}function t4(n){const e=i8(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(s),i}function eve(n,e){const t=i8(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(i),a}function tve(n){return n!==2?!1:ma(n).fenceSync!=null}function tg(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&K(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gt=Ce();gt.registerFlag("HAS_WEBGL",()=>gt.getNumber("WEBGL_VERSION")>0);gt.registerFlag("WEBGL_VERSION",()=>c9(2)?2:c9(1)?1:0);gt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);gt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>gt.get("WEBGL_VERSION")===2);gt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);gt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);gt.registerFlag("WEBGL_PACK",()=>gt.getBool("HAS_WEBGL"));gt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_PACK_CLIP",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_PACK_REDUCE",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_LAZILY_UNPACK",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_CONV_IM2COL",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>gt.getBool("WEBGL_PACK"));gt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Xxe(gt.getNumber("WEBGL_VERSION")));gt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Yxe(gt.getNumber("WEBGL_VERSION")));gt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=gt.getNumber("WEBGL_VERSION");return n===0?0:Zxe(n)});gt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>gt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!f$());gt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Qxe(gt.getNumber("WEBGL_VERSION")));gt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>gt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:gt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));gt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Jxe(gt.getNumber("WEBGL_VERSION")));gt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>tve(gt.getNumber("WEBGL_VERSION")));gt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>gt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);gt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});gt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>f$()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});gt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);gt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);gt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);gt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);gt.registerFlag("WEBGL_EXP_CONV",()=>!1);gt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>gt.getBool("IS_TEST"));gt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);gt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);gt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);gt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function es(){let n,e,t,r,o,s,i,a,l,c;return Ce().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",o="texture",s="outputColor",i="out vec4 outputColor;",a=Ce().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",o="texture2D",s="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:o,output:s,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wd(n,e,t="index"){const r=Nt(e);return r.map((o,s)=>{const i=`int ${n[s]} = ${t} / ${o}`,a=s===r.length-1?`int ${n[s+1]} = ${t} - ${n[s]} * ${o}`:`index -= ${n[s]} * ${o}`;return`${i}; ${a};`}).join("")}function by(n,e,t="index"){const r=Nt(e);return r.map((o,s)=>{const i=`int ${n[s]} = ${t} / outShapeStrides[${s}]`,a=s===r.length-1?`int ${n[s+1]} = ${t} - ${n[s]} * outShapeStrides[${s}]`:`index -= ${n[s]} * outShapeStrides[${s}]`;return`${i}; ${a};`}).join("")}function nve(n,e){const t=n.length,r=n.map(s=>`${e}[${s}]`),o=new Array(t-1);o[t-2]=r[t-1];for(let s=t-3;s>=0;--s)o[s]=`(${o[s+1]} * ${r[s+1]})`;return o}function rve(n,e,t="index"){const r=n.map((s,i)=>i),o=nve(r,e);return o.map((s,i)=>{const a=`int ${n[i]} = ${t} / ${o[i]}`,l=i===o.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${o[i]}`:`index -= ${n[i]} * ${o[i]}`;return`${a}; ${l};`}).join("")}function a8(n){const e=Nt(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function l8(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const xL=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:vL}=qle;function ove(n,e,t){const r=[];if(n.forEach(p=>{const g=De(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?r.push(`uniform float ${p.name}${g>1?`[${g}]`:""};`):(r.push(`uniform sampler2D ${p.name};`),r.push(`uniform int offset${p.name};`)),t.enableShapeUniforms){const{uniformShape:x}=c8(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(x.length){case 1:r.push(`uniform int ${p.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${p.name}Shape;`);break}r.push(`uniform ivec2 ${p.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(p=>{r.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const o=r.join(`
`),s=n.map(p=>sve(p,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=es(),l=lve(a);let c,u,d=dve(a);return e.isPacked?(c=ive(e.logicalShape,i,t.enableShapeUniforms),u=uve(a)):(c=ave(e.logicalShape,i,t.enableShapeUniforms),u=cve(a)),t.packedInputs&&(d+=mve),[d,l,u,o,c,s,t.userCode].join(`
`)}function zf(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return Eve(n,e);case 1:return Rve(n,e);case 2:return Ave(n,e);case 3:return $ve(n,e);case 4:return Pve(n,e);case 5:return Mve(n);case 6:return Ove(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function yL(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return Ive(n);case 1:return Tve(n,e);case 2:return Dve(n,e);case 3:return _ve(n,e);default:return Fve(n,e)}}function sve(n,e,t=!1,r){let o="";t?o+=yL(n,r):o+=zf(n,r);const s=n.shapeInfo.logicalShape,i=e.logicalShape;return s.length<=i.length&&(t?o+=Lve(n,e):o+=Bve(n,e)),o}function ive(n,e,t){switch(n.length){case 0:return bL();case 1:return gve(n,e,t);case 2:return Sve(n,e,t);case 3:return vve(n,e,t);default:return bve(n,e,t)}}function ave(n,e,t){switch(n.length){case 0:return bL();case 1:return xve(n,e,t);case 2:return Nve(n,e,t);case 3:return yve(n,e,t);case 4:return wve(n,e,t);case 5:return Cve(n,e);case 6:return kve(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function lve(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function cve(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function uve(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function dve(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${hve}
    ${fve}
    ${pve}
  `}const hve=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,fve=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,pve=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,mve=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function bL(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function gve(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function xve(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function vve(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(n[2]/2),s=o*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function yve(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${by(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const r=Wd(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function bve(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(n[n.length-1]/2),s=o*Math.ceil(n[n.length-2]/2);let i=s,a="",l="b, r, c";for(let c=2;c<n.length-1;c++)i*=n[n.length-c-1],a=`
      int b${c} = index / ${i};
      index -= b${c} * ${i};
    `+a,l=`b${c}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${n.length}(${l});
    }
  `}function wve(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${by(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const r=Wd(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function Cve(n,e){const t=Wd(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function kve(n,e){const t=Wd(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Sve(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(In(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const o=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function Nve(n,e,t){return In(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Ud(n){return`offset${n}`}function Ive(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=es();return`
    vec4 ${t}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function Eve(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${t};}`;const[o,s]=n.shapeInfo.texShape;if(o===1&&s===1)return`
      float ${r}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=Ud(t);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function Tve(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=n.shapeInfo.texShape,s=es();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${s.texture2D}(${t}, uv);
    }
  `}function Rve(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${Wf(n)}
      }
    `;const o=n.shapeInfo.texShape,s=o[0],i=o[1];if(i===1&&s===1)return`
      float ${r}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Ud(t);return i===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${t}, uv);
      }
    `:s===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function Dve(n,e){const t=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n.shapeInfo.texShape,i=s[0],a=s[1],l=es();if(s!=null&&In(t,s))return e?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;const c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(t[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function Ave(n,e){const t=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n.shapeInfo.texShape;if(s!=null&&In(t,s)){if(e)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const h=s[0],p=s[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:i,keptDims:a}=fu(t),l=i;if(l.length<t.length){const h=Uf(n,l),p=["row","col"];return`
      ${zf(h,e)}
      float ${o}(int row, int col) {
        return ${o}(${Hf(p,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Wf(n)}
      }
    `;const c=s[0],u=s[1],d=Ud(r);return u===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${r}, uv);
    }
  `:c===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${r}, uv);
  }
`}function _ve(n,e){const t=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(t[0]===1){const h=t.slice(1),p=[1,2],g=Uf(n,h),x=["b","row","col"];return`
        ${yL(g,e)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${Hf(x,p)});
        }
      `}const a=es();if(e)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const l=i[0],c=i[1],u=Math.ceil(t[2]/2),d=u*Math.ceil(t[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function $ve(n,e){const t=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t[1]*t[2],i=t[2],{newShape:a,keptDims:l}=fu(t),c=a;if(c.length<t.length){const x=Uf(n,c),y=["row","col","depth"];return`
        ${zf(x,e)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${Hf(y,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${i}, 1)));
        ${Wf(n)}
      }
    `;const u=n.shapeInfo.texShape,d=u[0],h=u[1],p=n.shapeInfo.flatOffset;if(h===s&&p==null)return e?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${d}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(h===i&&p==null)return e?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `;const g=Ud(r);return e?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${g};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${i} + depth + ${g};
        vec2 uv = uvFromFlat(${d}, ${h}, index);
        return sampleTexture(${r}, uv);
      }
  `}function Fve(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=es();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${t}, uv);
    }
  `;const s=n.shapeInfo.logicalShape,i=s.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(s[i-1]/2);let h=d*Math.ceil(s[i-2]/2),p="int b, int row, int col",g=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let x=2;x<i-1;x++)p=`int b${x}, `+p,h*=s[i-x-1],g=`b${x} * ${h} + `+g;return`
    vec4 ${r}(${p}) {
      int index = ${g};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${o.texture2D}(${t}, uv);
    }
  `}function Pve(n,e){const t=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t[3],i=t[2]*s,a=t[1]*i,{newShape:l,keptDims:c}=fu(t);if(l.length<t.length){const C=Uf(n,l),S=["row","col","depth","depth2"];return`
      ${zf(C,e)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${Hf(S,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${s}, 1)));
        ${Wf(n)}
      }
    `;const u=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,h=d[0],p=d[1],g=`int stride2 = ${r}Shape[3];`,x=`int stride1 = ${r}Shape[2] * stride2;`,y=`int stride0 = ${r}Shape[1] * stride1;`;if(p===a&&u==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${g}
        ${x}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(p===s&&u==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;const b=Ud(r);return e?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${g}
      ${x}
      ${y}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${b});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${h}, ${p}, index + ${b});
      return sampleTexture(${r}, uv);
    }
  `}function Mve(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=e[4],s=e[3]*o,i=e[2]*s,a=e[1]*i,{newShape:l,keptDims:c}=fu(e);if(l.length<e.length){const x=Uf(n,l),y=["row","col","depth","depth2","depth3"];return`
      ${zf(x)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${Hf(y,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${s}, ${o})) +
          depth3;
        ${Wf(n)}
      }
    `;const u=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,h=d[0],p=d[1];if(p===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(p===o&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${t}, uv);
      }
    `;const g=Ud(t);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${s} +
          depth2 * ${o} + depth3 + ${g};
      vec2 uv = uvFromFlat(${h}, ${p}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Ove(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:o,keptDims:s}=fu(e);if(o.length<e.length){const y=Uf(n,o),b=["row","col","depth","depth2","depth3","depth4"];return`
      ${zf(y)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${Hf(b,s)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Wf(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,p=h[0],g=h[1];if(g===u&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===i&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const x=Ud(t);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${x};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Wf(n){const e=n.name,t=De(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Lve(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),o="get"+r+"AtOutCoords",s=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=vL(n.shapeInfo.logicalShape,e.logicalShape),l=Fn(i),c=i-s;let u;const d=["x","y","z","w","u","v"];s===0?u="":i<2&&a.length>=1?u="coords = 0;":u=a.map(C=>`coords.${d[C+c]} = 0;`).join(`
`);let h="";i<2&&s>0?h="coords":h=n.shapeInfo.logicalShape.map((C,S)=>`coords.${d[S+c]}`).join(", ");let p="return outputValue;";const x=De(n.shapeInfo.logicalShape)===1,b=De(e.logicalShape)===1;if(s===1&&!x&&!b)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(x&&!b)i===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const C=s-2,S=s-1;a.indexOf(C)>-1&&a.indexOf(S)>-1?p="return vec4(outputValue.x);":a.indexOf(C)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(S)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${h});
      ${p}
    }
  `}function Bve(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),o="get"+r+"AtOutCoords",s=e.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&In(i,s))return`
      float ${o}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const c=Fn(l),u=vL(n.shapeInfo.logicalShape,e.logicalShape),d=l-a;let h;const p=["x","y","z","w","u","v"];a===0?h="":l<2&&u.length>=1?h="coords = 0;":h=u.map(x=>`coords.${p[x+d]} = 0;`).join(`
`);let g="";return l<2&&a>0?g="coords":g=n.shapeInfo.logicalShape.map((x,y)=>`coords.${p[y+d]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${h}
      return get${r}(${g});
    }
  `}function Fn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function c8(n,e,t){const{newShape:r,keptDims:o}=fu(e),s=e.length,i=n&&s===3&&e[0]===1,a=i?e.slice(1):r,l=!n&&s>1&&!In(e,t)&&r.length<s||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:o}}function Uf(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Hf(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jve(n,e,t,r){const o=t.map((u,d)=>{const h={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(h.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:h}}),s=o.map(u=>u.shapeInfo),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=ove(o,i,e),l=$xe(n.gl,a),c=n.createProgram(l);return Ce().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:i},wL(n,e,c)))}function wL(n,e,t){const r=[],o=[];let s,i,a,l=null,c=null;c=n.getUniformLocation(t,"NAN",!1),Ce().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const u=!1;for(const d of e.variableNames){const h={name:d,uniform:n.getUniformLocation(t,d,u),offset:n.getUniformLocation(t,`offset${d}`,u)};e.enableShapeUniforms&&(h.shape=n.getUniformLocation(t,`${d}Shape`,u),h.texShape=n.getUniformLocation(t,`${d}TexShape`,u)),r.push(h)}if(e.enableShapeUniforms&&(s=n.getUniformLocation(t,"outShape",u),a=n.getUniformLocation(t,"outShapeStrides",u),i=n.getUniformLocation(t,"outTexShape",u)),e.customUniforms)for(const d of e.customUniforms)o.push(n.getUniformLocation(t,d.name,u));return{variablesLocations:r,customUniformLocations:o,infLoc:l,nanLoc:c,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:i}}function u9(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,r)=>{const o=t.logicalShape,s=e[r],i=s.shape;if(!In(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(t.isUniform&&s.isUniform)return;const a=t.texShape,l=s.isUniform?null:s.texData.texShape;if(!In(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Vve(n,e,t,r,o){e.program.enableShapeUniforms||(u9(e.inShapeInfos,t),u9([e.outShapeInfo],[r]));const s=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(s.texture,i[0],i[1]):n.setOutputMatrixTexture(s.texture,i[0],i[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),Ce().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const c=t[l],{uniform:u,offset:d,shape:h,texShape:p}=e.variablesLocations[l];if(h){const{uniformShape:g}=c8(e.program.packedInputs,c.shape,c.texData.texShape);switch(g.length){case 1:n.gl.uniform1iv(h,new Int32Array(g));break;case 2:n.gl.uniform2iv(h,new Int32Array(g));break;case 3:n.gl.uniform3iv(h,new Int32Array(g));break;case 4:n.gl.uniform4iv(h,new Int32Array(g));break}}if(p&&n.gl.uniform2i(p,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(De(c.shape)<2)n.gl.uniform1f(u,c.uniformValues[0]);else{let g=c.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),n.gl.uniform1fv(u,g)}continue}c.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const l=Nt(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&o)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],d=o[l];if(c.type==="float")n.gl.uniform1fv(u,d);else if(c.type==="vec2")n.gl.uniform2fv(u,d);else if(c.type==="vec3")n.gl.uniform3fv(u,d);else if(c.type==="vec4")n.gl.uniform4fv(u,d);else if(c.type==="int")n.gl.uniform1iv(u,d);else if(c.type==="ivec2")n.gl.uniform2iv(u,d);else if(c.type==="ivec3")n.gl.uniform3iv(u,d);else if(c.type==="ivec4")n.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}n.executeProgram()}function zve(n,e,t){let r="";e.concat(t).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=c8(n.packedInputs,i.shape,l);let h="",p="",g="";if(u.length===1&&n.packedInputs){const N=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];h=`${N[0]>1}_${N[1]>1}`}else if(u.length===2&&!n.packedInputs)p=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!n.packedInputs){const N=Nt(u);g=`${N[0]===l[1]}_${N[N.length-1]===l[1]}`}const x=i.shape.length,y=u.length===2&&In(i.shape,l),b=De(i.shape)===1,C=gf(i.shape,t.shape),S=!n.packedInputs&&x===t.shape.length&&In(l,t.texData.texShape),k=n.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${x}_${S}_${c?d:""}_${u.length}_${b}_${C}_${y}_${h}_${p}_${g}_${k}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;r+=`${i.shape}_${l}_${a}`}});const o=n.userCode;let s=n.constructor.name;return s+="_"+r+"_"+o+`${Ce().getNumber("WEBGL_VERSION")}`,s}function _o(n){return Ce().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wve{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=wm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=es();this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?by(["r","c","d"],e):Wd(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uve{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=wm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=es();this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?by(["r","c","d"],e):Wd(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hve{constructor(e){this.variableNames=["A"],this.outTexUsage=ri.DOWNLOAD;const t=es();this.outputShape=e,this.userCode=`
      ${xL}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gve{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ri.DOWNLOAD;const t=es();this.outputShape=e,this.userCode=`
      ${xL}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qve={R:0,G:1,B:2,A:3};class d9{constructor(e,t=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const o=es();this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length);let s="result";t&&(s="floor(result * 255. + 0.5)");let i="";for(let a=0;a<r.length;a++){const l=r[a];i+=`
          if(offset == ${a}) {
            result = values[${qve[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?l8():a8(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${i}
        }
        ${o.output} = vec4(${s}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kve{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=es();this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length);let o="",s="result";t&&(s="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?l8():a8(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${r.output} = ${s};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xve(n){const e=es(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return _xe(n,t)}function Yve(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Oxe(n,e)}function Zve(n){const e=new Uint16Array([0,1,2,2,1,3]);return Lxe(n,e)}function ng(n,e,t,r,o,s){jxe(e,t);const i=Bxe(n),a=n.TEXTURE_2D;return tt(n,()=>n.bindTexture(a,i)),tt(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),tt(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),tt(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),tt(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),Ce().getNumber("WEBGL_VERSION")===1?tt(n,()=>n.texImage2D(a,0,r,e,t,0,o,s,null)):tt(n,()=>n.texStorage2D(a,1,r,e,t)),tt(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function CL(n){return n.internalFormatFloat}function Qve(n,e,t,r){const[o,s]=eg(e,t);return ng(n,o,s,CL(r),r.textureFormatFloat,n.FLOAT)}function kL(n){return n.internalFormatHalfFloat}function Jve(n,e,t,r){const[o,s]=eg(e,t);return ng(n,o,s,kL(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function SL(n){return n.downloadTextureFormat}function e2e(n,e,t,r){const[o,s]=eg(e,t);return ng(n,o,s,SL(r),n.RGBA,n.UNSIGNED_BYTE)}function NL(n){return n.internalFormatPackedFloat}function t2e(n,e,t,r){const[o,s]=Vf(e,t);return ng(n,o,s,NL(r),n.RGBA,n.FLOAT)}function IL(n){return n.internalFormatPackedHalfFloat}function n2e(n,e,t,r){const[o,s]=Vf(e,t);return ng(n,o,s,IL(r),n.RGBA,r.textureTypeHalfFloat)}function r2e(n,e,t){return tt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),a9(n,e,"clipSpacePos",t,3,20,0)&&a9(n,e,"uv",t,2,20,12)}function o2e(n,e,t,r,o,s){tt(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,a,l;o instanceof Uint8Array?(i=new Uint8Array(t*r*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(i=new Float32Array(t*r*4),a=n.FLOAT,l=s.internalFormatPackedFloat),i.set(o),Ce().getNumber("WEBGL_VERSION")===2?tt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,a,i)):tt(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,r,0,n.RGBA,a,i)),tt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function s2e(n,e,t){tt(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?Ce().getNumber("WEBGL_VERSION")===2?tt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):tt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):Ce().getNumber("WEBGL_VERSION")===2?tt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):tt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),tt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function i2e(n,e,t,r){const o=n.createBuffer();tt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,o));const a=4*4*e*t;return tt(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),tt(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),tt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),o}function a2e(n,e,t){const r=n,o=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function l2e(n,e,t,r){const[o,s]=eg(e,t),i=4,a=new Uint8Array(Nxe(e*t,i));return tt(n,()=>n.readPixels(0,0,o,s,r.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function c2e(n,e,t,r,o,s,i,a){const l=n,c=new Float32Array(Ixe(s,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function u2e(n,e,t){const r=new Float32Array(e*t*4);return tt(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D3{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=Ce().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,Cxe(t,e)):this.gl=ma(t),e=this.gl,Ce().getNumber("WEBGL_VERSION")===2){const s=e;this.createVertexArray=()=>tt(s,()=>s.createVertexArray()),this.bindVertexArray=i=>tt(s,()=>s.bindVertexArray(i)),this.deleteVertexArray=i=>tt(s,()=>s.deleteVertexArray(i)),this.getVertexArray=()=>tt(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(e!=null){const s=e.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>tt(e,()=>s.createVertexArrayOES()),this.bindVertexArray=i=>tt(e,()=>s.bindVertexArrayOES(i)),this.deleteVertexArray=i=>tt(e,()=>s.deleteVertexArrayOES(i)),this.getVertexArray=()=>tt(e,()=>e.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Ce().getNumber("WEBGL_VERSION")===1){const s="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=W0(this.gl,s),Ai(this.gl,i))this.textureHalfFloatExtension=W0(this.gl,i);else if(Ce().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Ai(this.gl,o))this.colorBufferHalfFloatExtension=W0(this.gl,o);else if(Ce().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Ai(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Ai(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Yve(this.gl),this.indexBuffer=Zve(this.gl),this.framebuffer=Vxe(this.gl),this.textureConfig=i8(this.gl,this.textureHalfFloatExtension)}get debug(){return Ce().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;tt(e,()=>e.finish()),tt(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),tt(e,()=>e.deleteFramebuffer(this.framebuffer)),tt(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),tt(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),tt(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),Qve(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),Jve(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),e2e(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),s2e(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,o){this.throwIfDisposed(),o2e(this.gl,e,t,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),n2e(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),t2e(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(l9(this.gl,this.framebuffer),this.outputTexture=null),tt(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,()=>l2e(this.gl,t,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,r,o,s,i){return c2e(this.gl,e,t,r,o,s,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return a2e(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const o=i2e(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if(Ce().getBool("WEBGL_FENCE_API_ENABLED")){const o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const i=o.clientWaitSync(s,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},t=s}else Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,()=>u2e(this.gl,t,r))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=Xve(t));const r=Pxe(t);tt(t,()=>t.attachShader(r,this.vertexShader)),tt(t,()=>t.attachShader(r,e)),Mxe(t,r);const o=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&I3(t,o),o}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;tt(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),r2e(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(tt(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&I3(this.gl,this.program),tt(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?Wxe(this.gl,e,t):Uxe(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),tt(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),Hxe(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[o,s]=Vf(t,r);this.setOutputMatrixTextureDriver(e,o,s)}setOutputMatrixWriteRegion(e,t,r,o){this.setOutputMatrixWriteRegionDriver(r,e,o,t)}setOutputPackedMatrixWriteRegion(e,t,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&I3(this.gl,this.program),U0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}tt(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),tt(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=W0(this.gl,Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,s),s}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await qI(()=>this.disposed||this.isQueryAvailable(e,Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const r=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=d2e(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:r}=this.itemsToPoll[t];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in Ce().platform&&(r=Ce().platform.setTimeoutCustom.bind(Ce().platform)),qI(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),E3(this.gl,e,this.framebuffer),this.debug&&U0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(E3(this.gl,this.outputTexture,this.framebuffer),this.debug&&U0(this.gl)):l9(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const o=this.gl;E3(o,e,this.framebuffer),this.debug&&U0(o),this.outputTexture=e,tt(o,()=>o.viewport(0,0,t,r)),tt(o,()=>o.scissor(0,0,t,r))}setOutputMatrixWriteRegionDriver(e,t,r,o){this.throwIfDisposed(),tt(this.gl,()=>this.gl.scissor(e,t,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function d2e(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:h2e,bincountImpl:EL,bincountReduceImpl:f2e,bitwiseAndImpl:p2e,castImpl:m2e,ceilImpl:g2e,concatImpl:x2e,equalImpl:v2e,expImpl:y2e,expm1Impl:b2e,floorImpl:w2e,gatherNdImpl:C2e,gatherV2Impl:k2e,greaterImpl:S2e,greaterEqualImpl:N2e,lessImpl:I2e,lessEqualImpl:E2e,linSpaceImpl:T2e,logImpl:R2e,maxImpl:D2e,maximumImpl:A2e,minimumImpl:_2e,multiplyImpl:$2e,negImpl:F2e,notEqualImpl:P2e,prodImpl:M2e,raggedGatherImpl:O2e,raggedRangeImpl:L2e,raggedTensorToTensorImpl:B2e,rangeImpl:j2e,rsqrtImpl:V2e,scatterImpl:z2e,sigmoidImpl:W2e,simpleAbsImpl:TL,sliceImpl:U2e,sparseFillEmptyRowsImpl:H2e,sparseReshapeImpl:G2e,sparseSegmentReductionImpl:RL,sqrtImpl:q2e,staticRegexReplaceImpl:K2e,stridedSliceImpl:X2e,stringNGramsImpl:Y2e,stringSplitImpl:Z2e,stringToHashBucketFastImpl:Q2e,subImpl:J2e,tileImpl:eye,topKImpl:tye,transposeImpl:u8,uniqueImpl:nye}=spe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DL(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Ko(n,e){return e===1?[n]:DL(n,e)}function rye(n,e){if(n===1)return"rc";let t="";for(let r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oye{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=_o(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Ko("rc",this.rank),r=Fn(this.rank),o=this.getOutOfBoundsCondition(t),s=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let s=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)s=`${e[e.length-1-i]},`+s;t.push(s)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let r=this.rank-2;r<this.rank;r++)t+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${o};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AL{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length);let r="";for(let o=0;o<4;o++){let s="thisRC = rc;";o%2===1&&(s+="thisRC.z += 1;"),o>1&&(s+="thisRC.y += 1;"),r+=`
        ${s}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${sye(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?l8():a8(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function sye(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?rve(["r","c","d"],"inputShape"):Wd(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iye{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,r){const o=f9(t,r),s=p9(e,o,r);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const i=h9(e,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[s].pop();return this.usedTextures[s].push(l),l}let a;return o===co.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===co.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===co.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===co.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===co.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,r,o){if(this.freeTextures==null)return;const s=f9(r,o),i=p9(t,s,o);i in this.freeTextures||(this.freeTextures[i]=[]);const a=h9(t,s,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=Ce().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[i],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function aye(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function h9(n,e,t,r,o){const s=lye(e,r);let i;if(o){const[l,c]=Vf(n[0],n[1]);i=l*c}else{const[l,c]=eg(n[0],n[1]);i=l*c}const a=aye(t,s);return i*a}function lye(n,e){switch(n){case co.PACKED_2X2_FLOAT32:return NL(e);case co.PACKED_2X2_FLOAT16:return IL(e);case co.UNPACKED_FLOAT32:return CL(e);case co.UNPACKED_FLOAT16:return kL(e);case co.PACKED_4X1_UNSIGNED_BYTE:return SL(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function cye(n){return Ce().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?co.PACKED_2X2_FLOAT32:co.UNPACKED_FLOAT32:n?co.PACKED_2X2_FLOAT16:co.UNPACKED_FLOAT16}function f9(n,e){if(n===ri.UPLOAD)return co.PACKED_2X2_FLOAT32;if(n===ri.RENDER||n==null)return cye(e);if(n===ri.DOWNLOAD||n===ri.PIXELS)return co.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function p9(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Za{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Oi="if (isnan(x)) return x;",uye="return x;",m9="return abs(x);",dye="return (x >= 0.0) ? x : (exp(x) - 1.0);",hye=Oi+`
  return (x < 0.0) ? 0.0 : x;
`,fye=Oi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Bc="return x;",pye="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mye="return x;",gye=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,xye=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,vye=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,yye="return 1.0 / (1.0 + exp(-1.0 * x));";class Gc{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bye{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length);const t=e.length,r=Ko("rc",t),o=Fn(t),s=rye(t,r),i=r.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wye=tF,Cye=1e-7,kye=1e-4,q0={};function Sye(n){return n in q0||(q0[n]={}),q0[n]}const Nye=Ce().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Iye=600;function Eye(){return Ce().global.screen==null?1024:Ce().global.screen.height*Ce().global.screen.width*window.devicePixelRatio*Iye/1024/1024}class wy extends $5{nextDataId(){return wy.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Ce().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof D3)t=e;else{const r=ma(Ce().getNumber("WEBGL_VERSION"),e);t=new D3(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=ma(Ce().getNumber("WEBGL_VERSION"));t=new D3(r),this.binaryCache=Sye(Ce().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new iye(this.gpgpu),this.numMBBeforeWarning=Eye(),this.texData=new N_(this,ja())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,r,o,s,i){const a=this.makeTensorInfo(t,r),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[o,s]},l.texShape=[o,s];const c=H0(t),u=new d9(c,!1,i),d=this.runWebGLProgram(u,[a],r,[[o,s]]);return d.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,t,r){if((Ce().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Ce().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const o={id:this.nextDataId()};return this.texData.set(o,{shape:t,dtype:r,values:e,usage:ri.UPLOAD,refCount:1}),o}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,r,o,s){if(Ce().getBool("DEBUG")&&this.checkNumericalProblems(t),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:o,values:t,usage:ri.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:r,dtype:o,complexTensorInfos:s,slice:i,shape:a,isPacked:l}=t;if(i!=null){let h;l?h=new Gc(a,Bc):h=new Za(a,Bc);const p=this.runWebGLProgram(h,[{dataId:e,shape:a,dtype:o}],o),g=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),g}if(r!=null)return this.convertAndCacheOnCPU(e);if(o==="string")return r;const c=this.activeTimers!=null;let u;c&&(u=as());let d;if(o==="complex64"){const h=this.readSync(s.real.dataId),p=this.readSync(s.imag.dataId);d=Ql(h,p)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=as()-u),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const g=this.pendingRead.get(e);return new Promise(x=>g.push(x))}const t=this.texData.get(e),{values:r,shape:o,slice:s,dtype:i,complexTensorInfos:a,isPacked:l}=t;if(s!=null){let g;l?g=new Gc(o,Bc):g=new Za(o,Bc);const x=this.runWebGLProgram(g,[{dataId:e,shape:o,dtype:i}],i),y=this.read(x.dataId);return this.disposeIntermediateTensorInfo(x),y}if(r!=null)return this.convertAndCacheOnCPU(e);if(Ce().getBool("DEBUG")&&!Ce().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ce().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(i!=="complex64"&&Ce().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const g=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(g.texture.texture,...z0(o))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(i==="complex64"){const g=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),x=g[0],y=g[1];d=Ql(x,y)}else if(c==null)d=this.getValuesFromTexture(e);else{const g=De(o);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,g)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const g=this.gpgpu.gl;tt(g,()=>g.deleteBuffer(c))}const h=this.convertAndCacheOnCPU(e,d),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(g=>g(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ja().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,t={}){const r=this.texData.get(e),{values:o,shape:s,slice:i,dtype:a,isPacked:l,texture:c}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let p;l?p=new Gc(s,Bc):p=new Za(s,Bc);const g=this.runWebGLProgram(p,[{dataId:e,shape:s,dtype:a}],a),x=this.readToGPU(g,t);return this.disposeIntermediateTensorInfo(g),x}if(c==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,t.customTexShape),d=ja().makeTensorFromTensorInfo(u),h=this.texData.get(u.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(o=>ou(o));return Zt(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Zt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const r=e[t];if(!Dxe(r))throw Ce().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:r,isPacked:o}=this.texData.get(e),s=De(t);if(Ce().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(e),p=this.texData.get(h.dataId),g=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...z0(t)).subarray(0,s);return this.disposeIntermediateTensorInfo(h),g}const i=Ce().getBool("WEBGL_PACK")&&o===!0,a=i?H0(t):t,l=i?new Gve(a):new Hve(a),c=this.runWebGLProgram(l,[{shape:a,dtype:r,dataId:e}],"float32"),u=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,r=[];let o=!1;this.programTimersStack==null?(this.programTimersStack=r,o=!0):this.activeTimers.push(r),this.activeTimers=r,e();const s=xd(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=xd(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,o&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(s);a.kernelMs=cne(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:i[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:as(),endMs:null}}endTimer(e){return Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=as(),e)}async getQueryTime(e){if(Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:r,texShape:o,usage:s,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(t,o,s,i)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=Nye){return Ce().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&De(r.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Js("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return wye(e.shape,t)}packedUnaryOp(e,t,r){const o=new Gc(e.shape,t),s=this.compileAndRun(o,[e],r);return ja().makeTensorFromTensorInfo(s)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const o=TL(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,o)}if(Ce().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,m9,e.dtype);const t=new Za(e.shape,m9),r=this.compileAndRun(t,[e]);return ja().makeTensorFromTensorInfo(r)}makeTensorInfo(e,t,r){let o;if(t==="string"&&r!=null&&r.length>0&&Vm(r[0])){const s=r.map(i=>Zc(i));o=this.write(s,e,t)}else o=this.write(r,e,t);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:t}}makeOutput(e,t,r){return ja().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,r),this)}unpackTensor(e){const t=new bye(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new oye(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const r=[Cf(e.shape),...kf(e.shape)],o={dtype:e.dtype,shape:r,dataId:e.dataId},s=[Cf(t),...kf(t)],i=new AL(s,r),a=!0,l=[r],c=this.runWebGLProgram(i,[o],e.dtype,l,a);return{dataId:c.dataId,shape:t,dtype:c.dtype}}decode(e,t){const r=this.texData.get(e),{isPacked:o,shape:s,dtype:i}=r;if(t!=null){const h=De(s),p=t[0]*t[1]*4;K(h<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=H0(s);let l;o?l=new Uve(a):l=new Wve(a);const c=!0,u=[t??z0(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,u,c,t);return{dtype:i,shape:s,dataId:d.dataId}}runWebGLProgram(e,t,r,o,s=!1,i){const a=this.makeTensorInfo(e.outputShape,r),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===wm.DENSE){const b=i??z0(e.outputShape);l.texShape=b.map(C=>C*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),De(a.shape)===0)return l.values=Eo(a.dtype,0),a;const c=[],u=t.map(b=>{if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(b.dataId);if(C.texture==null){if(!e.packedInputs&&De(b.shape)<=Ce().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:C.values};e.packedInputs&&(C.isPacked=!0,C.shape=b.shape)}if(this.uploadToGPU(b.dataId),!!C.isPacked!=!!e.packedInputs)b=C.isPacked?this.unpackTensor(b):this.packTensor(b),c.push(b),C=this.texData.get(b.dataId);else if(C.isPacked&&!hv(C.shape,b.shape)){const S=b,k=b.shape;b.shape=C.shape,b=this.packedReshape(b,k),c.push(b),C=this.texData.get(b.dataId),S.shape=k}return{shape:b.shape,texData:C,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},h=zve(e,u,d),p=this.getAndSaveBinary(h,()=>jve(this.gpgpu,e,u,d)),g=this.activeTimers!=null;let x;g&&(x=this.startTimer()),Ce().get("ENGINE_COMPILE_ONLY")||Vve(this.gpgpu,p,u,d,o),c.forEach(b=>this.disposeIntermediateTensorInfo(b)),g&&(x=this.endTimer(x),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(x)}));const y=Ce().getNumber("WEBGL_FLUSH_THRESHOLD");if(y>0){const b=as();b-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!Ce().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){const b=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),b}return a}compileAndRun(e,t,r,o,s=!1){return r=r||t[0].dtype,this.runWebGLProgram(e,t,r,o,s)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Ce().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ve(()=>{if(!Ce().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Ce().getBool("DEBUG");Ce().set("DEBUG",!1);const t=this.abs(Nn(1e-8)).dataSync()[0];if(Ce().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Cye:kye}uploadToGPU(e){const t=this.texData.get(e),{shape:r,dtype:o,values:s,texture:i,usage:a,isPacked:l}=t;if(i!=null)return;const c=this.activeTimers!=null;let u;c&&(u=as());let d=t.texShape;if(d==null&&(d=Kxe(r,l),t.texShape=d),s!=null){const h=H0(r);let p,g=d[1],x=d[0];const y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!y)&&([g,x]=Vf(d[0],d[1])),l?p=new Kve(h,y):p=new d9(h,y);const b=y?[x,g]:d,C=this.makeTensorInfo(b,o),S=this.texData.get(C.dataId);y?S.usage=ri.PIXELS:S.usage=ri.UPLOAD,S.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),g,x,s);const k=[[x,g]],E=this.runWebGLProgram(p,[C],o,k,!0),_=this.texData.get(E.dataId);t.texShape=_.texShape,t.isPacked=_.isPacked,t.usage=_.usage,Ce().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(t.texture=_.texture,t.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(C),c&&(this.uploadWaitMs+=as()-u)}else{const h=this.acquireTexture(d,a,o,l);t.texture=h}}convertAndCacheOnCPU(e,t){const r=this.texData.get(e),{dtype:o}=r;return t!=null&&(r.values=Tye(t,o)),r.values}acquireTexture(e,t,r,o){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,o)}computeBytes(e,t){return e[0]*e[1]*Vx(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const r=new Promise(o=>{try{this.checkCompletion_(t),o(!0)}catch(s){throw s}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await vF(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(gL(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:r,infLoc:o,nanLoc:s,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=wL(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=r,e.infLoc=o,e.nanLoc=s,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,r){e.channels=e.channels||"RGBA";const{texture:o,height:s,width:i,channels:a}=e,l=ja().backend;if(!l.gpgpu.gl.isTexture(o))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(o,t,r,s,i,a);return ja().makeTensorFromDataId(c,t,r,l)}}wy.nextDataId=0;function Tye(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */p$()&&v$("webgl",()=>new wy,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d8=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Rd{constructor(e,t,r){this.variableNames=["A","B"],this.outputShape=Ut(t,r),this.enableShapeUniforms=_o(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hd=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Gf{constructor(e,t,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ut(t,r);const s=this.outputShape.length;this.enableShapeUniforms=_o(s);let i="";if(o)if(s===0||De(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${Fn(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Ko("coords",s);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Rye={kernelName:l1,backendName:"webgl",kernelFunc:js};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cu(n){const{inputs:e,backend:t}=n,{real:r,imag:o}=e,s=t.makeTensorInfo(r.shape,"complex64"),i=t.texData.get(s.dataId),a=js({inputs:{x:r},backend:t}),l=js({inputs:{x:o},backend:t});return i.complexTensorInfos={real:a,imag:l},s}const Dye={kernelName:G5,backendName:"webgl",kernelFunc:Cu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _L="return (a < 0.) ? b * a : a;",$L=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Aye(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{alpha:s}=r,i=t.makeTensorInfo([],"float32",pu(s,"float32")),a=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Gf($L,o.shape,i.shape):new Rd(_L,o.shape,i.shape),l=t.runWebGLProgram(a,[o,i],"float32");return t.disposeIntermediateTensorInfo(i),l}const _ye={kernelName:m2,backendName:"webgl",kernelFunc:Aye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FL="return (a < 0.) ? b * a : a;",PL=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function $ye(n){const{inputs:e,backend:t}=n,{x:r,alpha:o}=e,s=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Gf(PL,r.shape,o.shape):new Rd(FL,r.shape,o.shape);return t.runWebGLProgram(s,[r,o],"float32")}const Fye={kernelName:F2,backendName:"webgl",kernelFunc:$ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qf="if (isnan(x)) return x;";function mn({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:r}){return({inputs:o,backend:s})=>{const{x:i}=o,a=s,l=r||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){const d=a.texData.get(i.dataId),h=t(d.values,l);return a.makeTensorInfo(i.shape,l,h)}const c=Ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new Gc(i.shape,e):u=new Za(i.shape,n),a.runWebGLProgram(u,[i],l)}}function go({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:s}){return({inputs:i,backend:a})=>{const{a:l,b:c}=i,u=a;if(r&&l.dtype==="complex64"){const g=u.texData.get(l.dataId),x=u.texData.get(c.dataId),[y,b]=[[g.complexTensorInfos.real,x.complexTensorInfos.real],[g.complexTensorInfos.imag,x.complexTensorInfos.imag]].map(S=>{const[k,N]=S,E={dataId:k.dataId,dtype:k.dtype,shape:l.shape},_={dataId:N.dataId,dtype:N.dtype,shape:c.shape},$=new Rd(n,l.shape,c.shape);return u.runWebGLProgram($,[E,_],Ls(k.dtype,N.dtype))}),C=Cu({inputs:{real:y,imag:b},backend:u});return u.disposeIntermediateTensorInfo(y),u.disposeIntermediateTensorInfo(b),C}const d=s||Ls(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&o!=null){const g=u.texData.get(l.dataId).values,x=u.texData.get(c.dataId).values,y=l.dtype==="string"?Jl(g):g,b=l.dtype==="string"?Jl(x):x,[C,S]=o(l.shape,c.shape,y,b,d),k=u.makeTensorInfo(S,d),N=u.texData.get(k.dataId);return N.values=C,k}const h=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return h?p=new Gf(e,l.shape,c.shape,t):p=new Rd(n,l.shape,c.shape),u.runWebGLProgram(p,[l,c],d)}}function Cm(n,e=!1){if(n==="linear")return e?mye:uye;if(n==="relu")return e?xye:hye;if(n==="elu")return e?gye:dye;if(n==="relu6")return e?vye:fye;if(n==="prelu")return e?PL:FL;if(n==="leakyrelu")return e?$L:_L;if(n==="sigmoid")return e?yye:pye;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ML{constructor(e,t,r,o=!1,s=!1,i=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=_o(this.outputShape.length);const u=o?e[1]:e[2],d=Math.ceil(u/2),h=o?"i * 2, rc.y":"rc.y, i * 2",p=s?"rc.z, i * 2":"i * 2, rc.z",g=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],x=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let y="",b="";a&&(l?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:y=`vec4 activation(vec4 x) {
          ${a}
        }`,b="result = activation(result);");const C=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let S="rc.x",k="rc.x";e[0]<t[0]?S=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(k=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${y}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${S};
        int batchB = ${k};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${g[0]} * ${x[0]});
          result += (${g[1]} * ${x[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${b}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g9={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class x9{constructor(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ut(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v9="return a * b;";function h8(n){const{inputs:e,backend:t}=n,{a:r,b:o}=e,s=Ls(r.dtype,o.dtype);if(r.dtype==="complex64"){const a=t.texData.get(r.dataId),l=t.texData.get(o.dataId),c=new x9(g9.REAL,r.shape,o.shape),u=new x9(g9.IMAG,r.shape,o.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],h=t.runWebGLProgram(c,d,"float32"),p=t.runWebGLProgram(u,d,"float32"),g=Cu({inputs:{real:h,imag:p},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),g}if(t.shouldExecuteOnCPU([r,o])){const a=t.texData.get(r.dataId),l=t.texData.get(o.dataId),[c,u]=$2e(r.shape,o.shape,a.values,l.values,s),d=t.makeTensorInfo(u,s),h=t.texData.get(d.dataId);return h.values=c,d}let i;return Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Gf(v9,r.shape,o.shape):i=new Rd(v9,r.shape,o.shape),t.runWebGLProgram(i,[r,o],s)}const Pye={kernelName:x1,backendName:"webgl",kernelFunc:h8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mye(n,e,t){const r=[Cf(n.shape),...kf(n.shape)],o={dtype:n.dtype,shape:r,dataId:n.dataId},s=[Cf(e),...kf(e)],i=new AL(s,r),a=!0,l=[r],c=t.runWebGLProgram(i,[o],n.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ze(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{shape:s}=r,i=t,a=De(o.shape),l=E_(s,a),c=De(l);K(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=i.texData.get(o.dataId);return u.isPacked&&!hv(o.shape,l)&&!(u.texture!==null&&hv(u.shape,l))?Mye(o,l,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}const Oye={kernelName:M2,backendName:"webgl",kernelFunc:Ze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y9{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:o,inSize:s,outSize:i}=e;this.outputShape=[o,i];const a=Math.floor(r/4)*4,l=r%4;let c="sumValue += dot(values, ones);";if(t!=null){const d=1/t;c=`sumValue += dot(values * ${ff(d)?d.toPrecision(2):d}, ones);`}let u="";s%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lye{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:o,inSize:s,outSize:i}=e;this.outputShape=[o,i];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");const u=Math.floor(r/4)*4,d=r%4;let h=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let g="";s%r>0&&(g=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bye(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],r=sy(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function Gd(n,e,t,r){const o=Bye(n.shape);let s=n;for(let i=0;i<o.length;i++){const{inSize:a,windowSize:l,outSize:c}=o[i];let u,d;t==="mean"?u=i===0?new y9({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},a):new y9({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c}):u=new Lye({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},t),d=s,s=r.runWebGLProgram(u,[s],e),d.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(d)}return s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jye{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let i=0;i<r.length;i++)r[i]=e[t[i]];this.outputShape=r,this.rank=r.length;const o=Fn(this.rank),s=Vye(t);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}}function Vye(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let o=0;o<n.length;o++)r[n[o]]=t[o];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zye{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let u=0;u<r.length;u++)r[u]=e[t[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const o=Fn(this.rank),s=DL("rc",this.rank),i=new Array(this.rank);for(let u=0;u<t.length;u++)i[t[u]]=s[u];const a=`vec2(${i.slice(-2).join()})`,l=`++${s[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cy(n,e,t){const r=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zye(n.shape,e):new jye(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wye(n,e,t,r){const o=e,s=n.shape.length,i=Qt(o,n.shape);let a=i;const l=sr(a,s),c=l!=null;let u=n;c&&(u=Cy(n,l,r),a=vr(a.length,s)),mo("sum",a,s);const[d,h]=to(u.shape,a);let p=d;t&&(p=Ir(d,i));const g=De(h),y=De(n.shape)/g,b=Ze({inputs:{x:u},attrs:{shape:[y,g]},backend:r}),C=I6(n.dtype),S=Gd(b,C,"sum",r),k=Ze({inputs:{x:S},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(S),c&&r.disposeIntermediateTensorInfo(u),k}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ky(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r;return Wye(o,s,i,t)}const Uye={kernelName:z2,backendName:"webgl",kernelFunc:ky};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jo(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{perm:s}=r,i=t,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[s[u]];let c;if(i.shouldExecuteOnCPU([o])){const d=i.texData.get(o.dataId).values,h=u8(d,o.shape,o.dtype,s,l);c=i.makeTensorInfo(l,o.dtype);const p=i.texData.get(c.dataId);p.values=h}else c=Cy(o,s,i);return c}const Hye={kernelName:nf,backendName:"webgl",kernelFunc:Jo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OL=1e3;function fv({a:n,b:e,transposeA:t,transposeB:r,backend:o,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const c=n.shape.length,u=e.shape.length,d=t?n.shape[c-2]:n.shape[c-1],h=r?e.shape[u-1]:e.shape[u-2],p=t?n.shape[c-1]:n.shape[c-2],g=r?e.shape[u-2]:e.shape[u-1],x=n.shape.slice(0,-2),y=e.shape.slice(0,-2),b=De(x),C=De(y),k=Ut(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,g]);K(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${r} must match.`);const N=t?[b,d,p]:[b,p,d],E=r?[C,g,h]:[C,h,g],_=Ze({inputs:{x:n},backend:o,attrs:{shape:N}}),$=Ze({inputs:{x:e},backend:o,attrs:{shape:E}}),T=[_,$],D=Math.max(b,C),A=t?_.shape[1]:_.shape[2],M=s!=null,j=i!=null,L=l==="leakyrelu",U=l!=null?Cm(l,!0):null,G=M||j||L||U!=null;let H;if((p===1||g===1)&&A>OL&&G===!1){let V=_,W=$;t&&(V=Jo({inputs:{x:_},backend:o,attrs:{perm:[0,2,1]}}),T.push(V)),r&&(W=Jo({inputs:{x:$},backend:o,attrs:{perm:[0,2,1]}}),T.push(W));const B=g!==1,q=g===1;let Q=V;B&&(Q=Ze({inputs:{x:V},backend:o,attrs:{shape:[D,A,1]}}),T.push(Q));const Z=g===1?2:1;let ne=W;q&&(ne=Ze({inputs:{x:W},backend:o,attrs:{shape:[D,1,A]}}),T.push(ne));const ge=h8({inputs:{a:Q,b:ne},backend:o});H=ky({inputs:{x:ge},backend:o,attrs:{axis:Z,keepDims:!0}}),T.push(ge)}else{const V=Ls(n.dtype,e.dtype),W=new ML(N,E,[D,p,g],t,r,M,U,j,L),B=[_,$];if(s!=null&&B.push(s),j&&B.push(i),L){const q=o.makeTensorInfo([],"float32",pu(a,"float32"));B.push(q),T.push(q)}H=o.runWebGLProgram(W,B,V)}const O=Ze({inputs:{x:H},backend:o,attrs:{shape:k}});T.push(H);for(const V of T)o.disposeIntermediateTensorInfo(V);return O}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gye(n){const{inputs:e,backend:t,attrs:r}=n,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return fv({a:o,b:s,transposeA:l,transposeB:c,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}const qye={kernelName:zx,backendName:"webgl",kernelFunc:Gye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b9="return abs(x);";function Kye(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const s=t.texData.get(r.dataId),i=TL(s.values);return t.makeTensorInfo(r.shape,r.dtype,i)}let o;return Ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Gc(r.shape,b9):o=new Za(r.shape,b9),t.runWebGLProgram(o,[r],r.dtype)}const Xye={kernelName:Xv,backendName:"webgl",kernelFunc:Kye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yye=Oi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Zye=mn({opSnippet:Yye}),Qye={kernelName:zm,backendName:"webgl",kernelFunc:Zye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jye=Oi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,ebe=mn({opSnippet:Jye}),tbe={kernelName:Wm,backendName:"webgl",kernelFunc:ebe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9="return a + b;",nbe=go({opSnippet:w9,packedOpSnippet:w9,supportsComplex:!0,cpuKernelImpl:h2e}),rbe={kernelName:Ff,backendName:"webgl",kernelFunc:nbe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class obe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((s,i)=>`T${i}`);const r=[];this.variableNames.forEach(s=>{r.push(`float v${s} = get${s}AtOutCoords();`)});const o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sbe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((s,i)=>`T${i}`);const r=[];this.variableNames.forEach(s=>{r.push(`vec4 v${s} = get${s}AtOutCoords();`)});const o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dx(n){const{inputs:e,backend:t}=n,r=e;if(r.length===1)return js({inputs:{x:r[0]},backend:t});if(r.length>Ce().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(r.length/2),c=dx({inputs:r.slice(0,l),backend:t}),u=dx({inputs:r.slice(l),backend:t});return dx({inputs:[c,u],backend:t})}const o=r.map(l=>l.dtype).reduce((l,c)=>Ls(l,c)),s=r.map(l=>l.shape),a=Ce().getBool("WEBGL_PACK")?new sbe(r[0].shape,s):new obe(r[0].shape,s);return t.runWebGLProgram(a,r,o)}const ibe={kernelName:B5,backendName:"webgl",kernelFunc:dx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function abe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r,a=o.shape.length,l=Qt(s,o.shape);let c=l;const u=sr(c,a);let d=o;u!=null&&(d=Jo({inputs:{x:o},backend:t,attrs:{perm:u}}),c=vr(c.length,a)),mo("all",c,a);const[h,p]=to(d.shape,c),g=De(p),x=Ze({inputs:{x:d},backend:t,attrs:{shape:[-1,g]}}),y=Gd(x,x.dtype,"all",t);let b;if(i){const C=Ir(h,l);b=Ze({inputs:{x:y},backend:t,attrs:{shape:C}})}else b=Ze({inputs:{x:y},backend:t,attrs:{shape:h}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),u!=null&&t.disposeIntermediateTensorInfo(d),b}const lbe={kernelName:j5,backendName:"webgl",kernelFunc:abe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r,a=o.shape.length,l=Qt(s,o.shape);let c=l;const u=sr(c,a);let d=o;u!=null&&(d=Jo({inputs:{x:o},backend:t,attrs:{perm:u}}),c=vr(c.length,a)),mo("any",c,a);const[h,p]=to(d.shape,c),g=De(p),x=Ze({inputs:{x:d},backend:t,attrs:{shape:[-1,g]}}),y=Gd(x,x.dtype,"any",t);let b;if(i){const C=Ir(h,l);b=Ze({inputs:{x:y},backend:t,attrs:{shape:C}})}else b=Ze({inputs:{x:y},backend:t,attrs:{shape:h}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),u!=null&&t.disposeIntermediateTensorInfo(d),b}const ube={kernelName:V5,backendName:"webgl",kernelFunc:cbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dbe{constructor(e,t,r){this.variableNames=["A"];const{windowSize:o,batchSize:s,outSize:i}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[s,i];const a=t==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hbe{constructor(e,t,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,K(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const s=e[e.length-1],i=Math.ceil(s/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=Fn(l),u=Ko("coords",l);let d,h;if(i===1){h=l+1;const $=Fn(h);d=`
        ${$} sourceLocR = ${$}(${u.join()}, 0);
        ++${u[l-1]};
        ${$} sourceLocG = ${$}(${u.join()}, 0);
        ++${u[l-2]};
        ${$} sourceLocA = ${$}(${u.join()}, 0);
        --${u[l-1]};
        ${$} sourceLocB = ${$}(${u.join()}, 0);
        --${u[l-2]};`}else h=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,h),g="."+p[h-1],x=p.map($=>"int "+$),y=Ko("sourceLocR",h-1).concat("inIdx.r"),b=Ko("sourceLocG",h-1).concat("inIdx.g"),C=Ko("sourceLocB",h-1).concat("inIdx.b"),S=Ko("sourceLocA",h-1).concat("inIdx.a"),k=r==="max"?"greaterThan":"lessThan",N=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${S.join()})));`,E=`vec4(
            getAChannel(${y.join()}),
            hasNextCol ? getAChannel(${b.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,_=o?"":`
      float getBestIndicesAChannel(${x.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${x.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${_}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${g}, sourceLocG${g},
          sourceLocB${g}, sourceLocA${g}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${E};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${N}
          vec4 candidate = ${E};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${k}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LL(n,e,t,r=null){let o=e.shape[0],s=e.shape[1];r!=null&&(o=r.shape[0],s=r.shape[1]);const i=sy(s),a={windowSize:i,inSize:s,batchSize:o,outSize:Math.ceil(s/i)},l=new dbe(a,t,r==null),c=[e];r!=null&&c.push(r);const u=n.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const d=LL(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}function BL(n,e,t,r=null){const o=r!=null?r.shape:e.shape,s=o[o.length-1],i=sy(s),a=new hbe(o,i,t,r==null),l=r==null?[e]:[e,r],c=n.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=BL(n,e,t,c);return n.disposeIntermediateTensorInfo(c),u}return c}function jL(n,e,t,r){const o=[t];if(mo("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,e.shape.length),!Ce().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const s=[],i=n.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=n.unpackTensor(e),s.push(l));const[c,u]=to(l.shape,o),d=De(u),h=Ze({inputs:{x:l},backend:n,attrs:{shape:[-1,d]}});s.push(h);const p=LL(n,h,r);s.push(p);const g=Ze({inputs:{x:p},backend:n,attrs:{shape:c}});return s.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}return BL(n,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s}=r;let i=Qt(s,o.shape);const a=sr(i,o.shape.length);let l=o;const c=[];a!=null&&(l=Jo({inputs:{x:o},backend:t,attrs:{perm:a}}),c.push(l),i=vr(i.length,l.shape.length)),mo("argMax",[i[0]],l.shape.length);const u=jL(t,l,i[0],"max");return c.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const pbe={kernelName:Yv,backendName:"webgl",kernelFunc:fbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s}=r;let i=Qt(s,o.shape);const a=sr(i,o.shape.length);let l=o;const c=[];a!=null&&(l=Jo({inputs:{x:o},backend:t,attrs:{perm:a}}),c.push(l),i=vr(i.length,l.shape.length)),mo("argMin",[i[0]],l.shape.length);const u=jL(t,l,i[0],"min");return c.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const gbe={kernelName:Zv,backendName:"webgl",kernelFunc:mbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xbe=Oi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,vbe=mn({opSnippet:xbe}),ybe={kernelName:Um,backendName:"webgl",kernelFunc:vbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bbe=Oi+"return log(x + sqrt(x * x + 1.0));",wbe=mn({opSnippet:bbe}),Cbe={kernelName:Hm,backendName:"webgl",kernelFunc:wbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kbe=Oi+`
  return atan(x);
`,Sbe=mn({opSnippet:kbe}),Nbe={kernelName:Gm,backendName:"webgl",kernelFunc:Sbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ibe=d8+`
  return atan(a, b);
`,Ebe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Hd+`
  return result;
`,Tbe=go({opSnippet:Ibe,packedOpSnippet:Ebe}),Rbe={kernelName:Km,backendName:"webgl",kernelFunc:Tbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dbe=Oi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Abe=mn({opSnippet:Dbe}),_be={kernelName:qm,backendName:"webgl",kernelFunc:Abe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class km{constructor(e,t,r,o=!1,s=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;const x=t==="avg",y=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,b=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let C="0.0";if(x||(C="-1.0 / 1e-20"),r){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${p}, ${g});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?s?y:b:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let k=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(k="avgValue / max(count, 1.0)");const N=Math.floor(i/4)*4,E=i%4,_=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${p}, ${g});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${N}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${_}
          }

          int xC = xCCorner + ${N};
          if (${E===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${_}
          } else if (${E===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${_}
          } else if (${E===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${_}
          }
        }
        setOutput(${k});
      }
    `}}class f8{constructor(e,t,r,o=!1,s=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,g=e.effectiveFilterHeight,x=e.effectiveFilterWidth,y=e.padInfo.front,b=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const S=t==="avg";let k="0.0";if(S||(k="-1.0 / 1e-20"),r){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${y}, ${b}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${g};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${x};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?s?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${g} * ${x} +
                      wR * ${x} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let E=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(E="avgValue / max(count, 1.0)");const _=Math.floor(i/4)*4,$=i%4,T=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${y}, ${b}, ${C});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${_}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${T}
            }

            int xC = xCCorner + ${_};
            if (${$===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${T}
            } else if (${$===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${T}
            } else if (${$===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${T}
            }
          }
        }
        setOutput(${E});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $be(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e;tg(o,"avgPool");const{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=r,c=1;K(Do(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Pi(o.shape,s,i,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&In(u.inShape,u.outShape))return js({inputs:{x:o},backend:t});const d=new km(u,"avg",!1);return t.runWebGLProgram(d,[o],"float32")}const Fbe={kernelName:Qv,backendName:"webgl",kernelFunc:$be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],d=ac(o.shape,s,i,u,a,l,c),h=new f8(d,"avg",!1);return t.runWebGLProgram(h,[o],"float32")}const Mbe={kernelName:Jv,backendName:"webgl",kernelFunc:Pbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Obe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,h=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Lbe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=d-1-e.padInfo.front,x=h-1-e.padInfo.top,y=p-1-e.padInfo.left,b=1/(t*r*o);this.userCode=`
      const ivec3 pads = ivec3(${g}, ${x}, ${y});
      const float avgMultiplier = float(${b});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bbe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,input:s}=e,i=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],h=ac(i.shape,a,l,d,c,u),p=new Lbe(h);return t.runWebGLProgram(p,[o],i.dtype)}const jbe={kernelName:W5,backendName:"webgl",kernelFunc:Bbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vbe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,input:s}=e,i=s;tg([o,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=Pi(i.shape,a,l,1,c),d=new Obe(u);return t.runWebGLProgram(d,[o],i.dtype)}const zbe={kernelName:z5,backendName:"webgl",kernelFunc:Vbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wbe(n){const{inputs:e,backend:t,attrs:r}=n,{a:o,b:s}=e,{transposeA:i,transposeB:a}=r;return fv({a:o,b:s,transposeA:i,transposeB:a,backend:t})}const Ube={kernelName:e2,backendName:"webgl",kernelFunc:Wbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hbe{constructor(e,t,r,o,s,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ut(e,t),Ut(e,r);let a="0.0";o!=null&&(Ut(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";s!=null&&(Ut(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gbe{constructor(e,t,r,o,s,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ut(e,t),Ut(e,r);let a="vec4(0.0)";o!=null&&(Ut(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";s!=null&&(Ut(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qbe=({inputs:n,backend:e,attrs:t})=>{const{x:r,mean:o,variance:s,offset:i,scale:a}=n;K(o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),K(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),K(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const c=[r,o,s];let u=null;i!=null&&(u=i.shape,c.push(i));let d=null;a!=null&&(d=a.shape,c.push(a));const h=Ce().getBool("WEBGL_PACK_NORMALIZATION")?new Gbe(r.shape,o.shape,s.shape,u,d,l):new Hbe(r.shape,o.shape,s.shape,u,d,l);return e.runWebGLProgram(h,c,c[0].dtype)},Kbe={kernelName:h2,backendName:"webgl",kernelFunc:qbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xbe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Fn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=Ybe(this.rank);let o;const s=e.map((i,a)=>`sourceLoc.${n4[a]} = start[${a}] + coords.${n4[a]};`);o=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${r}));
      }
    `}}const n4=["x","y","z","w","u","v"];function Ybe(n){if(n===1)return"sourceLoc";if(n<=6)return n4.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zbe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Fn(this.rank),r=Ko("coords",this.rank),o=Ko("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${s})`,a=`
      result.x = ${i};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((u,d)=>`start[${d}]`).join()});`:e.map((u,d)=>`${o[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qbe(n,e,t,r){const o=r.texData.get(n.dataId),s=r.makeTensorInfo(t,n.dtype),i=r.texData.get(s.dataId);Object.assign(i,o),i.refCount=1,i.shape=t,i.dtype=n.dtype;let a=lk(e,Nt(n.shape));o.slice&&(a+=o.slice.flatOffset),i.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||n.dataId};const l=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,l+1),s}function Kf(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{begin:s,size:i}=r,[a,l]=oy(o,s,i);if(sk(o,a,l),De(l)===0)return t.makeTensorInfo(l,o.dtype,[]);if(t.shouldExecuteOnCPU([o])||o.dtype==="string"){const d=t.texData.get(o.dataId),h=U2e(d.values,a,l,o.shape,o.dtype);return t.makeTensorInfo(l,o.dtype,h)}const{isPacked:c}=t.texData.get(o.dataId),u=ak(o.shape,a,l);if(c||!u){const d=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Zbe(l):new Xbe(l),h=[a];return t.runWebGLProgram(d,[o],o.dtype,h)}return t.uploadToGPU(o.dataId),Qbe(o,a,l,t)}const Jbe={kernelName:V2,backendName:"webgl",kernelFunc:Kf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ewe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{blockShape:s,crops:i}=r;K(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((C,S)=>C*S),l=z1(o.shape,s,a),c=W1(l.length,s.length),u=U1(o.shape,s,a),d=fk(i,s.length),h=pk(u,i,s.length),p=[],g=Ze({inputs:{x:o},backend:t,attrs:{shape:l}}),x=Jo({inputs:{x:g},backend:t,attrs:{perm:c}}),y=Ze({inputs:{x},backend:t,attrs:{shape:u}}),b=Kf({inputs:{x:y},backend:t,attrs:{begin:d,size:h}});return p.push(g),p.push(x),p.push(y),p.forEach(C=>t.disposeIntermediateTensorInfo(C)),b},twe={kernelName:t2,backendName:"webgl",kernelFunc:ewe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nwe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,weights:s}=e,{size:i}=r,a=t.readSync(o.dataId),l=t.readSync(s.dataId),c=EL(a,l,s.dtype,s.shape,i);return t.makeTensorInfo([i],s.dtype,c)}const rwe={kernelName:U5,backendName:"webgl",kernelFunc:nwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const owe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,swe=`
  return float(int(a.r) & int(b.r));
`;function iwe(n){const{inputs:e,backend:t}=n,{a:r,b:o}=e,s=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=Ce().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([r,o])||i===1){const l=t.texData.get(r.dataId).values,c=t.texData.get(o.dataId).values,[u,d]=p2e(r.shape,o.shape,l,c,r.dtype),h=t.makeTensorInfo(d,r.dtype),p=t.texData.get(h.dataId);return p.values=u,h}let a;return s?a=new Gf(owe,r.shape,o.shape,!1):a=new Rd(swe,r.shape,o.shape),t.runWebGLProgram(a,[r,o],r.dtype)}const awe={kernelName:H5,backendName:"webgl",kernelFunc:iwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lwe(n){const{inputs:e,backend:t}=n,{s0:r,s1:o}=e,s=t.readSync(r.dataId),i=t.readSync(o.dataId),a=Ut(Array.from(s),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const cwe={kernelName:$_,backendName:"webgl",kernelFunc:lwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uwe="return float(a != b);",VL=go({opSnippet:uwe,cpuKernelImpl:P2e,dtype:"bool"}),dwe={kernelName:R2,backendName:"webgl",kernelFunc:VL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rg(n){const{inputs:e,backend:t}=n,{input:r}=e,o=t.texData.get(r.dataId);return js({inputs:{x:o.complexTensorInfos.real},backend:t})}const hwe={kernelName:g6,backendName:"webgl",kernelFunc:rg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fwe="return float(int(x));";function pwe(n,e){const t=new Za(n.shape,fwe),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r4(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{dtype:s}=r;if(s==="complex64"){if(o.dtype==="complex64")return js({inputs:{x:o},backend:t});const i=qr(o.shape),a=r4({inputs:{x:o},backend:t,attrs:{dtype:"float32"}}),l=Cu({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){const i=rg({inputs:{input:o},backend:t}),a=r4({inputs:{x:i},backend:t,attrs:{dtype:s}});return t.disposeIntermediateTensorInfo(i),a}if(!T_(o.dtype,s)){const i=js({inputs:{x:o},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(t.shouldExecuteOnCPU([o])){const i=t.texData.get(o.dataId).values,[a,l,c]=m2e(i,o.shape,o.dtype,s);return t.makeTensorInfo(a,l,c)}if(s==="int32")return pwe(o,t);if(s==="bool"){const i=t.makeTensorInfo([],"bool",Eo("bool",1)),l=VL({inputs:{a:o,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}const mwe={kernelName:Xm,backendName:"webgl",kernelFunc:r4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C9="return ceil(x);",gwe=mn({opSnippet:C9,packedOpSnippet:C9,cpuKernelImpl:g2e}),xwe={kernelName:Ym,backendName:"webgl",kernelFunc:gwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vwe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ywe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bwe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{clipValueMin:s,clipValueMax:i}=r;let a;Ce().getBool("WEBGL_PACK_CLIP")?a=new ywe(o.shape):a=new vwe(o.shape);const l=[[s],[i]];return t.runWebGLProgram(a,[o],o.dtype,l)}const wwe={kernelName:Zm,backendName:"webgl",kernelFunc:bwe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cwe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k9(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function kwe(n){const{inputs:e,backend:t}=n,{x:r}=e,o=t.texData.get(r.dataId),s=new Cwe(r.shape),i=[k9(r,o.complexTensorInfos.real),k9(r,o.complexTensorInfos.imag)];return t.runWebGLProgram(s,i,i[0].dtype)}const Swe={kernelName:n2,backendName:"webgl",kernelFunc:kwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nwe{constructor(e){this.outputShape=[],this.outputShape=ol(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const r=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const a=t[i-1];r.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const o=t.length,s=t[t.length-1];r.push(`else setOutput(getT${o}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iwe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ol(e,t);const r=this.outputShape,o=r.length,s=Fn(o),i=Ko("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=e.map((x,y)=>`T${y}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let x=1;x<l.length;x++)l[x]=l[x-1]+e[x][t];const c=a[t],u=a.slice(-2),d=a.join();let h=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let x=1;x<l.length;x++){const y=l[x-1];h+=`
        if (${c} < ${l[x]}  && ${c} >= ${l[x-1]}) {
          return getChannel(
            getT${x}(${K0(a,c,y)}),
            vec2(${K0(u,c,y)}));
        }`}const p=l.length,g=l[l.length-1];h+=`
        return getChannel(
          getT${p}(${K0(a,c,g)}),
          vec2(${K0(u,c,g)}));`,this.userCode=`
      float getValue(${a.map(x=>"int "+x)}) {
        ${h}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${r[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${r[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${r[o-2]} &&
            ${i[o-1]} < ${r[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function K0(n,e,t){const r=n.indexOf(e);return n.map((s,i)=>i===r?`${s} - ${t}`:s).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sy(n){const{inputs:e,backend:t}=n,{input:r}=e,o=t.texData.get(r.dataId);return js({inputs:{x:o.complexTensorInfos.imag},backend:t})}const Ewe={kernelName:l6,backendName:"webgl",kernelFunc:Sy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hp(n,e,t){const r=n[0].dtype;if(r==="complex64"){const p=n.map(C=>rg({inputs:{input:C},backend:t})),g=n.map(C=>Sy({inputs:{input:C},backend:t})),x=Hp(p,e,t),y=Hp(g,e,t),b=Cu({inputs:{real:x,imag:y},backend:t});return p.forEach(C=>t.disposeIntermediateTensorInfo(C)),g.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}let o=t.shouldExecuteOnCPU(n);if(r==="string"&&(o=!0),o){const p=n.map(k=>{const E=[-1,De(k.shape.slice(e))];return Ze({inputs:{x:k},backend:t,attrs:{shape:E}})}),g=p.map(k=>({vals:t.readSync(k.dataId),shape:k.shape})),x=ol(p.map(k=>k.shape),1),y=p[0].shape[0]===1,b=x2e(g,x,r,y),C=ol(n.map(k=>k.shape),e),S=t.makeTensorInfo(C,r,b);return p.forEach(k=>t.disposeIntermediateTensorInfo(k)),S}const s=n.filter(p=>De(p.shape)>0),i=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){const p=i?new Za(n[0].shape,Bc):new Gc(n[0].shape,Bc);return t.runWebGLProgram(p,n,r)}const a=Ce().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){const p=[];for(let x=0;x<s.length;x+=a){const y=s.slice(x,x+a);p.push(Hp(y,e,t))}const g=Hp(p,e,t);for(const x of p)t.disposeIntermediateTensorInfo(x);return g}if(i){const p=new Iwe(s.map(g=>g.shape),e);return t.runWebGLProgram(p,s,r)}const{tensors2D:l,outShape:c}=Twe(s,e,t),u=new Nwe(l.map(p=>p.shape)),d=t.runWebGLProgram(u,l,r);l.forEach(p=>t.disposeIntermediateTensorInfo(p));const h=Ze({inputs:{x:d},attrs:{shape:c},backend:t});return t.disposeIntermediateTensorInfo(d),h}function Twe(n,e,t){const r=ol(n.map(s=>s.shape),e);return{tensors2D:n.map(s=>Ze({inputs:{x:s},attrs:{shape:[-1,De(s.shape.slice(e))]},backend:t})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(n){const{inputs:e,backend:t,attrs:r}=n,{axis:o}=r,s=Qt(o,e[0].shape)[0],i=e.map(c=>c.shape);uk(i,s);const a=ol(e.map(c=>c.shape),s);if(De(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>De(c.shape)>0);return l.length===1?js({inputs:{x:l[0]},backend:t}):Hp(l,s,t)}const Rwe={kernelName:r2,backendName:"webgl",kernelFunc:zL};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WL{constructor(e,t=!1,r=null,o=!1,s=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,g=Math.floor(e.inChannels/4)*4,x=e.inChannels%4,y=e.dataFormat==="channelsLast",b=y?1:2,C=y?2:3,S=y?3:1;let k="",N="";r&&(o?k=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?k=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:k=`
          float activation(float x) {
            ${r}
          }
        `,N="result = activation(result);");const E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${k}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${b}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${g}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${y}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${x===1}) {

              if (${y}) {
                dotProd +=
                    getX(batch, xR, xC, ${g}) *
                    getW(wR, wC, ${g}, d2);
              } else {
                dotProd +=
                    getX(batch, ${g}, xR, xC) *
                    getW(wR, wC, ${g}, d2);
              }

            } else if (${x===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2)
              );

              if (${y}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${x===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2),
                getW(wR, wC, ${g} + 2, d2)
              );

              if (${y}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1),
                  getX(batch, xR, xC, ${g} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC),
                  getX(batch, ${g} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${E}
        ${N}
        setOutput(result);
      }
    `}}class Dwe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,r=e.padInfo.top,o=e.padInfo.left,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,p=e.filterWidth,g=Math.floor(e.inChannels/4)*4,x=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${g}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${x===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${g}) *
                  getW(wF, wR, wC, ${g}, d2);
              } else if (${x===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${x===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1),
                  getX(batch, xF, xR, xC, ${g} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2),
                  getW(wF, wR, wC, ${g} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UL{constructor(e,t=!1,r=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=_o(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<u;y++)h+=`
           vec4 xTexelC${y*2};
           int xTexelC${y*2}Ready;
           vec4 xTexelC${y*2+1};
           int xTexelC${y*2+1}Ready;
           vec4 xC${y};`;h+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let y=0;y<u;y++)h+=`
           xTexelC${y*2} = vec4(0.0);
           xTexelC${y*2}Ready = 0;
           xTexelC${y*2+1} = vec4(0.0);
           xTexelC${y*2+1}Ready = 0;
           xC${y} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let y=0;y<(d+1)/2;y++){const b=y*2;if(h+=`
           xC = xCCorner + ${b*l};
           `,a===1){if(b<u&&(i%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }
               `,l===1&&b>0?h+=`
                 xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                   } else {
                     xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xC${b} = xTexelC${b};
                 `,b+1<u)){const C=i%2===0?F5(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                     xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${b+1}.zw = vec2(0.0);
                     }
                     xTexelC${b+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                     } else {
                      xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                     }
                     `:h+=`
                     xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                     `):C===1?h+=`
                     xC${b+1} = xTexelC${b};
                     `:h+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                       xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${b+1}.zw = vec2(0.0);
                       }
                       xTexelC${b+1}Ready = 1;
                     }

                     xC${b+1} = xTexelC${b+1};
                     `}}else b<u&&(i%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.0);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
               `,b+1<u&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(
                   xTexelC${b}.xy, xTexelC${b+1}.xy);
               `,b+1<u&&(h+=`
                   xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                 `)));b<u&&(h+=`
             wTexel = getW(r, ${b}, d1, d2);
             dotProd += xC${b}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${b}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,b+1<u&&(h+=`
               wTexel = getW(r, ${b+1}, d1, d2);
               dotProd += xC${b+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${b+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let p="",g="";r&&(o?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:s?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:p=`vec4 activation(vec4 x) {
           ${r}
         }`,g="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${x}
         ${g}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Awe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=_o(this.outputShape.length);const{dataFormat:r}=t,o=es(),s=r==="channelsLast",i=s?1:2,a=s?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${o.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pv(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function HL({x:n,filter:e,convInfo:t,backend:r,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){const l=n.shape,c=r.texData.get(n.dataId),u=t.inChannels,d=l[0]*l[1]*l[2],h=t.outChannels,p=t.dataFormat==="channelsLast",g=!1,x=!1;let y;const b=[];if(s!=null){const k=pv(s.shape,p);k!=null&&(s=Ze({inputs:{x:s},backend:r,attrs:{shape:k}}),b.push(s))}if(o!=null){const k=pv(o.shape,p);k!=null&&(o=Ze({inputs:{x:o},backend:r,attrs:{shape:k}}),b.push(o))}if(!((d===1||h===1)&&u>OL)&&c.isPacked&&p&&c.texture!=null&&l[2]%2!==0&&In(c.shape.slice(-3),l.slice(-3))){const k=l[0]*l[1]*(l[2]+1),N={dataId:n.dataId,shape:[1,k,t.inChannels],dtype:n.dtype},E=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,K(hv(c.shape,N.shape),()=>`packed reshape ${c.shape} to ${N.shape} isn't free`);const _=Ze({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}});b.push(_);const $=fv({a:N,b:_,backend:r,transposeA:g,transposeB:x,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i}),T=r.texData.get($.dataId);K(T.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=E,T.shape=t.outShape,y=js({inputs:{x:$},backend:r}),y.shape=t.outShape,b.push($)}else{const k=t.outHeight*t.outWidth,N=Ze({inputs:{x:n},backend:r,attrs:{shape:p?[t.batchSize,k,t.inChannels]:[t.batchSize,t.inChannels,k]}}),E=Ze({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}}),_=fv({a:p?N:E,b:p?E:N,transposeA:!p,transposeB:x,backend:r,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i});y=Ze({inputs:{x:_},backend:r,attrs:{shape:t.outShape}}),b.push(N),b.push(E),b.push(_)}for(const k of b)r.disposeIntermediateTensorInfo(k);return y}function GL({x:n,filter:e,convInfo:t,backend:r,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:h,dataFormat:p}=t,g=p==="channelsLast",x=l*c*u,y=h*d,b=[t.batchSize,x,y],C=!0,S=!1,k=[];if(s!=null){const O=pv(s.shape,g);O!=null&&(s=Ze({inputs:{x:s},backend:r,attrs:{shape:O}}),k.push(s))}if(o!=null){const O=pv(o.shape,g);O!=null&&(o=Ze({inputs:{x:o},backend:r,attrs:{shape:O}}),k.push(o))}const N=Ze({inputs:{x:e},backend:r,attrs:{shape:[1,x,De(e.shape)/x]}});k.push(N);const E=new Awe(b,t),_=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],$=r.runWebGLProgram(E,[n],"float32",_),T=Ze({inputs:{x:$},backend:r,attrs:{shape:b}});k.push($),k.push(T);const D=o!=null,A=s!=null,M=a==="leakyrelu",j=a?Cm(a,!0):null,L=new ML(g?T.shape:N.shape,g?N.shape:T.shape,g?[t.batchSize,y,t.outChannels]:[t.batchSize,t.outChannels,y],C,S,D,j,A,M),U=g?[T,N]:[N,T];if(o&&U.push(o),A&&U.push(s),M){const O=r.makeTensorInfo([],"float32",pu(i,"float32"));U.push(O),k.push(O)}const G=r.runWebGLProgram(L,U,"float32"),H=Ze({inputs:{x:G},backend:r,attrs:{shape:t.outShape}});k.push(G);for(const O of k)r.disposeIntermediateTensorInfo(O);return H}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _we(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=lc(l),h=po(o.shape,s.shape,i,c,a,u,!1,d);let p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=HL({x:o,filter:s,convInfo:h,backend:t});else if(h.strideWidth<=2&&d==="channelsLast"&&Ce().getBool("WEBGL_EXP_CONV")){const x=new UL(h),y=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=t.runWebGLProgram(x,[o,s],"float32",y)}else if(Ce().getBool("WEBGL_CONV_IM2COL"))p=GL({x:o,filter:s,convInfo:h,backend:t});else{const x=new WL(h);p=t.runWebGLProgram(x,[o,s],"float32")}const g=Ze({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),g}const $we={kernelName:o2,backendName:"webgl",kernelFunc:_we};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fwe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,o=e.padInfo.top,s=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Pwe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=r-1-e.padInfo.left,c=i?1:2,u=i?2:3,d=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Mwe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,r=e.strideHeight,o=e.strideWidth,s=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${s};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Owe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,c=r-1-e.padInfo.top,u=o-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lwe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=lc(l),h=po(o.shape,u,i,1,a,c,!1,d),p=new Fwe(h);return t.runWebGLProgram(p,[o,s],"float32")}const Bwe={kernelName:q5,backendName:"webgl",kernelFunc:Lwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jwe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=_o(this.outputShape.length);const t=e.filterHeight,r=e.filterWidth,o=t-1-e.padInfo.top,s=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vwe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=lc(c),h=po(i,s.shape,a,1,l,u,!1,d);if(Ce().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const p=[[h.strideHeight,h.strideWidth]],g=new jwe(h);return t.runWebGLProgram(g,[o,s],"float32",p)}else{const p=new Pwe(h);return t.runWebGLProgram(p,[o,s],"float32")}}const zwe={kernelName:s2,backendName:"webgl",kernelFunc:Vwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wwe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=r,c=mu(o.shape,s.shape,i,l,a),u=new Dwe(c);return t.runWebGLProgram(u,[o,s],"float32")}const Uwe={kernelName:i2,backendName:"webgl",kernelFunc:Wwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hwe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:l}=r,c=mu(o.shape,l,i,1,a),u=new Mwe(c);return t.runWebGLProgram(u,[o,s],"float32")}const Gwe={kernelName:K5,backendName:"webgl",kernelFunc:Hwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qwe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,filter:s}=e,{pad:i,strides:a,inputShape:l}=r,c=mu(l,s.shape,a,1,i),u=new Owe(c);return t.runWebGLProgram(u,[o,s],"float32")}const Kwe={kernelName:X5,backendName:"webgl",kernelFunc:qwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xwe=qf+`
  return cos(x);
`,Ywe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Hd}
  return result;
`,Zwe=mn({opSnippet:Xwe,packedOpSnippet:Ywe}),Qwe={kernelName:Qm,backendName:"webgl",kernelFunc:Zwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jwe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,e3e=mn({opSnippet:Jwe}),t3e={kernelName:Jm,backendName:"webgl",kernelFunc:e3e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n3e{constructor(e,t,r,o,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,c]=e,[u]=t,[d,h]=r;this.outputShape=[u,d,h,c];const p=o==="bilinear"?1:0,[g,x]=[`${a-1}.0`,`${l-1}.0`],[y,b,C]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${g} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${g}`],[S,k,N]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${x} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${x}`];this.userCode=`
      const float height_ratio = float(${y});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${b};
        float width_scale = ${k};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${g} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${N};
        if( in_x < 0.0 || in_x > ${x} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r3e=n=>{const{inputs:e,backend:t,attrs:r}=n,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:c}=r,u=new n3e(o.shape,s.shape,a,l,c);return t.runWebGLProgram(u,[o,s,i],"float32")},o3e={kernelName:Z5,backendName:"webgl",kernelFunc:r3e};var Sm;(function(n){n.Prod="*",n.Sum="+"})(Sm||(Sm={}));class S9{constructor(e,t,r,o){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const s=this.outputShape.length,i=this.op===Sm.Prod?"1.0":"0.0",a=r?i:`getX(${N9(s,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";r?(c=o?`end != ${l-1}`:"end != 0",u=o?"end + 1":"end - 1"):(c=o?`end + pow2 < ${l}`:"end >= pow2",u=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Fn(s)} coords = getOutputCoords();
        int end = ${I9(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${I9(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${N9(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function N9(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function I9(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(n,e,t,r,o,s){const i=e.shape.length,a=sr([r],i);let l=e;a!=null&&(l=Jo({inputs:{x:e},backend:t,attrs:{perm:a}}));const c=vr(1,i)[0];if(c!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const u=l.shape[c];let d=js({inputs:{x:l},backend:t});for(let h=0;h<=Math.ceil(Math.log2(u))-1;h++){const p=new S9(n,l.shape,!1,s),g=[[h]],x=d;d=t.runWebGLProgram(p,[d],d.dtype,g),t.disposeIntermediateTensorInfo(x)}if(o){const h=new S9(n,l.shape,o,s),p=d;d=t.runWebGLProgram(h,[d],d.dtype),t.disposeIntermediateTensorInfo(p)}if(a!=null){const h=gu(a),p=Jo({inputs:{x:d},backend:t,attrs:{perm:h}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(l),p}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,exclusive:i,reverse:a}=r;return qL(Sm.Prod,o,t,s,i,a)}const i3e={kernelName:Y5,backendName:"webgl",kernelFunc:s3e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,exclusive:i,reverse:a}=r;return qL(Sm.Sum,o,t,s,i,a)}const l3e={kernelName:a2,backendName:"webgl",kernelFunc:a3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,weights:s}=e,{size:i,binaryOutput:a}=r;if(o.shape.length===1){const l=t.readSync(o.dataId),c=t.readSync(s.dataId),u=EL(l,c,s.dtype,s.shape,i);return t.makeTensorInfo([i],s.dtype,u)}else if(o.shape.length===2){const l=t.bufferSync(o),c=t.bufferSync(s),u=f2e(l,c,i,a);return t.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const u3e={kernelName:Q5,backendName:"webgl",kernelFunc:c3e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d3e{constructor(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{blockSize:s,dataFormat:i}=r,a=o.shape[0],l=i==="NHWC"?o.shape[1]:o.shape[2],c=i==="NHWC"?o.shape[2]:o.shape[3],u=i==="NHWC"?o.shape[3]:o.shape[1],d=l*s,h=c*s,p=u/(s*s),g=i==="NHWC"?[a,d,h,p]:[a,p,d,h],x=new d3e(g,s,i);return t.runWebGLProgram(x,[o],o.dtype)}const f3e={kernelName:J5,backendName:"webgl",kernelFunc:h3e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KL{constructor(e,t=!1,r=null,o=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=_o(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";r&&(o?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:c=`
          float activation(float x) {
            ${r}
          }
        `,u="result = activation(result);");const d=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XL{constructor(e,t=!1,r=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=_o(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,h=d;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<d;b++)p+=`
          vec4 xTexelC${b*2};
          int xTexelC${b*2}Ready;
          vec4 xTexelC${b*2+1};
          int xTexelC${b*2+1}Ready;
          vec4 xC${b};`;p+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let b=0;b<d;b++)p+=`
          xTexelC${b*2} = vec4(0.0);
          xTexelC${b*2}Ready = 0;
          xTexelC${b*2+1} = vec4(0.0);
          xTexelC${b*2+1}Ready = 0;
          xC${b} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let b=0;b<(h+1)/2;b++){const C=b*2;if(p+=`
          xC = xCCorner + ${C*c};
          `,l===1){if(C<d&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,c===1&&C>0?p+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<d)){const S=a%2===0?F5(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${S};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:p+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):S===1?p+=`
                    xC${C+1} = xTexelC${C};
                    `:p+=`
                    xCOffset = xC + ${S};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<d&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<d&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<d&&(p+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<d&&(p+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<d&&(p+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let g="",x="";r&&(o?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:g=`vec4 activation(vec4 x) {
          ${r}
        }`,x="result = activation(result);");const y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${g}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${y}
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:c}=r;let u=l;u==null&&(u=[1,1]),K(Do(i,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=po(o.shape,s.shape,i,u,a,c,!0);let h;Ce().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?h=new XL(d):h=new KL(d);const p=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return t.runWebGLProgram(h,[o,s],"float32",p)}const m3e={kernelName:l2,backendName:"webgl",kernelFunc:p3e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g3e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,o=e.padInfo.top,s=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class x3e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=t-1-e.padInfo.top,a=r-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,dy:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=po(o.shape,u,i,a,l,c,!0),h=new g3e(d);return t.runWebGLProgram(h,[o,s],"float32")}const y3e={kernelName:e6,backendName:"webgl",kernelFunc:v3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b3e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=po(u,s.shape,i,a,l,c,!0),h=new x3e(d);return t.runWebGLProgram(h,[o,s],"float32")}const w3e={kernelName:t6,backendName:"webgl",kernelFunc:b3e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C3e{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k3e(n){const{inputs:e,backend:t}=n,{x:r}=e,o=[...r.shape,...r.shape],s=De(r.shape),i=Ze({inputs:{x:r},backend:t,attrs:{shape:[s]}}),a=new C3e(s),l=t.runWebGLProgram(a,[i],i.dtype),c=Ze({inputs:{x:l},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),c}const S3e={kernelName:F_,backendName:"webgl",kernelFunc:k3e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N3e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:r,padInfo:o,strideHeight:s,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:d,left:h}=o;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${i});
      const ivec2 pads = ivec2(${d}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=r,c=O1(o.shape,s.shape,i,a,"NHWC",l);let u;const d=new N3e(c);u=t.runWebGLProgram(d,[o,s],"float32");const h=Ze({inputs:{x:u},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(u),h}const E3e={kernelName:c2,backendName:"webgl",kernelFunc:I3e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T3e(n){const{inputs:e,backend:t,attrs:r}=n,{equation:o}=r,s=e,{allDims:i,summedDims:a,idDims:l}=Ck(o,s.length);Sk(i.length,l,s);const{path:c,steps:u}=Nk(a,l),d=u.length;let h=null,p=i.length;const g=[];for(let x=0;x<d;++x){for(const y of u[x]){const{permutationIndices:b,expandDims:C}=kk(p,l[y]);let S;Ik(b)?S=s[y]:(S=Jo({inputs:{x:s[y]},backend:t,attrs:{perm:b}}),g.push(S));const k=S.shape.slice();for(let N=0;N<C.length;++N)k.splice(C[N],0,1);In(S.shape,k)||(S=Ze({inputs:{x:S},backend:t,attrs:{shape:k}}),g.push(S)),h===null?h=S:(h=h8({inputs:{a:S,b:h},backend:t}),g.push(h))}x<d-1&&(c[x]>=0&&(h=ky({inputs:{x:h},backend:t,attrs:{axis:c[x]-(i.length-p),keepDims:!1}}),g.push(h)),p--)}for(const x of g)x!==h&&t.disposeIntermediateTensorInfo(x);return h}const R3e={kernelName:n6,backendName:"webgl",kernelFunc:T3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D3e="return (x >= 0.0) ? x : (exp(x) - 1.0);",A3e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_3e=mn({opSnippet:D3e,packedOpSnippet:A3e}),$3e={kernelName:t1,backendName:"webgl",kernelFunc:_3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F3e="return (b >= 0.0) ? a : a * (b + 1.0);",P3e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,M3e=n=>{const{inputs:e,backend:t}=n,{dy:r,y:o}=e,s=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Gf(P3e,r.shape,o.shape):new Rd(F3e,r.shape,o.shape);return t.runWebGLProgram(s,[r,o],r.dtype)},O3e={kernelName:r6,backendName:"webgl",kernelFunc:M3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L3e=`
  return vec4(equal(a, b));
`,B3e="return float(a == b);",j3e=go({opSnippet:B3e,packedOpSnippet:L3e,dtype:"bool",cpuKernelImpl:v2e}),V3e={kernelName:u2,backendName:"webgl",kernelFunc:j3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z3e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${mk};
  float a1 = ${gk};
  float a2 = ${xk};
  float a3 = ${vk};
  float a4 = ${yk};
  float a5 = ${bk};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,W3e=mn({opSnippet:z3e}),U3e={kernelName:n1,backendName:"webgl",kernelFunc:W3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H3e=qf+`
  return exp(x);
`,G3e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,YL=mn({opSnippet:H3e,packedOpSnippet:G3e,cpuKernelImpl:y2e,dtype:"float32"}),q3e={kernelName:r1,backendName:"webgl",kernelFunc:YL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o4(n){const{inputs:e,attrs:t,backend:r}=n,{dim:o}=t,{input:s}=e,i=s.shape.length,a=s.shape.slice();let l=o;return o<0&&(K(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),Ze({inputs:{x:s},backend:r,attrs:{shape:a}})}const K3e={kernelName:d2,backendName:"webgl",kernelFunc:o4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E9="return exp(x) - 1.0;",X3e=mn({opSnippet:E9,packedOpSnippet:E9,cpuKernelImpl:b2e}),Y3e={kernelName:o1,backendName:"webgl",kernelFunc:X3e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T9{constructor(e,t,r){this.variableNames=["real","imag"];const o=t[1];this.outputShape=t;const s=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=r?`${o}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZL(n,e,t){const r=t.texData.get(n.dataId),o=De(n.shape),s=n.shape[n.shape.length-1],i=o/s,a=Ze({inputs:{x:n},backend:t,attrs:{shape:[i,s]}}),l=a.shape,c=new T9("real",l,e),u=new T9("imag",l,e),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],h=t.runWebGLProgram(c,d,"float32"),p=t.runWebGLProgram(u,d,"float32"),g=Cu({inputs:{real:h,imag:p},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p);const x=Ze({inputs:{x:g},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(g),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z3e(n){const{inputs:e,backend:t}=n,{input:r}=e;return ZL(r,!1,t)}const Q3e={kernelName:o6,backendName:"webgl",kernelFunc:Z3e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J3e{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function og(n){const{backend:e,attrs:t}=n,{shape:r,value:o}=t;let{dtype:s}=t;if(s=s||_f(o),s==="string"){const i=mr(s,De(r));return i.fill(o),e.makeTensorInfo(r,s,i)}else{const i=new J3e(r,o),a=[[o]];return e.runWebGLProgram(i,[],s,a)}}const eCe={kernelName:s6,backendName:"webgl",kernelFunc:og};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tCe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nCe={kernelName:i6,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,r=e,o=new tCe(t.shape);return r.runWebGLProgram(o,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R9="return floor(x);",rCe=mn({opSnippet:R9,packedOpSnippet:R9,cpuKernelImpl:w2e}),oCe={kernelName:s1,backendName:"webgl",kernelFunc:rCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sCe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,iCe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,aCe=go({opSnippet:sCe,packedOpSnippet:iCe,dtype:"int32"}),lCe={kernelName:i1,backendName:"webgl",kernelFunc:aCe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cCe{constructor(e){this.variableNames=["A"];const t=es(),[r,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uCe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=es(),[r,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dCe={kernelName:Sne,backendName:"webgl",kernelFunc:hCe};let Mh,A3=Ce().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function hCe(n){const{inputs:e,backend:t,attrs:r}=n;let{pixels:o}=e;const{numChannels:s}=r,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[c,l],d=[c,l,s];if(a||i){const x=Ce().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Mh==null||x!==A3)&&(A3=x,Mh=document.createElement("canvas").getContext("2d",{willReadFrequently:A3})),Mh.canvas.width=l,Mh.canvas.height=c,Mh.drawImage(o,0,0,l,c),o=Mh.canvas}const h=t.makeTensorInfo(u,"int32");t.texData.get(h.dataId).usage=ri.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(h.dataId),o);const p=Ce().getBool("WEBGL_PACK")?new uCe(d):new cCe(d),g=t.runWebGLProgram(p,[h],"int32");return t.disposeData(h.dataId),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fCe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:g}=r,x=lc(u),y=po(o.shape,s.shape,l,d,c,h,!1,x);let b;const C=[],S=i!=null,k=a!=null,N=p==="leakyrelu",E=()=>{const $=[o,s],T=(D,A)=>{if(A==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const M=Ze({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return C.push(M),M}return D};if(S&&$.push(T(i,u)),k&&$.push(T(a,u)),N){const D=t.makeTensorInfo([],"float32",pu(g,"float32"));$.push(D),C.push(D)}return $};if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))b=HL({x:o,filter:s,convInfo:y,backend:t,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:g});else if(y.strideWidth<=2&&x==="channelsLast"&&Ce().getBool("WEBGL_EXP_CONV")){const $=p?Cm(p,!0):null,T=new UL(y,S,$,k,N),D=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],A=E();b=t.runWebGLProgram(T,A,"float32",D)}else if(Ce().getBool("WEBGL_CONV_IM2COL"))b=GL({x:o,filter:s,convInfo:y,backend:t,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:g});else{const $=p?Cm(p,!1):null,T=new WL(y,S,$,k,N),D=E();b=t.runWebGLProgram(T,D,"float32")}const _=Ze({inputs:{x:b},backend:t,attrs:{shape:y.outShape}});return C.push(b),C.forEach($=>t.disposeIntermediateTensorInfo($)),_}const pCe={kernelName:Wx,backendName:"webgl",kernelFunc:fCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mCe(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=r,g=[];let x=u;x==null&&(x=[1,1]),K(Do(l,x),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${x}'`);const y=po(o.shape,s.shape,l,x,c,d,!0),b=Ce().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels===1,C=h?Cm(h,b):null,S=[o,s],k=i!=null,N=a!=null,E=h==="leakyrelu";if(k&&S.push(i),N&&S.push(a),E){const D=t.makeTensorInfo([],"float32",pu(p,"float32"));S.push(D),g.push(D)}let _;b?_=new XL(y,k,C,N,E):_=new KL(y,k,C,N,E);const $=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],T=t.runWebGLProgram(_,S,"float32",$);return g.forEach(D=>t.disposeIntermediateTensorInfo(D)),T}const gCe={kernelName:J_,backendName:"webgl",kernelFunc:mCe};class xCe{constructor(e,t,r,o){this.sliceDim=e,this.strides=t,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=r;const s=Fn(r.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vCe(n){const{inputs:e,backend:t}=n,{params:r,indices:o}=e,s=o.shape,i=s[s.length-1],a=De(r.shape),[l,c,u,d]=ok(r,o),h=Ze({inputs:{x:o},backend:t,attrs:{shape:[c,i]}}),p=Ze({inputs:{x:r},backend:t,attrs:{shape:[De(r.shape)/u,u]}});if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const b=t.readSync(o.dataId),C=t.bufferSync(r),S=C2e(b,C,r.dtype,c,i,u,d,r.shape,a);return t.makeTensorInfo(l,r.dtype,S.values)}const g=new xCe(i,d,[c,u],r.shape),x=t.runWebGLProgram(g,[p,h],p.dtype),y=Ze({inputs:{x},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(x),y}const yCe={kernelName:P_,backendName:"webgl",kernelFunc:vCe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bCe{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const r=Fn(this.rank),o=wCe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}}function wCe(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<n.length;o++)o===2?r.push("index"):r.push(`${t[o]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,indices:s}=e,{axis:i,batchDims:a}=r,l=Qt(i,o.shape)[0];if(Ce().get("DEBUG")){const C=t.readSync(s.dataId),S=o.shape[l];for(let k=0;k<C.length;++k){const N=C[k];K(N<=S-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${S-1}]`)}}const c=Tk(o,s,l,a),u=De(s.shape),d=[],h=Ze({inputs:{x:o},backend:t,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=Ze({inputs:{x:s},backend:t,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(h),d.push(p);const g=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(t.shouldExecuteOnCPU([o,s])||o.dtype==="string"){const C=t.bufferSync(p),S=t.bufferSync(h),k=k2e(S,C,g);return d.forEach(N=>t.disposeIntermediateTensorInfo(N)),t.makeTensorInfo(c.outputShape,k.dtype,k.values)}const x=new bCe(h.shape,g),y=t.runWebGLProgram(x,[h,p],h.dtype);d.push(y);const b=Ze({inputs:{x:y},backend:t,attrs:{shape:c.outputShape}});return d.forEach(C=>t.disposeIntermediateTensorInfo(C)),b}const CCe={kernelName:f2,backendName:"webgl",kernelFunc:QL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kCe="return float(a > b);",SCe=`
  return vec4(greaterThan(a, b));
`,NCe=go({opSnippet:kCe,packedOpSnippet:SCe,cpuKernelImpl:S2e,dtype:"bool"}),ICe={kernelName:p2,backendName:"webgl",kernelFunc:NCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ECe="return float(a >= b);",TCe=`
  return vec4(greaterThanEqual(a, b));
`,RCe=go({opSnippet:ECe,packedOpSnippet:TCe,dtype:"bool",cpuKernelImpl:N2e}),DCe={kernelName:a1,backendName:"webgl",kernelFunc:RCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ACe(n){const{inputs:e,backend:t}=n,{input:r}=e;return ZL(r,!0,t)}const _Ce={kernelName:a6,backendName:"webgl",kernelFunc:ACe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ce="return float(!isnan(x) && !isinf(x));",FCe=mn({opSnippet:$Ce,dtype:"bool"}),PCe={kernelName:c1,backendName:"webgl",kernelFunc:FCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MCe="return float(isinf(x));",OCe=mn({opSnippet:MCe,dtype:"bool"}),LCe={kernelName:u1,backendName:"webgl",kernelFunc:OCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BCe="return float(isnan(x));",jCe=mn({opSnippet:BCe,dtype:"bool"}),VCe={kernelName:d1,backendName:"webgl",kernelFunc:jCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zCe="return float(a < b);",WCe=`
  return vec4(lessThan(a, b));
`,UCe=go({opSnippet:zCe,packedOpSnippet:WCe,cpuKernelImpl:I2e,dtype:"bool"}),HCe={kernelName:g2,backendName:"webgl",kernelFunc:UCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GCe="return float(a <= b);",qCe=`
  return vec4(lessThanEqual(a, b));
`,KCe=go({opSnippet:GCe,packedOpSnippet:qCe,cpuKernelImpl:E2e,dtype:"bool"}),XCe={kernelName:x2,backendName:"webgl",kernelFunc:KCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YCe(n){const{backend:e,attrs:t}=n,{start:r,stop:o,num:s}=t,i=T2e(r,o,s);return e.makeTensorInfo([i.length],"float32",i)}const ZCe={kernelName:M_,backendName:"webgl",kernelFunc:YCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QCe=qf+`
  return x < 0.0 ? 0./0. : log(x);
`,JCe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,e4e=mn({opSnippet:QCe,packedOpSnippet:JCe,cpuKernelImpl:R2e}),t4e={kernelName:h1,backendName:"webgl",kernelFunc:e4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n4e=qf+`
  return log(1.0 + x);
`,r4e=mn({opSnippet:n4e}),o4e={kernelName:f1,backendName:"webgl",kernelFunc:r4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s4e="return float(a >= 1.0 && b >= 1.0);",i4e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,a4e=go({opSnippet:s4e,packedOpSnippet:i4e,dtype:"bool"}),l4e={kernelName:v2,backendName:"webgl",kernelFunc:a4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c4e="return float(!(x >= 1.0));",u4e=mn({opSnippet:c4e}),d4e={kernelName:y2,backendName:"webgl",kernelFunc:u4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h4e="return float(a >= 1.0 || b >= 1.0);",f4e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,p4e=go({opSnippet:h4e,packedOpSnippet:f4e,dtype:"bool"}),m4e={kernelName:b2,backendName:"webgl",kernelFunc:p4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g4e{constructor(e,t,r,o,s){this.variableNames=["x"],this.outputShape=[];const i=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${r}) + float(${o}) * sum`;s===.5?l=`inversesqrt(${c})`:s===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x4e{constructor(e,t,r,o,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${r}) + float(${o}) * sum`;s===.5?l=`inversesqrt(${c})`:s===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v4e=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:l}=r,c=Ce().getBool("WEBGL_PACK_NORMALIZATION")?new x4e(o.shape,s,i,a,l):new g4e(o.shape,s,i,a,l);return t.runWebGLProgram(c,[o],o.dtype)},y4e={kernelName:w2,backendName:"webgl",kernelFunc:v4e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b4e{constructor(e,t,r,o,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=o,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${s})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w4e=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new b4e(o.shape,a,l,c,u);return t.runWebGLProgram(d,[o,s,i],o.dtype)},C4e={kernelName:c6,backendName:"webgl",kernelFunc:w4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4e(n,e,t,r){const o=De(e),i=De(n.shape)/o,a=Ze({inputs:{x:n},attrs:{shape:[i,o]},backend:r}),l=Gd(a,n.dtype,"max",r),c=Ze({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{reductionIndices:s,keepDims:i}=r,a=o.shape.length,l=Qt(s,o.shape);let c=l;const u=sr(c,a),d=u!=null,h=t.shouldExecuteOnCPU([o]);let p=o;if(d){if(h){const S=t.texData.get(p.dataId).values,k=new Array(a);for(let _=0;_<k.length;_++)k[_]=o.shape[u[_]];const N=u8(S,o.shape,o.dtype,u,k);p=t.makeTensorInfo(k,o.dtype);const E=t.texData.get(p.dataId);E.values=N}else p=Cy(o,u,t);c=vr(c.length,a)}mo("max",c,a);const[g,x]=to(p.shape,c);let y=g;i&&(y=Ir(g,l));let b;if(h){const S=t.texData.get(p.dataId).values,k=D2e(S,De(x),y,o.dtype);b=t.makeTensorInfo(y,o.dtype);const N=t.texData.get(b.dataId);N.values=k}else b=k4e(p,x,y,t);return d&&t.disposeIntermediateTensorInfo(p),b}const S4e={kernelName:C2,backendName:"webgl",kernelFunc:JL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N4e=d8+`
  return max(a, b);
`,I4e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Hd+`
  return result;
`,E4e=go({opSnippet:N4e,packedOpSnippet:I4e,cpuKernelImpl:A2e}),T4e={kernelName:p1,backendName:"webgl",kernelFunc:E4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R4e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e;tg(o,"maxPool");const{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=r,c=1;K(Do(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Pi(o.shape,s,i,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&In(u.inShape,u.outShape))return js({inputs:{x:o},backend:t});const d=new km(u,"max",!1);return t.runWebGLProgram(d,[o],o.dtype)}const D4e={kernelName:k2,backendName:"webgl",kernelFunc:R4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A4e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{filterSize:s,strides:i,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=ac(o.shape,s,i,u,a,c,l),h=new f8(d,"max",!1);return t.runWebGLProgram(h,[o],o.dtype)}const _4e={kernelName:S2,backendName:"webgl",kernelFunc:A4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $4e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,r=e.strideWidth,o=e.dilationHeight,s=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=s-1-e.padInfo.top,l=i-1-e.padInfo.left,c=s*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class F4e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,r=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=c-1-e.padInfo.top,p=u-1-e.padInfo.left,g=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${h}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${g} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,input:s}=e,i=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],h=ac(i.shape,a,l,d,c,u),p=new f8(h,"max",!0),g=t.runWebGLProgram(p,[i],i.dtype),x=new F4e(h),y=t.runWebGLProgram(x,[o,g],i.dtype);return t.disposeIntermediateTensorInfo(g),y}const M4e={kernelName:d6,backendName:"webgl",kernelFunc:P4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O4e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:o,input:s,output:i}=e,a=s;tg([s,i],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,h=Pi(a.shape,l,c,1,u,d),p=!0,g=new km(h,"max",p),x=t.runWebGLProgram(g,[a],a.dtype),y=new $4e(h),b=t.runWebGLProgram(y,[o,x],a.dtype);return t.disposeIntermediateTensorInfo(x),b}const L4e={kernelName:u6,backendName:"webgl",kernelFunc:O4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B4e(n,e,t,r){let o=new km(t,"max",!1);const s=r.runWebGLProgram(o,[n],"float32");o=new km(t,"max",!0,!0,e);const i=r.runWebGLProgram(o,[n],"float32");return[s,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j4e={kernelName:O_,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=e,l=t;K(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const c=[1,1];K(Do(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const u=Pi(r.shape,o,s,c,i),[d,h]=B4e(r,a,u,l);return[d,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V4e(n,e,t,r){const o=De(e),i=De(n.shape)/o,a=Ze({inputs:{x:n},attrs:{shape:[i,o]},backend:r}),l=Gd(a,"float32","mean",r),c=Ze({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z4e={kernelName:N2,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{keepDims:o,axis:s}=e,i=t,a=r.shape.length,l=Qt(s,r.shape);let c=l;const u=sr(c,a),d=u!=null,h=i.shouldExecuteOnCPU([r]),p=[];let g=r;if(d){if(h){const k=i.texData.get(g.dataId).values,N=new Array(a);for(let $=0;$<N.length;$++)N[$]=r.shape[u[$]];const E=u8(k,r.shape,r.dtype,u,N);g=i.makeTensorInfo(N,r.dtype);const _=i.texData.get(g.dataId);_.values=E}else g=Cy(r,u,i);p.push(g),c=vr(c.length,a)}mo("sum",c,a);const[x,y]=to(g.shape,c);let b=x;o&&(b=Ir(x,l));const C=V4e(g,y,b,i);for(const S of p)i.disposeIntermediateTensorInfo(S);return C}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W4e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r,a=o.shape.length,l=Qt(s,o.shape);let c=l;const u=sr(c,a);let d=o;u!=null&&(d=Jo({inputs:{x:o},backend:t,attrs:{perm:u}}),c=vr(c.length,o.shape.length)),mo("min",c,a);const[h,p]=to(d.shape,c),g=De(p),x=Ze({inputs:{x:d},backend:t,attrs:{shape:[-1,g]}}),y=Gd(x,x.dtype,"min",t);let b;if(i){const C=Ir(h,l);b=Ze({inputs:{x:y},backend:t,attrs:{shape:C}})}else b=Ze({inputs:{x:y},backend:t,attrs:{shape:h}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),u!=null&&t.disposeIntermediateTensorInfo(d),b}const U4e={kernelName:I2,backendName:"webgl",kernelFunc:W4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H4e=d8+`
  return min(a, b);
`,G4e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Hd+`
  return result;
`,q4e=go({opSnippet:H4e,packedOpSnippet:G4e,cpuKernelImpl:_2e}),K4e={kernelName:m1,backendName:"webgl",kernelFunc:q4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X4e{constructor(e,t,r){this.variableNames=["x"],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const o=e.length,s=Fn(o),i=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y4e{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((g,x)=>g[0]+e[x]+g[1]);const o=e.length,s=Fn(o),i=t.map(g=>g[0]).join(","),a=t.map((g,x)=>g[0]+e[x]).join(","),l=Ko("rc",o),c=Ko("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,h=r==="reflect"?0:1;let p="";if(o===1){const g=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;p=`
        ${s} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${g}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const g=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;p=`
        ${s} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${g}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${g}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[o-1]} += 1;
          if(${u}) {
            ${g}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z4e=({inputs:n,backend:e,attrs:t})=>{const{x:r}=n,{paddings:o,mode:s}=t,i=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Y4e(r.shape,o,s):new X4e(r.shape,o,s);return e.runWebGLProgram(i,[r],r.dtype)},Q4e={kernelName:E2,backendName:"webgl",kernelFunc:Z4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J4e=`if (b == 0.0) return NAN;
  return mod(a, b);`,e5e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Hd+`
  return result;
`,t5e=go({opSnippet:J4e,packedOpSnippet:e5e}),n5e={kernelName:g1,backendName:"webgl",kernelFunc:t5e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r5e{constructor(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o5e=`
if (a == b) {
  return 1.0;
};
return a / b;`,s5e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,eB=go({opSnippet:o5e,packedOpSnippet:s5e,checkOutOfBounds:!0}),i5e={kernelName:e1,backendName:"webgl",kernelFunc:eB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D9="return a - b;",tB=go({opSnippet:D9,packedOpSnippet:D9,supportsComplex:!0,cpuKernelImpl:J2e}),a5e={kernelName:_1,backendName:"webgl",kernelFunc:tB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(n){const{inputs:e,backend:t,attrs:r}=n,{logits:o}=e,{dim:s}=r,i=Qt([s],o.shape),a=JL({inputs:{x:o},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),l=Ir(a.shape,i),c=Ze({inputs:{x:a},backend:t,attrs:{shape:l}}),u=tB({inputs:{a:o,b:c},backend:t}),d=YL({inputs:{x:u},backend:t}),h=ky({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:!1}}),p=Ze({inputs:{x:h},backend:t,attrs:{shape:l}}),g=eB({inputs:{a:d,b:p},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),g}const l5e={kernelName:H2,backendName:"webgl",kernelFunc:nB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5e(n){const{inputs:e,backend:t,attrs:r}=n,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=r,l=a?o:nB({inputs:{logits:o},backend:t,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new r5e(c,u,s),h=[[i]],p=t.runWebGLProgram(d,[l],"int32",h);return a||t.disposeIntermediateTensorInfo(l),p}const u5e={kernelName:L_,backendName:"webgl",kernelFunc:c5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d5e=Oi+`
  return -x;
`,h5e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function f5e(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])){const s=t.texData.get(r.dataId),[i,a]=F2e(s.values,r.shape,r.dtype);return t.makeTensorInfo(a,r.dtype,i)}let o;return Ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Gc(r.shape,h5e):o=new Za(r.shape,d5e),t.runWebGLProgram(o,[r],r.dtype)}const p5e={kernelName:T2,backendName:"webgl",kernelFunc:f5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m5e=J6;function g5e(n){Js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=r,c=t.readSync(o.dataId),u=t.readSync(s.dataId),{selectedIndices:d}=m5e(c,u,i,a,l);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const x5e={kernelName:h6,backendName:"webgl",kernelFunc:g5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v5e=ek;function y5e(n){Js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=t.readSync(o.dataId),d=t.readSync(s.dataId),{selectedIndices:h,validOutputs:p}=v5e(u,d,i,a,l,c);return[t.makeTensorInfo([h.length],"int32",new Int32Array(h)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const b5e={kernelName:f6,backendName:"webgl",kernelFunc:y5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w5e=tk;function C5e(n){Js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=t.readSync(o.dataId),d=t.readSync(s.dataId),h=i,p=a,g=l,x=c,{selectedIndices:y,selectedScores:b}=w5e(u,d,h,p,g,x);return[t.makeTensorInfo([y.length],"int32",new Int32Array(y)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const k5e={kernelName:p6,backendName:"webgl",kernelFunc:C5e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S5e{constructor(e,t,r,o){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N5e=n=>{const{inputs:e,backend:t,attrs:r}=n,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:l}=r,c=De(o.shape),u=new S5e(c,i,a,l),d=Ze({inputs:{x:o},backend:t,attrs:{shape:[c]}}),h=t.runWebGLProgram(u,[d],s);t.disposeIntermediateTensorInfo(d);const p=[...o.shape,i],g=Ze({inputs:{x:h},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(h),g},I5e={kernelName:A2,backendName:"webgl",kernelFunc:N5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mv(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="complex64"){const o=rg({inputs:{input:r},backend:t}),s=mv({inputs:{x:o},backend:t}),i=Sy({inputs:{input:r},backend:t}),a=mv({inputs:{x:i},backend:t}),l=Cu({inputs:{real:s,imag:a},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return og({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}const E5e={kernelName:K2,backendName:"webgl",kernelFunc:mv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const o=rg({inputs:{input:r},backend:t}),s=rB({inputs:{x:o},backend:t}),i=Sy({inputs:{input:r},backend:t}),a=mv({inputs:{x:i},backend:t}),l=Cu({inputs:{real:s,imag:a},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return og({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}const T5e={kernelName:D2,backendName:"webgl",kernelFunc:rB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5e(n){const{inputs:e,backend:t,attrs:r}=n,{axis:o}=r;if(e.length===1)return o4({inputs:{input:e[0]},backend:t,attrs:{dim:o}});const s=e[0].shape,i=e[0].dtype;e.forEach(u=>{P5(s,u.shape,"All tensors passed to stack must have matching shapes"),K(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=o4({inputs:{input:u},backend:t,attrs:{dim:o}});return a.push(d),d}),c=zL({inputs:l,backend:t,attrs:{axis:o}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),c}const D5e={kernelName:_2,backendName:"webgl",kernelFunc:R5e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A5e{constructor(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((c,u)=>c[0]+e[u]+c[1]);const o=e.length,s=Fn(o),i=t.map(c=>c[0]).join(","),a=t.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _5e{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((x,y)=>x[0]+e[y]+x[1]);const o=e.length,s=Fn(o),i=t.map(x=>x[0]).join(","),a=t.map((x,y)=>x[0]+e[y]).join(","),l=Ko("rc",o),c=Ko("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,h=[`${s} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${u}) {`],p=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let g="";for(let x=0,y=o===1?2:4;x<y;x++)g+=`
        ${h[x]}
        if (${p}) {
          result[${x}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${x}] = getChannel(getX(${c.join()}), ${d});
        }
      `;g+=o===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oB=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{paddings:s,constantValue:i}=r;if(De(o.shape)===0){const c=s.map((u,d)=>u[0]+o.shape[d]+u[1]);return og({backend:t,attrs:{shape:c,value:i,dtype:o.dtype}})}const a=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _5e(o.shape,s,i):new A5e(o.shape,s,i),l=[[i]];return t.runWebGLProgram(a,[o],o.dtype,l)},$5e={kernelName:$2,backendName:"webgl",kernelFunc:oB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F5e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,P5e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Hd+`
  return result;
`,M5e=go({opSnippet:F5e,packedOpSnippet:P5e}),O5e={kernelName:v1,backendName:"webgl",kernelFunc:M5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{axis:s,keepDims:i}=r,a=o.shape.length,l=[],c=Qt(s,o.shape);let u=c;const d=sr(u,a);let h=o;d!=null&&(h=Jo({inputs:{x:o},backend:t,attrs:{perm:d}}),u=vr(u.length,a),l.push(h)),mo("prod",u,a);let p;if(t.shouldExecuteOnCPU([h])){const g=t.texData.get(h.dataId).values,{outVals:x,outShape:y,outDtype:b}=M2e(h.shape,h.dtype,g,u);p=t.makeTensorInfo(y,b,x)}else{const[g,x]=to(h.shape,u),y=De(x),b=Ze({inputs:{x:h},backend:t,attrs:{shape:[-1,y]}}),C=I6(o.dtype),S=Gd(b,C,"prod",t);p=Ze({inputs:{x:S},backend:t,attrs:{shape:g}}),l.push(b),l.push(S)}if(i){l.push(p);const g=Ir(p.shape,c);p=Ze({inputs:{x:p},backend:t,attrs:{shape:g}})}return l.forEach(g=>t.disposeIntermediateTensorInfo(g)),p}const B5e={kernelName:P2,backendName:"webgl",kernelFunc:L5e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j5e(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=e,{outputRaggedRank:a}=r,l=o.map(b=>t.readSync(b.dataId)),c=o.map(b=>b.shape),u=t.readSync(s.dataId),d=t.readSync(i.dataId),[h,p,g]=O2e(l,c,u,s.shape,s.dtype,d,i.shape,a),x=h.map(b=>t.makeTensorInfo([b.length],"int32",b)),y=t.makeTensorInfo(g,s.dtype,p);return x.concat([y])}const V5e={kernelName:B_,backendName:"webgl",kernelFunc:j5e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z5e(n){const{inputs:e,backend:t}=n,{starts:r,limits:o,deltas:s}=e,i=t.readSync(r.dataId),a=t.readSync(o.dataId),l=t.readSync(s.dataId),[c,u]=L2e(i,r.shape,r.dtype,a,o.shape,l,s.shape),d=t.makeTensorInfo([c.length],"int32",c),h=t.makeTensorInfo([u.length],r.dtype,u);return[d,h]}const W5e={kernelName:j_,backendName:"webgl",kernelFunc:z5e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5e(n){const{inputs:e,backend:t,attrs:r}=n,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=t.readSync(o.dataId),u=t.readSync(s.dataId),d=t.readSync(i.dataId),h=a.map(y=>t.readSync(y.dataId)),p=a.map(y=>y.shape),[g,x]=B2e(c,o.shape,u,s.shape,s.dtype,d,i.shape,h,p,l);return t.makeTensorInfo(g,s.dtype,x)}const H5e={kernelName:V_,backendName:"webgl",kernelFunc:U5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sB=n=>{const{backend:e,attrs:t}=n,{start:r,stop:o,step:s,dtype:i}=t,a=j2e(r,o,s,i);return e.makeTensorInfo([a.length],i,a)},G5e={kernelName:m6,backendName:"webgl",kernelFunc:sB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q5e="return 1.0 / x;",K5e=mn({opSnippet:q5e}),X5e={kernelName:y1,backendName:"webgl",kernelFunc:K5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y5e=Oi+`
  return (x < 0.0) ? 0.0 : x;
`,Z5e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Q5e=mn({opSnippet:Y5e,packedOpSnippet:Z5e}),J5e={kernelName:b1,backendName:"webgl",kernelFunc:Q5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e6e=Oi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,t6e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,n6e=mn({opSnippet:e6e,packedOpSnippet:t6e}),r6e={kernelName:w1,backendName:"webgl",kernelFunc:n6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o6e{constructor(e,t,r,o,s){this.variableNames=["A"],this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,t,r,c];const u=[o&&t>1?a-1:a,o&&r>1?l-1:l],d=[o&&t>1?t-1:t,o&&r>1?r-1:r];let h;s?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s6e{constructor(e,t,r,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,t,r,c];const u=[o&&t>1?a-1:a,o&&r>1?l-1:l],d=[o&&t>1?t-1:t,o&&r>1?r-1:r];let h;s?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6e(n){const{inputs:e,backend:t,attrs:r}=n,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=r,[l,c]=a,u=Ce().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new s6e(o.shape,l,c,s,i):new o6e(o.shape,l,c,s,i);return t.runWebGLProgram(u,[o],"float32")}const a6e={kernelName:L2,backendName:"webgl",kernelFunc:i6e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l6e{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,o,s]=t,[,i,a]=e,l=[r&&i>1?o-1:o,r&&a>1?s-1:s],c=[r&&i>1?i-1:i,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,p=1/d,g=Math.ceil(h)*2+2,x=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${g});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c6e(n){const{inputs:e,backend:t,attrs:r}=n,{images:o,dy:s}=e,{alignCorners:i}=r,a=new l6e(s.shape,o.shape,i);return t.runWebGLProgram(a,[s],s.dtype)}const u6e={kernelName:v6,backendName:"webgl",kernelFunc:c6e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d6e{constructor(e,t,r,o,s){this.variableNames=["A"],this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,t,r,c];const u=[o&&t>1?a-1:a,o&&r>1?l-1:l],d=[o&&t>1?t-1:t,o&&r>1?r-1:r],h=o?"0.5":"0.0";let p;s?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h6e{constructor(e,t,r,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,t,r,c];const u=[o&&t>1?a-1:a,o&&r>1?l-1:l],d=[o&&t>1?t-1:t,o&&r>1?r-1:r],h=o?"0.5":"0.0";let p;s?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6e(n){const{inputs:e,backend:t,attrs:r}=n,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=r,[l,c]=a,u=Ce().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new h6e(o.shape,l,c,s,i):new d6e(o.shape,l,c,s,i);return t.runWebGLProgram(u,[o],o.dtype)}const p6e={kernelName:O2,backendName:"webgl",kernelFunc:f6e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m6e{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,o,s]=t,[,i,a]=e,l=[r&&i>1?o-1:o,r&&a>1?s-1:s],c=[r&&i>1?i-1:i,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,p=1/d,g=Math.ceil(h)*2+2,x=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${g});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6e(n){const{inputs:e,backend:t,attrs:r}=n,{images:o,dy:s}=e,{alignCorners:i}=r,a=new m6e(s.shape,o.shape,i);return t.runWebGLProgram(a,[s],s.dtype)}const x6e={kernelName:x6,backendName:"webgl",kernelFunc:g6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v6e{constructor(e,t){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const o=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,s=e.map((a,l)=>o(l)).join(","),i=Fn(r);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y6e{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const o=Ko("rc",r),s=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,i=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=Fn(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${s}){
            result.g = ${c(o.slice())};
          }
          if(${i}) {
            result.b = ${u(o.slice())};
            if(${s}) {
              result.a = ${d(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(g){return h(g)}function c(g){return g[r-1]="("+g[r-1]+" + 1)",h(g)}function u(g){return g[r-2]="("+g[r-2]+" + 1)",h(g)}function d(g){return g[r-1]="("+g[r-1]+" + 1)",g[r-2]="("+g[r-2]+" + 1)",h(g)}function h(g){const x=e.map((C,S)=>p(S,g)),y=x.join(","),b=x.slice(-2).join(",");return`getChannel(getX(${y}), vec2(${b}))`}function p(g,x){return t.indexOf(g)!==-1&&e[g]!==1?`${e[g]} - ${x[g]} - 1`:`${x[g]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{dims:s}=r,i=o.shape.length,a=Qt(s,o.shape);if(i===0)return js({inputs:{x:o},backend:t});const l=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new y6e(o.shape,a):new v6e(o.shape,a);return t.runWebGLProgram(l,[o],o.dtype)}const w6e={kernelName:B2,backendName:"webgl",kernelFunc:b6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C6e{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],o=e[2];this.outputShape=e;let s="";typeof t=="number"?s=`float outputValue = ${t.toFixed(2)};`:s=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k6e={kernelName:N6,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:o,fillValue:s,center:i}=e,a=t,l=new C6e(r.shape,s),[c,u]=hk(i,r.shape[1],r.shape[2]),d=[[c,u,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(l,[r],r.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S6e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,N6e=mn({opSnippet:S6e}),I6e={kernelName:C1,backendName:"webgl",kernelFunc:N6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E6e="return inversesqrt(x);",T6e=mn({opSnippet:E6e,cpuKernelImpl:V2e}),R6e={kernelName:k1,backendName:"webgl",kernelFunc:T6e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p8{constructor(e,t,r,o,s,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const c=Fn(s.length),u=Fn(i.length);let d="";r===1?d="i":r===2&&(d="i, j");const h=`getIndices(${d})`;let p="";o===1?p="i":o===2&&(p="i, coords[1]");const g=`getUpdates(${p})`;let x="";l&&(x="coords[0], coords[1]");const y=`getDefaultValue(${x})`,b=t>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${b};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${g};
              found = true;
            }
          }
          setOutput(mix(${y}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D6e{constructor(e,t,r,o,s,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const c=Fn(s.length),u=Fn(i.length);let d="";r===1?d="i":r===2&&(d="i, j");const h=`getIndices(${d})`;let p="";o===1?p="i":o===2&&(p="i, coords[1]");const g=`getUpdates(${p})`;let x="";l&&(x="coords[0], coords[1]");const y=`getDefaultValue(${x})`,b=t>1?"strides[j]":"strides",C=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${b};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${C};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${g};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${y}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6e(n){const{inputs:e,backend:t,attrs:r}=n,{indices:o,updates:s}=e,{shape:i}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=jd(s,o,i),h=[d/c,c];if(d===0)return t.makeTensorInfo(i,o.dtype);const p=Ze({inputs:{x:o},backend:t,attrs:{shape:[l,a]}}),g=Ze({inputs:{x:s},backend:t,attrs:{shape:[l,c]}}),x=t.makeTensorInfo([],"float32",new Float32Array([0]));let y;Ce().getBool("WEBGL_PACK")?y=new D6e(l,a,p.shape.length,g.shape.length,u,h):y=new p8(l,a,p.shape.length,g.shape.length,u,h);const b=t.runWebGLProgram(y,[g,p,x],g.dtype),C=Ze({inputs:{x:b},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(x),C}const _6e={kernelName:z_,backendName:"webgl",kernelFunc:A6e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $6e{constructor(e,t,r,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const s="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=Ce().getNumber("WEBGL_VERSION")===2?s:i,l=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6e(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:o,values:s}=e,{side:i}=r,a=new $6e(o.shape[0],o.shape[1],s.shape[1],i),l=[[o.shape[1]]];return t.runWebGLProgram(a,[o,s],"int32",l)}const P6e={kernelName:U_,backendName:"webgl",kernelFunc:F6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M6e{constructor(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;let o,s;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)s="resRC",o="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<t.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);o=l.join(),s=c.join()}const i=Fn(r);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O6e(n){const{inputs:e,backend:t}=n,{condition:r,t:o,e:s}=e,i=new M6e(r.shape.length,o.shape,o.shape.length);return t.runWebGLProgram(i,[r,o,s],Ls(o.dtype,s.dtype))}const L6e={kernelName:j2,backendName:"webgl",kernelFunc:O6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B6e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${iy};
  float scale = ${ay};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,j6e=mn({opSnippet:B6e}),V6e={kernelName:S1,backendName:"webgl",kernelFunc:j6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z6e=qf+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,W6e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,U6e=mn({opSnippet:z6e,packedOpSnippet:W6e,cpuKernelImpl:W2e}),H6e={kernelName:T1,backendName:"webgl",kernelFunc:U6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G6e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,q6e=mn({opSnippet:G6e}),K6e={kernelName:E1,backendName:"webgl",kernelFunc:q6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X6e=qf+`
  return sin(x);
`,Y6e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Hd}
  return result;
`,Z6e=mn({opSnippet:X6e,packedOpSnippet:Y6e}),Q6e={kernelName:N1,backendName:"webgl",kernelFunc:Z6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J6e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,eke=mn({opSnippet:J6e}),tke={kernelName:I1,backendName:"webgl",kernelFunc:eke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nke=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,rke=mn({opSnippet:nke}),oke={kernelName:R1,backendName:"webgl",kernelFunc:rke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ske=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{blockShape:s,paddings:i}=r;K(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((b,C)=>b*C),l=[[0,0]];l.push(...i);for(let b=1+s.length;b<o.shape.length;++b)l.push([0,0]);const c=[],u=oB({inputs:{x:o},backend:t,attrs:{paddings:l,constantValue:0}}),d=z1(u.shape,s,a,!1),h=W1(d.length,s.length,!1),p=U1(u.shape,s,a,!1),g=Ze({inputs:{x:u},backend:t,attrs:{shape:d}}),x=Jo({inputs:{x:g},backend:t,attrs:{perm:h}}),y=Ze({inputs:{x},backend:t,attrs:{shape:p}});return c.push(u),c.push(g),c.push(x),c.forEach(b=>t.disposeIntermediateTensorInfo(b)),y},ike={kernelName:W2,backendName:"webgl",kernelFunc:ske};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ake(n){const{inputs:e,backend:t}=n,{indices:r,values:o,denseShape:s,defaultValue:i}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.readSync(r.dataId),l=t.readSync(o.dataId),c=t.readSync(s.dataId),u=t.readSync(i.dataId)[0],[d,h,p,g,x]=H2e(a,r.shape,r.dtype,l,o.dtype,c,u);return[t.makeTensorInfo(h,r.dtype,d),t.makeTensorInfo([h[0]],o.dtype,p),t.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(y=>Number(y)))),t.makeTensorInfo([x.length],r.dtype,new Int32Array(x))]}const lke={kernelName:H_,backendName:"webgl",kernelFunc:ake};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cke(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:o,newShape:s}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const i=Array.from(t.readSync(o.dataId)),a=t.readSync(r.dataId),l=Array.from(t.readSync(s.dataId)),[c,u,d]=G2e(a,r.shape,r.dtype,i,l);return[t.makeTensorInfo(u,r.dtype,c),t.makeTensorInfo([d.length],s.dtype,new Int32Array(d))]}const uke={kernelName:G_,backendName:"webgl",kernelFunc:cke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dke(n){const{inputs:e,backend:t}=n,{data:r,indices:o,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);const i=t.readSync(r.dataId),a=t.readSync(o.dataId),l=t.readSync(s.dataId),[c,u]=RL(i,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(u,r.dtype,c)}const hke={kernelName:q_,backendName:"webgl",kernelFunc:dke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fke(n){const{inputs:e,backend:t}=n,{data:r,indices:o,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);const i=t.readSync(r.dataId),a=t.readSync(o.dataId),l=t.readSync(s.dataId),[c,u]=RL(i,r.shape,r.dtype,a,l);return t.makeTensorInfo(u,r.dtype,c)}const pke={kernelName:K_,backendName:"webgl",kernelFunc:fke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mke(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=jd(s,o,a),p=!1;if(s.dtype==="string"){const b=t.bufferSync(o),C=t.bufferSync(s),S=ou(t.readSync(i.dataId)[0]),k=z2e(b,C,a,h,u,c,l,d,S,p);return t.makeTensorInfo(a,k.dtype,k.values)}const g=new p8(c,l,o.shape.length,s.shape.length,d,[h,1],p),x=t.runWebGLProgram(g,[s,o,i],s.dtype),y=Ze({inputs:{x},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(x),y}const gke={kernelName:X_,backendName:"webgl",kernelFunc:mke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xke(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{numOrSizeSplits:s,axis:i}=r,a=Qt(i,o.shape)[0],l=Ek(o,s,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(h=>{const p=[...d];p[a]=h;const g=Kf({inputs:{x:o},backend:t,attrs:{begin:u,size:p}});return u[a]+=h,g})}const vke={kernelName:U2,backendName:"webgl",kernelFunc:xke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A9="return sqrt(x);",yke=mn({opSnippet:A9,packedOpSnippet:A9,cpuKernelImpl:q2e}),bke={kernelName:D1,backendName:"webgl",kernelFunc:yke};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wke="return x * x;",Cke=mn({opSnippet:wke}),kke={kernelName:y6,backendName:"webgl",kernelFunc:Cke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _9="return (a - b) * (a - b);",Ske=go({opSnippet:_9,packedOpSnippet:_9}),Nke={kernelName:A1,backendName:"webgl",kernelFunc:Ske};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ike(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");const s=t.readSync(o.dataId),i=Jl(s),a=K2e(i,"string",r);return t.makeTensorInfo(o.shape,"string",a)}const Eke={kernelName:b6,backendName:"webgl",kernelFunc:Ike};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tke({inputs:n,attrs:e,backend:t}){const{x:r}=n,o=Oi+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,s=new Za(r.shape,o);return t.runWebGLProgram(s,[r],r.dtype)}const Rke={kernelName:M1,backendName:"webgl",kernelFunc:Tke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dke{constructor(e,t,r){this.variableNames=["x"],this.outputShape=r;const o=r.length,s=Fn(r.length),i=Fn(r.length);let a="";if(o===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${e});
      ${s} strides = ${s}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ake(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{begin:s,end:i,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=r,{finalShapeSparse:p,finalShape:g,isIdentity:x,sliceDim0:y,isSimpleSlice:b,begin:C,end:S,strides:k}=ck(o.shape,s,i,a,l,c,u,d,h);let N;if(x)N=Ze({inputs:{x:o},backend:t,attrs:{shape:g}});else if(y||b){K(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const _=ik(C,S,k),$=Kf({inputs:{x:o},backend:t,attrs:{begin:C,size:_}});N=Ze({inputs:{x:$},backend:t,attrs:{shape:g}}),t.disposeIntermediateTensorInfo($)}else if(t.shouldExecuteOnCPU([o])){const $=t.readSync(o.dataId),T=Zt(o.shape,o.dtype,$),D=X2e(p,T,k,C);N=t.makeTensorInfo(g,o.dtype,D.values)}else{const $=new Dke(C,k,p);N=t.runWebGLProgram($,[o],o.dtype)}const E=Ze({inputs:{x:N},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(N),E}const _ke={kernelName:w6,backendName:"webgl",kernelFunc:Ake};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ke(n){const{inputs:e,backend:t,attrs:r}=n,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:d}=e,h=t.readSync(u.dataId),p=t.readSync(d.dataId),[g,x]=Y2e(h,p,o,s,i,a,l,c);return[t.makeTensorInfo([g.length],"string",g),t.makeTensorInfo(d.shape,"int32",x)]}const Fke={kernelName:Y_,backendName:"webgl",kernelFunc:$ke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pke(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:o}=r,{input:s,delimiter:i}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.readSync(s.dataId),l=t.readSync(i.dataId)[0],[c,u,d]=Z2e(a,l,o),h=u.length;return[t.makeTensorInfo([h,2],"int32",c),t.makeTensorInfo([h],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const Mke={kernelName:Z_,backendName:"webgl",kernelFunc:Pke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oke(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:o}=r,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(s.dataId),a=Q2e(i,o);return t.makeTensorInfo(s.shape,"int32",a)}const Lke={kernelName:Q_,backendName:"webgl",kernelFunc:Oke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bke="return tan(x);",jke=mn({opSnippet:Bke}),Vke={kernelName:$1,backendName:"webgl",kernelFunc:jke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zke=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Wke=mn({opSnippet:zke}),Uke={kernelName:F1,backendName:"webgl",kernelFunc:Wke};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hke(n){const{inputs:e,backend:t,attrs:r}=n,{tensor:o,indices:s,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=jd(i,s,o.shape),h=[d/c,c];if(d===0)return t.makeTensorInfo(o.shape,s.dtype);const p=Ze({inputs:{x:s},backend:t,attrs:{shape:[l,a]}}),g=Ze({inputs:{x:i},backend:t,attrs:{shape:[l,c]}}),x=Ze({inputs:{x:o},backend:t,attrs:{shape:h}}),y=new p8(l,a,p.shape.length,g.shape.length,u,h,!1,!0),b=t.runWebGLProgram(y,[g,p,x],x.dtype),C=Ze({inputs:{x:b},backend:t,attrs:{shape:o.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(b),C}const Gke={kernelName:W_,backendName:"webgl",kernelFunc:Hke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qke{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let i=0;i<r.length;i++)r[i]=e[i]*t[i];this.outputShape=r,this.rank=r.length;const o=Fn(this.rank),s=Kke(e);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}}function Kke(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<n.length;o++)r.push(`imod(${t[o]}, ${n[o]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{reps:s}=r;if(o.dtype==="string"||o.shape.length>5){const l=t.readSync(o.dataId),c=o.dtype==="string"?l.map(h=>ou(h)):l,u=Zt(o.shape,o.dtype,c),d=eye(u,s);return t.makeTensorInfo(d.shape,d.dtype,d.values)}const i=new qke(o.shape,s);return t.runWebGLProgram(i,[o],o.dtype)}const Xke={kernelName:P1,backendName:"webgl",kernelFunc:iB};class Yke{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Zke{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ku(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function $9(n){let e=1;for(;e<n;)e*=2;return e}function Qke(n){const{inputs:e,backend:t,attrs:r}=n,{x:o}=e,{k:s,sorted:i}=r,a=Ce().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=Ce().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=o.shape,u=c[c.length-1];if(t.shouldExecuteOnCPU([o])||u<a||s>l){const D=t.readSync(o.dataId),[A,M]=tye(D,c,o.dtype,s,i);return[t.makeTensorInfo(A.shape,A.dtype,A.values),t.makeTensorInfo(M.shape,M.dtype,M.values)]}if(s===0)return c[c.length-1]=0,[t.makeTensorInfo(c,o.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(u===1)return[o,og({attrs:{shape:c,dtype:"int32",value:0},backend:t})];const d=t.texData.get(o.dataId),h=d!==null&&d.isPacked,p=h?t.unpackTensor(o):o,x=De(c)/u,y=Ze({inputs:{x:p},attrs:{shape:[x,u]},backend:t});h&&Ku(t,p);const b=$9(s),C=$9(u);let S=null;const k=()=>S===null?[y,y]:[y,S],N=(D,A,M)=>{const j=k(),L=new Yke(M),G=[[u],[S===null?1:0],[Number.NEGATIVE_INFINITY],[D],[A]],H=S;S=t.runWebGLProgram(L,j,"int32",G),Ku(t,H)};for(let D=1;D<b;D*=2){const A=D*2;for(let M=D;M>=1;M/=2)N(A,M,[x,C])}for(let D=C;D>b;D/=2){const A=k(),M=new Zke([x,D/2]),L=[[u],[S===null?1:0],[b]],U=S;S=t.runWebGLProgram(M,A,"int32",L),Ku(t,U);const G=b/2,H=G*2;for(let O=G;O>=1;O/=2)N(H,O,S.shape)}let E=S;S=Kf({inputs:{x:S},backend:t,attrs:{begin:0,size:[x,s]}}),Ku(t,E);let _=QL({inputs:{x:y,indices:S},backend:t,attrs:{axis:1,batchDims:1}});Ku(t,y);const $=c.slice(0,-1);$.push(s),E=S,S=Ze({inputs:{x:S},attrs:{shape:$},backend:t}),Ku(t,E);const T=_;return _=Ze({inputs:{x:_},attrs:{shape:$},backend:t}),Ku(t,T),[_,S]}const Jke={kernelName:C6,backendName:"webgl",kernelFunc:Qke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e8e{constructor(e,t,r,o,s,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=r==="nearest"?1:2;let l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8e(n){const{inputs:e,backend:t,attrs:r}=n,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,h,p]=o.shape,[g,x]=c??[d,h],y=[u,g,x,p],b=new e8e(d,h,i,a,l,y);return t.runWebGLProgram(b,[o,s],"float32")}const n8e={kernelName:k6,backendName:"webgl",kernelFunc:t8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8e(n){const{inputs:e,attrs:t,backend:r}=n,{axis:o}=t,{x:s}=e;tg(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=r.readSync(s.dataId),{outputValues:a,outputShape:l,indices:c}=nye(i,o,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const o8e={kernelName:S6,backendName:"webgl",kernelFunc:r8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s8e(n){const{inputs:e,backend:t,attrs:r}=n,{value:o}=e;let{axis:s}=r;s<0&&(s+=o.shape.length);const i=o,a=i.shape.length,l=o.shape[s],c=new Array(a-1);let u=0;for(let x=0;x<a;x++)x!==s&&(c[u++]=i.shape[x]);const d=[],h=new Array(a).fill(0),p=i.shape.slice();p[s]=1;const g=new Array(l);for(let x=0;x<g.length;x++){h[s]=x;const y=Kf({inputs:{x:i},backend:t,attrs:{begin:h,size:p}}),b=Ze({inputs:{x:y},backend:t,attrs:{shape:c}});g[x]=b,d.push(y)}return d.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const i8e={kernelName:G2,backendName:"webgl",kernelFunc:s8e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a8e{constructor(e,t){this.variableNames=["x","segmentIds"];const r=e.windowSize,o=e.batchSize,s=e.inSize,i=e.numSegments,a=i*Math.ceil(s/r);this.outputShape=[o,a];const l="0.0",c="sumValue",u=Math.floor(r/4)*4,d=r%4,h=`
        sumValue += dot(values, segFilter);
    `;let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let g="";s%r>0&&(g=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${g}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8e(n){const{inputs:e,backend:t,attrs:r}=n,{x:o,segmentIds:s}=e,{numSegments:i}=r,a=o.shape.length,l=[];let c=0;const u=sr([c],a);let d=o;u!=null&&(d=Jo({inputs:{x:o},backend:t,attrs:{perm:u}}),l.push(d),c=vr(1,a)[0]);const h=VF(d.shape,c,i),p=De([d.shape[c]]),g=Ze({inputs:{x:d},backend:t,attrs:{shape:[-1,p]}});l.push(g);const x=I6(o.dtype),y=(k,N,E,_,$)=>{const T=k.shape[0],D=k.shape[1],A=jF(D,$),M={windowSize:A,inSize:D,batchSize:T,numSegments:$},j=new a8e(M,N),L=t.compileAndRun(j,[k,E],_);if(l.push(L),L.shape[1]===$)return L;const U=sB({backend:t,attrs:{start:0,stop:$,step:1,dtype:"float32"}}),G=iB({inputs:{x:U},backend:t,attrs:{reps:[D/A]}});return l.push(U),l.push(G),y(L,N,G,_,$)},b=y(g,"unsortedSegmentSum",s,x,i),C=Ze({inputs:{x:b},backend:t,attrs:{shape:h}});let S=C;if(u!=null){l.push(C);const k=gu(u);S=Jo({inputs:{x:S},backend:t,attrs:{perm:k}})}return l.forEach(k=>t.disposeIntermediateTensorInfo(k)),S}const c8e={kernelName:q2,backendName:"webgl",kernelFunc:l8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8e=[qye,Xye,Qye,tbe,rbe,ibe,lbe,ube,pbe,gbe,ybe,Cbe,Nbe,Rbe,_be,Fbe,Mbe,jbe,zbe,Ube,Kbe,twe,rwe,awe,cwe,mwe,xwe,wwe,Dye,Swe,Rwe,$we,Bwe,zwe,Uwe,Gwe,Kwe,Qwe,t3e,o3e,i3e,l3e,u3e,f3e,m3e,y3e,w3e,S3e,E3e,R3e,$3e,O3e,V3e,U3e,q3e,K3e,Y3e,Q3e,eCe,nCe,oCe,lCe,dCe,pCe,gCe,yCe,CCe,ICe,DCe,Rye,_Ce,Ewe,PCe,LCe,VCe,_ye,HCe,XCe,ZCe,t4e,o4e,l4e,d4e,m4e,y4e,C4e,S4e,T4e,D4e,_4e,M4e,L4e,j4e,z4e,U4e,K4e,Q4e,n5e,u5e,Pye,p5e,x5e,b5e,k5e,dwe,I5e,T5e,D5e,$5e,O5e,Fye,B5e,V5e,W5e,H5e,G5e,hwe,i5e,X5e,J5e,r6e,Oye,a6e,u6e,p6e,x6e,w6e,k6e,I6e,R6e,_6e,P6e,L6e,V6e,H6e,K6e,Q6e,tke,Jbe,l5e,oke,ike,lke,uke,hke,pke,gke,vke,bke,kke,Nke,Eke,Rke,_ke,Fke,Mke,Lke,a5e,Uye,Vke,Uke,Gke,Xke,Jke,n8e,Hye,o8e,i8e,c8e,E5e];for(const n of u8e)e$(n);function Mp(){return window.__opencvLoad||(window.__opencvLoad={startedAt:null,injected:!1,initialized:!1,ready:!1,timedOut:!1,error:null}),window.__opencvLoad}let _3=null;async function d8e(n={}){return window.cv&&window.cv.Mat?window.cv:(_3||(_3=new Promise(async(e,t)=>{try{const r=Mp();r.startedAt=Date.now();const o=Date.now(),s=n.timeoutMs||2e4,i=()=>{if(window.__cvReady&&window.cv&&window.cv.Mat){const a=Mp();return a.initialized=!0,a.ready=!0,e(window.cv)}if(window.cv&&window.cv.Mat){const a=Mp();return a.ready=!0,e(window.cv)}if(Date.now()-o>s){const a=Mp();return a.timedOut=!0,t(new Error("Timed out waiting for OpenCV initialization"))}setTimeout(i,200)};setTimeout(i,200)}catch(r){const o=Mp();o.error=r&&(r.message||String(r)),t(r)}})),_3)}async function h8e(){try{return await d8e(),!0}catch(n){return console.error("OpenCV failed to load:",n),!1}}function aB({userId:n,onStepComplete:e}){const[t,r]=F.useState(!1),[o,s]=F.useState(!1),[i,a]=F.useState(""),[l,c]=F.useState(""),[u,d]=F.useState(""),[h,p]=F.useState(""),[g,x]=F.useState(""),[y,b]=F.useState(""),[C,S]=F.useState(""),[k,N]=F.useState(""),[E,_]=F.useState(!1),[$,T]=F.useState(""),[D,A]=F.useState(!1),[M,j]=F.useState(!1),[L,U]=F.useState(!1),[G,H]=F.useState(!1),[O,V]=F.useState(!1),[W,B]=F.useState(0),[q,Q]=F.useState(0),[Z,ne]=F.useState(0),[ge,he]=F.useState([]),[Se,Re]=F.useState(!1),[We,Be]=F.useState(!1),[Xe,Ye]=F.useState(""),[ot,Qe]=F.useState(!1),[ct,ie]=F.useState(),[$t,Ot]=F.useState(!1),[qt,en]=F.useState(""),[hn,cn]=F.useState(0),[tn,Ht]=F.useState([3,4,3]),[Yt,ye]=F.useState(null),[Fe,Oe]=F.useState(0),[xt,at]=F.useState(0),[Lt,St]=F.useState(0),[Rt,On]=F.useState(null),[ir,En]=F.useState(!0),[xo,Er]=F.useState({}),[gs,zn]=F.useState({}),[er,ar]=F.useState({}),[Vs,Ft]=F.useState({}),[un,Pt]=F.useState({}),[Tr,vo]=F.useState({log:(de,te)=>console.log(`[${de}]`,te)}),[we,Ne]=F.useState(!1),[fe,$e]=F.useState(null),[st,dt]=F.useState(null),[qn,vn]=F.useState(null),[Vr,nn]=F.useState(!1),[Pn,zs]=F.useState("forward"),[ku,Ws]=F.useState(!1),Ln=F.useRef(null),hi=F.useRef(null),no=F.useRef(null),Rr=F.useRef(null),tr=F.useRef(null),Ny=F.useRef(void 0),qd=F.useRef(null),yn=F.useRef(null),uc=F.useRef(null),wl=F.useRef(null),yo=F.useRef({cx:0,cy:0,rOuter:0,rInner:0,w:0,h:0}),Kd=F.useRef(0),fi=F.useRef(null),Xf=F.useRef(100),Li=F.useRef(0),ts=F.useRef(0),Iy=F.useRef(0),ns=F.useRef(null),Yf=F.useRef(null),Su=F.useRef([]),xs=F.useRef(0);F.useRef([]);const vs=F.useRef({}),Bi=F.useRef([]),ba=F.useRef({});F.useRef({});const ys=F.useRef({}),Zf=F.useRef({}),dc=F.useRef({}),Qf=F.useRef({});F.useRef({});const ro=F.useRef(0);F.useRef(!0);const Nu=F.useRef(!1),Cl=F.useRef(!1),ji=F.useRef(!1),Xd=F.useRef(null),bn=F.useRef({}),Vi=F.useRef(!1),Jf=F.useRef(!1),Yd=F.useRef(0),Iu=F.useRef(null),hc=F.useRef(!1),Dr=F.useRef(0),fc=F.useRef(0),pc=F.useRef(0),oo=F.useRef(!1),$o=F.useRef(!1),zr=F.useRef(0),wa=F.useRef(0),bo=F.useRef(!1),Us=F.useRef(!1),sg=F.useRef(!1),pi=F.useRef(!1),Hs=F.useRef(!1),kl=F.useRef(!1),Zd=F.useRef(!1),Eu=F.useRef({}),Sl=F.useRef(!1),Tu=F.useRef(!1);F.useRef(void 0),F.useRef(void 0);const Ca=F.useRef(null),Rn=F.useRef({log:(de,te)=>console.log(`[${de}]`,te)}),Nl=1,Ru=6,Gs=3,Qd=10,Jd=2,eh=5,th=3,ig=3,ka=767,nh=4500;F.useEffect(()=>{let de=!1;return(async()=>{try{ag(),console.log("Setting TensorFlow.js backend to webgl..."),await Qne("webgl"),await Jne(),console.log("TensorFlow backend:",ere()),console.log("Loading face-api models..."),await Promise.all([Yo.tinyFaceDetector.loadFromUri("/assets/weights"),Yo.faceLandmark68Net.loadFromUri("/assets/weights"),Yo.faceRecognitionNet.loadFromUri("/assets/weights"),Yo.faceExpressionNet.loadFromUri("/assets/weights")]),console.log(" FaceAPI models loaded"),console.log("Loading OpenCV.js...");try{await h8e(),de||H(!0),console.log(" OpenCV.js ready")}catch(je){console.error("Failed to load OpenCV.js",je)}console.log("Starting camera..."),await Ey()}catch(je){if(console.error("Camera initialization failed:",je),de)return;je?.name==="NotAllowedError"?d(" Camera permission denied. Please allow access and refresh."):je?.name==="NotFoundError"?d(" No camera found on this device."):d(" Failed to access the camera. Try again."),r(!1)}})(),()=>{de=!0,qd.current!==null&&(cancelAnimationFrame(qd.current),qd.current=null),yn.current&&(clearInterval(yn.current),yn.current=null),Rr.current&&(Rr.current.getTracks().forEach(je=>je.stop()),Rr.current=null)}},[]);const Tt=F.useCallback((de,te,je=!1,Pe=2e3,Je=1e3)=>{(!de||!["statusMessage","dashedCircleAlignMessage","cameraErrorMessage","brightnessMessage","ovalAlignMessage","distanceMessage","recordingMessage","verificationMessage","mobileStatusMessage","headTurnAttemptStatus"].includes(de))&&(console.warn(` Unknown or empty message key provided: ${de}. Falling back to 'statusMessage'.`),de="statusMessage");let _e;try{typeof te=="string"?_e=te:te==null?_e="":typeof te=="object"?_e=JSON.stringify(te):_e=String(te)}catch{_e=String(te)}if(bn.current[de])return;const rt={statusMessage:()=>i,dashedCircleAlignMessage:()=>l,cameraErrorMessage:()=>u,brightnessMessage:()=>h,ovalAlignMessage:()=>g,distanceMessage:()=>y,recordingMessage:()=>C,verificationMessage:()=>k,mobileStatusMessage:()=>$,headTurnAttemptStatus:()=>Xe};if((rt[de]?.()??"")===_e)return;const an={statusMessage:a,dashedCircleAlignMessage:c,cameraErrorMessage:d,brightnessMessage:p,ovalAlignMessage:x,distanceMessage:b,recordingMessage:S,verificationMessage:N,mobileStatusMessage:T,headTurnAttemptStatus:Ye};M?(T(_e),an[de]?.("")):(an[de]?.(_e),T("")),je&&setTimeout(()=>{(rt[de]?.()??"")===_e&&(an[de]?.(""),M&&$===_e&&T(""),bn.current[de]=!0,setTimeout(()=>{bn.current[de]=!1},Je))},Pe)},[M,i,l,u,h,g,y,C,k,$,Xe]);function ag(){if(typeof window>"u")return!1;const de=window.innerWidth<=ka;return j(de),de}const Du=F.useCallback(()=>{const de=Math.floor(Math.random()*2)+2,te=Math.floor(Math.random()*3)+2,je=Math.max(Qd-(de+te),1);Ht([de,te,je]),console.log(` Segment durations: [${de}s, ${te}s, ${je}s] = ${de+te+je}s total`)},[Qd]),Au=F.useCallback(de=>!Rr.current||!Ln.current?(console.log("info","Camera off or video element missing; stopping detection loop."),!1):!0,[]),Sa=F.useCallback(de=>{qd.current=requestAnimationFrame(de)},[]),Fo=F.useCallback(de=>yo.current?!0:(console.log("info","Oval guide not initialized yet; scheduling next frame."),Sa(de),!1),[Sa]),Il=F.useCallback(()=>{if(!fi.current)return 0;const de=no.current.width,te=no.current.height;fi.current.drawImage(Ln.current,0,0,de,te);const je=fi.current.getImageData(0,0,de,te).data;let Pe=0;const Je=je.length/4;for(let Ge=0;Ge<je.length;Ge+=4){const _e=je[Ge],rt=je[Ge+1],Bt=je[Ge+2];Pe+=.2126*_e+.7152*rt+.0722*Bt}return Pe/Je},[]),Na=F.useCallback(de=>{const te=hi.current.getContext("2d"),je=hi.current.width,Pe=hi.current.height;te.clearRect(0,0,je,Pe);const Je=je/2,Ge=Pe/2,_e=Math.min(je,Pe)*.35,rt=_e*1.2;de<60?te.fillStyle="white":de>180?te.fillStyle="black":te.fillStyle="rgba(0, 0, 0, 0.6)",te.fillRect(0,0,je,Pe),te.globalCompositeOperation="destination-out",te.beginPath(),te.arc(Je,Ge,rt,0,2*Math.PI),te.fill(),te.globalCompositeOperation="source-over";let Bt="#ffffff";if(O&&(Yd.current<6&&Yd.current>0||o)&&(Bt="#16a34a"),te.beginPath(),te.arc(Je,Ge,rt,0,2*Math.PI),te.setLineDash([]),te.lineWidth=5,te.strokeStyle=Bt,te.stroke(),te.beginPath(),te.arc(Je,Ge,_e,0,2*Math.PI),te.setLineDash([8,6]),te.lineWidth=3,te.strokeStyle="#ffffff",te.stroke(),Iu.current&&hc.current){te.beginPath(),te.lineWidth=12,te.strokeStyle="rgba(0, 191, 255, 1)",te.shadowColor="rgba(0, 191, 255, 0.7)",te.shadowBlur=20;const an=rt+10;let dn,Wn;switch(Iu.current){case"left":dn=-Math.PI*.5,Wn=Math.PI*.5;break;case"right":dn=Math.PI*.5,Wn=Math.PI*1.5;break;case"down":dn=0,Wn=Math.PI;break;case"up":dn=Math.PI,Wn=Math.PI*2;break;case"forward":dn=0,Wn=Math.PI*2;break;default:dn=0,Wn=0;break}te.arc(Je,Ge,an,dn,Wn),te.stroke(),te.shadowBlur=0}if(te.font="18px Arial",te.fillStyle="#ffffffff",te.textAlign="center",te.fillText("Align your face within the white circles",Je,Ge+rt+20),O){Iy.current++;const an=-Math.PI/2,dn=an+2*Math.PI*Kd.current;te.beginPath(),te.arc(Je,Ge,_e,an,dn),te.strokeStyle="#16a34a",te.lineWidth=4,te.stroke()}yo.current={cx:Je,cy:Ge,rOuter:_e,rInner:_e*.7,w:_e*2,h:_e*2}},[O,o]),mc=F.useCallback(()=>{if(!fi.current)return!0;fi.current.drawImage(Ln.current,0,0,no.current.width,no.current.height);const de=fi.current.getImageData(0,0,no.current.width,no.current.height).data;let te=0;const je=30;for(let Je=0;Je<de.length;Je+=4){const Ge=de[Je],_e=de[Je+1],rt=de[Je+2];Ge<je&&_e<je&&rt<je&&te++}return te/(de.length/4)>.95},[]),rh=F.useCallback(async()=>{if(!wl.current)return console.log("info","[FaceCheck] No reference descriptor; skipping check."),!1;try{if(!Ln.current)return!1;const de=await P0(Ln.current,new Bp).withFaceLandmarks().withFaceDescriptor();if(de&&de.descriptor){const te=S_(wl.current,de.descriptor);if(console.log("info",`[FaceCheck] distance=${te.toFixed(3)}, counter=${xs.current}`),te>.6){if(xs.current++,console.log("warn",`[FaceCheck] Mismatch counter incremented: ${xs.current}`),Tt("verificationMessage"," Possible different face detected"),xs.current>=ig){if(console.log("error",`[FaceCheck]  Different face confirmed (${xs.current} checks)`),xs.current=0,Tu.current=!0,tr.current&&tr.current.state==="recording")try{tr.current.pause()}catch{}return!0}}else if(xs.current>0&&console.log("info","[FaceCheck] Face match restored, counter reset."),xs.current=0,Tu.current&&(Tu.current=!1,tr.current&&tr.current.state==="paused"&&!Sl.current&&oo.current))try{tr.current.resume()}catch{}}else console.log("warn","[FaceCheck]  No face detected (null detection)"),xs.current=0}catch(de){console.log("error",`[FaceCheck]  Error during face detection: ${de}`),xs.current=0}return!1},[Tt]),Ia=de=>{const je=["up","down","left","right","forward"].filter(Pe=>!de.includes(Pe));return je[Math.floor(Math.random()*je.length)]},_u=F.useCallback(de=>{Iu.current=de,hc.current=!0,uc.current&&clearInterval(uc.current),uc.current=setInterval(()=>{hc.current=!hc.current,Na(Xf.current||100)},500)},[Na]),Ea=F.useCallback(()=>{uc.current&&(clearInterval(uc.current),uc.current=null),Iu.current=null,hc.current=!1,Na(Xf.current||100)},[Na]),$u=F.useCallback(de=>new Promise(te=>{try{const je=[];let Pe=null,Je=!1,Ge=!1;try{if(!Rr.current){Rn.current.log("error","[HeadVerification] No stream available"),te(!1);return}Pe=new MediaRecorder(Rr.current,{mimeType:"video/webm;codecs=vp9"})}catch(wn){Rn.current.log("error",`[HeadVerification] Failed to create MediaRecorder: ${wn}`),te(!1);return}Pe.ondataavailable=wn=>{wn.data&&wn.data.size>0&&je.push(wn.data)},Pe.onstop=()=>{const wn=new Blob(je,{type:"video/webm"});ye(wn),Je?(N(" Head movement verified  downloading..."),Rn.current.log("info","[HeadVerification]  Recording complete. Starting download."),Tt("headTurnAttemptStatus"," Head movement verified  downloading..."),te(!0)):(Rn.current.log("info","[HeadVerification]  Recording complete. No verification."),te(!1))};const _e=.35,rt=.38,Bt=.12,an=_e*.2,dn=.27,Wn=.2;Rn.current.log("info",`[HeadVerification] Started. Direction: ${de}, YawThreshold: ${_e}, PitchThreshold: ${rt}`),Tt("headTurnAttemptStatus",`[HeadVerification] Started. Direction: ${de}, YawThreshold: ${_e}, PitchThreshold: ${rt}`),_u(de);try{if(Ca.current){const wn=Ca.current.getContext("2d");wn&&wn.clearRect(0,0,Ca.current.width,Ca.current.height)}}catch(wn){Rn.current.log("warn",`[HeadVerification] Could not clear overlay canvas: ${wn}`)}const $n=wn=>{const wr=wn.getLeftEye(),wo=wn.getRightEye(),Mo=wn.getNose()[3],ws=wr[0],Cs=wo[3],Hi=Math.max(1,Cs.x-ws.x),mi=(ws.x+Cs.x)/2;return(Mo.x-mi)/Hi},rs=wn=>{const wr=wn.getLeftEye(),wo=wn.getRightEye(),Mo=wn.getNose(),ws=wn.getJawOutline(),Cs={x:(wr[0].x+wr[3].x)/2,y:(wr[1].y+wr[5].y)/2},Hi={x:(wo[0].x+wo[3].x)/2,y:(wo[1].y+wo[5].y)/2},mi=(Cs.y+Hi.y)/2,ih=Mo[3],gi=ws[8],Tl=Math.max(1,gi.y-mi);return(ih.y-mi)/Tl};let El=null,Ra=null;const Wi=.06,Da=.05,bs=-.05,Ui=setInterval(async()=>{try{const wn=Ln.current;if(!wn||!yo.current)return;const wr=await P0(wn,new Bp).withFaceLandmarks();if(!wr||!wr.landmarks){Rn.current.log("warn","[HeadVerification] No face detected in current frame");return}const wo=wr.landmarks,Mo=wr.detection.box;if(El===null||Ra===null){El=$n(wo),Ra=rs(wo),Rn.current.log("info",`[HeadVerification] Baseline yaw=${El.toFixed(3)} pitch=${Ra.toFixed(3)}`);return}const ws=Mo.x+Mo.width/2,Cs=Mo.y+Mo.height/2,Hi=ws-yo.current.cx,mi=Cs-yo.current.cy;if(Math.sqrt(Hi*Hi+mi*mi)>yo.current.rOuter){Ge&&Pe&&Pe.state!=="inactive"&&(Rn.current.log("info","[HeadVerification] User moved outside oval, stopping recording."),Pe.stop(),Ge=!1);return}let gi=!1;const Tl=$n(wo),vg=rs(wo),vc=Tl-El,Aa=vg-Ra;if(Rn.current.log("info",`[HeadVerification] Yaw=${vc.toFixed(3)} Pitch=${Aa.toFixed(3)}`),de==="forward"){const Cr=Math.abs(vc)<.03&&Math.abs(Aa)<.03;Ge||(Pe?.start(),Ge=!0,Tt("headTurnAttemptStatus","Capturing face  keep looking STRAIGHT")),Cr?(gi=!0,Je=!0,N(" Face captured (STRAIGHT).")):N(" Keep your face STRAIGHT and STILL")}else if(de==="left"||de==="right"){const Cr=de==="left"&&vc<-Wi||de==="right"&&vc>Wi;!Ge&&Math.abs(vc)>Wi/2&&(Pe?.start(),Ge=!0,Tt("headTurnAttemptStatus",`Capturing head turn (${de.toUpperCase()})`)),Ge&&Math.abs(vc)<Wi/3&&(Pe?.stop(),Ge=!1),Cr?(gi=!0,Je=!0,N(` ${de.toUpperCase()} movement detected.`)):N(`${de==="left"?"":""} Keep turning your head ${de.toUpperCase()}.`)}else if(de==="down"||de==="up"){const Cr=de==="down"&&Aa>Da||de==="up"&&Aa<bs;!Ge&&(de==="down"&&Aa>Da/2||de==="up"&&Aa<bs/2)&&(Pe?.start(),Ge=!0,Tt("headTurnAttemptStatus",`Capturing head movement (${de.toUpperCase()})`)),Ge&&(de==="down"&&Aa<Da/3||de==="up"&&Aa>bs/3)&&(Pe?.stop(),Ge=!1),Cr?(gi=!0,Je=!0,N(` ${de.toUpperCase()} movement detected.`)):N(`${de==="down"?"":""} Keep moving your head ${de.toUpperCase()}.`)}if(gi){Je=!0,Ot(!0),Ea(),clearInterval(Ui),Ws(!0),Pe&&Pe.state!=="inactive"&&Pe.stop(),N(` VERIFIED direction (${de.toUpperCase()})!`),Tt("statusMessage",` VERIFIED direction (${de.toUpperCase()})!`);const Cr=Ln.current;Cr?(Cr.classList.add("selfie-glow-green"),console.log("[HeadVerification]  Added glow-green class to video"),setTimeout(()=>{Cr.classList.remove("selfie-glow-green"),console.log("[HeadVerification] Removed glow-green class from video")},3e3)):console.warn("[HeadVerification]  Could not find video element for glow effect")}}catch(wn){Rn.current.log("error",`[HeadVerification] Sampler error: ${wn}`)}},150);setTimeout(()=>{try{clearInterval(Ui),Ea(),Je||(Ge&&Pe&&Pe.state!=="inactive"&&Pe.stop(),Ot(!1),nn(!0),N(` Head movement (${de.toUpperCase()}) timed out. Please try again.`),Rn.current.log("error",`[HeadVerification]  TIMEOUT after ${nh}ms. Direction: ${de} not verified in time.`),te(!1))}catch(wn){Rn.current.log("error",`[HeadVerification] Timeout cleanup failed: ${wn}`),te(!1)}},nh)}catch(je){Rn.current.log("error",`[HeadVerification] Unexpected error in verification: ${je}`),te(!1)}}),[Tt,_u,Ea,ye,N,Ot,Ws,nn]),ep=F.useCallback(async de=>{try{if(bo.current)return Rn.current.log("info","[HeadVerification] Ignored after session completion"),null;zs(de),Ye(""),Qe(!0),Hs.current=!0,ye(null),Ot(!1);const te=de==="forward"?"Recording face  keep looking STRAIGHT into the camera...":`Recording head movement (${de.toUpperCase()})  keep your face in this direction...`;N(te),Tt("headTurnAttemptStatus",te),await new Promise(Pe=>setTimeout(Pe,100));const je=await $u(de);return await new Promise(Pe=>setTimeout(Pe,3e3)),Qe(!1),Hs.current=!1,je}catch(te){return Rn.current.log("error",`[HeadVerification] Unexpected error: ${te}`),N(" Unexpected error during verification."),Qe(!1),Hs.current=!1,!1}},[t,Tt,$u]),gc=F.useCallback(()=>{B(1),Dr.current=1,ne(0),zr.current=0,V(!1),$o.current=!1,he([]),ro.current=0,Er({}),ys.current={},zn({}),Qf.current={},at(0),dc.current={},Zf.current={},xs.current=0,Ne(!1),$e(null),dt(null),vn(null),pc.current=0,pi.current=!1,kl.current=!1,ji.current=!1,Hs.current=!1,ro.current=0},[]),xc=F.useCallback(async()=>{const de=Dr.current;console.log("info","[HeadVerification] performVerificationForCurrentSegment called for segment",de),Be(!0),kl.current=!0;let te;if(pi.current){Rn.current.log("info","Head verification already in progress; skipping new request.");return}pi.current=!0,Zf.current[de]=!0;const je=Eu.current[de];if(je?(te=je,de===1?$e(te):de===2?dt(te):vn(te)):de===1?(te="forward",$e(te)):de===2?(te=Ia([fe]),dt(te)):(te=Ia([fe,st]),vn(te)),ie(te),Tt("headTurnAttemptStatus",`Please ${te==="left"?"turn your head LEFT and KEEP it there":te==="right"?"turn your head RIGHT and KEEP it there":te==="up"?"tilt your head UP and KEEP it there":te==="down"?"tilt your head DOWN and KEEP it there":"look STRAIGHT into the camera and KEEP your face still"}`),bo.current){Rn.current.log("info","Head verification prompt suppressed after session completion."),pi.current=!1;return}if(Rn.current.log("info",`Prompting user to ${te}`),Rt&&Rt.state==="recording"&&Rt.pause(),console.log("info","[HeadVerification] Checking stream readiness. streamRef.current=",!!Rr.current),!Rr.current){const _e=Ln.current;_e&&_e.srcObject instanceof MediaStream&&(Rr.current=_e.srcObject,console.log("info","[HeadVerification] Recovered stream from video element  proceeding"))}if(!Rr.current){console.log("warn","[HeadVerification] Deferring  stream not ready (post-recovery)"),pi.current=!1,Be(!1),kl.current=!0,setTimeout(()=>{console.log("info","[HeadVerification] Re-attempting after deferral..."),bo.current||xc()},1200);return}console.log("info","[HeadVerification] Stream ready, proceeding to create headMediaRecorder. Stream has",Rr.current.getTracks().length,"tracks");let Pe;if(MediaRecorder.isTypeSupported("video/webm;codecs=vp9"))Pe={mimeType:"video/webm;codecs=vp9"};else if(MediaRecorder.isTypeSupported("video/webm"))Pe={mimeType:"video/webm"};else if(MediaRecorder.isTypeSupported("video/mp4"))Pe={mimeType:"video/mp4",videoBitsPerSecond:1e5};else{Rn.current.log("error","No supported MIME type found for MediaRecorder on this browser."),Tt("statusMessage"," MediaRecorder MIME type not supported.");return}if(Bi.current=[],St(0),!Rr.current){Tt("statusMessage"," Camera stream not ready for head verification.");return}const Je=new MediaRecorder(Rr.current,Pe);Ny.current=Je,Je.ondataavailable=_e=>{_e.data&&_e.data.size>0&&(Bi.current.push(_e.data),St(rt=>rt+1))},Je.onstop=()=>{if(bo.current){Rn.current.log("info","Head verification stop ignored after session completion.");return}const _e=Math.min(Bi.current.length,3),rt=Bi.current.slice(-_e),Bt=new Blob(rt,{type:Pe?.mimeType??"video/webm"});ar(an=>{const dn={...an};dn[W]||(dn[W]=0),dn[W]++;const Wn=dn[W],$n=document.createElement("a");return $n.style.display="none",$n.href=URL.createObjectURL(Bt),$n.download=`head${Wn}.webm`,document.body.appendChild($n),$n.click(),setTimeout(()=>{URL.revokeObjectURL($n.href),document.body.removeChild($n)},100),Tt("statusMessage",`Head verification video head${Wn}.webm downloaded.`),dn}),Bi.current=[],St(0)},Je.start(1e3);const Ge=await ep(te);if((Je.state==="recording"||Je.state==="paused")&&Je.stop(),Be(!1),Ge===!0){const _e=Dr.current;if(Er(rt=>({...rt,[_e]:!0})),dc.current[_e]=!0,ys.current[_e]=!0,console.log("info",`[HeadVerification]  SUCCESS for segment ${_e}. verificationDoneForSegmentRef is now:`,ys.current),at(0),zn(rt=>({...rt,[_e]:0})),Tt("headTurnAttemptStatus",` Head turn verified for segment ${_e}.`),!bo.current){const rt=zr.current,Bt=tn[_e-1];console.log("info",`[HeadVerification] Resuming segment ${_e} from ${rt}s (target: ${Bt}s)`),console.log("info","   This will trigger immediate completion and move to next segment"),ro.current=1,setTimeout(()=>zi(zr.current),600)}kl.current=!1}else if(Ge===!1){const _e=Dr.current;at(Bt=>Bt+1);const rt=xt+1;zn(Bt=>({...Bt,[_e]:rt})),Tt("headTurnAttemptStatus",` Head turn failed attempt ${rt}. Please try again.`),rt>=Jd?(dc.current[_e]=!1,ys.current[_e]=!0,_e===1?(nn(!0),Tt("headTurnAttemptStatus",` Verification 1 failed ${rt} times. Restarting all segments.`),gc(),setTimeout(()=>zi(0),1e3)):_e===2?(nn(!0),Tt("headTurnAttemptStatus"," Verification 2 failed. Will trigger verification 3 after final video."),Ne(!0),setTimeout(()=>zi(zr.current),600)):(nn(!0),Tt("headTurnAttemptStatus"," Verification 3 failed. Restarting all."),ys.current[_e]=!0,gc(),setTimeout(()=>zi(0),1e3))):setTimeout(()=>xc(),1500)}else Rn.current.log("info","[HeadVerification] Deferred; will retry when camera active"),setTimeout(()=>{t&&!bo.current&&xc()},1500);pi.current=!1},[W,fe,st,Rt,O,xt,Jd,Z,tn,Be,$e,dt,vn,ie,St,ar,Er,at,zn,nn,Ne,Tt,Rn,Bi,Ia,ep,gc,t]),lg=F.useCallback(()=>{if(sg.current){console.log("info","Downloads already triggered; skipping duplicate call.");return}sg.current=!0,console.log("info","[Downloads] Starting download of all segments"),console.log("info","[Downloads] completedSegments count:",ge.length);let de=ge;if(de.length<Gs){console.log("warn",`[Downloads] completedSegments length (${de.length}) < totalSegments (${Gs}). Attempting rebuild from recordedChunks refs.`);const te=[];for(let je=1;je<=Gs;je++){const Pe=vs.current[je];if(Pe&&Pe.length>0)try{const Je=new Blob(Pe,{type:"video/webm"});te.push(Je),console.log("info",`[Downloads] Rebuilt blob for segment ${je} with ${Pe.length} chunks.`)}catch(Je){console.log("error",`[Downloads] Failed to rebuild blob for segment ${je}:`,Je)}else console.log("warn",`[Downloads] No chunks found for segment ${je} during rebuild.`)}te.length>0?(de=te,console.log("info",`[Downloads] Using rebuilt blobs (count=${te.length}) for download.`)):console.log("error","[Downloads] Rebuild failed: no segment blobs available. Downloads will be skipped.")}de.forEach((te,je)=>{const Pe=je+1,Je=je*300;setTimeout(()=>{try{const Ge=`segment_${Pe}.webm`,_e=URL.createObjectURL(te),rt=document.createElement("a");rt.href=_e,rt.download=Ge,rt.style.display="none",document.body.appendChild(rt),rt.click(),setTimeout(()=>{document.body.removeChild(rt),URL.revokeObjectURL(_e)},1e3),console.log("info",`[Downloads] Triggered: ${Ge}`)}catch(Ge){console.log("error","[Downloads] Failed to trigger download:",Ge)}},Je)}),Object.keys(Vs||{}).forEach(te=>{Vs[parseInt(te)].forEach((Pe,Je)=>{let Ge;if(Pe&&typeof Pe=="object"&&Pe.startTime!==void 0&&Pe.endTime!==void 0){const an=Math.floor(Pe.startTime),dn=Math.floor(Pe.endTime);Ge=`segment_${te}_${an}-${dn}_(${Je+1}).webm`}else Ge=`segment_${te}_partial_${Je+1}.webm`;const _e=Pe&&Pe.blob?Pe.blob:Pe,rt=URL.createObjectURL(_e),Bt=document.createElement("a");Bt.href=rt,Bt.download=Ge,Bt.click(),URL.revokeObjectURL(rt),Rn.current?.log("info",`Downloaded: ${Ge}`)})}),a("Downloads complete  (only verified segments)"),bo.current=!0,Us.current=!0,console.log(" Session fully completed. Awaiting manual restart."),console.log(" Calling onStepComplete(7)"),e?.(7)},[ge,Vs,Yt,gs,a,gc,e]),oh=F.useCallback(async()=>{if(bo.current){console.log("info","[onSegmentComplete] Ignored because sessionCompletedRef is true");return}const de=Dr.current||W;if(de<Gs){const te=de+1;B(te),Dr.current=te,pc.current=0,ro.current=1,setTimeout(()=>{zi(0)},600)}else{const te=!!ys.current[3];console.log("info",`[onSegmentComplete] Final segment. triggerVerification3=${we}, segment3Done=${te}`),we&&!te?(console.log("info","[onSegmentComplete] Segment 2 verification failed, triggering verification 3"),await xc()):(console.log("info","[onSegmentComplete] All segments and verifications complete! Completing session."),V(!1),$o.current=!1,bo.current=!0,Us.current=!0,setTimeout(()=>{lg()},3e3),A(!0))}},[W,Gs,we,xo,Tt,B,pc,xc,V,lg,A]),cg=F.useCallback(de=>{if(console.log("info",`[shouldVerifyAfterSegment] Called for segment ${de}`),de===1||de===2){const te=!!ys.current?.[de],je=!te;return console.log("info",`[shouldVerifyAfterSegment] Segment ${de} done=${te} -> return ${je}`),je}if(de===3){const te=dc.current?.[2]===!1;return console.log("info",`[shouldVerifyAfterSegment] Segment 3: segment2Failed=${te} -> return ${te}`),te}return console.log("info",`[shouldVerifyAfterSegment] Segment ${de} -> returning FALSE`),!1},[]),zi=F.useCallback(async(de=0)=>{if(Vi.current){console.log("warn","Start already in progress - ignoring duplicate call.");return}if(bo.current||Us.current){console.log("info","[startSegment] Aborting start because sessionCompletedRef or autoStartDisabledRef is true");return}Vi.current=!0;try{if(!Rr.current){Tt("statusMessage"," Camera not initialized.");return}let te=Dr.current||W;(!te||te<=0)&&(te=1,B(1),Dr.current=1,console.log("warn","currentSegment was 0 or invalid, reset to 1."));let je;if(de===0)if(vs.current[te]=[],Pt(Ge=>({...Ge,[te]:[]})),MediaRecorder.isTypeSupported("video/webm;codecs=vp9"))je={mimeType:"video/webm;codecs=vp9"};else if(MediaRecorder.isTypeSupported("video/webm"))je={mimeType:"video/webm"};else if(MediaRecorder.isTypeSupported("video/mp4"))je={mimeType:"video/mp4",videoBitsPerSecond:1e5};else{console.log("info","No supported MIME type found for MediaRecorder on this browser."),Tt("statusMessage"," MediaRecorder MIME type not supported.");return}else MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?je={mimeType:"video/webm;codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm")?je={mimeType:"video/webm"}:MediaRecorder.isTypeSupported("video/mp4")&&(je={mimeType:"video/mp4",videoBitsPerSecond:1e5});de===0&&!O?(console.log("info","Starting fresh new segment recording."),ji.current=!1,te===1&&Z==null&&(he([]),Er({}),zn({}),ar({}),ba.current={}),ne(0),zr.current=0,Oe(0),wa.current=0,En(!0),V(!0),at(0),fc.current=0,Er(Ge=>({...Ge,[te]:!1})),ys.current[te]=!1,zn(Ge=>({...Ge,[te]:0})),ar(Ge=>({...Ge,[te]:0}))):(ne(de),zr.current=de,Oe(0),wa.current=0,fc.current=de,Pt(Ge=>({...Ge,[te]:[]})));const Pe=new MediaRecorder(Rr.current,je);tr.current=Pe,On(Pe),V(!0),$o.current=!0,console.log("info","MediaRecorder created",{state:Pe.state,options:je});const Je=tn[te-1]||Qd/Gs;if(Q(Je-Z),(!tn||tn.length===0)&&console.log("warn","Segment durations not initialized yet, using default values"),Je-Z<=0){console.log("info","Segment duration already met or exceeded, calling _onSegmentComplete."),await oh();return}Tt("recordingMessage",` Recording segment ${te}/${Gs}  keep your face FORWARD and still (${Je-Z}s remaining)`),Pe.ondataavailable=Ge=>{Ge.data&&Ge.data.size>0&&(console.log("info",` ondataavailable: received chunk of size ${Ge.data.size} bytes`),oo.current&&!Sl.current&&!Tu.current&&(vs.current[te]||(vs.current[te]=[]),vs.current[te].push(Ge.data),Pt(_e=>({..._e,[te]:[...vs.current[te]]}))))},Pe.onstop=async()=>{console.log("info",` [onstop] ENTERED for segment ${te}`),Vi.current=!1;const Ge=zr.current,_e=vs.current[te]?.length||0,rt=Ge>=Je,Bt=_e>0;if(console.log("info",` onstop: wasFaceDetected(ref)=${oo.current}, isSegmentValid=${ir}, hasEnoughTime=${rt} (${Ge}>=${Je}), hasValidChunks=${Bt} (${_e} chunks)`),ro.current=0,Nu.current){const Wn=Ge-fc.current;if(Bt&&Wn>0){const $n=vs.current[te],rs=new Blob($n,{type:je?.mimeType??"video/webm"});ba.current[te]||(ba.current[te]=[]),ba.current[te].push({blob:rs,startTime:fc.current,endTime:Ge,duration:Wn})}Nu.current=!1,Vi.current=!1;return}const an=oo.current;if(ir&&rt&&Bt){const Wn=vs.current[te],$n=new Blob(Wn,{type:je?.mimeType??"video/webm"});he(rs=>[...rs,$n]),console.log("info",` Segment ${te} COMPLETED and saved. Blob size: ${$n.size} bytes, Chunk count: ${Wn.length}`),console.log("info",`   Segment recorded for ${Ge}s (target: ${Je}s)`)}else{console.log("warn",` Segment ${te} incomplete; retrying. (face=${an}, valid=${ir}, time=${rt}, chunks=${Bt})`),setTimeout(()=>zi(Ge),600);return}console.log("info",`[onstop] About to check shouldVerifyAfterSegment(${te})`);const dn=cg(te);if(console.log("info",`[onstop] shouldVerifyAfterSegment(${te}) returned:`,dn),dn){console.log("info",`[onstop] Calling performVerificationForCurrentSegment for segment ${te}`),await xc(),ji.current=!1,Vi.current=!1;return}await oh(),ji.current=!1,ro.current=0,Vi.current=!1},yn.current&&clearInterval(yn.current),yn.current=setInterval(async()=>{if(ro.current===0&&!$o.current){clearInterval(yn.current);return}if(!$o.current){clearInterval(yn.current);return}if(!oo.current){Pe.state==="recording"&&Pe.pause();return}if(Sl.current||Tu.current){Pe.state==="recording"&&Pe.pause();return}if(Pe.state==="paused"&&Pe.resume(),Pe.state==="recording"){const Ge=zr.current;if(console.log("info",` Timer tick: currentSeconds=${Ge}, target=${Je}`),Ge<Je){const _e=Ge+1;if(zr.current=_e,ne(_e),Q(Je-_e),await rh()){En(!1),Tt("verificationMessage"," Different face detected for several seconds! Restarting from scratch..."),clearInterval(yn.current),gc(),Po(),(Pe.state==="recording"||Pe.state==="paused")&&Pe.stop();return}}else{const _e=wa.current;if(Ge!==Je&&_e<1){wa.current=_e+1,Oe(_e+1),console.log("info",` Adding extra second buffer for timing mismatch (extra=${_e+1})`);return}console.log("info",` Segment complete at ${Ge}s (target: ${Je}s, extra=${_e}), stopping recorder`),ji.current=!0,clearInterval(yn.current),(Pe.state==="recording"||Pe.state==="paused")&&Pe.stop();return}}},1e3),console.log("info","Starting MediaRecorder..."),Pe.start(1e3),console.log("info","MediaRecorder started, state=",Pe.state)}catch(te){Tt("statusMessage"," Unable to start recording segment. Please try again."),console.error("Failed to start recording:",te),Vi.current=!1}},[Rr.current,W,Z,tn,Qd,Gs,O,o,ir,un,Tt,Tr,he,Er,zn,ar,Ft,ne,Oe,En,V,at,On,Q,Pt,cg,rh,gc]),Po=F.useCallback(()=>{if(console.log("info","Attempting to restart current segment due to face loss."),Cl.current){console.log("warn","Restart called but cooldown active. Ignoring.");return}if(Cl.current=!0,console.log("info","Restart cooldown activated."),tr.current&&tr.current.state==="recording"){Nu.current=!0,Tt("verificationMessage"," Recording reset due to face loss. Continuing from current progress..."),console.log("warn","Recording reset due to face loss or quality issues."),clearInterval(yn.current),console.log("info","Timer interval cleared.");try{console.log("info",`Stopping mediaRecorder. Current state: ${tr.current.state}`),tr.current.stop(),console.log("info","MediaRecorder.stop() called successfully.")}catch(de){console.log("error",`Error stopping mediaRecorder during restart: ${de}`)}}else console.log("info","MediaRecorder not recording or undefined, skipping stop.");setTimeout(()=>{Cl.current=!1,console.log("info","Restart cooldown reset.");const de=Dr.current||W,te=zr.current??0;ys.current[de]=!1,dc.current[de]=!1,Zf.current[de]=!1,xs.current=0,console.log("info",`[Restart] Cleared verification flags for segment ${de}, reset face mismatch counter`);let je;te>1&&Xd.current!==te?(je=te-1,Xd.current=je,console.log("info",`Adjusted segmentSecondsRecorded by -1 for segment ${de}`)):je=te,console.log("info",`Resuming recording from ${je}s for segment ${de}.`),!tr.current||tr.current.state!=="recording"?(console.log("info","Starting segment recording after restart."),zi(je)):console.log("warn","Attempted to restart recording but MediaRecorder is already recording.")},1e3)},[Tt,Z,W]),Ta=F.useCallback((de,te,je,Pe)=>(Tt(de,te),console.log(je,te),O&&Po(),Sa(Pe),!0),[Tt,O,Po,Sa]),ug=F.useCallback(async(de,te)=>{if(!Ln.current)return!1;const je=await sne(Ln.current,te),Pe=yo.current;if(!Pe)return!1;const{cx:Je,cy:Ge,rOuter:_e}=Pe,rt=_e*1.2;if(je.filter(an=>{const dn=an.box.x+an.box.width/2,Wn=an.box.y+an.box.height/2,$n=dn-Je,rs=Wn-Ge;return Math.sqrt($n*$n+rs*rs)<=rt}).length>1){if(Sl.current=!0,tr.current&&tr.current.state==="recording")try{tr.current.pause()}catch{}return Ta("verificationMessage"," Multiple faces detected. Ensure only one face remains.","warn",de)}else Sl.current&&(Sl.current=!1,Tt("verificationMessage",""));return!1},[O,ot,Po,Ta,Tt]),tp=F.useCallback(()=>{try{if(!G||!window.cv||!window.cv.imread)return null;const de=document.createElement("canvas");return de.width=Ln.current.videoWidth,de.height=Ln.current.videoHeight,de.getContext("2d").drawImage(Ln.current,0,0,de.width,de.height),window.cv.imread(de)}catch(de){return console.error("Error reading frame for OpenCV:",de),null}},[G]),dg=F.useCallback(de=>{try{if(!G||!window.cv||!de)return"";const te=230,je=500,Pe=7e4,Je=20,Ge=180,_e=.3,rt=1.3,Bt=window.cv;let an=new Bt.Mat;Bt.cvtColor(de,an,Bt.COLOR_RGBA2GRAY);const dn=an.rows,Wn=an.cols,$n=Math.floor(Wn/2),rs=Math.floor(dn/2),El=yo.current?.rInner||Math.max(Math.min($n,rs)-10,1);let Ra=new cv.Mat;cv.threshold(an,Ra,te,255,cv.THRESH_BINARY);let Wi=cv.Mat.zeros(an.rows,an.cols,cv.CV_8UC1);cv.circle(Wi,new cv.Point($n,rs),El,new cv.Scalar(255,255,255),-1);let Da=new cv.Mat;cv.bitwise_and(Ra,Wi,Da);let bs=new cv.MatVector,Ui=new cv.Mat;cv.findContours(Da,bs,Ui,cv.RETR_EXTERNAL,cv.CHAIN_APPROX_SIMPLE);let wn=!1;for(let wr=0;wr<bs.size();wr++){let wo=bs.get(wr),Mo=cv.contourArea(wo);if(Mo<je||Mo>Pe)continue;let ws=cv.minEnclosingCircle(wo),Cs=ws.radius,Hi=ws.center.x,mi=ws.center.y;if(Math.sqrt((Hi-$n)**2+(mi-rs)**2)>El||Cs<Je||Cs>Ge)continue;let gi=cv.arcLength(wo,!0);if(gi===0)continue;let Tl=4*Math.PI*(Mo/(gi*gi));if(Tl>=_e&&Tl<=rt){console.log(`[BrightnessCheck] Contour ${wr} matched: area=${Mo}, radius=${Cs}, circularity=${Tl.toFixed(2)}`),wn=!0;break}}return an.delete(),Ra.delete(),Wi.delete(),Da.delete(),bs.delete(),Ui.delete(),wn?"spot detected":"no spot detected"}catch(te){return console.error("Bright spot detection error:",te),"error"}},[]),hg=F.useCallback(()=>{if(!fi.current||!G)return!1;fi.current.drawImage(Ln.current,0,0,no.current.width,no.current.height);const te=fi.current.getImageData(0,0,no.current.width,no.current.height).data;let je=0,Pe=0;for(let _e=0;_e<te.length;_e+=4){const rt=te[_e],Bt=te[_e+1],an=te[_e+2],dn=.299*rt+.587*Bt+.114*an;je+=dn,Pe+=dn*dn}const Je=je/(te.length/4);return Pe/(te.length/4)-Je*Je<50},[G]),fg=F.useCallback(async de=>{const te=Il();if(console.log("info",`[BrightnessCheck] Frame brightness: ${te}`,"brightness"),Na(te),mc())return O&&Po(),console.log("warn","[BrightnessCheck] Camera feed appears blank.","cameraError"),Ta("cameraErrorMessage"," Camera feed appears blank. Check your camera or refresh the page.","warn",de);const je=tp();let Pe=!1;if(je){const Je=dg(je);console.log("info",`[BrightnessCheck] Bright spot detection result: ${Je}`,"brightness"),je.delete(),Je==="spot detected"&&(Pe=!0)}else Jf.current||(console.log("warn","[BrightnessCheck] Failed to get current frame as Mat (OpenCV not ready). Suppressing further warnings.","cameraError"),Jf.current=!0);return Pe?(O&&!ot&&Po(),console.log("warn","[BrightnessCheck] Bright spot detected in the oval.","brightnessWarning"),Ta("brightnessMessage"," Bright spot detected in the oval. Please adjust lighting or avoid reflections.","warn",de)):te<60?(O&&!ot&&Po(),console.log("warn","[BrightnessCheck] Too dark environment detected.","brightnessWarning"),Ta("brightnessMessage"," Too dark  please move to a brighter place.","warn",de)):te>180?(O&&!ot&&Po(),console.log("warn","[BrightnessCheck] Too bright environment detected.","brightnessWarning"),Ta("brightnessMessage"," Too bright  reduce lighting.","warn",de)):(console.log("info","[BrightnessCheck] Brightness is within acceptable range.","brightness"),Tt("brightnessMessage",""),Tt("cameraErrorMessage",""),hg()?(O&&!ot&&Po(),console.log("warn","[BrightnessCheck] Video is blurry detected.","blurWarning"),Ta("dashedCircleAlignMessage"," Video is blurry. Clean your camera lens or adjust focus.","warn",de)):(console.log("info","[BrightnessCheck] No issues detected in current frame.","status"),!1))},[Il,Na,mc,O,Po,Ta,tp,dg,ot,Tt,hg]),pg=F.useCallback(async de=>{if(!Ln.current)return;const te=await P0(Ln.current,de).withFaceLandmarks();ns.current=te?.landmarks??null,Yf.current=te?.detection?.box??null},[]),sh=F.useCallback(de=>{const te=yo.current;if(!te||!de)return!1;const{cx:je,cy:Pe,rOuter:Je}=te,Ge=Je*1.2;return de.positions.every(_e=>{const rt=_e.x-je,Bt=_e.y-Pe;return Math.sqrt(rt*rt+Bt*Bt)<=Ge})},[]),mg=F.useCallback(async de=>{const te=Yf.current,je=ns.current,Pe=yo.current;if(!te||!je||!Pe)return[!1,!1];const Je=te.height/Pe.h*100;Su.current.push(Je),Su.current.length>eh&&Su.current.shift();const Ge=Su.current.reduce((dn,Wn)=>dn+Wn,0)/Su.current.length,_e=55,rt=80;let Bt=!1;Ge<_e?Tt("distanceMessage"," Please move closer to the camera."):Ge>rt?Tt("distanceMessage"," Please move slightly farther away from the camera."):(Bt=!0,Tt("distanceMessage",""));const an=sh(je);return Tt("ovalAlignMessage",an?" Yay! Your face is perfectly inside the oval! ":""),[an,Bt]},[Tt,sh]),gg=F.useCallback(async()=>{if(he([]),ye(null),Re(!1),Ye(""),Be(!1),wl.current=null,pi.current=!1,kl.current=!1,ji.current=!1,Hs.current=!1,ro.current=0,dc.current={},!oo.current){Tt("statusMessage"," Please align your face inside the circle and adjust distance before starting."),console.log("info","Attempted to start recording but no face detected.");return}try{const de=Ln.current;if(!de)console.log("warn","Video element not ready while capturing reference face.");else{const te=await P0(de,new Bp).withFaceLandmarks().withFaceDescriptor();te&&te.descriptor?(wl.current=te.descriptor,console.log("info"," Reference face captured"),Li.current+=1,console.log("Capturing frame",Li.current)):(console.log("warn"," Face not detected clearly; continuing without reference descriptor"),Tt("statusMessage"," Face not detected clearly. Please adjust position."))}}catch(de){console.log("error",` FaceAPI error while capturing reference face: ${de?.message||de}`),Tt("statusMessage"," Error detecting face, continuing with recording.")}(!Dr.current||Dr.current<=0)&&(B(1),Dr.current=1)},[he,ye,Re,Ye,Be,Ln,wl,Li,Dr,Tt]),xg=F.useCallback(de=>{s(!1),oo.current=!1,ts.current=0,O&&!ot&&Po()},[O,ot,Po]),np=F.useCallback(()=>{const de=new Bp,te=async()=>{if(Au(te)&&Fo(te)&&(Li.current++,!(Li.current%Ru===0&&await fg(te)))){if(Li.current%Nl===0){if(await ug(te,de))return;await pg(de)}if(Yf.current&&ns.current){const[je,Pe]=await mg(te);if(Pe&&je){if(ts.current++,Tt("dashedCircleAlignMessage",""),ts.current>=th){s(!0),oo.current=!0,await rh();const Je=tr.current&&(tr.current.state==="recording"||tr.current.state==="paused");if(console.log("info",`Recording flag: ${ro.current}, isRecording: ${O}, recorderState: ${tr.current?.state||"none"}`),console.log("debug",`Ref states -> isRecordingRef=${$o.current}, startingGuard=${Vi.current}`),console.log("info",`Recording flag: ${ro.current}, isRecording(state)=${O}, isRecording(ref)=${$o.current}, recorderState: ${tr.current?.state||"none"}`),bo.current||Us.current)return;if(ji.current){console.log("info"," Processing segment completion, not starting new recording");return}if(ro.current===0&&!Je)if(Hs.current||pi.current||kl.current||ji.current)console.log("info","Deferring segment start. Flags:",{isVerifyingHeadTurn:Hs.current,verificationInProgress:pi.current,verificationPending:kl.current,processingSegmentCompletion:ji.current,recordingFlag:ro.current,currentSegment:Dr.current});else{if((!Dr.current||Dr.current<=0)&&gg(),Zd.current)return;const Ge=Dr.current||1;let _e;if(Ge===1)_e=(()=>{const rt=Ia([]);return rt==="forward"?"up":rt})(),$e(_e);else if(Ge===2)_e=(()=>{const rt=[fe].filter(Boolean),Bt=Ia(rt);return Bt==="forward"?"right":Bt})(),dt(_e);else{const rt=[];fe&&rt.push(fe),st&&rt.push(st),_e=(()=>{const Bt=Ia(rt);return Bt==="forward"?"left":Bt})(),vn(_e)}Eu.current[Ge]=_e,ie(_e),Be(!0),_u(_e),Tt("headTurnAttemptStatus",`Please ${_e==="left"?"turn your head LEFT":_e==="right"?"turn your head RIGHT":_e==="up"?"tilt your head UP":"tilt your head DOWN"} and KEEP it there  recording will start now.`),Zd.current=!0,setTimeout(async()=>{Ea(),Be(!1),console.log("info"," Starting recording after head-turn prompt..."),ro.current=1;try{await zi()}catch(rt){console.log("error",` Error starting segment recording: ${rt}`),ro.current=0}finally{Zd.current=!1}},1200)}else ro.current===1&&!Je&&console.log("info","Waiting for recorder to start...")}}else ts.current=0,s(!1),oo.current=!1,O&&!ot&&Po(),!Pe&&!je?console.log("dashedCircleAlignMessage"," Make sure your full face is inside the dashed circle and adjust distance."):je?console.log("dashedCircleAlignMessage",""):console.log("dashedCircleAlignMessage"," Your entire face must be inside the dashed circle.")}else xg(te);Sa(te)}};Sa(te)},[Au,Fo,fg,ug,pg,mg,Tt,rh,gg,zi,xg,Po,Sa,Ru,Nl,th]),Ey=F.useCallback(async()=>{try{const de=Ln.current,te=hi.current;if(!de||!te){d(" Video or overlay element not available.");return}const je=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480},frameRate:{ideal:30,max:30}},audio:!1});Rr.current=je,de.srcObject=je,await de.play();const Pe=je.getVideoTracks();if(Pe.length){const _e=Pe[0].getSettings();(_e.width&&_e.width<400||_e.height&&_e.height<300)&&d(" Low camera resolution. Face detection may not work properly."),_e.frameRate&&_e.frameRate<15&&d(" Low frame rate. Detection quality may be affected.")}if(await Ty()<10&&d(" Camera FPS is too low for reliable detection."),!de.srcObject||!(de.srcObject instanceof MediaStream)){d(" Camera not providing video. Try refreshing or switching device.");return}r(!0),S(" Camera started successfully."),Ry();const Ge=()=>{const _e=de.videoWidth||640,rt=de.videoHeight||480;te.width=_e,te.height=rt,yo.current.w=_e*.5,yo.current.h=rt*.6,yo.current.cx=_e/2,yo.current.cy=rt/2,no.current||(no.current=document.createElement("canvas")),no.current.width=_e,no.current.height=rt;const Bt=no.current.getContext("2d",{willReadFrequently:!0});fi.current=Bt};Ge(),de.addEventListener("loadedmetadata",Ge,{once:!0}),Du(),np(),console.log("info","Started detection loop via requestAnimationFrame.")}catch(de){const te=de?.name;d(te==="NotAllowedError"?" Camera permission denied. Please allow access and refresh.":te==="NotFoundError"?" No camera found on this device.":" Failed to access the camera. Try again."),r(!1)}},[Ln,hi,r,S,d,Du,np]),Ty=F.useCallback(()=>new Promise(de=>{let te=0,je=performance.now();const Pe=()=>{te++,performance.now()-je>=1e3?de(te):requestAnimationFrame(Pe)};Pe()}),[]),Ry=F.useCallback(()=>{if(!Ln.current)return;const de=Ln.current.videoWidth,te=Ln.current.videoHeight;console.log(` Video resolution: ${de}x${te}`),(de<400||te<300)&&console.log("cameraErrorMessage"," Low camera resolution. Face detection may not work properly.")},[]);return v.jsxs("div",{className:"selfie-app-root",children:[v.jsx("h2",{children:"Face Recording App "}),v.jsx("h3",{className:"note",children:" Please remove any accessories on your face (e.g. glasses)"}),ot&&v.jsxs("h3",{className:"head-turn-instruction",children:[" Move your head toward the ",v.jsx("span",{style:{color:"rgb(35, 27, 148)"},children:"blinking arc"})," and hold"]}),v.jsx("div",{className:"selfie-video-wrapper",children:v.jsxs("div",{className:"selfie-video-container",children:[v.jsxs("div",{className:"selfie-video-area",children:[v.jsx("video",{ref:Ln,autoPlay:!0,playsInline:!0,muted:!0}),v.jsx("canvas",{ref:hi}),v.jsx("div",{className:"oval-overlay"})]}),(C||O)&&v.jsx("div",{className:"below-video-message",style:{marginTop:"8px",textAlign:"center"},children:v.jsx("span",{style:{color:"#dc2626",fontWeight:600},children:C||" Recording in progress  keep your face in the required direction until the video is captured."})}),O&&v.jsxs("div",{className:"selfie-recording-panel",children:[v.jsxs("div",{className:"info",children:[!t&&v.jsx("p",{children:" Start the camera to begin."}),t&&!O&&ge.length<Gs&&v.jsxs("p",{children:[" Ready  Keep your face inside the oval (7585% height), then hit ",v.jsx("strong",{children:"Start"}),"."]})]}),i&&v.jsx("div",{className:"selfie-global-status",children:i}),v.jsx("p",{children:" Recording "}),v.jsxs("p",{children:[" Time left: ",q,"s"]})]}),!M&&v.jsxs("div",{className:"selfie-status-messages",children:[v.jsx("div",{className:"selfie-status-bubble-container",children:v.jsx("div",{className:`selfie-status-bubble${u&&u!==" No camera issues"?" selfie-error":""}`,children:u||" No camera issues"})}),v.jsx("div",{className:"selfie-status-bubble-container",children:v.jsx("div",{className:`selfie-status-bubble${h&&h!==" Brightness looks good"?" selfie-error":""}`,children:h||" Brightness looks good"})}),v.jsx("div",{className:"selfie-status-bubble-container",children:v.jsx("div",{className:`selfie-status-bubble${g?" selfie-green":" selfie-yellow"}`,children:g||"Please align your face inside the circle"})}),v.jsx("div",{className:"selfie-status-bubble-container",children:v.jsx("div",{className:`selfie-status-bubble${y&&y!==" You are at the right distance"?" selfie-error":""}`,children:y||" You are at the right distance"})}),v.jsx("div",{className:"selfie-status-bubble-container",children:v.jsx("div",{className:`selfie-status-bubble${C?" selfie-blue":" selfie-green"}`,children:C||" Ready to record"})}),v.jsx("div",{className:"selfie-status-bubble-container",children:v.jsx("div",{className:`selfie-status-bubble${k&&k.toLowerCase().includes("error")?" selfie-error":""}`,children:k||" Verification in progress... please wait! "})}),v.jsx("div",{className:"selfie-status-bubble-container",children:v.jsx("div",{className:`selfie-status-bubble${l&&l!==" Face inside dashed circle"?" selfie-error":""}`,children:l||" Face inside dashed circle"})}),v.jsx("div",{className:"selfie-status-bubble-container",children:v.jsx("div",{className:`selfie-status-bubble${Xe&&Xe.toLowerCase().includes("not")?" selfie-error":""}`,children:Xe||"Waiting for action..."})})]})]})}),M&&$&&v.jsx("div",{className:"selfie-mobile-status-message",children:$}),!O&&ge.length===Gs&&v.jsxs("div",{className:"post-record",children:[v.jsxs("p",{children:[" All ",Gs," segments recorded.",v.jsx("br",{}),"Please complete ",v.jsx("strong",{children:"head-turn verification"})," before download."]}),Xe&&v.jsx("div",{className:"attempt",children:Xe})]}),v.jsx("pre",{children:qt}),D&&v.jsx("div",{className:"selfie-success-overlay",children:v.jsxs("div",{className:"selfie-success-message",children:[v.jsx("h1",{children:" Successfully Completed"}),v.jsx("p",{children:"Your video segments have been verified and downloaded."})]})})]})}function lB({message:n}){return v.jsx("div",{className:"flex w-full flex-col items-center justify-center gap-2 text-center px-4 py-8",children:v.jsxs("div",{className:"flex flex-col items-center gap-2",children:[v.jsxs("svg",{className:"w-[270px] h-[124px] max-w-full",width:"270",height:"124",viewBox:"0 0 270 124",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M85.3279 22.1817L78.0773 24.5986C77.434 24.813 77 25.4151 77 26.0933V64.3453C77 65.2155 77.7054 65.9209 78.5755 65.9209H191.227C192.097 65.9209 192.802 65.2155 192.802 64.3453V35.9856C194.546 23.1968 184.36 21.4894 177.822 22.3318C176.954 22.4437 176.115 21.8651 175.923 21.0114C169.802 -6.20549 153.204 2.6679 143.786 12.3146C142.867 13.2569 141.155 12.8031 140.472 11.6773C137.614 6.96655 131.053 8.36187 126.478 10.4315C125.425 10.908 124.154 10.2315 123.989 9.08721C122.429 -1.75121 117.469 0.119079 114.308 3.27733C113.684 3.9011 112.684 3.9987 111.958 3.49708C106.479 -0.288224 104.073 3.4716 103.285 7.11776C103.063 8.14607 101.996 8.83505 100.98 8.56145C89.6105 5.49927 86.5757 14.5459 86.4423 20.6214C86.4268 21.3237 85.9943 21.9596 85.3279 22.1817Z",fill:"url(#paint0_linear_2641_15388)"}),v.jsx("rect",{x:"123.5",y:"46.3867",width:"24.8794",height:"12.8687",fill:"url(#paint1_linear_2641_15388)"}),v.jsx("path",{d:"M123.759 42.4412L116.105 52.7943C115.745 53.2812 115.989 53.9778 116.575 54.1334L120.155 55.085C120.486 55.173 120.837 55.0557 121.049 54.7866L125.516 49.1128C125.679 48.9062 125.927 48.7856 126.19 48.7856H145.088C145.402 48.7856 145.69 48.9567 145.841 49.2318L148.89 54.8064C149.034 55.0694 149.305 55.2383 149.604 55.2517L154.138 55.4557C154.81 55.4859 155.254 54.7672 154.926 54.1803L148.42 42.5328C148.268 42.2614 147.982 42.0933 147.671 42.0933H124.448C124.176 42.0933 123.92 42.2224 123.759 42.4412Z",fill:"url(#paint2_linear_2641_15388)"}),v.jsx("path",{opacity:"0.6",d:"M157.998 75.1751H112.026C110.993 75.1751 110.448 73.9515 111.139 73.1837L114.18 69.8057H114.717H155.346C155.687 69.8057 156.012 69.9514 156.238 70.2061L158.89 73.1892C159.574 73.9586 159.027 75.1751 157.998 75.1751Z",fill:"#EFF1F5"}),v.jsx("path",{d:"M114.924 70.1123V53.812C114.924 52.8644 115.693 52.0962 116.64 52.0962H125.548C126.357 52.0962 127.056 52.6614 127.226 53.4525L127.931 56.7453C128.101 57.5364 128.8 58.1016 129.609 58.1016H141.747C142.601 58.1016 143.325 57.4737 143.446 56.6284L143.883 53.5694C144.004 52.7241 144.728 52.0962 145.581 52.0962H153.959C154.907 52.0962 155.675 52.8644 155.675 53.812V70.1123C155.675 71.0599 154.907 71.8281 153.959 71.8281H116.64C115.693 71.8281 114.924 71.0599 114.924 70.1123Z",fill:"url(#paint3_linear_2641_15388)"}),v.jsxs("defs",{children:[v.jsxs("linearGradient",{id:"paint0_linear_2641_15388",x1:"135",y1:"0.825195",x2:"135.295",y2:"33.9116",gradientUnits:"userSpaceOnUse",children:[v.jsx("stop",{stopColor:"#F1F1F1"}),v.jsx("stop",{offset:"1",stopColor:"#F8F8F8",stopOpacity:"0.2"})]}),v.jsxs("linearGradient",{id:"paint1_linear_2641_15388",x1:"135.94",y1:"46.3867",x2:"135.94",y2:"59.2554",gradientUnits:"userSpaceOnUse",children:[v.jsx("stop",{stopColor:"#BCD3FF"}),v.jsx("stop",{offset:"1",stopColor:"#EAF1FF"})]}),v.jsxs("linearGradient",{id:"paint2_linear_2641_15388",x1:"135.516",y1:"49.8145",x2:"135.516",y2:"40.3774",gradientUnits:"userSpaceOnUse",children:[v.jsx("stop",{stopColor:"#4372DF"}),v.jsx("stop",{offset:"1",stopColor:"#8EAFFE"})]}),v.jsxs("linearGradient",{id:"paint3_linear_2641_15388",x1:"135.514",y1:"52.3911",x2:"135.514",y2:"72.123",gradientUnits:"userSpaceOnUse",children:[v.jsx("stop",{stopColor:"#84ABF8"}),v.jsx("stop",{offset:"1",stopColor:"#C1D4FC"})]})]})]}),v.jsx("div",{className:"max-w-xs sm:max-w-sm md:max-w-md text-[#42526E] font-roboto text-[13px] font-medium leading-5 px-4",children:n})]})})}function f8e({section:n,sectionIndex:e,currentStep:t,isExpanded:r,onToggle:o,onSectionFocus:s,formData:i,setFormData:a,isEmailVerified:l,isPhoneVerified:c,onSendEmailOTP:u,onSendPhoneOTP:d,onIdentityDocumentComplete:h,onSelfieComplete:p,submissionId:g,shortCode:x,templateVersionId:y,userId:b,isFilled:C,documentFormState:S,setDocumentFormState:k,onDocumentUploaded:N,biometricFormState:E,setBiometricFormState:_}){const $=()=>{if(e>t)return v.jsx("div",{className:"flex w-full h-[308px] border-t border-border bg-background",children:v.jsx(lB,{message:"This step is locked until you complete the previous step."})});switch(n.sectionType){case"personalInformation":{if(!i||!a)return null;const T=n.fieldMappings?.[0]?.structure?.personalInfo??{},D={...T,requiredToggles:T?.requiredToggles??{}};return v.jsx("div",{className:"flex py-5 px-[34px] flex-col items-start self-stretch border-t border-border bg-background",children:v.jsx(tD,{formData:i,setFormData:a,isEmailVerified:l||!1,isPhoneVerified:c||!1,onSendEmailOTP:u||(()=>{}),onSendPhoneOTP:d||(()=>{}),fieldConfig:D})})}case"documents":{const T=n.fieldMappings?.[0]?.structure?.documentVerification??{},D={allowUploadFromDevice:!!T.allowUploadFromDevice,allowCaptureWebcam:!!T.allowCaptureWebcam,documentHandling:T.documentHandlingRejectImmediately?"reject":T.documentHandlingAllowRetries?"retry":"",retryAttempts:Number(T.retryAttempts)||0,allowedFileTypes:Array.isArray(T.allowedFileTypes)?T.allowedFileTypes:[],supportedCountries:Array.isArray(T.supportedCountries)?T.supportedCountries:[],selectedCountries:Array.isArray(T.selectedCountries)?T.selectedCountries:[],selectedDocuments:Array.isArray(T.selectedDocuments)?T.selectedDocuments:[]};return v.jsxs("div",{className:"flex py-4 px-[34px] flex-col items-start self-stretch border-t border-[#DEDEDD] bg-white",children:[v.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-2 mb-3",children:[v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Upload: ",D.allowUploadFromDevice?"Device ":"Device "]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Capture: ",D.allowCaptureWebcam?"Webcam ":"Webcam "]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Handling: ",D.documentHandling||""]}),D.documentHandling==="retry"&&v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Retries: ",D.retryAttempts]}),!!D.allowedFileTypes.length&&v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["File types: ",D.allowedFileTypes.join(", ").toUpperCase()]})]}),v.jsx(iD,{onComplete:h||(()=>{}),documentConfig:D,submissionId:g,shortCode:x,templateVersionId:y,userId:b,documentFormState:S,setDocumentFormState:k,onDocumentUploaded:N})]})}case"biometrics":{const T=n.fieldMappings?.[0]?.structure?.biometricVerification??{},D={maxRetries:Number(T.maxRetries)||0,askUserRetry:!!T.askUserRetry,blockAfterRetries:!!T.blockAfterRetries,dataRetention:T.dataRetention||"",livenessThreshold:Number(T.livenessThreshold)||0,faceMatchThreshold:Number(T.faceMatchThreshold)||0};return v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"flex w-full py-3 px-[34px] border-t border-border bg-background",children:v.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-2",children:[v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Max retries: ",D.maxRetries]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Liveness  ",D.livenessThreshold,"%"]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Face match  ",D.faceMatchThreshold,"%"]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["On low score: ",D.askUserRetry?"Ask to retry":D.blockAfterRetries?"Block after retries":""]}),D.dataRetention&&v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Retention: ",D.dataRetention]})]})}),v.jsx("div",{className:"flex p-3 flex-col justify-center items-center self-stretch bg-background",children:v.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:v.jsx(aB,{onStepComplete:p||(()=>{}),userId:g})})})]})}default:return v.jsx("div",{className:"flex p-4 px-6 flex-col items-start self-stretch border-t border-border bg-background",children:v.jsxs("div",{className:"text-text-primary font-roboto text-sm",children:["Unknown section type: ",n.sectionType]})})}};return v.jsx("div",{className:"flex flex-col items-start gap-4 bg-background rounded border border-[#DEDEDD]",children:v.jsxs("div",{className:"flex p-0.5 flex-col items-start self-stretch rounded-t border border-[#DEDEDD]",children:[v.jsxs("div",{className:"flex p-4 flex-col justify-center items-center gap-2 self-stretch bg-background",children:[v.jsx("div",{className:"flex pb-1 items-center gap-2 self-stretch",children:v.jsxs("button",{onClick:()=>o(e),className:"flex items-center gap-2",children:[v.jsx("svg",{className:`w-[18px] h-[18px] transform transition-transform ${r?"rotate-0":"rotate-180"}`,viewBox:"0 0 18 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M6.00391 9.33203H12.0039M16.5039 9.33203C16.5039 13.4741 13.146 16.832 9.00391 16.832C4.86177 16.832 1.50391 13.4741 1.50391 9.33203C1.50391 5.18989 4.86177 1.83203 9.00391 1.83203C13.146 1.83203 16.5039 5.18989 16.5039 9.33203Z",stroke:"#323238",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-3",children:n.name})]})}),v.jsx("div",{className:"flex pl-6 justify-center items-center gap-2.5 self-stretch",children:v.jsx("div",{className:"flex-1 text-text-primary font-roboto text-[13px] font-normal leading-5",children:!r&&C?v.jsx("span",{className:"text-green-600 font-medium",children:"This section has been filled"}):n.description||`Complete the ${n.name.toLowerCase()} section.`})})]}),r&&v.jsx("div",{onClick:()=>s?.(e),onFocus:()=>s?.(e),children:$()})]})})}function p8e({section:n,sectionIndex:e,currentStep:t,onSectionFocus:r,formData:o,setFormData:s,isEmailVerified:i,isPhoneVerified:a,onSendEmailOTP:l,onSendPhoneOTP:c,onIdentityDocumentComplete:u,onSelfieComplete:d,submissionId:h,shortCode:p,templateVersionId:g,userId:x,isFilled:y,isExpanded:b,onToggle:C,documentFormState:S,setDocumentFormState:k,onDocumentUploaded:N,biometricFormState:E,setBiometricFormState:_}){const $=()=>v.jsxs("div",{className:"flex p-4 flex-col justify-center items-center gap-2 self-stretch bg-background",children:[v.jsx("div",{className:"flex pb-1 items-center gap-2 self-stretch",children:v.jsxs("button",{onClick:()=>C?.(e),className:"flex items-center gap-2",children:[v.jsx("svg",{className:`w-[18px] h-[18px] transform transition-transform ${b?"rotate-0":"rotate-180"}`,viewBox:"0 0 18 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M6.00391 9.33203H12.0039M16.5039 9.33203C16.5039 13.4741 13.146 16.832 9.00391 16.832C4.86177 16.832 1.50391 13.4741 1.50391 9.33203C1.50391 5.18989 4.86177 1.83203 9.00391 1.83203C13.146 1.83203 16.5039 5.18989 16.5039 9.33203Z",stroke:"#323238",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-3",children:n.name})]})}),v.jsx("div",{className:"flex pl-7 justify-center items-center gap-2.5 self-stretch",children:v.jsx("div",{className:"flex-1 text-text-primary font-roboto text-[13px] font-normal leading-5",children:!b&&y?v.jsx("span",{className:"text-green-600 font-medium",children:"This section has been filled"}):n.description||`Complete the ${n.name.toLowerCase()} section.`})})]});return(()=>{if(e>t)return v.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:v.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-border",children:[$(),v.jsx("div",{className:"flex w-full h-[308px] border-t border-border bg-background",children:v.jsx(lB,{message:"This step is locked until you complete the previous step."})})]})});switch(n.sectionType){case"personalInformation":{if(!o||!s)return null;const D=n.fieldMappings?.[0]?.structure?.personalInfo??{},A={...D,requiredToggles:D?.requiredToggles??{}};return v.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:v.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-border",children:[$(),b&&v.jsx("div",{className:"flex py-5 px-[34px] flex-col items-start self-stretch border-t border-border bg-background",onClick:()=>r?.(e),onFocus:()=>r?.(e),children:v.jsx(tD,{formData:o,setFormData:s,isEmailVerified:i||!1,isPhoneVerified:a||!1,onSendEmailOTP:l||(()=>{}),onSendPhoneOTP:c||(()=>{}),fieldConfig:A})})]})})}case"documents":{const D=n.fieldMappings?.[0]?.structure?.documentVerification??{},A={allowUploadFromDevice:!!D.allowUploadFromDevice,allowCaptureWebcam:!!D.allowCaptureWebcam,documentHandling:D.documentHandlingRejectImmediately?"reject":D.documentHandlingAllowRetries?"retry":"",retryAttempts:Number(D.retryAttempts)||0,allowedFileTypes:Array.isArray(D.allowedFileTypes)?D.allowedFileTypes:[],supportedCountries:Array.isArray(D.supportedCountries)?D.supportedCountries:[],selectedCountries:Array.isArray(D.selectedCountries)?D.selectedCountries:[],selectedDocuments:Array.isArray(D.selectedDocuments)?D.selectedDocuments:[]};return v.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:v.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-[#DEDEDD] bg-white",children:[$(),b&&v.jsxs("div",{className:"flex py-4 px-[34px] flex-col items-start self-stretch border-t border-[#DEDEDD] bg-white",onClick:()=>r?.(e),onFocus:()=>r?.(e),children:[v.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-2 mb-3",children:[v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Upload: ",A.allowUploadFromDevice?"Device ":"Device "]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Capture: ",A.allowCaptureWebcam?"Webcam ":"Webcam "]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Handling: ",A.documentHandling||""]}),A.documentHandling==="retry"&&v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Retries: ",A.retryAttempts]}),!!A.allowedFileTypes.length&&v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["File types: ",A.allowedFileTypes.join(", ").toUpperCase()]})]}),v.jsx(iD,{onComplete:u||(()=>{}),documentConfig:A,submissionId:h,shortCode:p,templateVersionId:g,userId:x,documentFormState:S,setDocumentFormState:k,onDocumentUploaded:N})]})]})})}case"biometrics":{const D=n.fieldMappings?.[0]?.structure?.biometricVerification??{},A={maxRetries:Number(D.maxRetries)||0,askUserRetry:!!D.askUserRetry,blockAfterRetries:!!D.blockAfterRetries,dataRetention:D.dataRetention||"",livenessThreshold:Number(D.livenessThreshold)||0,faceMatchThreshold:Number(D.faceMatchThreshold)||0};return v.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:v.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-border",children:[$(),b&&v.jsxs("div",{onClick:()=>r?.(e),onFocus:()=>r?.(e),children:[v.jsx("div",{className:"flex w-full py-3 px-[34px] border-t border-border bg-background",children:v.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-2",children:[v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Max retries: ",A.maxRetries]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Liveness  ",A.livenessThreshold,"%"]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Face match  ",A.faceMatchThreshold,"%"]}),v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["On low score: ",A.askUserRetry?"Ask to retry":A.blockAfterRetries?"Block after retries":""]}),A.dataRetention&&v.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Retention: ",A.dataRetention]})]})}),v.jsx("div",{className:"flex p-3 flex-col justify-center items-center self-stretch bg-background",children:v.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:v.jsx(aB,{onStepComplete:d||(()=>{}),userId:h})})})]})]})})}default:return v.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:v.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-border",children:[$(),b&&v.jsx("div",{className:"flex p-4 flex-col items-start self-stretch border-t border-border bg-background",onClick:()=>r?.(e),onFocus:()=>r?.(e),children:v.jsxs("div",{className:"text-text-primary font-roboto text-sm",children:["Unknown section type: ",n.sectionType]})})]})})}})()}function m8e({isOpen:n,onClose:e,onVerify:t,recipientEmail:r,recipientPhone:o,type:s,onResend:i}){const[a,l]=F.useState(["","","","","",""]),[c,u]=F.useState(!1),d=F.useRef([]);F.useEffect(()=>{n&&(l(["","","","","",""]),u(!1),setTimeout(()=>{d.current[0]?.focus()},100))},[n]);const h=(C,S)=>{if(S.length>1||S&&!/^\d$/.test(S))return;const k=[...a];k[C]=S,l(k),S&&C<5&&d.current[C+1]?.focus()},p=(C,S)=>{S.key==="Backspace"&&!a[C]&&C>0||S.key==="ArrowLeft"&&C>0?d.current[C-1]?.focus():S.key==="ArrowRight"&&C<5&&d.current[C+1]?.focus()},g=C=>{C.preventDefault();const k=C.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(k.length>0){const N=[...a];for(let $=0;$<6;$++)N[$]=k[$]||"";l(N);const E=N.findIndex($=>$===""),_=E===-1?5:Math.min(E,5);d.current[_]?.focus()}},x=async()=>{const C=a.join("");if(C.length===6){u(!0);try{await t(C)}finally{u(!1)}}},y=a.every(C=>C!==""),b=s==="email"?r:o;return n?v.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[v.jsx("div",{className:"absolute inset-0 bg-black/20 backdrop-blur-sm",onClick:e}),v.jsx("div",{className:"relative w-full max-w-[408px] mx-4 bg-white rounded-lg shadow-xl",children:v.jsxs("div",{className:"flex flex-col p-6 pb-6 gap-2",children:[v.jsx("div",{className:"flex justify-end",children:v.jsx("button",{onClick:e,className:"flex w-8 h-8 justify-center items-center rounded-full bg-white hover:bg-gray-50 transition-colors","aria-label":"Close dialog",children:v.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})}),v.jsxs("div",{className:"flex flex-col gap-6",children:[v.jsxs("div",{className:"flex flex-col gap-1 text-center",children:[v.jsx("h2",{className:"text-text-primary font-roboto text-[28px] font-bold leading-[42px]",children:"Enter Verification Code"}),v.jsxs("p",{className:"text-text-muted font-roboto text-sm font-normal leading-[22px]",children:["We've sent a code to ",b]})]}),v.jsx("div",{className:"flex justify-center gap-2",children:a.map((C,S)=>v.jsx("input",{ref:k=>d.current[S]=k,type:"text",inputMode:"numeric",maxLength:1,value:C,onChange:k=>h(S,k.target.value),onKeyDown:k=>p(S,k),onPaste:S===0?g:void 0,className:"w-12 h-[54px] text-center text-lg font-medium border border-input-border rounded bg-white focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary transition-colors","aria-label":`Digit ${S+1}`},S))}),v.jsxs("div",{className:"text-center",children:[v.jsxs("span",{className:"text-text-muted font-roboto text-sm font-normal",children:["Didn't get a code?"," "]}),v.jsx("button",{onClick:i,className:"text-primary font-roboto text-sm font-normal underline hover:text-primary/80 transition-colors",children:"Click to Resend"})]}),v.jsx("button",{onClick:x,disabled:!y||c,className:`w-full h-12 px-4 flex justify-center items-center gap-2 rounded font-roboto text-base font-bold transition-colors ${y&&!c?"bg-primary text-white hover:bg-primary/90":"bg-primary/50 text-white cursor-not-allowed"}`,children:c?v.jsxs(v.Fragment,{children:[v.jsxs("svg",{className:"w-4 h-4 animate-spin",viewBox:"0 0 24 24",children:[v.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),v.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify"})]})]})})]}):null}const La="https://idvapi-test.arconnet.com:1019",$3=!0,X0=()=>typeof window<"u"&&localStorage.getItem("access")||null;function g8e({templateId:n,userId:e,shortCode:t}){const{toast:r}=Nm(),o=ci(),[s,i]=F.useState(null),[a,l]=F.useState(!0),[c,u]=F.useState(null),[d,h]=F.useState(1),[p,g]=F.useState(!1),[x,y]=F.useState(!1),[b,C]=F.useState(!1),[S,k]=F.useState(!1),[N,E]=F.useState(!1),[_,$]=F.useState(!1),[T,D]=F.useState(!1),[A,M]=F.useState(!0),[j,L]=F.useState(!1),[U,G]=F.useState(!1),[H,O]=F.useState({1:!0}),[V,W]=F.useState({}),[B,q]=F.useState(1),[Q,Z]=F.useState(!1),[ne,ge]=F.useState("email"),[he,Se]=F.useState(null),[Re,We]=F.useState(!1),[Be,Xe]=F.useState(!1),[Ye,ot]=F.useState(!1),[Qe,ct]=F.useState(null),[ie,$t]=F.useState({firstName:"",lastName:"",middleName:"",dateOfBirth:"",email:"",countryCode:"",phoneNumber:"",gender:"",address:"",city:"",postalCode:"",permanentAddress:"",permanentCity:"",permanentPostalCode:""}),[Ot,qt]=F.useState({country:"",selectedDocument:"",uploadedDocuments:[],uploadedFiles:[],documentUploadIds:{},documentsDetails:[]}),en=we=>{console.log(" Parent setDocumentFormState called with:",we),console.log(" Previous documentFormState:",Ot),qt(we),console.log(" After setState, new documentFormState should be:",we)},[hn,cn]=F.useState({capturedImage:null,isImageCaptured:!1}),tn=()=>{if(!s)return{};const we=s.sections.find(fe=>fe.sectionType==="personalInformation");return!we||!we.fieldMappings?.[0]?.structure?{}:we.fieldMappings[0].structure.personalInfo||{}},Ht=async()=>{if(!(!s||!e||Qe))try{const we=await fetch(`${La}/api/UserTemplateSubmissions?TemplateVersionId=${s.versionId}&UserId=${e}`,{method:"GET",headers:{Accept:"application/json"}});if(we.ok){const $e=await we.json();if($e.items&&$e.items.length>0){const st=$e.items[0];ct(st.id),console.log("Found existing UserTemplateSubmission with ID:",st.id);return}}console.log("No existing submission found, creating new UserTemplateSubmission...");const Ne=await fetch(`${La}/api/UserTemplateSubmissions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({templateVersionId:s.versionId,userId:e})});if(!Ne.ok)throw new Error("Failed to create template submission");const fe=await Ne.json();ct(fe.id),console.log("Created new UserTemplateSubmission with ID:",fe.id)}catch(we){console.error("Error with UserTemplateSubmission:",we),r({title:"Initialization Error",description:"Failed to initialize form submission. Please refresh and try again.",variant:"destructive"})}};F.useEffect(()=>{if(!n){u("No template/version ID provided"),l(!1);return}const we=new AbortController;return(async()=>{try{l(!0);const Ne=await fetch(`${La}/api/TemplateVersion/${n}`,{headers:{Accept:"application/json"},signal:we.signal});if(!Ne.ok){const $e=await Ne.text().catch(()=>"");throw new Error($e||`Failed to fetch version ${n}`)}const fe=await Ne.json();i(fe)}catch(Ne){Ne?.name!=="AbortError"&&u(Ne?.message||"Failed to load template version")}finally{l(!1)}})(),()=>we.abort()},[n]),F.useEffect(()=>{s&&e&&!Qe&&Ht()},[s,e,Qe]),F.useEffect(()=>{if(!Qe||!s)return;(async()=>{try{console.log("Fetching submission values for submissionId:",Qe);const Ne=await fetch(`${La}/api/UserTemplateSubmissionValues/submissions/${Qe}/values`,{method:"GET",headers:{Accept:"application/json"}});if(!Ne.ok){console.error("Failed to fetch submission values:",Ne.status);return}const fe=await Ne.json();console.log("Fetched submission values:",fe);const $e=new Set;fe.forEach(vn=>{const Vr=s.sections.find(nn=>nn.id===vn.templateSectionId);if(Vr){$e.add(vn.templateSectionId);try{const nn=JSON.parse(vn.fieldValue);if(Vr.sectionType==="personalInformation"&&($t(Pn=>({...Pn,firstName:nn.firstName||Pn.firstName,lastName:nn.lastName||Pn.lastName,middleName:nn.middleName||Pn.middleName,dateOfBirth:nn.dateOfBirth||Pn.dateOfBirth,email:nn.email||Pn.email,countryCode:nn.countryCode||Pn.countryCode,phoneNumber:nn.phoneNumber||Pn.phoneNumber,gender:nn.gender||Pn.gender,address:nn.address||Pn.address,city:nn.city||Pn.city,postalCode:nn.postalCode||Pn.postalCode,permanentAddress:nn.permanentAddress||Pn.permanentAddress,permanentCity:nn.permanentCity||Pn.permanentCity,permanentPostalCode:nn.permanentPostalCode||Pn.permanentPostalCode})),console.log(" Populated personal information from submission")),Vr.sectionType==="documents"&&nn){const Pn=nn.documents||[],zs=[],ku={};Pn.forEach(Ws=>{const hi=Ws.documentName.toLowerCase().replace(/\s+/g,"_");zs.push(hi),ku[hi]={front:Ws.frontFileId,...Ws.backFileId&&{back:Ws.backFileId}}}),qt(Ws=>({...Ws,country:nn.country||Ws.country,uploadedDocuments:zs,documentUploadIds:ku,documentsDetails:Pn})),Pn.length>0&&k(!0),console.log(" Populated document information from submission"),console.log(" Restored country:",nn.country),console.log(" Restored uploadedDocuments (docIds):",zs),console.log(" Restored documentUploadIds:",ku),console.log(" Restored documentsDetails:",Pn),console.log(` Total documents uploaded: ${Pn.length}`)}Vr.sectionType==="biometrics"&&nn&&(cn(Pn=>({...Pn,capturedImage:nn.capturedImage||Pn.capturedImage,isImageCaptured:nn.isImageCaptured||Pn.isImageCaptured})),nn.isImageCaptured&&D(!0),console.log(" Populated biometric information from submission"))}catch(nn){console.error("Error parsing fieldValue for section:",Vr.sectionType,nn)}}});const st=s.sections.filter(vn=>vn.isActive).sort((vn,Vr)=>vn.orderIndex-Vr.orderIndex),dt={};st.forEach((vn,Vr)=>{const nn=Vr+1;$e.has(vn.id)?(dt[nn]=!0,console.log(` Section ${nn} (${vn.name}) marked as completed`)):console.log(` Section ${nn} (${vn.name}) not yet completed`)}),W(dt);const qn=Object.values(dt).filter(Boolean).length;console.log(` Summary: ${qn}/${st.length} sections completed`)}catch(Ne){console.error("Error fetching submission values:",Ne)}})()},[Qe,s]),F.useEffect(()=>{if(!s||Object.keys(V).length===0||_||!Object.values(V).some(Boolean))return;const Ne=s.sections.filter(dt=>dt.isActive).sort((dt,qn)=>dt.orderIndex-qn.orderIndex),fe=[];let $e=null;const st={};if(Ne.forEach((dt,qn)=>{const vn=qn+1;V[vn]?(fe.push(dt.name),st[vn]=!0):$e===null&&($e=vn,st[vn]=!0)}),fe.length>0){const dt=fe.length,qn=Ne.length,vn=$e||Ne.length;console.log(` Navigating to section ${vn} (first incomplete section)`),h(vn),O(st),setTimeout(()=>{const Vr=$e?Ne[$e-1]?.name:null;r({title:" Welcome Back!",description:`You've already completed ${dt}/${qn} section${dt>1?"s":""}: ${fe.join(", ")}${Vr?`. Continue with ${Vr}.`:""}`,duration:6e3}),$(!0)},500)}},[V,s,_]);const Yt=async we=>{if(!s||!e||!Qe)return;let Ne="";if(we.sectionType==="personalInformation"){const fe=tn(),$e={};fe.firstName&&($e.firstName=ie.firstName),fe.lastName&&($e.lastName=ie.lastName),fe.middleName&&($e.middleName=ie.middleName),fe.dateOfBirth&&($e.dateOfBirth=ie.dateOfBirth),fe.email&&($e.email=ie.email),fe.phoneNumber&&($e.countryCode=ie.countryCode,$e.phoneNumber=ie.phoneNumber),fe.gender&&($e.gender=ie.gender),fe.currentAddress&&($e.address=ie.address,$e.city=ie.city,$e.postalCode=ie.postalCode),fe.permanentAddress&&($e.permanentAddress=ie.permanentAddress,$e.permanentCity=ie.permanentCity,$e.permanentPostalCode=ie.permanentPostalCode),Ne=JSON.stringify($e)}else if(we.sectionType==="documents"){const fe={country:Ot.country,documents:Ot.documentsDetails};Ne=JSON.stringify(fe),console.log(" Posting document section data:",fe)}else we.sectionType==="biometrics"&&(Ne=JSON.stringify({selfieUploaded:T,completedAt:new Date().toISOString()}));try{await fetch(`${La}/api/UserTemplateSubmissionValues/${Qe}/${we.id}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({fieldValue:Ne})}),console.log(`Posted section data for ${we.sectionType}`)}catch(fe){console.error("Failed to POST section data",fe)}},ye=we=>{const fe=(s?.sections||[]).filter($e=>$e.isActive).sort(($e,st)=>$e.orderIndex-st.orderIndex)[we-1];return fe?fe.sectionType==="personalInformation"?!!(ie.firstName||ie.lastName||ie.middleName||ie.dateOfBirth||ie.email||ie.phoneNumber||ie.gender||ie.address||ie.city||ie.postalCode||ie.permanentAddress||ie.permanentCity||ie.permanentPostalCode):fe.sectionType==="documents"?S:fe.sectionType==="biometrics"?T:!1:!1},Fe=async we=>{const Ne=(s?.sections||[]).filter(fe=>fe.isActive).sort((fe,$e)=>fe.orderIndex-$e.orderIndex);if(B!==we&&B>0){const fe=Ne[B-1];fe&&ye(B)&&(console.log(`Auto-saving section ${B} data before switching to section ${we}`),await Yt(fe),r({title:"Progress Saved",description:`Your ${fe.name.toLowerCase()} data has been saved.`,duration:2e3}))}q(we)};async function Oe(we,Ne){const fe=X0(),$e=await fetch(`${La}/api/Otp/generate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...fe?{Authorization:`Bearer ${fe}`}:{}},body:JSON.stringify({email:we,versionId:Ne})});if(!$e.ok){const st=await $e.text().catch(()=>"");throw new Error(st||`Failed to send OTP (HTTP ${$e.status})`)}}async function xt(we,Ne,fe){const $e=X0(),st=await fetch(`${La}/api/Otp/validate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...$e?{Authorization:`Bearer ${$e}`}:{}},body:JSON.stringify({email:we,versionId:Ne,otp:fe})});if(!st.ok){const dt=await st.text().catch(()=>"");throw new Error(dt||`Invalid OTP (HTTP ${st.status})`)}}async function at(we,Ne,fe,$e="whatsapp",st="phoneVerification"){const dt=X0(),qn=await fetch(`${La}/api/Otp/phone/start`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...dt?{Authorization:`Bearer ${dt}`}:{}},body:JSON.stringify({phoneCountryCode:we,phoneNationalNumber:Ne,channel:$e,purpose:st,versionId:fe})});if(!qn.ok){const vn=await qn.text().catch(()=>"");throw new Error(vn||`Failed to start phone OTP (HTTP ${qn.status})`)}return qn.json()}async function Lt(we,Ne){const fe=X0(),$e=await fetch(`${La}/api/Otp/phone/verify`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...fe?{Authorization:`Bearer ${fe}`}:{}},body:JSON.stringify({otpId:we,code:String(Ne).trim()})}),st=await $e.text().catch(()=>"");let dt=null;try{dt=st?JSON.parse(st):null}catch{}if(!$e.ok||dt&&dt.success===!1){const qn=(dt?.message||st||`Invalid OTP (HTTP ${$e.status})`).toString();throw new Error(qn)}return dt??{success:!0}}const St=()=>s?.versionId??null,Rt=()=>{if(!s)return!1;const we=tn(),Ne=we?.requiredToggles||{},fe=[];return we.firstName&&fe.push(Ji(ie.firstName)),we.lastName&&fe.push(Ji(ie.lastName)),we.middleName&&(Ne.middleName||ie.middleName.trim())&&fe.push(Ji(ie.middleName)),we.dateOfBirth&&(Ne.dob||ie.dateOfBirth)&&fe.push(Lp(ie.dateOfBirth)),we.email&&(fe.push(nd(ie.email)),fe.push($3)),we.phoneNumber&&(Ne.phoneNumber||ie.phoneNumber)&&(fe.push(!!ie.countryCode),fe.push(Vc(ie.countryCode,ie.phoneNumber)),fe.push($3)),we.gender&&Ne.gender&&fe.push(!!ie.gender),we.currentAddress&&((Ne.currentAddress||ie.address)&&fe.push(jl(ie.address)),Ne.currentCity?fe.push(!!ie.city&&ie.city.trim().length>=2):ie.city&&fe.push(ie.city.trim().length>=2),(Ne.currentPostal||ie.postalCode)&&fe.push(Bl(ie.postalCode))),we.permanentAddress&&((Ne.permanentAddress||ie.permanentAddress)&&fe.push(jl(ie.permanentAddress)),Ne.permanentCity?fe.push(!!ie.permanentCity&&ie.permanentCity.trim().length>=2):ie.permanentCity&&fe.push(ie.permanentCity.trim().length>=2),(Ne.permanentPostal||ie.permanentPostalCode)&&fe.push(Bl(ie.permanentPostalCode))),fe.length>0&&fe.every(Boolean)};F.useEffect(()=>{const we=(s?.sections||[]).filter(fe=>fe.isActive).sort((fe,$e)=>fe.orderIndex-$e.orderIndex);if(Rt()&&!V[1]&&we[0]&&(W(fe=>({...fe,1:!0})),Yt(we[0]),d===1&&!b)){const fe=we[1];we.length===1?r({title:" Verification Complete!",description:"All sections have been completed successfully.",duration:5e3}):(r({title:` ${we[0]?.name||"Personal Information"} Completed`,description:"Your personal information has been saved. Opening next section...",duration:3e3}),C(!0),setTimeout(()=>{h(2),O(st=>({...st,2:!0})),fe&&r({title:` ${fe.name}`,description:`Please complete the ${fe.name.toLowerCase()}.`,duration:4e3})},2e3))}},[s,p,x,ie.firstName,ie.lastName,ie.middleName,ie.dateOfBirth,ie.email,ie.countryCode,ie.phoneNumber,ie.address,ie.city,ie.postalCode,ie.permanentAddress,ie.permanentCity,ie.permanentPostalCode,S,T,d,b,V,r]),F.useEffect(()=>{const we=(s?.sections||[]).filter(Ne=>Ne.isActive).sort((Ne,fe)=>Ne.orderIndex-fe.orderIndex);if(d===2&&S&&!N){!V[2]&&we[1]&&(W($e=>({...$e,2:!0})),Yt(we[1]));const Ne=we[2];we.length===2?r({title:" Verification Complete!",description:"All sections have been completed successfully.",duration:5e3}):(r({title:` ${we[1]?.name||"Document Verification"} Completed`,description:"Your documents have been uploaded. Opening next section...",duration:3e3}),E(!0),setTimeout(()=>{h(3),O($e=>({...$e,3:!0})),ot(!1),Ne&&r({title:` ${Ne.name}`,description:`Please complete the ${Ne.name.toLowerCase()}.`,duration:4e3})},2e3))}},[s,d,S,N,V,r]),F.useEffect(()=>{const we=(s?.sections||[]).filter(st=>st.isActive).sort((st,dt)=>st.orderIndex-dt.orderIndex);if(we.length===0)return;const Ne=st=>st==="personalInformation"?Rt():st==="documents"?S:st==="biometrics"?T:!0,fe=we.findIndex(st=>!Ne(st.sectionType)),$e=fe===-1?we.length:fe+1;$e!==d&&(h($e),O(st=>({...st,[$e]:!0})),ot(!1))},[s,p,x,ie.firstName,ie.lastName,ie.middleName,ie.dateOfBirth,ie.email,ie.countryCode,ie.phoneNumber,ie.address,ie.city,ie.postalCode,ie.permanentAddress,ie.permanentCity,ie.permanentPostalCode,S,T]);const On=async()=>{ie.email?.trim(),St();{g(!0),r({title:"Email verified (dev bypass)",description:"OTP skipped in development."});return}},ir=async()=>{if(St()==null){r({title:"Missing version",description:"No active template version found."});return}{y(!0),r({title:"Phone verified (dev bypass)",description:"OTP skipped in development."});return}},En=async we=>{if(he)if(he.type==="email"){const Ne=ie.email?.trim(),fe=St();if(!Ne||fe==null)return;try{Xe(!0),await xt(Ne,fe,we),g(!0),r({title:"Email verified",description:"Your email was successfully verified."}),Z(!1),Se(null)}catch($e){r({title:"Invalid OTP",description:$e?.message||"Please check the code and try again.",variant:"destructive"})}finally{Xe(!1)}}else{const Ne=String(we||"").trim();if(Ne.length<4){r({title:"Invalid OTP",description:"Please enter a valid OTP.",variant:"destructive"});return}if(!he.otpId){r({title:"Missing OTP",description:"No OTP session found. Please resend the code.",variant:"destructive"});return}try{Xe(!0);const{success:fe}=await Lt(he.otpId,Ne);if(!fe)throw new Error("Invalid or expired code.");y(!0),r({title:"Phone verified",description:"Your phone number was successfully verified."}),Z(!1),Se(null)}catch(fe){r({title:"Invalid OTP",description:fe?.message||"Please check the code and try again.",variant:"destructive"})}finally{Xe(!1)}}},xo=async()=>{const we=St();if(he?.type==="email"){const Ne=ie.email?.trim();if(!Ne||we==null)return;try{We(!0),await Oe(Ne,we),r({title:"OTP resent",description:`A new OTP was sent to ${Ne}.`})}catch(fe){r({title:"Failed to resend",description:fe?.message||"Please try again.",variant:"destructive"})}finally{We(!1)}}if(he?.type==="phone"){if(we==null)return;const Ne=(ie.countryCode||"").trim(),fe=(ie.phoneNumber||"").replace(/\D+/g,"");if(!Ne||!fe)return;try{We(!0);const{success:$e,otpId:st,expiresAt:dt}=await at(Ne,fe,we,"whatsapp","phoneVerification");if(!$e)throw new Error("Failed to start phone OTP.");Se(qn=>qn?{...qn,otpId:st,expiresAt:dt}:{type:"phone",recipient:`${Ne} ${ie.phoneNumber}`,otpId:st,expiresAt:dt}),r({title:"OTP resent",description:`A new OTP was sent to ${Ne} ${ie.phoneNumber}.`})}catch($e){r({title:"Failed to resend",description:$e?.message||"Please try again.",variant:"destructive"})}finally{We(!1)}}},Er=()=>{Z(!1),Se(null)},gs=()=>M(!1),zn=()=>{L(!0),M(!1)},er=()=>{D(!0);const we=Pt.find($e=>$e.sectionType==="biometrics"),Ne=Pt.findIndex($e=>$e.sectionType==="biometrics")+1;W($e=>({...$e,[Ne]:!0})),we&&Yt(we);const fe=Ne===Pt.length;fe?r({title:" Verification Complete!",description:"All sections have been completed successfully. Your identity verification is now complete.",duration:5e3}):(r({title:` ${we?.name||"Biometric Verification"} Completed`,description:"Biometric verification completed successfully. Please continue to the next section.",duration:3e3}),setTimeout(()=>{const $e=Ne+1;if($e<=Pt.length){h($e),O(dt=>({...dt,[$e]:!0}));const st=Pt[$e-1];r({title:` ${st?.name||"Next Section"}`,description:`Please complete the ${st?.name?.toLowerCase()||"next section"}.`,duration:4e3})}},2e3)),fe&&setTimeout(()=>{console.log("Identity verification process completed successfully")},2e3)},ar=async()=>{console.log(" Document state changed, triggering auto-save...");const we=Pt.find(Ne=>Ne.sectionType==="documents");we&&(console.log(" Current documents state:",{uploadedDocuments:Ot.uploadedDocuments,documentsDetails:Ot.documentsDetails}),await Yt(we),console.log(" Document section auto-saved successfully"))},Vs=()=>{k(!0);const we=Pt.find($e=>$e.sectionType==="documents"),Ne=Pt.findIndex($e=>$e.sectionType==="documents")+1;W($e=>({...$e,[Ne]:!0})),we&&Yt(we);const fe=Ne===Pt.length;N||(r(fe?{title:" Verification Complete!",description:"All sections have been completed successfully. Your identity verification is now complete.",duration:5e3}:{title:` ${we?.name||"Document Verification"} Completed`,description:"Your documents have been successfully uploaded and verified. Moving to the next section...",duration:3e3}),E(!0)),fe||setTimeout(()=>{const $e=Ne+1;if($e<=Pt.length){h($e),O(dt=>({...dt,[$e]:!0}));const st=Pt[$e-1];r({title:` ${st?.name||"Next Section"}`,description:`Please complete the ${st?.name?.toLowerCase()||"next section"}.`,duration:4e3})}},2e3)},Ft=async()=>{if(!Tr()){const we=vo();we.length>0&&r({title:"Form Incomplete",description:`Please complete the following: ${we.join(", ")}`,variant:"destructive"});return}if(!e||!s||!Qe){r({title:"Missing Information",description:"User ID, template version, or submission ID not found. Please refresh and try again.",variant:"destructive"});return}try{r({title:"Submitting Form",description:"Please wait while we submit your information..."});const we=s.sections.filter(Ne=>Ne.isActive);for(const Ne of we){let fe="";if(Ne.sectionType==="personalInformation"){const st=tn(),dt={};st.firstName&&(dt.firstName=ie.firstName),st.lastName&&(dt.lastName=ie.lastName),st.middleName&&(dt.middleName=ie.middleName),st.dateOfBirth&&(dt.dateOfBirth=ie.dateOfBirth),st.email&&(dt.email=ie.email),st.phoneNumber&&(dt.countryCode=ie.countryCode,dt.phoneNumber=ie.phoneNumber),st.gender&&(dt.gender=ie.gender),st.currentAddress&&(dt.address=ie.address,dt.city=ie.city,dt.postalCode=ie.postalCode),st.permanentAddress&&(dt.permanentAddress=ie.permanentAddress,dt.permanentCity=ie.permanentCity,dt.permanentPostalCode=ie.permanentPostalCode),fe=JSON.stringify(dt)}else Ne.sectionType==="documents"?fe=JSON.stringify({country:Ot.country,documents:Ot.documentsDetails}):Ne.sectionType==="biometrics"&&(fe=JSON.stringify({selfieUploaded:T,completedAt:new Date().toISOString()}));if(!(await fetch(`${La}/api/UserTemplateSubmissionValues/${Qe}/${Ne.id}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({fieldValue:fe})})).ok)throw new Error(`Failed to submit ${Ne.sectionType} section`)}r({title:"Form Submitted Successfully!",description:"Your identity verification form has been submitted."}),o("/verification-progress")}catch(we){console.error("Form submission error:",we),r({title:"Submission Failed",description:we instanceof Error?we.message:"Failed to submit form. Please try again.",variant:"destructive"})}},un=async we=>{if(we>d){r({title:"Step locked",description:"You can only access unlocked steps. Complete the current step to continue.",variant:"destructive"});return}if(O(Ne=>({...Ne,[we]:!Ne[we]})),H[we]&&V[we]){const Ne=Pt[we-1];Ne&&await Yt(Ne)}};F.useEffect(()=>{O(we=>({...we,[d]:!0})),d>=2&&ot(!1)},[d]);const Pt=(s?.sections||[]).filter(we=>we.isActive).sort((we,Ne)=>we.orderIndex-Ne.orderIndex),Tr=()=>{if(!s)return!1;const we=tn(),Ne=we?.requiredToggles||{},fe=[];we.firstName&&fe.push(Ji(ie.firstName)),we.lastName&&fe.push(Ji(ie.lastName)),we.middleName&&Ne.middleName&&fe.push(Ji(ie.middleName)),we.dateOfBirth&&Ne.dob&&fe.push(Lp(ie.dateOfBirth)),we.email&&fe.push(nd(ie.email)),we.phoneNumber&&Ne.phoneNumber&&(fe.push(!!ie.countryCode),fe.push(Vc(ie.countryCode,ie.phoneNumber))),we.gender&&Ne.gender&&fe.push(!!ie.gender),we.currentAddress&&(Ne.currentAddress&&fe.push(jl(ie.address)),Ne.currentCity&&fe.push(!!ie.city&&ie.city.trim().length>=2),Ne.currentPostal&&fe.push(Bl(ie.postalCode))),we.permanentAddress&&(Ne.permanentAddress&&fe.push(jl(ie.permanentAddress)),Ne.permanentCity&&fe.push(!!ie.permanentCity&&ie.permanentCity.trim().length>=2),Ne.permanentPostal&&fe.push(Bl(ie.permanentPostalCode)));const $e=fe.length>0&&fe.every(Boolean),st=s.sections.find(Vr=>Vr.sectionType==="documents"),dt=s.sections.find(Vr=>Vr.sectionType==="biometrics"),qn=!!st?.isActive,vn=!!dt?.isActive;return $e&&(!qn||S)&&(!vn||T)},vo=()=>{if(!s)return["Template data not loaded"];const we=tn(),Ne=we?.requiredToggles||{},fe=[];return we.firstName&&!Ji(ie.firstName)&&fe.push("First Name"),we.lastName&&!Ji(ie.lastName)&&fe.push("Last Name"),we.middleName&&Ne.middleName&&!Ji(ie.middleName)&&fe.push("Middle Name"),we.dateOfBirth&&Ne.dob&&!Lp(ie.dateOfBirth)&&fe.push("Date of Birth"),we.email&&(nd(ie.email)||fe.push("Valid Email")),we.phoneNumber&&Ne.phoneNumber&&(ie.countryCode?Vc(ie.countryCode,ie.phoneNumber)||fe.push("Valid Phone Number"):fe.push("Country Code")),we.gender&&Ne.gender&&!ie.gender&&fe.push("Gender"),we.currentAddress&&(Ne.currentAddress&&!jl(ie.address)&&fe.push("Current Address"),Ne.currentCity&&(!ie.city||ie.city.trim().length<2)&&fe.push("Current City"),Ne.currentPostal&&!Bl(ie.postalCode)&&fe.push("Current Postal Code")),we.permanentAddress&&(Ne.permanentAddress&&!jl(ie.permanentAddress)&&fe.push("Permanent Address"),Ne.permanentCity&&(!ie.permanentCity||ie.permanentCity.trim().length<2)&&fe.push("Permanent City"),Ne.permanentPostal&&!Bl(ie.permanentPostalCode)&&fe.push("Permanent Postal Code")),s.sections.find(dt=>dt.sectionType==="documents")?.isActive&&!S&&fe.push("Document Verification"),s.sections.find(dt=>dt.sectionType==="biometrics")?.isActive&&!T&&fe.push("Selfie Verification"),fe};return a?v.jsx("div",{className:"w-full h-screen bg-page-background flex items-center justify-center",children:v.jsx("div",{className:"text-text-primary font-roboto text-lg",children:"Loading..."})}):c?v.jsx("div",{className:"w-full h-screen bg-page-background flex items-center justify-center",children:v.jsxs("div",{className:"text-destructive font-roboto text-lg",children:["Error: ",c]})}):!s||Pt.length===0?v.jsx("div",{className:"w-full h-screen bg-page-background flex items-center justify-center",children:v.jsx("div",{className:"text-destructive font-roboto text-lg",children:"No template data available"})}):v.jsxs(v.Fragment,{children:[v.jsx(XH,{isOpen:A&&!j,onClose:gs,onAgree:zn}),v.jsx(iq,{isOpen:U,onClose:()=>G(!1)}),v.jsx(m8e,{isOpen:Q,onClose:Er,onVerify:En,onResend:xo,type:ne,recipientEmail:ne==="email"?ie.email:void 0,recipientPhone:ne==="phone"?`${ie.countryCode} ${ie.phoneNumber}`:void 0}),v.jsxs("div",{className:`w-full min-h-screen bg-page-background flex flex-col ${A&&!j?"opacity-50 pointer-events-none":""}`,children:[v.jsx(KH,{onMobileMenuToggle:()=>ot(we=>!we),isMobileMenuOpen:Ye}),v.jsx("div",{className:"flex w-full h-11 items-center flex-shrink-0 bg-background border-b border-border",children:v.jsx("div",{className:"flex flex-col items-start flex-1 px-3 sm:px-4",children:v.jsxs("div",{className:"flex h-11 justify-between items-center self-stretch",children:[v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-3",children:"Identity Verification Form"}),v.jsx("div",{className:"sm:hidden flex w-8 h-8 justify-center items-center gap-2.5",children:v.jsxs("svg",{className:"w-6 h-6 transform rotate-90",viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M13.5 12.332C13.5 11.7797 13.0523 11.332 12.5 11.332C11.9477 11.332 11.5 11.7797 11.5 12.332C11.5 12.8843 11.9477 13.332 12.5 13.332C13.0523 13.332 13.5 12.8843 13.5 12.332Z",stroke:"#676879",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M6.5 12.332C6.5 11.7797 6.05228 11.332 5.5 11.332C4.94772 11.332 4.5 11.7797 4.5 12.332C4.5 12.8843 4.94772 13.332 5.5 13.332C6.05228 13.332 6.5 12.8843 6.5 12.332Z",stroke:"#676879",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M20.5 12.332C20.5 11.7797 20.0523 11.332 19.5 11.332C18.9477 11.332 18.5 11.7797 18.5 12.332C18.5 12.8843 18.9477 13.332 19.5 13.332C20.0523 13.332 20.5 12.8843 20.5 12.332Z",stroke:"#676879",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),v.jsx("div",{className:"flex items-center gap-3",children:v.jsx("button",{onClick:Ft,className:`flex h-8 py-[9px] px-3 justify-center items-center gap-0.5 rounded ${Tr()?"bg-primary":"bg-primary opacity-50"}`,children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-normal",children:"Submit"})})})]})})}),v.jsxs("div",{className:"flex w-full flex-1 overflow-hidden",children:[v.jsx("div",{className:"hidden lg:block border-r border-border",children:v.jsx(iN,{sections:Pt,currentStep:d})}),Ye&&v.jsxs("div",{className:"lg:hidden fixed inset-0 z-50 flex",children:[v.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>ot(!1),"aria-hidden":!0}),v.jsxs("div",{id:"mobile-step-sidebar",className:"relative w-80 bg-white h-full border-r border-border shadow-lg overflow-auto",children:[v.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[v.jsx("div",{className:"font-roboto font-bold",children:"Steps"}),v.jsx("button",{"aria-label":"Close menu",className:"p-1",onClick:()=>ot(!1),children:""})]}),v.jsx(iN,{sections:Pt,currentStep:d})]})]}),v.jsxs("div",{className:"flex w-full flex-1 flex-col",children:[v.jsx("div",{className:"lg:hidden px-3 py-4 bg-page-background",children:v.jsx("div",{className:"space-y-4",children:Pt.map((we,Ne)=>v.jsx(f8e,{section:we,sectionIndex:Ne+1,currentStep:d,isExpanded:!!H[Ne+1],onToggle:un,onSectionFocus:Fe,formData:ie,setFormData:$t,isEmailVerified:p,isPhoneVerified:x,onSendEmailOTP:On,onSendPhoneOTP:ir,onIdentityDocumentComplete:Vs,onSelfieComplete:er,submissionId:Qe,shortCode:t,templateVersionId:s?.versionId,userId:e,isFilled:!!V[Ne+1],documentFormState:Ot,setDocumentFormState:en,onDocumentUploaded:ar,biometricFormState:hn,setBiometricFormState:cn},we.id))})}),v.jsx("div",{className:"hidden lg:flex w-full flex-1 p-6 flex-col items-center gap-6 bg-background overflow-auto",children:v.jsx("div",{className:"flex w-full max-w-[998px] flex-col items-center gap-6",children:v.jsx("div",{className:"flex flex-col items-center gap-6 self-stretch",children:Pt.map((we,Ne)=>v.jsx(p8e,{section:we,sectionIndex:Ne+1,currentStep:d,onSectionFocus:Fe,formData:ie,setFormData:$t,isEmailVerified:p,isPhoneVerified:x,onSendEmailOTP:On,onSendPhoneOTP:ir,onIdentityDocumentComplete:Vs,onSelfieComplete:er,submissionId:Qe,shortCode:t,templateVersionId:s?.versionId,userId:e,isFilled:!!V[Ne+1],isExpanded:!!H[Ne+1],onToggle:un,documentFormState:Ot,setDocumentFormState:en,onDocumentUploaded:ar,biometricFormState:hn,setBiometricFormState:cn},we.id))})})})]})]})]})]})}function F9(){const n=ci(),[e]=qH(),t=e.get("code")||void 0,[r,o]=F.useState(1),[s,i]=F.useState(null),[a,l]=F.useState(!1),[c,u]=F.useState(null),[d,h]=F.useState(""),p="Ad-5fCStWvEJoqVbxLtt26bnAqpE8-lie1RD1JYlXh2l4faiZGjFOr5O_WtRZrJuYfYzF-b2GiM_2Al2hRWKRS9EBPfoFd40G11bugUEJIEIChk9LtrWLmmit8zkyDyF24-drMfaQk5Zyl2RnZVmmMKKiitrRQcCcNMftj6E-c7KxWN0MPuuFtJ5NAwlZAb-i669e9_iz2h8_y7umUfoxzRu7HPqYZBfEufgYwcV8Hnag55i1MPKlztQgLqYdasYDL5HEmGwSr24fdOluLlnIiN8MS6VJatd",g="https://idvapi-test.arconnet.com:1019";F.useEffect(()=>{const C=e.get("code"),S=e.get("state"),k=e.get("jti");if(C&&S){console.log(" DigiLocker callback detected at root URL");try{const[N,E]=S.split(":");if(!N||N==="unknown"){console.error(" Invalid shortCode in DigiLocker state"),alert("Invalid DigiLocker callback. Please try again.");return}sessionStorage.setItem("digilocker_auth_code",C),sessionStorage.setItem("digilocker_callback_state",S),sessionStorage.setItem("digilocker_jti",k||""),sessionStorage.setItem("digilocker_callback_timestamp",Date.now().toString()),console.log(" DigiLocker data stored, redirecting to /form?code="+N),n(`/form?code=${encodeURIComponent(N)}`,{replace:!0})}catch(N){console.error(" Error processing DigiLocker callback:",N),alert("Failed to process DigiLocker response. Please try again.")}}},[e,n]),F.useEffect(()=>{const C=e.get("code");C&&x(C)},[e]);const x=async C=>{l(!0),u(null);try{const S=await fetch(`${g}/api/templates-link-generation/resolve?shortCode=${encodeURIComponent(C)}`);if(!S.ok)throw new Error("Failed to resolve shortcode");const k=await S.json();console.log("Shortcode resolved:",k),o(k.templateVersionId),i(k.userId)}catch(S){console.error("Error resolving shortcode:",S),u(S instanceof Error?S.message:"An error occurred")}finally{l(!1)}},y=C=>{C.preventDefault(),d.trim()&&n(`/form?code=${encodeURIComponent(d.trim())}`)},b=()=>{h(p),n(`/form?code=${encodeURIComponent(p)}`)};return t?a?v.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:v.jsx("div",{className:"text-gray-900 text-lg",children:"Loading template..."})}):c?v.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:v.jsx("div",{className:"max-w-md w-full",children:v.jsxs("div",{className:"text-center",children:[v.jsxs("div",{className:"text-red-600 text-lg mb-4",children:["Error: ",c]}),v.jsx("button",{onClick:()=>n("/"),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Try Again"})]})})}):v.jsx(g8e,{templateId:r,userId:s,shortCode:t||""}):v.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:v.jsxs("div",{className:"max-w-md w-full space-y-8",children:[v.jsxs("div",{children:[v.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Identity Verification"}),v.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Enter your shortCode to continue"})]}),v.jsxs("form",{className:"mt-8 space-y-6",onSubmit:y,children:[v.jsxs("div",{children:[v.jsx("label",{htmlFor:"shortcode",className:"sr-only",children:"Shortcode"}),v.jsx("input",{id:"shortcode",name:"shortcode",type:"text",required:!0,value:d,onChange:C=>h(C.target.value),className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:`Write shortcode here (e.g., ${p.slice(0,20)}...)`})]}),v.jsxs("div",{className:"space-y-3",children:[v.jsx("button",{type:"submit",disabled:!d.trim(),className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Continue"}),v.jsxs("div",{className:"relative",children:[v.jsx("div",{className:"absolute inset-0 flex items-center",children:v.jsx("div",{className:"w-full border-t border-gray-300"})}),v.jsx("div",{className:"relative flex justify-center text-sm",children:v.jsx("span",{className:"px-2 bg-gray-50 text-gray-500",children:"or"})})]}),v.jsx("button",{type:"button",onClick:b,className:"group relative w-full flex justify-center py-2 px-4 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Try Demo Shortcode"})]})]})]})})}const x8e=()=>{const n=Rm();return F.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",n.pathname)},[n.pathname]),v.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:v.jsxs("div",{className:"text-center",children:[v.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),v.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),v.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};function v8e(){const n=ci();return F.useEffect(()=>{const e=setTimeout(()=>{n("/verification-success")},2e3);return()=>clearTimeout(e)},[n]),v.jsxs("div",{className:"flex w-full min-h-screen flex-col bg-page-background",children:[v.jsxs("div",{className:"flex w-full h-11 items-center px-8 border-b border-[#D0D4E4] bg-white",children:[v.jsx("div",{className:"flex items-center gap-2",children:v.jsxs("svg",{width:"64",height:"16",viewBox:"0 0 64 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M19.6451 6.27505C20.4605 5.29486 21.4477 4.80469 22.6065 4.80469C23.2074 4.80469 23.76 4.97008 24.2643 5.30072C24.7686 5.63143 25.1548 6.05658 25.4231 6.57622L25.5679 4.96414H27.6281V14.7073H25.5679L25.4231 13.0776C25.1548 13.5972 24.7686 14.0224 24.2643 14.353C23.76 14.6837 23.2074 14.8491 22.6065 14.8491C21.4477 14.8491 20.4605 14.359 19.6451 13.3787C18.8296 12.3867 18.4219 11.1998 18.4219 9.81804C18.4219 8.43624 18.8296 7.25524 19.6451 6.27505ZM21.3833 11.625C21.8339 12.1327 22.3812 12.3867 23.025 12.3867C23.6795 12.3867 24.2321 12.1387 24.6827 11.6426C25.1334 11.1348 25.3587 10.5266 25.3587 9.81804C25.3587 9.10947 25.1334 8.50713 24.6827 8.0111C24.2321 7.50326 23.6795 7.24938 23.025 7.24938C22.3812 7.24938 21.8339 7.50326 21.3833 8.0111C20.9327 8.50713 20.7073 9.10947 20.7073 9.81804C20.7073 10.5266 20.9327 11.1289 21.3833 11.625ZM29.5129 4.96414H31.573L31.734 6.36361C32.2598 5.38342 33.1343 4.89332 34.3575 4.89332C34.6686 4.89332 34.9369 4.91693 35.1622 4.96414L34.6954 7.35568C34.5667 7.33207 34.4755 7.3202 34.4219 7.3202C33.6707 7.3202 33.0431 7.57415 32.5387 8.08199C32.0344 8.57795 31.7823 9.42237 31.7823 10.6152V14.7073H29.5129V4.96414ZM37.3457 6.29279C38.2255 5.31253 39.2932 4.82243 40.5485 4.82243C41.2996 4.82243 42.0025 5.01729 42.657 5.40702C43.3115 5.78495 43.8534 6.29866 44.2825 6.94821L42.4156 8.31227C41.9542 7.67452 41.3319 7.35568 40.5485 7.35568C39.9262 7.35568 39.3951 7.59776 38.9551 8.08199C38.5153 8.56615 38.2953 9.15074 38.2953 9.83578C38.2953 10.5325 38.5153 11.123 38.9551 11.6072C39.3951 12.0915 39.9262 12.3335 40.5485 12.3335C41.3748 12.3335 42.0078 11.9792 42.4477 11.2707L44.3308 12.6524C43.9124 13.3256 43.3705 13.8629 42.7052 14.2645C42.04 14.666 41.3211 14.8668 40.5485 14.8668C39.2932 14.8668 38.2202 14.3766 37.3296 13.3964C36.4498 12.4044 36.0098 11.2175 36.0098 9.83578C36.0098 8.45398 36.4551 7.27298 37.3457 6.29279ZM46.619 6.29279C47.4989 5.31253 48.5665 4.82243 49.8219 4.82243C51.0773 4.82243 52.1503 5.31846 53.0409 6.31046C53.9422 7.29072 54.3929 8.46578 54.3929 9.83578C54.3929 11.2175 53.9476 12.3985 53.057 13.3787C52.1557 14.3708 51.0773 14.8668 49.8219 14.8668C48.5665 14.8668 47.4935 14.3766 46.603 13.3964C45.7231 12.4044 45.2832 11.2175 45.2832 9.83578C45.2832 8.45398 45.7285 7.27298 46.619 6.29279ZM47.5687 9.83578C47.5687 10.5325 47.7886 11.123 48.2285 11.6072C48.6685 12.0915 49.1996 12.3335 49.8219 12.3335C50.455 12.3335 50.9915 12.0915 51.4314 11.6072C51.8713 11.123 52.0913 10.5325 52.0913 9.83578C52.0913 9.15074 51.8713 8.56615 51.4314 8.08199C50.9915 7.59776 50.455 7.35568 49.8219 7.35568C49.1996 7.35568 48.6685 7.59776 48.2285 8.08199C47.7886 8.56615 47.5687 9.15074 47.5687 9.83578ZM55.8398 14.7073V4.96414H57.9L58.0448 6.38135C58.3024 5.90892 58.6404 5.531 59.0588 5.24757C59.488 4.95234 59.9709 4.80469 60.5073 4.80469C61.5803 4.80469 62.428 5.21216 63.0504 6.02703C63.6834 6.8419 63.9999 8.07605 63.9999 9.72947V14.7073H61.7466V9.72947C61.7466 8.9146 61.5696 8.30046 61.2155 7.88712C60.8722 7.46198 60.443 7.24938 59.928 7.24938C59.4022 7.24938 58.9676 7.46198 58.6243 7.88712C58.2809 8.30046 58.1092 8.9146 58.1092 9.72947V14.7073H55.8398Z",fill:"#323238"}),v.jsx("path",{d:"M14.3486 12.736C14.6548 13.3353 14.2196 14.0465 13.5466 14.0465H3.02185C2.3453 14.0465 1.91028 13.3285 2.22355 12.7288L7.54372 2.54495C7.8823 1.89684 8.81128 1.901 9.14404 2.55212L14.3486 12.736Z",stroke:"#D83A52",strokeWidth:"2.42826"})]})}),v.jsx("div",{className:"w-[1px] h-5 bg-[#D0D4E4] mx-2"}),v.jsx("div",{className:"flex items-center justify-center",children:v.jsxs("svg",{width:"80",height:"23",viewBox:"0 0 80 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_2641_14088)",children:v.jsx("path",{d:"M1.79875 10.2148C1.79875 8.97716 1.17188 7.95455 0 7.0957H2.72375C3.2039 7.46144 3.59293 7.93332 3.86041 8.47442C4.1279 9.01552 4.26659 9.61118 4.26563 10.2148C4.26659 10.8184 4.1279 11.4141 3.86041 11.9552C3.59293 12.4963 3.2039 12.9682 2.72375 13.3339C3.60813 13.7027 4.11125 14.6028 4.11125 15.8911V18.3457H1.645V15.8911C1.645 14.664 1.05938 13.8052 0.000625 13.3345C1.1725 12.4751 1.79875 11.4524 1.79875 10.2148ZM7.14375 10.2148C7.14375 8.97716 6.51688 7.95455 5.345 7.0957H8.06938C8.54941 7.46151 8.93832 7.93341 9.20569 8.47451C9.47307 9.01561 9.61166 9.61123 9.61063 10.2148C9.61166 10.8184 9.47307 11.414 9.20569 11.9551C8.93832 12.4962 8.54941 12.9681 8.06938 13.3339C8.95313 13.7027 9.45688 14.6028 9.45688 15.8911V18.3457H6.99V15.8911C6.99 14.664 6.40375 13.8052 5.345 13.3345C6.51688 12.4751 7.14375 11.4524 7.14375 10.2148ZM12.49 10.2148C12.49 8.97716 11.8631 7.95455 10.6913 7.0957H13.415C13.8951 7.46144 14.2842 7.93332 14.5517 8.47442C14.8191 9.01552 14.9578 9.61118 14.9569 10.2148C14.9578 10.8184 14.8191 11.4141 14.5517 11.9552C14.2842 12.4963 13.8951 12.9682 13.415 13.3339C14.2994 13.7027 14.8025 14.6028 14.8025 15.8911V18.3457H12.3356V15.8911C12.3356 14.664 11.75 13.8052 10.6913 13.3345C11.8631 12.4751 12.49 11.4524 12.49 10.2148ZM22.47 16.3017H20.6V9.14093H25.195C27.405 9.14093 28.4944 9.95977 28.4944 11.2993C28.4944 12.2094 27.96 12.8945 26.9631 13.2426C27.9906 13.3958 28.4531 13.9377 28.4531 14.9097V16.3005H26.5619V14.9916C26.5619 14.1727 26.1506 13.8458 25.0713 13.8458H22.4713V16.3017H22.47ZM25.0913 10.1842H22.47V12.8032H25.0706C26.0163 12.8032 26.6019 12.2813 26.6019 11.4631C26.6019 10.6548 26.0581 10.1842 25.0913 10.1842ZM31.7419 9.14093H29.8713V16.3017H31.7419V9.14093ZM37.4775 13.9683H35.1956V16.3005H33.3244V9.14093H37.5181C39.7281 9.14093 40.89 10.0617 40.89 11.5349C40.89 13.0582 39.7081 13.9683 37.4775 13.9683ZM37.4363 10.1842H35.1956V12.9251H37.4156C38.3819 12.9251 38.9781 12.4344 38.9781 11.5449C38.9781 10.6755 38.3819 10.1842 37.4363 10.1842ZM46.1531 13.9683H43.8713V16.3005H42V9.14093H46.1938C48.4038 9.14093 49.5656 10.0617 49.5656 11.5349C49.5656 13.0582 48.3831 13.9683 46.1531 13.9683ZM46.1119 10.1842H43.8713V12.9251H46.0913C47.0575 12.9251 47.6538 12.4344 47.6538 11.5449C47.6538 10.6755 47.0575 10.1842 46.1119 10.1842ZM52.5463 9.14093V15.2366H57.2131V16.3017H50.6756V9.14093H52.5463ZM60.2544 9.14093H58.3838V16.3017H60.2544V9.14093ZM63.0713 11.5343V16.3017H61.8375V9.14093H63.2369L68.335 13.9071V9.14093H69.5688V16.3017H68.1706L63.0713 11.5343ZM75.675 9.97977C73.8963 9.97977 72.735 11.1049 72.735 12.782C72.735 14.4384 73.845 15.4616 75.5719 15.4616H75.695C76.2813 15.4616 76.9388 15.3385 77.5456 15.1447V13.2114H74.5238V12.1888H79.375V15.5535C78.3681 16.0755 76.8463 16.4849 75.6131 16.4849H75.4488C72.6113 16.4849 70.7819 14.991 70.7819 12.8226C70.7819 10.6749 72.6631 8.95716 75.5513 8.95716H75.7156C76.9188 8.95716 78.2956 9.33533 79.3138 9.92852L78.7788 10.7974C77.8644 10.2967 76.7744 9.97977 75.7981 9.97977H75.675Z",fill:"black"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_2641_14088",children:v.jsx("rect",{width:"79.6875",height:"22.5",fill:"white"})})})]})})]}),v.jsx("div",{className:"flex flex-1 items-center justify-center p-8",children:v.jsx("div",{className:"flex flex-col items-center justify-center gap-14 max-w-2xl mx-auto",children:v.jsxs("div",{className:"flex flex-col items-center gap-6",children:[v.jsx("div",{className:"relative",children:v.jsxs("svg",{className:"w-16 h-16 animate-spin",width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M60 32C60 35.677 59.2758 39.318 57.8686 42.7151C56.4615 46.1123 54.399 49.199 51.799 51.799C49.199 54.399 46.1123 56.4615 42.7151 57.8686C39.318 59.2758 35.677 60 32 60C28.323 60 24.682 59.2758 21.2849 57.8686C17.8877 56.4615 14.801 54.399 12.201 51.799C9.60097 49.1989 7.5385 46.1122 6.13137 42.7151C4.72424 39.318 4 35.677 4 32C4 28.323 4.72424 24.682 6.13138 21.2849C7.53851 17.8877 9.60098 14.801 12.201 12.201C14.8011 9.60096 17.8878 7.5385 21.2849 6.13137C24.682 4.72424 28.323 4 32 4C35.677 4 39.318 4.72425 42.7152 6.13138C46.1123 7.53851 49.199 9.60098 51.799 12.201C54.399 14.8011 56.4615 17.8878 57.8686 21.2849C59.2758 24.682 60 28.323 60 32L60 32Z",stroke:"#C3C6D4",strokeWidth:"6.81579",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M32 4C36.5971 4 41.1234 5.13188 45.1794 7.29569C49.2354 9.45951 52.6962 12.5887 55.2563 16.4069C57.8164 20.2252 59.397 24.6151 59.8585 29.1889",stroke:"#258750",strokeWidth:"6.81579",strokeLinecap:"round",strokeLinejoin:"round"})]})}),v.jsxs("div",{className:"flex flex-col items-center gap-6 text-center max-w-lg",children:[v.jsx("h1",{className:"text-text-primary font-roboto text-2xl sm:text-3xl font-bold leading-tight",children:"Verification in Progress"}),v.jsx("p",{className:"text-text-secondary font-roboto text-base font-normal leading-5",children:"This may take a moment. Please do not close this window."})]})]})})})]})}function y8e(){return v.jsxs("div",{className:"flex w-full min-h-screen flex-col bg-page-background",children:[v.jsxs("div",{className:"flex w-full h-11 items-center px-8 border-b border-[#D0D4E4] bg-white",children:[v.jsx("div",{className:"flex items-center gap-2",children:v.jsxs("svg",{width:"64",height:"16",viewBox:"0 0 64 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M19.6451 6.27505C20.4605 5.29486 21.4477 4.80469 22.6065 4.80469C23.2074 4.80469 23.76 4.97008 24.2643 5.30072C24.7686 5.63143 25.1548 6.05658 25.4231 6.57622L25.5679 4.96414H27.6281V14.7073H25.5679L25.4231 13.0776C25.1548 13.5972 24.7686 14.0224 24.2643 14.353C23.76 14.6837 23.2074 14.8491 22.6065 14.8491C21.4477 14.8491 20.4605 14.359 19.6451 13.3787C18.8296 12.3867 18.4219 11.1998 18.4219 9.81804C18.4219 8.43624 18.8296 7.25524 19.6451 6.27505ZM21.3833 11.625C21.8339 12.1327 22.3812 12.3867 23.025 12.3867C23.6795 12.3867 24.2321 12.1387 24.6827 11.6426C25.1334 11.1348 25.3587 10.5266 25.3587 9.81804C25.3587 9.10947 25.1334 8.50713 24.6827 8.0111C24.2321 7.50326 23.6795 7.24938 23.025 7.24938C22.3812 7.24938 21.8339 7.50326 21.3833 8.0111C20.9327 8.50713 20.7073 9.10947 20.7073 9.81804C20.7073 10.5266 20.9327 11.1289 21.3833 11.625ZM29.5129 4.96414H31.573L31.734 6.36361C32.2598 5.38342 33.1343 4.89332 34.3575 4.89332C34.6686 4.89332 34.9369 4.91693 35.1622 4.96414L34.6954 7.35568C34.5667 7.33207 34.4755 7.3202 34.4219 7.3202C33.6707 7.3202 33.0431 7.57415 32.5387 8.08199C32.0344 8.57795 31.7823 9.42237 31.7823 10.6152V14.7073H29.5129V4.96414ZM37.3457 6.29279C38.2255 5.31253 39.2932 4.82243 40.5485 4.82243C41.2996 4.82243 42.0025 5.01729 42.657 5.40702C43.3115 5.78495 43.8534 6.29866 44.2825 6.94821L42.4156 8.31227C41.9542 7.67452 41.3319 7.35568 40.5485 7.35568C39.9262 7.35568 39.3951 7.59776 38.9551 8.08199C38.5153 8.56615 38.2953 9.15074 38.2953 9.83578C38.2953 10.5325 38.5153 11.123 38.9551 11.6072C39.3951 12.0915 39.9262 12.3335 40.5485 12.3335C41.3748 12.3335 42.0078 11.9792 42.4477 11.2707L44.3308 12.6524C43.9124 13.3256 43.3705 13.8629 42.7052 14.2645C42.04 14.666 41.3211 14.8668 40.5485 14.8668C39.2932 14.8668 38.2202 14.3766 37.3296 13.3964C36.4498 12.4044 36.0098 11.2175 36.0098 9.83578C36.0098 8.45398 36.4551 7.27298 37.3457 6.29279ZM46.619 6.29279C47.4989 5.31253 48.5665 4.82243 49.8219 4.82243C51.0773 4.82243 52.1503 5.31846 53.0409 6.31046C53.9422 7.29072 54.3929 8.46578 54.3929 9.83578C54.3929 11.2175 53.9476 12.3985 53.057 13.3787C52.1557 14.3708 51.0773 14.8668 49.8219 14.8668C48.5665 14.8668 47.4935 14.3766 46.603 13.3964C45.7231 12.4044 45.2832 11.2175 45.2832 9.83578C45.2832 8.45398 45.7285 7.27298 46.619 6.29279ZM47.5687 9.83578C47.5687 10.5325 47.7886 11.123 48.2285 11.6072C48.6685 12.0915 49.1996 12.3335 49.8219 12.3335C50.455 12.3335 50.9915 12.0915 51.4314 11.6072C51.8713 11.123 52.0913 10.5325 52.0913 9.83578C52.0913 9.15074 51.8713 8.56615 51.4314 8.08199C50.9915 7.59776 50.455 7.35568 49.8219 7.35568C49.1996 7.35568 48.6685 7.59776 48.2285 8.08199C47.7886 8.56615 47.5687 9.15074 47.5687 9.83578ZM55.8398 14.7073V4.96414H57.9L58.0448 6.38135C58.3024 5.90892 58.6404 5.531 59.0588 5.24757C59.488 4.95234 59.9709 4.80469 60.5073 4.80469C61.5803 4.80469 62.428 5.21216 63.0504 6.02703C63.6834 6.8419 63.9999 8.07605 63.9999 9.72947V14.7073H61.7466V9.72947C61.7466 8.9146 61.5696 8.30046 61.2155 7.88712C60.8722 7.46198 60.443 7.24938 59.928 7.24938C59.4022 7.24938 58.9676 7.46198 58.6243 7.88712C58.2809 8.30046 58.1092 8.9146 58.1092 9.72947V14.7073H55.8398Z",fill:"#323238"}),v.jsx("path",{d:"M14.3486 12.736C14.6548 13.3353 14.2196 14.0465 13.5466 14.0465H3.02185C2.3453 14.0465 1.91028 13.3285 2.22355 12.7288L7.54372 2.54495C7.8823 1.89684 8.81128 1.901 9.14404 2.55212L14.3486 12.736Z",stroke:"#D83A52",strokeWidth:"2.42826"})]})}),v.jsx("div",{className:"w-[1px] h-5 bg-[#D0D4E4] mx-2"}),v.jsx("div",{className:"flex items-center justify-center",children:v.jsxs("svg",{width:"80",height:"23",viewBox:"0 0 80 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_2641_13989)",children:v.jsx("path",{d:"M1.79875 10.2148C1.79875 8.97716 1.17188 7.95455 0 7.0957H2.72375C3.2039 7.46144 3.59293 7.93332 3.86041 8.47442C4.1279 9.01552 4.26659 9.61118 4.26563 10.2148C4.26659 10.8184 4.1279 11.4141 3.86041 11.9552C3.59293 12.4963 3.2039 12.9682 2.72375 13.3339C3.60813 13.7027 4.11125 14.6028 4.11125 15.8911V18.3457H1.645V15.8911C1.645 14.664 1.05938 13.8052 0.000625 13.3345C1.1725 12.4751 1.79875 11.4524 1.79875 10.2148ZM7.14375 10.2148C7.14375 8.97716 6.51688 7.95455 5.345 7.0957H8.06938C8.54941 7.46151 8.93832 7.93341 9.20569 8.47451C9.47307 9.01561 9.61166 9.61123 9.61063 10.2148C9.61166 10.8184 9.47307 11.414 9.20569 11.9551C8.93832 12.4962 8.54941 12.9681 8.06938 13.3339C8.95313 13.7027 9.45688 14.6028 9.45688 15.8911V18.3457H6.99V15.8911C6.99 14.664 6.40375 13.8052 5.345 13.3345C6.51688 12.4751 7.14375 11.4524 7.14375 10.2148ZM12.49 10.2148C12.49 8.97716 11.8631 7.95455 10.6913 7.0957H13.415C13.8951 7.46144 14.2842 7.93332 14.5517 8.47442C14.8191 9.01552 14.9578 9.61118 14.9569 10.2148C14.9578 10.8184 14.8191 11.4141 14.5517 11.9552C14.2842 12.4963 13.8951 12.9682 13.415 13.3339C14.2994 13.7027 14.8025 14.6028 14.8025 15.8911V18.3457H12.3356V15.8911C12.3356 14.664 11.75 13.8052 10.6913 13.3345C11.8631 12.4751 12.49 11.4524 12.49 10.2148ZM22.47 16.3017H20.6V9.14093H25.195C27.405 9.14093 28.4944 9.95977 28.4944 11.2993C28.4944 12.2094 27.96 12.8945 26.9631 13.2426C27.9906 13.3958 28.4531 13.9377 28.4531 14.9097V16.3005H26.5619V14.9916C26.5619 14.1727 26.1506 13.8458 25.0713 13.8458H22.4713V16.3017H22.47ZM25.0913 10.1842H22.47V12.8032H25.0706C26.0163 12.8032 26.6019 12.2813 26.6019 11.4631C26.6019 10.6548 26.0581 10.1842 25.0913 10.1842ZM31.7419 9.14093H29.8713V16.3017H31.7419V9.14093ZM37.4775 13.9683H35.1956V16.3005H33.3244V9.14093H37.5181C39.7281 9.14093 40.89 10.0617 40.89 11.5349C40.89 13.0582 39.7081 13.9683 37.4775 13.9683ZM37.4363 10.1842H35.1956V12.9251H37.4156C38.3819 12.9251 38.9781 12.4344 38.9781 11.5449C38.9781 10.6755 38.3819 10.1842 37.4363 10.1842ZM46.1531 13.9683H43.8713V16.3005H42V9.14093H46.1938C48.4038 9.14093 49.5656 10.0617 49.5656 11.5349C49.5656 13.0582 48.3831 13.9683 46.1531 13.9683ZM46.1119 10.1842H43.8713V12.9251H46.0913C47.0575 12.9251 47.6538 12.4344 47.6538 11.5449C47.6538 10.6755 47.0575 10.1842 46.1119 10.1842ZM52.5463 9.14093V15.2366H57.2131V16.3017H50.6756V9.14093H52.5463ZM60.2544 9.14093H58.3838V16.3017H60.2544V9.14093ZM63.0713 11.5343V16.3017H61.8375V9.14093H63.2369L68.335 13.9071V9.14093H69.5688V16.3017H68.1706L63.0713 11.5343ZM75.675 9.97977C73.8963 9.97977 72.735 11.1049 72.735 12.782C72.735 14.4384 73.845 15.4616 75.5719 15.4616H75.695C76.2813 15.4616 76.9388 15.3385 77.5456 15.1447V13.2114H74.5238V12.1888H79.375V15.5535C78.3681 16.0755 76.8463 16.4849 75.6131 16.4849H75.4488C72.6113 16.4849 70.7819 14.991 70.7819 12.8226C70.7819 10.6749 72.6631 8.95716 75.5513 8.95716H75.7156C76.9188 8.95716 78.2956 9.33533 79.3138 9.92852L78.7788 10.7974C77.8644 10.2967 76.7744 9.97977 75.7981 9.97977H75.675Z",fill:"black"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_2641_13989",children:v.jsx("rect",{width:"79.6875",height:"22.5",fill:"white"})})})]})})]}),v.jsx("div",{className:"flex flex-1 items-center justify-center p-8",children:v.jsx("div",{className:"flex w-full max-w-4xl justify-center items-center",children:v.jsx("div",{className:"flex w-full max-w-[672px] h-[284px] p-14 flex-col justify-center items-center gap-14 rounded-2xl bg-white",children:v.jsxs("div",{className:"flex flex-col items-center gap-6 w-full max-w-[560px]",children:[v.jsxs("div",{className:"flex flex-col items-center gap-6",children:[v.jsxs("svg",{width:"70",height:"64",viewBox:"0 0 70 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M31.8463 3.46168C33.5384 1.60417 36.4616 1.60417 38.1537 3.46168L39.7836 5.25035C40.9063 6.48258 42.6437 6.94814 44.2321 6.44234L46.5378 5.70813C48.9322 4.94566 51.4637 6.40722 52.0005 8.86205L52.5175 11.2259C52.8737 12.8544 54.1456 14.1263 55.7741 14.4825L58.1379 14.9995C60.5928 15.5363 62.0543 18.0678 61.2919 20.4622L60.5577 22.7679C60.0519 24.3563 60.5174 26.0937 61.7496 27.2164L63.5383 28.8461C65.3958 30.5384 65.3958 33.4616 63.5383 35.1539L61.7496 36.7836C60.5174 37.9063 60.0519 39.6437 60.5577 41.2321L61.2919 43.5378C62.0543 45.9322 60.5928 48.4637 58.1379 49.0005L55.7741 49.5175C54.1456 49.8737 52.8737 51.1456 52.5175 52.7741L52.0005 55.1379C51.4637 57.5928 48.9322 59.0543 46.5378 58.2919L44.2321 57.5577C42.6437 57.0519 40.9063 57.5174 39.7836 58.7496L38.1537 60.5383C36.4616 62.3958 33.5384 62.3958 31.8463 60.5383L30.2164 58.7496C29.0937 57.5174 27.3563 57.0519 25.7679 57.5577L23.4622 58.2919C21.0678 59.0543 18.5363 57.5928 17.9995 55.1379L17.4825 52.7741C17.1263 51.1456 15.8544 49.8737 14.2259 49.5175L11.8621 49.0005C9.40722 48.4637 7.9457 45.9322 8.70817 43.5378L9.44238 41.2321C9.94818 39.6437 9.48262 37.9063 8.25039 36.7836L6.46172 35.1539C4.60421 33.4616 4.60421 30.5384 6.46172 28.8461L8.25039 27.2164C9.48262 26.0937 9.94818 24.3563 9.44238 22.7679L8.70817 20.4622C7.9457 18.0678 9.40722 15.5363 11.8621 14.9995L14.2259 14.4825C15.8544 14.1263 17.1263 12.8544 17.4825 11.2259L17.9995 8.86205C18.5363 6.40722 21.0678 4.94566 23.4622 5.70813L25.7679 6.44234C27.3563 6.94814 29.0937 6.48258 30.2164 5.25035L31.8463 3.46168Z",fill:"#258750"}),v.jsx("path",{d:"M47.8 24.533L31.6667 40.6663L24.3333 33.333",stroke:"white",strokeWidth:"3.52",strokeLinecap:"round",strokeLinejoin:"round"})]}),v.jsxs("div",{className:"flex flex-col items-center gap-6 text-center",children:[v.jsx("h1",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight",children:"Verification successful"}),v.jsx("p",{className:"text-[#676879] font-roboto text-base font-normal leading-normal",children:"Your identity has been verified."})]})]}),v.jsx("button",{onClick:()=>window.location.href="/password-setup",className:"flex h-12 px-6 py-3 justify-center items-center gap-2 rounded bg-primary hover:bg-primary/90 transition-colors",children:v.jsx("span",{className:"text-white font-roboto text-base font-medium",children:"Set Password"})})]})})})})]})}const Op=[{code:"+91",name:"India",length:10},{code:"+1",name:"United States",length:10},{code:"+44",name:"United Kingdom",length:10},{code:"+61",name:"Australia",length:9},{code:"+49",name:"Germany",length:10},{code:"+33",name:"France",length:9},{code:"+55",name:"Brazil",length:11}];function b8e(){const[n,e]=F.useState(""),[t,r]=F.useState("email"),[o,s]=F.useState(""),[i,a]=F.useState(""),[l,c]=F.useState(""),[u,d]=F.useState(""),h=ci(),p=()=>{const g=n.trim();if(t==="email"){if(!g||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g)){s("Please enter a valid email address.");return}h("/auth/otp",{state:{emailOrPhone:g}});return}if(!i){c("Please select a country code.");return}if(c(""),!g){d("Please enter a valid phone number.");return}const x=Op.find(b=>b.code===i),y=g.replace(/\D/g,"");if(!y){d("Please enter a valid phone number.");return}if(x&&x.length!==void 0){if(y.length!==x.length){d("Please enter a valid phone number.");return}}else if(y.length<7||y.length>15){d("Please enter a valid phone number.");return}d(""),h("/auth/otp",{state:{emailOrPhone:`${i}${y}`}})};return v.jsxs("div",{className:"flex w-full min-h-screen bg-white",children:[v.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-white",children:[v.jsxs("div",{className:"absolute inset-0",children:[v.jsx("div",{className:"absolute w-[342px] h-[342px] rounded-full bg-[#BCD2E8] blur-[115px] left-[239px] top-[301px]"}),v.jsx("div",{className:"absolute w-[465px] h-[397px] rounded-full bg-[#E0EFFE] blur-[80px] left-0 top-0"}),v.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-gradient-to-br from-[#E0EFFE] via-[#F3CFFF] to-[#F3CFFF] backdrop-blur-[7.5px] transform rotate-[6.554deg] left-[275px] top-[140px]"}),v.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-white backdrop-blur-[7.5px] left-[276px] top-[150px]"}),v.jsx("div",{className:"absolute w-[185px] h-[130px] rounded-2xl bg-[#E0EFFE] left-[309px] top-[205px]"}),v.jsx("svg",{className:"absolute w-6 h-6 left-[488px] top-[166px]",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L8.20711 11.2929C7.81658 10.9024 7.18342 10.9024 6.79289 11.2929C6.40237 11.6834 6.40237 12.3166 6.79289 12.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z",fill:"#258750"})}),v.jsx("svg",{className:"absolute w-[145px] h-[121px] left-[466px] top-[140px]",viewBox:"0 0 147 123",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M54.5 7.99954C83 -7.00098 150.09 0.513069 145.701 45.8941C141.318 91.2094 66.3066 105.225 1 122.126",stroke:"black",strokeOpacity:"0.44",strokeDasharray:"2 2"})})]}),v.jsxs("div",{className:"absolute bottom-24 left-20 right-20 text-center",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight mb-6",children:"Proof of identity, made simple."}),v.jsx("p",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]}),v.jsxs("div",{className:"flex-1 lg:w-1/2 flex flex-col",children:[v.jsx("div",{className:"lg:hidden absolute inset-0 overflow-hidden",children:v.jsxs("div",{className:"absolute w-[279px] h-[123px] transform -rotate-12 opacity-80 left-[190px] top-[214px]",children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#F8E4E8] to-transparent opacity-50 rounded-full blur-[35px]"}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#E0EFFE] to-transparent opacity-50 rounded-full blur-[27px]"})]})}),v.jsx("div",{className:"flex justify-center items-center h-14 border-b border-[#D0D4E4] px-8 relative z-10",children:v.jsxs("svg",{width:"124",height:"25",viewBox:"0 0 126 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M37.9516 10.9901C39.5704 9.21066 41.53 8.3208 43.8304 8.3208C45.0232 8.3208 46.1201 8.62106 47.1212 9.22131C48.1223 9.82169 48.889 10.5935 49.4216 11.5369L49.7091 8.61028H53.7987V26.2983H49.7091L49.4216 23.3396C48.889 24.283 48.1223 25.0548 47.1212 25.655C46.1201 26.2554 45.0232 26.5556 43.8304 26.5556C41.53 26.5556 39.5704 25.6658 37.9516 23.8862C36.3328 22.0853 35.5234 19.9306 35.5234 17.4221C35.5234 14.9136 36.3328 12.7696 37.9516 10.9901ZM41.4021 20.7025C42.2967 21.6243 43.3831 22.0853 44.661 22.0853C45.9604 22.0853 47.0573 21.6351 47.9518 20.7346C48.8464 19.8126 49.2938 18.7085 49.2938 17.4221C49.2938 16.1358 48.8464 15.0423 47.9518 14.1418C47.0573 13.2198 45.9604 12.7589 44.661 12.7589C43.3831 12.7589 42.2967 13.2198 41.4021 14.1418C40.5076 15.0423 40.0603 16.1358 40.0603 17.4221C40.0603 18.7085 40.5076 19.802 41.4021 20.7025ZM57.5403 8.61028H61.6298L61.9494 11.1509C62.9931 9.37144 64.729 8.48171 67.1572 8.48171C67.7749 8.48171 68.3074 8.52456 68.7547 8.61028L67.8281 12.9519C67.5725 12.9091 67.3915 12.8875 67.285 12.8875C65.794 12.8875 64.548 13.3485 63.5468 14.2705C62.5457 15.1709 62.0453 16.7038 62.0453 18.8693V26.2983H57.5403V8.61028ZM73.0891 11.0223C74.8357 9.24274 76.9551 8.35301 79.4471 8.35301C80.9381 8.35301 82.3333 8.70677 83.6325 9.4143C84.9319 10.1004 86.0075 11.033 86.8595 12.2122L83.1533 14.6885C82.2374 13.5308 81.0021 12.9519 79.4471 12.9519C78.2118 12.9519 77.1574 13.3914 76.2841 14.2705C75.4109 15.1494 74.9741 16.2107 74.9741 17.4543C74.9741 18.7193 75.4109 19.7912 76.2841 20.6703C77.1574 21.5494 78.2118 21.9888 79.4471 21.9888C81.0872 21.9888 82.3439 21.3456 83.2172 20.0593L86.9553 22.5677C86.1247 23.7899 85.049 24.7653 83.7284 25.4943C82.4079 26.2232 80.9808 26.5878 79.4471 26.5878C76.9551 26.5878 74.8251 25.6979 73.0571 23.9184C71.3106 22.1175 70.4373 19.9628 70.4373 17.4543C70.4373 14.9458 71.3213 12.8018 73.0891 11.0223ZM91.4977 11.0223C93.2443 9.24274 95.3636 8.35301 97.8558 8.35301C100.348 8.35301 102.478 9.25352 104.246 11.0544C106.035 12.834 106.929 14.9672 106.929 17.4543C106.929 19.9628 106.046 22.1068 104.278 23.8862C102.488 25.6873 100.348 26.5878 97.8558 26.5878C95.3636 26.5878 93.2336 25.6979 91.4658 23.9184C89.7191 22.1175 88.8459 19.9628 88.8459 17.4543C88.8459 14.9458 89.7298 12.8018 91.4977 11.0223ZM93.3828 17.4543C93.3828 18.7193 93.8194 19.7912 94.6927 20.6703C95.566 21.5494 96.6203 21.9888 97.8558 21.9888C99.1124 21.9888 100.177 21.5494 101.051 20.6703C101.924 19.7912 102.361 18.7193 102.361 17.4543C102.361 16.2107 101.924 15.1494 101.051 14.2705C100.177 13.3914 99.1124 12.9519 97.8558 12.9519C96.6203 12.9519 95.566 13.3914 94.6927 14.2705C93.8194 15.1494 93.3828 16.2107 93.3828 17.4543ZM109.802 26.2983V8.61028H113.892L114.179 11.1831C114.69 10.3255 115.361 9.63936 116.192 9.12482C117.044 8.58885 118.002 8.3208 119.067 8.3208C121.197 8.3208 122.88 9.06053 124.116 10.5399C125.372 12.0192 126 14.2597 126 17.2614V26.2983H121.527V17.2614C121.527 15.782 121.176 14.6671 120.473 13.9167C119.792 13.1449 118.94 12.7589 117.917 12.7589C116.873 12.7589 116.011 13.1449 115.329 13.9167C114.648 14.6671 114.307 15.782 114.307 17.2614V26.2983H109.802Z",fill:"#323238"}),v.jsx("path",{d:"M27.3723 22.6039C27.9964 23.7209 27.189 25.097 25.9095 25.097H4.88702C3.6005 25.097 2.79387 23.7073 3.43201 22.5902L14.0587 3.98729C14.7055 2.85516 16.3405 2.86285 16.9765 4.00102L27.3723 22.6039Z",stroke:"#D83A52",strokeWidth:"4.5177"})]})}),v.jsx("div",{className:"flex-1 flex items-center justify-center p-8 relative z-10",children:v.jsx("div",{className:"w-full max-w-[360px]",children:v.jsxs("div",{className:"flex flex-col gap-6",children:[v.jsxs("div",{className:"text-center space-y-2",children:[v.jsx("h1",{className:"text-[#172B4D] font-roboto text-[28px] font-bold leading-[42px]",children:"Welcome back!"}),v.jsx("p",{className:"text-[#676879] font-roboto text-sm font-normal leading-[22px]",children:"Get a login code via email or mobile."})]}),v.jsxs("div",{className:"space-y-6",children:[v.jsxs("div",{className:"flex items-center gap-2 bg-[#F6F7FB] rounded p-1 w-full",children:[v.jsx("button",{type:"button",onClick:()=>{r("email"),s(""),d(""),c(""),a(""),e("")},className:`flex-1 h-10 rounded text-sm font-medium ${t==="email"?"bg-white shadow text-[#172B4D]":"text-[#676879]"}`,children:"Email"}),v.jsx("button",{type:"button",onClick:()=>{r("phone"),s(""),d(""),c(""),a(""),e("")},className:`flex-1 h-10 rounded text-sm font-medium ${t==="phone"?"bg-white shadow text-[#172B4D]":"text-[#676879]"}`,children:"Mobile"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx("label",{className:"block text-[#323238] font-roboto text-[13px] font-medium",children:t==="email"?"Email Address":"Mobile Number"}),t==="phone"?v.jsxs("div",{className:"flex gap-2",children:[v.jsxs("div",{className:"w-36",children:[v.jsxs("select",{value:i,onChange:g=>{a(g.target.value),c(""),d("")},className:"w-full h-[54px] px-2 border border-[#C3C6D4] rounded bg-white text-[#676879] font-roboto text-base focus:outline-none focus:ring-2 focus:ring-primary",children:[v.jsx("option",{value:"",children:"Select country"}),Op.map(g=>v.jsx("option",{value:g.code,children:`${g.code} (${g.name})`},g.code))]}),l&&v.jsx("p",{className:"text-sm text-destructive mt-1",children:l})]}),v.jsx("input",{type:"text",inputMode:"numeric",value:n,onChange:g=>{const b=g.target.value.replace(/\D/g,"").trimStart();e(b),d("")},onBlur:()=>{const g=n.trim();if(e(g),!i){c("Please select a country code.");return}const x=Op.find(b=>b.code===i),y=g.replace(/\D/g,"");if(!y){d("Please enter a valid phone number.");return}if(x&&x.length!==void 0){if(y.length!==x.length){d("Please enter a valid phone number.");return}}else if(y.length<7||y.length>15){d("Please enter a valid phone number.");return}d("")},placeholder:i?`e.g. ${Op.find(g=>g.code===i)?.length?"9".repeat(Op.find(g=>g.code===i).length):"Phone number"}`:"Enter mobile number",className:"flex-1 h-[54px] px-3 py-4 border border-[#C3C6D4] rounded bg-white text-[#676879] font-roboto text-base placeholder:text-[#676879] focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}):v.jsx("input",{type:"text",value:n,onChange:g=>{const y=g.target.value.trimStart();e(y),t==="email"&&s("")},onBlur:()=>{const g=n.trim();e(g),t==="email"&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g)?s(""):s("Please enter a valid email address."))},placeholder:t==="email"?"example@domain.com":"Enter mobile number",className:"w-full h-[54px] px-3 py-4 border border-[#C3C6D4] rounded bg-white text-[#676879] font-roboto text-base placeholder:text-[#676879] focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),o&&v.jsx("p",{className:"text-sm text-destructive mt-1",children:o}),u&&v.jsx("p",{className:"text-sm text-destructive mt-1",children:u})]}),v.jsx("button",{onClick:p,disabled:t==="email"?!n.trim()||!!o:!i||!n.trim()||!!u,className:`w-full h-12 px-4 py-3 rounded font-roboto text-base font-bold transition-colors ${n.trim()?"bg-primary hover:bg-primary/90 text-white":"bg-primary/50 text-white cursor-not-allowed"}`,children:"Send OTP"})]})]})})}),v.jsxs("div",{className:"lg:hidden p-8 text-center relative z-10",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight mb-6",children:"Proof of identity, made simple."}),v.jsx("p",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]})]})}function w8e(){const[n,e]=F.useState(["","","","","",""]),[t,r]=F.useState(!1),o=F.useRef([]),s=Rm(),i=ci(),a=s.state?.emailOrPhone||"amritemail.com";F.useEffect(()=>{o.current[0]?.focus()},[]);const l=(g,x)=>{if(x.length>1)return;const y=[...n];y[g]=x,e(y),x&&g<5&&o.current[g+1]?.focus()},c=(g,x)=>{x.key==="Backspace"&&!n[g]&&g>0&&o.current[g-1]?.focus()},u=g=>{g.preventDefault();const x=g.clipboardData.getData("text").slice(0,6),y=[...n];for(let C=0;C<x.length&&C<6;C++)y[C]=x[C];e(y);const b=Math.min(x.length,5);o.current[b]?.focus()},d=async()=>{r(!0),await new Promise(g=>setTimeout(g,1e3)),r(!1)},h=()=>{n.join("").length===6&&i("/dashboard")},p=n.every(g=>g!=="");return v.jsxs("div",{className:"flex w-full min-h-screen bg-white",children:[v.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-white",children:[v.jsxs("div",{className:"absolute inset-0",children:[v.jsx("div",{className:"absolute w-[342px] h-[342px] rounded-full bg-[#BCD2E8] blur-[115px] left-[239px] top-[301px]"}),v.jsx("div",{className:"absolute w-[465px] h-[397px] rounded-full bg-[#E0EFFE] blur-[80px] left-0 top-0"}),v.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-gradient-to-br from-[#E0EFFE] via-[#F3CFFF] to-[#F3CFFF] backdrop-blur-[7.5px] transform rotate-[6.554deg] left-[275px] top-[140px]"}),v.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-white backdrop-blur-[7.5px] left-[276px] top-[150px]"}),v.jsx("div",{className:"absolute w-[185px] h-[130px] rounded-2xl bg-[#E0EFFE] left-[309px] top-[205px]"}),v.jsx("svg",{className:"absolute w-6 h-6 left-[488px] top-[166px]",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L8.20711 11.2929C7.81658 10.9024 7.18342 10.9024 6.79289 11.2929C6.40237 11.6834 6.40237 12.3166 6.79289 12.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z",fill:"#258750"})}),v.jsx("svg",{className:"absolute w-[145px] h-[121px] left-[466px] top-[140px]",viewBox:"0 0 147 123",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M54.5 7.99954C83 -7.00098 150.09 0.513069 145.701 45.8941C141.318 91.2094 66.3066 105.225 1 122.126",stroke:"black",strokeOpacity:"0.44",strokeDasharray:"2 2"})})]}),v.jsxs("div",{className:"absolute bottom-24 left-20 right-20 text-center",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight mb-6",children:"Proof of identity, made simple."}),v.jsx("p",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]}),v.jsxs("div",{className:"flex-1 lg:w-1/2 flex flex-col",children:[v.jsx("div",{className:"lg:hidden absolute inset-0 overflow-hidden",children:v.jsxs("div",{className:"absolute w-[279px] h-[123px] transform -rotate-12 opacity-80 left-[190px] top-[214px]",children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#F8E4E8] to-transparent opacity-50 rounded-full blur-[35px]"}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#E0EFFE] to-transparent opacity-50 rounded-full blur-[27px]"})]})}),v.jsx("div",{className:"flex justify-center items-center h-14 border-b border-[#D0D4E4] px-8 relative z-10",children:v.jsxs("svg",{width:"124",height:"25",viewBox:"0 0 126 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M37.9516 10.9901C39.5704 9.21066 41.53 8.3208 43.8304 8.3208C45.0232 8.3208 46.1201 8.62106 47.1212 9.22131C48.1223 9.82169 48.889 10.5935 49.4216 11.5369L49.7091 8.61028H53.7987V26.2983H49.7091L49.4216 23.3396C48.889 24.283 48.1223 25.0548 47.1212 25.655C46.1201 26.2554 45.0232 26.5556 43.8304 26.5556C41.53 26.5556 39.5704 25.6658 37.9516 23.8862C36.3328 22.0853 35.5234 19.9306 35.5234 17.4221C35.5234 14.9136 36.3328 12.7696 37.9516 10.9901ZM41.4021 20.7025C42.2967 21.6243 43.3831 22.0853 44.661 22.0853C45.9604 22.0853 47.0573 21.6351 47.9518 20.7346C48.8464 19.8126 49.2938 18.7085 49.2938 17.4221C49.2938 16.1358 48.8464 15.0423 47.9518 14.1418C47.0573 13.2198 45.9604 12.7589 44.661 12.7589C43.3831 12.7589 42.2967 13.2198 41.4021 14.1418C40.5076 15.0423 40.0603 16.1358 40.0603 17.4221C40.0603 18.7085 40.5076 19.802 41.4021 20.7025ZM57.5403 8.61028H61.6298L61.9494 11.1509C62.9931 9.37144 64.729 8.48171 67.1572 8.48171C67.7749 8.48171 68.3074 8.52456 68.7547 8.61028L67.8281 12.9519C67.5725 12.9091 67.3915 12.8875 67.285 12.8875C65.794 12.8875 64.548 13.3485 63.5468 14.2705C62.5457 15.1709 62.0453 16.7038 62.0453 18.8693V26.2983H57.5403V8.61028ZM73.0891 11.0223C74.8357 9.24274 76.9551 8.35301 79.4471 8.35301C80.9381 8.35301 82.3333 8.70677 83.6325 9.4143C84.9319 10.1004 86.0075 11.033 86.8595 12.2122L83.1533 14.6885C82.2374 13.5308 81.0021 12.9519 79.4471 12.9519C78.2118 12.9519 77.1574 13.3914 76.2841 14.2705C75.4109 15.1494 74.9741 16.2107 74.9741 17.4543C74.9741 18.7193 75.4109 19.7912 76.2841 20.6703C77.1574 21.5494 78.2118 21.9888 79.4471 21.9888C81.0872 21.9888 82.3439 21.3456 83.2172 20.0593L86.9553 22.5677C86.1247 23.7899 85.049 24.7653 83.7284 25.4943C82.4079 26.2232 80.9808 26.5878 79.4471 26.5878C76.9551 26.5878 74.8251 25.6979 73.0571 23.9184C71.3106 22.1175 70.4373 19.9628 70.4373 17.4543C70.4373 14.9458 71.3213 12.8018 73.0891 11.0223ZM91.4977 11.0223C93.2443 9.24274 95.3636 8.35301 97.8558 8.35301C100.348 8.35301 102.478 9.25352 104.246 11.0544C106.035 12.834 106.929 14.9672 106.929 17.4543C106.929 19.9628 106.046 22.1068 104.278 23.8862C102.488 25.6873 100.348 26.5878 97.8558 26.5878C95.3636 26.5878 93.2336 25.6979 91.4658 23.9184C89.7191 22.1175 88.8459 19.9628 88.8459 17.4543C88.8459 14.9458 89.7298 12.8018 91.4977 11.0223ZM93.3828 17.4543C93.3828 18.7193 93.8194 19.7912 94.6927 20.6703C95.566 21.5494 96.6203 21.9888 97.8558 21.9888C99.1124 21.9888 100.177 21.5494 101.051 20.6703C101.924 19.7912 102.361 18.7193 102.361 17.4543C102.361 16.2107 101.924 15.1494 101.051 14.2705C100.177 13.3914 99.1124 12.9519 97.8558 12.9519C96.6203 12.9519 95.566 13.3914 94.6927 14.2705C93.8194 15.1494 93.3828 16.2107 93.3828 17.4543ZM109.802 26.2983V8.61028H113.892L114.179 11.1831C114.69 10.3255 115.361 9.63936 116.192 9.12482C117.044 8.58885 118.002 8.3208 119.067 8.3208C121.197 8.3208 122.88 9.06053 124.116 10.5399C125.372 12.0192 126 14.2597 126 17.2614V26.2983H121.527V17.2614C121.527 15.782 121.176 14.6671 120.473 13.9167C119.792 13.1449 118.94 12.7589 117.917 12.7589C116.873 12.7589 116.011 13.1449 115.329 13.9167C114.648 14.6671 114.307 15.782 114.307 17.2614V26.2983H109.802Z",fill:"#323238"}),v.jsx("path",{d:"M27.3723 22.6039C27.9964 23.7209 27.189 25.097 25.9095 25.097H4.88702C3.6005 25.097 2.79387 23.7073 3.43201 22.5902L14.0587 3.98729C14.7055 2.85516 16.3405 2.86285 16.9765 4.00102L27.3723 22.6039Z",stroke:"#D83A52",strokeWidth:"4.5177"})]})}),v.jsx("div",{className:"flex-1 flex items-center justify-center p-8 relative z-10",children:v.jsx("div",{className:"w-full max-w-[360px]",children:v.jsxs("div",{className:"flex flex-col gap-6",children:[v.jsxs("div",{className:"text-center space-y-2",children:[v.jsx("h1",{className:"text-[#172B4D] font-roboto text-[28px] font-bold leading-[42px]",children:"Enter Verification Code"}),v.jsxs("p",{className:"text-[#676879] font-roboto text-sm font-normal leading-[22px]",children:["We've sent a code to ",a]})]}),v.jsx("div",{className:"flex justify-center gap-4",children:n.map((g,x)=>v.jsx("input",{ref:y=>o.current[x]=y,type:"text",value:g,onChange:y=>l(x,y.target.value),onKeyDown:y=>c(x,y),onPaste:x===0?u:void 0,className:"w-12 h-[54px] text-center border border-[#C3C6D4] rounded bg-white text-lg font-medium focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",maxLength:1},x))}),v.jsx("div",{className:"text-center",children:v.jsx("button",{onClick:d,disabled:t,className:"text-[#676879] font-roboto text-sm font-normal hover:text-primary transition-colors",children:t?"Sending...":v.jsxs(v.Fragment,{children:["Didn't get a code?"," ",v.jsx("span",{className:"text-primary underline",children:"Click to Resend"})]})})}),v.jsx("button",{onClick:h,disabled:!p,className:`w-full h-12 px-4 py-3 rounded font-roboto text-base font-bold transition-colors ${p?"bg-primary hover:bg-primary/90 text-white":"bg-primary/50 text-white cursor-not-allowed"}`,children:"Log In"})]})})}),v.jsxs("div",{className:"lg:hidden p-8 text-center relative z-10",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight mb-6",children:"Proof of identity, made simple."}),v.jsx("p",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]})]})}const C8e=({status:n})=>{const e=n==="in-progress";return v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx("div",{className:`w-2 h-2 rounded-full ${e?"bg-[#C98F20]":"bg-[#616273]"}`}),v.jsx("span",{className:`font-roboto text-xs font-normal leading-5 ${e?"text-[#402C1B]":"text-[#616273]"}`,children:e?"In Progress":"Not Yet Started"})]})},k8e=({progress:n})=>{const o=67.181*Math.PI,s=o-n/100*o;return v.jsxs("div",{className:"relative w-20 h-20",children:[v.jsxs("svg",{className:"w-20 h-20 -rotate-90",width:"80",height:"80",children:[v.jsx("circle",{cx:"40",cy:"40",r:33.5905,fill:"white",stroke:"#E9EDF3",strokeWidth:4.819}),n>0&&v.jsx("circle",{cx:"40",cy:"40",r:33.5905,fill:"none",stroke:"#0073EA",strokeWidth:4.819,strokeDasharray:`${o} ${o}`,strokeDashoffset:s,strokeLinecap:"round"})]}),v.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:v.jsxs("span",{className:"text-black font-roboto text-[23px] font-bold leading-[25px]",children:[n,"%"]})})]})};function s4({title:n,documentType:e,progress:t,expiryDate:r,status:o}){const s=o==="in-progress"?"#EFDDBC":"#E9EAED";return v.jsx("div",{className:"flex flex-col items-start rounded border-l-[8px]",style:{borderLeftColor:s},children:v.jsxs("div",{className:"flex px-3 py-2 flex-col justify-center items-start self-stretch rounded-tr rounded-br border-t border-r border-b border-[#DEDEDD] bg-white",children:[v.jsxs("div",{className:"flex h-7 justify-between items-center self-stretch",children:[v.jsx("h3",{className:"flex-1 text-[#402C1B] text-center font-roboto text-sm font-bold leading-normal truncate",children:n}),v.jsx(C8e,{status:o})]}),v.jsxs("div",{className:"flex items-center gap-4 self-stretch",children:[v.jsx(k8e,{progress:t}),v.jsxs("div",{className:"flex flex-col justify-center items-start gap-1 flex-1",children:[v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:e}),v.jsxs("div",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:[v.jsx("span",{className:"font-semibold text-[#D83A52]",children:"Expires"})," on"," ",r]})]})]})]})})}const S8e=()=>v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx("div",{className:"w-2 h-2 rounded-full bg-[#D83A52]"}),v.jsx("span",{className:"font-roboto text-xs font-normal leading-5 text-[#49290E]",children:"Expired"})]});function cB({title:n,documentType:e,expiredDate:t,issuedOn:r}){return v.jsx("div",{className:"flex flex-col items-start gap-2 rounded border border-[#DEDEDD] bg-white",children:v.jsxs("div",{className:"flex px-3 py-2 flex-col justify-center items-start self-stretch gap-2",children:[v.jsxs("div",{className:"flex h-7 justify-between items-center self-stretch",children:[v.jsx("h3",{className:"flex-1 text-[#172B4D] text-center font-roboto text-sm font-bold leading-normal truncate",children:n}),v.jsx(S8e,{})]}),v.jsx("div",{className:"flex items-center justify-center gap-2 self-stretch",children:v.jsxs("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:["You have successfully submitted the ",e]})}),v.jsxs("div",{className:"flex justify-between items-start self-stretch",children:[v.jsxs("div",{className:"flex flex-col items-start gap-1",children:[v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Issued on"}),v.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-5",children:r})]}),v.jsxs("div",{className:"flex flex-col items-start gap-1",children:[v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Expired on"}),v.jsx("span",{className:"text-[#D83A52] font-roboto text-xs font-semibold leading-5",children:t})]})]}),v.jsxs("button",{className:"flex items-center gap-0.5",children:[v.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M8 8.66667V12M8 5.33333H8.00667M14.6667 8C14.6667 11.6819 11.6819 14.6667 8 14.6667C4.3181 14.6667 1.33333 11.6819 1.33333 8C1.33333 4.3181 4.3181 1.33333 8 1.33333C11.6819 1.33333 14.6667 4.3181 14.6667 8Z",stroke:"#D83A52",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-[#D83A52] font-roboto text-xs font-normal leading-5",children:"Link expired before completion"})]})]})})}const N8e=()=>v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx("div",{className:"w-2 h-2 rounded-full bg-[#5E9872]"}),v.jsx("span",{className:"font-roboto text-xs font-normal leading-5 text-[#1C3829]",children:"Verified"})]});function uB({title:n,documentType:e,completedOn:t,expiresOn:r}){return v.jsx("div",{className:"flex flex-col items-start gap-2 rounded border border-[#DEDEDD] bg-white",children:v.jsxs("div",{className:"flex px-3 py-2 flex-col justify-center items-start self-stretch gap-2",children:[v.jsxs("div",{className:"flex h-7 justify-between items-center self-stretch",children:[v.jsx("h3",{className:"flex-1 text-[#172B4D] text-center font-roboto text-sm font-bold leading-normal truncate",children:n}),v.jsx(N8e,{})]}),v.jsx("div",{className:"flex items-center justify-center gap-2 self-stretch",children:v.jsxs("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:["You have successfully submitted the ",e]})}),v.jsxs("div",{className:"flex justify-between items-start self-stretch",children:[v.jsxs("div",{className:"flex flex-col items-start gap-1",children:[v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Completed on"}),v.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-5",children:t})]}),v.jsxs("div",{className:"flex flex-col items-start gap-1",children:[v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Expires on"}),v.jsx("span",{className:"text-[#D83A52] font-roboto text-xs font-semibold leading-5",children:r})]})]}),v.jsxs("button",{className:"flex items-center gap-0.5 text-[#0073EA] font-roboto text-xs font-normal leading-5",children:["View Details",v.jsx("svg",{className:"w-3 h-3",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M2.5 6H9.5M9.5 6L6.5 3M9.5 6L6.5 9",stroke:"#0073EA",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})})}const I8e=[{id:"1",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Oct 10, 2025",status:"in-progress"},{id:"2",title:"Employment Verification",documentType:"Employee ID Card",progress:0,expiryDate:"Oct 10, 2025",status:"not-started"},{id:"3",title:"Employment Verification",documentType:"Employee ID Card",progress:0,expiryDate:"N/A",status:"not-started"}],E8e=[{id:"4",title:"Arcon Document Submission",documentType:"Passport",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"5",title:"Arcon Document Submission",documentType:"Passport",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"6",title:"Arcon Document Submission",documentType:"Passport",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"}],T8e=[{id:"7",title:"Arcon Document Submission",documentType:"Passport",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"8",title:"Arcon Document Submission",documentType:"Passport",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"9",title:"Arcon Document Submission",documentType:"Passport",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"}],R8e=({cards:n})=>v.jsxs("div",{className:"flex flex-col items-start gap-2.5 w-full",children:[v.jsxs("div",{className:"flex justify-between items-start w-full",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Ongoing Verifications"}),v.jsx("button",{className:"flex h-7 px-3 py-2.25 justify-center items-center gap-2 rounded",children:v.jsx("span",{className:"text-[#0073EA] font-roboto text-xs font-medium leading-normal",children:"View All"})})]}),v.jsx("div",{className:"grid w-full gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:n.map(e=>v.jsx("div",{className:"w-full",children:v.jsx(s4,{title:e.title,documentType:e.documentType,progress:e.progress,expiryDate:e.expiryDate,status:e.status})},e.id))})]}),D8e=({cards:n})=>v.jsxs("div",{className:"flex flex-col items-start gap-2.5 w-full",children:[v.jsxs("div",{className:"flex justify-between items-start w-full",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Expired Verification"}),v.jsx("button",{className:"flex h-7 px-3 py-2.25 justify-center items-center gap-2 rounded",children:v.jsx("span",{className:"text-[#0073EA] font-roboto text-xs font-medium leading-normal",children:"View All"})})]}),v.jsx("div",{className:"grid w-full gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:n.map(e=>v.jsx("div",{className:"w-full",children:v.jsx(cB,{title:e.title,documentType:e.documentType,expiredDate:e.expiredDate,issuedOn:e.issuedOn})},e.id))})]}),A8e=({cards:n})=>v.jsxs("div",{className:"flex flex-col items-start gap-2.5 w-full",children:[v.jsxs("div",{className:"flex justify-between items-start w-full",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Verified Credentials"}),v.jsx("button",{className:"flex h-7 px-3 py-2.25 justify-center items-center gap-2 rounded",children:v.jsx("span",{className:"text-[#0073EA] font-roboto text-xs font-medium leading-normal",children:"View All"})})]}),v.jsx("div",{className:"grid w-full gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:n.map(e=>v.jsx("div",{className:"w-full",children:v.jsx(uB,{title:e.title,documentType:e.documentType,completedOn:e.completedOn,expiresOn:e.expiresOn})},e.id))})]});function _8e(){const n=ci(),[e,t]=F.useState("home"),r=[{id:"home",label:"Home",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56584 1.11261C9.85109 1.03538 10.1518 1.03538 10.437 1.11261C10.7681 1.20227 11.0469 1.42115 11.2694 1.59584C13.1889 3.10283 15.1203 4.59457 17.0483 6.09074C17.3622 6.33431 17.6387 6.5489 17.8447 6.82749C18.0255 7.07197 18.1603 7.3474 18.2422 7.64023C18.3356 7.97391 18.3353 8.32392 18.3348 8.72123C18.3327 10.769 18.3348 12.8167 18.3348 14.8645C18.3348 15.3037 18.3348 15.6826 18.3093 15.9948C18.2823 16.3243 18.2229 16.652 18.0623 16.9673C17.8226 17.4376 17.4401 17.8201 16.9698 18.0598C16.6544 18.2205 16.3268 18.2799 15.9973 18.3068C15.3293 18.3614 14.6518 18.332 13.9821 18.3323C13.8828 18.3323 13.7643 18.3324 13.6599 18.3239C13.5388 18.314 13.3655 18.2886 13.1839 18.1961C12.9488 18.0762 12.7575 17.885 12.6377 17.6498C12.5451 17.4681 12.5198 17.2948 12.5098 17.1738C12.5013 17.0694 12.5013 16.9508 12.5014 16.8516L12.508 12.1881C12.5087 11.7207 12.5089 11.4871 12.4183 11.3086C12.3384 11.1516 12.2109 11.0238 12.054 10.9438C11.8756 10.8528 11.6419 10.8528 11.1747 10.8528H8.84143C8.37534 10.8528 8.14227 10.8528 7.96414 10.9435C7.80744 11.0232 7.67999 11.1505 7.60002 11.3071C7.50909 11.4851 7.50876 11.7181 7.50809 12.1842L7.50142 16.8516C7.50146 16.9508 7.5015 17.0694 7.49297 17.1738C7.48309 17.2948 7.45772 17.4681 7.36518 17.6498C7.24534 17.885 7.05411 18.0762 6.8189 18.1961C6.63729 18.2886 6.46395 18.314 6.34294 18.3239C6.23851 18.3324 6.11997 18.3323 6.02071 18.3323C5.35097 18.332 4.67349 18.3614 4.00556 18.3068C3.6761 18.2799 3.34843 18.2205 3.03311 18.0598C2.5627 17.8201 2.18025 17.4376 1.94057 16.9673C1.7799 16.652 1.72048 16.3243 1.69356 15.9948C1.66805 15.6826 1.66807 15.3037 1.66809 14.8644C1.66809 12.8166 1.67024 10.7689 1.66803 8.72123C1.66759 8.32392 1.66722 7.97391 1.76062 7.64023C1.84259 7.3474 1.97729 7.07197 2.15812 6.82749C2.36417 6.5489 2.64068 6.33431 2.95454 6.09075C4.88239 4.59464 6.814 3.1028 8.73343 1.59584C8.95593 1.42115 9.23468 1.20227 9.56584 1.11261Z",fill:o?"#0073EA":"#676879"})})},{id:"ongoing",label:"Ongoing Verification",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:o=>v.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_11001_18676)",children:v.jsx("path",{d:"M12.5013 7.50521L7.5013 12.5052M7.5013 7.50521L12.5013 12.5052M18.3346 10.0052C18.3346 14.6075 14.6036 18.3385 10.0013 18.3385C5.39893 18.3385 1.66797 14.6075 1.66797 10.0052C1.66797 5.40283 5.39893 1.67188 10.0013 1.67188C14.6036 1.67188 18.3346 5.40283 18.3346 10.0052Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_11001_18676",children:v.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M16.6654 17.5C16.6654 16.337 16.6654 15.7556 16.5219 15.2824C16.1987 14.2171 15.3649 13.3833 14.2996 13.0602C13.8264 12.9167 13.245 12.9167 12.082 12.9167H7.91536C6.7524 12.9167 6.17091 12.9167 5.69775 13.0602C4.63241 13.3833 3.79873 14.2171 3.47556 15.2824C3.33203 15.7556 3.33203 16.337 3.33203 17.5M13.7487 6.25C13.7487 8.32107 12.0698 10 9.9987 10C7.92763 10 6.2487 8.32107 6.2487 6.25C6.2487 4.17893 7.92763 2.5 9.9987 2.5C12.0698 2.5 13.7487 4.17893 13.7487 6.25Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}];return v.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[v.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[v.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:v.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),v.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[v.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:r.map(o=>{const s=e===o.id;return v.jsxs("button",{onClick:()=>{t(o.id),o.onClick?.()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${s?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[s&&v.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),o.icon(s),v.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${s?"text-[#172B4D]":"text-[#505258]"}`,children:o.label})]},o.id)})}),v.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[v.jsxs("div",{className:"flex w-full items-center gap-2.5 rounded-b-2xl bg-black relative overflow-hidden h-[138px]",children:[v.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/38b9840b8e157e2e4686f0512b46f97b9e7cb4c5?width=2700",alt:"",className:"absolute w-full h-full object-cover"}),v.jsxs("div",{className:"flex px-4 flex-col justify-center items-start gap-0.5 flex-1 relative z-10",children:[v.jsx("h1",{className:"text-white font-roboto text-2xl font-semibold leading-[30px]",children:"Welcome, Opinder Singh !"}),v.jsx("p",{className:"text-white font-roboto text-[13px] font-normal leading-[30px]",children:"Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin"})]})]}),v.jsxs("div",{className:"flex px-4 py-5 flex-col items-start gap-6 self-stretch",children:[v.jsx(R8e,{cards:I8e}),v.jsx(A8e,{cards:T8e}),v.jsx(D8e,{cards:E8e})]})]})]})]})}function $8e(){const n=ci(),[e,t]=F.useState(""),[r,o]=F.useState(!1),[s,i]=F.useState(""),[a,l]=F.useState(""),[c,u]=F.useState(""),[d,h]=F.useState(!1),[p,g]=F.useState(!1),[x,y]=F.useState(!1),b=[{id:"home",label:"Home",icon:S=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M10.8186 2.30492C10.5258 2.07721 10.3794 1.96335 10.2178 1.91959C10.0752 1.88097 9.92484 1.88097 9.78221 1.91959C9.62057 1.96335 9.47418 2.07721 9.18141 2.30492L3.52949 6.70086C3.15168 6.99471 2.96278 7.14163 2.82669 7.32563C2.70614 7.48862 2.61633 7.67224 2.56169 7.86746C2.5 8.08785 2.5 8.32717 2.5 8.8058V14.8349C2.5 15.7683 2.5 16.235 2.68166 16.5916C2.84144 16.9052 3.09641 17.1601 3.41002 17.3199C3.76654 17.5016 4.23325 17.5016 5.16667 17.5016H6.83333C7.06669 17.5016 7.18337 17.5016 7.2725 17.4562C7.3509 17.4162 7.41464 17.3525 7.45459 17.2741C7.5 17.1849 7.5 17.0683 7.5 16.8349V11.3349C7.5 10.8682 7.5 10.6348 7.59083 10.4566C7.67072 10.2998 7.79821 10.1723 7.95501 10.0924C8.13327 10.0016 8.36662 10.0016 8.83333 10.0016H11.1667C11.6334 10.0016 11.8667 10.0016 12.045 10.0924C12.2018 10.1723 12.3293 10.2998 12.4092 10.4566C12.5 10.6348 12.5 10.8682 12.5 11.3349V16.8349C12.5 17.0683 12.5 17.1849 12.5454 17.2741C12.5854 17.3525 12.6491 17.4162 12.7275 17.4562C12.8166 17.5016 12.9333 17.5016 13.1667 17.5016H14.8333C15.7668 17.5016 16.2335 17.5016 16.59 17.3199C16.9036 17.1601 17.1586 16.9052 17.3183 16.5916C17.5 16.235 17.5 15.7683 17.5 14.8349V8.8058C17.5 8.32717 17.5 8.08785 17.4383 7.86746C17.3837 7.67224 17.2939 7.48862 17.1733 7.32563C17.0372 7.14163 16.8483 6.99471 16.4705 6.70086L10.8186 2.30492Z",stroke:S?"#0073EA":"#676879",strokeWidth:"1.36364",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:S=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:S?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:S=>v.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_11004_6928)",children:v.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:S?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_11004_6928",children:v.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:S=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:S?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:S=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M16.6693 17.5C16.6693 16.337 16.6693 15.7556 16.5258 15.2824C16.2026 14.2171 15.3689 13.3833 14.3035 13.0602C13.8304 12.9167 13.2489 12.9167 12.0859 12.9167H7.91927C6.7563 12.9167 6.17481 12.9167 5.70165 13.0602C4.63631 13.3833 3.80264 14.2171 3.47947 15.2824C3.33594 15.7556 3.33594 16.337 3.33594 17.5M13.7526 6.25C13.7526 8.32107 12.0737 10 10.0026 10C7.93154 10 6.2526 8.32107 6.2526 6.25C6.2526 4.17893 7.93154 2.5 10.0026 2.5C12.0737 2.5 13.7526 4.17893 13.7526 6.25Z",stroke:S?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}],C=[{device:"Chrome on Windows",ipAddress:"192.168.1.105",logInTime:"2025-08-24 @ 5:45 PM",lastActivity:"Just Now",status:"This Device",isCurrentDevice:!0},{device:"Chrome on Android",ipAddress:"192.168.1.87",logInTime:"2025-08-21 @ 9:12 AM",lastActivity:"15 Hours Ago",status:"Active",isCurrentDevice:!1},{device:"Firefox on MacOS",ipAddress:"10.0.0.42",logInTime:"2025-08-19 @ 11:30 PM",lastActivity:"1 Day Ago",status:"Active",isCurrentDevice:!1},{device:"Safari on iPhone",ipAddress:"192.168.1.92",logInTime:"2025-08-15 @ 2:05 PM",lastActivity:"3 Days Ago",status:"Active",isCurrentDevice:!1}];return v.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[v.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[v.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:v.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),v.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[v.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:b.map(S=>{const k=e===S.id;return v.jsxs("button",{onClick:()=>{t(S.id),S.onClick?.()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${k?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[k&&v.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),S.icon(k),v.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${k?"text-[#172B4D]":"text-[#505258]"}`,children:S.label})]},S.id)})}),v.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[v.jsx("div",{className:"flex w-full h-14 flex-col items-start border-b border-[#DEDEDD]",children:v.jsx("div",{className:"flex h-14 flex-col items-start self-stretch",children:v.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:v.jsx("div",{className:"flex items-start gap-2",children:v.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Profile"})})})})}),v.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch p-4",children:[v.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch rounded border border-[#DEDEDD]",children:[v.jsx("div",{className:"flex px-4 py-3 items-center gap-2.5 self-stretch",children:v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-6",children:"User Information"})}),v.jsx("div",{className:"w-full h-px bg-[#DEDEDD]"}),v.jsx("div",{className:"flex px-4 py-3 items-start gap-2.5 self-stretch",children:v.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Fetched from Lorem Ipsum"})}),v.jsx("div",{className:"w-full h-px bg-[#DEDEDD]"}),v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 px-4 py-3 w-full",children:[v.jsxs("div",{className:"flex flex-col gap-1",children:[v.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-bold leading-5",children:"Full Name"}),v.jsx("div",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Opinder Singh"})]}),v.jsxs("div",{className:"flex flex-col gap-1",children:[v.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-bold leading-5",children:"Employee ID"}),v.jsx("div",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"EMP-2345"})]}),v.jsxs("div",{className:"flex flex-col gap-1",children:[v.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-bold leading-5",children:"Email Address"}),v.jsx("div",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Opinder.singh@company.com"})]}),v.jsxs("div",{className:"flex flex-col gap-1",children:[v.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-bold leading-5",children:"Department / Role"}),v.jsx("div",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Information Technology - Senior Software Engineer"})]})]})]}),v.jsx("div",{className:"flex h-16 flex-col justify-center items-start gap-2 self-stretch rounded border border-[#DEDEDD]",children:v.jsxs("div",{className:"flex px-4 py-3 justify-between items-center self-stretch",children:[v.jsxs("div",{className:"flex flex-col items-start gap-1",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-6",children:"Change Password"}),v.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Update your password to keep your account secure"})]}),v.jsx("button",{onClick:()=>o(!0),className:"flex h-8 px-3 py-2 justify-center items-center gap-2 rounded bg-[#0073EA]",children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-4",children:"Change Password"})})]})}),v.jsx("div",{className:"flex h-16 flex-col justify-center items-start gap-2 self-stretch rounded border border-[#DEDEDD]",children:v.jsxs("div",{className:"flex px-4 py-3 justify-between items-center self-stretch",children:[v.jsxs("div",{className:"flex flex-col items-start gap-1",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-6",children:"MFA Configuration"}),v.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Multi-factor authentication adds an extra layer of security to your account"})]}),v.jsx("button",{className:"flex h-8 px-3 py-2 justify-center items-center gap-2 rounded bg-[#0073EA]",children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-4",children:"Enable MFA"})})]})}),v.jsxs("div",{className:"flex flex-col justify-center items-start gap-2 self-stretch rounded border border-[#DEDEDD]",children:[v.jsxs("div",{className:"flex px-4 py-3 items-start gap-2.5 self-stretch",children:[v.jsxs("div",{className:"flex flex-col items-start gap-1 flex-1",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-6",children:"Session & Security"}),v.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Multi-factor authentication adds an extra layer of security to your account"})]}),v.jsxs("button",{className:"flex h-8 px-3 py-2 justify-center items-center gap-2 rounded",children:[v.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M10.6693 7.33464L13.3359 7.33464M13.3359 7.33464L16.0026 7.33464M13.3359 7.33464L13.3359 4.66797M13.3359 7.33464L13.3359 10.0013M5.33594 14.668L5.33594 13.3346C5.33594 12.5992 5.33594 12.2315 5.21046 11.9499C5.09888 11.7016 4.92011 11.4896 4.69464 11.3366C4.43905 11.1634 4.10225 11.1086 3.42865 11.0013C2.31094 10.8301 1.33594 9.8551 1.33594 8.66797C1.33594 7.38126 2.38294 6.33464 3.66927 6.33464C5.18927 6.33464 5.33594 5.46797 5.33594 4.66797L5.33594 1.33464M5.33594 1.33464L2.66927 1.33464M5.33594 1.33464L8.0026 1.33464",stroke:"#0073EA",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-[#0073EA] font-roboto text-[13px] font-medium leading-4",children:"Refresh"})]})]}),v.jsx("div",{className:"w-full h-px bg-[#DEDEDD]"}),v.jsx("div",{className:"flex px-4 py-2 items-start gap-2.5 self-stretch",children:v.jsx("h3",{className:"text-[#172B4D] font-roboto text-sm font-semibold leading-5",children:"Active Sessions"})}),v.jsx("div",{className:"flex px-4 items-start gap-2.5 self-stretch",children:v.jsx("p",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:"Let users upload existing documents directly from their device."})}),v.jsx("div",{className:"overflow-x-auto w-full",children:v.jsxs("table",{className:"w-full",children:[v.jsx("thead",{className:"bg-[#F7F8F9]",children:v.jsxs("tr",{children:[v.jsx("th",{className:"px-4 py-2 text-left",children:v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-[#DEDEDD]"}),v.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"Device"})]})}),v.jsx("th",{className:"px-4 py-2 text-left",children:v.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"IP Address"})}),v.jsx("th",{className:"px-4 py-2 text-left",children:v.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"Log In Time"})}),v.jsx("th",{className:"px-4 py-2 text-left",children:v.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"Last Activity"})}),v.jsx("th",{className:"px-4 py-2 text-left",children:v.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"Status"})})]})}),v.jsx("tbody",{children:C.map((S,k)=>v.jsxs("tr",{className:"border-t border-[#DEDEDD]",children:[v.jsx("td",{className:"px-4 py-3",children:v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-[#DEDEDD]"}),v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:S.device})]})}),v.jsx("td",{className:"px-4 py-3",children:v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:S.ipAddress})}),v.jsx("td",{className:"px-4 py-3",children:v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:S.logInTime})}),v.jsx("td",{className:"px-4 py-3",children:v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:S.lastActivity})}),v.jsx("td",{className:"px-4 py-3",children:v.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full ${S.isCurrentDevice?"bg-[#E6F4EA] text-[#1E7E34]":"bg-[#E6F1FD] text-[#0073EA]"}`,children:[v.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${S.isCurrentDevice?"bg-[#1E7E34]":"bg-[#0073EA]"}`}),v.jsx("span",{className:"font-roboto text-xs font-medium leading-[18px]",children:S.status})]})})]},k))})]})}),v.jsx("div",{className:"flex px-4 py-3 items-start gap-2.5 self-stretch",children:v.jsx("button",{className:"flex h-8 px-3 py-2 justify-center items-center gap-2 rounded bg-[#D83A52]",children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-4",children:"Logout from All Sessions"})})})]})]})]})]}),v.jsx(XR,{open:r,onOpenChange:o,children:v.jsxs(E4,{className:"max-w-[420px] p-0 gap-0 rounded-lg overflow-hidden",children:[v.jsxs("div",{className:"flex h-[52px] px-5 py-2.5 justify-between items-center border-b border-[#D0D4E4] bg-white",children:[v.jsx(T4,{className:"text-[#172B4D] font-roboto text-lg font-bold leading-[26px]",children:"Change Password"}),v.jsx(rq,{className:"flex w-7 h-7 p-2 flex-col justify-center items-center rounded-full bg-white hover:bg-gray-100",children:v.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),v.jsx("div",{className:"flex px-5 py-5 flex-col items-start bg-white",children:v.jsxs("div",{className:"flex flex-col items-start self-stretch gap-0",children:[v.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[v.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("span",{className:"flex h-2.5 flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-normal",children:"Current Password"})}),v.jsxs("div",{className:"flex h-8 px-2.5 py-[15px] justify-between items-center self-stretch rounded border border-[#C3C6D4] bg-white",children:[v.jsx("input",{type:d?"text":"password",value:s,onChange:S=>i(S.target.value),placeholder:"Enter Password",className:"flex-1 text-[#676879] font-roboto text-xs font-normal leading-[22px] outline-none bg-transparent"}),v.jsx("button",{type:"button",onClick:()=>h(!d),className:"flex justify-end items-center",children:v.jsxs("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M1.61341 8.47807C1.52263 8.33427 1.47723 8.2624 1.45181 8.15154C1.43273 8.06827 1.43273 7.93694 1.45181 7.85367C1.47723 7.7428 1.52263 7.67094 1.61341 7.52714C2.36369 6.33916 4.59694 3.33594 8.00027 3.33594C11.4036 3.33594 13.6369 6.33916 14.3871 7.52714C14.4779 7.67094 14.5233 7.7428 14.5487 7.85367C14.5678 7.93694 14.5678 8.06827 14.5487 8.15154C14.5233 8.2624 14.4779 8.33427 14.3871 8.47807C13.6369 9.66607 11.4036 12.6693 8.00027 12.6693C4.59694 12.6693 2.36369 9.66607 1.61341 8.47807Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M8 10C9.1046 10 10 9.1046 10 8C10 6.8954 9.1046 6 8 6C6.8954 6 6 6.8954 6 8C6 9.1046 6.8954 10 8 10Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),v.jsx("div",{className:"flex h-6 items-start gap-2 self-stretch"})]}),v.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[v.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("span",{className:"flex h-2.5 flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-normal",children:"New Password"})}),v.jsxs("div",{className:"flex h-8 px-2.5 py-[15px] justify-between items-center self-stretch rounded border border-[#C3C6D4] bg-white",children:[v.jsx("input",{type:p?"text":"password",value:a,onChange:S=>l(S.target.value),placeholder:"Enter Password",className:"flex-1 text-[#676879] font-roboto text-xs font-normal leading-[22px] outline-none bg-transparent"}),v.jsx("button",{type:"button",onClick:()=>g(!p),className:"flex justify-end items-center",children:v.jsxs("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M1.61341 8.47807C1.52263 8.33427 1.47723 8.2624 1.45181 8.15154C1.43273 8.06827 1.43273 7.93694 1.45181 7.85367C1.47723 7.7428 1.52263 7.67094 1.61341 7.52714C2.36369 6.33916 4.59694 3.33594 8.00027 3.33594C11.4036 3.33594 13.6369 6.33916 14.3871 7.52714C14.4779 7.67094 14.5233 7.7428 14.5487 7.85367C14.5678 7.93694 14.5678 8.06827 14.5487 8.15154C14.5233 8.2624 14.4779 8.33427 14.3871 8.47807C13.6369 9.66607 11.4036 12.6693 8.00027 12.6693C4.59694 12.6693 2.36369 9.66607 1.61341 8.47807Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M8 10C9.1046 10 10 9.1046 10 8C10 6.8954 9.1046 6 8 6C6.8954 6 6 6.8954 6 8C6 9.1046 6.8954 10 8 10Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),v.jsx("div",{className:"flex h-6 items-start gap-2 self-stretch"})]}),v.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[v.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("span",{className:"flex h-2.5 flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-normal",children:"Confirm New Password"})}),v.jsxs("div",{className:"flex h-8 px-2.5 py-[15px] justify-between items-center self-stretch rounded border border-[#C3C6D4] bg-white",children:[v.jsx("input",{type:x?"text":"password",value:c,onChange:S=>u(S.target.value),placeholder:"Enter Password",className:"flex-1 text-[#676879] font-roboto text-xs font-normal leading-[22px] outline-none bg-transparent"}),v.jsx("button",{type:"button",onClick:()=>y(!x),className:"flex justify-end items-center",children:v.jsxs("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M1.61341 8.47807C1.52263 8.33427 1.47723 8.2624 1.45181 8.15154C1.43273 8.06827 1.43273 7.93694 1.45181 7.85367C1.47723 7.7428 1.52263 7.67094 1.61341 7.52714C2.36369 6.33916 4.59694 3.33594 8.00027 3.33594C11.4036 3.33594 13.6369 6.33916 14.3871 7.52714C14.4779 7.67094 14.5233 7.7428 14.5487 7.85367C14.5678 7.93694 14.5678 8.06827 14.5487 8.15154C14.5233 8.2624 14.4779 8.33427 14.3871 8.47807C13.6369 9.66607 11.4036 12.6693 8.00027 12.6693C4.59694 12.6693 2.36369 9.66607 1.61341 8.47807Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:"M8 10C9.1046 10 10 9.1046 10 8C10 6.8954 9.1046 6 8 6C6.8954 6 6 6.8954 6 8C6 9.1046 6.8954 10 8 10Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),v.jsx("div",{className:"flex h-6 items-start gap-2 self-stretch"})]})]})}),v.jsxs("div",{className:"flex h-[60px] px-5 justify-end items-center gap-2 border-t border-[#D0D4E4] bg-white",children:[v.jsx("button",{onClick:()=>{o(!1),i(""),l(""),u("")},className:"flex h-[38px] px-4 py-2.25 justify-center items-center gap-1 rounded bg-white",children:v.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-medium leading-normal",children:"Cancel"})}),v.jsx("button",{onClick:()=>{console.log("Update password logic here"),o(!1)},className:"flex h-[38px] px-4 py-2.25 justify-center items-center gap-0.5 rounded border border-[#0073EA] bg-[#0073EA]",children:v.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-normal",children:"Update Password"})})]})]})})]})}const Y0={minLength:8,uppercase:/[A-Z]/,number:/[0-9]/,specialChar:/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/};function dB(n){const e={minLength:n.length>=Y0.minLength,hasUppercase:Y0.uppercase.test(n),hasNumber:Y0.number.test(n),hasSpecialChar:Y0.specialChar.test(n)},t=Object.values(e).filter(Boolean).length;let r=0,o="Weak",s="bg-red-500";return t===0?(r=0,o="Weak",s="bg-red-500"):t===1?(r=1,o="Weak",s="bg-red-500"):t===2?(r=2,o="Fair",s="bg-yellow-500"):t===3?(r=3,o="Good",s="bg-blue-500"):(r=4,o="Strong",s="bg-green-500"),{score:r,label:o,color:s,requirements:e}}function F8e(n){const e=dB(n);return e.requirements.minLength&&e.requirements.hasUppercase&&e.requirements.hasNumber&&e.requirements.hasSpecialChar}function P8e(n,e){return n===e&&n.length>0}function M8e({strength:n,onDismiss:e}){return v.jsxs("div",{className:"flex flex-col items-start gap-2 p-2 rounded bg-[#F6F7FB] cursor-pointer transition-opacity hover:opacity-90",onClick:e,role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e?.())},"aria-label":"Password requirements (click to dismiss)",children:[v.jsx("p",{className:"text-xs font-medium text-[#323238] leading-normal",children:"Password must contain:"}),v.jsxs("div",{className:"flex flex-col items-start gap-1",children:[v.jsxs("div",{className:"flex items-center gap-1",children:[n.requirements.minLength?v.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M5.5 10L8.5 13L14.5 7",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}):v.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M14.1693 5.83594L5.83594 14.1693M5.83594 5.83594L14.1693 14.1693",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-xs font-normal leading-5 text-[#676879]",children:"At least 8 characters"})]}),v.jsxs("div",{className:"flex items-center gap-1",children:[n.requirements.hasUppercase?v.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M5.5 10L8.5 13L14.5 7",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}):v.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M14.1693 5.83594L5.83594 14.1693M5.83594 5.83594L14.1693 14.1693",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-xs font-normal leading-5 text-[#676879]",children:"One uppercase letter"})]}),v.jsxs("div",{className:"flex items-center gap-1",children:[n.requirements.hasNumber?v.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M5.5 10L8.5 13L14.5 7",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}):v.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M14.1693 5.83594L5.83594 14.1693M5.83594 5.83594L14.1693 14.1693",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-xs font-normal leading-5 text-[#676879]",children:"One number"})]}),v.jsxs("div",{className:"flex items-center gap-1",children:[n.requirements.hasSpecialChar?v.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M5.5 10L8.5 13L14.5 7",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}):v.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M14.1693 5.83594L5.83594 14.1693M5.83594 5.83594L14.1693 14.1693",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("span",{className:"text-xs font-normal leading-5 text-[#676879]",children:"One special character"})]})]})]})}function O8e(){const n=ci(),{toast:e}=Nm(),[t,r]=F.useState(""),[o,s]=F.useState(""),[i,a]=F.useState(!1),[l,c]=F.useState(!1),[u,d]=F.useState(!1),[h,p]=F.useState(!0),g=dB(t),x=F8e(t),y=P8e(t,o),b=x&&y&&!i,C=async S=>{if(S.preventDefault(),!x){e({title:"Weak Password",description:"Password does not meet security requirements.",variant:"destructive"});return}if(!y){e({title:"Password Mismatch",description:"Passwords do not match.",variant:"destructive"});return}a(!0);try{await new Promise(k=>setTimeout(k,1500)),e({title:"Success",description:"Your password has been set successfully.",duration:3e3}),setTimeout(()=>{n("/dashboard")},1e3)}catch(k){console.error("Password setup error:",k),e({title:"Error",description:"Failed to set password. Please try again.",variant:"destructive"})}finally{a(!1)}};return v.jsxs("div",{className:"w-full h-screen bg-white flex overflow-hidden",children:[v.jsxs("div",{className:"hidden lg:flex lg:w-[607px] flex-col relative bg-white overflow-hidden flex-shrink-0 h-full",children:[v.jsxs("div",{className:"absolute inset-0",children:[v.jsxs("svg",{className:"absolute left-[190px] top-[214px] w-[279px] h-[123px] opacity-80",width:"404",height:"236",viewBox:"0 0 404 236",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsxs("g",{opacity:"0.8",children:[v.jsx("g",{filter:"url(#filter0_f_blob1)",children:v.jsx("ellipse",{cx:"250.058",cy:"117.553",rx:"85.3719",ry:"45.8769",transform:"rotate(-12.3921 250.058 117.553)",fill:"#F8E4E8",fillOpacity:"0.5"})}),v.jsx("g",{filter:"url(#filter1_f_blob1)",children:v.jsx("ellipse",{cx:"142.087",cy:"112.195",rx:"88.956",ry:"49.0935",transform:"rotate(-12.3921 142.087 112.195)",fill:"#E0EFFE",fillOpacity:"0.5"})})]}),v.jsxs("defs",{children:[v.jsxs("filter",{id:"filter0_f_blob1",x:"96.9561",y:"0",width:"306.205",height:"235.107",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[v.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),v.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),v.jsx("feGaussianBlur",{stdDeviation:"34.5659",result:"effect1_foregroundBlur_blob1"})]}),v.jsxs("filter",{id:"filter1_f_blob1",x:"0.000492096",y:"6.01343",width:"284.173",height:"212.364",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[v.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),v.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),v.jsx("feGaussianBlur",{stdDeviation:"27.2791",result:"effect1_foregroundBlur_blob1"})]})]})]}),v.jsxs("div",{className:"absolute left-[-96px] top-0 w-[677px] h-[643px]",children:[v.jsxs("svg",{className:"absolute left-[335px] top-[301px] w-[342px] h-[342px]",width:"802",height:"697",viewBox:"0 0 802 697",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{filter:"url(#filter0_f_blob2)",children:v.jsx("circle",{cx:"401",cy:"401",r:"171",fill:"#BCD2E8"})}),v.jsx("defs",{children:v.jsxs("filter",{id:"filter0_f_blob2",x:"0",y:"0",width:"802",height:"802",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[v.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),v.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),v.jsx("feGaussianBlur",{stdDeviation:"115",result:"effect1_foregroundBlur_blob2"})]})})]}),v.jsxs("svg",{className:"absolute left-0 top-0 w-[465px] h-[397px]",width:"529",height:"557",viewBox:"0 0 529 557",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{filter:"url(#filter0_f_blob3)",children:v.jsx("ellipse",{cx:"136.5",cy:"198.5",rx:"232.5",ry:"198.5",fill:"#E0EFFE"})}),v.jsx("defs",{children:v.jsxs("filter",{id:"filter0_f_blob3",x:"-256",y:"-160",width:"785",height:"717",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[v.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),v.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),v.jsx("feGaussianBlur",{stdDeviation:"80",result:"effect1_foregroundBlur_blob3"})]})})]})]})]}),v.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:v.jsxs("div",{className:"relative w-[252px] h-[318px]",children:[v.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-gradient-to-br from-[#E0EFFE] via-[#F3CFFF] to-[#F3CFFF]",style:{transform:"rotate(6.554deg)"}}),v.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-white backdrop-blur-[7.5px]"}),v.jsx("svg",{className:"absolute right-[-36px] top-4 w-6 h-6",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L8.20711 11.2929C7.81658 10.9024 7.18342 10.9024 6.79289 11.2929C6.40237 11.6834 6.40237 12.3166 6.79289 12.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z",fill:"#258750"})}),v.jsx("div",{className:"absolute left-8 top-14 w-[185px] h-[130px] rounded-2xl bg-[#E0EFFE]"})]})}),v.jsx("div",{className:"absolute bottom-[130px] left-1/2 -translate-x-1/2 w-[461px]",children:v.jsxs("div",{className:"flex flex-col items-center gap-6",children:[v.jsx("h2",{className:"text-[#323238] text-center font-roboto text-[32px] font-bold leading-[120%]",children:"Secure your account."}),v.jsx("p",{className:"text-[#676879] text-center font-roboto text-[13px] font-medium leading-[20px]",children:"Create a strong password to protect your verified identity."})]})})]}),v.jsxs("div",{className:"flex-1 flex flex-col bg-white",children:[v.jsx("div",{className:"flex items-center justify-center h-14 gap-[33.246px] pt-[84px] pb-6",children:v.jsxs("svg",{className:"w-[124px] h-[25.176px]",width:"126",height:"27",viewBox:"0 0 126 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M37.0043 10.1061C38.6231 8.32663 40.5827 7.43677 42.8831 7.43677C44.0759 7.43677 45.1729 7.73702 46.1739 8.33728C47.175 8.93766 47.9418 9.70947 48.4743 10.6528L48.7618 7.72625H52.8515V25.4143H48.7618L48.4743 22.4556C47.9418 23.3989 47.175 24.1708 46.1739 24.771C45.1729 25.3714 44.0759 25.6715 42.8831 25.6715C40.5827 25.6715 38.6231 24.7818 37.0043 23.0022C35.3855 21.2013 34.5762 19.0465 34.5762 16.5381C34.5762 14.0296 35.3855 11.8856 37.0043 10.1061ZM40.4548 19.8185C41.3495 20.7403 42.4358 21.2013 43.7138 21.2013C45.0131 21.2013 46.1101 20.7511 47.0045 19.8505C47.8992 18.9286 48.3465 17.8245 48.3465 16.5381C48.3465 15.2518 47.8992 14.1583 47.0045 13.2577C46.1101 12.3358 45.0131 11.8749 43.7138 11.8749C42.4358 11.8749 41.3495 12.3358 40.4548 13.2577C39.5603 14.1583 39.113 15.2518 39.113 16.5381C39.113 17.8245 39.5603 18.918 40.4548 19.8185ZM56.593 7.72625H60.6826L61.0021 10.2669C62.0458 8.48741 63.7818 7.59767 66.2099 7.59767C66.8277 7.59767 67.3601 7.64053 67.8074 7.72625L66.8808 12.0679C66.6252 12.025 66.4442 12.0035 66.3378 12.0035C64.8467 12.0035 63.6007 12.4645 62.5996 13.3865C61.5985 14.2868 61.098 15.8198 61.098 17.9852V25.4143H56.593V7.72625ZM72.1419 10.1383C73.8884 8.35871 76.0078 7.46897 78.4999 7.46897C79.9908 7.46897 81.386 7.82274 82.6853 8.53026C83.9846 9.21636 85.0603 10.1489 85.9122 11.3282L82.2061 13.8045C81.2902 12.6467 80.0548 12.0679 78.4999 12.0679C77.2645 12.0679 76.2101 12.5074 75.3368 13.3865C74.4636 14.2654 74.0269 15.3267 74.0269 16.5703C74.0269 17.8352 74.4636 18.9072 75.3368 19.7863C76.2101 20.6653 77.2645 21.1048 78.4999 21.1048C80.14 21.1048 81.3966 20.4616 82.27 19.1752L86.008 21.6836C85.1774 22.9058 84.1018 23.8813 82.7811 24.6102C81.4606 25.3392 80.0335 25.7037 78.4999 25.7037C76.0078 25.7037 73.8778 24.8139 72.1099 23.0344C70.3633 21.2335 69.49 19.0787 69.49 16.5703C69.49 14.0618 70.374 11.9178 72.1419 10.1383ZM90.5504 10.1383C92.2971 8.35871 94.4163 7.46897 96.9085 7.46897C99.4005 7.46897 101.531 8.36948 103.298 10.1704C105.088 11.95 105.982 14.0832 105.982 16.5703C105.982 19.0787 105.098 21.2227 103.33 23.0022C101.541 24.8032 99.4005 25.7037 96.9085 25.7037C94.4163 25.7037 92.2864 24.8139 90.5185 23.0344C88.7718 21.2335 87.8986 19.0787 87.8986 16.5703C87.8986 14.0618 88.7826 11.9178 90.5504 10.1383ZM92.4355 16.5703C92.4355 17.8352 92.8721 18.9072 93.7454 19.7863C94.6188 20.6653 95.673 21.1048 96.9085 21.1048C98.1652 21.1048 99.2301 20.6653 100.103 19.7863C100.977 18.9072 101.413 17.8352 101.413 16.5703C101.413 15.3267 100.977 14.2654 100.103 13.3865C99.2301 12.5074 98.1652 12.0679 96.9085 12.0679C95.673 12.0679 94.6188 12.5074 93.7454 13.3865C92.8721 14.2654 92.4355 15.3267 92.4355 16.5703ZM108.855 25.4143V7.72625H112.944L113.232 10.2991C113.743 9.44142 114.414 8.75533 115.245 8.24079C116.097 7.70482 117.055 7.43677 118.12 7.43677C120.25 7.43677 121.933 8.1765 123.168 9.65584C124.425 11.1352 125.053 13.3757 125.053 16.3773V25.4143H120.58V16.3773C120.58 14.898 120.229 13.7831 119.526 13.0327C118.844 12.2609 117.992 11.8749 116.97 11.8749C115.926 11.8749 115.064 12.2609 114.382 13.0327C113.7 13.7831 113.36 14.898 113.36 16.3773V25.4143H108.855Z",fill:"#323238"}),v.jsx("path",{d:"M26.425 21.7199C27.0492 22.8369 26.2417 24.213 24.9622 24.213H3.93975C2.65324 24.213 1.84661 22.8233 2.48474 21.7062L13.1115 3.10326C13.7582 1.97113 15.3932 1.97882 16.0293 3.11699L26.425 21.7199Z",stroke:"#D83A52",strokeWidth:"4.5177"})]})}),v.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center px-4 py-8",children:v.jsx("div",{className:"w-full max-w-[360px]",children:v.jsxs("form",{onSubmit:C,className:"flex flex-col gap-6",children:[v.jsxs("div",{className:"flex flex-col justify-center items-center gap-0",children:[v.jsx("h1",{className:"text-[#172B4D] text-center font-roboto text-[28px] font-extrabold leading-[42px]",children:"Set Your Password"}),v.jsx("p",{className:"text-[#676879] text-center font-roboto text-[14px] font-normal leading-[22px]",children:"Create a strong password to secure your account"})]}),v.jsxs("div",{className:"flex flex-col gap-2",children:[v.jsx("label",{htmlFor:"password",className:"text-[#323238] font-roboto text-[13px] font-medium leading-normal",children:"New Password"}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{id:"password",type:l?"text":"password",value:t,onChange:S=>{r(S.target.value),p(!0)},className:"w-full h-[54px] px-3 py-[15px] border border-[#C3C6D4] rounded bg-white text-[#323238] font-roboto text-base leading-5 placeholder:text-[#676879] focus:outline-none focus:ring-2 focus:ring-[#0073EA] focus:border-transparent",placeholder:"Enter a strong password",disabled:i}),v.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",disabled:i,children:l?v.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-4.803m5.596-3.856a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0m7.6 0a10.05 10.05 0 011.563 4.803m-5.596 3.856a4.872 4.872 0 005.049-7.52M3 12a9 9 0 1118 0 9 9 0 01-18 0z"})}):v.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),t&&h&&v.jsx(M8e,{strength:g,onDismiss:()=>p(!1)}),v.jsxs("div",{className:"flex flex-col gap-2",children:[v.jsx("label",{htmlFor:"confirmPassword",className:"text-[#323238] font-roboto text-[13px] font-medium leading-normal",children:"Confirm Password"}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{id:"confirmPassword",type:u?"text":"password",value:o,onChange:S=>s(S.target.value),className:`w-full h-[54px] px-3 py-[15px] border rounded bg-white text-[#323238] font-roboto text-base leading-5 placeholder:text-[#676879] focus:outline-none focus:ring-2 focus:border-transparent ${o&&!y?"border-red-300 focus:ring-red-500":"border-[#C3C6D4] focus:ring-[#0073EA]"}`,placeholder:"Confirm your password",disabled:i}),v.jsx("button",{type:"button",onClick:()=>d(!u),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",disabled:i,children:u?v.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-4.803m5.596-3.856a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0m7.6 0a10.05 10.05 0 011.563 4.803m-5.596 3.856a4.872 4.872 0 005.049-7.52M3 12a9 9 0 1118 0 9 9 0 01-18 0z"})}):v.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),o&&!y&&v.jsx("p",{className:"text-sm text-red-600",children:"Passwords do not match."})]}),v.jsx("button",{type:"submit",disabled:!b,className:`w-full h-12 px-4 py-[11px] rounded bg-[#0073EA] flex items-center justify-center gap-2 transition-colors ${b?"hover:bg-[#0062c7] cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:v.jsx("span",{className:"text-white font-roboto text-base font-bold leading-normal",children:i?v.jsxs("span",{className:"flex items-center gap-2",children:[v.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[v.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),v.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Setting Password..."]}):"Set Password"})})]})})})]})]})}const L8e=[{id:"1",title:"Employment Verification",documentType:"Employee ID Card",progress:0,expiryDate:"Oct 10, 2025",status:"not-started"},{id:"2",title:"Employment Verification",documentType:"Employee ID Card",progress:0,expiryDate:"Oct 10, 2025",status:"not-started"}],B8e=[{id:"3",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Oct 10, 2025",status:"in-progress"},{id:"4",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Oct 9, 2025",status:"in-progress"},{id:"5",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Oct 2, 2025",status:"in-progress"},{id:"6",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Sept 28, 2025",status:"in-progress"},{id:"7",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Sept 20, 2025",status:"in-progress"},{id:"8",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Sept 10, 2025",status:"in-progress"}];function j8e(){const n=ci(),[e,t]=F.useState("home"),r=[{id:"home",label:"Home",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56194 1.11261C9.84719 1.03538 10.1479 1.03538 10.4331 1.11261C10.7642 1.20227 11.043 1.42115 11.2655 1.59584C13.185 3.10283 15.1164 4.59457 17.0444 6.09074C17.3583 6.33431 17.6348 6.5489 17.8408 6.82749C18.0216 7.07197 18.1564 7.3474 18.2383 7.64023C18.3317 7.97391 18.3314 8.32392 18.3309 8.72123C18.3288 10.769 18.3309 12.8167 18.3309 14.8645C18.3309 15.3037 18.3309 15.6826 18.3054 15.9948C18.2784 16.3243 18.219 16.652 18.0584 16.9673C17.8187 17.4376 17.4362 17.8201 16.9659 18.0598C16.6505 18.2205 16.3229 18.2799 15.9934 18.3068C15.3254 18.3614 14.6479 18.332 13.9782 18.3323C13.8789 18.3323 13.7604 18.3324 13.656 18.3239C13.5349 18.314 13.3616 18.2886 13.18 18.1961C12.9449 18.0762 12.7536 17.885 12.6338 17.6498C12.5412 17.4681 12.5159 17.2948 12.5059 17.1738C12.4974 17.0694 12.4974 16.9508 12.4975 16.8516L12.5041 12.1881C12.5048 11.7207 12.505 11.4871 12.4144 11.3086C12.3345 11.1516 12.207 11.0238 12.0501 10.9438C11.8717 10.8528 11.638 10.8528 11.1708 10.8528H8.83752C8.37144 10.8528 8.13836 10.8528 7.96023 10.9435C7.80354 11.0232 7.67609 11.1505 7.59611 11.3071C7.50519 11.4851 7.50485 11.7181 7.50419 12.1842L7.49751 16.8516C7.49755 16.9508 7.4976 17.0694 7.48906 17.1738C7.47918 17.2948 7.45381 17.4681 7.36127 17.6498C7.24143 17.885 7.0502 18.0762 6.815 18.1961C6.63338 18.2886 6.46005 18.314 6.33904 18.3239C6.2346 18.3324 6.11606 18.3323 6.0168 18.3323C5.34706 18.332 4.66959 18.3614 4.00165 18.3068C3.6722 18.2799 3.34452 18.2205 3.0292 18.0598C2.5588 17.8201 2.17635 17.4376 1.93666 16.9673C1.776 16.652 1.71657 16.3243 1.68965 15.9948C1.66415 15.6826 1.66416 15.3037 1.66418 14.8644C1.66418 12.8166 1.66633 10.7689 1.66412 8.72123C1.66369 8.32392 1.66331 7.97391 1.75671 7.64023C1.83868 7.3474 1.97339 7.07197 2.15421 6.82749C2.36026 6.5489 2.63677 6.33431 2.95063 6.09075C4.87849 4.59464 6.8101 3.1028 8.72952 1.59584C8.95202 1.42115 9.23077 1.20227 9.56194 1.11261Z",fill:o?"#0073EA":"#676879"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:o=>v.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_11001_25789)",children:v.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_11001_25789",children:v.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M16.6693 17.5C16.6693 16.337 16.6693 15.7556 16.5258 15.2824C16.2026 14.2171 15.3689 13.3833 14.3035 13.0602C13.8304 12.9167 13.2489 12.9167 12.0859 12.9167H7.91927C6.7563 12.9167 6.17481 12.9167 5.70165 13.0602C4.63631 13.3833 3.80264 14.2171 3.47947 15.2824C3.33594 15.7556 3.33594 16.337 3.33594 17.5M13.7526 6.25C13.7526 8.32107 12.0737 10 10.0026 10C7.93154 10 6.2526 8.32107 6.2526 6.25C6.2526 4.17893 7.93154 2.5 10.0026 2.5C12.0737 2.5 13.7526 4.17893 13.7526 6.25Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}];return v.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[v.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[v.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:v.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),v.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[v.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:r.map(o=>{const s=e===o.id;return v.jsxs("button",{onClick:()=>{t(o.id),o.onClick()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${s?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[s&&v.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),o.icon(s),v.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${s?"text-[#172B4D]":"text-[#505258]"}`,children:o.label})]},o.id)})}),v.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[v.jsx("div",{className:"flex h-14 flex-col items-start self-stretch",children:v.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:v.jsx("div",{className:"flex items-start gap-2",children:v.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Ongoing Verifications"})})})}),v.jsxs("div",{className:"flex px-4 flex-col items-start gap-2.5 flex-1 self-stretch",children:[v.jsxs("div",{className:"flex flex-col items-start gap-2.5 self-stretch",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Not yet started"}),v.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 self-stretch",children:L8e.map(o=>v.jsx("div",{className:"w-full",children:v.jsx(s4,{title:o.title,documentType:o.documentType,progress:o.progress,expiryDate:o.expiryDate,status:o.status})},o.id))})]}),v.jsxs("div",{className:"flex flex-col items-start gap-2.5 self-stretch",children:[v.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"In Progress"}),v.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 self-stretch",children:B8e.map(o=>v.jsx("div",{className:"w-full",children:v.jsx(s4,{title:o.title,documentType:o.documentType,progress:o.progress,expiryDate:o.expiryDate,status:o.status})},o.id))})]})]})]})]})]})}const V8e=[{id:"1",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"2",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"3",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"4",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"5",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"}];function z8e(){const n=ci(),[e,t]=F.useState("expired"),r=[{id:"home",label:"Home",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56194 1.11261C9.84719 1.03538 10.1479 1.03538 10.4331 1.11261C10.7642 1.20227 11.043 1.42115 11.2655 1.59584C13.185 3.10283 15.1164 4.59457 17.0444 6.09074C17.3583 6.33431 17.6348 6.5489 17.8408 6.82749C18.0216 7.07197 18.1564 7.3474 18.2383 7.64023C18.3317 7.97391 18.3314 8.32392 18.3309 8.72123C18.3288 10.769 18.3309 12.8167 18.3309 14.8645C18.3309 15.3037 18.3309 15.6826 18.3054 15.9948C18.2784 16.3243 18.219 16.652 18.0584 16.9673C17.8187 17.4376 17.4362 17.8201 16.9659 18.0598C16.6505 18.2205 16.3229 18.2799 15.9934 18.3068C15.3254 18.3614 14.6479 18.332 13.9782 18.3323C13.8789 18.3323 13.7604 18.3324 13.656 18.3239C13.5349 18.314 13.3616 18.2886 13.18 18.1961C12.9449 18.0762 12.7536 17.885 12.6338 17.6498C12.5412 17.4681 12.5159 17.2948 12.5059 17.1738C12.4974 17.0694 12.4974 16.9508 12.4975 16.8516L12.5041 12.1881C12.5048 11.7207 12.505 11.4871 12.4144 11.3086C12.3345 11.1516 12.207 11.0238 12.0501 10.9438C11.8717 10.8528 11.638 10.8528 11.1708 10.8528H8.83752C8.37144 10.8528 8.13836 10.8528 7.96023 10.9435C7.80354 11.0232 7.67609 11.1505 7.59611 11.3071C7.50519 11.4851 7.50485 11.7181 7.50419 12.1842L7.49751 16.8516C7.49755 16.9508 7.4976 17.0694 7.48906 17.1738C7.47918 17.2948 7.45381 17.4681 7.36127 17.6498C7.24143 17.885 7.0502 18.0762 6.815 18.1961C6.63338 18.2886 6.46005 18.314 6.33904 18.3239C6.2346 18.3324 6.11606 18.3323 6.0168 18.3323C5.34706 18.332 4.66959 18.3614 4.00165 18.3068C3.6722 18.2799 3.34452 18.2205 3.0292 18.0598C2.5588 17.8201 2.17635 17.4376 1.93666 16.9673C1.776 16.652 1.71657 16.3243 1.68965 15.9948C1.66415 15.6826 1.66416 15.3037 1.66418 14.8644C1.66418 12.8166 1.66633 10.7689 1.66412 8.72123C1.66369 8.32392 1.66331 7.97391 1.75671 7.64023C1.83868 7.3474 1.97339 7.07197 2.15421 6.82749C2.36026 6.5489 2.63677 6.33431 2.95063 6.09075C4.87849 4.59464 6.8101 3.1028 8.72952 1.59584C8.95202 1.42115 9.23077 1.20227 9.56194 1.11261Z",fill:o?"#0073EA":"#676879"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:o=>v.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_11001_26397)",children:v.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_11001_26397",children:v.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M16.6693 17.5C16.6693 16.337 16.6693 15.7556 16.5258 15.2824C16.2026 14.2171 15.3689 13.3833 14.3035 13.0602C13.8304 12.9167 13.2489 12.9167 12.0859 12.9167H7.91927C6.7563 12.9167 6.17481 12.9167 5.70165 13.0602C4.63631 13.3833 3.80264 14.2171 3.47947 15.2824C3.33594 15.7556 3.33594 16.337 3.33594 17.5M13.7526 6.25C13.7526 8.32107 12.0737 10 10.0026 10C7.93154 10 6.2526 8.32107 6.2526 6.25C6.2526 4.17893 7.93154 2.5 10.0026 2.5C12.0737 2.5 13.7526 4.17893 13.7526 6.25Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}];return v.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[v.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[v.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:v.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),v.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[v.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:r.map(o=>{const s=e===o.id;return v.jsxs("button",{onClick:()=>{t(o.id),o.onClick()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${s?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[s&&v.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),o.icon(s),v.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${s?"text-[#172B4D]":"text-[#505258]"}`,children:o.label})]},o.id)})}),v.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[v.jsx("div",{className:"flex h-14 flex-col items-start self-stretch",children:v.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:v.jsx("div",{className:"flex items-start gap-2",children:v.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Expired Verification"})})})}),v.jsx("div",{className:"flex px-4 flex-col items-start gap-2.5 flex-1 self-stretch",children:v.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 self-stretch",children:V8e.map(o=>v.jsx("div",{className:"w-full",children:v.jsx(cB,{title:o.title,documentType:o.documentType,expiredDate:o.expiredDate,issuedOn:o.issuedOn})},o.id))})})]})]})]})}const W8e=[{id:"1",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"2",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"3",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"4",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"5",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"6",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"7",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"}];function U8e(){const n=ci(),[e,t]=F.useState("verified"),r=[{id:"home",label:"Home",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56194 1.11261C9.84719 1.03538 10.1479 1.03538 10.4331 1.11261C10.7642 1.20227 11.043 1.42115 11.2655 1.59584C13.185 3.10283 15.1164 4.59457 17.0444 6.09074C17.3583 6.33431 17.6348 6.5489 17.8408 6.82749C18.0216 7.07197 18.1564 7.3474 18.2383 7.64023C18.3317 7.97391 18.3314 8.32392 18.3309 8.72123C18.3288 10.769 18.3309 12.8167 18.3309 14.8645C18.3309 15.3037 18.3309 15.6826 18.3054 15.9948C18.2784 16.3243 18.219 16.652 18.0584 16.9673C17.8187 17.4376 17.4362 17.8201 16.9659 18.0598C16.6505 18.2205 16.3229 18.2799 15.9934 18.3068C15.3254 18.3614 14.6479 18.332 13.9782 18.3323C13.8789 18.3323 13.7604 18.3324 13.656 18.3239C13.5349 18.314 13.3616 18.2886 13.18 18.1961C12.9449 18.0762 12.7536 17.885 12.6338 17.6498C12.5412 17.4681 12.5159 17.2948 12.5059 17.1738C12.4974 17.0694 12.4974 16.9508 12.4975 16.8516L12.5041 12.1881C12.5048 11.7207 12.505 11.4871 12.4144 11.3086C12.3345 11.1516 12.207 11.0238 12.0501 10.9438C11.8717 10.8528 11.638 10.8528 11.1708 10.8528H8.83752C8.37144 10.8528 8.13836 10.8528 7.96023 10.9435C7.80354 11.0232 7.67609 11.1505 7.59611 11.3071C7.50519 11.4851 7.50485 11.7181 7.50419 12.1842L7.49751 16.8516C7.49755 16.9508 7.4976 17.0694 7.48906 17.1738C7.47918 17.2948 7.45381 17.4681 7.36127 17.6498C7.24143 17.885 7.0502 18.0762 6.815 18.1961C6.63338 18.2886 6.46005 18.314 6.33904 18.3239C6.2346 18.3324 6.11606 18.3323 6.0168 18.3323C5.34706 18.332 4.66959 18.3614 4.00165 18.3068C3.6722 18.2799 3.34452 18.2205 3.0292 18.0598C2.5588 17.8201 2.17635 17.4376 1.93666 16.9673C1.776 16.652 1.71657 16.3243 1.68965 15.9948C1.66415 15.6826 1.66416 15.3037 1.66418 14.8644C1.66418 12.8166 1.66633 10.7689 1.66412 8.72123C1.66369 8.32392 1.66331 7.97391 1.75671 7.64023C1.83868 7.3474 1.97339 7.07197 2.15421 6.82749C2.36026 6.5489 2.63677 6.33431 2.95063 6.09075C4.87849 4.59464 6.8101 3.1028 8.72952 1.59584C8.95202 1.42115 9.23077 1.20227 9.56194 1.11261Z",fill:o?"#0073EA":"#676879"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:o=>v.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_11001_23158)",children:v.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_11001_23158",children:v.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:o=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M16.6693 17.5C16.6693 16.337 16.6693 15.7556 16.5258 15.2824C16.2026 14.2171 15.3689 13.3833 14.3035 13.0602C13.8304 12.9167 13.2489 12.9167 12.0859 12.9167H7.91927C6.7563 12.9167 6.17481 12.9167 5.70165 13.0602C4.63631 13.3833 3.80264 14.2171 3.47947 15.2824C3.33594 15.7556 3.33594 16.337 3.33594 17.5M13.7526 6.25C13.7526 8.32107 12.0737 10 10.0026 10C7.93154 10 6.2526 8.32107 6.2526 6.25C6.2526 4.17893 7.93154 2.5 10.0026 2.5C12.0737 2.5 13.7526 4.17893 13.7526 6.25Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}];return v.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[v.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[v.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:v.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),v.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[v.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:r.map(o=>{const s=e===o.id;return v.jsxs("button",{onClick:()=>{t(o.id),o.onClick()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${s?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[s&&v.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),o.icon(s),v.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${s?"text-[#172B4D]":"text-[#505258]"}`,children:o.label})]},o.id)})}),v.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[v.jsx("div",{className:"flex h-14 flex-col items-start self-stretch",children:v.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:v.jsx("div",{className:"flex items-start gap-2",children:v.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Verified Credentials"})})})}),v.jsx("div",{className:"flex px-4 flex-col items-start gap-2.5 flex-1 self-stretch",children:v.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 self-stretch",children:W8e.map(o=>v.jsx("div",{className:"w-full",children:v.jsx(uB,{title:o.title,documentType:o.documentType,completedOn:o.completedOn,expiresOn:o.expiresOn})},o.id))})})]})]})]})}function H8e(){const n=ci(),{toast:e}=Nm(),[t,r]=F.useState("contact"),[o,s]=F.useState(""),[i,a]=F.useState(""),[l,c]=F.useState(""),[u,d]=F.useState(null),[h,p]=F.useState(!1),[g,x]=F.useState(!1),y=F.useRef(null),b=F.useRef(null);F.useEffect(()=>{y.current&&i&&y.current.innerHTML!==i&&(y.current.innerHTML=i,c(y.current.innerText||""))},[i]);const C=(Z,ne)=>{try{document.execCommand(Z,!1,ne||void 0);const ge=y.current?.innerHTML||"",he=y.current?.innerText||"";a(ge),c(he),y.current?.focus()}catch{}},S=()=>{const Z=window.getSelection();if(!Z||Z.rangeCount===0)return;const he=`<code style="background:#f6f8fa;padding:2px 4px;border-radius:4px;font-family:monospace">${Z.getRangeAt(0).toString()}</code>`;document.execCommand("insertHTML",!1,he);const Se=y.current?.innerHTML||"",Re=y.current?.innerText||"";a(Se),c(Re),y.current?.focus()},[k,N]=F.useState(!1),[E,_]=F.useState(!1),[$,T]=F.useState(!1),[D,A]=F.useState(!1),[M,j]=F.useState(!1),[L,U]=F.useState(null),G=()=>{if(!y.current)return;const Z=window.getSelection();if(!Z||!Z.anchorNode||!y.current.contains(Z.anchorNode)){N(!1),_(!1),T(!1),A(!1),j(!1),U(null);return}try{N(document.queryCommandState("bold")),_(document.queryCommandState("italic")),T(document.queryCommandState("underline")),A(document.queryCommandState("strikeThrough")),j(document.queryCommandState("justifyLeft"));const ne=document.queryCommandValue("foreColor");U(ne||null)}catch{}};F.useEffect(()=>(document.addEventListener("selectionchange",G),()=>document.removeEventListener("selectionchange",G)),[]);const H=(Z,ne)=>{C(Z,ne),setTimeout(G,0)},O=()=>{S(),setTimeout(G,0)},V=[{id:"home",label:"Home",icon:Z=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56194 1.11261C9.84719 1.03538 10.1479 1.03538 10.4331 1.11261C10.7642 1.20227 11.043 1.42115 11.2655 1.59584C13.185 3.10283 15.1164 4.59457 17.0444 6.09074C17.3583 6.33431 17.6348 6.5489 17.8408 6.82749C18.0216 7.07197 18.1564 7.3474 18.2383 7.64023C18.3317 7.97391 18.3314 8.32392 18.3309 8.72123C18.3288 10.769 18.3309 12.8167 18.3309 14.8645C18.3309 15.3037 18.3309 15.6826 18.3054 15.9948C18.2784 16.3243 18.219 16.652 18.0584 16.9673C17.8187 17.4376 17.4362 17.8201 16.9659 18.0598C16.6505 18.2205 16.3229 18.2799 15.9934 18.3068C15.3254 18.3614 14.6479 18.332 13.9782 18.3323C13.8789 18.3323 13.7604 18.3324 13.656 18.3239C13.5349 18.314 13.3616 18.2886 13.18 18.1961C12.9449 18.0762 12.7536 17.885 12.6338 17.6498C12.5412 17.4681 12.5159 17.2948 12.5059 17.1738C12.4974 17.0694 12.4974 16.9508 12.4975 16.8516L12.5041 12.1881C12.5048 11.7207 12.505 11.4871 12.4144 11.3086C12.3345 11.1516 12.207 11.0238 12.0501 10.9438C11.8717 10.8528 11.638 10.8528 11.1708 10.8528H8.83752C8.37144 10.8528 8.13836 10.8528 7.96023 10.9435C7.80354 11.0232 7.67609 11.1505 7.59611 11.3071C7.50519 11.4851 7.50485 11.7181 7.50419 12.1842L7.49751 16.8516C7.49755 16.9508 7.4976 17.0694 7.48906 17.1738C7.47918 17.2948 7.45381 17.4681 7.36127 17.6498C7.24143 17.885 7.0502 18.0762 6.815 18.1961C6.63338 18.2886 6.46005 18.314 6.33904 18.3239C6.2346 18.3324 6.11606 18.3323 6.0168 18.3323C5.34706 18.332 4.66959 18.3614 4.00165 18.3068C3.6722 18.2799 3.34452 18.2205 3.0292 18.0598C2.5588 17.8201 2.17635 17.4376 1.93666 16.9673C1.77605 16.652 1.71661 16.3243 1.68963 15.9948C1.66406 15.6826 1.66406 15.3037 1.66406 14.8645C1.66406 12.8167 1.66627 10.769 1.66406 8.72123C1.66359 8.32392 1.66333 7.97391 1.75672 7.64023C1.83866 7.3474 1.97345 7.07197 2.15419 6.82749C2.36025 6.5489 2.63674 6.33431 2.95063 6.09074C4.87865 4.59457 6.81004 3.10283 8.72954 1.59584C8.95201 1.42115 9.23079 1.20227 9.56194 1.11261Z",fill:Z?"#0073EA":"#676879"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:Z=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:Z?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:Z=>v.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_11001_26397)",children:v.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:Z?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_11001_26397",children:v.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:Z=>v.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:Z?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:Z=>v.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.32195 12.0938C9.10747 12.0942 10.8931 12.0942 12.6786 12.0938C13.2841 12.0936 13.6968 12.0935 14.0571 12.1571C15.7822 12.4613 17.1328 13.8118 17.437 15.5369C17.5005 15.8973 17.5004 16.3098 17.5003 16.9154C17.5002 17.0474 17.5043 17.1803 17.4813 17.3108C17.3901 17.8283 16.9848 18.2335 16.4673 18.3248C16.3539 18.3448 16.2343 18.3442 16.1748 18.3438C12.0589 18.3218 7.94165 18.3218 3.8257 18.3438C3.76623 18.3442 3.64668 18.3448 3.5332 18.3248C3.0157 18.2335 2.61051 17.8283 2.51925 17.3108C2.49624 17.1803 2.50029 17.0474 2.50025 16.9154C2.50012 16.3098 2.50003 15.8973 2.56357 15.5369C2.86775 13.8118 4.21835 12.4613 5.9434 12.1571C6.30374 12.0935 6.71638 12.0936 7.32195 12.0938Z",fill:Z?"#0073EA":"#676879"}),v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.42188 6.23958C5.42188 3.70828 7.4739 1.65625 10.0052 1.65625C12.5365 1.65625 14.5886 3.70828 14.5886 6.23958C14.5886 8.77092 12.5365 10.8229 10.0052 10.8229C7.4739 10.8229 5.42188 8.77092 5.42188 6.23958Z",fill:Z?"#0073EA":"#676879"})]}),onClick:()=>n("/contact-admin")}],W=Z=>{Z.preventDefault(),Z.stopPropagation(),Z.type==="dragenter"||Z.type==="dragover"?x(!0):Z.type==="dragleave"&&x(!1)},B=Z=>{Z.preventDefault(),Z.stopPropagation(),x(!1),Z.dataTransfer.files&&Z.dataTransfer.files[0]&&d(Z.dataTransfer.files[0])},q=Z=>{Z.target.files&&Z.target.files[0]&&d(Z.target.files[0])},Q=async Z=>{if(Z.preventDefault(),!(!o.trim()||!l.trim())){p(!0);try{await new Promise(ne=>setTimeout(ne,600)),e({title:"Message sent successfully",description:"Admin will respond shortly."}),s(""),a(""),c(""),y.current&&(y.current.innerHTML=""),d(null)}catch{e({title:"Failed to send message",description:"Please try again later.",variant:"destructive"})}finally{p(!1)}}};return v.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[v.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[v.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:v.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),v.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[v.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:V.map(Z=>{const ne=t===Z.id;return v.jsxs("button",{onClick:()=>{r(Z.id),Z.onClick()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${ne?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[ne&&v.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),Z.icon(ne),v.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${ne?"text-[#172B4D]":"text-[#505258]"}`,children:Z.label})]},Z.id)})}),v.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[v.jsx("div",{className:"flex h-14 flex-col items-start self-stretch border-b border-[#DEDEDD]",children:v.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:v.jsxs("div",{className:"flex items-start gap-2",children:[v.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Contact Admin"}),v.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("g",{clipPath:"url(#clip0_contact_info)",children:v.jsx("path",{d:"M9.9974 13.3307V9.9974M9.9974 6.66406H10.0057M18.3307 9.9974C18.3307 14.5997 14.5997 18.3307 9.9974 18.3307C5.39502 18.3307 1.66406 14.5997 1.66406 9.9974C1.66406 5.39502 5.39502 1.66406 9.9974 1.66406C14.5997 1.66406 18.3307 5.39502 18.3307 9.9974Z",stroke:"#505258",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),v.jsx("defs",{children:v.jsx("clipPath",{id:"clip0_contact_info",children:v.jsx("rect",{width:"20",height:"20",fill:"white"})})})]})]})})}),v.jsx("div",{className:"flex px-4 py-[18px] flex-col items-end gap-1 flex-1 self-stretch",children:v.jsx("form",{onSubmit:Q,className:"w-full max-w-[993px]",children:v.jsxs("div",{className:"flex flex-col items-start gap-4 rounded border border-[#DEDEDD] bg-white p-4 shadow-[0_3px_8px_0_rgba(0,0,0,0.20)]",children:[v.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[v.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("span",{className:"flex h-[10px] flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Subject Line"})}),v.jsx("input",{type:"text",value:o,onChange:Z=>s(Z.target.value),placeholder:"Eg. Question about document submission",className:"flex h-[38px] px-3 py-[15px] justify-between items-center self-stretch rounded border border-[#C3C6D4] bg-white text-[#676879] font-roboto text-[13px] font-normal leading-5 outline-none focus:border-[#0073EA]",required:!0})]}),v.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[v.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("span",{className:"flex h-[10px] flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Message"})}),v.jsxs("div",{className:"w-full rounded border border-[#C3C6D4] bg-white overflow-hidden",children:[v.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 border-b border-[#C3C6D4] bg-white",children:[v.jsx("button",{type:"button",onClick:()=>H("undo"),className:"p-1 rounded hover:bg-gray-100",children:v.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M12.5 6.25H4.88438L7.12625 4.00875L6.25 3.125L2.5 6.875L6.25 10.625L7.12625 9.74062L4.88625 7.5H12.5C13.4946 7.5 14.4484 7.89509 15.1517 8.59835C15.8549 9.30161 16.25 10.2554 16.25 11.25C16.25 12.2446 15.8549 13.1984 15.1517 13.9017C14.4484 14.6049 13.4946 15 12.5 15H7.5V16.25H12.5C13.8261 16.25 15.0979 15.7232 16.0355 14.7855C16.9732 13.8479 17.5 12.5761 17.5 11.25C17.5 9.92392 16.9732 8.65215 16.0355 7.71447C15.0979 6.77678 13.8261 6.25 12.5 6.25Z",fill:"#212529"})})}),v.jsx("button",{type:"button",onClick:()=>H("redo"),className:"p-1 rounded hover:bg-gray-100",children:v.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 6.25H15.1156L12.8737 4.00875L13.75 3.125L17.5 6.875L13.75 10.625L12.8737 9.74062L15.1137 7.5H7.5C6.50544 7.5 5.55161 7.89509 4.84835 8.59835C4.14509 9.30161 3.75 10.2554 3.75 11.25C3.75 12.2446 4.14509 13.1984 4.84835 13.9017C5.55161 14.6049 6.50544 15 7.5 15H12.5V16.25H7.5C6.17392 16.25 4.90215 15.7232 3.96447 14.7855C3.02678 13.8479 2.5 12.5761 2.5 11.25C2.5 9.92392 3.02678 8.65215 3.96447 7.71447C4.90215 6.77678 6.17392 6.25 7.5 6.25Z",fill:"#212529"})})}),v.jsx("div",{className:"h-8 px-2 flex items-center rounded text-sm bg-white border border-transparent",children:v.jsx("span",{className:"text-sm text-[#212529]",children:"Normal text"})}),v.jsx("div",{className:"w-px h-6 bg-[#E9ECEF] mx-1"}),v.jsx("button",{type:"button",onClick:()=>H("justifyLeft"),className:`p-1 rounded hover:bg-gray-100 ${M?"bg-[#E6F1FD]":""}`,children:v.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M7.5 3.75H16.25V5H7.5V3.75ZM7.5 7.5H13.75V8.75H7.5V7.5ZM7.5 11.25H16.25V12.5H7.5V11.25ZM7.5 15H13.75V16.25H7.5V15ZM3.75 2.5H5V17.5H3.75V2.5Z",fill:"#212529"})})}),v.jsx("input",{ref:b,type:"color",className:"hidden",onChange:Z=>H("foreColor",Z.target.value)}),v.jsx("button",{type:"button",onClick:()=>b.current?.click(),className:`p-1 rounded hover:bg-gray-100 ${L?"bg-[#E6F1FD]":""}`,children:v.jsx("div",{className:"w-4 h-4 rounded-sm",style:{background:L||"#212529"}})}),v.jsx("div",{className:"ml-2 w-px h-6 bg-[#E9ECEF] mr-1"}),v.jsx("button",{type:"button",onClick:()=>H("bold"),className:`p-1 rounded hover:bg-gray-100 font-bold ${k?"bg-[#E6F1FD]":""}`,children:v.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M11.4062 15.625H5.625V4.375H10.9375C11.5639 4.37504 12.1771 4.55435 12.7048 4.89174C13.2325 5.22914 13.6526 5.71052 13.9155 6.27903C14.1784 6.84754 14.2731 7.47942 14.1884 8.10001C14.1037 8.72061 13.8431 9.30399 13.4375 9.78125C13.9673 10.205 14.3528 10.7825 14.5408 11.4344C14.7289 12.0862 14.7102 12.7803 14.4875 13.4211C14.2647 14.0619 13.8488 14.6179 13.297 15.0126C12.7452 15.4073 12.0847 15.6213 11.4062 15.625Z",fill:"#212529"})})}),v.jsx("button",{type:"button",onClick:()=>H("italic"),className:`p-1 rounded hover:bg-gray-100 italic ${E?"bg-[#E6F1FD]":""}`,children:v.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M15.625 5.625V4.375H7.5V5.625H10.7125L7.98125 14.375H4.375V15.625H12.5V14.375H9.2875L12.0187 5.625H15.625Z",fill:"#212529"})})}),v.jsx("button",{type:"button",onClick:()=>H("underline"),className:`p-1 rounded hover:bg-gray-100 ${$?"bg-[#E6F1FD]":""}`,children:v.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M2.5 16.25H17.5V17.5H2.5V16.25ZM10 14.375C8.83968 14.375 7.72688 13.9141 6.90641 13.0936C6.08594 12.2731 5.625 11.1603 5.625 10V3.125H6.875V10C6.875 10.8288 7.20424 11.6237 7.79029 12.2097C8.37634 12.7958 9.1712 13.125 10 13.125C10.8288 13.125 11.6237 12.7958 12.2097 12.2097C12.7958 11.6237 13.125 10.8288 13.125 10V3.125H14.375V10C14.375 11.1603 13.9141 12.2731 13.0936 13.0936C12.2731 13.9141 11.1603 14.375 10 14.375Z",fill:"#212529"})})}),v.jsx("button",{type:"button",onClick:()=>H("strikeThrough"),className:`p-1 rounded hover:bg-gray-100 line-through ${D?"bg-[#E6F1FD]":""}`,children:v.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M17.5 9.37538H11.2225C10.945 9.30076 10.6662 9.23096 10.3863 9.16601C8.63125 8.75101 7.63875 8.44726 7.63875 7.02663C7.6245 6.78139 7.66081 6.53584 7.74542 6.30522C7.83004 6.0746 7.96115 5.86384 8.13062 5.68601C8.6615 5.24944 9.32644 5.00889 10.0137 5.00476C11.7825 4.96101 12.5981 5.56101 13.265 6.47351L14.2744 5.73601C13.8019 5.05748 13.1578 4.51654 12.4078 4.16845C11.6578 3.82036 10.8288 3.6776 10.0056 3.75476C8.99439 3.76121 8.01887 4.12947 7.25563 4.79288C6.96634 5.08632 6.74024 5.4359 6.59125 5.82008C6.44227 6.20426 6.37356 6.61488 6.38937 7.02663C6.36197 7.47718 6.4466 7.92751 6.63572 8.33737C6.82483 8.74723 7.11254 9.10385 7.47312 9.37538H2.5V10.6254H11.0325C12.2619 10.9816 12.9969 11.4454 13.0156 12.7241C13.0359 12.9973 12.9985 13.2717 12.9056 13.5294C12.8128 13.7871 12.6667 14.0223 12.4769 14.2198C11.8155 14.7411 10.9938 15.017 10.1519 15.0004C9.52345 14.9822 8.90738 14.8213 8.35029 14.5299C7.7932 14.2385 7.30966 13.8243 6.93625 13.3185L5.97812 14.121C6.46358 14.768 7.08994 15.2959 7.80972 15.6648C8.52951 16.0338 9.32384 16.234 10.1325 16.2504H10.195C11.3492 16.2636 12.4695 15.86 13.35 15.1135C13.6625 14.7984 13.9054 14.4213 14.0632 14.0065C14.2209 13.5917 14.2898 13.1485 14.2656 12.7054C14.289 11.9474 14.0332 11.2072 13.5469 10.6254H17.5V9.37538Z",fill:"#212529"})})}),v.jsx("button",{type:"button",onClick:()=>O(),className:"p-1 rounded hover:bg-gray-100",children:v.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M19.375 10L15 14.375L14.1187 13.4938L17.6063 10L14.1187 6.50625L15 5.625L19.375 10ZM0.625 10L5 5.625L5.88125 6.50625L2.39375 10L5.88125 13.4938L5 14.375L0.625 10Z",fill:"#212529"})})})]}),v.jsxs("div",{className:"relative w-full",children:[v.jsx("div",{ref:y,contentEditable:!0,suppressContentEditableWarning:!0,onInput:()=>{const Z=y.current?.innerHTML||"",ne=y.current?.innerText||"";a(Z),c(ne),setTimeout(G,0)},className:"w-full min-h-[202px] p-3 text-[#676879] font-roboto text-[13px] font-normal leading-5 outline-none resize-none","aria-multiline":!0}),!l&&v.jsx("div",{className:"pointer-events-none absolute top-3 left-3 text-[#9aa0a6]",children:"Describe your question or concern in detail...."})]})]})]}),v.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[v.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:v.jsx("span",{className:"flex h-[10px] flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Attachment (Optional)"})}),v.jsxs("div",{className:`flex h-[72px] px-[284px] justify-center items-center gap-2 self-stretch rounded-lg border border-dashed ${g?"border-[#0073EA] bg-[#E6F1FD]":"border-[#C3C6D4] bg-white"} cursor-pointer relative`,onDragEnter:W,onDragLeave:W,onDragOver:W,onDrop:B,children:[v.jsx("input",{type:"file",onChange:q,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:".jpg,.jpeg,.png,.svg,.xls,.xlsx"}),v.jsxs("div",{className:"flex items-center gap-2 pointer-events-none",children:[v.jsxs("div",{className:"relative w-[33px] h-[34px]",children:[v.jsxs("svg",{className:"absolute left-0 top-0",width:"28",height:"28",viewBox:"0 0 29 29",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.3433 2.3039C15.3446 2.33205 15.3446 2.34758 15.3446 2.37864V7.59236C15.3446 7.89031 15.3445 8.18048 15.3647 8.42622C15.3866 8.69608 15.4387 9.01453 15.602 9.33495C15.8283 9.77923 16.1895 10.1404 16.6338 10.3668C16.9542 10.5301 17.2727 10.5821 17.5426 10.6041C17.7883 10.6242 18.0784 10.6242 18.3764 10.6241H23.5902C23.6211 10.6241 23.6366 10.6241 23.6648 10.6255C24.2478 10.6533 24.7603 11.166 24.7878 11.749C24.7891 11.7771 24.7891 11.7863 24.7891 11.8046V20.3534C24.7891 21.3038 24.7891 22.088 24.7369 22.727C24.6827 23.3905 24.5663 24.0005 24.2743 24.5736C23.8216 25.4621 23.0992 26.1844 22.2107 26.6372C21.6377 26.9291 21.0277 27.0455 20.3641 27.0997C19.7252 27.1519 18.9409 27.1519 17.9906 27.1519H10.3375C9.38721 27.1519 8.6029 27.1519 7.964 27.0997C7.30041 27.0455 6.69041 26.9291 6.11744 26.6372C5.2289 26.1844 4.50649 25.4621 4.05376 24.5736C3.76181 24.0005 3.64545 23.3905 3.59124 22.727C3.53904 22.088 3.53905 21.3038 3.53906 20.3534V7.97814C3.53905 7.02784 3.53904 6.24353 3.59124 5.60462C3.64545 4.94103 3.76181 4.33104 4.05376 3.75807C4.50649 2.86952 5.2289 2.14712 6.11744 1.69439C6.69041 1.40245 7.30041 1.28608 7.964 1.23187C8.60289 1.17966 9.38719 1.17968 10.3375 1.17969H14.1641C14.1825 1.17968 14.1917 1.17968 14.2199 1.18101C14.8027 1.20859 15.3155 1.72097 15.3433 2.3039Z",fill:"#DCDFEC"}),v.jsx("path",{d:"M22.9864 8.17816C22.8445 8.2652 22.6712 8.2652 22.3245 8.26519L18.6554 8.26514C18.3248 8.26514 18.1595 8.26513 18.0332 8.2008C17.9221 8.14421 17.8318 8.05391 17.7753 7.94284C17.7109 7.81658 17.7109 7.65129 17.7109 7.32071V3.65164C17.7109 3.305 17.7109 3.13169 17.7979 2.9897C17.921 2.7892 18.2105 2.66932 18.4392 2.72429C18.6011 2.76321 18.7141 2.87624 18.9399 3.1023L22.8739 7.03629C23.0999 7.26212 23.2129 7.37504 23.2519 7.53695C23.3068 7.76564 23.1869 8.05524 22.9864 8.17816Z",fill:"#A3ADBA"})]}),v.jsx("div",{className:"absolute left-4 top-[17px] flex w-[17px] h-[17px] justify-center items-center rounded-full bg-[#323238]",children:v.jsxs("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("path",{d:"M4.66443 0.949146C4.82578 0.787785 5.08741 0.787785 5.24877 0.949146L6.90155 2.60192C7.0629 2.76329 7.0629 3.02491 6.90155 3.18627C6.74019 3.34763 6.47856 3.34763 6.31721 3.18627L5.36979 2.23886V6.19965C5.36979 6.42786 5.1848 6.61285 4.9566 6.61285C4.72839 6.61285 4.5434 6.42786 4.5434 6.19965V2.23886L3.59599 3.18627C3.43463 3.34763 3.17301 3.34763 3.01165 3.18627C2.85028 3.02491 2.85028 2.76329 3.01165 2.60192L4.66443 0.949146Z",fill:"white"}),v.jsx("path",{d:"M1.24132 4.54688C1.46952 4.54688 1.65451 4.73186 1.65451 4.96007V6.69549C1.65451 7.04943 1.65484 7.29003 1.67003 7.47601C1.68483 7.65716 1.71166 7.74979 1.74459 7.81442C1.82381 7.9699 1.95024 8.09634 2.10573 8.17555C2.17035 8.20848 2.26299 8.2353 2.44414 8.25009C2.63012 8.2653 2.87072 8.26563 3.22465 8.26563H6.69549C7.04943 8.26563 7.29003 8.2653 7.47601 8.25009C7.65715 8.2353 7.74979 8.20848 7.81442 8.17555C7.9699 8.09634 8.09634 7.9699 8.17555 7.81442C8.20848 7.74979 8.2353 7.65716 8.25009 7.47601C8.26529 7.29003 8.26562 7.04943 8.26562 6.69549V4.96007C8.26562 4.73186 8.45061 4.54688 8.67882 4.54688C8.90703 4.54688 9.09201 4.73186 9.09201 4.96007V6.71255C9.09201 7.04517 9.09201 7.31966 9.07375 7.54328C9.05478 7.77554 9.01404 7.98903 8.91186 8.1896C8.7534 8.50057 8.50057 8.7534 8.1896 8.91186C7.98903 9.01404 7.77553 9.05479 7.54328 9.07375C7.31966 9.09201 7.04517 9.09201 6.71255 9.09201H3.2076C2.87498 9.09201 2.60047 9.09201 2.37685 9.07375C2.1446 9.05479 1.93109 9.01404 1.73056 8.91186C1.41957 8.7534 1.16673 8.50057 1.00827 8.1896C0.906087 7.98903 0.865362 7.77554 0.846384 7.54328C0.828117 7.31966 0.828121 7.04517 0.828125 6.71255V4.96007C0.828125 4.73186 1.01312 4.54688 1.24132 4.54688Z",fill:"white"})]})})]}),v.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-medium leading-normal",children:u?u.name:v.jsxs(v.Fragment,{children:[v.jsx("span",{className:"text-[#505258]",children:"Drag & Drop File Here"}),v.jsx("span",{className:"text-[#172B4D]",children:" or "}),v.jsx("span",{className:"text-[#0073EA]",children:"Choose File"})]})})]})]}),v.jsxs("div",{className:"flex justify-between items-center self-stretch mt-1",children:[v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Supported Formats: JPG, JPEG, PNG, SVG, .XLS"}),v.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Maximum Size: 25MB"})]})]}),v.jsx("button",{type:"submit",disabled:h||!o.trim()||!l.trim(),className:"flex h-[38px] px-4 py-[11px] justify-center items-center gap-2.5 rounded bg-[#0073EA] text-white font-roboto text-[13px] font-medium leading-normal disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[#0062C6] transition-colors",children:h?"Sending...":"Send Message"})]})})})]})]})]})}const G8e=new KU,q8e=()=>v.jsx(YU,{client:G8e,children:v.jsxs(wU,{children:[v.jsx(ez,{}),v.jsx(Fz,{}),v.jsx(GH,{children:v.jsxs(zH,{children:[v.jsx(is,{path:"/",element:v.jsx(F9,{})}),v.jsx(is,{path:"/form",element:v.jsx(F9,{})}),v.jsx(is,{path:"/verification-progress",element:v.jsx(v8e,{})}),v.jsx(is,{path:"/verification-success",element:v.jsx(y8e,{})}),v.jsx(is,{path:"/password-setup",element:v.jsx(O8e,{})}),v.jsx(is,{path:"/auth/login",element:v.jsx(b8e,{})}),v.jsx(is,{path:"/auth/otp",element:v.jsx(w8e,{})}),v.jsx(is,{path:"/dashboard",element:v.jsx(_8e,{})}),v.jsx(is,{path:"/ongoing-verification",element:v.jsx(j8e,{})}),v.jsx(is,{path:"/expired-verification",element:v.jsx(z8e,{})}),v.jsx(is,{path:"/verified-credentials",element:v.jsx(U8e,{})}),v.jsx(is,{path:"/contact-admin",element:v.jsx(H8e,{})}),v.jsx(is,{path:"/profile",element:v.jsx($8e,{})}),v.jsx(is,{path:"*",element:v.jsx(x8e,{})})]})})]})});nz.createRoot(document.getElementById("root")).render(v.jsx(q8e,{}))});export default K8e();
